import ast


def find_class_function(code, line_number_list):
    class_function_dict = {}  # 存储每个行号对应的类和函数名字的字典
    last_class_function_list = {}  # 存储最后一次遍历到的类和函数名字的字典，用于在函数内部更新class_function_dict

    def visit(node, class_name_dict=None):
        nonlocal class_function_dict
        class_name_dict = class_name_dict or {str(line_num): [] for line_num in line_number_list}

        if isinstance(node, ast.ClassDef) or isinstance(node, ast.FunctionDef):
            # 遍历每个待识别行号
            print(node.name)
            for line_number in line_number_list:
                # 判断节点起始行号和结束行号是否包含该行号
                if node.lineno <= line_number <= node.end_lineno:
                    # 将节点的名字添加到对应行号的类或函数名字列表中
                    class_name_dict[str(line_number)].append(node.name)

        if hasattr(node, 'lineno'):
            print(node.lineno)
            class_function_dict = class_name_dict  # 更新class_function_dict为当前的class_name_dict

        if hasattr(node, 'body'):
            for child_node in node.body:
                visit(child_node, class_name_dict)  # 递归遍历子节点，传入class_name_dict来保持上下文信息

    tree = ast.parse(code)
    visit(tree)

    return class_function_dict


if  __name__=='__main__':
    with open('demo.py','r') as f :
        code = f.read()
    print(find_class_function(code,[8, 158, 159, 160, 161, 162, 163, 164]))

    print('.'.join([]))