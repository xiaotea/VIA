{
    "grappelli/views/switch.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 8,
                "afterPatchRowNumber": 8,
                "PatchRowcode": " from django.http import Http404"
            },
            "1": {
                "beforePatchRowNumber": 9,
                "afterPatchRowNumber": 9,
                "PatchRowcode": " from django.shortcuts import redirect"
            },
            "2": {
                "beforePatchRowNumber": 10,
                "afterPatchRowNumber": 10,
                "PatchRowcode": " from django.utils.html import escape"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 11,
                "PatchRowcode": "+from django.utils.http import url_has_allowed_host_and_scheme"
            },
            "4": {
                "beforePatchRowNumber": 11,
                "afterPatchRowNumber": 12,
                "PatchRowcode": " from django.utils.translation import gettext_lazy as _"
            },
            "5": {
                "beforePatchRowNumber": 12,
                "afterPatchRowNumber": 13,
                "PatchRowcode": " "
            },
            "6": {
                "beforePatchRowNumber": 13,
                "afterPatchRowNumber": 14,
                "PatchRowcode": " from grappelli.settings import SWITCH_USER_ORIGINAL, SWITCH_USER_TARGET"
            },
            "7": {
                "beforePatchRowNumber": 28,
                "afterPatchRowNumber": 29,
                "PatchRowcode": " "
            },
            "8": {
                "beforePatchRowNumber": 29,
                "afterPatchRowNumber": 30,
                "PatchRowcode": "     # check redirect"
            },
            "9": {
                "beforePatchRowNumber": 30,
                "afterPatchRowNumber": 31,
                "PatchRowcode": "     redirect_url = request.GET.get(\"redirect\", None)"
            },
            "10": {
                "beforePatchRowNumber": 31,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    if redirect_url is None or not redirect_url.startswith(\"/\"):"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 32,
                "PatchRowcode": "+    if redirect_url is None or not \\"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 33,
                "PatchRowcode": "+        url_has_allowed_host_and_scheme("
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 34,
                "PatchRowcode": "+            url=redirect_url,"
            },
            "14": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 35,
                "PatchRowcode": "+            allowed_hosts={request.get_host()},"
            },
            "15": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 36,
                "PatchRowcode": "+            require_https=request.is_secure(),"
            },
            "16": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 37,
                "PatchRowcode": "+        ):"
            },
            "17": {
                "beforePatchRowNumber": 32,
                "afterPatchRowNumber": 38,
                "PatchRowcode": "         raise Http404()"
            },
            "18": {
                "beforePatchRowNumber": 33,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 39,
                "PatchRowcode": "+        "
            },
            "20": {
                "beforePatchRowNumber": 34,
                "afterPatchRowNumber": 40,
                "PatchRowcode": "     # check original_user"
            },
            "21": {
                "beforePatchRowNumber": 35,
                "afterPatchRowNumber": 41,
                "PatchRowcode": "     try:"
            },
            "22": {
                "beforePatchRowNumber": 36,
                "afterPatchRowNumber": 42,
                "PatchRowcode": "         original_user = User.objects.get(pk=session_user[\"id\"], is_staff=True)"
            },
            "23": {
                "beforePatchRowNumber": 37,
                "afterPatchRowNumber": 43,
                "PatchRowcode": "         if not SWITCH_USER_ORIGINAL(original_user):"
            },
            "24": {
                "beforePatchRowNumber": 38,
                "afterPatchRowNumber": 44,
                "PatchRowcode": "             messages.add_message(request, messages.ERROR, _(\"Permission denied.\"))"
            },
            "25": {
                "beforePatchRowNumber": 39,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            return redirect(request.GET.get(\"redirect\"))"
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 45,
                "PatchRowcode": "+            return redirect(redirect_url)"
            },
            "27": {
                "beforePatchRowNumber": 40,
                "afterPatchRowNumber": 46,
                "PatchRowcode": "     except ObjectDoesNotExist:"
            },
            "28": {
                "beforePatchRowNumber": 41,
                "afterPatchRowNumber": 47,
                "PatchRowcode": "         msg = _('%(name)s object with primary key %(key)r does not exist.') % {'name': \"User\", 'key': escape(session_user[\"id\"])}"
            },
            "29": {
                "beforePatchRowNumber": 42,
                "afterPatchRowNumber": 48,
                "PatchRowcode": "         messages.add_message(request, messages.ERROR, msg)"
            },
            "30": {
                "beforePatchRowNumber": 43,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        return redirect(request.GET.get(\"redirect\"))"
            },
            "31": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 49,
                "PatchRowcode": "+        return redirect(redirect_url)"
            },
            "32": {
                "beforePatchRowNumber": 44,
                "afterPatchRowNumber": 50,
                "PatchRowcode": " "
            },
            "33": {
                "beforePatchRowNumber": 45,
                "afterPatchRowNumber": 51,
                "PatchRowcode": "     # check new user"
            },
            "34": {
                "beforePatchRowNumber": 46,
                "afterPatchRowNumber": 52,
                "PatchRowcode": "     try:"
            },
            "35": {
                "beforePatchRowNumber": 47,
                "afterPatchRowNumber": 53,
                "PatchRowcode": "         target_user = User.objects.get(pk=object_id, is_staff=True)"
            },
            "36": {
                "beforePatchRowNumber": 48,
                "afterPatchRowNumber": 54,
                "PatchRowcode": "         if target_user != original_user and not SWITCH_USER_TARGET(original_user, target_user):"
            },
            "37": {
                "beforePatchRowNumber": 49,
                "afterPatchRowNumber": 55,
                "PatchRowcode": "             messages.add_message(request, messages.ERROR, _(\"Permission denied.\"))"
            },
            "38": {
                "beforePatchRowNumber": 50,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            return redirect(request.GET.get(\"redirect\"))"
            },
            "39": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 56,
                "PatchRowcode": "+            return redirect(redirect_url)"
            },
            "40": {
                "beforePatchRowNumber": 51,
                "afterPatchRowNumber": 57,
                "PatchRowcode": "     except ObjectDoesNotExist:"
            },
            "41": {
                "beforePatchRowNumber": 52,
                "afterPatchRowNumber": 58,
                "PatchRowcode": "         msg = _('%(name)s object with primary key %(key)r does not exist.') % {'name': \"User\", 'key': escape(object_id)}"
            },
            "42": {
                "beforePatchRowNumber": 53,
                "afterPatchRowNumber": 59,
                "PatchRowcode": "         messages.add_message(request, messages.ERROR, msg)"
            },
            "43": {
                "beforePatchRowNumber": 54,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        return redirect(request.GET.get(\"redirect\"))"
            },
            "44": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 60,
                "PatchRowcode": "+        return redirect(redirect_url)"
            },
            "45": {
                "beforePatchRowNumber": 55,
                "afterPatchRowNumber": 61,
                "PatchRowcode": " "
            },
            "46": {
                "beforePatchRowNumber": 56,
                "afterPatchRowNumber": 62,
                "PatchRowcode": "     # find backend"
            },
            "47": {
                "beforePatchRowNumber": 57,
                "afterPatchRowNumber": 63,
                "PatchRowcode": "     if not hasattr(target_user, 'backend'):"
            },
            "48": {
                "beforePatchRowNumber": 66,
                "afterPatchRowNumber": 72,
                "PatchRowcode": "         if original_user.id != target_user.id:"
            },
            "49": {
                "beforePatchRowNumber": 67,
                "afterPatchRowNumber": 73,
                "PatchRowcode": "             request.session[\"original_user\"] = {\"id\": original_user.id, \"username\": original_user.get_username()}"
            },
            "50": {
                "beforePatchRowNumber": 68,
                "afterPatchRowNumber": 74,
                "PatchRowcode": " "
            },
            "51": {
                "beforePatchRowNumber": 69,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    return redirect(request.GET.get(\"redirect\"))"
            },
            "52": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 75,
                "PatchRowcode": "+    return redirect(redirect_url)"
            }
        },
        "frontPatchFile": [
            "# coding: utf-8",
            "",
            "from django.conf import settings",
            "from django.contrib import messages",
            "from django.contrib.admin.views.decorators import staff_member_required",
            "from django.contrib.auth import load_backend, login",
            "from django.core.exceptions import ObjectDoesNotExist",
            "from django.http import Http404",
            "from django.shortcuts import redirect",
            "from django.utils.html import escape",
            "from django.utils.translation import gettext_lazy as _",
            "",
            "from grappelli.settings import SWITCH_USER_ORIGINAL, SWITCH_USER_TARGET",
            "",
            "try:",
            "    from django.contrib.auth import get_user_model",
            "    User = get_user_model()",
            "except ImportError:",
            "    from django.contrib.auth.models import User",
            "",
            "",
            "@staff_member_required",
            "def switch_user(request, object_id):",
            "",
            "    # current/session user",
            "    current_user = request.user",
            "    session_user = request.session.get(\"original_user\", {\"id\": current_user.id, \"username\": current_user.get_username()})",
            "",
            "    # check redirect",
            "    redirect_url = request.GET.get(\"redirect\", None)",
            "    if redirect_url is None or not redirect_url.startswith(\"/\"):",
            "        raise Http404()",
            "",
            "    # check original_user",
            "    try:",
            "        original_user = User.objects.get(pk=session_user[\"id\"], is_staff=True)",
            "        if not SWITCH_USER_ORIGINAL(original_user):",
            "            messages.add_message(request, messages.ERROR, _(\"Permission denied.\"))",
            "            return redirect(request.GET.get(\"redirect\"))",
            "    except ObjectDoesNotExist:",
            "        msg = _('%(name)s object with primary key %(key)r does not exist.') % {'name': \"User\", 'key': escape(session_user[\"id\"])}",
            "        messages.add_message(request, messages.ERROR, msg)",
            "        return redirect(request.GET.get(\"redirect\"))",
            "",
            "    # check new user",
            "    try:",
            "        target_user = User.objects.get(pk=object_id, is_staff=True)",
            "        if target_user != original_user and not SWITCH_USER_TARGET(original_user, target_user):",
            "            messages.add_message(request, messages.ERROR, _(\"Permission denied.\"))",
            "            return redirect(request.GET.get(\"redirect\"))",
            "    except ObjectDoesNotExist:",
            "        msg = _('%(name)s object with primary key %(key)r does not exist.') % {'name': \"User\", 'key': escape(object_id)}",
            "        messages.add_message(request, messages.ERROR, msg)",
            "        return redirect(request.GET.get(\"redirect\"))",
            "",
            "    # find backend",
            "    if not hasattr(target_user, 'backend'):",
            "        for backend in settings.AUTHENTICATION_BACKENDS:",
            "            if target_user == load_backend(backend).get_user(target_user.pk):",
            "                target_user.backend = backend",
            "                break",
            "",
            "    # target user login, set original as session",
            "    if hasattr(target_user, 'backend'):",
            "        login(request, target_user)",
            "        if original_user.id != target_user.id:",
            "            request.session[\"original_user\"] = {\"id\": original_user.id, \"username\": original_user.get_username()}",
            "",
            "    return redirect(request.GET.get(\"redirect\"))"
        ],
        "afterPatchFile": [
            "# coding: utf-8",
            "",
            "from django.conf import settings",
            "from django.contrib import messages",
            "from django.contrib.admin.views.decorators import staff_member_required",
            "from django.contrib.auth import load_backend, login",
            "from django.core.exceptions import ObjectDoesNotExist",
            "from django.http import Http404",
            "from django.shortcuts import redirect",
            "from django.utils.html import escape",
            "from django.utils.http import url_has_allowed_host_and_scheme",
            "from django.utils.translation import gettext_lazy as _",
            "",
            "from grappelli.settings import SWITCH_USER_ORIGINAL, SWITCH_USER_TARGET",
            "",
            "try:",
            "    from django.contrib.auth import get_user_model",
            "    User = get_user_model()",
            "except ImportError:",
            "    from django.contrib.auth.models import User",
            "",
            "",
            "@staff_member_required",
            "def switch_user(request, object_id):",
            "",
            "    # current/session user",
            "    current_user = request.user",
            "    session_user = request.session.get(\"original_user\", {\"id\": current_user.id, \"username\": current_user.get_username()})",
            "",
            "    # check redirect",
            "    redirect_url = request.GET.get(\"redirect\", None)",
            "    if redirect_url is None or not \\",
            "        url_has_allowed_host_and_scheme(",
            "            url=redirect_url,",
            "            allowed_hosts={request.get_host()},",
            "            require_https=request.is_secure(),",
            "        ):",
            "        raise Http404()",
            "        ",
            "    # check original_user",
            "    try:",
            "        original_user = User.objects.get(pk=session_user[\"id\"], is_staff=True)",
            "        if not SWITCH_USER_ORIGINAL(original_user):",
            "            messages.add_message(request, messages.ERROR, _(\"Permission denied.\"))",
            "            return redirect(redirect_url)",
            "    except ObjectDoesNotExist:",
            "        msg = _('%(name)s object with primary key %(key)r does not exist.') % {'name': \"User\", 'key': escape(session_user[\"id\"])}",
            "        messages.add_message(request, messages.ERROR, msg)",
            "        return redirect(redirect_url)",
            "",
            "    # check new user",
            "    try:",
            "        target_user = User.objects.get(pk=object_id, is_staff=True)",
            "        if target_user != original_user and not SWITCH_USER_TARGET(original_user, target_user):",
            "            messages.add_message(request, messages.ERROR, _(\"Permission denied.\"))",
            "            return redirect(redirect_url)",
            "    except ObjectDoesNotExist:",
            "        msg = _('%(name)s object with primary key %(key)r does not exist.') % {'name': \"User\", 'key': escape(object_id)}",
            "        messages.add_message(request, messages.ERROR, msg)",
            "        return redirect(redirect_url)",
            "",
            "    # find backend",
            "    if not hasattr(target_user, 'backend'):",
            "        for backend in settings.AUTHENTICATION_BACKENDS:",
            "            if target_user == load_backend(backend).get_user(target_user.pk):",
            "                target_user.backend = backend",
            "                break",
            "",
            "    # target user login, set original as session",
            "    if hasattr(target_user, 'backend'):",
            "        login(request, target_user)",
            "        if original_user.id != target_user.id:",
            "            request.session[\"original_user\"] = {\"id\": original_user.id, \"username\": original_user.get_username()}",
            "",
            "    return redirect(redirect_url)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2"
        ],
        "dele_reviseLocation": {
            "31": [
                "switch_user"
            ],
            "33": [
                "switch_user"
            ],
            "39": [
                "switch_user"
            ],
            "43": [
                "switch_user"
            ],
            "50": [
                "switch_user"
            ],
            "54": [
                "switch_user"
            ],
            "69": [
                "switch_user"
            ]
        },
        "addLocation": []
    }
}