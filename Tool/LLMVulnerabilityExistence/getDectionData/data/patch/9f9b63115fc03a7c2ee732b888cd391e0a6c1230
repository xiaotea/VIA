{
    "toui/apps.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 15,
                "afterPatchRowNumber": 15,
                "PatchRowcode": " from flask import Flask, session, request, send_file"
            },
            "1": {
                "beforePatchRowNumber": 16,
                "afterPatchRowNumber": 16,
                "PatchRowcode": " from flask_sock import Sock"
            },
            "2": {
                "beforePatchRowNumber": 17,
                "afterPatchRowNumber": 17,
                "PatchRowcode": " from flask_caching import Cache"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 18,
                "PatchRowcode": "+from flask_session import Session"
            },
            "4": {
                "beforePatchRowNumber": 18,
                "afterPatchRowNumber": 19,
                "PatchRowcode": " import webview"
            },
            "5": {
                "beforePatchRowNumber": 19,
                "afterPatchRowNumber": 20,
                "PatchRowcode": " from toui._helpers import warn, info, debug, error"
            },
            "6": {
                "beforePatchRowNumber": 20,
                "afterPatchRowNumber": 21,
                "PatchRowcode": " from toui.pages import Page"
            },
            "7": {
                "beforePatchRowNumber": 92,
                "afterPatchRowNumber": 93,
                "PatchRowcode": "             A list of added `Page` objects."
            },
            "8": {
                "beforePatchRowNumber": 93,
                "afterPatchRowNumber": 94,
                "PatchRowcode": " "
            },
            "9": {
                "beforePatchRowNumber": 94,
                "afterPatchRowNumber": 95,
                "PatchRowcode": " "
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 96,
                "PatchRowcode": "+        Warning"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 97,
                "PatchRowcode": "+        -------"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 98,
                "PatchRowcode": "+        A folder called 'flask_session' will be created in the main directory when calling this class."
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 99,
                "PatchRowcode": "+"
            },
            "14": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 100,
                "PatchRowcode": "+"
            },
            "15": {
                "beforePatchRowNumber": 95,
                "afterPatchRowNumber": 101,
                "PatchRowcode": "         .. admonition:: Behind The Scenes"
            },
            "16": {
                "beforePatchRowNumber": 96,
                "afterPatchRowNumber": 102,
                "PatchRowcode": "             :class: tip"
            },
            "17": {
                "beforePatchRowNumber": 97,
                "afterPatchRowNumber": 103,
                "PatchRowcode": "             "
            },
            "18": {
                "beforePatchRowNumber": 98,
                "afterPatchRowNumber": 104,
                "PatchRowcode": "             ToUI uses `Flask` and its extenstions to create apps. When creating an instance of this class, the following"
            },
            "19": {
                "beforePatchRowNumber": 99,
                "afterPatchRowNumber": 105,
                "PatchRowcode": "             extensions are used:"
            },
            "20": {
                "beforePatchRowNumber": 100,
                "afterPatchRowNumber": 106,
                "PatchRowcode": " "
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 107,
                "PatchRowcode": "+            - `Session` class extension from `Flask-Session` package."
            },
            "22": {
                "beforePatchRowNumber": 101,
                "afterPatchRowNumber": 108,
                "PatchRowcode": "             - `Sock` class extension from `Flask-Sock` package."
            },
            "23": {
                "beforePatchRowNumber": 102,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            - `Cache` class extension from `Flask-Cache` package."
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 109,
                "PatchRowcode": "+            - `Cache` class extension from `Flask-Caching` package."
            },
            "25": {
                "beforePatchRowNumber": 103,
                "afterPatchRowNumber": 110,
                "PatchRowcode": " "
            },
            "26": {
                "beforePatchRowNumber": 104,
                "afterPatchRowNumber": 111,
                "PatchRowcode": "             The following `Flask` configurations are also set:"
            },
            "27": {
                "beforePatchRowNumber": 105,
                "afterPatchRowNumber": 112,
                "PatchRowcode": " "
            },
            "28": {
                "beforePatchRowNumber": 106,
                "afterPatchRowNumber": 113,
                "PatchRowcode": "             - `CACHE_TYPE = \"SimpleCache\"`"
            },
            "29": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 114,
                "PatchRowcode": "+            - `SESSION_TYPE = \"filesystem\"`"
            },
            "30": {
                "beforePatchRowNumber": 107,
                "afterPatchRowNumber": 115,
                "PatchRowcode": " "
            },
            "31": {
                "beforePatchRowNumber": 108,
                "afterPatchRowNumber": 116,
                "PatchRowcode": "         \"\"\""
            },
            "32": {
                "beforePatchRowNumber": 109,
                "afterPatchRowNumber": 117,
                "PatchRowcode": "         self._functions = {}"
            },
            "33": {
                "beforePatchRowNumber": 123,
                "afterPatchRowNumber": 131,
                "PatchRowcode": "             warn(\"No secret key was set. Generating a random secret key for Flask.\")"
            },
            "34": {
                "beforePatchRowNumber": 124,
                "afterPatchRowNumber": 132,
                "PatchRowcode": "             self.flask_app.secret_key = os.urandom(50)"
            },
            "35": {
                "beforePatchRowNumber": 125,
                "afterPatchRowNumber": 133,
                "PatchRowcode": "         self.pages = []"
            },
            "36": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 134,
                "PatchRowcode": "+        self.flask_app.config['SESSION_TYPE'] = \"filesystem\""
            },
            "37": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 135,
                "PatchRowcode": "+        Session(self.flask_app)"
            },
            "38": {
                "beforePatchRowNumber": 126,
                "afterPatchRowNumber": 136,
                "PatchRowcode": "         self._add_communication_method()"
            },
            "39": {
                "beforePatchRowNumber": 127,
                "afterPatchRowNumber": 137,
                "PatchRowcode": "         self._add_user_vars()"
            },
            "40": {
                "beforePatchRowNumber": 128,
                "afterPatchRowNumber": 138,
                "PatchRowcode": "         self.flask_app.route(\"/toui-download-<path_id>\", methods=['POST', 'GET'])(self._download)"
            },
            "41": {
                "beforePatchRowNumber": 235,
                "afterPatchRowNumber": 245,
                "PatchRowcode": " "
            },
            "42": {
                "beforePatchRowNumber": 236,
                "afterPatchRowNumber": 246,
                "PatchRowcode": "         \"\"\""
            },
            "43": {
                "beforePatchRowNumber": 237,
                "afterPatchRowNumber": 247,
                "PatchRowcode": "         path_id = 0"
            },
            "44": {
                "beforePatchRowNumber": 238,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        while self._cache.get(f'toui-download-{path_id}'):"
            },
            "45": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 248,
                "PatchRowcode": "+        while self._user_vars._get(f'toui-download-{path_id}'):"
            },
            "46": {
                "beforePatchRowNumber": 239,
                "afterPatchRowNumber": 249,
                "PatchRowcode": "             path_id += 1"
            },
            "47": {
                "beforePatchRowNumber": 240,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self._cache.set(f'toui-download-{path_id}', filepath)"
            },
            "48": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 250,
                "PatchRowcode": "+        self._user_vars._set(f'toui-download-{path_id}', filepath)"
            },
            "49": {
                "beforePatchRowNumber": 241,
                "afterPatchRowNumber": 251,
                "PatchRowcode": "         self.open_new_page(f\"/toui-download-{path_id}\", new=new)"
            },
            "50": {
                "beforePatchRowNumber": 242,
                "afterPatchRowNumber": 252,
                "PatchRowcode": " "
            },
            "51": {
                "beforePatchRowNumber": 243,
                "afterPatchRowNumber": 253,
                "PatchRowcode": "     @_ReqsChecker(['flask-sqlalchemy', 'flask-login'])"
            },
            "52": {
                "beforePatchRowNumber": 400,
                "afterPatchRowNumber": 410,
                "PatchRowcode": "         user = self._user_cls.query.filter_by(username=username, password=password, **other_info).first()"
            },
            "53": {
                "beforePatchRowNumber": 401,
                "afterPatchRowNumber": 411,
                "PatchRowcode": "         if user:"
            },
            "54": {
                "beforePatchRowNumber": 402,
                "afterPatchRowNumber": 412,
                "PatchRowcode": "             login_user(user)"
            },
            "55": {
                "beforePatchRowNumber": 403,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            self._cache.set(\"user-id\", user.id)"
            },
            "56": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 413,
                "PatchRowcode": "+            self._user_vars._set(\"user-id\", user.id)"
            },
            "57": {
                "beforePatchRowNumber": 404,
                "afterPatchRowNumber": 414,
                "PatchRowcode": "             return True"
            },
            "58": {
                "beforePatchRowNumber": 405,
                "afterPatchRowNumber": 415,
                "PatchRowcode": "         else:"
            },
            "59": {
                "beforePatchRowNumber": 406,
                "afterPatchRowNumber": 416,
                "PatchRowcode": "             return False"
            },
            "60": {
                "beforePatchRowNumber": 427,
                "afterPatchRowNumber": 437,
                "PatchRowcode": "         user = self._user_cls.query.filter_by(id=user_id, **other_info).first()"
            },
            "61": {
                "beforePatchRowNumber": 428,
                "afterPatchRowNumber": 438,
                "PatchRowcode": "         if user:"
            },
            "62": {
                "beforePatchRowNumber": 429,
                "afterPatchRowNumber": 439,
                "PatchRowcode": "             login_user(user)"
            },
            "63": {
                "beforePatchRowNumber": 430,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            self._cache.set(\"user-id\", user_id)"
            },
            "64": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 440,
                "PatchRowcode": "+            self._user_vars._set(\"user-id\", user_id)"
            },
            "65": {
                "beforePatchRowNumber": 431,
                "afterPatchRowNumber": 441,
                "PatchRowcode": "             return True"
            },
            "66": {
                "beforePatchRowNumber": 432,
                "afterPatchRowNumber": 442,
                "PatchRowcode": "         else:"
            },
            "67": {
                "beforePatchRowNumber": 433,
                "afterPatchRowNumber": 443,
                "PatchRowcode": "             return False"
            },
            "68": {
                "beforePatchRowNumber": 438,
                "afterPatchRowNumber": 448,
                "PatchRowcode": "         A method that signs out the current user."
            },
            "69": {
                "beforePatchRowNumber": 439,
                "afterPatchRowNumber": 449,
                "PatchRowcode": "         \"\"\""
            },
            "70": {
                "beforePatchRowNumber": 440,
                "afterPatchRowNumber": 450,
                "PatchRowcode": "         logout_user()"
            },
            "71": {
                "beforePatchRowNumber": 441,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self._cache.set('user-id', None)"
            },
            "72": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 451,
                "PatchRowcode": "+        self._user_vars._del('user-id')"
            },
            "73": {
                "beforePatchRowNumber": 442,
                "afterPatchRowNumber": 452,
                "PatchRowcode": " "
            },
            "74": {
                "beforePatchRowNumber": 443,
                "afterPatchRowNumber": 453,
                "PatchRowcode": "     @_ReqsChecker(['flask-sqlalchemy'])"
            },
            "75": {
                "beforePatchRowNumber": 444,
                "afterPatchRowNumber": 454,
                "PatchRowcode": "     def username_exists(self, username):"
            },
            "76": {
                "beforePatchRowNumber": 592,
                "afterPatchRowNumber": 602,
                "PatchRowcode": "         if not \"user page\" in session.keys():"
            },
            "77": {
                "beforePatchRowNumber": 593,
                "afterPatchRowNumber": 603,
                "PatchRowcode": "             session['user page'] = None"
            },
            "78": {
                "beforePatchRowNumber": 594,
                "afterPatchRowNumber": 604,
                "PatchRowcode": "         if not \"_user_id\" in session.keys():"
            },
            "79": {
                "beforePatchRowNumber": 595,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            user_id = self._cache.get('user-id')"
            },
            "80": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 605,
                "PatchRowcode": "+            user_id = self._user_vars._get('user-id')"
            },
            "81": {
                "beforePatchRowNumber": 596,
                "afterPatchRowNumber": 606,
                "PatchRowcode": "             if user_id:"
            },
            "82": {
                "beforePatchRowNumber": 597,
                "afterPatchRowNumber": 607,
                "PatchRowcode": "                 session['_user_id'] = user_id"
            },
            "83": {
                "beforePatchRowNumber": 598,
                "afterPatchRowNumber": 608,
                "PatchRowcode": "         return True"
            },
            "84": {
                "beforePatchRowNumber": 599,
                "afterPatchRowNumber": 609,
                "PatchRowcode": "     "
            },
            "85": {
                "beforePatchRowNumber": 600,
                "afterPatchRowNumber": 610,
                "PatchRowcode": "     def _download(self, path_id):"
            },
            "86": {
                "beforePatchRowNumber": 601,
                "afterPatchRowNumber": 611,
                "PatchRowcode": "         debug(f\"PATH: {path_id}\")"
            },
            "87": {
                "beforePatchRowNumber": 602,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        file_to_download = self._cache.get(f'toui-download-{path_id}')"
            },
            "88": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 612,
                "PatchRowcode": "+        file_to_download = self._user_vars._get(f'toui-download-{path_id}')"
            },
            "89": {
                "beforePatchRowNumber": 603,
                "afterPatchRowNumber": 613,
                "PatchRowcode": "         debug(f\"File to download: {file_to_download}\")"
            },
            "90": {
                "beforePatchRowNumber": 604,
                "afterPatchRowNumber": 614,
                "PatchRowcode": "         if file_to_download:"
            },
            "91": {
                "beforePatchRowNumber": 605,
                "afterPatchRowNumber": 615,
                "PatchRowcode": "             return send_file(file_to_download, as_attachment=True)"
            },
            "92": {
                "beforePatchRowNumber": 671,
                "afterPatchRowNumber": 681,
                "PatchRowcode": " "
            },
            "93": {
                "beforePatchRowNumber": 672,
                "afterPatchRowNumber": 682,
                "PatchRowcode": "     def __init__(self, cache) -> None:"
            },
            "94": {
                "beforePatchRowNumber": 673,
                "afterPatchRowNumber": 683,
                "PatchRowcode": "         self._cache = cache"
            },
            "95": {
                "beforePatchRowNumber": 674,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self._cache.set('toui-vars', {})"
            },
            "96": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 684,
                "PatchRowcode": "+        self._default_vars = {}"
            },
            "97": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 685,
                "PatchRowcode": "+"
            },
            "98": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 686,
                "PatchRowcode": "+    def _sid_check(self):"
            },
            "99": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 687,
                "PatchRowcode": "+        try:"
            },
            "100": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 688,
                "PatchRowcode": "+            session.keys()"
            },
            "101": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 689,
                "PatchRowcode": "+            session_exists = True"
            },
            "102": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 690,
                "PatchRowcode": "+        except:"
            },
            "103": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 691,
                "PatchRowcode": "+            session_exists = False"
            },
            "104": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 692,
                "PatchRowcode": "+        if session_exists:"
            },
            "105": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 693,
                "PatchRowcode": "+            user_dict = self._cache.get(session.sid)"
            },
            "106": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 694,
                "PatchRowcode": "+            if user_dict is None:"
            },
            "107": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 695,
                "PatchRowcode": "+                self._cache.set(session.sid, {\"toui-vars\": self._default_vars})"
            },
            "108": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 696,
                "PatchRowcode": "+            return session.sid"
            },
            "109": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 697,
                "PatchRowcode": "+"
            },
            "110": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 698,
                "PatchRowcode": "+    def _get_toui_vars(self):"
            },
            "111": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 699,
                "PatchRowcode": "+        sid = self._sid_check()"
            },
            "112": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 700,
                "PatchRowcode": "+        if sid:"
            },
            "113": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 701,
                "PatchRowcode": "+            return self._cache.get(sid)['toui-vars']"
            },
            "114": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 702,
                "PatchRowcode": "+        else:"
            },
            "115": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 703,
                "PatchRowcode": "+            return self._default_vars"
            },
            "116": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 704,
                "PatchRowcode": "+    "
            },
            "117": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 705,
                "PatchRowcode": "+    def _set_toui_vars(self, toui_vars):"
            },
            "118": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 706,
                "PatchRowcode": "+        sid = self._sid_check()"
            },
            "119": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 707,
                "PatchRowcode": "+        if sid:"
            },
            "120": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 708,
                "PatchRowcode": "+            self._cache.set(session.sid, {'toui-vars': toui_vars})"
            },
            "121": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 709,
                "PatchRowcode": "+        else:"
            },
            "122": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 710,
                "PatchRowcode": "+            self._default_vars = toui_vars"
            },
            "123": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 711,
                "PatchRowcode": "+"
            },
            "124": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 712,
                "PatchRowcode": "+    def _get(self, key):"
            },
            "125": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 713,
                "PatchRowcode": "+        self._sid_check()"
            },
            "126": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 714,
                "PatchRowcode": "+        return self._cache.get(session.sid).get(key)"
            },
            "127": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 715,
                "PatchRowcode": "+    "
            },
            "128": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 716,
                "PatchRowcode": "+    def _set(self, key, value):"
            },
            "129": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 717,
                "PatchRowcode": "+        \"\"\"Avoid key='toui-vars'\"\"\""
            },
            "130": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 718,
                "PatchRowcode": "+        self._sid_check()"
            },
            "131": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 719,
                "PatchRowcode": "+        sid_dict = self._cache.get(session.sid)"
            },
            "132": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 720,
                "PatchRowcode": "+        sid_dict[key] = value"
            },
            "133": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 721,
                "PatchRowcode": "+        self._cache.set(session.sid, sid_dict)"
            },
            "134": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 722,
                "PatchRowcode": "+"
            },
            "135": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 723,
                "PatchRowcode": "+    def _del(self, key):"
            },
            "136": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 724,
                "PatchRowcode": "+        self._sid_check()"
            },
            "137": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 725,
                "PatchRowcode": "+        sid_dict = self._cache.get(session.sid)"
            },
            "138": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 726,
                "PatchRowcode": "+        del sid_dict[key]"
            },
            "139": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 727,
                "PatchRowcode": "+        self._cache.set(session.sid, sid_dict)"
            },
            "140": {
                "beforePatchRowNumber": 675,
                "afterPatchRowNumber": 728,
                "PatchRowcode": " "
            },
            "141": {
                "beforePatchRowNumber": 676,
                "afterPatchRowNumber": 729,
                "PatchRowcode": "     def __getitem__(self, key):"
            },
            "142": {
                "beforePatchRowNumber": 677,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        return self._cache.get('toui-vars')[key]"
            },
            "143": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 730,
                "PatchRowcode": "+        return self._get_toui_vars()[key]"
            },
            "144": {
                "beforePatchRowNumber": 678,
                "afterPatchRowNumber": 731,
                "PatchRowcode": "     "
            },
            "145": {
                "beforePatchRowNumber": 679,
                "afterPatchRowNumber": 732,
                "PatchRowcode": "     def __setitem__(self, key, value):"
            },
            "146": {
                "beforePatchRowNumber": 680,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        toui_vars = self._cache.get('toui-vars')"
            },
            "147": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 733,
                "PatchRowcode": "+        toui_vars = self._get_toui_vars()"
            },
            "148": {
                "beforePatchRowNumber": 681,
                "afterPatchRowNumber": 734,
                "PatchRowcode": "         toui_vars[key] = value"
            },
            "149": {
                "beforePatchRowNumber": 682,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self._cache.set('toui-vars', toui_vars)"
            },
            "150": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 735,
                "PatchRowcode": "+        self._set_toui_vars(toui_vars)"
            },
            "151": {
                "beforePatchRowNumber": 683,
                "afterPatchRowNumber": 736,
                "PatchRowcode": " "
            },
            "152": {
                "beforePatchRowNumber": 684,
                "afterPatchRowNumber": 737,
                "PatchRowcode": "     def __delitem__(self, key: Any) -> None:"
            },
            "153": {
                "beforePatchRowNumber": 685,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        toui_vars = self._cache.get('toui-vars')"
            },
            "154": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 738,
                "PatchRowcode": "+        toui_vars = self._get_toui_vars()"
            },
            "155": {
                "beforePatchRowNumber": 686,
                "afterPatchRowNumber": 739,
                "PatchRowcode": "         del toui_vars[key]"
            },
            "156": {
                "beforePatchRowNumber": 687,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self._cache.set('toui-vars', toui_vars)"
            },
            "157": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 740,
                "PatchRowcode": "+        self._set_toui_vars(toui_vars)"
            },
            "158": {
                "beforePatchRowNumber": 688,
                "afterPatchRowNumber": 741,
                "PatchRowcode": " "
            },
            "159": {
                "beforePatchRowNumber": 689,
                "afterPatchRowNumber": 742,
                "PatchRowcode": "     def __iter__(self):"
            },
            "160": {
                "beforePatchRowNumber": 690,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        for key in self._cache.get('toui-vars'):"
            },
            "161": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 743,
                "PatchRowcode": "+        for key in self._get_toui_vars():"
            },
            "162": {
                "beforePatchRowNumber": 691,
                "afterPatchRowNumber": 744,
                "PatchRowcode": "             yield key"
            },
            "163": {
                "beforePatchRowNumber": 692,
                "afterPatchRowNumber": 745,
                "PatchRowcode": " "
            },
            "164": {
                "beforePatchRowNumber": 693,
                "afterPatchRowNumber": 746,
                "PatchRowcode": "     def __len__(self) -> int:"
            },
            "165": {
                "beforePatchRowNumber": 694,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        return len(self._cache.get('toui-vars'))"
            },
            "166": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 747,
                "PatchRowcode": "+        return len(self._get_toui_vars())"
            },
            "167": {
                "beforePatchRowNumber": 695,
                "afterPatchRowNumber": 748,
                "PatchRowcode": "     "
            },
            "168": {
                "beforePatchRowNumber": 696,
                "afterPatchRowNumber": 749,
                "PatchRowcode": "     def __getattr__(self, name: str) -> Any:"
            },
            "169": {
                "beforePatchRowNumber": 697,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        return getattr(self._cache.get('toui-vars'), name)"
            },
            "170": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 750,
                "PatchRowcode": "+        return getattr(self._get_toui_vars(), name)"
            },
            "171": {
                "beforePatchRowNumber": 698,
                "afterPatchRowNumber": 751,
                "PatchRowcode": "     "
            },
            "172": {
                "beforePatchRowNumber": 699,
                "afterPatchRowNumber": 752,
                "PatchRowcode": "     def __repr__(self) -> str:"
            },
            "173": {
                "beforePatchRowNumber": 700,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        return repr(self._cache.get('toui-vars'))"
            },
            "174": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 753,
                "PatchRowcode": "+        return repr(self._get_toui_vars())"
            },
            "175": {
                "beforePatchRowNumber": 701,
                "afterPatchRowNumber": 754,
                "PatchRowcode": "     "
            },
            "176": {
                "beforePatchRowNumber": 702,
                "afterPatchRowNumber": 755,
                "PatchRowcode": " "
            },
            "177": {
                "beforePatchRowNumber": 703,
                "afterPatchRowNumber": 756,
                "PatchRowcode": " class Website(_App):"
            }
        },
        "frontPatchFile": [
            "\"\"\"",
            "A module that creates web apps and desktop apps.",
            "\"\"\"",
            "import __main__",
            "import threading",
            "import json",
            "import inspect",
            "import time",
            "import os",
            "from copy import copy",
            "from abc import ABCMeta, abstractmethod",
            "from collections.abc import MutableMapping",
            "from functools import wraps",
            "from typing import Any",
            "from flask import Flask, session, request, send_file",
            "from flask_sock import Sock",
            "from flask_caching import Cache",
            "import webview",
            "from toui._helpers import warn, info, debug, error",
            "from toui.pages import Page",
            "from toui.exceptions import ToUIWrongPlaceException, ToUINotAddedError",
            "from toui._defaults import validate_ws, validate_data",
            "",
            "_imported_optional_reqs = {'flask-login':False,",
            "                          'flask-sqlalchemy':False,",
            "                          'flask-basicauth':False}",
            "",
            "try:",
            "    from flask_login import LoginManager, UserMixin, current_user, login_user, logout_user, AnonymousUserMixin",
            "    _imported_optional_reqs['flask-login'] = True",
            "except ModuleNotFoundError: pass",
            "",
            "try:",
            "    from flask_sqlalchemy import SQLAlchemy",
            "    _imported_optional_reqs['flask-sqlalchemy'] = True",
            "except ModuleNotFoundError: pass",
            "",
            "try:",
            "    from flask_basicauth import BasicAuth",
            "    _imported_optional_reqs['flask-basicauth'] = True",
            "except ModuleNotFoundError: pass",
            "",
            "",
            "class _ReqsChecker:",
            "",
            "    def __init__(self, reqs) -> None:",
            "        self.reqs = reqs",
            "",
            "    def __call__(self, func) -> Any:",
            "        @wraps(func)",
            "        def new_func(*args, **kwargs):",
            "            for req in self.reqs:",
            "                if _imported_optional_reqs[req]:",
            "                    return func(*args, **kwargs)",
            "                else:",
            "                    raise ModuleNotFoundError(f\"You have not installed the optional package `{req}` yet, to install it run:\\n\\tpip install {req}\")",
            "        return new_func",
            "",
            "",
            "class _App(metaclass=ABCMeta):",
            "    \"\"\"The base class for DesktopApp and Website\"\"\"",
            "",
            "    def __init__(self, name=None, assets_folder=None, secret_key=None):",
            "        \"\"\"",
            "",
            "        Parameters",
            "        ----------",
            "        name: str (optional)",
            "            The name of the app.",
            "",
            "        assets_folder: str (optional)",
            "            The path to the folder that contains the HTML files and other assets.",
            "",
            "        secret_key: str (optional)",
            "            Sets the `secret_key` attribute for `flask.Flask`. You can also set the environment variable SECRET_KEY from",
            "            the command line and ToUI will get it using `os.environ`.",
            "",
            "            ",
            "        Attributes",
            "        ----------",
            "        flask_app: Flask",
            "            ToUI creates applications using `Flask`. You can access the `Flask` object using the attribute `flask_app`.",
            "",
            "        forbidden_urls: list",
            "            These are URLs that ToUI does not allow the user to use because ToUI uses them.",
            "",
            "        user_vars: dict",
            "            A dictionary that stores temporary data unique to each user. The data are stored in a `Cache` object from `flask-caching`",
            "            package.",
            "",
            "        pages: list",
            "            A list of added `Page` objects.",
            "",
            "",
            "        .. admonition:: Behind The Scenes",
            "            :class: tip",
            "            ",
            "            ToUI uses `Flask` and its extenstions to create apps. When creating an instance of this class, the following",
            "            extensions are used:",
            "",
            "            - `Sock` class extension from `Flask-Sock` package.",
            "            - `Cache` class extension from `Flask-Cache` package.",
            "",
            "            The following `Flask` configurations are also set:",
            "",
            "            - `CACHE_TYPE = \"SimpleCache\"`",
            "",
            "        \"\"\"",
            "        self._functions = {}",
            "        if not name:",
            "            if hasattr(__main__, \"__file__\"):",
            "                name = os.path.basename(__main__.__file__).split(\".\")[0]",
            "            else:",
            "                name = \"app\"",
            "        if not assets_folder:",
            "            assets_folder = \"/\"",
            "        self.flask_app = Flask(name, static_folder=assets_folder, static_url_path=\"/\")",
            "        if secret_key is not None:",
            "            self.flask_app.secret_key = secret_key",
            "        elif os.environ.get('SECRET_KEY') is not None:",
            "            self.flask_app.secret_key = os.environ.get('SECRET_KEY')",
            "        else:",
            "            warn(\"No secret key was set. Generating a random secret key for Flask.\")",
            "            self.flask_app.secret_key = os.urandom(50)",
            "        self.pages = []",
            "        self._add_communication_method()",
            "        self._add_user_vars()",
            "        self.flask_app.route(\"/toui-download-<path_id>\", methods=['POST', 'GET'])(self._download)",
            "        self.forbidden_urls = ['/toui-communicate', \"/toui-download-<path_id>\"]",
            "        self._validate_ws = validate_ws",
            "        self._validate_data = validate_data",
            "        self._auth = None",
            "        self._user_cls = None",
            "",
            "    @abstractmethod",
            "    def run(self): pass",
            "",
            "    def add_pages(self, *pages, do_copy=False, blueprint=None, endpoint=None):",
            "        \"\"\"",
            "        Adds pages to the app.",
            "",
            "        Parameters",
            "        ----------",
            "        pages: list(Page)",
            "            List of `Page` objects.",
            "",
            "        do_copy: bool, default = False",
            "            If ``True``, the `Page` will be copied before adding to the app.",
            "",
            "        blueprint: toui.structure.ToUIBlueprint, flask.Blueprint, default = None",
            "            If a `flask.Blueprint` or a `ToUIBlueprint` was added, the `Page` view_func will be added",
            "            to the blueprint instead of the `Flask` app.",
            "",
            "        endpoint",
            "            `endpoint` parameter in `flask.Flask.route`. If ``None``, the endpoint will be set",
            "            as the unique id of the `Page`. The unique id is obtained through the ``id()``",
            "            function and converted to a string.",
            "            ",
            "        \"\"\"",
            "        for page in pages:",
            "            if page.url in self.forbidden_urls:",
            "                warn(f\"The URL '{page.url}' is not allowed and might cause errors.\")",
            "            if do_copy:",
            "                page = copy(page)",
            "            page._app = self",
            "            page._add_script()",
            "            self.pages.append(page)",
            "            view_func = page._view_func",
            "            if self._auth:",
            "                view_func = self._auth.required(view_func)",
            "            if not endpoint:",
            "                endpoint_ = str(id(page))",
            "            else:",
            "                endpoint_ = endpoint",
            "            if blueprint:",
            "                route = blueprint.route(page.url, methods=['GET', 'POST'], endpoint=endpoint_)(view_func)",
            "            else:",
            "                route = self.flask_app.route(page.url, methods=['GET', 'POST'], endpoint=endpoint_)(view_func)",
            "",
            "    def open_new_page(self, url, new=False):",
            "        \"\"\"",
            "        Opens another URL.",
            "",
            "        This function should only be called after the app starts running.",
            "",
            "        Parameters",
            "        ----------",
            "        url: str",
            "            URL of the new page.",
            "",
            "        Returns",
            "        -------",
            "        None",
            "",
            "        \"\"\"",
            "        try:",
            "            session.keys()",
            "            self.get_user_page()._open_another_page(url, new=new)",
            "        except RuntimeError:",
            "            raise ToUIWrongPlaceException(f\"The function `open_new_page` should only be called after the app runs.\")",
            "",
            "    @staticmethod",
            "    def get_user_page() -> Page:",
            "        \"\"\"",
            "        A static method that returns the current `Page`.",
            "",
            "        This function should only be called after the app starts running.",
            "",
            "        Returns",
            "        -------",
            "        pg: Page",
            "",
            "        \"\"\"",
            "        try:",
            "            return session['user page']",
            "        except RuntimeError as e:",
            "            raise ToUIWrongPlaceException(f\"The function `get_user_page` should only be called after the app runs.\")",
            "",
            "    @property",
            "    def user_vars(self):",
            "        \"\"\"Gets user-specific variables.\"\"\"",
            "        return self._user_vars",
            "",
            "    def download(self, filepath, new=True):",
            "        \"\"\"",
            "        Downloads a file from the server to a client.",
            "        ",
            "        Parameters",
            "        ----------",
            "        filepath: str",
            "            The path to the file (on the server).",
            "",
            "        new: bool, default=True",
            "            Opens new tab/window when downloading file.",
            "",
            "        \"\"\"",
            "        path_id = 0",
            "        while self._cache.get(f'toui-download-{path_id}'):",
            "            path_id += 1",
            "        self._cache.set(f'toui-download-{path_id}', filepath)",
            "        self.open_new_page(f\"/toui-download-{path_id}\", new=new)",
            "",
            "    @_ReqsChecker(['flask-sqlalchemy', 'flask-login'])",
            "    def add_user_database(self, database_uri, other_columns=[], user_cls=None):",
            "        \"\"\"",
            "        Creates a simple database that has data specific to each user.",
            "",
            "        The database is a table that contains the following columns: `username`, `password`, and `id`. To add other columns,",
            "        add their names in `other_columns` list.",
            "",
            "        Parameters",
            "        ----------",
            "        database_uri: str",
            "            The URI of the database that you want to connect to.",
            "",
            "        other_columns: list",
            "            The names of table columns other than `username`, `password`, and `id`.",
            "",
            "        user_cls: Callable, default=None",
            "            If this parameter is ``None``, a table called `User` will be created. However, if this parameter was set, the",
            "            table `User` will not be created and the parameter `user_cls` will be used instead.",
            "",
            "",
            "        .. admonition:: Behind The Scenes",
            "            :class: tip",
            "            ",
            "            The following flask extensions are used when calling this function:",
            "",
            "            - `SQLAlchemy` class extension from `Flask-SQLAlchemy` package.",
            "            - `LoginManager` class extension from `Flask-Login` package.",
            "",
            "            The following `Flask` configurations are also set:",
            "",
            "            - `SQLALCHEMY_DATABASE_URI = database_uri`",
            "",
            "        \"\"\"",
            "        self.flask_app.config['SQLALCHEMY_DATABASE_URI'] = database_uri",
            "        self._db = SQLAlchemy(self.flask_app)",
            "        self._login_manager = LoginManager(self.flask_app)",
            "        self._load_user = self._login_manager.user_loader(self._load_user)",
            "        if not user_cls:",
            "            class User(UserMixin, self._db.Model):",
            "                __tablename__ = \"user\"",
            "",
            "                id = self._db.Column(self._db.Integer, primary_key=True)",
            "                username = self._db.Column(self._db.String, nullable=False, unique=True)",
            "                password = self._db.Column(self._db.String, nullable=False, unique=False)",
            "",
            "                def __repr__(self):",
            "                    return f'<User {self.username}>'",
            "            for col in other_columns:",
            "                setattr(User, col, self._db.Column(self._db.String))",
            "        else:",
            "            User = user_cls",
            "        self._user_cls = User",
            "        with self.flask_app.app_context():",
            "            self._db.create_all()",
            "",
            "    # Website-specific methods",
            "    @staticmethod",
            "    def get_request():",
            "        \"\"\"",
            "        A static method that gets data sent from client using HTTP request.",
            "",
            "        This method returns the `request` object of `Flask`. The `request` object has some useful attributes such as",
            "        `request.files` which retrieves uploaded files.",
            "",
            "        Examples",
            "        --------",
            "        To use this method, first create the app and a page:",
            "",
            "        >>> app = Website(__name__, secret_key=\"some key\")",
            "        >>> home_page = Page(html_str=\\\"\\\"\\\"<form method=\"post\" enctype=\"multipart/form-data\">",
            "        ...                              <input type=\"file\" name=\"filename\">",
            "        ...                              <input type=\"submit\">",
            "        ...                              </form>\\\"\\\"\\\", url=\"/\")",
            "",
            "        Then create a function that will be called when an HTTP request is made:",
            "",
            "        >>> def request_function():",
            "        ...     request = app.get_request()",
            "        ...     print(request.files)",
            "",
            "        Now add the function to `Page.on_url_request()` method:",
            "",
            "        >>> home_page.on_url_request(request_function)",
            "",
            "        Add the page to the app and run the app:",
            "",
            "        >>> app.add_pages(home_page)",
            "        >>> if __name__ == \"__main__\":",
            "        ...     app.run() # doctest: +SKIP",
            "",
            "        Returns",
            "        -------",
            "        flask.request",
            "",
            "        See Also",
            "        --------",
            "        flask.request",
            "            https://flask.palletsprojects.com/en/2.2.x/api/#flask.request",
            "",
            "        Page.on_url_request",
            "",
            "        \"\"\"",
            "        return request",
            "",
            "    @_ReqsChecker(['flask-sqlalchemy', 'flask-login'])",
            "    def signup_user(self, username, password, **other_info):",
            "        \"\"\"",
            "        Creates a new user in the database.",
            "        ",
            "        Parameters",
            "        ----------",
            "        username: str",
            "",
            "        password: str",
            "",
            "        other_info",
            "            Other information required for signing up.",
            "",
            "        Returns",
            "        -------",
            "        bool",
            "            ``True`` if the user is created, and ``False`` if it is not created.",
            "",
            "        \"\"\"",
            "        self._confirm_user_database_created()",
            "        if self.username_exists(username):",
            "            return False",
            "        new_user = self._user_cls(username=username, password=password, **other_info)",
            "        self._db.session.add(new_user)",
            "        self._db.session.commit()",
            "        if self.username_exists(username):",
            "            return True",
            "        else:",
            "            return False",
            "",
            "    @_ReqsChecker(['flask-sqlalchemy', 'flask-login'])",
            "    def signin_user(self, username, password, **other_info):",
            "        \"\"\"",
            "        Loads the data of a user from database.",
            "",
            "        Parameters",
            "        ----------",
            "        username: str",
            "",
            "        password: str",
            "",
            "        other_info",
            "            Other information required for signing in.",
            "",
            "        Returns",
            "        -------",
            "        bool",
            "            ``True`` if the user is signed in, and ``False`` if it is not signed in.",
            "",
            "        \"\"\"",
            "        self._confirm_user_database_created()",
            "        user = self._user_cls.query.filter_by(username=username, password=password, **other_info).first()",
            "        if user:",
            "            login_user(user)",
            "            self._cache.set(\"user-id\", user.id)",
            "            return True",
            "        else:",
            "            return False",
            "        ",
            "    @_ReqsChecker(['flask-sqlalchemy', 'flask-login'])",
            "    def signin_user_from_id(self, user_id, **other_info):",
            "        \"\"\"",
            "        Loads the data of a user from database using the user's ID.",
            "",
            "        Parameters",
            "        ----------",
            "        id: int",
            "",
            "        other_info",
            "            Other information required for signing in.",
            "",
            "        Returns",
            "        -------",
            "        bool",
            "            ``True`` if the user is signed in, and ``False`` if it is not signed in.",
            "",
            "        \"\"\"",
            "        self._confirm_user_database_created()",
            "        user = self._user_cls.query.filter_by(id=user_id, **other_info).first()",
            "        if user:",
            "            login_user(user)",
            "            self._cache.set(\"user-id\", user_id)",
            "            return True",
            "        else:",
            "            return False",
            "",
            "    @_ReqsChecker(['flask-login'])",
            "    def signout_user(self):",
            "        \"\"\"",
            "        A method that signs out the current user.",
            "        \"\"\"",
            "        logout_user()",
            "        self._cache.set('user-id', None)",
            "",
            "    @_ReqsChecker(['flask-sqlalchemy'])",
            "    def username_exists(self, username):",
            "        \"\"\"",
            "        Checks if the username is exists in the database.",
            "        ",
            "        Parameters",
            "        ----------",
            "        username: str",
            "        ",
            "        Returns",
            "        -------",
            "        bool",
            "            ``True`` if the username exists, otherwise ``False``.",
            "            \"\"\"",
            "        self._confirm_user_database_created()",
            "        if self._user_cls.query.filter_by(username=username).first():",
            "            info(f\"User {username} exists\")",
            "            return True",
            "        else:",
            "            return False",
            "",
            "    @staticmethod",
            "    @_ReqsChecker(['flask-login'])",
            "    def get_current_user():",
            "        \"\"\"",
            "        A static method that returns the current user.",
            "        \"\"\"",
            "        if isinstance(current_user, AnonymousUserMixin):",
            "            return None",
            "        else:",
            "            return current_user",
            "",
            "    @_ReqsChecker(['flask-basicauth'])",
            "    def add_restriction(self, username, password):",
            "        \"\"\"",
            "        Makes the app private.",
            "",
            "        Adds a username and password to the app.",
            "",
            "        Parameters",
            "        ----------",
            "        username: str",
            "",
            "        password: str",
            "",
            "",
            "        .. admonition:: Behind The Scenes",
            "            :class: tip",
            "            ",
            "            When calling this method, the following `Flask` extension is used:",
            "",
            "            - `BasicAuth` class extension from `Flask-BasicAuth` package.",
            "",
            "            The following `Flask` configurations are also set:",
            "",
            "            - `BASIC_AUTH_USERNAME = username`",
            "            - `BASIC_AUTH_PASSWORD = password`",
            "",
            "        \"\"\"",
            "        self._auth = BasicAuth(self.flask_app)",
            "        self.flask_app.config['BASIC_AUTH_USERNAME'] = username",
            "        self.flask_app.config['BASIC_AUTH_PASSWORD'] = password",
            "",
            "    def set_ws_validation(self, func):",
            "        \"\"\"",
            "        Validate `simple_websocket.ws.Server` object before sending and accepting data.",
            "",
            "        ToUI uses Flask-Sock for websocket communication. Flask-Sock generates a",
            "        `simple_websocket.ws.Server` object when a connection is established. If you",
            "        wanted to access this object before sending and receiving data, input a function",
            "        that has one argument `ws`. This function should either return ``True`` or ``False``.",
            "        If the function returns ``False``, no data will be sent or received using ToUI with",
            "        the client.",
            "",
            "        Parameters",
            "        ----------",
            "        func: Callable",
            "            A function that validates the Server object. It should have one argument `ws` and",
            "            should either return ``True`` or ``False``.",
            "",
            "        See Also",
            "        --------",
            "        flask_sock",
            "        simple_websockets",
            "",
            "        \"\"\"",
            "        self._validate_ws = func",
            "",
            "    def set_data_validation(self, func):",
            "        \"\"\"",
            "        Validate data received from JavaScript before using it.",
            "",
            "        ToUI receives data from JavaScript in the form of a JSON object. To validate this data",
            "        before allowing ToUI to use it, input a function that checks the data. This function",
            "        should have one argument `data` and should either return ``True`` or ``False``.",
            "        If the function returns ``False``, the data will not be used by ToUI.",
            "",
            "        You can check the structures of the data received from JavaScript in",
            "        https://toui.readthedocs.io/en/latest/how_it_works.html#instructions-sent-and-received.",
            "        Note that the structures of the JSON objects might change in future versions of ToUI.",
            "",
            "        Parameters",
            "        ----------",
            "        func: Callable",
            "            A function that validates data received from JavaScript. It should have one argument",
            "            `data` and should either return ``True`` or ``False``.",
            "",
            "        See Also",
            "        --------",
            "        set_ws_validation",
            "",
            "        \"\"\"",
            "        self._validate_data = func",
            "",
            "    def register_toui_blueprint(self, blueprint, **options):",
            "        \"\"\"",
            "        Registers a `ToUIBlueprint` object. It is similar to `Flask.register_blueprint`.",
            "",
            "        Parameters",
            "        ----------",
            "        blueprint: toui.structure.ToUIBlueprint",
            "",
            "        options",
            "            Same as `Flask.register_blueprint` `options` parameter.",
            "",
            "        See Also",
            "        --------",
            "        toui.structure.ToUIBlueprint",
            "        flask.Blueprint",
            "",
            "        \"\"\"",
            "        self.add_pages(*blueprint.pages, blueprint=blueprint)",
            "        self.flask_app.register_blueprint(blueprint=blueprint, **options)",
            "",
            "    def _add_communication_method(self):",
            "        self._socket = Sock(self.flask_app)",
            "        self._socket.route(\"/toui-communicate\")(self._communicate)",
            "",
            "    def _add_user_vars(self):",
            "        self.flask_app.config[\"CACHE_TYPE\"] = \"SimpleCache\"",
            "        self._cache = Cache(self.flask_app)",
            "        self._user_vars = _UserVars(self._cache)",
            "",
            "    def _session_check(self):",
            "        \"\"\"This is a private function.\"\"\"",
            "        try:",
            "            session.keys()",
            "        except RuntimeError as e:",
            "            return False",
            "        if not \"user page\" in session.keys():",
            "            session['user page'] = None",
            "        if not \"_user_id\" in session.keys():",
            "            user_id = self._cache.get('user-id')",
            "            if user_id:",
            "                session['_user_id'] = user_id",
            "        return True",
            "    ",
            "    def _download(self, path_id):",
            "        debug(f\"PATH: {path_id}\")",
            "        file_to_download = self._cache.get(f'toui-download-{path_id}')",
            "        debug(f\"File to download: {file_to_download}\")",
            "        if file_to_download:",
            "            return send_file(file_to_download, as_attachment=True)",
            "",
            "    def _communicate(self, ws):",
            "        \"\"\"This is a private function.\"\"\"",
            "        validation = self._validate_ws(ws)",
            "        if not validation:",
            "            info(\"WebSocket validation returns `False`. No data should be sent or received.\")",
            "            return",
            "        info(f'WebSocket connected: {ws.connected}')",
            "        while True:",
            "            data_from_js = ws.receive()",
            "            data_validation = self._validate_data(data_from_js)",
            "            if not data_validation:",
            "                info(\"Data validation returns `False`. The data will not be used.\")",
            "                continue",
            "            s = time.time()",
            "            self._session_check()",
            "            data_dict = json.loads(data_from_js)",
            "            func = data_dict['func']",
            "            args = data_dict['args']",
            "            url = data_dict['url']",
            "            new_html = data_dict['html']",
            "            new_page = Page(url=url)",
            "            new_page.from_str(new_html)",
            "            new_page._app = self",
            "            new_page._signal_mode = True",
            "            new_page._ws = ws",
            "            new_page._inherit_functions()",
            "            selector_to_element = data_dict['selector-to-element']",
            "            if selector_to_element:",
            "                for index, arg in enumerate(args):",
            "                    if type(arg) is dict:",
            "                        if arg.get('type') == \"element\":",
            "                            args[index] = new_page.get_element_from_selector(arg['selector'])",
            "            if \"uid\" in data_dict:",
            "                new_page._uid = data_dict['uid']",
            "            session['user page'] = new_page",
            "            try:",
            "                if new_page._func_exists(func):",
            "                    new_page._call_func(func, *args)",
            "                del session['user page']",
            "            except Exception as e:",
            "                del session['user page']",
            "                raise e",
            "            e = time.time()",
            "            debug(f\"TIME: {e - s}s\")",
            "",
            "    def _confirm_user_database_created(self):",
            "        if self._user_cls is None:",
            "            raise ToUINotAddedError(\"You have not created the user database yet. To create it, call the method: `add_user_database`.\")",
            "",
            "    def _load_user(self, user_id):",
            "        return self._user_cls.query.filter_by(id=int(user_id)).first()",
            "",
            "",
            "class _FuncWithPage:",
            "    \"\"\"Currently this class is unused, but it might be used later.\"\"\"",
            "    def __init__(self, func, page):",
            "        self.func = func",
            "        self.page = page",
            "    def __call__(self, *args, **kwargs):",
            "        return self.func(*args, **kwargs)",
            "",
            "",
            "class _UserVars(MutableMapping):",
            "    \"\"\"User-specific variables\"\"\"",
            "",
            "    def __init__(self, cache) -> None:",
            "        self._cache = cache",
            "        self._cache.set('toui-vars', {})",
            "",
            "    def __getitem__(self, key):",
            "        return self._cache.get('toui-vars')[key]",
            "    ",
            "    def __setitem__(self, key, value):",
            "        toui_vars = self._cache.get('toui-vars')",
            "        toui_vars[key] = value",
            "        self._cache.set('toui-vars', toui_vars)",
            "",
            "    def __delitem__(self, key: Any) -> None:",
            "        toui_vars = self._cache.get('toui-vars')",
            "        del toui_vars[key]",
            "        self._cache.set('toui-vars', toui_vars)",
            "",
            "    def __iter__(self):",
            "        for key in self._cache.get('toui-vars'):",
            "            yield key",
            "",
            "    def __len__(self) -> int:",
            "        return len(self._cache.get('toui-vars'))",
            "    ",
            "    def __getattr__(self, name: str) -> Any:",
            "        return getattr(self._cache.get('toui-vars'), name)",
            "    ",
            "    def __repr__(self) -> str:",
            "        return repr(self._cache.get('toui-vars'))",
            "    ",
            "",
            "class Website(_App):",
            "    \"\"\"",
            "    A class that creates a web application from HTML files.",
            "",
            "    Examples",
            "    --------",
            "",
            "    Creating a web app:",
            "",
            "    >>> from toui import Website",
            "    >>> app = Website(__name__, secret_key=\"some key\")",
            "",
            "    Creating a page and adding it to the app:",
            "",
            "    >>> from toui import Page",
            "    >>> home_page = Page(html_str=\"<h1>This is the home page</h1>\")",
            "    >>> app.add_pages(home_page)",
            "",
            "    Running the app:",
            "",
            "    >>> if __name__ == \"__main__\":",
            "    ...     app.run(debug=True) # doctest: +SKIP",
            "",
            "    See Also",
            "    --------",
            "    :py:class:`toui.pages.Page`",
            "    :py:class:`DesktopApp`",
            "",
            "    \"\"\"",
            "",
            "    @wraps(Flask.run)",
            "    def run(self, *args, **kwargs):",
            "        \"\"\"",
            "        Runs the app. It calls the function `flask.Flask.run`. The arguments will be passed to",
            "        `flask.Flask.run` function.",
            "",
            "        Parameters",
            "        ----------",
            "        args: Any",
            "",
            "        kwargs: Any",
            "",
            "        \"\"\"",
            "        self.flask_app.run(*args, **kwargs)",
            "",
            "",
            "class DesktopApp(_App):",
            "    \"\"\"",
            "    A class that creates a desktop application from HTML files.",
            "",
            "",
            "    Examples",
            "    --------",
            "",
            "    Creating a desktop app:",
            "",
            "    >>> from toui import DesktopApp",
            "    >>> app = DesktopApp(\"MyApp\")",
            "",
            "    Creating a page and adding it to the app:",
            "",
            "    >>> from toui import Page",
            "    >>> home_page = Page(html_str=\"<h1>This is the home page</h1>\")",
            "    >>> app.add_pages(home_page)",
            "",
            "    Running the app:",
            "",
            "    >>> if __name__ == \"__main__\":",
            "    ...     app.run() # doctest: +SKIP",
            "",
            "    See Also",
            "    --------",
            "    :py:class:`toui.pages.Page`",
            "    :py:class:`Website`",
            "",
            "    \"\"\"",
            "    def _run_server(self):",
            "        self.flask_app.run(port=self._port, use_reloader=False)",
            "",
            "    @wraps(webview.start)",
            "    def run(self, *args, **kwargs):",
            "        \"\"\"",
            "        Runs the app. It calls the function `webview.start`. The arguments will be passed to",
            "        `webview.start` function.",
            "",
            "        Parameters",
            "        ----------",
            "        args: Any",
            "",
            "        kwargs: Any",
            "",
            "        \"\"\"",
            "        if len(self.pages) == 0:",
            "            raise Exception(\"Cannot run the app because no pages were added.\")",
            "        self._port = webview.http._get_random_port()",
            "        t = threading.Thread(target=self._run_server)",
            "        t.daemon = True",
            "        t.start()",
            "        self.pages[0]._create_window()",
            "        webview.start(*args, **kwargs)",
            "",
            "",
            "def quick_website(name=\"App\", html_file=None, html_str=None, url=\"/\", assets_folder=None, secret_key=None):",
            "    \"\"\"",
            "    Creates a web app and adds a single `Page` to it.",
            "",
            "    Parameters",
            "    ----------",
            "    name: str (optional)",
            "        The name of the app.",
            "",
            "    html_file: str (optional)",
            "        The path to the HTML file that will be used to create the `Page`.",
            "",
            "    html_str: str (optional)",
            "        The content of the `Page`.",
            "",
            "    url: str (optional)",
            "        The URL of the `Page`.",
            "",
            "    assets_folder: str (optional)",
            "        The path to the folder that contains the HTML file. If no HTML files are used,",
            "        you can ignore this parameter.",
            "",
            "    secret_key: str (optional)",
            "        Sets the `secret_key` attribute for `flask.Flask`",
            "",
            "    Returns",
            "    -------",
            "    Website",
            "",
            "    \"\"\"",
            "    app = Website(name=name, assets_folder=assets_folder, secret_key=secret_key)",
            "    page = Page(url=url, html_file=html_file, html_str=html_str)",
            "    app.add_pages(page)",
            "    return app",
            "",
            "",
            "def quick_desktop_app(name=\"App\", html_file=None, html_str=None, url=\"/\", assets_folder=None, secret_key=None):",
            "    \"\"\"",
            "    Creates a desktop app and adds a single `Page` to it.",
            "",
            "    Parameters",
            "    ----------",
            "    name: str (optional)",
            "        The name of the app.",
            "",
            "    html_file: str (optional)",
            "        The path to the HTML file that will be used to create the `Page`.",
            "",
            "    html_str: str (optional)",
            "        The content of the `Page`.",
            "",
            "    url: str (optional)",
            "        The URL of the `Page`.",
            "",
            "    assets_folder: str (optional)",
            "        The path to the folder that contains the HTML file. If no HTML files are used,",
            "        you can ignore this parameter.",
            "",
            "    Returns",
            "    -------",
            "    DesktopApp",
            "",
            "    \"\"\"",
            "    app = DesktopApp(name=name, assets_folder=assets_folder, secret_key=secret_key)",
            "    page = Page(url=url, html_file=html_file, html_str=html_str)",
            "    app.add_pages(page)",
            "    return app",
            "",
            "",
            "def set_global_app(app):",
            "    \"\"\"",
            "    Allows the app object to be shared across Python modules.",
            "",
            "    Examples",
            "    --------",
            "",
            "    Suppose you have two Python scripts, \"main.py\" and \"home_page.py\". In \"main.py\", you can create the app",
            "    and make it global:",
            "",
            "    >>> from toui import Website, set_global_app",
            "    >>> app = Website(__name__)",
            "    >>> set_global_app(app)",
            "",
            "    While in \"home_page.py\", you can get the shared app:",
            "",
            "    >>> from toui import get_global_app",
            "    >>> app = get_global_app()",
            "",
            "    \"\"\"",
            "    global _global_app",
            "    _global_app = app",
            "",
            "",
            "def get_global_app():",
            "    \"\"\"",
            "    Gets the shared app object.",
            "",
            "    See :py:meth:`set_global_app`.",
            "    \"\"\"",
            "    return _global_app",
            "",
            "",
            "if __name__ == \"__main__\":",
            "    import doctest",
            "    results = doctest.testmod()",
            "    print(results)"
        ],
        "afterPatchFile": [
            "\"\"\"",
            "A module that creates web apps and desktop apps.",
            "\"\"\"",
            "import __main__",
            "import threading",
            "import json",
            "import inspect",
            "import time",
            "import os",
            "from copy import copy",
            "from abc import ABCMeta, abstractmethod",
            "from collections.abc import MutableMapping",
            "from functools import wraps",
            "from typing import Any",
            "from flask import Flask, session, request, send_file",
            "from flask_sock import Sock",
            "from flask_caching import Cache",
            "from flask_session import Session",
            "import webview",
            "from toui._helpers import warn, info, debug, error",
            "from toui.pages import Page",
            "from toui.exceptions import ToUIWrongPlaceException, ToUINotAddedError",
            "from toui._defaults import validate_ws, validate_data",
            "",
            "_imported_optional_reqs = {'flask-login':False,",
            "                          'flask-sqlalchemy':False,",
            "                          'flask-basicauth':False}",
            "",
            "try:",
            "    from flask_login import LoginManager, UserMixin, current_user, login_user, logout_user, AnonymousUserMixin",
            "    _imported_optional_reqs['flask-login'] = True",
            "except ModuleNotFoundError: pass",
            "",
            "try:",
            "    from flask_sqlalchemy import SQLAlchemy",
            "    _imported_optional_reqs['flask-sqlalchemy'] = True",
            "except ModuleNotFoundError: pass",
            "",
            "try:",
            "    from flask_basicauth import BasicAuth",
            "    _imported_optional_reqs['flask-basicauth'] = True",
            "except ModuleNotFoundError: pass",
            "",
            "",
            "class _ReqsChecker:",
            "",
            "    def __init__(self, reqs) -> None:",
            "        self.reqs = reqs",
            "",
            "    def __call__(self, func) -> Any:",
            "        @wraps(func)",
            "        def new_func(*args, **kwargs):",
            "            for req in self.reqs:",
            "                if _imported_optional_reqs[req]:",
            "                    return func(*args, **kwargs)",
            "                else:",
            "                    raise ModuleNotFoundError(f\"You have not installed the optional package `{req}` yet, to install it run:\\n\\tpip install {req}\")",
            "        return new_func",
            "",
            "",
            "class _App(metaclass=ABCMeta):",
            "    \"\"\"The base class for DesktopApp and Website\"\"\"",
            "",
            "    def __init__(self, name=None, assets_folder=None, secret_key=None):",
            "        \"\"\"",
            "",
            "        Parameters",
            "        ----------",
            "        name: str (optional)",
            "            The name of the app.",
            "",
            "        assets_folder: str (optional)",
            "            The path to the folder that contains the HTML files and other assets.",
            "",
            "        secret_key: str (optional)",
            "            Sets the `secret_key` attribute for `flask.Flask`. You can also set the environment variable SECRET_KEY from",
            "            the command line and ToUI will get it using `os.environ`.",
            "",
            "            ",
            "        Attributes",
            "        ----------",
            "        flask_app: Flask",
            "            ToUI creates applications using `Flask`. You can access the `Flask` object using the attribute `flask_app`.",
            "",
            "        forbidden_urls: list",
            "            These are URLs that ToUI does not allow the user to use because ToUI uses them.",
            "",
            "        user_vars: dict",
            "            A dictionary that stores temporary data unique to each user. The data are stored in a `Cache` object from `flask-caching`",
            "            package.",
            "",
            "        pages: list",
            "            A list of added `Page` objects.",
            "",
            "",
            "        Warning",
            "        -------",
            "        A folder called 'flask_session' will be created in the main directory when calling this class.",
            "",
            "",
            "        .. admonition:: Behind The Scenes",
            "            :class: tip",
            "            ",
            "            ToUI uses `Flask` and its extenstions to create apps. When creating an instance of this class, the following",
            "            extensions are used:",
            "",
            "            - `Session` class extension from `Flask-Session` package.",
            "            - `Sock` class extension from `Flask-Sock` package.",
            "            - `Cache` class extension from `Flask-Caching` package.",
            "",
            "            The following `Flask` configurations are also set:",
            "",
            "            - `CACHE_TYPE = \"SimpleCache\"`",
            "            - `SESSION_TYPE = \"filesystem\"`",
            "",
            "        \"\"\"",
            "        self._functions = {}",
            "        if not name:",
            "            if hasattr(__main__, \"__file__\"):",
            "                name = os.path.basename(__main__.__file__).split(\".\")[0]",
            "            else:",
            "                name = \"app\"",
            "        if not assets_folder:",
            "            assets_folder = \"/\"",
            "        self.flask_app = Flask(name, static_folder=assets_folder, static_url_path=\"/\")",
            "        if secret_key is not None:",
            "            self.flask_app.secret_key = secret_key",
            "        elif os.environ.get('SECRET_KEY') is not None:",
            "            self.flask_app.secret_key = os.environ.get('SECRET_KEY')",
            "        else:",
            "            warn(\"No secret key was set. Generating a random secret key for Flask.\")",
            "            self.flask_app.secret_key = os.urandom(50)",
            "        self.pages = []",
            "        self.flask_app.config['SESSION_TYPE'] = \"filesystem\"",
            "        Session(self.flask_app)",
            "        self._add_communication_method()",
            "        self._add_user_vars()",
            "        self.flask_app.route(\"/toui-download-<path_id>\", methods=['POST', 'GET'])(self._download)",
            "        self.forbidden_urls = ['/toui-communicate', \"/toui-download-<path_id>\"]",
            "        self._validate_ws = validate_ws",
            "        self._validate_data = validate_data",
            "        self._auth = None",
            "        self._user_cls = None",
            "",
            "    @abstractmethod",
            "    def run(self): pass",
            "",
            "    def add_pages(self, *pages, do_copy=False, blueprint=None, endpoint=None):",
            "        \"\"\"",
            "        Adds pages to the app.",
            "",
            "        Parameters",
            "        ----------",
            "        pages: list(Page)",
            "            List of `Page` objects.",
            "",
            "        do_copy: bool, default = False",
            "            If ``True``, the `Page` will be copied before adding to the app.",
            "",
            "        blueprint: toui.structure.ToUIBlueprint, flask.Blueprint, default = None",
            "            If a `flask.Blueprint` or a `ToUIBlueprint` was added, the `Page` view_func will be added",
            "            to the blueprint instead of the `Flask` app.",
            "",
            "        endpoint",
            "            `endpoint` parameter in `flask.Flask.route`. If ``None``, the endpoint will be set",
            "            as the unique id of the `Page`. The unique id is obtained through the ``id()``",
            "            function and converted to a string.",
            "            ",
            "        \"\"\"",
            "        for page in pages:",
            "            if page.url in self.forbidden_urls:",
            "                warn(f\"The URL '{page.url}' is not allowed and might cause errors.\")",
            "            if do_copy:",
            "                page = copy(page)",
            "            page._app = self",
            "            page._add_script()",
            "            self.pages.append(page)",
            "            view_func = page._view_func",
            "            if self._auth:",
            "                view_func = self._auth.required(view_func)",
            "            if not endpoint:",
            "                endpoint_ = str(id(page))",
            "            else:",
            "                endpoint_ = endpoint",
            "            if blueprint:",
            "                route = blueprint.route(page.url, methods=['GET', 'POST'], endpoint=endpoint_)(view_func)",
            "            else:",
            "                route = self.flask_app.route(page.url, methods=['GET', 'POST'], endpoint=endpoint_)(view_func)",
            "",
            "    def open_new_page(self, url, new=False):",
            "        \"\"\"",
            "        Opens another URL.",
            "",
            "        This function should only be called after the app starts running.",
            "",
            "        Parameters",
            "        ----------",
            "        url: str",
            "            URL of the new page.",
            "",
            "        Returns",
            "        -------",
            "        None",
            "",
            "        \"\"\"",
            "        try:",
            "            session.keys()",
            "            self.get_user_page()._open_another_page(url, new=new)",
            "        except RuntimeError:",
            "            raise ToUIWrongPlaceException(f\"The function `open_new_page` should only be called after the app runs.\")",
            "",
            "    @staticmethod",
            "    def get_user_page() -> Page:",
            "        \"\"\"",
            "        A static method that returns the current `Page`.",
            "",
            "        This function should only be called after the app starts running.",
            "",
            "        Returns",
            "        -------",
            "        pg: Page",
            "",
            "        \"\"\"",
            "        try:",
            "            return session['user page']",
            "        except RuntimeError as e:",
            "            raise ToUIWrongPlaceException(f\"The function `get_user_page` should only be called after the app runs.\")",
            "",
            "    @property",
            "    def user_vars(self):",
            "        \"\"\"Gets user-specific variables.\"\"\"",
            "        return self._user_vars",
            "",
            "    def download(self, filepath, new=True):",
            "        \"\"\"",
            "        Downloads a file from the server to a client.",
            "        ",
            "        Parameters",
            "        ----------",
            "        filepath: str",
            "            The path to the file (on the server).",
            "",
            "        new: bool, default=True",
            "            Opens new tab/window when downloading file.",
            "",
            "        \"\"\"",
            "        path_id = 0",
            "        while self._user_vars._get(f'toui-download-{path_id}'):",
            "            path_id += 1",
            "        self._user_vars._set(f'toui-download-{path_id}', filepath)",
            "        self.open_new_page(f\"/toui-download-{path_id}\", new=new)",
            "",
            "    @_ReqsChecker(['flask-sqlalchemy', 'flask-login'])",
            "    def add_user_database(self, database_uri, other_columns=[], user_cls=None):",
            "        \"\"\"",
            "        Creates a simple database that has data specific to each user.",
            "",
            "        The database is a table that contains the following columns: `username`, `password`, and `id`. To add other columns,",
            "        add their names in `other_columns` list.",
            "",
            "        Parameters",
            "        ----------",
            "        database_uri: str",
            "            The URI of the database that you want to connect to.",
            "",
            "        other_columns: list",
            "            The names of table columns other than `username`, `password`, and `id`.",
            "",
            "        user_cls: Callable, default=None",
            "            If this parameter is ``None``, a table called `User` will be created. However, if this parameter was set, the",
            "            table `User` will not be created and the parameter `user_cls` will be used instead.",
            "",
            "",
            "        .. admonition:: Behind The Scenes",
            "            :class: tip",
            "            ",
            "            The following flask extensions are used when calling this function:",
            "",
            "            - `SQLAlchemy` class extension from `Flask-SQLAlchemy` package.",
            "            - `LoginManager` class extension from `Flask-Login` package.",
            "",
            "            The following `Flask` configurations are also set:",
            "",
            "            - `SQLALCHEMY_DATABASE_URI = database_uri`",
            "",
            "        \"\"\"",
            "        self.flask_app.config['SQLALCHEMY_DATABASE_URI'] = database_uri",
            "        self._db = SQLAlchemy(self.flask_app)",
            "        self._login_manager = LoginManager(self.flask_app)",
            "        self._load_user = self._login_manager.user_loader(self._load_user)",
            "        if not user_cls:",
            "            class User(UserMixin, self._db.Model):",
            "                __tablename__ = \"user\"",
            "",
            "                id = self._db.Column(self._db.Integer, primary_key=True)",
            "                username = self._db.Column(self._db.String, nullable=False, unique=True)",
            "                password = self._db.Column(self._db.String, nullable=False, unique=False)",
            "",
            "                def __repr__(self):",
            "                    return f'<User {self.username}>'",
            "            for col in other_columns:",
            "                setattr(User, col, self._db.Column(self._db.String))",
            "        else:",
            "            User = user_cls",
            "        self._user_cls = User",
            "        with self.flask_app.app_context():",
            "            self._db.create_all()",
            "",
            "    # Website-specific methods",
            "    @staticmethod",
            "    def get_request():",
            "        \"\"\"",
            "        A static method that gets data sent from client using HTTP request.",
            "",
            "        This method returns the `request` object of `Flask`. The `request` object has some useful attributes such as",
            "        `request.files` which retrieves uploaded files.",
            "",
            "        Examples",
            "        --------",
            "        To use this method, first create the app and a page:",
            "",
            "        >>> app = Website(__name__, secret_key=\"some key\")",
            "        >>> home_page = Page(html_str=\\\"\\\"\\\"<form method=\"post\" enctype=\"multipart/form-data\">",
            "        ...                              <input type=\"file\" name=\"filename\">",
            "        ...                              <input type=\"submit\">",
            "        ...                              </form>\\\"\\\"\\\", url=\"/\")",
            "",
            "        Then create a function that will be called when an HTTP request is made:",
            "",
            "        >>> def request_function():",
            "        ...     request = app.get_request()",
            "        ...     print(request.files)",
            "",
            "        Now add the function to `Page.on_url_request()` method:",
            "",
            "        >>> home_page.on_url_request(request_function)",
            "",
            "        Add the page to the app and run the app:",
            "",
            "        >>> app.add_pages(home_page)",
            "        >>> if __name__ == \"__main__\":",
            "        ...     app.run() # doctest: +SKIP",
            "",
            "        Returns",
            "        -------",
            "        flask.request",
            "",
            "        See Also",
            "        --------",
            "        flask.request",
            "            https://flask.palletsprojects.com/en/2.2.x/api/#flask.request",
            "",
            "        Page.on_url_request",
            "",
            "        \"\"\"",
            "        return request",
            "",
            "    @_ReqsChecker(['flask-sqlalchemy', 'flask-login'])",
            "    def signup_user(self, username, password, **other_info):",
            "        \"\"\"",
            "        Creates a new user in the database.",
            "        ",
            "        Parameters",
            "        ----------",
            "        username: str",
            "",
            "        password: str",
            "",
            "        other_info",
            "            Other information required for signing up.",
            "",
            "        Returns",
            "        -------",
            "        bool",
            "            ``True`` if the user is created, and ``False`` if it is not created.",
            "",
            "        \"\"\"",
            "        self._confirm_user_database_created()",
            "        if self.username_exists(username):",
            "            return False",
            "        new_user = self._user_cls(username=username, password=password, **other_info)",
            "        self._db.session.add(new_user)",
            "        self._db.session.commit()",
            "        if self.username_exists(username):",
            "            return True",
            "        else:",
            "            return False",
            "",
            "    @_ReqsChecker(['flask-sqlalchemy', 'flask-login'])",
            "    def signin_user(self, username, password, **other_info):",
            "        \"\"\"",
            "        Loads the data of a user from database.",
            "",
            "        Parameters",
            "        ----------",
            "        username: str",
            "",
            "        password: str",
            "",
            "        other_info",
            "            Other information required for signing in.",
            "",
            "        Returns",
            "        -------",
            "        bool",
            "            ``True`` if the user is signed in, and ``False`` if it is not signed in.",
            "",
            "        \"\"\"",
            "        self._confirm_user_database_created()",
            "        user = self._user_cls.query.filter_by(username=username, password=password, **other_info).first()",
            "        if user:",
            "            login_user(user)",
            "            self._user_vars._set(\"user-id\", user.id)",
            "            return True",
            "        else:",
            "            return False",
            "        ",
            "    @_ReqsChecker(['flask-sqlalchemy', 'flask-login'])",
            "    def signin_user_from_id(self, user_id, **other_info):",
            "        \"\"\"",
            "        Loads the data of a user from database using the user's ID.",
            "",
            "        Parameters",
            "        ----------",
            "        id: int",
            "",
            "        other_info",
            "            Other information required for signing in.",
            "",
            "        Returns",
            "        -------",
            "        bool",
            "            ``True`` if the user is signed in, and ``False`` if it is not signed in.",
            "",
            "        \"\"\"",
            "        self._confirm_user_database_created()",
            "        user = self._user_cls.query.filter_by(id=user_id, **other_info).first()",
            "        if user:",
            "            login_user(user)",
            "            self._user_vars._set(\"user-id\", user_id)",
            "            return True",
            "        else:",
            "            return False",
            "",
            "    @_ReqsChecker(['flask-login'])",
            "    def signout_user(self):",
            "        \"\"\"",
            "        A method that signs out the current user.",
            "        \"\"\"",
            "        logout_user()",
            "        self._user_vars._del('user-id')",
            "",
            "    @_ReqsChecker(['flask-sqlalchemy'])",
            "    def username_exists(self, username):",
            "        \"\"\"",
            "        Checks if the username is exists in the database.",
            "        ",
            "        Parameters",
            "        ----------",
            "        username: str",
            "        ",
            "        Returns",
            "        -------",
            "        bool",
            "            ``True`` if the username exists, otherwise ``False``.",
            "            \"\"\"",
            "        self._confirm_user_database_created()",
            "        if self._user_cls.query.filter_by(username=username).first():",
            "            info(f\"User {username} exists\")",
            "            return True",
            "        else:",
            "            return False",
            "",
            "    @staticmethod",
            "    @_ReqsChecker(['flask-login'])",
            "    def get_current_user():",
            "        \"\"\"",
            "        A static method that returns the current user.",
            "        \"\"\"",
            "        if isinstance(current_user, AnonymousUserMixin):",
            "            return None",
            "        else:",
            "            return current_user",
            "",
            "    @_ReqsChecker(['flask-basicauth'])",
            "    def add_restriction(self, username, password):",
            "        \"\"\"",
            "        Makes the app private.",
            "",
            "        Adds a username and password to the app.",
            "",
            "        Parameters",
            "        ----------",
            "        username: str",
            "",
            "        password: str",
            "",
            "",
            "        .. admonition:: Behind The Scenes",
            "            :class: tip",
            "            ",
            "            When calling this method, the following `Flask` extension is used:",
            "",
            "            - `BasicAuth` class extension from `Flask-BasicAuth` package.",
            "",
            "            The following `Flask` configurations are also set:",
            "",
            "            - `BASIC_AUTH_USERNAME = username`",
            "            - `BASIC_AUTH_PASSWORD = password`",
            "",
            "        \"\"\"",
            "        self._auth = BasicAuth(self.flask_app)",
            "        self.flask_app.config['BASIC_AUTH_USERNAME'] = username",
            "        self.flask_app.config['BASIC_AUTH_PASSWORD'] = password",
            "",
            "    def set_ws_validation(self, func):",
            "        \"\"\"",
            "        Validate `simple_websocket.ws.Server` object before sending and accepting data.",
            "",
            "        ToUI uses Flask-Sock for websocket communication. Flask-Sock generates a",
            "        `simple_websocket.ws.Server` object when a connection is established. If you",
            "        wanted to access this object before sending and receiving data, input a function",
            "        that has one argument `ws`. This function should either return ``True`` or ``False``.",
            "        If the function returns ``False``, no data will be sent or received using ToUI with",
            "        the client.",
            "",
            "        Parameters",
            "        ----------",
            "        func: Callable",
            "            A function that validates the Server object. It should have one argument `ws` and",
            "            should either return ``True`` or ``False``.",
            "",
            "        See Also",
            "        --------",
            "        flask_sock",
            "        simple_websockets",
            "",
            "        \"\"\"",
            "        self._validate_ws = func",
            "",
            "    def set_data_validation(self, func):",
            "        \"\"\"",
            "        Validate data received from JavaScript before using it.",
            "",
            "        ToUI receives data from JavaScript in the form of a JSON object. To validate this data",
            "        before allowing ToUI to use it, input a function that checks the data. This function",
            "        should have one argument `data` and should either return ``True`` or ``False``.",
            "        If the function returns ``False``, the data will not be used by ToUI.",
            "",
            "        You can check the structures of the data received from JavaScript in",
            "        https://toui.readthedocs.io/en/latest/how_it_works.html#instructions-sent-and-received.",
            "        Note that the structures of the JSON objects might change in future versions of ToUI.",
            "",
            "        Parameters",
            "        ----------",
            "        func: Callable",
            "            A function that validates data received from JavaScript. It should have one argument",
            "            `data` and should either return ``True`` or ``False``.",
            "",
            "        See Also",
            "        --------",
            "        set_ws_validation",
            "",
            "        \"\"\"",
            "        self._validate_data = func",
            "",
            "    def register_toui_blueprint(self, blueprint, **options):",
            "        \"\"\"",
            "        Registers a `ToUIBlueprint` object. It is similar to `Flask.register_blueprint`.",
            "",
            "        Parameters",
            "        ----------",
            "        blueprint: toui.structure.ToUIBlueprint",
            "",
            "        options",
            "            Same as `Flask.register_blueprint` `options` parameter.",
            "",
            "        See Also",
            "        --------",
            "        toui.structure.ToUIBlueprint",
            "        flask.Blueprint",
            "",
            "        \"\"\"",
            "        self.add_pages(*blueprint.pages, blueprint=blueprint)",
            "        self.flask_app.register_blueprint(blueprint=blueprint, **options)",
            "",
            "    def _add_communication_method(self):",
            "        self._socket = Sock(self.flask_app)",
            "        self._socket.route(\"/toui-communicate\")(self._communicate)",
            "",
            "    def _add_user_vars(self):",
            "        self.flask_app.config[\"CACHE_TYPE\"] = \"SimpleCache\"",
            "        self._cache = Cache(self.flask_app)",
            "        self._user_vars = _UserVars(self._cache)",
            "",
            "    def _session_check(self):",
            "        \"\"\"This is a private function.\"\"\"",
            "        try:",
            "            session.keys()",
            "        except RuntimeError as e:",
            "            return False",
            "        if not \"user page\" in session.keys():",
            "            session['user page'] = None",
            "        if not \"_user_id\" in session.keys():",
            "            user_id = self._user_vars._get('user-id')",
            "            if user_id:",
            "                session['_user_id'] = user_id",
            "        return True",
            "    ",
            "    def _download(self, path_id):",
            "        debug(f\"PATH: {path_id}\")",
            "        file_to_download = self._user_vars._get(f'toui-download-{path_id}')",
            "        debug(f\"File to download: {file_to_download}\")",
            "        if file_to_download:",
            "            return send_file(file_to_download, as_attachment=True)",
            "",
            "    def _communicate(self, ws):",
            "        \"\"\"This is a private function.\"\"\"",
            "        validation = self._validate_ws(ws)",
            "        if not validation:",
            "            info(\"WebSocket validation returns `False`. No data should be sent or received.\")",
            "            return",
            "        info(f'WebSocket connected: {ws.connected}')",
            "        while True:",
            "            data_from_js = ws.receive()",
            "            data_validation = self._validate_data(data_from_js)",
            "            if not data_validation:",
            "                info(\"Data validation returns `False`. The data will not be used.\")",
            "                continue",
            "            s = time.time()",
            "            self._session_check()",
            "            data_dict = json.loads(data_from_js)",
            "            func = data_dict['func']",
            "            args = data_dict['args']",
            "            url = data_dict['url']",
            "            new_html = data_dict['html']",
            "            new_page = Page(url=url)",
            "            new_page.from_str(new_html)",
            "            new_page._app = self",
            "            new_page._signal_mode = True",
            "            new_page._ws = ws",
            "            new_page._inherit_functions()",
            "            selector_to_element = data_dict['selector-to-element']",
            "            if selector_to_element:",
            "                for index, arg in enumerate(args):",
            "                    if type(arg) is dict:",
            "                        if arg.get('type') == \"element\":",
            "                            args[index] = new_page.get_element_from_selector(arg['selector'])",
            "            if \"uid\" in data_dict:",
            "                new_page._uid = data_dict['uid']",
            "            session['user page'] = new_page",
            "            try:",
            "                if new_page._func_exists(func):",
            "                    new_page._call_func(func, *args)",
            "                del session['user page']",
            "            except Exception as e:",
            "                del session['user page']",
            "                raise e",
            "            e = time.time()",
            "            debug(f\"TIME: {e - s}s\")",
            "",
            "    def _confirm_user_database_created(self):",
            "        if self._user_cls is None:",
            "            raise ToUINotAddedError(\"You have not created the user database yet. To create it, call the method: `add_user_database`.\")",
            "",
            "    def _load_user(self, user_id):",
            "        return self._user_cls.query.filter_by(id=int(user_id)).first()",
            "",
            "",
            "class _FuncWithPage:",
            "    \"\"\"Currently this class is unused, but it might be used later.\"\"\"",
            "    def __init__(self, func, page):",
            "        self.func = func",
            "        self.page = page",
            "    def __call__(self, *args, **kwargs):",
            "        return self.func(*args, **kwargs)",
            "",
            "",
            "class _UserVars(MutableMapping):",
            "    \"\"\"User-specific variables\"\"\"",
            "",
            "    def __init__(self, cache) -> None:",
            "        self._cache = cache",
            "        self._default_vars = {}",
            "",
            "    def _sid_check(self):",
            "        try:",
            "            session.keys()",
            "            session_exists = True",
            "        except:",
            "            session_exists = False",
            "        if session_exists:",
            "            user_dict = self._cache.get(session.sid)",
            "            if user_dict is None:",
            "                self._cache.set(session.sid, {\"toui-vars\": self._default_vars})",
            "            return session.sid",
            "",
            "    def _get_toui_vars(self):",
            "        sid = self._sid_check()",
            "        if sid:",
            "            return self._cache.get(sid)['toui-vars']",
            "        else:",
            "            return self._default_vars",
            "    ",
            "    def _set_toui_vars(self, toui_vars):",
            "        sid = self._sid_check()",
            "        if sid:",
            "            self._cache.set(session.sid, {'toui-vars': toui_vars})",
            "        else:",
            "            self._default_vars = toui_vars",
            "",
            "    def _get(self, key):",
            "        self._sid_check()",
            "        return self._cache.get(session.sid).get(key)",
            "    ",
            "    def _set(self, key, value):",
            "        \"\"\"Avoid key='toui-vars'\"\"\"",
            "        self._sid_check()",
            "        sid_dict = self._cache.get(session.sid)",
            "        sid_dict[key] = value",
            "        self._cache.set(session.sid, sid_dict)",
            "",
            "    def _del(self, key):",
            "        self._sid_check()",
            "        sid_dict = self._cache.get(session.sid)",
            "        del sid_dict[key]",
            "        self._cache.set(session.sid, sid_dict)",
            "",
            "    def __getitem__(self, key):",
            "        return self._get_toui_vars()[key]",
            "    ",
            "    def __setitem__(self, key, value):",
            "        toui_vars = self._get_toui_vars()",
            "        toui_vars[key] = value",
            "        self._set_toui_vars(toui_vars)",
            "",
            "    def __delitem__(self, key: Any) -> None:",
            "        toui_vars = self._get_toui_vars()",
            "        del toui_vars[key]",
            "        self._set_toui_vars(toui_vars)",
            "",
            "    def __iter__(self):",
            "        for key in self._get_toui_vars():",
            "            yield key",
            "",
            "    def __len__(self) -> int:",
            "        return len(self._get_toui_vars())",
            "    ",
            "    def __getattr__(self, name: str) -> Any:",
            "        return getattr(self._get_toui_vars(), name)",
            "    ",
            "    def __repr__(self) -> str:",
            "        return repr(self._get_toui_vars())",
            "    ",
            "",
            "class Website(_App):",
            "    \"\"\"",
            "    A class that creates a web application from HTML files.",
            "",
            "    Examples",
            "    --------",
            "",
            "    Creating a web app:",
            "",
            "    >>> from toui import Website",
            "    >>> app = Website(__name__, secret_key=\"some key\")",
            "",
            "    Creating a page and adding it to the app:",
            "",
            "    >>> from toui import Page",
            "    >>> home_page = Page(html_str=\"<h1>This is the home page</h1>\")",
            "    >>> app.add_pages(home_page)",
            "",
            "    Running the app:",
            "",
            "    >>> if __name__ == \"__main__\":",
            "    ...     app.run(debug=True) # doctest: +SKIP",
            "",
            "    See Also",
            "    --------",
            "    :py:class:`toui.pages.Page`",
            "    :py:class:`DesktopApp`",
            "",
            "    \"\"\"",
            "",
            "    @wraps(Flask.run)",
            "    def run(self, *args, **kwargs):",
            "        \"\"\"",
            "        Runs the app. It calls the function `flask.Flask.run`. The arguments will be passed to",
            "        `flask.Flask.run` function.",
            "",
            "        Parameters",
            "        ----------",
            "        args: Any",
            "",
            "        kwargs: Any",
            "",
            "        \"\"\"",
            "        self.flask_app.run(*args, **kwargs)",
            "",
            "",
            "class DesktopApp(_App):",
            "    \"\"\"",
            "    A class that creates a desktop application from HTML files.",
            "",
            "",
            "    Examples",
            "    --------",
            "",
            "    Creating a desktop app:",
            "",
            "    >>> from toui import DesktopApp",
            "    >>> app = DesktopApp(\"MyApp\")",
            "",
            "    Creating a page and adding it to the app:",
            "",
            "    >>> from toui import Page",
            "    >>> home_page = Page(html_str=\"<h1>This is the home page</h1>\")",
            "    >>> app.add_pages(home_page)",
            "",
            "    Running the app:",
            "",
            "    >>> if __name__ == \"__main__\":",
            "    ...     app.run() # doctest: +SKIP",
            "",
            "    See Also",
            "    --------",
            "    :py:class:`toui.pages.Page`",
            "    :py:class:`Website`",
            "",
            "    \"\"\"",
            "    def _run_server(self):",
            "        self.flask_app.run(port=self._port, use_reloader=False)",
            "",
            "    @wraps(webview.start)",
            "    def run(self, *args, **kwargs):",
            "        \"\"\"",
            "        Runs the app. It calls the function `webview.start`. The arguments will be passed to",
            "        `webview.start` function.",
            "",
            "        Parameters",
            "        ----------",
            "        args: Any",
            "",
            "        kwargs: Any",
            "",
            "        \"\"\"",
            "        if len(self.pages) == 0:",
            "            raise Exception(\"Cannot run the app because no pages were added.\")",
            "        self._port = webview.http._get_random_port()",
            "        t = threading.Thread(target=self._run_server)",
            "        t.daemon = True",
            "        t.start()",
            "        self.pages[0]._create_window()",
            "        webview.start(*args, **kwargs)",
            "",
            "",
            "def quick_website(name=\"App\", html_file=None, html_str=None, url=\"/\", assets_folder=None, secret_key=None):",
            "    \"\"\"",
            "    Creates a web app and adds a single `Page` to it.",
            "",
            "    Parameters",
            "    ----------",
            "    name: str (optional)",
            "        The name of the app.",
            "",
            "    html_file: str (optional)",
            "        The path to the HTML file that will be used to create the `Page`.",
            "",
            "    html_str: str (optional)",
            "        The content of the `Page`.",
            "",
            "    url: str (optional)",
            "        The URL of the `Page`.",
            "",
            "    assets_folder: str (optional)",
            "        The path to the folder that contains the HTML file. If no HTML files are used,",
            "        you can ignore this parameter.",
            "",
            "    secret_key: str (optional)",
            "        Sets the `secret_key` attribute for `flask.Flask`",
            "",
            "    Returns",
            "    -------",
            "    Website",
            "",
            "    \"\"\"",
            "    app = Website(name=name, assets_folder=assets_folder, secret_key=secret_key)",
            "    page = Page(url=url, html_file=html_file, html_str=html_str)",
            "    app.add_pages(page)",
            "    return app",
            "",
            "",
            "def quick_desktop_app(name=\"App\", html_file=None, html_str=None, url=\"/\", assets_folder=None, secret_key=None):",
            "    \"\"\"",
            "    Creates a desktop app and adds a single `Page` to it.",
            "",
            "    Parameters",
            "    ----------",
            "    name: str (optional)",
            "        The name of the app.",
            "",
            "    html_file: str (optional)",
            "        The path to the HTML file that will be used to create the `Page`.",
            "",
            "    html_str: str (optional)",
            "        The content of the `Page`.",
            "",
            "    url: str (optional)",
            "        The URL of the `Page`.",
            "",
            "    assets_folder: str (optional)",
            "        The path to the folder that contains the HTML file. If no HTML files are used,",
            "        you can ignore this parameter.",
            "",
            "    Returns",
            "    -------",
            "    DesktopApp",
            "",
            "    \"\"\"",
            "    app = DesktopApp(name=name, assets_folder=assets_folder, secret_key=secret_key)",
            "    page = Page(url=url, html_file=html_file, html_str=html_str)",
            "    app.add_pages(page)",
            "    return app",
            "",
            "",
            "def set_global_app(app):",
            "    \"\"\"",
            "    Allows the app object to be shared across Python modules.",
            "",
            "    Examples",
            "    --------",
            "",
            "    Suppose you have two Python scripts, \"main.py\" and \"home_page.py\". In \"main.py\", you can create the app",
            "    and make it global:",
            "",
            "    >>> from toui import Website, set_global_app",
            "    >>> app = Website(__name__)",
            "    >>> set_global_app(app)",
            "",
            "    While in \"home_page.py\", you can get the shared app:",
            "",
            "    >>> from toui import get_global_app",
            "    >>> app = get_global_app()",
            "",
            "    \"\"\"",
            "    global _global_app",
            "    _global_app = app",
            "",
            "",
            "def get_global_app():",
            "    \"\"\"",
            "    Gets the shared app object.",
            "",
            "    See :py:meth:`set_global_app`.",
            "    \"\"\"",
            "    return _global_app",
            "",
            "",
            "if __name__ == \"__main__\":",
            "    import doctest",
            "    results = doctest.testmod()",
            "    print(results)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "-1",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "2",
            "2",
            "0",
            "2",
            "2",
            "0",
            "0",
            "2",
            "2",
            "0",
            "2",
            "2",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "102": [
                "_App",
                "__init__"
            ],
            "238": [
                "_App",
                "download"
            ],
            "240": [
                "_App",
                "download"
            ],
            "403": [
                "_App",
                "signin_user"
            ],
            "430": [
                "_App",
                "signin_user_from_id"
            ],
            "441": [
                "_App",
                "signout_user"
            ],
            "595": [
                "_App",
                "_session_check"
            ],
            "602": [
                "_App",
                "_download"
            ],
            "674": [
                "_UserVars",
                "__init__"
            ],
            "677": [
                "_UserVars",
                "__getitem__"
            ],
            "680": [
                "_UserVars",
                "__setitem__"
            ],
            "682": [
                "_UserVars",
                "__setitem__"
            ],
            "685": [
                "_UserVars",
                "__delitem__"
            ],
            "687": [
                "_UserVars",
                "__delitem__"
            ],
            "690": [
                "_UserVars",
                "__iter__"
            ],
            "694": [
                "_UserVars",
                "__len__"
            ],
            "697": [
                "_UserVars",
                "__getattr__"
            ],
            "700": [
                "_UserVars",
                "__repr__"
            ]
        },
        "addLocation": [
            "toui.apps._App.forbidden_urls",
            "toui.apps._App._functions",
            "toui.apps._App.pages",
            "toui.apps._App",
            "src.pyload.webui.app"
        ]
    },
    "toui/pages.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 472,
                "afterPatchRowNumber": 472,
                "PatchRowcode": "             original_return = self._basic_view_func()"
            },
            "1": {
                "beforePatchRowNumber": 473,
                "afterPatchRowNumber": 473,
                "PatchRowcode": "             session['user page'] = copy(self)"
            },
            "2": {
                "beforePatchRowNumber": 474,
                "afterPatchRowNumber": 474,
                "PatchRowcode": "             try:"
            },
            "3": {
                "beforePatchRowNumber": 475,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                user_id = self._app._cache.get(\"user-id\")"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 475,
                "PatchRowcode": "+                user_id = self._app._user_vars._get(\"user-id\")"
            },
            "5": {
                "beforePatchRowNumber": 476,
                "afterPatchRowNumber": 476,
                "PatchRowcode": "                 if user_id:"
            },
            "6": {
                "beforePatchRowNumber": 477,
                "afterPatchRowNumber": 477,
                "PatchRowcode": "                     session['_user_id'] = user_id"
            },
            "7": {
                "beforePatchRowNumber": 478,
                "afterPatchRowNumber": 478,
                "PatchRowcode": "                 new_return = func()"
            }
        },
        "frontPatchFile": [
            "\"\"\"",
            "A module that creates web pages or windows.",
            "\"\"\"",
            "import os",
            "import time",
            "from bs4 import BeautifulSoup",
            "import webview",
            "import json",
            "from flask import session",
            "from toui.elements import Element",
            "from toui._javascript_templates import custom_func, get_script",
            "from copy import copy",
            "from toui._helpers import warn, info, debug, selector_to_str, obj_converter",
            "from toui._signals import Signal",
            "from toui._defaults import view_func",
            "",
            "",
            "class _PageSignal(Signal):",
            "    \"\"\"",
            "    Creates signals that will be sent to JavaScript.",
            "",
            "    These signals are related the methods of the `Page` object.",
            "    \"\"\"",
            "",
            "    no_return_functions = [\"add_function\"]",
            "",
            "    @staticmethod",
            "    def from_str(**kwargs):",
            "        js_func = \"_setDoc\"",
            "        js_args = []",
            "        js_kwargs = {\"doc\": kwargs['html_str']}",
            "        return {'func': js_func, 'args': js_args, 'kwargs': js_kwargs}",
            "",
            "    @staticmethod",
            "    def from_bs4_soup(**kwargs):",
            "        js_func = \"_setDoc\"",
            "        js_args = []",
            "        js_kwargs = {\"doc\": str(kwargs['bs4_soup'])}",
            "        return {'func': js_func, 'args': js_args, 'kwargs': js_kwargs}",
            "",
            "    @staticmethod",
            "    def add_function(**kwargs):",
            "        value = kwargs['return_value']",
            "        if value != \"\":",
            "            value = custom_func(value)",
            "        js_func = \"_addScript\"",
            "        js_args = []",
            "        js_kwargs = {\"script\": value}",
            "        return {'func': js_func, 'args': js_args, 'kwargs': js_kwargs}",
            "",
            "    @staticmethod",
            "    def _open_another_page(**kwargs):",
            "        js_func = \"_goTo\"",
            "        js_args = []",
            "        js_kwargs = {\"url\": kwargs['url'], \"new\": kwargs['new']}",
            "        return {'func': js_func, 'args': js_args, 'kwargs': js_kwargs}",
            "",
            "",
            "class Page:",
            "    \"\"\"",
            "    Creates an HTML page that can be used as a window or as a webpage.",
            "",
            "    Attributes",
            "    ----------",
            "    url: str",
            "        The URL of the page.",
            "",
            "    title: str",
            "        In desktop app, this attribute will be the title of the window.",
            "",
            "    window_defaults: dict",
            "        In desktop apps, this dictionary sets the default parameters of the window. To set a certain default parameter for",
            "        a window before creating it, include it in this dictionary. The parameters that can be set are the keyword arguments",
            "        of the class [`webview.create_window()`](https://pywebview.flowrl.com/guide/api.html) in pywebview package.",
            "",
            "    Examples",
            "    --------",
            "",
            "    Importing the class:",
            "",
            "    >>> from toui import Page",
            "",
            "    Creating a `Page` from an HTML file:",
            "",
            "    >>> path = \"../examples/assets/test1.html\"",
            "    >>> page = Page(html_file=path)",
            "",
            "    Creating a `Page` from a string:",
            "",
            "    >>> page = Page(html_str=\"<html><h1>Hello</h1></html>\")",
            "    >>> page",
            "    <html><h1>Hello</h1></html>",
            "",
            "    Creating a page with a URL:",
            "",
            "    >>> page = Page(html_str=\"<html><h1>Hello</h1></html>\", url=\"/\")",
            "",
            "    Getting an element in the `Page` from its id:",
            "",
            "    >>> page = Page(html_str='<html><h1 id=\"heading\">Hello</h1></html>', url=\"/\")",
            "    >>> element = page.get_element(element_id=\"heading\")",
            "    >>> element",
            "    <h1 id=\"heading\">Hello</h1>",
            "",
            "    See Also",
            "    --------",
            "    `pywebview api`: https://pywebview.flowrl.com/guide/api.html",
            "",
            "    \"\"\"",
            "",
            "    def __init__(self, html_file=None, html_str=None, url=None, title=None):",
            "        \"\"\"",
            "        Parameters",
            "        ----------",
            "        html_file: str",
            "            The path to the HTML file.",
            "",
            "        html_str: str",
            "            A string containing HTML code.",
            "",
            "        url: str, optional",
            "            If the page was used as a webpage, this will be the URL of the page.",
            "",
            "        title: str",
            "            In desktop app, this parameter will be the title of the window.",
            "",
            "        \"\"\"",
            "        if html_file:",
            "            self._html_file = html_file",
            "            with open(html_file, \"rt\") as file:",
            "                original_html = file.read()",
            "            if url is None:",
            "                url = \"/\" + os.path.basename(html_file)",
            "        elif html_str:",
            "            original_html = html_str",
            "            self._html_file = None",
            "        else:",
            "            original_html = \"<html></html>\"",
            "            self._html_file = None",
            "        self._html = BeautifulSoup(original_html, features=\"html.parser\")",
            "        if self._html.find(\"html\") is None:",
            "            self._html = BeautifulSoup(f\"<html>{original_html}</html>\", features=\"html.parser\")",
            "        if url is None:",
            "            url = \"/\"",
            "        self.url = url",
            "",
            "        # Other attributes",
            "        self.title = title",
            "        self.window_defaults = {}",
            "",
            "        # Other internal attributes",
            "        self._app = None",
            "        self._signal_mode = False",
            "        self._signals = []",
            "        self._functions = {}",
            "        self._basic_view_func = lambda: view_func(self)",
            "        self._view_func = self._basic_view_func",
            "        self._uid = None",
            "",
            "    def __str__(self):",
            "        return self.to_str()",
            "",
            "    def __repr__(self):",
            "        return self.to_str()",
            "",
            "    def __copy__(self):",
            "        new_pg = Page(html_file=self._html_file, url=self.url)",
            "        new_pg.from_bs4_soup(self.to_bs4_soup())",
            "        new_pg._signal_mode = self._signal_mode",
            "        new_pg._app = self._app",
            "        return new_pg",
            "    ",
            "    @_PageSignal()",
            "    def from_str(self, html_str):",
            "        \"\"\"",
            "        Converts HTML code to a `Page` object.",
            "",
            "        Parameters",
            "        ----------",
            "        html_str: str",
            "            HTML code.",
            "",
            "        \"\"\"",
            "        self._html = BeautifulSoup(html_str, features=\"html.parser\")",
            "",
            "    def to_str(self):",
            "        \"\"\"",
            "        Converts the `Page` object to HTML code.",
            "",
            "        Returns",
            "        -------",
            "        str",
            "",
            "        \"\"\"",
            "        return str(self._html)",
            "",
            "    def from_html_file(self, html_path):",
            "        \"\"\"",
            "        Reads an HTML file and converts it to an `Page` object.",
            "",
            "        Parameters",
            "        ----------",
            "        html_path: str",
            "",
            "        \"\"\"",
            "        with open(html_path, \"rt\") as file:",
            "            self.from_str(file.read())",
            "",
            "    def to_html_file(self, html_path):",
            "        \"\"\"",
            "        Converts the `Page` object to an HTML file.",
            "",
            "        Parameters",
            "        ----------",
            "        html_path: str",
            "",
            "        \"\"\"",
            "        with open(html_path, \"w\") as file:",
            "            file.write(self.to_str())",
            "",
            "    @_PageSignal()",
            "    def from_bs4_soup(self, bs4_soup):",
            "        \"\"\"",
            "        Converts a `bs4.BeautifulSoap` object to a `Page` object.",
            "        The `bs4.BeautifulSoap` object will be copied before converting.",
            "",
            "        Parameters",
            "        ----------",
            "        bs4_soup: bs4.BeautifulSoap",
            "",
            "        See Also",
            "        --------",
            "        bs4",
            "",
            "        \"\"\"",
            "        self._html = copy(bs4_soup)",
            "",
            "    def to_bs4_soup(self):",
            "        \"\"\"",
            "        Converts the `Page` object to a `bs4.BeautifulSoap` object.",
            "        The `Page` object will be copied before converting.",
            "",
            "        Returns",
            "        -------",
            "        bs4.BeautifulSoap",
            "",
            "        See Also",
            "        --------",
            "        bs4: https://beautiful-soup-4.readthedocs.io/en/latest/",
            "",
            "        \"\"\"",
            "        return copy(self._html)",
            "",
            "    def get_element(self, element_id, do_copy=False):",
            "        \"\"\"",
            "        Gets an element from its ``id`` attribute. You can imagine this function as ``document.getElementById``",
            "        in JavaScript.",
            "",
            "        Creating a page and getting an element by its ``id``:",
            "",
            "        >>> page = Page(html_str='<html><h1 id=\"heading\">Hello</h1></html>', url=\"/\")",
            "        >>> element = page.get_element(element_id=\"heading\")",
            "        >>> element",
            "        <h1 id=\"heading\">Hello</h1>",
            "",
            "        Parameters",
            "        ----------",
            "        element_id: str",
            "",
            "        do_copy: bool, default = False",
            "            If ``True``, the element will be copied.",
            "",
            "        Returns",
            "        -------",
            "        element: Element",
            "            If the element was found, an `Element` object will be returned. Otherwise ``None``",
            "            will be returned.",
            "",
            "        \"\"\"",
            "        bs4_tag = self._html.find(id=element_id)",
            "        if bs4_tag is None:",
            "            return None",
            "        element = Element()",
            "        if do_copy:",
            "            element.from_bs4_tag(bs4_tag)",
            "        else:",
            "            element._from_bs4_tag_no_copy(bs4_tag)",
            "        element._parent_page = self",
            "        element._signal_mode = self._signal_mode",
            "        return element",
            "",
            "    def get_elements(self, tag_name=None, class_name=None, name=None, do_copy=False, attrs=None):",
            "        \"\"\"",
            "        Get elements from the `Page` by their tag name and attributes.",
            "",
            "        Parameters",
            "        ----------",
            "        tag_name: str, default=None",
            "            The tag name of the elements.",
            "",
            "        class_name: str, default=None",
            "            The value of the ``class`` attribute of the elements.",
            "",
            "        name: str, default=None",
            "            The value of the ``name`` attribute of the elements.",
            "",
            "        do_copy: bool",
            "            If ``True``, the elements will be copied.",
            "",
            "        attrs: dict, default=None",
            "            Attributes other than ``class`` and ``name`` can be specified in this dictionary.",
            "",
            "        Returns",
            "        -------",
            "        elements_list: List",
            "            A list of `Element` objects that match the parameters.",
            "",
            "        \"\"\"",
            "        if attrs is None:",
            "            attrs = {}",
            "        if class_name:",
            "            attrs['class'] = class_name",
            "        if name:",
            "            attrs['name'] = name",
            "        bs4_tags = self._html.find_all(name=tag_name, attrs=attrs)",
            "        elements_list = []",
            "        for tag_num, bs4_tag in enumerate(bs4_tags):",
            "            element = Element()",
            "            if do_copy:",
            "                element.from_bs4_tag(bs4_tag)",
            "            else:",
            "                element._from_bs4_tag_no_copy(bs4_tag)",
            "            element._parent_page = self",
            "            element._signal_mode = self._signal_mode",
            "            elements_list.append(element)",
            "        return elements_list",
            "    ",
            "    def get_element_from_selector(self, selector, do_copy=False):",
            "        \"\"\"",
            "        Gets an element from its CSS selector.",
            "",
            "        Parameters",
            "        ----------",
            "        selector: str",
            "",
            "        do_copy: bool, default = False",
            "            If ``True``, the element will be copied.",
            "",
            "        Returns",
            "        -------",
            "        element: Element",
            "            If the element was found, an `Element` object will be returned. Otherwise ``None``",
            "            will be returned.",
            "",
            "        \"\"\"",
            "        bs4_tag = self._html.select_one(selector=selector)",
            "        if bs4_tag is None:",
            "            return None",
            "        element = Element()",
            "        if do_copy:",
            "            element.from_bs4_tag(bs4_tag)",
            "        else:",
            "            element._from_bs4_tag_no_copy(bs4_tag)",
            "        element._parent_page = self",
            "        element._signal_mode = self._signal_mode",
            "        return element",
            "",
            "    def get_html_element(self) -> Element:",
            "        \"\"\"",
            "        Gets the first ``<html>`` element.",
            "",
            "        Returns",
            "        -------",
            "        Element",
            "",
            "        None",
            "            If the ``<html>`` element was not found.",
            "",
            "        \"\"\"",
            "        elements = self.get_elements(\"html\")",
            "        if len(elements) > 0:",
            "            return elements[0]",
            "",
            "    def get_body_element(self) -> Element:",
            "        \"\"\"",
            "        Gets the first ``<body>`` element.",
            "",
            "        Returns",
            "        -------",
            "        Element",
            "",
            "        None",
            "            If the ``<body>`` element was not found.",
            "",
            "        \"\"\"",
            "        elements = self.get_elements(\"body\")",
            "        if len(elements) > 0:",
            "            return elements[0]",
            "",
            "    @_PageSignal()",
            "    def add_function(self, func):",
            "        \"\"\"",
            "        Adds a function to the `Page`. This function can be called from an HTML element.",
            "",
            "        Examples",
            "        --------",
            "",
            "        Consider an HTML code that contains the following:",
            "",
            "        >>> html_with_function = '<html><button onclick=\"printValue()\">Print</button></html>'",
            "",
            "        Notice that the ``<button>`` element contains the attribute ``onclick`` calling a Python function `printValue`.",
            "        However, this function is not yet added to the HTML page. To add the function, define it in Python and add it",
            "        to a `Page`:",
            "",
            "        >>> def printValue():",
            "        ...     print(\"value\")",
            "        >>> page = Page(html_str=html_with_function)",
            "        >>> page.add_function(printValue)",
            "",
            "        Now create a `Website` and add the `Page` to it:",
            "",
            "        >>> from toui import Website",
            "        >>> app = Website()",
            "        >>> app.add_pages(page)",
            "",
            "        Parameters",
            "        ----------",
            "        function",
            "            Function to be added to the page.",
            "",
            "        Returns",
            "        -------",
            "        None",
            "",
            "        \"\"\"",
            "        name = func.__name__",
            "        if not callable(func):",
            "            warn(f\"Variable '{name}' is not a function.\")",
            "            return",
            "        if name.startswith(\"_\"):",
            "            warn(f\"Function '{name}' starts with '_'. It is safer to avoid functions that starts with '_'\"",
            "                 f\"because they might overlap with functions used by the package.\")",
            "        if self._func_exists(name):",
            "            warn(f\"Function '{name}' exists.\")",
            "        old_functions = copy(self._functions)",
            "        self._functions[name] = func",
            "        if func.__name__ in old_functions:",
            "            return \"\"",
            "        script_element = Element(\"script\")",
            "        script_element.set_content(custom_func(func.__name__))",
            "        self.get_elements(tag_name=\"html\")[0].add_content(script_element)",
            "        return func.__name__",
            "",
            "    def on_url_request(self, func, display_return_value=False):",
            "        \"\"\"",
            "        Sets a function that will be called when the user types the URL in a browser or when a request is sent to the",
            "        URL. You can view it as the `view_func` in Flask. It might have limited functionality compared to calling Python",
            "        functions from HTML, but it is the best for retrieving data from HTTP requests.",
            "",
            "        Parameters",
            "        ----------",
            "        func: Callable",
            "            The function that will be called when a request is sent to the URL.",
            "",
            "        display_return_value: bool, default=False",
            "            If ``True``, the browser will display the return value of the function when the URL is loaded. If ``False``,",
            "            the return value will be ignored.",
            "",
            "        \"\"\"",
            "        def new_func():",
            "            original_return = self._basic_view_func()",
            "            session['user page'] = copy(self)",
            "            try:",
            "                user_id = self._app._cache.get(\"user-id\")",
            "                if user_id:",
            "                    session['_user_id'] = user_id",
            "                new_return = func()",
            "                if display_return_value:",
            "                    del session['user page']",
            "                    return new_return",
            "                else:",
            "                    pg = session['user page']",
            "                    del session['user page']",
            "                    return pg.to_str()",
            "            except Exception as e:",
            "                if 'user page' in session:",
            "                    del session['user page']",
            "                raise e",
            "",
            "        self._view_func = new_func",
            "",
            "    def get_window(self):",
            "        for window in webview.windows:",
            "            if window.uid == self._uid:",
            "                return window",
            "",
            "    def _add_script(self):",
            "        script_tag = Element(\"script\")",
            "        script_content = get_script(self._app.__class__.__name__)",
            "        script_tag.set_content(script_content)",
            "        self.get_elements(tag_name=\"html\")[0].add_content(script_tag)",
            "",
            "    def _create_window(self):",
            "        title = self.title",
            "        url = f\"http://localhost:{self._app._port}\"+self.url",
            "        window_defaults = self.window_defaults.copy()",
            "        for key, value in window_defaults.items():",
            "            if key == \"title\":",
            "                title = value",
            "                del window_defaults['title']",
            "            if key == \"url\":",
            "                warn(f\"The window will load the URL '{value}' instead of '{self.url}' because it was set in `default_windows`.\")",
            "                url = value",
            "                del window_defaults['url']",
            "        window = webview.create_window(title=title, url=url, **window_defaults)",
            "        self._uid = window.uid",
            "        debug(f\"UID of window: {self._uid}\")",
            "        def get_uid():",
            "            return self._uid",
            "        window.expose(get_uid)",
            "        return window",
            "",
            "    def _evaluate_js(self, func, kwargs):",
            "        \"\"\"This function is currently unused.\"\"\"",
            "        data_from_js = \"\"",
            "        def wait_then_get_result(result):",
            "            nonlocal data_from_js",
            "            data_from_js = result",
            "        codejs = f\"\"\"",
            "        var kwargs = JSON.parse(\\'{json.dumps(kwargs)}\\')",
            "        {func}(kwargs)",
            "        \"\"\"",
            "        debug(\"EVALUATE: \" + codejs)",
            "        self.window.evaluate_js(codejs, callback=wait_then_get_result)",
            "        return data_from_js",
            "",
            "    @_PageSignal(app_types=['Website'])",
            "    def _open_another_page(self, url, new):",
            "        if self._app.__class__.__name__ == \"DesktopApp\":",
            "            if new:",
            "                pg = Page(url=url)",
            "                pg._app = self._app",
            "                return pg._create_window()",
            "            else:",
            "                full_url = f\"http://localhost:{self._app._port}\" + url",
            "                window = self.get_window()",
            "                window.load_url(full_url)",
            "                return window",
            "            ",
            "    def _inherit_functions(self):",
            "        for page in self._app.pages:",
            "            if page.url == self.url:",
            "                self._functions.update(page._functions)",
            "                return",
            "            ",
            "    def _get_functions(self):",
            "        \"\"\"Gets all added functions in this class. This is a private function.\"\"\"",
            "        return self._functions",
            "",
            "    def _func_exists(self, func_name: str):",
            "        \"\"\"Checks if a function exists. This is a private function.\"\"\"",
            "        if func_name in self._get_functions().keys():",
            "            return True",
            "        else:",
            "            return False",
            "",
            "    def _call_func(self, func_name, *args, page=None):",
            "        \"\"\"Calls a function in this class. Its return value depends on the function called. This is a private function.\"\"\"",
            "        functions = self._get_functions()",
            "        info(f'\"{func_name}\" called')",
            "        return functions[func_name](*args)",
            "",
            "",
            "if __name__ == \"__main__\":",
            "    import doctest",
            "    doctest.testmod()"
        ],
        "afterPatchFile": [
            "\"\"\"",
            "A module that creates web pages or windows.",
            "\"\"\"",
            "import os",
            "import time",
            "from bs4 import BeautifulSoup",
            "import webview",
            "import json",
            "from flask import session",
            "from toui.elements import Element",
            "from toui._javascript_templates import custom_func, get_script",
            "from copy import copy",
            "from toui._helpers import warn, info, debug, selector_to_str, obj_converter",
            "from toui._signals import Signal",
            "from toui._defaults import view_func",
            "",
            "",
            "class _PageSignal(Signal):",
            "    \"\"\"",
            "    Creates signals that will be sent to JavaScript.",
            "",
            "    These signals are related the methods of the `Page` object.",
            "    \"\"\"",
            "",
            "    no_return_functions = [\"add_function\"]",
            "",
            "    @staticmethod",
            "    def from_str(**kwargs):",
            "        js_func = \"_setDoc\"",
            "        js_args = []",
            "        js_kwargs = {\"doc\": kwargs['html_str']}",
            "        return {'func': js_func, 'args': js_args, 'kwargs': js_kwargs}",
            "",
            "    @staticmethod",
            "    def from_bs4_soup(**kwargs):",
            "        js_func = \"_setDoc\"",
            "        js_args = []",
            "        js_kwargs = {\"doc\": str(kwargs['bs4_soup'])}",
            "        return {'func': js_func, 'args': js_args, 'kwargs': js_kwargs}",
            "",
            "    @staticmethod",
            "    def add_function(**kwargs):",
            "        value = kwargs['return_value']",
            "        if value != \"\":",
            "            value = custom_func(value)",
            "        js_func = \"_addScript\"",
            "        js_args = []",
            "        js_kwargs = {\"script\": value}",
            "        return {'func': js_func, 'args': js_args, 'kwargs': js_kwargs}",
            "",
            "    @staticmethod",
            "    def _open_another_page(**kwargs):",
            "        js_func = \"_goTo\"",
            "        js_args = []",
            "        js_kwargs = {\"url\": kwargs['url'], \"new\": kwargs['new']}",
            "        return {'func': js_func, 'args': js_args, 'kwargs': js_kwargs}",
            "",
            "",
            "class Page:",
            "    \"\"\"",
            "    Creates an HTML page that can be used as a window or as a webpage.",
            "",
            "    Attributes",
            "    ----------",
            "    url: str",
            "        The URL of the page.",
            "",
            "    title: str",
            "        In desktop app, this attribute will be the title of the window.",
            "",
            "    window_defaults: dict",
            "        In desktop apps, this dictionary sets the default parameters of the window. To set a certain default parameter for",
            "        a window before creating it, include it in this dictionary. The parameters that can be set are the keyword arguments",
            "        of the class [`webview.create_window()`](https://pywebview.flowrl.com/guide/api.html) in pywebview package.",
            "",
            "    Examples",
            "    --------",
            "",
            "    Importing the class:",
            "",
            "    >>> from toui import Page",
            "",
            "    Creating a `Page` from an HTML file:",
            "",
            "    >>> path = \"../examples/assets/test1.html\"",
            "    >>> page = Page(html_file=path)",
            "",
            "    Creating a `Page` from a string:",
            "",
            "    >>> page = Page(html_str=\"<html><h1>Hello</h1></html>\")",
            "    >>> page",
            "    <html><h1>Hello</h1></html>",
            "",
            "    Creating a page with a URL:",
            "",
            "    >>> page = Page(html_str=\"<html><h1>Hello</h1></html>\", url=\"/\")",
            "",
            "    Getting an element in the `Page` from its id:",
            "",
            "    >>> page = Page(html_str='<html><h1 id=\"heading\">Hello</h1></html>', url=\"/\")",
            "    >>> element = page.get_element(element_id=\"heading\")",
            "    >>> element",
            "    <h1 id=\"heading\">Hello</h1>",
            "",
            "    See Also",
            "    --------",
            "    `pywebview api`: https://pywebview.flowrl.com/guide/api.html",
            "",
            "    \"\"\"",
            "",
            "    def __init__(self, html_file=None, html_str=None, url=None, title=None):",
            "        \"\"\"",
            "        Parameters",
            "        ----------",
            "        html_file: str",
            "            The path to the HTML file.",
            "",
            "        html_str: str",
            "            A string containing HTML code.",
            "",
            "        url: str, optional",
            "            If the page was used as a webpage, this will be the URL of the page.",
            "",
            "        title: str",
            "            In desktop app, this parameter will be the title of the window.",
            "",
            "        \"\"\"",
            "        if html_file:",
            "            self._html_file = html_file",
            "            with open(html_file, \"rt\") as file:",
            "                original_html = file.read()",
            "            if url is None:",
            "                url = \"/\" + os.path.basename(html_file)",
            "        elif html_str:",
            "            original_html = html_str",
            "            self._html_file = None",
            "        else:",
            "            original_html = \"<html></html>\"",
            "            self._html_file = None",
            "        self._html = BeautifulSoup(original_html, features=\"html.parser\")",
            "        if self._html.find(\"html\") is None:",
            "            self._html = BeautifulSoup(f\"<html>{original_html}</html>\", features=\"html.parser\")",
            "        if url is None:",
            "            url = \"/\"",
            "        self.url = url",
            "",
            "        # Other attributes",
            "        self.title = title",
            "        self.window_defaults = {}",
            "",
            "        # Other internal attributes",
            "        self._app = None",
            "        self._signal_mode = False",
            "        self._signals = []",
            "        self._functions = {}",
            "        self._basic_view_func = lambda: view_func(self)",
            "        self._view_func = self._basic_view_func",
            "        self._uid = None",
            "",
            "    def __str__(self):",
            "        return self.to_str()",
            "",
            "    def __repr__(self):",
            "        return self.to_str()",
            "",
            "    def __copy__(self):",
            "        new_pg = Page(html_file=self._html_file, url=self.url)",
            "        new_pg.from_bs4_soup(self.to_bs4_soup())",
            "        new_pg._signal_mode = self._signal_mode",
            "        new_pg._app = self._app",
            "        return new_pg",
            "    ",
            "    @_PageSignal()",
            "    def from_str(self, html_str):",
            "        \"\"\"",
            "        Converts HTML code to a `Page` object.",
            "",
            "        Parameters",
            "        ----------",
            "        html_str: str",
            "            HTML code.",
            "",
            "        \"\"\"",
            "        self._html = BeautifulSoup(html_str, features=\"html.parser\")",
            "",
            "    def to_str(self):",
            "        \"\"\"",
            "        Converts the `Page` object to HTML code.",
            "",
            "        Returns",
            "        -------",
            "        str",
            "",
            "        \"\"\"",
            "        return str(self._html)",
            "",
            "    def from_html_file(self, html_path):",
            "        \"\"\"",
            "        Reads an HTML file and converts it to an `Page` object.",
            "",
            "        Parameters",
            "        ----------",
            "        html_path: str",
            "",
            "        \"\"\"",
            "        with open(html_path, \"rt\") as file:",
            "            self.from_str(file.read())",
            "",
            "    def to_html_file(self, html_path):",
            "        \"\"\"",
            "        Converts the `Page` object to an HTML file.",
            "",
            "        Parameters",
            "        ----------",
            "        html_path: str",
            "",
            "        \"\"\"",
            "        with open(html_path, \"w\") as file:",
            "            file.write(self.to_str())",
            "",
            "    @_PageSignal()",
            "    def from_bs4_soup(self, bs4_soup):",
            "        \"\"\"",
            "        Converts a `bs4.BeautifulSoap` object to a `Page` object.",
            "        The `bs4.BeautifulSoap` object will be copied before converting.",
            "",
            "        Parameters",
            "        ----------",
            "        bs4_soup: bs4.BeautifulSoap",
            "",
            "        See Also",
            "        --------",
            "        bs4",
            "",
            "        \"\"\"",
            "        self._html = copy(bs4_soup)",
            "",
            "    def to_bs4_soup(self):",
            "        \"\"\"",
            "        Converts the `Page` object to a `bs4.BeautifulSoap` object.",
            "        The `Page` object will be copied before converting.",
            "",
            "        Returns",
            "        -------",
            "        bs4.BeautifulSoap",
            "",
            "        See Also",
            "        --------",
            "        bs4: https://beautiful-soup-4.readthedocs.io/en/latest/",
            "",
            "        \"\"\"",
            "        return copy(self._html)",
            "",
            "    def get_element(self, element_id, do_copy=False):",
            "        \"\"\"",
            "        Gets an element from its ``id`` attribute. You can imagine this function as ``document.getElementById``",
            "        in JavaScript.",
            "",
            "        Creating a page and getting an element by its ``id``:",
            "",
            "        >>> page = Page(html_str='<html><h1 id=\"heading\">Hello</h1></html>', url=\"/\")",
            "        >>> element = page.get_element(element_id=\"heading\")",
            "        >>> element",
            "        <h1 id=\"heading\">Hello</h1>",
            "",
            "        Parameters",
            "        ----------",
            "        element_id: str",
            "",
            "        do_copy: bool, default = False",
            "            If ``True``, the element will be copied.",
            "",
            "        Returns",
            "        -------",
            "        element: Element",
            "            If the element was found, an `Element` object will be returned. Otherwise ``None``",
            "            will be returned.",
            "",
            "        \"\"\"",
            "        bs4_tag = self._html.find(id=element_id)",
            "        if bs4_tag is None:",
            "            return None",
            "        element = Element()",
            "        if do_copy:",
            "            element.from_bs4_tag(bs4_tag)",
            "        else:",
            "            element._from_bs4_tag_no_copy(bs4_tag)",
            "        element._parent_page = self",
            "        element._signal_mode = self._signal_mode",
            "        return element",
            "",
            "    def get_elements(self, tag_name=None, class_name=None, name=None, do_copy=False, attrs=None):",
            "        \"\"\"",
            "        Get elements from the `Page` by their tag name and attributes.",
            "",
            "        Parameters",
            "        ----------",
            "        tag_name: str, default=None",
            "            The tag name of the elements.",
            "",
            "        class_name: str, default=None",
            "            The value of the ``class`` attribute of the elements.",
            "",
            "        name: str, default=None",
            "            The value of the ``name`` attribute of the elements.",
            "",
            "        do_copy: bool",
            "            If ``True``, the elements will be copied.",
            "",
            "        attrs: dict, default=None",
            "            Attributes other than ``class`` and ``name`` can be specified in this dictionary.",
            "",
            "        Returns",
            "        -------",
            "        elements_list: List",
            "            A list of `Element` objects that match the parameters.",
            "",
            "        \"\"\"",
            "        if attrs is None:",
            "            attrs = {}",
            "        if class_name:",
            "            attrs['class'] = class_name",
            "        if name:",
            "            attrs['name'] = name",
            "        bs4_tags = self._html.find_all(name=tag_name, attrs=attrs)",
            "        elements_list = []",
            "        for tag_num, bs4_tag in enumerate(bs4_tags):",
            "            element = Element()",
            "            if do_copy:",
            "                element.from_bs4_tag(bs4_tag)",
            "            else:",
            "                element._from_bs4_tag_no_copy(bs4_tag)",
            "            element._parent_page = self",
            "            element._signal_mode = self._signal_mode",
            "            elements_list.append(element)",
            "        return elements_list",
            "    ",
            "    def get_element_from_selector(self, selector, do_copy=False):",
            "        \"\"\"",
            "        Gets an element from its CSS selector.",
            "",
            "        Parameters",
            "        ----------",
            "        selector: str",
            "",
            "        do_copy: bool, default = False",
            "            If ``True``, the element will be copied.",
            "",
            "        Returns",
            "        -------",
            "        element: Element",
            "            If the element was found, an `Element` object will be returned. Otherwise ``None``",
            "            will be returned.",
            "",
            "        \"\"\"",
            "        bs4_tag = self._html.select_one(selector=selector)",
            "        if bs4_tag is None:",
            "            return None",
            "        element = Element()",
            "        if do_copy:",
            "            element.from_bs4_tag(bs4_tag)",
            "        else:",
            "            element._from_bs4_tag_no_copy(bs4_tag)",
            "        element._parent_page = self",
            "        element._signal_mode = self._signal_mode",
            "        return element",
            "",
            "    def get_html_element(self) -> Element:",
            "        \"\"\"",
            "        Gets the first ``<html>`` element.",
            "",
            "        Returns",
            "        -------",
            "        Element",
            "",
            "        None",
            "            If the ``<html>`` element was not found.",
            "",
            "        \"\"\"",
            "        elements = self.get_elements(\"html\")",
            "        if len(elements) > 0:",
            "            return elements[0]",
            "",
            "    def get_body_element(self) -> Element:",
            "        \"\"\"",
            "        Gets the first ``<body>`` element.",
            "",
            "        Returns",
            "        -------",
            "        Element",
            "",
            "        None",
            "            If the ``<body>`` element was not found.",
            "",
            "        \"\"\"",
            "        elements = self.get_elements(\"body\")",
            "        if len(elements) > 0:",
            "            return elements[0]",
            "",
            "    @_PageSignal()",
            "    def add_function(self, func):",
            "        \"\"\"",
            "        Adds a function to the `Page`. This function can be called from an HTML element.",
            "",
            "        Examples",
            "        --------",
            "",
            "        Consider an HTML code that contains the following:",
            "",
            "        >>> html_with_function = '<html><button onclick=\"printValue()\">Print</button></html>'",
            "",
            "        Notice that the ``<button>`` element contains the attribute ``onclick`` calling a Python function `printValue`.",
            "        However, this function is not yet added to the HTML page. To add the function, define it in Python and add it",
            "        to a `Page`:",
            "",
            "        >>> def printValue():",
            "        ...     print(\"value\")",
            "        >>> page = Page(html_str=html_with_function)",
            "        >>> page.add_function(printValue)",
            "",
            "        Now create a `Website` and add the `Page` to it:",
            "",
            "        >>> from toui import Website",
            "        >>> app = Website()",
            "        >>> app.add_pages(page)",
            "",
            "        Parameters",
            "        ----------",
            "        function",
            "            Function to be added to the page.",
            "",
            "        Returns",
            "        -------",
            "        None",
            "",
            "        \"\"\"",
            "        name = func.__name__",
            "        if not callable(func):",
            "            warn(f\"Variable '{name}' is not a function.\")",
            "            return",
            "        if name.startswith(\"_\"):",
            "            warn(f\"Function '{name}' starts with '_'. It is safer to avoid functions that starts with '_'\"",
            "                 f\"because they might overlap with functions used by the package.\")",
            "        if self._func_exists(name):",
            "            warn(f\"Function '{name}' exists.\")",
            "        old_functions = copy(self._functions)",
            "        self._functions[name] = func",
            "        if func.__name__ in old_functions:",
            "            return \"\"",
            "        script_element = Element(\"script\")",
            "        script_element.set_content(custom_func(func.__name__))",
            "        self.get_elements(tag_name=\"html\")[0].add_content(script_element)",
            "        return func.__name__",
            "",
            "    def on_url_request(self, func, display_return_value=False):",
            "        \"\"\"",
            "        Sets a function that will be called when the user types the URL in a browser or when a request is sent to the",
            "        URL. You can view it as the `view_func` in Flask. It might have limited functionality compared to calling Python",
            "        functions from HTML, but it is the best for retrieving data from HTTP requests.",
            "",
            "        Parameters",
            "        ----------",
            "        func: Callable",
            "            The function that will be called when a request is sent to the URL.",
            "",
            "        display_return_value: bool, default=False",
            "            If ``True``, the browser will display the return value of the function when the URL is loaded. If ``False``,",
            "            the return value will be ignored.",
            "",
            "        \"\"\"",
            "        def new_func():",
            "            original_return = self._basic_view_func()",
            "            session['user page'] = copy(self)",
            "            try:",
            "                user_id = self._app._user_vars._get(\"user-id\")",
            "                if user_id:",
            "                    session['_user_id'] = user_id",
            "                new_return = func()",
            "                if display_return_value:",
            "                    del session['user page']",
            "                    return new_return",
            "                else:",
            "                    pg = session['user page']",
            "                    del session['user page']",
            "                    return pg.to_str()",
            "            except Exception as e:",
            "                if 'user page' in session:",
            "                    del session['user page']",
            "                raise e",
            "",
            "        self._view_func = new_func",
            "",
            "    def get_window(self):",
            "        for window in webview.windows:",
            "            if window.uid == self._uid:",
            "                return window",
            "",
            "    def _add_script(self):",
            "        script_tag = Element(\"script\")",
            "        script_content = get_script(self._app.__class__.__name__)",
            "        script_tag.set_content(script_content)",
            "        self.get_elements(tag_name=\"html\")[0].add_content(script_tag)",
            "",
            "    def _create_window(self):",
            "        title = self.title",
            "        url = f\"http://localhost:{self._app._port}\"+self.url",
            "        window_defaults = self.window_defaults.copy()",
            "        for key, value in window_defaults.items():",
            "            if key == \"title\":",
            "                title = value",
            "                del window_defaults['title']",
            "            if key == \"url\":",
            "                warn(f\"The window will load the URL '{value}' instead of '{self.url}' because it was set in `default_windows`.\")",
            "                url = value",
            "                del window_defaults['url']",
            "        window = webview.create_window(title=title, url=url, **window_defaults)",
            "        self._uid = window.uid",
            "        debug(f\"UID of window: {self._uid}\")",
            "        def get_uid():",
            "            return self._uid",
            "        window.expose(get_uid)",
            "        return window",
            "",
            "    def _evaluate_js(self, func, kwargs):",
            "        \"\"\"This function is currently unused.\"\"\"",
            "        data_from_js = \"\"",
            "        def wait_then_get_result(result):",
            "            nonlocal data_from_js",
            "            data_from_js = result",
            "        codejs = f\"\"\"",
            "        var kwargs = JSON.parse(\\'{json.dumps(kwargs)}\\')",
            "        {func}(kwargs)",
            "        \"\"\"",
            "        debug(\"EVALUATE: \" + codejs)",
            "        self.window.evaluate_js(codejs, callback=wait_then_get_result)",
            "        return data_from_js",
            "",
            "    @_PageSignal(app_types=['Website'])",
            "    def _open_another_page(self, url, new):",
            "        if self._app.__class__.__name__ == \"DesktopApp\":",
            "            if new:",
            "                pg = Page(url=url)",
            "                pg._app = self._app",
            "                return pg._create_window()",
            "            else:",
            "                full_url = f\"http://localhost:{self._app._port}\" + url",
            "                window = self.get_window()",
            "                window.load_url(full_url)",
            "                return window",
            "            ",
            "    def _inherit_functions(self):",
            "        for page in self._app.pages:",
            "            if page.url == self.url:",
            "                self._functions.update(page._functions)",
            "                return",
            "            ",
            "    def _get_functions(self):",
            "        \"\"\"Gets all added functions in this class. This is a private function.\"\"\"",
            "        return self._functions",
            "",
            "    def _func_exists(self, func_name: str):",
            "        \"\"\"Checks if a function exists. This is a private function.\"\"\"",
            "        if func_name in self._get_functions().keys():",
            "            return True",
            "        else:",
            "            return False",
            "",
            "    def _call_func(self, func_name, *args, page=None):",
            "        \"\"\"Calls a function in this class. Its return value depends on the function called. This is a private function.\"\"\"",
            "        functions = self._get_functions()",
            "        info(f'\"{func_name}\" called')",
            "        return functions[func_name](*args)",
            "",
            "",
            "if __name__ == \"__main__\":",
            "    import doctest",
            "    doctest.testmod()"
        ],
        "action": [
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "475": [
                "Page",
                "on_url_request",
                "new_func"
            ]
        },
        "addLocation": []
    }
}