{
    "cbpi/__init__.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 1,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-__version__ = \"4.4.1.a3\""
            },
            "1": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 1,
                "PatchRowcode": "+__version__ = \"4.4.1.a6\""
            },
            "2": {
                "beforePatchRowNumber": 2,
                "afterPatchRowNumber": 2,
                "PatchRowcode": " __codename__ = \"Yeast Starter\""
            },
            "3": {
                "beforePatchRowNumber": 3,
                "afterPatchRowNumber": 3,
                "PatchRowcode": " "
            }
        },
        "frontPatchFile": [
            "__version__ = \"4.4.1.a3\"",
            "__codename__ = \"Yeast Starter\""
        ],
        "afterPatchFile": [
            "__version__ = \"4.4.1.a6\"",
            "__codename__ = \"Yeast Starter\""
        ],
        "action": [
            "2",
            "2",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "1": [
                "__version__"
            ]
        },
        "addLocation": []
    },
    "cbpi/controller/system_controller.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 15,
                "afterPatchRowNumber": 15,
                "PatchRowcode": " import socket"
            },
            "1": {
                "beforePatchRowNumber": 16,
                "afterPatchRowNumber": 16,
                "PatchRowcode": " import importlib"
            },
            "2": {
                "beforePatchRowNumber": 17,
                "afterPatchRowNumber": 17,
                "PatchRowcode": " from tabulate import tabulate"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 18,
                "PatchRowcode": "+from datetime import datetime, timedelta"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 19,
                "PatchRowcode": "+"
            },
            "5": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 20,
                "PatchRowcode": "+try:"
            },
            "6": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 21,
                "PatchRowcode": "+    from systemd import journal"
            },
            "7": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 22,
                "PatchRowcode": "+    systemd_available=True"
            },
            "8": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 23,
                "PatchRowcode": "+except Exception:"
            },
            "9": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 24,
                "PatchRowcode": "+    logger.warning(\"Failed to load systemd library. logfile download not available\")"
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 25,
                "PatchRowcode": "+    systemd_available=False"
            },
            "11": {
                "beforePatchRowNumber": 18,
                "afterPatchRowNumber": 26,
                "PatchRowcode": " "
            },
            "12": {
                "beforePatchRowNumber": 19,
                "afterPatchRowNumber": 27,
                "PatchRowcode": " class SystemController:"
            },
            "13": {
                "beforePatchRowNumber": 20,
                "afterPatchRowNumber": 28,
                "PatchRowcode": " "
            },
            "14": {
                "beforePatchRowNumber": 77,
                "afterPatchRowNumber": 85,
                "PatchRowcode": "         fullkettlename = pathlib.Path(os.path.join(\".\",kettlename))"
            },
            "15": {
                "beforePatchRowNumber": 78,
                "afterPatchRowNumber": 86,
                "PatchRowcode": " "
            },
            "16": {
                "beforePatchRowNumber": 79,
                "afterPatchRowNumber": 87,
                "PatchRowcode": "         output_filename=\"cbpi4_log.zip\""
            },
            "17": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 88,
                "PatchRowcode": "+        result=[]"
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 89,
                "PatchRowcode": "+        if systemd_available:"
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 90,
                "PatchRowcode": "+            j = journal.Reader()"
            },
            "20": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 91,
                "PatchRowcode": "+            if logtime == \"b\":"
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 92,
                "PatchRowcode": "+                j.this_boot()"
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 93,
                "PatchRowcode": "+            else:"
            },
            "23": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 94,
                "PatchRowcode": "+                since = datetime.now() - timedelta(hours=int(logtime))"
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 95,
                "PatchRowcode": "+                j.seek_realtime(since)"
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 96,
                "PatchRowcode": "+            j.add_match(_SYSTEMD_UNIT=\"craftbeerpi.service\")"
            },
            "26": {
                "beforePatchRowNumber": 80,
                "afterPatchRowNumber": 97,
                "PatchRowcode": " "
            },
            "27": {
                "beforePatchRowNumber": 81,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        if logtime == \"b\":"
            },
            "28": {
                "beforePatchRowNumber": 82,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            os.system('journalctl -b -u craftbeerpi.service --output cat > {}'.format(fullname))"
            },
            "29": {
                "beforePatchRowNumber": 83,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        else:"
            },
            "30": {
                "beforePatchRowNumber": 84,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            os.system('journalctl --since \\\"{} hours ago\\\" -u craftbeerpi.service --output cat > {}'.format(logtime, fullname))"
            },
            "31": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 98,
                "PatchRowcode": "+            for entry in j:"
            },
            "32": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 99,
                "PatchRowcode": "+                result.append(entry['MESSAGE'])"
            },
            "33": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 100,
                "PatchRowcode": "+        try:"
            },
            "34": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 101,
                "PatchRowcode": "+            with open(fullname, 'w') as f:"
            },
            "35": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 102,
                "PatchRowcode": "+                for line in result:"
            },
            "36": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 103,
                "PatchRowcode": "+                    f.write(f\"{line}\\n\")"
            },
            "37": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 104,
                "PatchRowcode": "+        except Exception as e:"
            },
            "38": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 105,
                "PatchRowcode": "+            logging.error(e)"
            },
            "39": {
                "beforePatchRowNumber": 85,
                "afterPatchRowNumber": 106,
                "PatchRowcode": " "
            },
            "40": {
                "beforePatchRowNumber": 86,
                "afterPatchRowNumber": 107,
                "PatchRowcode": "         plugins = await self.plugins_list()"
            },
            "41": {
                "beforePatchRowNumber": 87,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "42": {
                "beforePatchRowNumber": 88,
                "afterPatchRowNumber": 108,
                "PatchRowcode": "         with open(fullpluginname, 'w') as f:"
            },
            "43": {
                "beforePatchRowNumber": 89,
                "afterPatchRowNumber": 109,
                "PatchRowcode": "             f.write(plugins)"
            },
            "44": {
                "beforePatchRowNumber": 90,
                "afterPatchRowNumber": 110,
                "PatchRowcode": " "
            },
            "45": {
                "beforePatchRowNumber": 91,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        #os.system('echo \"{}\" >> {}'.format(plugins,fullpluginname))"
            },
            "46": {
                "beforePatchRowNumber": 92,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "47": {
                "beforePatchRowNumber": 93,
                "afterPatchRowNumber": 111,
                "PatchRowcode": "         try:"
            },
            "48": {
                "beforePatchRowNumber": 94,
                "afterPatchRowNumber": 112,
                "PatchRowcode": "             actors = self.cbpi.actor.get_state()"
            },
            "49": {
                "beforePatchRowNumber": 95,
                "afterPatchRowNumber": 113,
                "PatchRowcode": "             json.dump(actors['data'],open(fullactorname,'w'),indent=4, sort_keys=True)"
            }
        },
        "frontPatchFile": [
            "import logging",
            "import os",
            "import shutil",
            "import pkgutil",
            "import psutil",
            "import pathlib",
            "import json",
            "import aiohttp",
            "from voluptuous.schema_builder import message",
            "from cbpi.api.dataclasses import NotificationAction, NotificationType",
            "from cbpi.api.base import CBPiBase",
            "from cbpi.api.config import ConfigType",
            "from cbpi.api import *",
            "import zipfile",
            "import socket",
            "import importlib",
            "from tabulate import tabulate",
            "",
            "class SystemController:",
            "",
            "    def __init__(self, cbpi):",
            "        self.cbpi = cbpi",
            "        self.service = cbpi.actor",
            "        self.logger = logging.getLogger(__name__)",
            "",
            "        self.cbpi.app.on_startup.append(self.check_for_update)",
            "",
            "",
            "    async def check_for_update(self, app):",
            "        pass",
            "",
            "    async def restart(self):",
            "        logging.info(\"RESTART\")",
            "        os.system('systemctl reboot') ",
            "        pass",
            "",
            "    async def shutdown(self):",
            "        logging.info(\"SHUTDOWN\")",
            "        os.system('systemctl poweroff') ",
            "        pass",
            "",
            "    async def backupConfig(self):",
            "        output_filename = \"cbpi4_config\"",
            "        dir_name = pathlib.Path(self.cbpi.config_folder.get_file_path(''))",
            "        shutil.make_archive(output_filename, 'zip', dir_name)",
            "",
            "    async def plugins_list(self): ",
            "        result = []",
            "        discovered_plugins = {",
            "            name: importlib.import_module(name)",
            "            for finder, name, ispkg",
            "            in pkgutil.iter_modules()",
            "            if name.startswith('cbpi') and len(name) > 4",
            "        }",
            "        for key, module in discovered_plugins.items():",
            "            from importlib.metadata import version",
            "            try:",
            "                from importlib.metadata import (distribution, metadata,",
            "                                                    version)",
            "                meta = metadata(key)",
            "                result.append(dict(Name=meta[\"Name\"], Version=meta[\"Version\"], Author=meta[\"Author\"], Homepage=meta[\"Home-page\"], Summary=meta[\"Summary\"]))",
            "                            ",
            "            except Exception as e:",
            "                print(e)",
            "        return tabulate(result, headers=\"keys\")",
            "",
            "    async def downloadlog(self, logtime):",
            "        filename = \"cbpi4.log\"",
            "        fullname = pathlib.Path(os.path.join(\".\",filename))",
            "        pluginname = \"cbpi4_plugins.txt\"",
            "        fullpluginname = pathlib.Path(os.path.join(\".\",pluginname))",
            "        actorname = \"cbpi4_actors.txt\"",
            "        fullactorname = pathlib.Path(os.path.join(\".\",actorname))",
            "        sensorname = \"cbpi4_sensors.txt\"",
            "        fullsensorname = pathlib.Path(os.path.join(\".\",sensorname))",
            "        kettlename = \"cbpi4_kettles.txt\"",
            "        fullkettlename = pathlib.Path(os.path.join(\".\",kettlename))",
            "",
            "        output_filename=\"cbpi4_log.zip\"",
            "",
            "        if logtime == \"b\":",
            "            os.system('journalctl -b -u craftbeerpi.service --output cat > {}'.format(fullname))",
            "        else:",
            "            os.system('journalctl --since \\\"{} hours ago\\\" -u craftbeerpi.service --output cat > {}'.format(logtime, fullname))",
            "",
            "        plugins = await self.plugins_list()",
            "",
            "        with open(fullpluginname, 'w') as f:",
            "            f.write(plugins)",
            "",
            "        #os.system('echo \"{}\" >> {}'.format(plugins,fullpluginname))",
            "",
            "        try:",
            "            actors = self.cbpi.actor.get_state()",
            "            json.dump(actors['data'],open(fullactorname,'w'),indent=4, sort_keys=True)",
            "            sensors = self.cbpi.sensor.get_state()",
            "            json.dump(sensors['data'],open(fullsensorname,'w'),indent=4, sort_keys=True)",
            "            kettles = self.cbpi.kettle.get_state()",
            "            json.dump(kettles['data'],open(fullkettlename,'w'),indent=4, sort_keys=True)",
            "        except Exception as e:",
            "            logging.info(e)",
            "            self.cbpi.notify(\"Error\", \"Creation of files failed: {}\".format(e), NotificationType.ERROR)",
            "",
            "        try:",
            "            zipObj=zipfile.ZipFile(output_filename , 'w', zipfile.ZIP_DEFLATED)",
            "            zipObj.write(fullname)",
            "            zipObj.write(fullpluginname)",
            "            zipObj.write(fullactorname)",
            "            zipObj.write(fullsensorname)",
            "            zipObj.write(fullkettlename)",
            "            zipObj.close()",
            "        except Exception as e:",
            "            logging.info(e)",
            "            self.cbpi.notify(\"Error\", \"Zip creation failed: {}\".format(e), NotificationType.ERROR)",
            "",
            "        try:",
            "            os.remove(fullname)",
            "            os.remove(fullpluginname)",
            "            os.remove(fullactorname)",
            "            os.remove(fullsensorname)",
            "            os.remove(fullkettlename)",
            "        except Exception as e:",
            "            logging.info(e)",
            "            self.cbpi.notify(\"Error\", \"Removal of original files failed: {}\".format(e), NotificationType.ERROR)",
            "",
            "",
            "    def allowed_file(self, filename, extension):",
            "        return '.' in filename and filename.rsplit('.', 1)[1] in set([extension])",
            "",
            "    def recursive_chown(self, path, owner, group):",
            "        for dirpath, dirnames, filenames in os.walk(path):",
            "            shutil.chown(dirpath, owner, group)",
            "            for filename in filenames:",
            "                shutil.chown(os.path.join(dirpath, filename), owner, group)",
            "",
            "    async def restoreConfig(self, data):",
            "        fileData = data['File']",
            "        filename = fileData.filename",
            "        backup_file = fileData.file",
            "        content_type = fileData.content_type",
            "        required_content=['dashboard/', 'recipes/', 'upload/', 'config.json', 'config.yaml']",
            "",
            "        if content_type == 'application/x-zip-compressed':",
            "            try:",
            "                content = backup_file.read()",
            "                if backup_file and self.allowed_file(filename, 'zip'):",
            "                    self.path = os.path.join(self.cbpi.config_folder.configFolderPath, \"restored_config.zip\")",
            "                    ",
            "                    f=open(self.path, \"wb\")",
            "                    f.write(content)",
            "                    f.close()",
            "                    zip=zipfile.ZipFile(self.path)",
            "                    zip_content_list = zip.namelist()",
            "                    zip_content = True",
            "                    for content in required_content:",
            "                        try:",
            "                            check = zip_content_list.index(content)",
            "                        except:",
            "                            zip_content = False",
            "                    if zip_content == True:",
            "                        self.cbpi.notify(\"Success\", \"Config backup has been uploaded\", NotificationType.SUCCESS)",
            "                        self.cbpi.notify(\"Action Required!\", \"Please restart the server\", NotificationType.WARNING)",
            "                    else:",
            "                        self.cbpi.notify(\"Error\", \"Wrong content type. Upload failed\", NotificationType.ERROR)",
            "                        os.remove(self.path)",
            "            except:",
            "                self.cbpi.notify(\"Error\", \"Config backup upload failed\", NotificationType.ERROR)",
            "                pass",
            "        else:",
            "            self.cbpi.notify(\"Error\", \"Wrong content type. Upload failed\", NotificationType.ERROR)",
            "",
            "    async def uploadSVG(self, data):",
            "        fileData = data['File']",
            "        filename = fileData.filename",
            "        svg_file = fileData.file",
            "        content_type = fileData.content_type",
            "",
            "        logging.info(content_type)",
            "",
            "        if content_type == 'image/svg+xml':",
            "            try:",
            "                content = svg_file.read().decode('utf-8','replace')",
            "                if svg_file and self.allowed_file(filename, 'svg'):",
            "                    self.path = os.path.join(self.cbpi.config_folder.get_file_path(\"dashboard\"),\"widgets\", filename)",
            "                    logging.info(self.path)",
            "",
            "                    f=open(self.path, \"w\")",
            "                    f.write(content)",
            "                    f.close()",
            "                    self.cbpi.notify(\"Success\", \"SVG file ({}) has been uploaded.\".format(filename), NotificationType.SUCCESS)",
            "            except:",
            "                self.cbpi.notify(\"Error\", \"SVG upload failed\", NotificationType.ERROR)",
            "                pass",
            "        else:",
            "            self.cbpi.notify(\"Error\", \"Wrong content type. Upload failed\", NotificationType.ERROR)",
            "",
            "    async def systeminfo(self):",
            "        logging.info(\"SYSTEMINFO\")",
            "        system = \"\" ",
            "        temp = 0",
            "        cpuload = 0",
            "        cpucount = 0",
            "        cpufreq = 0",
            "        totalmem = 0",
            "        availmem = 0",
            "        mempercent = 0",
            "        eth0IP = \"N/A\"",
            "        wlan0IP = \"N/A\"",
            "        eth0speed = \"N/A\"",
            "        wlan0speed = \"N/A\"       ",
            "",
            "        TEMP_UNIT=self.cbpi.config.get(\"TEMP_UNIT\", \"C\")",
            "        FAHRENHEIT = False if TEMP_UNIT == \"C\" else True",
            "",
            "        af_map = { socket.AF_INET: 'IPv4',",
            "                   socket.AF_INET6: 'IPv6',",
            "                   }",
            "",
            "        try:",
            "            if psutil.LINUX == True:",
            "                system = \"Linux\"",
            "            elif psutil.WINDOWS == True:",
            "                system = \"Windows\"",
            "            elif psutil.MACOS == True:",
            "                system = \"MacOS\"",
            "            cpuload = round(psutil.cpu_percent(interval=None),1)",
            "            cpucount = psutil.cpu_count(logical=False)",
            "            cpufreq = psutil.cpu_freq()",
            "            mem = psutil.virtual_memory()",
            "            availmem = round((int(mem.available) / (1024*1024)),1)",
            "            mempercent = round(float(mem.percent),1)",
            "            totalmem = round((int(mem.total) / (1024*1024)),1)",
            "            if system == \"Linux\":",
            "                try:",
            "                    temps = psutil.sensors_temperatures(fahrenheit=FAHRENHEIT)",
            "                    for name, entries in temps.items():",
            "                        for entry in entries:",
            "                            if name == \"cpu_thermal\":",
            "                                temp = round(float(entry.current),1)",
            "                except:",
            "                    pass",
            "            else:",
            "                temp = \"N/A\"",
            "            if system == \"Linux\":",
            "                try:",
            "                    ethernet = psutil.net_if_addrs()",
            "                    for nic, addrs in ethernet.items():",
            "                        if nic == \"eth0\":",
            "                            for addr in addrs:",
            "                                if str(addr.family) == \"AddressFamily.AF_INET\" or str(addr.family) == \"2\": ",
            "                                    if addr.address:",
            "                                        eth0IP = addr.address",
            "                        if nic == \"wlan0\":",
            "                            for addr in addrs:",
            "                                if str(addr.family) == \"AddressFamily.AF_INET\" or str(addr.family) == \"2\": ",
            "                                    if addr.address:",
            "                                        wlan0IP = addr.address",
            "                    info = psutil.net_if_stats()",
            "                    try:",
            "                        for nic in info:",
            "                            if nic == 'eth0':",
            "                                if info[nic].isup == True:",
            "                                    if info[nic].speed:",
            "                                        eth0speed = info[nic].speed",
            "                                else:",
            "                                    eth0speed = \"down\"",
            "                            if nic == 'wlan0':",
            "                                if info[nic].isup == True: ",
            "                                    ratestring = os.popen('iwlist wlan0 rate | grep Rate').read()",
            "                                    start = ratestring.find(\"=\") + 1",
            "                                    end = ratestring.find(\" Mb/s\")",
            "                                    wlan0speed = ratestring[start:end]",
            "                                else:",
            "                                    wlan0speed = \"down\"",
            "                    except Exception as e:",
            "                        logging.info(e)",
            "                except:",
            "                    pass",
            "",
            "            if system == \"Windows\":",
            "                try:",
            "                    ethernet = psutil.net_if_addrs()               ",
            "                    for nic, addrs in ethernet.items():",
            "                        if nic == \"Ethernet\":",
            "                            for addr in addrs:",
            "                                if str(addr.family) == \"AddressFamily.AF_INET\": ",
            "                                    if addr.address:",
            "                                        eth0IP = addr.address",
            "                        if nic == \"WLAN\":",
            "                            for addr in addrs:",
            "                                if str(addr.family) == \"AddressFamily.AF_INET\": ",
            "                                    if addr.address:",
            "                                        wlan0IP = addr.address",
            "                    info = psutil.net_if_stats()",
            "                    try:",
            "                        for nic in info:",
            "                            if nic == 'Ethernet':",
            "                                if info[nic].isup == True:",
            "                                    if info[nic].speed:",
            "                                        eth0speed = info[nic].speed",
            "                                else:",
            "                                    eth0speed = \"down\"",
            "                            if nic == 'WLAN':",
            "                                if info[nic].isup == True:",
            "                                    if info[nic].speed:",
            "                                        wlan0speed = info[nic].speed",
            "                                else:",
            "                                    wlan0speed = \"down\"                    ",
            "                    except Exception as e:",
            "                        logging.info(e)",
            "                except:",
            "                    pass",
            "",
            "        except:",
            "            pass",
            "",
            "        systeminfo =    {'system': system,",
            "                         'cpuload': cpuload,",
            "                         'cpucount': cpucount,",
            "                         'cpufreq': cpufreq.current,",
            "                         'totalmem': totalmem,",
            "                         'availmem': availmem,",
            "                         'mempercent': mempercent,",
            "                         'temp': temp,",
            "                         'temp_unit': TEMP_UNIT,",
            "                         'eth0': eth0IP,",
            "                         'wlan0': wlan0IP,",
            "                         'eth0speed': eth0speed,",
            "                         'wlan0speed': wlan0speed}",
            "        return systeminfo"
        ],
        "afterPatchFile": [
            "import logging",
            "import os",
            "import shutil",
            "import pkgutil",
            "import psutil",
            "import pathlib",
            "import json",
            "import aiohttp",
            "from voluptuous.schema_builder import message",
            "from cbpi.api.dataclasses import NotificationAction, NotificationType",
            "from cbpi.api.base import CBPiBase",
            "from cbpi.api.config import ConfigType",
            "from cbpi.api import *",
            "import zipfile",
            "import socket",
            "import importlib",
            "from tabulate import tabulate",
            "from datetime import datetime, timedelta",
            "",
            "try:",
            "    from systemd import journal",
            "    systemd_available=True",
            "except Exception:",
            "    logger.warning(\"Failed to load systemd library. logfile download not available\")",
            "    systemd_available=False",
            "",
            "class SystemController:",
            "",
            "    def __init__(self, cbpi):",
            "        self.cbpi = cbpi",
            "        self.service = cbpi.actor",
            "        self.logger = logging.getLogger(__name__)",
            "",
            "        self.cbpi.app.on_startup.append(self.check_for_update)",
            "",
            "",
            "    async def check_for_update(self, app):",
            "        pass",
            "",
            "    async def restart(self):",
            "        logging.info(\"RESTART\")",
            "        os.system('systemctl reboot') ",
            "        pass",
            "",
            "    async def shutdown(self):",
            "        logging.info(\"SHUTDOWN\")",
            "        os.system('systemctl poweroff') ",
            "        pass",
            "",
            "    async def backupConfig(self):",
            "        output_filename = \"cbpi4_config\"",
            "        dir_name = pathlib.Path(self.cbpi.config_folder.get_file_path(''))",
            "        shutil.make_archive(output_filename, 'zip', dir_name)",
            "",
            "    async def plugins_list(self): ",
            "        result = []",
            "        discovered_plugins = {",
            "            name: importlib.import_module(name)",
            "            for finder, name, ispkg",
            "            in pkgutil.iter_modules()",
            "            if name.startswith('cbpi') and len(name) > 4",
            "        }",
            "        for key, module in discovered_plugins.items():",
            "            from importlib.metadata import version",
            "            try:",
            "                from importlib.metadata import (distribution, metadata,",
            "                                                    version)",
            "                meta = metadata(key)",
            "                result.append(dict(Name=meta[\"Name\"], Version=meta[\"Version\"], Author=meta[\"Author\"], Homepage=meta[\"Home-page\"], Summary=meta[\"Summary\"]))",
            "                            ",
            "            except Exception as e:",
            "                print(e)",
            "        return tabulate(result, headers=\"keys\")",
            "",
            "    async def downloadlog(self, logtime):",
            "        filename = \"cbpi4.log\"",
            "        fullname = pathlib.Path(os.path.join(\".\",filename))",
            "        pluginname = \"cbpi4_plugins.txt\"",
            "        fullpluginname = pathlib.Path(os.path.join(\".\",pluginname))",
            "        actorname = \"cbpi4_actors.txt\"",
            "        fullactorname = pathlib.Path(os.path.join(\".\",actorname))",
            "        sensorname = \"cbpi4_sensors.txt\"",
            "        fullsensorname = pathlib.Path(os.path.join(\".\",sensorname))",
            "        kettlename = \"cbpi4_kettles.txt\"",
            "        fullkettlename = pathlib.Path(os.path.join(\".\",kettlename))",
            "",
            "        output_filename=\"cbpi4_log.zip\"",
            "        result=[]",
            "        if systemd_available:",
            "            j = journal.Reader()",
            "            if logtime == \"b\":",
            "                j.this_boot()",
            "            else:",
            "                since = datetime.now() - timedelta(hours=int(logtime))",
            "                j.seek_realtime(since)",
            "            j.add_match(_SYSTEMD_UNIT=\"craftbeerpi.service\")",
            "",
            "            for entry in j:",
            "                result.append(entry['MESSAGE'])",
            "        try:",
            "            with open(fullname, 'w') as f:",
            "                for line in result:",
            "                    f.write(f\"{line}\\n\")",
            "        except Exception as e:",
            "            logging.error(e)",
            "",
            "        plugins = await self.plugins_list()",
            "        with open(fullpluginname, 'w') as f:",
            "            f.write(plugins)",
            "",
            "        try:",
            "            actors = self.cbpi.actor.get_state()",
            "            json.dump(actors['data'],open(fullactorname,'w'),indent=4, sort_keys=True)",
            "            sensors = self.cbpi.sensor.get_state()",
            "            json.dump(sensors['data'],open(fullsensorname,'w'),indent=4, sort_keys=True)",
            "            kettles = self.cbpi.kettle.get_state()",
            "            json.dump(kettles['data'],open(fullkettlename,'w'),indent=4, sort_keys=True)",
            "        except Exception as e:",
            "            logging.info(e)",
            "            self.cbpi.notify(\"Error\", \"Creation of files failed: {}\".format(e), NotificationType.ERROR)",
            "",
            "        try:",
            "            zipObj=zipfile.ZipFile(output_filename , 'w', zipfile.ZIP_DEFLATED)",
            "            zipObj.write(fullname)",
            "            zipObj.write(fullpluginname)",
            "            zipObj.write(fullactorname)",
            "            zipObj.write(fullsensorname)",
            "            zipObj.write(fullkettlename)",
            "            zipObj.close()",
            "        except Exception as e:",
            "            logging.info(e)",
            "            self.cbpi.notify(\"Error\", \"Zip creation failed: {}\".format(e), NotificationType.ERROR)",
            "",
            "        try:",
            "            os.remove(fullname)",
            "            os.remove(fullpluginname)",
            "            os.remove(fullactorname)",
            "            os.remove(fullsensorname)",
            "            os.remove(fullkettlename)",
            "        except Exception as e:",
            "            logging.info(e)",
            "            self.cbpi.notify(\"Error\", \"Removal of original files failed: {}\".format(e), NotificationType.ERROR)",
            "",
            "",
            "    def allowed_file(self, filename, extension):",
            "        return '.' in filename and filename.rsplit('.', 1)[1] in set([extension])",
            "",
            "    def recursive_chown(self, path, owner, group):",
            "        for dirpath, dirnames, filenames in os.walk(path):",
            "            shutil.chown(dirpath, owner, group)",
            "            for filename in filenames:",
            "                shutil.chown(os.path.join(dirpath, filename), owner, group)",
            "",
            "    async def restoreConfig(self, data):",
            "        fileData = data['File']",
            "        filename = fileData.filename",
            "        backup_file = fileData.file",
            "        content_type = fileData.content_type",
            "        required_content=['dashboard/', 'recipes/', 'upload/', 'config.json', 'config.yaml']",
            "",
            "        if content_type == 'application/x-zip-compressed':",
            "            try:",
            "                content = backup_file.read()",
            "                if backup_file and self.allowed_file(filename, 'zip'):",
            "                    self.path = os.path.join(self.cbpi.config_folder.configFolderPath, \"restored_config.zip\")",
            "                    ",
            "                    f=open(self.path, \"wb\")",
            "                    f.write(content)",
            "                    f.close()",
            "                    zip=zipfile.ZipFile(self.path)",
            "                    zip_content_list = zip.namelist()",
            "                    zip_content = True",
            "                    for content in required_content:",
            "                        try:",
            "                            check = zip_content_list.index(content)",
            "                        except:",
            "                            zip_content = False",
            "                    if zip_content == True:",
            "                        self.cbpi.notify(\"Success\", \"Config backup has been uploaded\", NotificationType.SUCCESS)",
            "                        self.cbpi.notify(\"Action Required!\", \"Please restart the server\", NotificationType.WARNING)",
            "                    else:",
            "                        self.cbpi.notify(\"Error\", \"Wrong content type. Upload failed\", NotificationType.ERROR)",
            "                        os.remove(self.path)",
            "            except:",
            "                self.cbpi.notify(\"Error\", \"Config backup upload failed\", NotificationType.ERROR)",
            "                pass",
            "        else:",
            "            self.cbpi.notify(\"Error\", \"Wrong content type. Upload failed\", NotificationType.ERROR)",
            "",
            "    async def uploadSVG(self, data):",
            "        fileData = data['File']",
            "        filename = fileData.filename",
            "        svg_file = fileData.file",
            "        content_type = fileData.content_type",
            "",
            "        logging.info(content_type)",
            "",
            "        if content_type == 'image/svg+xml':",
            "            try:",
            "                content = svg_file.read().decode('utf-8','replace')",
            "                if svg_file and self.allowed_file(filename, 'svg'):",
            "                    self.path = os.path.join(self.cbpi.config_folder.get_file_path(\"dashboard\"),\"widgets\", filename)",
            "                    logging.info(self.path)",
            "",
            "                    f=open(self.path, \"w\")",
            "                    f.write(content)",
            "                    f.close()",
            "                    self.cbpi.notify(\"Success\", \"SVG file ({}) has been uploaded.\".format(filename), NotificationType.SUCCESS)",
            "            except:",
            "                self.cbpi.notify(\"Error\", \"SVG upload failed\", NotificationType.ERROR)",
            "                pass",
            "        else:",
            "            self.cbpi.notify(\"Error\", \"Wrong content type. Upload failed\", NotificationType.ERROR)",
            "",
            "    async def systeminfo(self):",
            "        logging.info(\"SYSTEMINFO\")",
            "        system = \"\" ",
            "        temp = 0",
            "        cpuload = 0",
            "        cpucount = 0",
            "        cpufreq = 0",
            "        totalmem = 0",
            "        availmem = 0",
            "        mempercent = 0",
            "        eth0IP = \"N/A\"",
            "        wlan0IP = \"N/A\"",
            "        eth0speed = \"N/A\"",
            "        wlan0speed = \"N/A\"       ",
            "",
            "        TEMP_UNIT=self.cbpi.config.get(\"TEMP_UNIT\", \"C\")",
            "        FAHRENHEIT = False if TEMP_UNIT == \"C\" else True",
            "",
            "        af_map = { socket.AF_INET: 'IPv4',",
            "                   socket.AF_INET6: 'IPv6',",
            "                   }",
            "",
            "        try:",
            "            if psutil.LINUX == True:",
            "                system = \"Linux\"",
            "            elif psutil.WINDOWS == True:",
            "                system = \"Windows\"",
            "            elif psutil.MACOS == True:",
            "                system = \"MacOS\"",
            "            cpuload = round(psutil.cpu_percent(interval=None),1)",
            "            cpucount = psutil.cpu_count(logical=False)",
            "            cpufreq = psutil.cpu_freq()",
            "            mem = psutil.virtual_memory()",
            "            availmem = round((int(mem.available) / (1024*1024)),1)",
            "            mempercent = round(float(mem.percent),1)",
            "            totalmem = round((int(mem.total) / (1024*1024)),1)",
            "            if system == \"Linux\":",
            "                try:",
            "                    temps = psutil.sensors_temperatures(fahrenheit=FAHRENHEIT)",
            "                    for name, entries in temps.items():",
            "                        for entry in entries:",
            "                            if name == \"cpu_thermal\":",
            "                                temp = round(float(entry.current),1)",
            "                except:",
            "                    pass",
            "            else:",
            "                temp = \"N/A\"",
            "            if system == \"Linux\":",
            "                try:",
            "                    ethernet = psutil.net_if_addrs()",
            "                    for nic, addrs in ethernet.items():",
            "                        if nic == \"eth0\":",
            "                            for addr in addrs:",
            "                                if str(addr.family) == \"AddressFamily.AF_INET\" or str(addr.family) == \"2\": ",
            "                                    if addr.address:",
            "                                        eth0IP = addr.address",
            "                        if nic == \"wlan0\":",
            "                            for addr in addrs:",
            "                                if str(addr.family) == \"AddressFamily.AF_INET\" or str(addr.family) == \"2\": ",
            "                                    if addr.address:",
            "                                        wlan0IP = addr.address",
            "                    info = psutil.net_if_stats()",
            "                    try:",
            "                        for nic in info:",
            "                            if nic == 'eth0':",
            "                                if info[nic].isup == True:",
            "                                    if info[nic].speed:",
            "                                        eth0speed = info[nic].speed",
            "                                else:",
            "                                    eth0speed = \"down\"",
            "                            if nic == 'wlan0':",
            "                                if info[nic].isup == True: ",
            "                                    ratestring = os.popen('iwlist wlan0 rate | grep Rate').read()",
            "                                    start = ratestring.find(\"=\") + 1",
            "                                    end = ratestring.find(\" Mb/s\")",
            "                                    wlan0speed = ratestring[start:end]",
            "                                else:",
            "                                    wlan0speed = \"down\"",
            "                    except Exception as e:",
            "                        logging.info(e)",
            "                except:",
            "                    pass",
            "",
            "            if system == \"Windows\":",
            "                try:",
            "                    ethernet = psutil.net_if_addrs()               ",
            "                    for nic, addrs in ethernet.items():",
            "                        if nic == \"Ethernet\":",
            "                            for addr in addrs:",
            "                                if str(addr.family) == \"AddressFamily.AF_INET\": ",
            "                                    if addr.address:",
            "                                        eth0IP = addr.address",
            "                        if nic == \"WLAN\":",
            "                            for addr in addrs:",
            "                                if str(addr.family) == \"AddressFamily.AF_INET\": ",
            "                                    if addr.address:",
            "                                        wlan0IP = addr.address",
            "                    info = psutil.net_if_stats()",
            "                    try:",
            "                        for nic in info:",
            "                            if nic == 'Ethernet':",
            "                                if info[nic].isup == True:",
            "                                    if info[nic].speed:",
            "                                        eth0speed = info[nic].speed",
            "                                else:",
            "                                    eth0speed = \"down\"",
            "                            if nic == 'WLAN':",
            "                                if info[nic].isup == True:",
            "                                    if info[nic].speed:",
            "                                        wlan0speed = info[nic].speed",
            "                                else:",
            "                                    wlan0speed = \"down\"                    ",
            "                    except Exception as e:",
            "                        logging.info(e)",
            "                except:",
            "                    pass",
            "",
            "        except:",
            "            pass",
            "",
            "        systeminfo =    {'system': system,",
            "                         'cpuload': cpuload,",
            "                         'cpucount': cpucount,",
            "                         'cpufreq': cpufreq.current,",
            "                         'totalmem': totalmem,",
            "                         'availmem': availmem,",
            "                         'mempercent': mempercent,",
            "                         'temp': temp,",
            "                         'temp_unit': TEMP_UNIT,",
            "                         'eth0': eth0IP,",
            "                         'wlan0': wlan0IP,",
            "                         'eth0speed': eth0speed,",
            "                         'wlan0speed': wlan0speed}",
            "        return systeminfo"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "2",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "81": [
                "SystemController"
            ],
            "82": [
                "SystemController"
            ],
            "83": [
                "SystemController"
            ],
            "84": [
                "SystemController"
            ],
            "87": [
                "SystemController"
            ],
            "91": [
                "SystemController"
            ],
            "92": [
                "SystemController"
            ]
        },
        "addLocation": [
            "cbpi.controller.system_controller.SystemController.self"
        ]
    },
    "setup.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 64,
                "afterPatchRowNumber": 64,
                "PatchRowcode": "           'importlib_metadata',"
            },
            "1": {
                "beforePatchRowNumber": 65,
                "afterPatchRowNumber": 65,
                "PatchRowcode": "           'numpy==1.26.4',"
            },
            "2": {
                "beforePatchRowNumber": 66,
                "afterPatchRowNumber": 66,
                "PatchRowcode": "           'pandas==2.2.2'] + ("
            },
            "3": {
                "beforePatchRowNumber": 67,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-          ['rpi-lgpio'] if raspberrypi else [] ),"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 67,
                "PatchRowcode": "+          ['rpi-lgpio'] if raspberrypi else [] ) + ("
            },
            "5": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 68,
                "PatchRowcode": "+          ['systemd-python'] if localsystem == \"Linux\" else [] ),"
            },
            "6": {
                "beforePatchRowNumber": 68,
                "afterPatchRowNumber": 69,
                "PatchRowcode": " "
            },
            "7": {
                "beforePatchRowNumber": 69,
                "afterPatchRowNumber": 70,
                "PatchRowcode": "         dependency_links=["
            },
            "8": {
                "beforePatchRowNumber": 70,
                "afterPatchRowNumber": 71,
                "PatchRowcode": "         'https://testpypi.python.org/pypi',"
            }
        },
        "frontPatchFile": [
            "from setuptools import setup, find_packages",
            "from cbpi import __version__",
            "import platform",
            "",
            "# read the contents of your README file",
            "from os import popen, path",
            "",
            "localsystem = platform.system()",
            "raspberrypi=False",
            "if localsystem == \"Linux\":",
            "    command=\"cat /proc/cpuinfo | grep 'Raspberry'\"",
            "    model=popen(command).read()",
            "    if len(model) != 0:",
            "        raspberrypi=True",
            "",
            "# read the contents of your README file",
            "this_directory = path.abspath(path.dirname(__file__))",
            "with open(path.join(this_directory, 'README.md'), encoding='utf-8') as f:",
            "    long_description = f.read()",
            "",
            "setup(name='cbpi4',",
            "      version=__version__,",
            "      description='CraftBeerPi4 Brewing Software',",
            "      author='Manuel Fritsch / Alexander Vollkopf',",
            "      author_email='manuel@craftbeerpi.com',",
            "      url='http://web.craftbeerpi.com',",
            "      license='GPLv3',",
            "      project_urls={",
            "\t    'Documentation': 'https://openbrewing.gitbook.io/craftbeerpi4_support/'},",
            "      packages=find_packages(),",
            "      include_package_data=True,",
            "      package_data={",
            "        # If any package contains *.txt or *.rst files, include them:",
            "      '': ['*.txt', '*.rst', '*.yaml'],",
            "      'cbpi': ['*','*.txt', '*.rst', '*.yaml']},",
            "",
            "      python_requires='>=3.9',",
            "      long_description=long_description,",
            "\t    long_description_content_type='text/markdown',",
            "      install_requires=[",
            "          \"typing-extensions>=4\",",
            "          \"aiohttp==3.9.4\",",
            "          \"aiohttp-auth==0.1.1\",",
            "          \"aiohttp-route-decorator==0.1.4\",",
            "          \"aiohttp-security==0.5.0\",",
            "          \"aiohttp-session==2.12.0\",",
            "          \"aiohttp-swagger==1.0.16\",",
            "          \"async-timeout==4.0.3\",",
            "          \"aiojobs==1.2.1 \",",
            "          \"aiosqlite==0.17.0\",",
            "          \"cryptography==42.0.5\",",
            "          \"pyopenssl==24.1.0\",",
            "          \"requests==2.31.0\",",
            "          \"voluptuous==0.14.2\",",
            "          \"pyfiglet==1.0.2\",",
            "          'click==8.1.7',",
            "          'shortuuid==1.0.13',",
            "          'tabulate==0.9.0',",
            "          'aiomqtt==2.0.1',",
            "          'inquirer==3.2.4',",
            "          'colorama==0.4.6',",
            "          'psutil==5.9.8',",
            "          'cbpi4gui',",
            "          'importlib_metadata',",
            "          'numpy==1.26.4',",
            "          'pandas==2.2.2'] + (",
            "          ['rpi-lgpio'] if raspberrypi else [] ),",
            "",
            "        dependency_links=[",
            "        'https://testpypi.python.org/pypi',",
            "        ",
            "        ],",
            "      entry_points = {",
            "        \"console_scripts\": [",
            "            \"cbpi=cbpi.cli:main\",",
            "        ]",
            "    }",
            ")"
        ],
        "afterPatchFile": [
            "from setuptools import setup, find_packages",
            "from cbpi import __version__",
            "import platform",
            "",
            "# read the contents of your README file",
            "from os import popen, path",
            "",
            "localsystem = platform.system()",
            "raspberrypi=False",
            "if localsystem == \"Linux\":",
            "    command=\"cat /proc/cpuinfo | grep 'Raspberry'\"",
            "    model=popen(command).read()",
            "    if len(model) != 0:",
            "        raspberrypi=True",
            "",
            "# read the contents of your README file",
            "this_directory = path.abspath(path.dirname(__file__))",
            "with open(path.join(this_directory, 'README.md'), encoding='utf-8') as f:",
            "    long_description = f.read()",
            "",
            "setup(name='cbpi4',",
            "      version=__version__,",
            "      description='CraftBeerPi4 Brewing Software',",
            "      author='Manuel Fritsch / Alexander Vollkopf',",
            "      author_email='manuel@craftbeerpi.com',",
            "      url='http://web.craftbeerpi.com',",
            "      license='GPLv3',",
            "      project_urls={",
            "\t    'Documentation': 'https://openbrewing.gitbook.io/craftbeerpi4_support/'},",
            "      packages=find_packages(),",
            "      include_package_data=True,",
            "      package_data={",
            "        # If any package contains *.txt or *.rst files, include them:",
            "      '': ['*.txt', '*.rst', '*.yaml'],",
            "      'cbpi': ['*','*.txt', '*.rst', '*.yaml']},",
            "",
            "      python_requires='>=3.9',",
            "      long_description=long_description,",
            "\t    long_description_content_type='text/markdown',",
            "      install_requires=[",
            "          \"typing-extensions>=4\",",
            "          \"aiohttp==3.9.4\",",
            "          \"aiohttp-auth==0.1.1\",",
            "          \"aiohttp-route-decorator==0.1.4\",",
            "          \"aiohttp-security==0.5.0\",",
            "          \"aiohttp-session==2.12.0\",",
            "          \"aiohttp-swagger==1.0.16\",",
            "          \"async-timeout==4.0.3\",",
            "          \"aiojobs==1.2.1 \",",
            "          \"aiosqlite==0.17.0\",",
            "          \"cryptography==42.0.5\",",
            "          \"pyopenssl==24.1.0\",",
            "          \"requests==2.31.0\",",
            "          \"voluptuous==0.14.2\",",
            "          \"pyfiglet==1.0.2\",",
            "          'click==8.1.7',",
            "          'shortuuid==1.0.13',",
            "          'tabulate==0.9.0',",
            "          'aiomqtt==2.0.1',",
            "          'inquirer==3.2.4',",
            "          'colorama==0.4.6',",
            "          'psutil==5.9.8',",
            "          'cbpi4gui',",
            "          'importlib_metadata',",
            "          'numpy==1.26.4',",
            "          'pandas==2.2.2'] + (",
            "          ['rpi-lgpio'] if raspberrypi else [] ) + (",
            "          ['systemd-python'] if localsystem == \"Linux\" else [] ),",
            "",
            "        dependency_links=[",
            "        'https://testpypi.python.org/pypi',",
            "        ",
            "        ],",
            "      entry_points = {",
            "        \"console_scripts\": [",
            "            \"cbpi=cbpi.cli:main\",",
            "        ]",
            "    }",
            ")"
        ],
        "action": [
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "67": []
        },
        "addLocation": []
    }
}