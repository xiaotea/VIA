{
    "manila_ui/dashboards/admin/shares/tabs.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 12,
                "afterPatchRowNumber": 12,
                "PatchRowcode": " #    License for the specific language governing permissions and limitations"
            },
            "1": {
                "beforePatchRowNumber": 13,
                "afterPatchRowNumber": 13,
                "PatchRowcode": " #    under the License."
            },
            "2": {
                "beforePatchRowNumber": 14,
                "afterPatchRowNumber": 14,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": 15,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-from django.utils.safestring import mark_safe"
            },
            "4": {
                "beforePatchRowNumber": 16,
                "afterPatchRowNumber": 15,
                "PatchRowcode": " from django.utils.translation import ugettext_lazy as _"
            },
            "5": {
                "beforePatchRowNumber": 17,
                "afterPatchRowNumber": 16,
                "PatchRowcode": " "
            },
            "6": {
                "beforePatchRowNumber": 18,
                "afterPatchRowNumber": 17,
                "PatchRowcode": " from horizon import exceptions"
            },
            "7": {
                "beforePatchRowNumber": 25,
                "afterPatchRowNumber": 24,
                "PatchRowcode": " from manila_ui.api import network"
            },
            "8": {
                "beforePatchRowNumber": 26,
                "afterPatchRowNumber": 25,
                "PatchRowcode": " from manila_ui.dashboards.admin.shares import tables"
            },
            "9": {
                "beforePatchRowNumber": 27,
                "afterPatchRowNumber": 26,
                "PatchRowcode": " from manila_ui.dashboards.admin.shares import utils"
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 27,
                "PatchRowcode": "+from manila_ui.dashboards import utils as common_utils"
            },
            "11": {
                "beforePatchRowNumber": 28,
                "afterPatchRowNumber": 28,
                "PatchRowcode": " "
            },
            "12": {
                "beforePatchRowNumber": 29,
                "afterPatchRowNumber": 29,
                "PatchRowcode": " "
            },
            "13": {
                "beforePatchRowNumber": 30,
                "afterPatchRowNumber": 30,
                "PatchRowcode": " class SnapshotsTab(tabs.TableTab):"
            },
            "14": {
                "beforePatchRowNumber": 104,
                "afterPatchRowNumber": 104,
                "PatchRowcode": "                               _(\"Unable to retrieve share types\"))"
            },
            "15": {
                "beforePatchRowNumber": 105,
                "afterPatchRowNumber": 105,
                "PatchRowcode": "         # Convert dict with extra specs to friendly view"
            },
            "16": {
                "beforePatchRowNumber": 106,
                "afterPatchRowNumber": 106,
                "PatchRowcode": "         for st in share_types:"
            },
            "17": {
                "beforePatchRowNumber": 107,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            es_str = \"\""
            },
            "18": {
                "beforePatchRowNumber": 108,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            for k, v in st.extra_specs.iteritems():"
            },
            "19": {
                "beforePatchRowNumber": 109,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                es_str += \"%s=%s\\r\\n<br />\" % (k, v)"
            },
            "20": {
                "beforePatchRowNumber": 110,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            st.extra_specs = mark_safe(es_str)"
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 107,
                "PatchRowcode": "+            st.extra_specs = common_utils.metadata_to_str("
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 108,
                "PatchRowcode": "+                st.extra_specs, 8, 45)"
            },
            "23": {
                "beforePatchRowNumber": 111,
                "afterPatchRowNumber": 109,
                "PatchRowcode": "         return share_types"
            },
            "24": {
                "beforePatchRowNumber": 112,
                "afterPatchRowNumber": 110,
                "PatchRowcode": " "
            },
            "25": {
                "beforePatchRowNumber": 113,
                "afterPatchRowNumber": 111,
                "PatchRowcode": " "
            }
        },
        "frontPatchFile": [
            "# Copyright 2014 OpenStack Foundation",
            "#",
            "#    Licensed under the Apache License, Version 2.0 (the \"License\"); you may",
            "#    not use this file except in compliance with the License. You may obtain",
            "#    a copy of the License at",
            "#",
            "#         http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "#    Unless required by applicable law or agreed to in writing, software",
            "#    distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
            "#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
            "#    License for the specific language governing permissions and limitations",
            "#    under the License.",
            "",
            "from django.utils.safestring import mark_safe",
            "from django.utils.translation import ugettext_lazy as _",
            "",
            "from horizon import exceptions",
            "from horizon import tabs",
            "",
            "from openstack_dashboard.api import base",
            "from openstack_dashboard.api import neutron",
            "",
            "from manila_ui.api import manila",
            "from manila_ui.api import network",
            "from manila_ui.dashboards.admin.shares import tables",
            "from manila_ui.dashboards.admin.shares import utils",
            "",
            "",
            "class SnapshotsTab(tabs.TableTab):",
            "    table_classes = (tables.SnapshotsTable, )",
            "    name = _(\"Snapshots\")",
            "    slug = \"snapshots_tab\"",
            "    template_name = \"horizon/common/_detail_table.html\"",
            "",
            "    def _set_id_if_nameless(self, snapshots):",
            "        for snap in snapshots:",
            "            if not snap.name:",
            "                snap.name = snap.id",
            "",
            "    def get_snapshots_data(self):",
            "        snapshots = []",
            "        try:",
            "            snapshots = manila.share_snapshot_list(",
            "                self.request, search_opts={'all_tenants': True})",
            "            shares = manila.share_list(self.request)",
            "            share_names = dict([(share.id, share.name or share.id)",
            "                                for share in shares])",
            "            for snapshot in snapshots:",
            "                snapshot.share = share_names.get(snapshot.share_id)",
            "        except Exception:",
            "            msg = _(\"Unable to retrieve snapshot list.\")",
            "            exceptions.handle(self.request, msg)",
            "",
            "        # Gather our tenants to correlate against IDs",
            "        utils.set_tenant_name_to_objects(self.request, snapshots)",
            "",
            "        return snapshots",
            "",
            "",
            "class SharesTab(tabs.TableTab):",
            "    table_classes = (tables.SharesTable, )",
            "    name = _(\"Shares\")",
            "    slug = \"shares_tab\"",
            "    template_name = \"horizon/common/_detail_table.html\"",
            "",
            "    def get_shares_data(self):",
            "        shares = []",
            "        try:",
            "            shares = manila.share_list(",
            "                self.request, search_opts={'all_tenants': True})",
            "            snapshots = manila.share_snapshot_list(",
            "                self.request, detailed=True, search_opts={'all_tenants': True})",
            "            share_ids_with_snapshots = []",
            "            for snapshot in snapshots:",
            "                share_ids_with_snapshots.append(snapshot.to_dict()['share_id'])",
            "            for share in shares:",
            "                if share.to_dict()['id'] in share_ids_with_snapshots:",
            "                    setattr(share, 'has_snapshot', True)",
            "                else:",
            "                    setattr(share, 'has_snapshot', False)",
            "        except Exception:",
            "            exceptions.handle(",
            "                self.request, _('Unable to retrieve share list.'))",
            "",
            "        # Gather our tenants to correlate against IDs",
            "        utils.set_tenant_name_to_objects(self.request, shares)",
            "",
            "        return shares",
            "",
            "",
            "class ShareTypesTab(tabs.TableTab):",
            "    table_classes = (tables.ShareTypesTable, )",
            "    name = _(\"Share Types\")",
            "    slug = \"share_types_tab\"",
            "    template_name = \"horizon/common/_detail_table.html\"",
            "",
            "    def get_share_types_data(self):",
            "        try:",
            "            share_types = manila.share_type_list(self.request)",
            "        except Exception:",
            "            share_types = []",
            "            exceptions.handle(self.request,",
            "                              _(\"Unable to retrieve share types\"))",
            "        # Convert dict with extra specs to friendly view",
            "        for st in share_types:",
            "            es_str = \"\"",
            "            for k, v in st.extra_specs.iteritems():",
            "                es_str += \"%s=%s\\r\\n<br />\" % (k, v)",
            "            st.extra_specs = mark_safe(es_str)",
            "        return share_types",
            "",
            "",
            "class SecurityServiceTab(tabs.TableTab):",
            "    table_classes = (tables.SecurityServiceTable,)",
            "    name = _(\"Security Services\")",
            "    slug = \"security_services_tab\"",
            "    template_name = \"horizon/common/_detail_table.html\"",
            "",
            "    def get_security_services_data(self):",
            "        try:",
            "            security_services = manila.security_service_list(",
            "                self.request, search_opts={'all_tenants': True})",
            "        except Exception:",
            "            security_services = []",
            "            exceptions.handle(self.request,",
            "                              _(\"Unable to retrieve security services\"))",
            "",
            "        utils.set_tenant_name_to_objects(self.request, security_services)",
            "        return security_services",
            "",
            "",
            "class ShareNetworkTab(tabs.TableTab):",
            "    name = _(\"Share Networks\")",
            "    slug = \"share_networks_tab\"",
            "    template_name = \"horizon/common/_detail_table.html\"",
            "",
            "    def __init__(self, tab_group, request):",
            "        if base.is_service_enabled(request, 'network'):",
            "            self.table_classes = (tables.NeutronShareNetworkTable,)",
            "        else:",
            "            self.table_classes = (tables.NovaShareNetworkTable,)",
            "        super(ShareNetworkTab, self).__init__(tab_group, request)",
            "",
            "    def get_share_networks_data(self):",
            "        try:",
            "            share_networks = manila.share_network_list(",
            "                self.request, detailed=True, search_opts={'all_tenants': True})",
            "            if base.is_service_enabled(self.request, 'network'):",
            "                neutron_net_names = dict((net.id, net.name) for net in",
            "                                         neutron.network_list(self.request))",
            "                neutron_subnet_names = dict((net.id, net.name) for net in",
            "                                            neutron.subnet_list(self.request))",
            "                for sn in share_networks:",
            "                    sn.neutron_net = neutron_net_names.get(",
            "                        sn.neutron_net_id) or sn.neutron_net_id or \"-\"",
            "                    sn.neutron_subnet = neutron_subnet_names.get(",
            "                        sn.neutron_subnet_id) or sn.neutron_subnet_id or \"-\"",
            "            else:",
            "                nova_net_names = dict(",
            "                    [(net.id, net.label)",
            "                     for net in network.network_list(self.request)])",
            "                for sn in share_networks:",
            "                    sn.nova_net = nova_net_names.get(",
            "                        sn.nova_net_id) or sn.nova_net_id or \"-\"",
            "        except Exception:",
            "            share_networks = []",
            "            exceptions.handle(self.request,",
            "                              _(\"Unable to retrieve share networks\"))",
            "        utils.set_tenant_name_to_objects(self.request, share_networks)",
            "        return share_networks",
            "",
            "",
            "class ShareServerTab(tabs.TableTab):",
            "    table_classes = (tables.ShareServerTable,)",
            "    name = _(\"Share Servers\")",
            "    slug = \"share_servers_tab\"",
            "    template_name = \"horizon/common/_detail_table.html\"",
            "",
            "    def get_share_servers_data(self):",
            "        try:",
            "            share_servers = manila.share_server_list(",
            "                self.request)",
            "        except Exception:",
            "            share_servers = []",
            "            exceptions.handle(self.request,",
            "                              _(\"Unable to retrieve share servers\"))",
            "        utils.set_tenant_name_to_objects(self.request, share_servers)",
            "        return share_servers",
            "",
            "",
            "class ShareServerOverviewTab(tabs.Tab):",
            "    name = _(\"Overview\")",
            "    slug = \"overview\"",
            "    template_name = (\"admin/shares/_detail_share_server.html\")",
            "",
            "    def get_context_data(self, request):",
            "        return {\"share_server\": self.tab_group.kwargs['share_server']}",
            "",
            "",
            "class ShareServerDetailTabs(tabs.TabGroup):",
            "    slug = \"share_server_details\"",
            "    tabs = (ShareServerOverviewTab,)",
            "",
            "",
            "class ShareTabs(tabs.TabGroup):",
            "    slug = \"share_tabs\"",
            "    tabs = (SharesTab, SnapshotsTab, ShareNetworkTab, SecurityServiceTab,",
            "            ShareTypesTab, ShareServerTab)",
            "    sticky = True",
            "",
            "",
            "class SnapshotOverviewTab(tabs.Tab):",
            "    name = _(\"Snapshot Overview\")",
            "    slug = \"snapshot_overview_tab\"",
            "    template_name = (\"admin/shares/\"",
            "                     \"_snapshot_detail_overview.html\")",
            "",
            "    def get_context_data(self, request):",
            "        return {\"snapshot\": self.tab_group.kwargs['snapshot']}",
            "",
            "",
            "class SnapshotDetailTabs(tabs.TabGroup):",
            "    slug = \"snapshot_details\"",
            "    tabs = (SnapshotOverviewTab,)"
        ],
        "afterPatchFile": [
            "# Copyright 2014 OpenStack Foundation",
            "#",
            "#    Licensed under the Apache License, Version 2.0 (the \"License\"); you may",
            "#    not use this file except in compliance with the License. You may obtain",
            "#    a copy of the License at",
            "#",
            "#         http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "#    Unless required by applicable law or agreed to in writing, software",
            "#    distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
            "#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
            "#    License for the specific language governing permissions and limitations",
            "#    under the License.",
            "",
            "from django.utils.translation import ugettext_lazy as _",
            "",
            "from horizon import exceptions",
            "from horizon import tabs",
            "",
            "from openstack_dashboard.api import base",
            "from openstack_dashboard.api import neutron",
            "",
            "from manila_ui.api import manila",
            "from manila_ui.api import network",
            "from manila_ui.dashboards.admin.shares import tables",
            "from manila_ui.dashboards.admin.shares import utils",
            "from manila_ui.dashboards import utils as common_utils",
            "",
            "",
            "class SnapshotsTab(tabs.TableTab):",
            "    table_classes = (tables.SnapshotsTable, )",
            "    name = _(\"Snapshots\")",
            "    slug = \"snapshots_tab\"",
            "    template_name = \"horizon/common/_detail_table.html\"",
            "",
            "    def _set_id_if_nameless(self, snapshots):",
            "        for snap in snapshots:",
            "            if not snap.name:",
            "                snap.name = snap.id",
            "",
            "    def get_snapshots_data(self):",
            "        snapshots = []",
            "        try:",
            "            snapshots = manila.share_snapshot_list(",
            "                self.request, search_opts={'all_tenants': True})",
            "            shares = manila.share_list(self.request)",
            "            share_names = dict([(share.id, share.name or share.id)",
            "                                for share in shares])",
            "            for snapshot in snapshots:",
            "                snapshot.share = share_names.get(snapshot.share_id)",
            "        except Exception:",
            "            msg = _(\"Unable to retrieve snapshot list.\")",
            "            exceptions.handle(self.request, msg)",
            "",
            "        # Gather our tenants to correlate against IDs",
            "        utils.set_tenant_name_to_objects(self.request, snapshots)",
            "",
            "        return snapshots",
            "",
            "",
            "class SharesTab(tabs.TableTab):",
            "    table_classes = (tables.SharesTable, )",
            "    name = _(\"Shares\")",
            "    slug = \"shares_tab\"",
            "    template_name = \"horizon/common/_detail_table.html\"",
            "",
            "    def get_shares_data(self):",
            "        shares = []",
            "        try:",
            "            shares = manila.share_list(",
            "                self.request, search_opts={'all_tenants': True})",
            "            snapshots = manila.share_snapshot_list(",
            "                self.request, detailed=True, search_opts={'all_tenants': True})",
            "            share_ids_with_snapshots = []",
            "            for snapshot in snapshots:",
            "                share_ids_with_snapshots.append(snapshot.to_dict()['share_id'])",
            "            for share in shares:",
            "                if share.to_dict()['id'] in share_ids_with_snapshots:",
            "                    setattr(share, 'has_snapshot', True)",
            "                else:",
            "                    setattr(share, 'has_snapshot', False)",
            "        except Exception:",
            "            exceptions.handle(",
            "                self.request, _('Unable to retrieve share list.'))",
            "",
            "        # Gather our tenants to correlate against IDs",
            "        utils.set_tenant_name_to_objects(self.request, shares)",
            "",
            "        return shares",
            "",
            "",
            "class ShareTypesTab(tabs.TableTab):",
            "    table_classes = (tables.ShareTypesTable, )",
            "    name = _(\"Share Types\")",
            "    slug = \"share_types_tab\"",
            "    template_name = \"horizon/common/_detail_table.html\"",
            "",
            "    def get_share_types_data(self):",
            "        try:",
            "            share_types = manila.share_type_list(self.request)",
            "        except Exception:",
            "            share_types = []",
            "            exceptions.handle(self.request,",
            "                              _(\"Unable to retrieve share types\"))",
            "        # Convert dict with extra specs to friendly view",
            "        for st in share_types:",
            "            st.extra_specs = common_utils.metadata_to_str(",
            "                st.extra_specs, 8, 45)",
            "        return share_types",
            "",
            "",
            "class SecurityServiceTab(tabs.TableTab):",
            "    table_classes = (tables.SecurityServiceTable,)",
            "    name = _(\"Security Services\")",
            "    slug = \"security_services_tab\"",
            "    template_name = \"horizon/common/_detail_table.html\"",
            "",
            "    def get_security_services_data(self):",
            "        try:",
            "            security_services = manila.security_service_list(",
            "                self.request, search_opts={'all_tenants': True})",
            "        except Exception:",
            "            security_services = []",
            "            exceptions.handle(self.request,",
            "                              _(\"Unable to retrieve security services\"))",
            "",
            "        utils.set_tenant_name_to_objects(self.request, security_services)",
            "        return security_services",
            "",
            "",
            "class ShareNetworkTab(tabs.TableTab):",
            "    name = _(\"Share Networks\")",
            "    slug = \"share_networks_tab\"",
            "    template_name = \"horizon/common/_detail_table.html\"",
            "",
            "    def __init__(self, tab_group, request):",
            "        if base.is_service_enabled(request, 'network'):",
            "            self.table_classes = (tables.NeutronShareNetworkTable,)",
            "        else:",
            "            self.table_classes = (tables.NovaShareNetworkTable,)",
            "        super(ShareNetworkTab, self).__init__(tab_group, request)",
            "",
            "    def get_share_networks_data(self):",
            "        try:",
            "            share_networks = manila.share_network_list(",
            "                self.request, detailed=True, search_opts={'all_tenants': True})",
            "            if base.is_service_enabled(self.request, 'network'):",
            "                neutron_net_names = dict((net.id, net.name) for net in",
            "                                         neutron.network_list(self.request))",
            "                neutron_subnet_names = dict((net.id, net.name) for net in",
            "                                            neutron.subnet_list(self.request))",
            "                for sn in share_networks:",
            "                    sn.neutron_net = neutron_net_names.get(",
            "                        sn.neutron_net_id) or sn.neutron_net_id or \"-\"",
            "                    sn.neutron_subnet = neutron_subnet_names.get(",
            "                        sn.neutron_subnet_id) or sn.neutron_subnet_id or \"-\"",
            "            else:",
            "                nova_net_names = dict(",
            "                    [(net.id, net.label)",
            "                     for net in network.network_list(self.request)])",
            "                for sn in share_networks:",
            "                    sn.nova_net = nova_net_names.get(",
            "                        sn.nova_net_id) or sn.nova_net_id or \"-\"",
            "        except Exception:",
            "            share_networks = []",
            "            exceptions.handle(self.request,",
            "                              _(\"Unable to retrieve share networks\"))",
            "        utils.set_tenant_name_to_objects(self.request, share_networks)",
            "        return share_networks",
            "",
            "",
            "class ShareServerTab(tabs.TableTab):",
            "    table_classes = (tables.ShareServerTable,)",
            "    name = _(\"Share Servers\")",
            "    slug = \"share_servers_tab\"",
            "    template_name = \"horizon/common/_detail_table.html\"",
            "",
            "    def get_share_servers_data(self):",
            "        try:",
            "            share_servers = manila.share_server_list(",
            "                self.request)",
            "        except Exception:",
            "            share_servers = []",
            "            exceptions.handle(self.request,",
            "                              _(\"Unable to retrieve share servers\"))",
            "        utils.set_tenant_name_to_objects(self.request, share_servers)",
            "        return share_servers",
            "",
            "",
            "class ShareServerOverviewTab(tabs.Tab):",
            "    name = _(\"Overview\")",
            "    slug = \"overview\"",
            "    template_name = (\"admin/shares/_detail_share_server.html\")",
            "",
            "    def get_context_data(self, request):",
            "        return {\"share_server\": self.tab_group.kwargs['share_server']}",
            "",
            "",
            "class ShareServerDetailTabs(tabs.TabGroup):",
            "    slug = \"share_server_details\"",
            "    tabs = (ShareServerOverviewTab,)",
            "",
            "",
            "class ShareTabs(tabs.TabGroup):",
            "    slug = \"share_tabs\"",
            "    tabs = (SharesTab, SnapshotsTab, ShareNetworkTab, SecurityServiceTab,",
            "            ShareTypesTab, ShareServerTab)",
            "    sticky = True",
            "",
            "",
            "class SnapshotOverviewTab(tabs.Tab):",
            "    name = _(\"Snapshot Overview\")",
            "    slug = \"snapshot_overview_tab\"",
            "    template_name = (\"admin/shares/\"",
            "                     \"_snapshot_detail_overview.html\")",
            "",
            "    def get_context_data(self, request):",
            "        return {\"snapshot\": self.tab_group.kwargs['snapshot']}",
            "",
            "",
            "class SnapshotDetailTabs(tabs.TabGroup):",
            "    slug = \"snapshot_details\"",
            "    tabs = (SnapshotOverviewTab,)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "15": [],
            "107": [
                "ShareTypesTab",
                "get_share_types_data"
            ],
            "108": [
                "ShareTypesTab",
                "get_share_types_data"
            ],
            "109": [
                "ShareTypesTab",
                "get_share_types_data"
            ],
            "110": [
                "ShareTypesTab",
                "get_share_types_data"
            ]
        },
        "addLocation": []
    },
    "manila_ui/dashboards/project/shares/shares/tables.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 17,
                "afterPatchRowNumber": 17,
                "PatchRowcode": " from django.core.urlresolvers import NoReverseMatch  # noqa"
            },
            "1": {
                "beforePatchRowNumber": 18,
                "afterPatchRowNumber": 18,
                "PatchRowcode": " from django.core.urlresolvers import reverse"
            },
            "2": {
                "beforePatchRowNumber": 19,
                "afterPatchRowNumber": 19,
                "PatchRowcode": " from django.template.defaultfilters import title  # noqa"
            },
            "3": {
                "beforePatchRowNumber": 20,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-from django.utils.safestring import mark_safe"
            },
            "4": {
                "beforePatchRowNumber": 21,
                "afterPatchRowNumber": 20,
                "PatchRowcode": " from django.utils.translation import string_concat, ugettext_lazy  # noqa"
            },
            "5": {
                "beforePatchRowNumber": 22,
                "afterPatchRowNumber": 21,
                "PatchRowcode": " from django.utils.translation import pgettext_lazy"
            },
            "6": {
                "beforePatchRowNumber": 23,
                "afterPatchRowNumber": 22,
                "PatchRowcode": " from django.utils.translation import ugettext_lazy as _"
            },
            "7": {
                "beforePatchRowNumber": 150,
                "afterPatchRowNumber": 149,
                "PatchRowcode": "             share.share_network = share_net.name or share_net.id"
            },
            "8": {
                "beforePatchRowNumber": 151,
                "afterPatchRowNumber": 150,
                "PatchRowcode": "         else:"
            },
            "9": {
                "beforePatchRowNumber": 152,
                "afterPatchRowNumber": 151,
                "PatchRowcode": "             share.share_network = None"
            },
            "10": {
                "beforePatchRowNumber": 153,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        meta_str = utils.metadata_to_str(share.metadata)"
            },
            "11": {
                "beforePatchRowNumber": 154,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        share.metadata = mark_safe(meta_str)"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 152,
                "PatchRowcode": "+        share.metadata = utils.metadata_to_str(share.metadata)"
            },
            "13": {
                "beforePatchRowNumber": 155,
                "afterPatchRowNumber": 153,
                "PatchRowcode": " "
            },
            "14": {
                "beforePatchRowNumber": 156,
                "afterPatchRowNumber": 154,
                "PatchRowcode": "         return share"
            },
            "15": {
                "beforePatchRowNumber": 157,
                "afterPatchRowNumber": 155,
                "PatchRowcode": " "
            }
        },
        "frontPatchFile": [
            "# vim: tabstop=4 shiftwidth=4 softtabstop=4",
            "",
            "# Copyright 2012 Nebula, Inc.",
            "#",
            "#    Licensed under the Apache License, Version 2.0 (the \"License\"); you may",
            "#    not use this file except in compliance with the License. You may obtain",
            "#    a copy of the License at",
            "#",
            "#         http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "#    Unless required by applicable law or agreed to in writing, software",
            "#    distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
            "#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
            "#    License for the specific language governing permissions and limitations",
            "#    under the License.",
            "",
            "from django.core.urlresolvers import NoReverseMatch  # noqa",
            "from django.core.urlresolvers import reverse",
            "from django.template.defaultfilters import title  # noqa",
            "from django.utils.safestring import mark_safe",
            "from django.utils.translation import string_concat, ugettext_lazy  # noqa",
            "from django.utils.translation import pgettext_lazy",
            "from django.utils.translation import ugettext_lazy as _",
            "from horizon import exceptions",
            "from horizon import messages",
            "from horizon import tables",
            "from manila_ui.api import manila",
            "from manila_ui.dashboards.project.shares.snapshots \\",
            "    import tables as snapshot_tables",
            "from manila_ui.dashboards import utils",
            "from openstack_dashboard.usage import quotas",
            "",
            "",
            "DELETABLE_STATES = (",
            "    \"AVAILABLE\", \"ERROR\",",
            "    \"MANAGE_ERROR\",",
            ")",
            "",
            "",
            "class DeleteShare(tables.DeleteAction):",
            "    data_type_singular = _(\"Share\")",
            "    data_type_plural = _(\"Shares\")",
            "    action_past = _(\"Scheduled deletion of %(data_type)s\")",
            "    policy_rules = ((\"share\", \"share:delete\"),)",
            "",
            "    def get_policy_target(self, request, datum=None):",
            "        project_id = None",
            "        if datum:",
            "            project_id = getattr(datum, \"os-share-tenant-attr:tenant_id\", None)",
            "        return {\"project_id\": project_id}",
            "",
            "    def delete(self, request, obj_id):",
            "        try:",
            "            manila.share_delete(request, obj_id)",
            "        except Exception:",
            "            msg = _('Unable to delete share \"%s\". ') % obj_id",
            "            messages.error(request, msg)",
            "",
            "    def allowed(self, request, share=None):",
            "        if share:",
            "            # Row button",
            "            return (share.status.upper() in DELETABLE_STATES and",
            "                    not getattr(share, 'has_snapshot', False))",
            "        # Table button. Always return 'True'.",
            "        return True",
            "",
            "",
            "class CreateShare(tables.LinkAction):",
            "    name = \"create\"",
            "    verbose_name = _(\"Create Share\")",
            "    url = \"horizon:project:shares:create\"",
            "    classes = (\"ajax-modal\", \"btn-create\")",
            "    policy_rules = ((\"share\", \"share:create\"),)",
            "",
            "    def allowed(self, request, share=None):",
            "        usages = quotas.tenant_quota_usages(request)",
            "        if usages['shares']['available'] <= 0:",
            "            if \"disabled\" not in self.classes:",
            "                self.classes = [c for c in self.classes] + ['disabled']",
            "                self.verbose_name = string_concat(self.verbose_name, ' ',",
            "                                                  _(\"(Quota exceeded)\"))",
            "        else:",
            "            self.verbose_name = _(\"Create Share\")",
            "            classes = [c for c in self.classes if c != \"disabled\"]",
            "            self.classes = classes",
            "        return True",
            "",
            "",
            "class EditShare(tables.LinkAction):",
            "    name = \"edit\"",
            "    verbose_name = _(\"Edit Share\")",
            "    url = \"horizon:project:shares:update\"",
            "    classes = (\"ajax-modal\", \"btn-create\")",
            "    policy_rules = ((\"share\", \"share:update\"),)",
            "",
            "    def get_policy_target(self, request, datum=None):",
            "        project_id = None",
            "        if datum:",
            "            project_id = getattr(datum, \"os-share-tenant-attr:tenant_id\", None)",
            "        return {\"project_id\": project_id}",
            "",
            "    def allowed(self, request, share=None):",
            "        return share.status in (\"available\", \"in-use\")",
            "",
            "",
            "class EditShareMetadata(tables.LinkAction):",
            "    name = \"update_metadata\"",
            "    verbose_name = _(\"Edit Share Metadata\")",
            "    url = \"horizon:project:shares:update_metadata\"",
            "    classes = (\"ajax-modal\", \"btn-create\")",
            "    policy_rules = ((\"share\", \"share:update_share_metadata\"),)",
            "",
            "    def get_policy_target(self, request, datum=None):",
            "        project_id = None",
            "        if datum:",
            "            project_id = getattr(datum, \"os-share-tenant-attr:tenant_id\", None)",
            "        return {\"project_id\": project_id}",
            "",
            "    def allowed(self, request, share=None):",
            "        return share.status in (\"available\", \"in-use\")",
            "",
            "",
            "class ExtendShare(tables.LinkAction):",
            "    name = \"extend_share\"",
            "    verbose_name = _(\"Extend Share\")",
            "    url = \"horizon:project:shares:extend\"",
            "    classes = (\"ajax-modal\", \"btn-create\")",
            "    policy_rules = ((\"share\", \"share:extend\"),)",
            "",
            "    def get_policy_target(self, request, datum=None):",
            "        project_id = None",
            "        if datum:",
            "            project_id = getattr(datum, \"os-share-tenant-attr:tenant_id\", None)",
            "        return {\"project_id\": project_id}",
            "",
            "    def allowed(self, request, share=None):",
            "        return share.status.lower() in (\"available\",)",
            "",
            "",
            "class UpdateRow(tables.Row):",
            "    ajax = True",
            "",
            "    def get_data(self, request, share_id):",
            "        share = manila.share_get(request, share_id)",
            "        if not share.name:",
            "            share.name = share_id",
            "        if share.share_network_id:",
            "            share_net = manila.share_network_get(request,",
            "                                                 share.share_network_id)",
            "            share.share_network = share_net.name or share_net.id",
            "        else:",
            "            share.share_network = None",
            "        meta_str = utils.metadata_to_str(share.metadata)",
            "        share.metadata = mark_safe(meta_str)",
            "",
            "        return share",
            "",
            "",
            "def get_size(share):",
            "    return _(\"%sGiB\") % share.size",
            "",
            "",
            "class SharesTableBase(tables.DataTable):",
            "    STATUS_CHOICES = (",
            "        (\"available\", True), (\"AVAILABLE\", True),",
            "        (\"creating\", None), (\"CREATING\", None),",
            "        (\"deleting\", None), (\"DELETING\", None),",
            "        (\"error\", False), (\"ERROR\", False),",
            "        (\"error_deleting\", False), (\"ERROR_DELETING\", False),",
            "        (\"MANAGE_ERROR\", False),",
            "        (\"UNMANAGE_ERROR\", False),",
            "        (\"extending_error\", False),",
            "    )",
            "    STATUS_DISPLAY_CHOICES = (",
            "        (\"available\", pgettext_lazy(\"Current status of share\", u\"Available\")),",
            "        (\"AVAILABLE\", pgettext_lazy(\"Current status of share\", u\"Available\")),",
            "        (\"creating\", pgettext_lazy(\"Current status of share\", u\"Creating\")),",
            "        (\"CREATING\", pgettext_lazy(\"Current status of share\", u\"Creating\")),",
            "        (\"deleting\", pgettext_lazy(\"Current status of share\", u\"Deleting\")),",
            "        (\"DELETING\", pgettext_lazy(\"Current status of share\", u\"Deleting\")),",
            "        (\"error\", pgettext_lazy(\"Current status of share\", u\"Error\")),",
            "        (\"ERROR\", pgettext_lazy(\"Current status of share\", u\"Error\")),",
            "        (\"error_deleting\", pgettext_lazy(\"Current status of share\",",
            "                                         u\"Deleting\")),",
            "        (\"ERROR_DELETING\", pgettext_lazy(\"Current status of share\",",
            "                                         u\"Deleting\")),",
            "        (\"MANAGE_ERROR\", pgettext_lazy(\"Current status of share\",",
            "                                       u\"Manage Error\")),",
            "        (\"UNMANAGE_ERROR\", pgettext_lazy(\"Current status of share\",",
            "                                         u\"Unmanage Error\")),",
            "        (\"extending_error\", pgettext_lazy(\"Current status of share\",",
            "                                          u\"Extending Error\")),",
            "    )",
            "    name = tables.Column(\"name\",",
            "                         verbose_name=_(\"Name\"),",
            "                         link=\"horizon:project:shares:detail\")",
            "    description = tables.Column(\"description\",",
            "                                verbose_name=_(\"Description\"),",
            "                                truncate=40)",
            "    metadata = tables.Column(\"metadata\",",
            "                             verbose_name=_(\"Metadata\"))",
            "    size = tables.Column(get_size,",
            "                         verbose_name=_(\"Size\"),",
            "                         attrs={'data-type': 'size'})",
            "    status = tables.Column(\"status\",",
            "                           filters=(title,),",
            "                           verbose_name=_(\"Status\"),",
            "                           status=True,",
            "                           status_choices=STATUS_CHOICES,",
            "                           display_choices=STATUS_DISPLAY_CHOICES)",
            "",
            "    def get_object_display(self, obj):",
            "        return obj.name or obj.id",
            "",
            "",
            "class SharesFilterAction(tables.FilterAction):",
            "",
            "    def filter(self, table, shares, filter_string):",
            "        \"\"\"Naive case-insensitive search.\"\"\"",
            "        q = filter_string.lower()",
            "        return [share for share in shares",
            "                if q in share.name.lower()]",
            "",
            "",
            "class ManageRules(tables.LinkAction):",
            "    name = \"manage_rules\"",
            "    verbose_name = _(\"Manage Rules\")",
            "    url = \"horizon:project:shares:manage_rules\"",
            "    classes = (\"btn-edit\", )",
            "    policy_rules = ((\"share\", \"share:access_get_all\"),)",
            "",
            "",
            "class AddRule(tables.LinkAction):",
            "    name = \"rule_add\"",
            "    verbose_name = _(\"Add rule\")",
            "    url = 'horizon:project:shares:rule_add'",
            "    classes = (\"ajax-modal\", \"btn-create\")",
            "    policy_rules = ((\"share\", \"share:allow_access\"),)",
            "",
            "    def allowed(self, request, share=None):",
            "        share = manila.share_get(request, self.table.kwargs['share_id'])",
            "        return share.status in (\"available\", \"in-use\")",
            "",
            "    def get_link_url(self):",
            "        return reverse(self.url, args=[self.table.kwargs['share_id']])",
            "",
            "",
            "class DeleteRule(tables.DeleteAction):",
            "    data_type_singular = _(\"Rule\")",
            "    data_type_plural = _(\"Rules\")",
            "    action_past = _(\"Scheduled deletion of %(data_type)s\")",
            "    policy_rules = ((\"share\", \"share:deny_access\"),)",
            "",
            "    def delete(self, request, obj_id):",
            "        try:",
            "            manila.share_deny(request, self.table.kwargs['share_id'], obj_id)",
            "        except Exception:",
            "            msg = _('Unable to delete rule \"%s\".') % obj_id",
            "            exceptions.handle(request, msg)",
            "",
            "",
            "class UpdateRuleRow(tables.Row):",
            "    ajax = True",
            "",
            "    def get_data(self, request, rule_id):",
            "        rules = manila.share_rules_list(request, self.table.kwargs['share_id'])",
            "        if rules:",
            "            for rule in rules:",
            "                if rule.id == rule_id:",
            "                    return rule",
            "        raise exceptions.NotFound",
            "",
            "",
            "class RulesTable(tables.DataTable):",
            "    access_type = tables.Column(\"access_type\", verbose_name=_(\"Access Type\"))",
            "    access_to = tables.Column(\"access_to\", verbose_name=_(\"Access to\"))",
            "    access_level = tables.Column(",
            "        \"access_level\", verbose_name=_(\"Access Level\"))",
            "    status = tables.Column(\"state\", verbose_name=_(\"Status\"))",
            "",
            "    def get_object_display(self, obj):",
            "        return obj.id",
            "",
            "    class Meta(object):",
            "        name = \"rules\"",
            "        verbose_name = _(\"Rules\")",
            "        status_columns = [\"status\"]",
            "        row_class = UpdateRuleRow",
            "        table_actions = (DeleteRule, AddRule)",
            "        row_actions = (DeleteRule, )",
            "",
            "",
            "def get_share_network(share):",
            "    name = share.share_network_name",
            "    return name if name != \"None\" else None",
            "",
            "",
            "class SharesTable(SharesTableBase):",
            "    name = tables.Column(\"name\",",
            "                         verbose_name=_(\"Name\"),",
            "                         link=\"horizon:project:shares:detail\")",
            "    visibility = tables.Column(",
            "        \"is_public\", verbose_name=_(\"Visibility\"),",
            "        help_text=(\"Whether this share visible to all tenants (public) or \"",
            "                   \"only for owner (private).\"),",
            "        filters=(lambda d: 'public' if d is True else 'private', ),",
            "    )",
            "    proto = tables.Column(\"share_proto\", verbose_name=_(\"Protocol\"))",
            "    share_network = tables.Column(\"share_network\",",
            "                                  verbose_name=_(\"Share Network\"),",
            "                                  empty_value=\"-\")",
            "",
            "    class Meta(object):",
            "        name = \"shares\"",
            "        verbose_name = _(\"Shares\")",
            "        status_columns = [\"status\"]",
            "        row_class = UpdateRow",
            "        table_actions = (CreateShare, DeleteShare, SharesFilterAction)",
            "        row_actions = (EditShare, ExtendShare, snapshot_tables.CreateSnapshot,",
            "                       DeleteShare, ManageRules, EditShareMetadata)"
        ],
        "afterPatchFile": [
            "# vim: tabstop=4 shiftwidth=4 softtabstop=4",
            "",
            "# Copyright 2012 Nebula, Inc.",
            "#",
            "#    Licensed under the Apache License, Version 2.0 (the \"License\"); you may",
            "#    not use this file except in compliance with the License. You may obtain",
            "#    a copy of the License at",
            "#",
            "#         http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "#    Unless required by applicable law or agreed to in writing, software",
            "#    distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
            "#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
            "#    License for the specific language governing permissions and limitations",
            "#    under the License.",
            "",
            "from django.core.urlresolvers import NoReverseMatch  # noqa",
            "from django.core.urlresolvers import reverse",
            "from django.template.defaultfilters import title  # noqa",
            "from django.utils.translation import string_concat, ugettext_lazy  # noqa",
            "from django.utils.translation import pgettext_lazy",
            "from django.utils.translation import ugettext_lazy as _",
            "from horizon import exceptions",
            "from horizon import messages",
            "from horizon import tables",
            "from manila_ui.api import manila",
            "from manila_ui.dashboards.project.shares.snapshots \\",
            "    import tables as snapshot_tables",
            "from manila_ui.dashboards import utils",
            "from openstack_dashboard.usage import quotas",
            "",
            "",
            "DELETABLE_STATES = (",
            "    \"AVAILABLE\", \"ERROR\",",
            "    \"MANAGE_ERROR\",",
            ")",
            "",
            "",
            "class DeleteShare(tables.DeleteAction):",
            "    data_type_singular = _(\"Share\")",
            "    data_type_plural = _(\"Shares\")",
            "    action_past = _(\"Scheduled deletion of %(data_type)s\")",
            "    policy_rules = ((\"share\", \"share:delete\"),)",
            "",
            "    def get_policy_target(self, request, datum=None):",
            "        project_id = None",
            "        if datum:",
            "            project_id = getattr(datum, \"os-share-tenant-attr:tenant_id\", None)",
            "        return {\"project_id\": project_id}",
            "",
            "    def delete(self, request, obj_id):",
            "        try:",
            "            manila.share_delete(request, obj_id)",
            "        except Exception:",
            "            msg = _('Unable to delete share \"%s\". ') % obj_id",
            "            messages.error(request, msg)",
            "",
            "    def allowed(self, request, share=None):",
            "        if share:",
            "            # Row button",
            "            return (share.status.upper() in DELETABLE_STATES and",
            "                    not getattr(share, 'has_snapshot', False))",
            "        # Table button. Always return 'True'.",
            "        return True",
            "",
            "",
            "class CreateShare(tables.LinkAction):",
            "    name = \"create\"",
            "    verbose_name = _(\"Create Share\")",
            "    url = \"horizon:project:shares:create\"",
            "    classes = (\"ajax-modal\", \"btn-create\")",
            "    policy_rules = ((\"share\", \"share:create\"),)",
            "",
            "    def allowed(self, request, share=None):",
            "        usages = quotas.tenant_quota_usages(request)",
            "        if usages['shares']['available'] <= 0:",
            "            if \"disabled\" not in self.classes:",
            "                self.classes = [c for c in self.classes] + ['disabled']",
            "                self.verbose_name = string_concat(self.verbose_name, ' ',",
            "                                                  _(\"(Quota exceeded)\"))",
            "        else:",
            "            self.verbose_name = _(\"Create Share\")",
            "            classes = [c for c in self.classes if c != \"disabled\"]",
            "            self.classes = classes",
            "        return True",
            "",
            "",
            "class EditShare(tables.LinkAction):",
            "    name = \"edit\"",
            "    verbose_name = _(\"Edit Share\")",
            "    url = \"horizon:project:shares:update\"",
            "    classes = (\"ajax-modal\", \"btn-create\")",
            "    policy_rules = ((\"share\", \"share:update\"),)",
            "",
            "    def get_policy_target(self, request, datum=None):",
            "        project_id = None",
            "        if datum:",
            "            project_id = getattr(datum, \"os-share-tenant-attr:tenant_id\", None)",
            "        return {\"project_id\": project_id}",
            "",
            "    def allowed(self, request, share=None):",
            "        return share.status in (\"available\", \"in-use\")",
            "",
            "",
            "class EditShareMetadata(tables.LinkAction):",
            "    name = \"update_metadata\"",
            "    verbose_name = _(\"Edit Share Metadata\")",
            "    url = \"horizon:project:shares:update_metadata\"",
            "    classes = (\"ajax-modal\", \"btn-create\")",
            "    policy_rules = ((\"share\", \"share:update_share_metadata\"),)",
            "",
            "    def get_policy_target(self, request, datum=None):",
            "        project_id = None",
            "        if datum:",
            "            project_id = getattr(datum, \"os-share-tenant-attr:tenant_id\", None)",
            "        return {\"project_id\": project_id}",
            "",
            "    def allowed(self, request, share=None):",
            "        return share.status in (\"available\", \"in-use\")",
            "",
            "",
            "class ExtendShare(tables.LinkAction):",
            "    name = \"extend_share\"",
            "    verbose_name = _(\"Extend Share\")",
            "    url = \"horizon:project:shares:extend\"",
            "    classes = (\"ajax-modal\", \"btn-create\")",
            "    policy_rules = ((\"share\", \"share:extend\"),)",
            "",
            "    def get_policy_target(self, request, datum=None):",
            "        project_id = None",
            "        if datum:",
            "            project_id = getattr(datum, \"os-share-tenant-attr:tenant_id\", None)",
            "        return {\"project_id\": project_id}",
            "",
            "    def allowed(self, request, share=None):",
            "        return share.status.lower() in (\"available\",)",
            "",
            "",
            "class UpdateRow(tables.Row):",
            "    ajax = True",
            "",
            "    def get_data(self, request, share_id):",
            "        share = manila.share_get(request, share_id)",
            "        if not share.name:",
            "            share.name = share_id",
            "        if share.share_network_id:",
            "            share_net = manila.share_network_get(request,",
            "                                                 share.share_network_id)",
            "            share.share_network = share_net.name or share_net.id",
            "        else:",
            "            share.share_network = None",
            "        share.metadata = utils.metadata_to_str(share.metadata)",
            "",
            "        return share",
            "",
            "",
            "def get_size(share):",
            "    return _(\"%sGiB\") % share.size",
            "",
            "",
            "class SharesTableBase(tables.DataTable):",
            "    STATUS_CHOICES = (",
            "        (\"available\", True), (\"AVAILABLE\", True),",
            "        (\"creating\", None), (\"CREATING\", None),",
            "        (\"deleting\", None), (\"DELETING\", None),",
            "        (\"error\", False), (\"ERROR\", False),",
            "        (\"error_deleting\", False), (\"ERROR_DELETING\", False),",
            "        (\"MANAGE_ERROR\", False),",
            "        (\"UNMANAGE_ERROR\", False),",
            "        (\"extending_error\", False),",
            "    )",
            "    STATUS_DISPLAY_CHOICES = (",
            "        (\"available\", pgettext_lazy(\"Current status of share\", u\"Available\")),",
            "        (\"AVAILABLE\", pgettext_lazy(\"Current status of share\", u\"Available\")),",
            "        (\"creating\", pgettext_lazy(\"Current status of share\", u\"Creating\")),",
            "        (\"CREATING\", pgettext_lazy(\"Current status of share\", u\"Creating\")),",
            "        (\"deleting\", pgettext_lazy(\"Current status of share\", u\"Deleting\")),",
            "        (\"DELETING\", pgettext_lazy(\"Current status of share\", u\"Deleting\")),",
            "        (\"error\", pgettext_lazy(\"Current status of share\", u\"Error\")),",
            "        (\"ERROR\", pgettext_lazy(\"Current status of share\", u\"Error\")),",
            "        (\"error_deleting\", pgettext_lazy(\"Current status of share\",",
            "                                         u\"Deleting\")),",
            "        (\"ERROR_DELETING\", pgettext_lazy(\"Current status of share\",",
            "                                         u\"Deleting\")),",
            "        (\"MANAGE_ERROR\", pgettext_lazy(\"Current status of share\",",
            "                                       u\"Manage Error\")),",
            "        (\"UNMANAGE_ERROR\", pgettext_lazy(\"Current status of share\",",
            "                                         u\"Unmanage Error\")),",
            "        (\"extending_error\", pgettext_lazy(\"Current status of share\",",
            "                                          u\"Extending Error\")),",
            "    )",
            "    name = tables.Column(\"name\",",
            "                         verbose_name=_(\"Name\"),",
            "                         link=\"horizon:project:shares:detail\")",
            "    description = tables.Column(\"description\",",
            "                                verbose_name=_(\"Description\"),",
            "                                truncate=40)",
            "    metadata = tables.Column(\"metadata\",",
            "                             verbose_name=_(\"Metadata\"))",
            "    size = tables.Column(get_size,",
            "                         verbose_name=_(\"Size\"),",
            "                         attrs={'data-type': 'size'})",
            "    status = tables.Column(\"status\",",
            "                           filters=(title,),",
            "                           verbose_name=_(\"Status\"),",
            "                           status=True,",
            "                           status_choices=STATUS_CHOICES,",
            "                           display_choices=STATUS_DISPLAY_CHOICES)",
            "",
            "    def get_object_display(self, obj):",
            "        return obj.name or obj.id",
            "",
            "",
            "class SharesFilterAction(tables.FilterAction):",
            "",
            "    def filter(self, table, shares, filter_string):",
            "        \"\"\"Naive case-insensitive search.\"\"\"",
            "        q = filter_string.lower()",
            "        return [share for share in shares",
            "                if q in share.name.lower()]",
            "",
            "",
            "class ManageRules(tables.LinkAction):",
            "    name = \"manage_rules\"",
            "    verbose_name = _(\"Manage Rules\")",
            "    url = \"horizon:project:shares:manage_rules\"",
            "    classes = (\"btn-edit\", )",
            "    policy_rules = ((\"share\", \"share:access_get_all\"),)",
            "",
            "",
            "class AddRule(tables.LinkAction):",
            "    name = \"rule_add\"",
            "    verbose_name = _(\"Add rule\")",
            "    url = 'horizon:project:shares:rule_add'",
            "    classes = (\"ajax-modal\", \"btn-create\")",
            "    policy_rules = ((\"share\", \"share:allow_access\"),)",
            "",
            "    def allowed(self, request, share=None):",
            "        share = manila.share_get(request, self.table.kwargs['share_id'])",
            "        return share.status in (\"available\", \"in-use\")",
            "",
            "    def get_link_url(self):",
            "        return reverse(self.url, args=[self.table.kwargs['share_id']])",
            "",
            "",
            "class DeleteRule(tables.DeleteAction):",
            "    data_type_singular = _(\"Rule\")",
            "    data_type_plural = _(\"Rules\")",
            "    action_past = _(\"Scheduled deletion of %(data_type)s\")",
            "    policy_rules = ((\"share\", \"share:deny_access\"),)",
            "",
            "    def delete(self, request, obj_id):",
            "        try:",
            "            manila.share_deny(request, self.table.kwargs['share_id'], obj_id)",
            "        except Exception:",
            "            msg = _('Unable to delete rule \"%s\".') % obj_id",
            "            exceptions.handle(request, msg)",
            "",
            "",
            "class UpdateRuleRow(tables.Row):",
            "    ajax = True",
            "",
            "    def get_data(self, request, rule_id):",
            "        rules = manila.share_rules_list(request, self.table.kwargs['share_id'])",
            "        if rules:",
            "            for rule in rules:",
            "                if rule.id == rule_id:",
            "                    return rule",
            "        raise exceptions.NotFound",
            "",
            "",
            "class RulesTable(tables.DataTable):",
            "    access_type = tables.Column(\"access_type\", verbose_name=_(\"Access Type\"))",
            "    access_to = tables.Column(\"access_to\", verbose_name=_(\"Access to\"))",
            "    access_level = tables.Column(",
            "        \"access_level\", verbose_name=_(\"Access Level\"))",
            "    status = tables.Column(\"state\", verbose_name=_(\"Status\"))",
            "",
            "    def get_object_display(self, obj):",
            "        return obj.id",
            "",
            "    class Meta(object):",
            "        name = \"rules\"",
            "        verbose_name = _(\"Rules\")",
            "        status_columns = [\"status\"]",
            "        row_class = UpdateRuleRow",
            "        table_actions = (DeleteRule, AddRule)",
            "        row_actions = (DeleteRule, )",
            "",
            "",
            "def get_share_network(share):",
            "    name = share.share_network_name",
            "    return name if name != \"None\" else None",
            "",
            "",
            "class SharesTable(SharesTableBase):",
            "    name = tables.Column(\"name\",",
            "                         verbose_name=_(\"Name\"),",
            "                         link=\"horizon:project:shares:detail\")",
            "    visibility = tables.Column(",
            "        \"is_public\", verbose_name=_(\"Visibility\"),",
            "        help_text=(\"Whether this share visible to all tenants (public) or \"",
            "                   \"only for owner (private).\"),",
            "        filters=(lambda d: 'public' if d is True else 'private', ),",
            "    )",
            "    proto = tables.Column(\"share_proto\", verbose_name=_(\"Protocol\"))",
            "    share_network = tables.Column(\"share_network\",",
            "                                  verbose_name=_(\"Share Network\"),",
            "                                  empty_value=\"-\")",
            "",
            "    class Meta(object):",
            "        name = \"shares\"",
            "        verbose_name = _(\"Shares\")",
            "        status_columns = [\"status\"]",
            "        row_class = UpdateRow",
            "        table_actions = (CreateShare, DeleteShare, SharesFilterAction)",
            "        row_actions = (EditShare, ExtendShare, snapshot_tables.CreateSnapshot,",
            "                       DeleteShare, ManageRules, EditShareMetadata)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "20": [],
            "153": [
                "UpdateRow",
                "get_data"
            ],
            "154": [
                "UpdateRow",
                "get_data"
            ]
        },
        "addLocation": []
    },
    "manila_ui/dashboards/project/shares/shares/tabs.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 10,
                "afterPatchRowNumber": 10,
                "PatchRowcode": " #    License for the specific language governing permissions and limitations"
            },
            "1": {
                "beforePatchRowNumber": 11,
                "afterPatchRowNumber": 11,
                "PatchRowcode": " #    under the License."
            },
            "2": {
                "beforePatchRowNumber": 12,
                "afterPatchRowNumber": 12,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": 13,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-from django.utils.safestring import mark_safe"
            },
            "4": {
                "beforePatchRowNumber": 14,
                "afterPatchRowNumber": 13,
                "PatchRowcode": " from django.utils.translation import ugettext_lazy as _"
            },
            "5": {
                "beforePatchRowNumber": 15,
                "afterPatchRowNumber": 14,
                "PatchRowcode": " "
            },
            "6": {
                "beforePatchRowNumber": 16,
                "afterPatchRowNumber": 15,
                "PatchRowcode": " from horizon import exceptions"
            },
            "7": {
                "beforePatchRowNumber": 42,
                "afterPatchRowNumber": 41,
                "PatchRowcode": "         try:"
            },
            "8": {
                "beforePatchRowNumber": 43,
                "afterPatchRowNumber": 42,
                "PatchRowcode": "             shares = manila.share_list(self.request)"
            },
            "9": {
                "beforePatchRowNumber": 44,
                "afterPatchRowNumber": 43,
                "PatchRowcode": "             for share in shares:"
            },
            "10": {
                "beforePatchRowNumber": 45,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                share.share_network = \\"
            },
            "11": {
                "beforePatchRowNumber": 46,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    share_nets_names.get(share.share_network_id) or \\"
            },
            "12": {
                "beforePatchRowNumber": 47,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    share.share_network_id"
            },
            "13": {
                "beforePatchRowNumber": 48,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                meta_str = utils.metadata_to_str(share.metadata)"
            },
            "14": {
                "beforePatchRowNumber": 49,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                share.metadata = mark_safe(meta_str)"
            },
            "15": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 44,
                "PatchRowcode": "+                share.share_network = ("
            },
            "16": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 45,
                "PatchRowcode": "+                    share_nets_names.get(share.share_network_id) or"
            },
            "17": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 46,
                "PatchRowcode": "+                    share.share_network_id)"
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 47,
                "PatchRowcode": "+                share.metadata = utils.metadata_to_str(share.metadata)"
            },
            "19": {
                "beforePatchRowNumber": 50,
                "afterPatchRowNumber": 48,
                "PatchRowcode": " "
            },
            "20": {
                "beforePatchRowNumber": 51,
                "afterPatchRowNumber": 49,
                "PatchRowcode": "             snapshots = manila.share_snapshot_list(self.request, detailed=True)"
            },
            "21": {
                "beforePatchRowNumber": 52,
                "afterPatchRowNumber": 50,
                "PatchRowcode": "             share_ids_with_snapshots = []"
            }
        },
        "frontPatchFile": [
            "#    Licensed under the Apache License, Version 2.0 (the \"License\"); you may",
            "#    not use this file except in compliance with the License. You may obtain",
            "#    a copy of the License at",
            "#",
            "#         http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "#    Unless required by applicable law or agreed to in writing, software",
            "#    distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
            "#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
            "#    License for the specific language governing permissions and limitations",
            "#    under the License.",
            "",
            "from django.utils.safestring import mark_safe",
            "from django.utils.translation import ugettext_lazy as _",
            "",
            "from horizon import exceptions",
            "from horizon import tabs",
            "",
            "from manila_ui.api import manila",
            "",
            "from manila_ui.dashboards.project.shares.shares \\",
            "    import tables as share_tables",
            "from manila_ui.dashboards import utils",
            "",
            "",
            "class SharesTab(tabs.TableTab):",
            "    table_classes = (share_tables.SharesTable, )",
            "    name = _(\"Shares\")",
            "    slug = \"shares_tab\"",
            "    template_name = \"horizon/common/_detail_table.html\"",
            "",
            "    def _set_id_if_nameless(self, shares):",
            "        for share in shares:",
            "            if not share.name:",
            "                share.name = share.id",
            "",
            "    def get_shares_data(self):",
            "        share_nets_names = {}",
            "        share_nets = manila.share_network_list(self.request)",
            "        for share_net in share_nets:",
            "            share_nets_names[share_net.id] = share_net.name",
            "        try:",
            "            shares = manila.share_list(self.request)",
            "            for share in shares:",
            "                share.share_network = \\",
            "                    share_nets_names.get(share.share_network_id) or \\",
            "                    share.share_network_id",
            "                meta_str = utils.metadata_to_str(share.metadata)",
            "                share.metadata = mark_safe(meta_str)",
            "",
            "            snapshots = manila.share_snapshot_list(self.request, detailed=True)",
            "            share_ids_with_snapshots = []",
            "            for snapshot in snapshots:",
            "                share_ids_with_snapshots.append(snapshot.to_dict()['share_id'])",
            "            for share in shares:",
            "                if share.to_dict()['id'] in share_ids_with_snapshots:",
            "                    setattr(share, 'has_snapshot', True)",
            "                else:",
            "                    setattr(share, 'has_snapshot', False)",
            "        except Exception:",
            "            exceptions.handle(self.request,",
            "                              _('Unable to retrieve share list.'))",
            "            return []",
            "        # Gather our tenants to correlate against IDs",
            "        return shares",
            "",
            "",
            "class OverviewTab(tabs.Tab):",
            "    name = _(\"Overview\")",
            "    slug = \"overview\"",
            "    template_name = \"project/shares/shares/_detail_overview.html\"",
            "",
            "    def get_context_data(self, request):",
            "        return {\"share\": self.tab_group.kwargs['share']}",
            "",
            "",
            "class ShareDetailTabs(tabs.TabGroup):",
            "    slug = \"share_details\"",
            "    tabs = (OverviewTab,)"
        ],
        "afterPatchFile": [
            "#    Licensed under the Apache License, Version 2.0 (the \"License\"); you may",
            "#    not use this file except in compliance with the License. You may obtain",
            "#    a copy of the License at",
            "#",
            "#         http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "#    Unless required by applicable law or agreed to in writing, software",
            "#    distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
            "#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
            "#    License for the specific language governing permissions and limitations",
            "#    under the License.",
            "",
            "from django.utils.translation import ugettext_lazy as _",
            "",
            "from horizon import exceptions",
            "from horizon import tabs",
            "",
            "from manila_ui.api import manila",
            "",
            "from manila_ui.dashboards.project.shares.shares \\",
            "    import tables as share_tables",
            "from manila_ui.dashboards import utils",
            "",
            "",
            "class SharesTab(tabs.TableTab):",
            "    table_classes = (share_tables.SharesTable, )",
            "    name = _(\"Shares\")",
            "    slug = \"shares_tab\"",
            "    template_name = \"horizon/common/_detail_table.html\"",
            "",
            "    def _set_id_if_nameless(self, shares):",
            "        for share in shares:",
            "            if not share.name:",
            "                share.name = share.id",
            "",
            "    def get_shares_data(self):",
            "        share_nets_names = {}",
            "        share_nets = manila.share_network_list(self.request)",
            "        for share_net in share_nets:",
            "            share_nets_names[share_net.id] = share_net.name",
            "        try:",
            "            shares = manila.share_list(self.request)",
            "            for share in shares:",
            "                share.share_network = (",
            "                    share_nets_names.get(share.share_network_id) or",
            "                    share.share_network_id)",
            "                share.metadata = utils.metadata_to_str(share.metadata)",
            "",
            "            snapshots = manila.share_snapshot_list(self.request, detailed=True)",
            "            share_ids_with_snapshots = []",
            "            for snapshot in snapshots:",
            "                share_ids_with_snapshots.append(snapshot.to_dict()['share_id'])",
            "            for share in shares:",
            "                if share.to_dict()['id'] in share_ids_with_snapshots:",
            "                    setattr(share, 'has_snapshot', True)",
            "                else:",
            "                    setattr(share, 'has_snapshot', False)",
            "        except Exception:",
            "            exceptions.handle(self.request,",
            "                              _('Unable to retrieve share list.'))",
            "            return []",
            "        # Gather our tenants to correlate against IDs",
            "        return shares",
            "",
            "",
            "class OverviewTab(tabs.Tab):",
            "    name = _(\"Overview\")",
            "    slug = \"overview\"",
            "    template_name = \"project/shares/shares/_detail_overview.html\"",
            "",
            "    def get_context_data(self, request):",
            "        return {\"share\": self.tab_group.kwargs['share']}",
            "",
            "",
            "class ShareDetailTabs(tabs.TabGroup):",
            "    slug = \"share_details\"",
            "    tabs = (OverviewTab,)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "13": [],
            "45": [
                "SharesTab",
                "get_shares_data"
            ],
            "46": [
                "SharesTab",
                "get_shares_data"
            ],
            "47": [
                "SharesTab",
                "get_shares_data"
            ],
            "48": [
                "SharesTab",
                "get_shares_data"
            ],
            "49": [
                "SharesTab",
                "get_shares_data"
            ]
        },
        "addLocation": []
    },
    "manila_ui/dashboards/utils.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 13,
                "afterPatchRowNumber": 13,
                "PatchRowcode": " #    under the License."
            },
            "1": {
                "beforePatchRowNumber": 14,
                "afterPatchRowNumber": 14,
                "PatchRowcode": " "
            },
            "2": {
                "beforePatchRowNumber": 15,
                "afterPatchRowNumber": 15,
                "PatchRowcode": " from django.forms import ValidationError  # noqa"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 16,
                "PatchRowcode": "+from django.utils.safestring import mark_safe"
            },
            "4": {
                "beforePatchRowNumber": 16,
                "afterPatchRowNumber": 17,
                "PatchRowcode": " from django.utils.translation import ugettext_lazy as _"
            },
            "5": {
                "beforePatchRowNumber": 17,
                "afterPatchRowNumber": 18,
                "PatchRowcode": " "
            },
            "6": {
                "beforePatchRowNumber": 18,
                "afterPatchRowNumber": 19,
                "PatchRowcode": " "
            },
            "7": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 20,
                "PatchRowcode": "+html_escape_table = {"
            },
            "8": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 21,
                "PatchRowcode": "+    \"&\": \"&amp;\","
            },
            "9": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 22,
                "PatchRowcode": "+    '\"': \"&quot;\","
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 23,
                "PatchRowcode": "+    \"'\": \"&apos;\","
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 24,
                "PatchRowcode": "+    \">\": \"&gt;\","
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 25,
                "PatchRowcode": "+    \"<\": \"&lt;\","
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 26,
                "PatchRowcode": "+}"
            },
            "14": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 27,
                "PatchRowcode": "+"
            },
            "15": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 28,
                "PatchRowcode": "+"
            },
            "16": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 29,
                "PatchRowcode": "+def html_escape(text):"
            },
            "17": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 30,
                "PatchRowcode": "+    return ''.join(html_escape_table.get(s, s) for s in text)"
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 31,
                "PatchRowcode": "+"
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 32,
                "PatchRowcode": "+"
            },
            "20": {
                "beforePatchRowNumber": 19,
                "afterPatchRowNumber": 33,
                "PatchRowcode": " def parse_str_meta(meta_s):"
            },
            "21": {
                "beforePatchRowNumber": 20,
                "afterPatchRowNumber": 34,
                "PatchRowcode": "     \"\"\"Parse multiline string with data from form."
            },
            "22": {
                "beforePatchRowNumber": 21,
                "afterPatchRowNumber": 35,
                "PatchRowcode": " "
            },
            "23": {
                "beforePatchRowNumber": 58,
                "afterPatchRowNumber": 72,
                "PatchRowcode": "     return set_dict, unset_list"
            },
            "24": {
                "beforePatchRowNumber": 59,
                "afterPatchRowNumber": 73,
                "PatchRowcode": " "
            },
            "25": {
                "beforePatchRowNumber": 60,
                "afterPatchRowNumber": 74,
                "PatchRowcode": " "
            },
            "26": {
                "beforePatchRowNumber": 61,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-def metadata_to_str(metadata):"
            },
            "27": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 75,
                "PatchRowcode": "+def metadata_to_str(metadata, meta_visible_limit=4, text_length_limit=25):"
            },
            "28": {
                "beforePatchRowNumber": 62,
                "afterPatchRowNumber": 76,
                "PatchRowcode": " "
            },
            "29": {
                "beforePatchRowNumber": 63,
                "afterPatchRowNumber": 77,
                "PatchRowcode": "     # Only convert dictionaries"
            },
            "30": {
                "beforePatchRowNumber": 64,
                "afterPatchRowNumber": 78,
                "PatchRowcode": "     if not hasattr(metadata, 'keys'):"
            },
            "31": {
                "beforePatchRowNumber": 65,
                "afterPatchRowNumber": 79,
                "PatchRowcode": "         return metadata"
            },
            "32": {
                "beforePatchRowNumber": 66,
                "afterPatchRowNumber": 80,
                "PatchRowcode": " "
            },
            "33": {
                "beforePatchRowNumber": 67,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    meta_visible_limit = 4"
            },
            "34": {
                "beforePatchRowNumber": 68,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    text_length_limit = 25"
            },
            "35": {
                "beforePatchRowNumber": 69,
                "afterPatchRowNumber": 81,
                "PatchRowcode": "     meta = []"
            },
            "36": {
                "beforePatchRowNumber": 70,
                "afterPatchRowNumber": 82,
                "PatchRowcode": "     meta_keys = metadata.keys()"
            },
            "37": {
                "beforePatchRowNumber": 71,
                "afterPatchRowNumber": 83,
                "PatchRowcode": "     meta_keys.sort()"
            },
            "38": {
                "beforePatchRowNumber": 77,
                "afterPatchRowNumber": 89,
                "PatchRowcode": "         v = metadata[k]"
            },
            "39": {
                "beforePatchRowNumber": 78,
                "afterPatchRowNumber": 90,
                "PatchRowcode": "         if len(v) > text_length_limit:"
            },
            "40": {
                "beforePatchRowNumber": 79,
                "afterPatchRowNumber": 91,
                "PatchRowcode": "             v = v[:text_length_limit] + '...'"
            },
            "41": {
                "beforePatchRowNumber": 80,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        meta.append(\"%s = %s\" % (k_shortenned, v))"
            },
            "42": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 92,
                "PatchRowcode": "+        meta.append(\"%s = %s\" % (html_escape(k_shortenned), html_escape(v)))"
            },
            "43": {
                "beforePatchRowNumber": 81,
                "afterPatchRowNumber": 93,
                "PatchRowcode": "     meta_str = \"<br/>\".join(meta)"
            },
            "44": {
                "beforePatchRowNumber": 82,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    if len(metadata.keys()) > meta_visible_limit:"
            },
            "45": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 94,
                "PatchRowcode": "+    if len(metadata.keys()) > meta_visible_limit and meta_str[-3:] != \"...\":"
            },
            "46": {
                "beforePatchRowNumber": 83,
                "afterPatchRowNumber": 95,
                "PatchRowcode": "         meta_str += '...'"
            },
            "47": {
                "beforePatchRowNumber": 84,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    return meta_str"
            },
            "48": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 96,
                "PatchRowcode": "+    return mark_safe(meta_str)"
            }
        },
        "frontPatchFile": [
            "# All Rights Reserved.",
            "#",
            "#    Licensed under the Apache License, Version 2.0 (the \"License\"); you may",
            "#    not use this file except in compliance with the License. You may obtain",
            "#    a copy of the License at",
            "#",
            "#         http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "#    Unless required by applicable law or agreed to in writing, software",
            "#    distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
            "#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
            "#    License for the specific language governing permissions and limitations",
            "#    under the License.",
            "",
            "from django.forms import ValidationError  # noqa",
            "from django.utils.translation import ugettext_lazy as _",
            "",
            "",
            "def parse_str_meta(meta_s):",
            "    \"\"\"Parse multiline string with data from form.",
            "",
            "    :option meta_s: str - string with keys and values",
            "    :returns: tuple of dict with key-value for set and list with keys for unset",
            "    :raises: ValidationError",
            "    \"\"\"",
            "    strings = [el.strip() for el in meta_s.split(\"\\n\") if len(el.strip()) > 0]",
            "    set_dict = {}",
            "    unset_list = []",
            "    msg = \"\"",
            "    for string in strings:",
            "        if string.count(\"=\") == 0:",
            "            # Key for unsetting",
            "            key = string.strip('\\\"\\'\\ ')",
            "            if len(key) not in range(1, 256):",
            "                msg = _(\"Key '%s' has inproper length.\") % key",
            "            elif \" \" in key:",
            "                msg = _(\"Key can not contain spaces. See string '%s'.\") % key",
            "            elif key not in unset_list:",
            "                unset_list.append(key)",
            "        else:",
            "            # Key-value pair for setting",
            "            pair = [p.strip('\\\"\\'\\ ') for p in string.split(\"=\", 1)]",
            "            if not all(len(p) in range(1, 256) for p in pair):",
            "                msg = _(\"All keys and values must be in range from 1 to 255.\")",
            "            elif pair[0] in list(set_dict.keys()):",
            "                msg = _(\"Duplicated keys '%s'.\") % pair[0]",
            "            elif \" \" in pair[0]:",
            "                msg = _(\"Keys should not contain spaces. \"",
            "                        \"Error in '%s'.\") % string",
            "            else:",
            "                set_dict[pair[0]] = pair[1]",
            "",
            "    duplicated_keys = [uk for uk in unset_list if uk in list(set_dict.keys())]",
            "    if duplicated_keys:",
            "        msg = _(\"Duplicated keys '%s'.\") % str(duplicated_keys)",
            "    if msg:",
            "        raise ValidationError(message=msg)",
            "    return set_dict, unset_list",
            "",
            "",
            "def metadata_to_str(metadata):",
            "",
            "    # Only convert dictionaries",
            "    if not hasattr(metadata, 'keys'):",
            "        return metadata",
            "",
            "    meta_visible_limit = 4",
            "    text_length_limit = 25",
            "    meta = []",
            "    meta_keys = metadata.keys()",
            "    meta_keys.sort()",
            "    meta_keys = meta_keys[:meta_visible_limit]",
            "    for k in meta_keys:",
            "        k_shortenned = k",
            "        if len(k) > text_length_limit:",
            "            k_shortenned = k[:text_length_limit] + '...'",
            "        v = metadata[k]",
            "        if len(v) > text_length_limit:",
            "            v = v[:text_length_limit] + '...'",
            "        meta.append(\"%s = %s\" % (k_shortenned, v))",
            "    meta_str = \"<br/>\".join(meta)",
            "    if len(metadata.keys()) > meta_visible_limit:",
            "        meta_str += '...'",
            "    return meta_str"
        ],
        "afterPatchFile": [
            "# All Rights Reserved.",
            "#",
            "#    Licensed under the Apache License, Version 2.0 (the \"License\"); you may",
            "#    not use this file except in compliance with the License. You may obtain",
            "#    a copy of the License at",
            "#",
            "#         http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "#    Unless required by applicable law or agreed to in writing, software",
            "#    distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
            "#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
            "#    License for the specific language governing permissions and limitations",
            "#    under the License.",
            "",
            "from django.forms import ValidationError  # noqa",
            "from django.utils.safestring import mark_safe",
            "from django.utils.translation import ugettext_lazy as _",
            "",
            "",
            "html_escape_table = {",
            "    \"&\": \"&amp;\",",
            "    '\"': \"&quot;\",",
            "    \"'\": \"&apos;\",",
            "    \">\": \"&gt;\",",
            "    \"<\": \"&lt;\",",
            "}",
            "",
            "",
            "def html_escape(text):",
            "    return ''.join(html_escape_table.get(s, s) for s in text)",
            "",
            "",
            "def parse_str_meta(meta_s):",
            "    \"\"\"Parse multiline string with data from form.",
            "",
            "    :option meta_s: str - string with keys and values",
            "    :returns: tuple of dict with key-value for set and list with keys for unset",
            "    :raises: ValidationError",
            "    \"\"\"",
            "    strings = [el.strip() for el in meta_s.split(\"\\n\") if len(el.strip()) > 0]",
            "    set_dict = {}",
            "    unset_list = []",
            "    msg = \"\"",
            "    for string in strings:",
            "        if string.count(\"=\") == 0:",
            "            # Key for unsetting",
            "            key = string.strip('\\\"\\'\\ ')",
            "            if len(key) not in range(1, 256):",
            "                msg = _(\"Key '%s' has inproper length.\") % key",
            "            elif \" \" in key:",
            "                msg = _(\"Key can not contain spaces. See string '%s'.\") % key",
            "            elif key not in unset_list:",
            "                unset_list.append(key)",
            "        else:",
            "            # Key-value pair for setting",
            "            pair = [p.strip('\\\"\\'\\ ') for p in string.split(\"=\", 1)]",
            "            if not all(len(p) in range(1, 256) for p in pair):",
            "                msg = _(\"All keys and values must be in range from 1 to 255.\")",
            "            elif pair[0] in list(set_dict.keys()):",
            "                msg = _(\"Duplicated keys '%s'.\") % pair[0]",
            "            elif \" \" in pair[0]:",
            "                msg = _(\"Keys should not contain spaces. \"",
            "                        \"Error in '%s'.\") % string",
            "            else:",
            "                set_dict[pair[0]] = pair[1]",
            "",
            "    duplicated_keys = [uk for uk in unset_list if uk in list(set_dict.keys())]",
            "    if duplicated_keys:",
            "        msg = _(\"Duplicated keys '%s'.\") % str(duplicated_keys)",
            "    if msg:",
            "        raise ValidationError(message=msg)",
            "    return set_dict, unset_list",
            "",
            "",
            "def metadata_to_str(metadata, meta_visible_limit=4, text_length_limit=25):",
            "",
            "    # Only convert dictionaries",
            "    if not hasattr(metadata, 'keys'):",
            "        return metadata",
            "",
            "    meta = []",
            "    meta_keys = metadata.keys()",
            "    meta_keys.sort()",
            "    meta_keys = meta_keys[:meta_visible_limit]",
            "    for k in meta_keys:",
            "        k_shortenned = k",
            "        if len(k) > text_length_limit:",
            "            k_shortenned = k[:text_length_limit] + '...'",
            "        v = metadata[k]",
            "        if len(v) > text_length_limit:",
            "            v = v[:text_length_limit] + '...'",
            "        meta.append(\"%s = %s\" % (html_escape(k_shortenned), html_escape(v)))",
            "    meta_str = \"<br/>\".join(meta)",
            "    if len(metadata.keys()) > meta_visible_limit and meta_str[-3:] != \"...\":",
            "        meta_str += '...'",
            "    return mark_safe(meta_str)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "2",
            "2",
            "0",
            "2",
            "2"
        ],
        "dele_reviseLocation": {
            "61": [
                "metadata_to_str"
            ],
            "67": [
                "metadata_to_str"
            ],
            "68": [
                "metadata_to_str"
            ],
            "80": [
                "metadata_to_str"
            ],
            "82": [
                "metadata_to_str"
            ],
            "84": [
                "metadata_to_str"
            ]
        },
        "addLocation": [
            "omeroweb.webgateway.views"
        ]
    },
    "manila_ui/test/dashboards/test_utils.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 61,
                "afterPatchRowNumber": 61,
                "PatchRowcode": "     )"
            },
            "1": {
                "beforePatchRowNumber": 62,
                "afterPatchRowNumber": 62,
                "PatchRowcode": "     def test_parse_str_meta_validation_error(self, input_data):"
            },
            "2": {
                "beforePatchRowNumber": 63,
                "afterPatchRowNumber": 63,
                "PatchRowcode": "         self.assertRaises(ValidationError, utils.parse_str_meta, input_data)"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 64,
                "PatchRowcode": "+"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 65,
                "PatchRowcode": "+    @ddt.data("
            },
            "5": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 66,
                "PatchRowcode": "+        (({\"a\": \"<script>alert('A')/*\", \"b\": \"*/</script>\"}, ),"
            },
            "6": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 67,
                "PatchRowcode": "+         \"a = &lt;script&gt;alert(&apos;A&apos;)/*<br/>b = */&lt;/script&gt;\"),"
            },
            "7": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 68,
                "PatchRowcode": "+        (({\"fookey\": \"foovalue\", \"barkey\": \"barvalue\"}, ),"
            },
            "8": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 69,
                "PatchRowcode": "+         \"barkey = barvalue<br/>fookey = foovalue\"),"
            },
            "9": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 70,
                "PatchRowcode": "+        (({\"foo\": \"barquuz\"}, 1, 2), \"fo... = ba...\"),"
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 71,
                "PatchRowcode": "+        (({\"foo\": \"barquuz\", \"zfoo\": \"zbarquuz\"}, 1, 3), \"foo = bar...\"),"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 72,
                "PatchRowcode": "+        (({\"foo\": \"barquuz\", \"zfoo\": \"zbarquuz\"}, 2, 3),"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 73,
                "PatchRowcode": "+         \"foo = bar...<br/>zfo... = zba...\"),"
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 74,
                "PatchRowcode": "+        (({\"foo\": \"barquuz\", \"zfoo\": \"zbarquuz\"}, 3, 3),"
            },
            "14": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 75,
                "PatchRowcode": "+         \"foo = bar...<br/>zfo... = zba...\"),"
            },
            "15": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 76,
                "PatchRowcode": "+        (({\"foo\": \"barquuz\", \"zfoo\": \"zbarquuz\"}, 3, 8),"
            },
            "16": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 77,
                "PatchRowcode": "+         \"foo = barquuz<br/>zfoo = zbarquuz\"),"
            },
            "17": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 78,
                "PatchRowcode": "+    )"
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 79,
                "PatchRowcode": "+    @ddt.unpack"
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 80,
                "PatchRowcode": "+    def test_metadata_to_str(self, input_args, expected_output):"
            },
            "20": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 81,
                "PatchRowcode": "+        result = utils.metadata_to_str(*input_args)"
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 82,
                "PatchRowcode": "+"
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 83,
                "PatchRowcode": "+        self.assertEqual(expected_output, result)"
            }
        },
        "frontPatchFile": [
            "# Copyright (c) 2015 Mirantis, Inc.",
            "# All rights reserved.",
            "",
            "# Licensed under the Apache License, Version 2.0 (the \"License\"); you may",
            "# not use this file except in compliance with the License. You may obtain",
            "# a copy of the License at",
            "#",
            "#      http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "# Unless required by applicable law or agreed to in writing, software",
            "# distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
            "# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
            "# License for the specific language governing permissions and limitations",
            "# under the License.",
            "",
            "import ddt",
            "from django.forms import ValidationError  # noqa",
            "",
            "from manila_ui.dashboards import utils",
            "from manila_ui.test import helpers as base",
            "",
            "",
            "@ddt.ddt",
            "class ManilaDashboardsUtilsTests(base.TestCase):",
            "",
            "    @ddt.data(",
            "        (\"\", {}, []),",
            "        (\"  \", {}, []),",
            "        (\"\\n\", {}, []),",
            "        (\"f\", {}, [\"f\"]),",
            "        (\"f=b\", {\"f\": \"b\"}, []),",
            "        (\"foo=bar\", {\"foo\": \"bar\"}, []),",
            "        (\"\\nfoo \\n\", {}, [\"foo\"]),",
            "        (\"'foo'=\\\"bar\\\"\\n'bar'\", {\"foo\": \"bar\"}, [\"bar\"]),",
            "        (\"   foo=   bar \", {\"foo\": \"bar\"}, []),",
            "        (\"foo= \\\"<is> bar\\\"\\n\", {\"foo\": \"<is> bar\"}, []),",
            "        (\"\\n\\nset_me_key = 'value with spaces and equality 2=2'\\nunset_key  \",",
            "         {\"set_me_key\": \"value with spaces and equality 2=2\"},",
            "         [\"unset_key\"]),",
            "        (\"f\" * 255, {}, [\"f\" * 255]),",
            "        (\"f\" * 255 + \"=\" + \"b\" * 255, {\"f\" * 255: \"b\" * 255}, []),",
            "    )",
            "    @ddt.unpack",
            "    def test_parse_str_meta_success(",
            "            self, input_data, expect_set_dict, expected_unset_list):",
            "        set_dict, unset_list = utils.parse_str_meta(input_data)",
            "",
            "        self.assertEqual(expect_set_dict, set_dict)",
            "        self.assertEqual(expected_unset_list, unset_list)",
            "",
            "    @ddt.data(",
            "        \"a b\",",
            "        \"'a b'\",",
            "        \"\\\"a b\\\"\",",
            "        \"f\" * 256,",
            "        \"f\" * 256 + \"=bar\",",
            "        \"foo=\" + \"b\" * 256,",
            "        \"\\\"a b \\\"\",",
            "        \"foo=bar\\nfoo\",",
            "        \"foo=bar\\nfoo=quuz\",",
            "    )",
            "    def test_parse_str_meta_validation_error(self, input_data):",
            "        self.assertRaises(ValidationError, utils.parse_str_meta, input_data)"
        ],
        "afterPatchFile": [
            "# Copyright (c) 2015 Mirantis, Inc.",
            "# All rights reserved.",
            "",
            "# Licensed under the Apache License, Version 2.0 (the \"License\"); you may",
            "# not use this file except in compliance with the License. You may obtain",
            "# a copy of the License at",
            "#",
            "#      http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "# Unless required by applicable law or agreed to in writing, software",
            "# distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
            "# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
            "# License for the specific language governing permissions and limitations",
            "# under the License.",
            "",
            "import ddt",
            "from django.forms import ValidationError  # noqa",
            "",
            "from manila_ui.dashboards import utils",
            "from manila_ui.test import helpers as base",
            "",
            "",
            "@ddt.ddt",
            "class ManilaDashboardsUtilsTests(base.TestCase):",
            "",
            "    @ddt.data(",
            "        (\"\", {}, []),",
            "        (\"  \", {}, []),",
            "        (\"\\n\", {}, []),",
            "        (\"f\", {}, [\"f\"]),",
            "        (\"f=b\", {\"f\": \"b\"}, []),",
            "        (\"foo=bar\", {\"foo\": \"bar\"}, []),",
            "        (\"\\nfoo \\n\", {}, [\"foo\"]),",
            "        (\"'foo'=\\\"bar\\\"\\n'bar'\", {\"foo\": \"bar\"}, [\"bar\"]),",
            "        (\"   foo=   bar \", {\"foo\": \"bar\"}, []),",
            "        (\"foo= \\\"<is> bar\\\"\\n\", {\"foo\": \"<is> bar\"}, []),",
            "        (\"\\n\\nset_me_key = 'value with spaces and equality 2=2'\\nunset_key  \",",
            "         {\"set_me_key\": \"value with spaces and equality 2=2\"},",
            "         [\"unset_key\"]),",
            "        (\"f\" * 255, {}, [\"f\" * 255]),",
            "        (\"f\" * 255 + \"=\" + \"b\" * 255, {\"f\" * 255: \"b\" * 255}, []),",
            "    )",
            "    @ddt.unpack",
            "    def test_parse_str_meta_success(",
            "            self, input_data, expect_set_dict, expected_unset_list):",
            "        set_dict, unset_list = utils.parse_str_meta(input_data)",
            "",
            "        self.assertEqual(expect_set_dict, set_dict)",
            "        self.assertEqual(expected_unset_list, unset_list)",
            "",
            "    @ddt.data(",
            "        \"a b\",",
            "        \"'a b'\",",
            "        \"\\\"a b\\\"\",",
            "        \"f\" * 256,",
            "        \"f\" * 256 + \"=bar\",",
            "        \"foo=\" + \"b\" * 256,",
            "        \"\\\"a b \\\"\",",
            "        \"foo=bar\\nfoo\",",
            "        \"foo=bar\\nfoo=quuz\",",
            "    )",
            "    def test_parse_str_meta_validation_error(self, input_data):",
            "        self.assertRaises(ValidationError, utils.parse_str_meta, input_data)",
            "",
            "    @ddt.data(",
            "        (({\"a\": \"<script>alert('A')/*\", \"b\": \"*/</script>\"}, ),",
            "         \"a = &lt;script&gt;alert(&apos;A&apos;)/*<br/>b = */&lt;/script&gt;\"),",
            "        (({\"fookey\": \"foovalue\", \"barkey\": \"barvalue\"}, ),",
            "         \"barkey = barvalue<br/>fookey = foovalue\"),",
            "        (({\"foo\": \"barquuz\"}, 1, 2), \"fo... = ba...\"),",
            "        (({\"foo\": \"barquuz\", \"zfoo\": \"zbarquuz\"}, 1, 3), \"foo = bar...\"),",
            "        (({\"foo\": \"barquuz\", \"zfoo\": \"zbarquuz\"}, 2, 3),",
            "         \"foo = bar...<br/>zfo... = zba...\"),",
            "        (({\"foo\": \"barquuz\", \"zfoo\": \"zbarquuz\"}, 3, 3),",
            "         \"foo = bar...<br/>zfo... = zba...\"),",
            "        (({\"foo\": \"barquuz\", \"zfoo\": \"zbarquuz\"}, 3, 8),",
            "         \"foo = barquuz<br/>zfoo = zbarquuz\"),",
            "    )",
            "    @ddt.unpack",
            "    def test_metadata_to_str(self, input_args, expected_output):",
            "        result = utils.metadata_to_str(*input_args)",
            "",
            "        self.assertEqual(expected_output, result)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1"
        ],
        "dele_reviseLocation": {},
        "addLocation": [
            "omeroweb.webgateway.views",
            "manila_ui.test.dashboards.test_utils.ManilaDashboardsUtilsTests.self"
        ]
    }
}