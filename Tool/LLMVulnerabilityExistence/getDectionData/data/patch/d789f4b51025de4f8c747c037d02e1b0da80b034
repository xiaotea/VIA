{
    "tcms/kiwi_attachments/tests/test_validators.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 25,
                "afterPatchRowNumber": 25,
                "PatchRowcode": "             with self.assertRaisesRegex(Fault, message):"
            },
            "1": {
                "beforePatchRowNumber": 26,
                "afterPatchRowNumber": 26,
                "PatchRowcode": "                 self.rpc_client.User.add_attachment(\"inline_javascript.svg\", b64)"
            },
            "2": {
                "beforePatchRowNumber": 27,
                "afterPatchRowNumber": 27,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 28,
                "PatchRowcode": "+    @parameterized.expand("
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 29,
                "PatchRowcode": "+        ["
            },
            "5": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 30,
                "PatchRowcode": "+            \"svg_with_onload_attribute.svg\","
            },
            "6": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 31,
                "PatchRowcode": "+        ]"
            },
            "7": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 32,
                "PatchRowcode": "+    )"
            },
            "8": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 33,
                "PatchRowcode": "+    def test_uploading_svg_with_forbidden_attributes_should_fail(self, file_name):"
            },
            "9": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 34,
                "PatchRowcode": "+        with open(f\"tests/ui/data/{file_name}\", \"rb\") as svg_file:"
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 35,
                "PatchRowcode": "+            b64 = base64.b64encode(svg_file.read()).decode()"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 36,
                "PatchRowcode": "+"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 37,
                "PatchRowcode": "+            message = str(_(\"File contains forbidden attribute:\"))"
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 38,
                "PatchRowcode": "+            with self.assertRaisesRegex(Fault, message):"
            },
            "14": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 39,
                "PatchRowcode": "+                self.rpc_client.User.add_attachment(\"image.svg\", b64)"
            },
            "15": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 40,
                "PatchRowcode": "+"
            },
            "16": {
                "beforePatchRowNumber": 28,
                "afterPatchRowNumber": 41,
                "PatchRowcode": "     def test_uploading_filename_ending_in_dot_exe_should_fail(self):"
            },
            "17": {
                "beforePatchRowNumber": 29,
                "afterPatchRowNumber": 42,
                "PatchRowcode": "         message = str(_(\"Uploading executable files is forbidden\"))"
            },
            "18": {
                "beforePatchRowNumber": 30,
                "afterPatchRowNumber": 43,
                "PatchRowcode": "         with self.assertRaisesRegex(Fault, message):"
            }
        },
        "frontPatchFile": [
            "# -*- coding: utf-8 -*-",
            "# pylint: disable=attribute-defined-outside-init, invalid-name, objects-update-used",
            "",
            "import base64",
            "from xmlrpc.client import Fault",
            "",
            "from django.utils.translation import gettext_lazy as _",
            "from parameterized import parameterized",
            "",
            "from tcms.rpc.tests.utils import APITestCase",
            "",
            "",
            "class TestValidators(APITestCase):",
            "    @parameterized.expand(",
            "        [",
            "            \"inline_javascript.svg\",",
            "            \"inline_javascript_mixed_case.svg\",",
            "        ]",
            "    )",
            "    def test_uploading_svg_with_inline_script_should_fail(self, file_name):",
            "        with open(f\"tests/ui/data/{file_name}\", \"rb\") as svg_file:",
            "            b64 = base64.b64encode(svg_file.read()).decode()",
            "",
            "            message = str(_(\"File contains forbidden <script> tag\"))",
            "            with self.assertRaisesRegex(Fault, message):",
            "                self.rpc_client.User.add_attachment(\"inline_javascript.svg\", b64)",
            "",
            "    def test_uploading_filename_ending_in_dot_exe_should_fail(self):",
            "        message = str(_(\"Uploading executable files is forbidden\"))",
            "        with self.assertRaisesRegex(Fault, message):",
            "            self.rpc_client.User.add_attachment(\"hello.exe\", \"a2l3aXRjbXM=\")",
            "",
            "    def test_uploading_real_exe_file_should_fail(self):",
            "        with open(\"tests/ui/data/reactos_csrss.exe\", \"rb\") as exe_file:",
            "            b64 = base64.b64encode(exe_file.read()).decode()",
            "",
            "            message = str(_(\"Uploading executable files is forbidden\"))",
            "            with self.assertRaisesRegex(Fault, message):",
            "                self.rpc_client.User.add_attachment(\"csrss.exe_from_reactos\", b64)"
        ],
        "afterPatchFile": [
            "# -*- coding: utf-8 -*-",
            "# pylint: disable=attribute-defined-outside-init, invalid-name, objects-update-used",
            "",
            "import base64",
            "from xmlrpc.client import Fault",
            "",
            "from django.utils.translation import gettext_lazy as _",
            "from parameterized import parameterized",
            "",
            "from tcms.rpc.tests.utils import APITestCase",
            "",
            "",
            "class TestValidators(APITestCase):",
            "    @parameterized.expand(",
            "        [",
            "            \"inline_javascript.svg\",",
            "            \"inline_javascript_mixed_case.svg\",",
            "        ]",
            "    )",
            "    def test_uploading_svg_with_inline_script_should_fail(self, file_name):",
            "        with open(f\"tests/ui/data/{file_name}\", \"rb\") as svg_file:",
            "            b64 = base64.b64encode(svg_file.read()).decode()",
            "",
            "            message = str(_(\"File contains forbidden <script> tag\"))",
            "            with self.assertRaisesRegex(Fault, message):",
            "                self.rpc_client.User.add_attachment(\"inline_javascript.svg\", b64)",
            "",
            "    @parameterized.expand(",
            "        [",
            "            \"svg_with_onload_attribute.svg\",",
            "        ]",
            "    )",
            "    def test_uploading_svg_with_forbidden_attributes_should_fail(self, file_name):",
            "        with open(f\"tests/ui/data/{file_name}\", \"rb\") as svg_file:",
            "            b64 = base64.b64encode(svg_file.read()).decode()",
            "",
            "            message = str(_(\"File contains forbidden attribute:\"))",
            "            with self.assertRaisesRegex(Fault, message):",
            "                self.rpc_client.User.add_attachment(\"image.svg\", b64)",
            "",
            "    def test_uploading_filename_ending_in_dot_exe_should_fail(self):",
            "        message = str(_(\"Uploading executable files is forbidden\"))",
            "        with self.assertRaisesRegex(Fault, message):",
            "            self.rpc_client.User.add_attachment(\"hello.exe\", \"a2l3aXRjbXM=\")",
            "",
            "    def test_uploading_real_exe_file_should_fail(self):",
            "        with open(\"tests/ui/data/reactos_csrss.exe\", \"rb\") as exe_file:",
            "            b64 = base64.b64encode(exe_file.read()).decode()",
            "",
            "            message = str(_(\"Uploading executable files is forbidden\"))",
            "            with self.assertRaisesRegex(Fault, message):",
            "                self.rpc_client.User.add_attachment(\"csrss.exe_from_reactos\", b64)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {},
        "addLocation": [
            "tcms.kiwi_attachments.tests.test_validators.TestValidators.self",
            "IPython"
        ]
    },
    "tcms/kiwi_attachments/validators.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 7,
                "afterPatchRowNumber": 7,
                "PatchRowcode": "         if chunk.lower().find(b\"<script\") > -1:"
            },
            "1": {
                "beforePatchRowNumber": 8,
                "afterPatchRowNumber": 8,
                "PatchRowcode": "             raise ValidationError(_(\"File contains forbidden <script> tag\"))"
            },
            "2": {
                "beforePatchRowNumber": 9,
                "afterPatchRowNumber": 9,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 10,
                "PatchRowcode": "+        if chunk.lower().find(b\"onload=\") > -1:"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 11,
                "PatchRowcode": "+            raise ValidationError(_(\"File contains forbidden attribute:\") + \"onload\")"
            },
            "5": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 12,
                "PatchRowcode": "+"
            },
            "6": {
                "beforePatchRowNumber": 10,
                "afterPatchRowNumber": 13,
                "PatchRowcode": " "
            },
            "7": {
                "beforePatchRowNumber": 11,
                "afterPatchRowNumber": 14,
                "PatchRowcode": " def deny_uploads_ending_in_dot_exe(uploaded_file):"
            },
            "8": {
                "beforePatchRowNumber": 12,
                "afterPatchRowNumber": 15,
                "PatchRowcode": "     message = _(\"Uploading executable files is forbidden\")"
            }
        },
        "frontPatchFile": [
            "from django.forms import ValidationError",
            "from django.utils.translation import gettext_lazy as _",
            "",
            "",
            "def deny_uploads_containing_script_tag(uploaded_file):",
            "    for chunk in uploaded_file.chunks(2048):",
            "        if chunk.lower().find(b\"<script\") > -1:",
            "            raise ValidationError(_(\"File contains forbidden <script> tag\"))",
            "",
            "",
            "def deny_uploads_ending_in_dot_exe(uploaded_file):",
            "    message = _(\"Uploading executable files is forbidden\")",
            "",
            "    if uploaded_file.name.find(\".exe\") > -1:",
            "        raise ValidationError(message)",
            "",
            "    if uploaded_file.content_type in [",
            "        \"application/vnd.microsoft.portable-executable\",",
            "        \"application/x-dosexec\",",
            "        \"application/x-ms-dos-executable\",",
            "        \"application/x-msdownload\",",
            "    ]:",
            "        raise ValidationError(message)"
        ],
        "afterPatchFile": [
            "from django.forms import ValidationError",
            "from django.utils.translation import gettext_lazy as _",
            "",
            "",
            "def deny_uploads_containing_script_tag(uploaded_file):",
            "    for chunk in uploaded_file.chunks(2048):",
            "        if chunk.lower().find(b\"<script\") > -1:",
            "            raise ValidationError(_(\"File contains forbidden <script> tag\"))",
            "",
            "        if chunk.lower().find(b\"onload=\") > -1:",
            "            raise ValidationError(_(\"File contains forbidden attribute:\") + \"onload\")",
            "",
            "",
            "def deny_uploads_ending_in_dot_exe(uploaded_file):",
            "    message = _(\"Uploading executable files is forbidden\")",
            "",
            "    if uploaded_file.name.find(\".exe\") > -1:",
            "        raise ValidationError(message)",
            "",
            "    if uploaded_file.content_type in [",
            "        \"application/vnd.microsoft.portable-executable\",",
            "        \"application/x-dosexec\",",
            "        \"application/x-ms-dos-executable\",",
            "        \"application/x-msdownload\",",
            "    ]:",
            "        raise ValidationError(message)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {},
        "addLocation": [
            "IPython"
        ]
    }
}