{
    "packaging/os/apt_key.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 113,
                "afterPatchRowNumber": 113,
                "PatchRowcode": " from ansible.module_utils.urls import fetch_url"
            },
            "1": {
                "beforePatchRowNumber": 114,
                "afterPatchRowNumber": 114,
                "PatchRowcode": " "
            },
            "2": {
                "beforePatchRowNumber": 115,
                "afterPatchRowNumber": 115,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": 116,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-gpg_bin = None"
            },
            "4": {
                "beforePatchRowNumber": 117,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-grep_bin = None"
            },
            "5": {
                "beforePatchRowNumber": 118,
                "afterPatchRowNumber": 116,
                "PatchRowcode": " apt_key_bin = None"
            },
            "6": {
                "beforePatchRowNumber": 119,
                "afterPatchRowNumber": 117,
                "PatchRowcode": " "
            },
            "7": {
                "beforePatchRowNumber": 120,
                "afterPatchRowNumber": 118,
                "PatchRowcode": " "
            },
            "8": {
                "beforePatchRowNumber": 121,
                "afterPatchRowNumber": 119,
                "PatchRowcode": " def find_needed_binaries(module):"
            },
            "9": {
                "beforePatchRowNumber": 122,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    global gpg_bin"
            },
            "10": {
                "beforePatchRowNumber": 123,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    global grep_bin"
            },
            "11": {
                "beforePatchRowNumber": 124,
                "afterPatchRowNumber": 120,
                "PatchRowcode": "     global apt_key_bin"
            },
            "12": {
                "beforePatchRowNumber": 125,
                "afterPatchRowNumber": 121,
                "PatchRowcode": " "
            },
            "13": {
                "beforePatchRowNumber": 126,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    gpg_bin = module.get_bin_path('gpg', required=True)"
            },
            "14": {
                "beforePatchRowNumber": 127,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    grep_bin = module.get_bin_path('grep', required=True)"
            },
            "15": {
                "beforePatchRowNumber": 128,
                "afterPatchRowNumber": 122,
                "PatchRowcode": "     apt_key_bin = module.get_bin_path('apt-key', required=True)"
            },
            "16": {
                "beforePatchRowNumber": 129,
                "afterPatchRowNumber": 123,
                "PatchRowcode": " "
            },
            "17": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 124,
                "PatchRowcode": "+    ### FIXME: Is there a reason that gpg and grep are checked?  Is it just"
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 125,
                "PatchRowcode": "+    # cruft or does the apt .deb package not require them (and if they're not"
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 126,
                "PatchRowcode": "+    # installed, /usr/bin/apt-key fails?)"
            },
            "20": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 127,
                "PatchRowcode": "+    module.get_bin_path('gpg', required=True)"
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 128,
                "PatchRowcode": "+    module.get_bin_path('grep', required=True)"
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 129,
                "PatchRowcode": "+"
            },
            "23": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 130,
                "PatchRowcode": "+"
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 131,
                "PatchRowcode": "+def parse_key_id(key_id):"
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 132,
                "PatchRowcode": "+    \"\"\"validate the key_id and break it into segments"
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 133,
                "PatchRowcode": "+"
            },
            "27": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 134,
                "PatchRowcode": "+    :arg key_id: The key_id as supplied by the user.  A valid key_id will be"
            },
            "28": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 135,
                "PatchRowcode": "+        8, 16, or more hexadecimal chars with an optional leading ``0x``."
            },
            "29": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 136,
                "PatchRowcode": "+    :returns: The portion of key_id suitable for apt-key del, the portion"
            },
            "30": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 137,
                "PatchRowcode": "+        suitable for comparisons with --list-public-keys, and the portion that"
            },
            "31": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 138,
                "PatchRowcode": "+        can be used with --recv-key.  If key_id is long enough, these will be"
            },
            "32": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 139,
                "PatchRowcode": "+        the last 8 characters of key_id, the last 16 characters, and all of"
            },
            "33": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 140,
                "PatchRowcode": "+        key_id.  If key_id is not long enough, some of the values will be the"
            },
            "34": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 141,
                "PatchRowcode": "+        same."
            },
            "35": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 142,
                "PatchRowcode": "+"
            },
            "36": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 143,
                "PatchRowcode": "+    * apt-key del <= 1.10 has a bug with key_id != 8 chars"
            },
            "37": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 144,
                "PatchRowcode": "+    * apt-key adv --list-public-keys prints 16 chars"
            },
            "38": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 145,
                "PatchRowcode": "+    * apt-key adv --recv-key can take more chars"
            },
            "39": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 146,
                "PatchRowcode": "+"
            },
            "40": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 147,
                "PatchRowcode": "+    \"\"\""
            },
            "41": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 148,
                "PatchRowcode": "+    # Make sure the key_id is valid hexadecimal"
            },
            "42": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 149,
                "PatchRowcode": "+    int(key_id, 16)"
            },
            "43": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 150,
                "PatchRowcode": "+"
            },
            "44": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 151,
                "PatchRowcode": "+    key_id = key_id.upper()"
            },
            "45": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 152,
                "PatchRowcode": "+    if key_id.startswith('0X'):"
            },
            "46": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 153,
                "PatchRowcode": "+        key_id = key_id[2:]"
            },
            "47": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 154,
                "PatchRowcode": "+"
            },
            "48": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 155,
                "PatchRowcode": "+    key_id_len = len(key_id)"
            },
            "49": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 156,
                "PatchRowcode": "+    if (key_id_len != 8 and key_id_len != 16) and key_id_len <= 16:"
            },
            "50": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 157,
                "PatchRowcode": "+        raise ValueError('key_id must be 8, 16, or 16+ hexadecimal characters in length')"
            },
            "51": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 158,
                "PatchRowcode": "+"
            },
            "52": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 159,
                "PatchRowcode": "+    short_key_id = key_id[-8:]"
            },
            "53": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 160,
                "PatchRowcode": "+"
            },
            "54": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 161,
                "PatchRowcode": "+    fingerprint = key_id"
            },
            "55": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 162,
                "PatchRowcode": "+    if key_id_len > 16:"
            },
            "56": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 163,
                "PatchRowcode": "+        fingerprint = key_id[-16:]"
            },
            "57": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 164,
                "PatchRowcode": "+"
            },
            "58": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 165,
                "PatchRowcode": "+    return short_key_id, fingerprint, key_id"
            },
            "59": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 166,
                "PatchRowcode": "+"
            },
            "60": {
                "beforePatchRowNumber": 130,
                "afterPatchRowNumber": 167,
                "PatchRowcode": " "
            },
            "61": {
                "beforePatchRowNumber": 131,
                "afterPatchRowNumber": 168,
                "PatchRowcode": " def all_keys(module, keyring, short_format):"
            },
            "62": {
                "beforePatchRowNumber": 132,
                "afterPatchRowNumber": 169,
                "PatchRowcode": "     if keyring:"
            },
            "63": {
                "beforePatchRowNumber": 133,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        cmd = \"apt-key --keyring %s adv --list-public-keys --keyid-format=long\" % keyring"
            },
            "64": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 170,
                "PatchRowcode": "+        cmd = \"%s --keyring %s adv --list-public-keys --keyid-format=long\" % (apt_key_bin, keyring)"
            },
            "65": {
                "beforePatchRowNumber": 134,
                "afterPatchRowNumber": 171,
                "PatchRowcode": "     else:"
            },
            "66": {
                "beforePatchRowNumber": 135,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        cmd = \"apt-key adv --list-public-keys --keyid-format=long\""
            },
            "67": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 172,
                "PatchRowcode": "+        cmd = \"%s adv --list-public-keys --keyid-format=long\" % apt_key_bin"
            },
            "68": {
                "beforePatchRowNumber": 136,
                "afterPatchRowNumber": 173,
                "PatchRowcode": "     (rc, out, err) = module.run_command(cmd)"
            },
            "69": {
                "beforePatchRowNumber": 137,
                "afterPatchRowNumber": 174,
                "PatchRowcode": "     results = []"
            },
            "70": {
                "beforePatchRowNumber": 138,
                "afterPatchRowNumber": 175,
                "PatchRowcode": "     lines = to_native(out).split('\\n')"
            },
            "71": {
                "beforePatchRowNumber": 176,
                "afterPatchRowNumber": 213,
                "PatchRowcode": " "
            },
            "72": {
                "beforePatchRowNumber": 177,
                "afterPatchRowNumber": 214,
                "PatchRowcode": " def import_key(module, keyring, keyserver, key_id):"
            },
            "73": {
                "beforePatchRowNumber": 178,
                "afterPatchRowNumber": 215,
                "PatchRowcode": "     if keyring:"
            },
            "74": {
                "beforePatchRowNumber": 179,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        cmd = \"apt-key --keyring %s adv --keyserver %s --recv %s\" % (keyring, keyserver, key_id)"
            },
            "75": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 216,
                "PatchRowcode": "+        cmd = \"%s --keyring %s adv --keyserver %s --recv %s\" % (apt_key_bin, keyring, keyserver, key_id)"
            },
            "76": {
                "beforePatchRowNumber": 180,
                "afterPatchRowNumber": 217,
                "PatchRowcode": "     else:"
            },
            "77": {
                "beforePatchRowNumber": 181,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        cmd = \"apt-key adv --keyserver %s --recv %s\" % (keyserver, key_id)"
            },
            "78": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 218,
                "PatchRowcode": "+        cmd = \"%s adv --keyserver %s --recv %s\" % (apt_key_bin, keyserver, key_id)"
            },
            "79": {
                "beforePatchRowNumber": 182,
                "afterPatchRowNumber": 219,
                "PatchRowcode": "     for retry in range(5):"
            },
            "80": {
                "beforePatchRowNumber": 183,
                "afterPatchRowNumber": 220,
                "PatchRowcode": "         lang_env = dict(LANG='C', LC_ALL='C', LC_MESSAGES='C')"
            },
            "81": {
                "beforePatchRowNumber": 184,
                "afterPatchRowNumber": 221,
                "PatchRowcode": "         (rc, out, err) = module.run_command(cmd, environ_update=lang_env)"
            },
            "82": {
                "beforePatchRowNumber": 198,
                "afterPatchRowNumber": 235,
                "PatchRowcode": " def add_key(module, keyfile, keyring, data=None):"
            },
            "83": {
                "beforePatchRowNumber": 199,
                "afterPatchRowNumber": 236,
                "PatchRowcode": "     if data is not None:"
            },
            "84": {
                "beforePatchRowNumber": 200,
                "afterPatchRowNumber": 237,
                "PatchRowcode": "         if keyring:"
            },
            "85": {
                "beforePatchRowNumber": 201,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            cmd = \"apt-key --keyring %s add -\" % keyring"
            },
            "86": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 238,
                "PatchRowcode": "+            cmd = \"%s --keyring %s add -\" % (apt_key_bin, keyring)"
            },
            "87": {
                "beforePatchRowNumber": 202,
                "afterPatchRowNumber": 239,
                "PatchRowcode": "         else:"
            },
            "88": {
                "beforePatchRowNumber": 203,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            cmd = \"apt-key add -\""
            },
            "89": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 240,
                "PatchRowcode": "+            cmd = \"%s add -\" % apt_key_bin"
            },
            "90": {
                "beforePatchRowNumber": 204,
                "afterPatchRowNumber": 241,
                "PatchRowcode": "         (rc, out, err) = module.run_command(cmd, data=data, check_rc=True, binary_data=True)"
            },
            "91": {
                "beforePatchRowNumber": 205,
                "afterPatchRowNumber": 242,
                "PatchRowcode": "     else:"
            },
            "92": {
                "beforePatchRowNumber": 206,
                "afterPatchRowNumber": 243,
                "PatchRowcode": "         if keyring:"
            },
            "93": {
                "beforePatchRowNumber": 207,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            cmd = \"apt-key --keyring %s add %s\" % (keyring, keyfile)"
            },
            "94": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 244,
                "PatchRowcode": "+            cmd = \"%s --keyring %s add %s\" % (apt_key_bin, keyring, keyfile)"
            },
            "95": {
                "beforePatchRowNumber": 208,
                "afterPatchRowNumber": 245,
                "PatchRowcode": "         else:"
            },
            "96": {
                "beforePatchRowNumber": 209,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            cmd = \"apt-key add %s\" % (keyfile)"
            },
            "97": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 246,
                "PatchRowcode": "+            cmd = \"%s add %s\" % (apt_key_bin, keyfile)"
            },
            "98": {
                "beforePatchRowNumber": 210,
                "afterPatchRowNumber": 247,
                "PatchRowcode": "         (rc, out, err) = module.run_command(cmd, check_rc=True)"
            },
            "99": {
                "beforePatchRowNumber": 211,
                "afterPatchRowNumber": 248,
                "PatchRowcode": "     return True"
            },
            "100": {
                "beforePatchRowNumber": 212,
                "afterPatchRowNumber": 249,
                "PatchRowcode": " "
            },
            "101": {
                "beforePatchRowNumber": 213,
                "afterPatchRowNumber": 250,
                "PatchRowcode": " "
            },
            "102": {
                "beforePatchRowNumber": 214,
                "afterPatchRowNumber": 251,
                "PatchRowcode": " def remove_key(module, key_id, keyring):"
            },
            "103": {
                "beforePatchRowNumber": 215,
                "afterPatchRowNumber": 252,
                "PatchRowcode": "     # FIXME: use module.run_command, fail at point of error and don't discard useful stdin/stdout"
            },
            "104": {
                "beforePatchRowNumber": 216,
                "afterPatchRowNumber": 253,
                "PatchRowcode": "     if keyring:"
            },
            "105": {
                "beforePatchRowNumber": 217,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        cmd = 'apt-key --keyring %s del %s' % (keyring, key_id)"
            },
            "106": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 254,
                "PatchRowcode": "+        cmd = '%s --keyring %s del %s' % (apt_key_bin, keyring, key_id)"
            },
            "107": {
                "beforePatchRowNumber": 218,
                "afterPatchRowNumber": 255,
                "PatchRowcode": "     else:"
            },
            "108": {
                "beforePatchRowNumber": 219,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        cmd = 'apt-key del %s' % key_id"
            },
            "109": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 256,
                "PatchRowcode": "+        cmd = '%s del %s' % (apt_key_bin, key_id)"
            },
            "110": {
                "beforePatchRowNumber": 220,
                "afterPatchRowNumber": 257,
                "PatchRowcode": "     (rc, out, err) = module.run_command(cmd, check_rc=True)"
            },
            "111": {
                "beforePatchRowNumber": 221,
                "afterPatchRowNumber": 258,
                "PatchRowcode": "     return True"
            },
            "112": {
                "beforePatchRowNumber": 222,
                "afterPatchRowNumber": 259,
                "PatchRowcode": " "
            },
            "113": {
                "beforePatchRowNumber": 234,
                "afterPatchRowNumber": 271,
                "PatchRowcode": "             keyserver=dict(required=False),"
            },
            "114": {
                "beforePatchRowNumber": 235,
                "afterPatchRowNumber": 272,
                "PatchRowcode": "             state=dict(required=False, choices=['present', 'absent'], default='present')"
            },
            "115": {
                "beforePatchRowNumber": 236,
                "afterPatchRowNumber": 273,
                "PatchRowcode": "         ),"
            },
            "116": {
                "beforePatchRowNumber": 237,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        supports_check_mode=True"
            },
            "117": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 274,
                "PatchRowcode": "+        supports_check_mode=True,"
            },
            "118": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 275,
                "PatchRowcode": "+        mutually_exclusive=(('filename', 'keyserver', 'data', 'url'),),"
            },
            "119": {
                "beforePatchRowNumber": 238,
                "afterPatchRowNumber": 276,
                "PatchRowcode": "     )"
            },
            "120": {
                "beforePatchRowNumber": 239,
                "afterPatchRowNumber": 277,
                "PatchRowcode": " "
            },
            "121": {
                "beforePatchRowNumber": 240,
                "afterPatchRowNumber": 278,
                "PatchRowcode": "     key_id          = module.params['id']"
            },
            "122": {
                "beforePatchRowNumber": 246,
                "afterPatchRowNumber": 284,
                "PatchRowcode": "     keyserver       = module.params['keyserver']"
            },
            "123": {
                "beforePatchRowNumber": 247,
                "afterPatchRowNumber": 285,
                "PatchRowcode": "     changed         = False"
            },
            "124": {
                "beforePatchRowNumber": 248,
                "afterPatchRowNumber": 286,
                "PatchRowcode": " "
            },
            "125": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 287,
                "PatchRowcode": "+    fingerprint = short_key_id = key_id"
            },
            "126": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 288,
                "PatchRowcode": "+    short_format = False"
            },
            "127": {
                "beforePatchRowNumber": 249,
                "afterPatchRowNumber": 289,
                "PatchRowcode": "     if key_id:"
            },
            "128": {
                "beforePatchRowNumber": 250,
                "afterPatchRowNumber": 290,
                "PatchRowcode": "         try:"
            },
            "129": {
                "beforePatchRowNumber": 251,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            int(key_id, 16)"
            },
            "130": {
                "beforePatchRowNumber": 252,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            if key_id.startswith('0x'):"
            },
            "131": {
                "beforePatchRowNumber": 253,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                key_id = key_id[2:]"
            },
            "132": {
                "beforePatchRowNumber": 254,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            key_id = key_id.upper()"
            },
            "133": {
                "beforePatchRowNumber": 255,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            short_key_id = key_id[-8:]"
            },
            "134": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 291,
                "PatchRowcode": "+            key_id, fingerprint, short_key_id = parse_key_id(key_id)"
            },
            "135": {
                "beforePatchRowNumber": 256,
                "afterPatchRowNumber": 292,
                "PatchRowcode": "         except ValueError:"
            },
            "136": {
                "beforePatchRowNumber": 257,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            module.fail_json(msg=\"Invalid key_id\", id=key_id)"
            },
            "137": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 293,
                "PatchRowcode": "+            module.fail_json(msg='Invalid key_id', id=key_id)"
            },
            "138": {
                "beforePatchRowNumber": 258,
                "afterPatchRowNumber": 294,
                "PatchRowcode": " "
            },
            "139": {
                "beforePatchRowNumber": 259,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    find_needed_binaries(module)"
            },
            "140": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 295,
                "PatchRowcode": "+        if len(fingerprint) == 8:"
            },
            "141": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 296,
                "PatchRowcode": "+            short_format = True"
            },
            "142": {
                "beforePatchRowNumber": 260,
                "afterPatchRowNumber": 297,
                "PatchRowcode": " "
            },
            "143": {
                "beforePatchRowNumber": 261,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    short_format = False"
            },
            "144": {
                "beforePatchRowNumber": 262,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    if key_id == short_key_id:"
            },
            "145": {
                "beforePatchRowNumber": 263,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        short_format = True"
            },
            "146": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 298,
                "PatchRowcode": "+    find_needed_binaries(module)"
            },
            "147": {
                "beforePatchRowNumber": 264,
                "afterPatchRowNumber": 299,
                "PatchRowcode": " "
            },
            "148": {
                "beforePatchRowNumber": 265,
                "afterPatchRowNumber": 300,
                "PatchRowcode": "     keys = all_keys(module, keyring, short_format)"
            },
            "149": {
                "beforePatchRowNumber": 266,
                "afterPatchRowNumber": 301,
                "PatchRowcode": "     return_values = {}"
            },
            "150": {
                "beforePatchRowNumber": 267,
                "afterPatchRowNumber": 302,
                "PatchRowcode": " "
            },
            "151": {
                "beforePatchRowNumber": 268,
                "afterPatchRowNumber": 303,
                "PatchRowcode": "     if state == 'present':"
            },
            "152": {
                "beforePatchRowNumber": 269,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        if key_id and key_id in keys:"
            },
            "153": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 304,
                "PatchRowcode": "+        if fingerprint and fingerprint in keys:"
            },
            "154": {
                "beforePatchRowNumber": 270,
                "afterPatchRowNumber": 305,
                "PatchRowcode": "             module.exit_json(changed=False)"
            },
            "155": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 306,
                "PatchRowcode": "+        elif fingerprint and fingerprint not in keys and module.check_mode:"
            },
            "156": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 307,
                "PatchRowcode": "+            ### TODO: Someday we could go further -- write keys out to"
            },
            "157": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 308,
                "PatchRowcode": "+            # a temporary file and then extract the key id from there via gpg"
            },
            "158": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 309,
                "PatchRowcode": "+            # to decide if the key is installed or not."
            },
            "159": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 310,
                "PatchRowcode": "+            module.exit_json(changed=True)"
            },
            "160": {
                "beforePatchRowNumber": 271,
                "afterPatchRowNumber": 311,
                "PatchRowcode": "         else:"
            },
            "161": {
                "beforePatchRowNumber": 272,
                "afterPatchRowNumber": 312,
                "PatchRowcode": "             if not filename and not data and not keyserver:"
            },
            "162": {
                "beforePatchRowNumber": 273,
                "afterPatchRowNumber": 313,
                "PatchRowcode": "                 data = download_key(module, url)"
            },
            "163": {
                "beforePatchRowNumber": 274,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            if key_id and key_id in keys:"
            },
            "164": {
                "beforePatchRowNumber": 275,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                module.exit_json(changed=False)"
            },
            "165": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 314,
                "PatchRowcode": "+"
            },
            "166": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 315,
                "PatchRowcode": "+            if filename:"
            },
            "167": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 316,
                "PatchRowcode": "+                add_key(module, filename, keyring)"
            },
            "168": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 317,
                "PatchRowcode": "+            elif keyserver:"
            },
            "169": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 318,
                "PatchRowcode": "+                import_key(module, keyring, keyserver, key_id)"
            },
            "170": {
                "beforePatchRowNumber": 276,
                "afterPatchRowNumber": 319,
                "PatchRowcode": "             else:"
            },
            "171": {
                "beforePatchRowNumber": 277,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                if module.check_mode:"
            },
            "172": {
                "beforePatchRowNumber": 278,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    module.exit_json(changed=True)"
            },
            "173": {
                "beforePatchRowNumber": 279,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                if filename:"
            },
            "174": {
                "beforePatchRowNumber": 280,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    add_key(module, filename, keyring)"
            },
            "175": {
                "beforePatchRowNumber": 281,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                elif keyserver:"
            },
            "176": {
                "beforePatchRowNumber": 282,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    import_key(module, keyring, keyserver, key_id)"
            },
            "177": {
                "beforePatchRowNumber": 283,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                else:"
            },
            "178": {
                "beforePatchRowNumber": 284,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    add_key(module, \"-\", keyring, data)"
            },
            "179": {
                "beforePatchRowNumber": 285,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                changed=False"
            },
            "180": {
                "beforePatchRowNumber": 286,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                keys2 = all_keys(module, keyring, short_format)"
            },
            "181": {
                "beforePatchRowNumber": 287,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                if len(keys) != len(keys2):"
            },
            "182": {
                "beforePatchRowNumber": 288,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    changed=True"
            },
            "183": {
                "beforePatchRowNumber": 289,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                if key_id and key_id not in keys2:"
            },
            "184": {
                "beforePatchRowNumber": 290,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    module.fail_json(msg=\"key does not seem to have been added\", id=key_id)"
            },
            "185": {
                "beforePatchRowNumber": 291,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                module.exit_json(changed=changed)"
            },
            "186": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 320,
                "PatchRowcode": "+                add_key(module, \"-\", keyring, data)"
            },
            "187": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 321,
                "PatchRowcode": "+"
            },
            "188": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 322,
                "PatchRowcode": "+            changed = False"
            },
            "189": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 323,
                "PatchRowcode": "+            keys2 = all_keys(module, keyring, short_format)"
            },
            "190": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 324,
                "PatchRowcode": "+            if len(keys) != len(keys2):"
            },
            "191": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 325,
                "PatchRowcode": "+                changed=True"
            },
            "192": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 326,
                "PatchRowcode": "+"
            },
            "193": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 327,
                "PatchRowcode": "+            if fingerprint and fingerprint not in keys2:"
            },
            "194": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 328,
                "PatchRowcode": "+                module.fail_json(msg=\"key does not seem to have been added\", id=key_id)"
            },
            "195": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 329,
                "PatchRowcode": "+            module.exit_json(changed=changed)"
            },
            "196": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 330,
                "PatchRowcode": "+"
            },
            "197": {
                "beforePatchRowNumber": 292,
                "afterPatchRowNumber": 331,
                "PatchRowcode": "     elif state == 'absent':"
            },
            "198": {
                "beforePatchRowNumber": 293,
                "afterPatchRowNumber": 332,
                "PatchRowcode": "         if not key_id:"
            },
            "199": {
                "beforePatchRowNumber": 294,
                "afterPatchRowNumber": 333,
                "PatchRowcode": "             module.fail_json(msg=\"key is required\")"
            },
            "200": {
                "beforePatchRowNumber": 295,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        if key_id in keys:"
            },
            "201": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 334,
                "PatchRowcode": "+        if fingerprint in keys:"
            },
            "202": {
                "beforePatchRowNumber": 296,
                "afterPatchRowNumber": 335,
                "PatchRowcode": "             if module.check_mode:"
            },
            "203": {
                "beforePatchRowNumber": 297,
                "afterPatchRowNumber": 336,
                "PatchRowcode": "                 module.exit_json(changed=True)"
            },
            "204": {
                "beforePatchRowNumber": 298,
                "afterPatchRowNumber": 337,
                "PatchRowcode": " "
            },
            "205": {
                "beforePatchRowNumber": 299,
                "afterPatchRowNumber": 338,
                "PatchRowcode": "             # we use the \"short\" id: key_id[-8:], short_format=True"
            },
            "206": {
                "beforePatchRowNumber": 300,
                "afterPatchRowNumber": 339,
                "PatchRowcode": "             # it's a workaround for https://bugs.launchpad.net/ubuntu/+source/apt/+bug/1481871"
            },
            "207": {
                "beforePatchRowNumber": 301,
                "afterPatchRowNumber": 340,
                "PatchRowcode": "             if remove_key(module, short_key_id, keyring):"
            },
            "208": {
                "beforePatchRowNumber": 302,
                "afterPatchRowNumber": 341,
                "PatchRowcode": "                 keys = all_keys(module, keyring, short_format)"
            },
            "209": {
                "beforePatchRowNumber": 303,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                if key_id in keys:"
            },
            "210": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 342,
                "PatchRowcode": "+                if fingerprint in keys:"
            },
            "211": {
                "beforePatchRowNumber": 304,
                "afterPatchRowNumber": 343,
                "PatchRowcode": "                     module.fail_json(msg=\"apt-key del did not return an error but the key was not removed (check that the id is correct and *not* a subkey)\", id=key_id)"
            },
            "212": {
                "beforePatchRowNumber": 305,
                "afterPatchRowNumber": 344,
                "PatchRowcode": "                 changed = True"
            },
            "213": {
                "beforePatchRowNumber": 306,
                "afterPatchRowNumber": 345,
                "PatchRowcode": "             else:"
            }
        },
        "frontPatchFile": [
            "#!/usr/bin/python",
            "# -*- coding: utf-8 -*-",
            "",
            "# (c) 2012, Michael DeHaan <michael.dehaan@gmail.com>",
            "# (c) 2012, Jayson Vantuyl <jayson@aggressive.ly>",
            "#",
            "# This file is part of Ansible",
            "#",
            "# Ansible is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# Ansible is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with Ansible.  If not, see <http://www.gnu.org/licenses/>.",
            "",
            "DOCUMENTATION = '''",
            "---",
            "module: apt_key",
            "author: \"Jayson Vantuyl & others (@jvantuyl)\"",
            "version_added: \"1.0\"",
            "short_description: Add or remove an apt key",
            "description:",
            "    - Add or remove an I(apt) key, optionally downloading it",
            "notes:",
            "    - doesn't download the key unless it really needs it",
            "    - as a sanity check, downloaded key id must match the one specified",
            "    - best practice is to specify the key id and the url",
            "options:",
            "    id:",
            "        required: false",
            "        default: none",
            "        description:",
            "            - identifier of key. Including this allows check mode to correctly report the changed state.",
            "            - \"If specifying a subkey's id be aware that apt-key does not understand how to remove keys via a subkey id.  Specify the primary key's id instead.\"",
            "    data:",
            "        required: false",
            "        default: none",
            "        description:",
            "            - keyfile contents to add to the keyring",
            "    file:",
            "        required: false",
            "        default: none",
            "        description:",
            "            - path to a keyfile to add to the keyring",
            "    keyring:",
            "        required: false",
            "        default: none",
            "        description:",
            "            - path to specific keyring file in /etc/apt/trusted.gpg.d",
            "        version_added: \"1.3\"",
            "    url:",
            "        required: false",
            "        default: none",
            "        description:",
            "            - url to retrieve key from.",
            "    keyserver:",
            "        version_added: \"1.6\"",
            "        required: false",
            "        default: none",
            "        description:",
            "            - keyserver to retrieve key from.",
            "    state:",
            "        required: false",
            "        choices: [ absent, present ]",
            "        default: present",
            "        description:",
            "            - used to specify if key is being added or revoked",
            "    validate_certs:",
            "        description:",
            "            - If C(no), SSL certificates for the target url will not be validated. This should only be used",
            "              on personally controlled sites using self-signed certificates.",
            "        required: false",
            "        default: 'yes'",
            "        choices: ['yes', 'no']",
            "",
            "'''",
            "",
            "EXAMPLES = '''",
            "# Add an apt key by id from a keyserver",
            "- apt_key: keyserver=keyserver.ubuntu.com id=36A1D7869245C8950F966E92D8576A8BA88D21E9",
            "",
            "# Add an Apt signing key, uses whichever key is at the URL",
            "- apt_key: url=https://ftp-master.debian.org/keys/archive-key-6.0.asc state=present",
            "",
            "# Add an Apt signing key, will not download if present",
            "- apt_key: id=473041FA url=https://ftp-master.debian.org/keys/archive-key-6.0.asc state=present",
            "",
            "# Remove an Apt signing key, uses whichever key is at the URL",
            "- apt_key: url=https://ftp-master.debian.org/keys/archive-key-6.0.asc state=absent",
            "",
            "# Remove a Apt specific signing key, leading 0x is valid",
            "- apt_key: id=0x473041FA state=absent",
            "",
            "# Add a key from a file on the Ansible server",
            "- apt_key: data=\"{{ lookup('file', 'apt.gpg') }}\" state=present",
            "",
            "# Add an Apt signing key to a specific keyring file",
            "- apt_key: id=473041FA url=https://ftp-master.debian.org/keys/archive-key-6.0.asc keyring=/etc/apt/trusted.gpg.d/debian.gpg state=present",
            "'''",
            "",
            "",
            "# FIXME: standardize into module_common",
            "from traceback import format_exc",
            "",
            "from ansible.module_utils.basic import AnsibleModule",
            "from ansible.module_utils._text import to_native",
            "from ansible.module_utils.urls import fetch_url",
            "",
            "",
            "gpg_bin = None",
            "grep_bin = None",
            "apt_key_bin = None",
            "",
            "",
            "def find_needed_binaries(module):",
            "    global gpg_bin",
            "    global grep_bin",
            "    global apt_key_bin",
            "",
            "    gpg_bin = module.get_bin_path('gpg', required=True)",
            "    grep_bin = module.get_bin_path('grep', required=True)",
            "    apt_key_bin = module.get_bin_path('apt-key', required=True)",
            "",
            "",
            "def all_keys(module, keyring, short_format):",
            "    if keyring:",
            "        cmd = \"apt-key --keyring %s adv --list-public-keys --keyid-format=long\" % keyring",
            "    else:",
            "        cmd = \"apt-key adv --list-public-keys --keyid-format=long\"",
            "    (rc, out, err) = module.run_command(cmd)",
            "    results = []",
            "    lines = to_native(out).split('\\n')",
            "    for line in lines:",
            "        if line.startswith(\"pub\") or line.startswith(\"sub\"):",
            "            tokens = line.split()",
            "            code = tokens[1]",
            "            (len_type, real_code) = code.split(\"/\")",
            "            results.append(real_code)",
            "    if short_format:",
            "        results = shorten_key_ids(results)",
            "    return results",
            "",
            "",
            "def shorten_key_ids(key_id_list):",
            "    \"\"\"",
            "    Takes a list of key ids, and converts them to the 'short' format,",
            "    by reducing them to their last 8 characters.",
            "    \"\"\"",
            "    short = []",
            "    for key in key_id_list:",
            "        short.append(key[-8:])",
            "    return short",
            "",
            "",
            "def download_key(module, url):",
            "    # FIXME: move get_url code to common, allow for in-memory D/L, support proxies",
            "    # and reuse here",
            "    if url is None:",
            "        module.fail_json(msg=\"needed a URL but was not specified\")",
            "",
            "    try:",
            "        rsp, info = fetch_url(module, url)",
            "        if info['status'] != 200:",
            "            module.fail_json(msg=\"Failed to download key at %s: %s\" % (url, info['msg']))",
            "",
            "        return rsp.read()",
            "    except Exception:",
            "        module.fail_json(msg=\"error getting key id from url: %s\" % url, traceback=format_exc())",
            "",
            "",
            "def import_key(module, keyring, keyserver, key_id):",
            "    if keyring:",
            "        cmd = \"apt-key --keyring %s adv --keyserver %s --recv %s\" % (keyring, keyserver, key_id)",
            "    else:",
            "        cmd = \"apt-key adv --keyserver %s --recv %s\" % (keyserver, key_id)",
            "    for retry in range(5):",
            "        lang_env = dict(LANG='C', LC_ALL='C', LC_MESSAGES='C')",
            "        (rc, out, err) = module.run_command(cmd, environ_update=lang_env)",
            "        if rc == 0:",
            "            break",
            "    else:",
            "        # Out of retries",
            "        if rc == 2 and 'not found on keyserver' in out:",
            "            msg = 'Key %s not found on keyserver %s' % (key_id, keyserver)",
            "            module.fail_json(cmd=cmd, msg=msg)",
            "        else:",
            "            msg = \"Error fetching key %s from keyserver: %s\" % (key_id, keyserver)",
            "            module.fail_json(cmd=cmd, msg=msg, rc=rc, stdout=out, stderr=err)",
            "    return True",
            "",
            "",
            "def add_key(module, keyfile, keyring, data=None):",
            "    if data is not None:",
            "        if keyring:",
            "            cmd = \"apt-key --keyring %s add -\" % keyring",
            "        else:",
            "            cmd = \"apt-key add -\"",
            "        (rc, out, err) = module.run_command(cmd, data=data, check_rc=True, binary_data=True)",
            "    else:",
            "        if keyring:",
            "            cmd = \"apt-key --keyring %s add %s\" % (keyring, keyfile)",
            "        else:",
            "            cmd = \"apt-key add %s\" % (keyfile)",
            "        (rc, out, err) = module.run_command(cmd, check_rc=True)",
            "    return True",
            "",
            "",
            "def remove_key(module, key_id, keyring):",
            "    # FIXME: use module.run_command, fail at point of error and don't discard useful stdin/stdout",
            "    if keyring:",
            "        cmd = 'apt-key --keyring %s del %s' % (keyring, key_id)",
            "    else:",
            "        cmd = 'apt-key del %s' % key_id",
            "    (rc, out, err) = module.run_command(cmd, check_rc=True)",
            "    return True",
            "",
            "",
            "def main():",
            "    module = AnsibleModule(",
            "        argument_spec=dict(",
            "            id=dict(required=False, default=None),",
            "            url=dict(required=False),",
            "            data=dict(required=False),",
            "            file=dict(required=False, type='path'),",
            "            key=dict(required=False),",
            "            keyring=dict(required=False, type='path'),",
            "            validate_certs=dict(default='yes', type='bool'),",
            "            keyserver=dict(required=False),",
            "            state=dict(required=False, choices=['present', 'absent'], default='present')",
            "        ),",
            "        supports_check_mode=True",
            "    )",
            "",
            "    key_id          = module.params['id']",
            "    url             = module.params['url']",
            "    data            = module.params['data']",
            "    filename        = module.params['file']",
            "    keyring         = module.params['keyring']",
            "    state           = module.params['state']",
            "    keyserver       = module.params['keyserver']",
            "    changed         = False",
            "",
            "    if key_id:",
            "        try:",
            "            int(key_id, 16)",
            "            if key_id.startswith('0x'):",
            "                key_id = key_id[2:]",
            "            key_id = key_id.upper()",
            "            short_key_id = key_id[-8:]",
            "        except ValueError:",
            "            module.fail_json(msg=\"Invalid key_id\", id=key_id)",
            "",
            "    find_needed_binaries(module)",
            "",
            "    short_format = False",
            "    if key_id == short_key_id:",
            "        short_format = True",
            "",
            "    keys = all_keys(module, keyring, short_format)",
            "    return_values = {}",
            "",
            "    if state == 'present':",
            "        if key_id and key_id in keys:",
            "            module.exit_json(changed=False)",
            "        else:",
            "            if not filename and not data and not keyserver:",
            "                data = download_key(module, url)",
            "            if key_id and key_id in keys:",
            "                module.exit_json(changed=False)",
            "            else:",
            "                if module.check_mode:",
            "                    module.exit_json(changed=True)",
            "                if filename:",
            "                    add_key(module, filename, keyring)",
            "                elif keyserver:",
            "                    import_key(module, keyring, keyserver, key_id)",
            "                else:",
            "                    add_key(module, \"-\", keyring, data)",
            "                changed=False",
            "                keys2 = all_keys(module, keyring, short_format)",
            "                if len(keys) != len(keys2):",
            "                    changed=True",
            "                if key_id and key_id not in keys2:",
            "                    module.fail_json(msg=\"key does not seem to have been added\", id=key_id)",
            "                module.exit_json(changed=changed)",
            "    elif state == 'absent':",
            "        if not key_id:",
            "            module.fail_json(msg=\"key is required\")",
            "        if key_id in keys:",
            "            if module.check_mode:",
            "                module.exit_json(changed=True)",
            "",
            "            # we use the \"short\" id: key_id[-8:], short_format=True",
            "            # it's a workaround for https://bugs.launchpad.net/ubuntu/+source/apt/+bug/1481871",
            "            if remove_key(module, short_key_id, keyring):",
            "                keys = all_keys(module, keyring, short_format)",
            "                if key_id in keys:",
            "                    module.fail_json(msg=\"apt-key del did not return an error but the key was not removed (check that the id is correct and *not* a subkey)\", id=key_id)",
            "                changed = True",
            "            else:",
            "                # FIXME: module.fail_json or exit-json immediately at point of failure",
            "                module.fail_json(msg=\"error removing key_id\", **return_values)",
            "",
            "    module.exit_json(changed=changed, **return_values)",
            "",
            "",
            "if __name__ == '__main__':",
            "    main()"
        ],
        "afterPatchFile": [
            "#!/usr/bin/python",
            "# -*- coding: utf-8 -*-",
            "",
            "# (c) 2012, Michael DeHaan <michael.dehaan@gmail.com>",
            "# (c) 2012, Jayson Vantuyl <jayson@aggressive.ly>",
            "#",
            "# This file is part of Ansible",
            "#",
            "# Ansible is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# Ansible is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with Ansible.  If not, see <http://www.gnu.org/licenses/>.",
            "",
            "DOCUMENTATION = '''",
            "---",
            "module: apt_key",
            "author: \"Jayson Vantuyl & others (@jvantuyl)\"",
            "version_added: \"1.0\"",
            "short_description: Add or remove an apt key",
            "description:",
            "    - Add or remove an I(apt) key, optionally downloading it",
            "notes:",
            "    - doesn't download the key unless it really needs it",
            "    - as a sanity check, downloaded key id must match the one specified",
            "    - best practice is to specify the key id and the url",
            "options:",
            "    id:",
            "        required: false",
            "        default: none",
            "        description:",
            "            - identifier of key. Including this allows check mode to correctly report the changed state.",
            "            - \"If specifying a subkey's id be aware that apt-key does not understand how to remove keys via a subkey id.  Specify the primary key's id instead.\"",
            "    data:",
            "        required: false",
            "        default: none",
            "        description:",
            "            - keyfile contents to add to the keyring",
            "    file:",
            "        required: false",
            "        default: none",
            "        description:",
            "            - path to a keyfile to add to the keyring",
            "    keyring:",
            "        required: false",
            "        default: none",
            "        description:",
            "            - path to specific keyring file in /etc/apt/trusted.gpg.d",
            "        version_added: \"1.3\"",
            "    url:",
            "        required: false",
            "        default: none",
            "        description:",
            "            - url to retrieve key from.",
            "    keyserver:",
            "        version_added: \"1.6\"",
            "        required: false",
            "        default: none",
            "        description:",
            "            - keyserver to retrieve key from.",
            "    state:",
            "        required: false",
            "        choices: [ absent, present ]",
            "        default: present",
            "        description:",
            "            - used to specify if key is being added or revoked",
            "    validate_certs:",
            "        description:",
            "            - If C(no), SSL certificates for the target url will not be validated. This should only be used",
            "              on personally controlled sites using self-signed certificates.",
            "        required: false",
            "        default: 'yes'",
            "        choices: ['yes', 'no']",
            "",
            "'''",
            "",
            "EXAMPLES = '''",
            "# Add an apt key by id from a keyserver",
            "- apt_key: keyserver=keyserver.ubuntu.com id=36A1D7869245C8950F966E92D8576A8BA88D21E9",
            "",
            "# Add an Apt signing key, uses whichever key is at the URL",
            "- apt_key: url=https://ftp-master.debian.org/keys/archive-key-6.0.asc state=present",
            "",
            "# Add an Apt signing key, will not download if present",
            "- apt_key: id=473041FA url=https://ftp-master.debian.org/keys/archive-key-6.0.asc state=present",
            "",
            "# Remove an Apt signing key, uses whichever key is at the URL",
            "- apt_key: url=https://ftp-master.debian.org/keys/archive-key-6.0.asc state=absent",
            "",
            "# Remove a Apt specific signing key, leading 0x is valid",
            "- apt_key: id=0x473041FA state=absent",
            "",
            "# Add a key from a file on the Ansible server",
            "- apt_key: data=\"{{ lookup('file', 'apt.gpg') }}\" state=present",
            "",
            "# Add an Apt signing key to a specific keyring file",
            "- apt_key: id=473041FA url=https://ftp-master.debian.org/keys/archive-key-6.0.asc keyring=/etc/apt/trusted.gpg.d/debian.gpg state=present",
            "'''",
            "",
            "",
            "# FIXME: standardize into module_common",
            "from traceback import format_exc",
            "",
            "from ansible.module_utils.basic import AnsibleModule",
            "from ansible.module_utils._text import to_native",
            "from ansible.module_utils.urls import fetch_url",
            "",
            "",
            "apt_key_bin = None",
            "",
            "",
            "def find_needed_binaries(module):",
            "    global apt_key_bin",
            "",
            "    apt_key_bin = module.get_bin_path('apt-key', required=True)",
            "",
            "    ### FIXME: Is there a reason that gpg and grep are checked?  Is it just",
            "    # cruft or does the apt .deb package not require them (and if they're not",
            "    # installed, /usr/bin/apt-key fails?)",
            "    module.get_bin_path('gpg', required=True)",
            "    module.get_bin_path('grep', required=True)",
            "",
            "",
            "def parse_key_id(key_id):",
            "    \"\"\"validate the key_id and break it into segments",
            "",
            "    :arg key_id: The key_id as supplied by the user.  A valid key_id will be",
            "        8, 16, or more hexadecimal chars with an optional leading ``0x``.",
            "    :returns: The portion of key_id suitable for apt-key del, the portion",
            "        suitable for comparisons with --list-public-keys, and the portion that",
            "        can be used with --recv-key.  If key_id is long enough, these will be",
            "        the last 8 characters of key_id, the last 16 characters, and all of",
            "        key_id.  If key_id is not long enough, some of the values will be the",
            "        same.",
            "",
            "    * apt-key del <= 1.10 has a bug with key_id != 8 chars",
            "    * apt-key adv --list-public-keys prints 16 chars",
            "    * apt-key adv --recv-key can take more chars",
            "",
            "    \"\"\"",
            "    # Make sure the key_id is valid hexadecimal",
            "    int(key_id, 16)",
            "",
            "    key_id = key_id.upper()",
            "    if key_id.startswith('0X'):",
            "        key_id = key_id[2:]",
            "",
            "    key_id_len = len(key_id)",
            "    if (key_id_len != 8 and key_id_len != 16) and key_id_len <= 16:",
            "        raise ValueError('key_id must be 8, 16, or 16+ hexadecimal characters in length')",
            "",
            "    short_key_id = key_id[-8:]",
            "",
            "    fingerprint = key_id",
            "    if key_id_len > 16:",
            "        fingerprint = key_id[-16:]",
            "",
            "    return short_key_id, fingerprint, key_id",
            "",
            "",
            "def all_keys(module, keyring, short_format):",
            "    if keyring:",
            "        cmd = \"%s --keyring %s adv --list-public-keys --keyid-format=long\" % (apt_key_bin, keyring)",
            "    else:",
            "        cmd = \"%s adv --list-public-keys --keyid-format=long\" % apt_key_bin",
            "    (rc, out, err) = module.run_command(cmd)",
            "    results = []",
            "    lines = to_native(out).split('\\n')",
            "    for line in lines:",
            "        if line.startswith(\"pub\") or line.startswith(\"sub\"):",
            "            tokens = line.split()",
            "            code = tokens[1]",
            "            (len_type, real_code) = code.split(\"/\")",
            "            results.append(real_code)",
            "    if short_format:",
            "        results = shorten_key_ids(results)",
            "    return results",
            "",
            "",
            "def shorten_key_ids(key_id_list):",
            "    \"\"\"",
            "    Takes a list of key ids, and converts them to the 'short' format,",
            "    by reducing them to their last 8 characters.",
            "    \"\"\"",
            "    short = []",
            "    for key in key_id_list:",
            "        short.append(key[-8:])",
            "    return short",
            "",
            "",
            "def download_key(module, url):",
            "    # FIXME: move get_url code to common, allow for in-memory D/L, support proxies",
            "    # and reuse here",
            "    if url is None:",
            "        module.fail_json(msg=\"needed a URL but was not specified\")",
            "",
            "    try:",
            "        rsp, info = fetch_url(module, url)",
            "        if info['status'] != 200:",
            "            module.fail_json(msg=\"Failed to download key at %s: %s\" % (url, info['msg']))",
            "",
            "        return rsp.read()",
            "    except Exception:",
            "        module.fail_json(msg=\"error getting key id from url: %s\" % url, traceback=format_exc())",
            "",
            "",
            "def import_key(module, keyring, keyserver, key_id):",
            "    if keyring:",
            "        cmd = \"%s --keyring %s adv --keyserver %s --recv %s\" % (apt_key_bin, keyring, keyserver, key_id)",
            "    else:",
            "        cmd = \"%s adv --keyserver %s --recv %s\" % (apt_key_bin, keyserver, key_id)",
            "    for retry in range(5):",
            "        lang_env = dict(LANG='C', LC_ALL='C', LC_MESSAGES='C')",
            "        (rc, out, err) = module.run_command(cmd, environ_update=lang_env)",
            "        if rc == 0:",
            "            break",
            "    else:",
            "        # Out of retries",
            "        if rc == 2 and 'not found on keyserver' in out:",
            "            msg = 'Key %s not found on keyserver %s' % (key_id, keyserver)",
            "            module.fail_json(cmd=cmd, msg=msg)",
            "        else:",
            "            msg = \"Error fetching key %s from keyserver: %s\" % (key_id, keyserver)",
            "            module.fail_json(cmd=cmd, msg=msg, rc=rc, stdout=out, stderr=err)",
            "    return True",
            "",
            "",
            "def add_key(module, keyfile, keyring, data=None):",
            "    if data is not None:",
            "        if keyring:",
            "            cmd = \"%s --keyring %s add -\" % (apt_key_bin, keyring)",
            "        else:",
            "            cmd = \"%s add -\" % apt_key_bin",
            "        (rc, out, err) = module.run_command(cmd, data=data, check_rc=True, binary_data=True)",
            "    else:",
            "        if keyring:",
            "            cmd = \"%s --keyring %s add %s\" % (apt_key_bin, keyring, keyfile)",
            "        else:",
            "            cmd = \"%s add %s\" % (apt_key_bin, keyfile)",
            "        (rc, out, err) = module.run_command(cmd, check_rc=True)",
            "    return True",
            "",
            "",
            "def remove_key(module, key_id, keyring):",
            "    # FIXME: use module.run_command, fail at point of error and don't discard useful stdin/stdout",
            "    if keyring:",
            "        cmd = '%s --keyring %s del %s' % (apt_key_bin, keyring, key_id)",
            "    else:",
            "        cmd = '%s del %s' % (apt_key_bin, key_id)",
            "    (rc, out, err) = module.run_command(cmd, check_rc=True)",
            "    return True",
            "",
            "",
            "def main():",
            "    module = AnsibleModule(",
            "        argument_spec=dict(",
            "            id=dict(required=False, default=None),",
            "            url=dict(required=False),",
            "            data=dict(required=False),",
            "            file=dict(required=False, type='path'),",
            "            key=dict(required=False),",
            "            keyring=dict(required=False, type='path'),",
            "            validate_certs=dict(default='yes', type='bool'),",
            "            keyserver=dict(required=False),",
            "            state=dict(required=False, choices=['present', 'absent'], default='present')",
            "        ),",
            "        supports_check_mode=True,",
            "        mutually_exclusive=(('filename', 'keyserver', 'data', 'url'),),",
            "    )",
            "",
            "    key_id          = module.params['id']",
            "    url             = module.params['url']",
            "    data            = module.params['data']",
            "    filename        = module.params['file']",
            "    keyring         = module.params['keyring']",
            "    state           = module.params['state']",
            "    keyserver       = module.params['keyserver']",
            "    changed         = False",
            "",
            "    fingerprint = short_key_id = key_id",
            "    short_format = False",
            "    if key_id:",
            "        try:",
            "            key_id, fingerprint, short_key_id = parse_key_id(key_id)",
            "        except ValueError:",
            "            module.fail_json(msg='Invalid key_id', id=key_id)",
            "",
            "        if len(fingerprint) == 8:",
            "            short_format = True",
            "",
            "    find_needed_binaries(module)",
            "",
            "    keys = all_keys(module, keyring, short_format)",
            "    return_values = {}",
            "",
            "    if state == 'present':",
            "        if fingerprint and fingerprint in keys:",
            "            module.exit_json(changed=False)",
            "        elif fingerprint and fingerprint not in keys and module.check_mode:",
            "            ### TODO: Someday we could go further -- write keys out to",
            "            # a temporary file and then extract the key id from there via gpg",
            "            # to decide if the key is installed or not.",
            "            module.exit_json(changed=True)",
            "        else:",
            "            if not filename and not data and not keyserver:",
            "                data = download_key(module, url)",
            "",
            "            if filename:",
            "                add_key(module, filename, keyring)",
            "            elif keyserver:",
            "                import_key(module, keyring, keyserver, key_id)",
            "            else:",
            "                add_key(module, \"-\", keyring, data)",
            "",
            "            changed = False",
            "            keys2 = all_keys(module, keyring, short_format)",
            "            if len(keys) != len(keys2):",
            "                changed=True",
            "",
            "            if fingerprint and fingerprint not in keys2:",
            "                module.fail_json(msg=\"key does not seem to have been added\", id=key_id)",
            "            module.exit_json(changed=changed)",
            "",
            "    elif state == 'absent':",
            "        if not key_id:",
            "            module.fail_json(msg=\"key is required\")",
            "        if fingerprint in keys:",
            "            if module.check_mode:",
            "                module.exit_json(changed=True)",
            "",
            "            # we use the \"short\" id: key_id[-8:], short_format=True",
            "            # it's a workaround for https://bugs.launchpad.net/ubuntu/+source/apt/+bug/1481871",
            "            if remove_key(module, short_key_id, keyring):",
            "                keys = all_keys(module, keyring, short_format)",
            "                if fingerprint in keys:",
            "                    module.fail_json(msg=\"apt-key del did not return an error but the key was not removed (check that the id is correct and *not* a subkey)\", id=key_id)",
            "                changed = True",
            "            else:",
            "                # FIXME: module.fail_json or exit-json immediately at point of failure",
            "                module.fail_json(msg=\"error removing key_id\", **return_values)",
            "",
            "    module.exit_json(changed=changed, **return_values)",
            "",
            "",
            "if __name__ == '__main__':",
            "    main()"
        ],
        "action": [
            "0",
            "0",
            "0",
            "1",
            "1",
            "0",
            "0",
            "0",
            "0",
            "1",
            "1",
            "0",
            "0",
            "1",
            "1",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "2",
            "2",
            "0",
            "2",
            "2",
            "2",
            "0",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "116": [
                "gpg_bin"
            ],
            "117": [
                "grep_bin"
            ],
            "122": [
                "find_needed_binaries"
            ],
            "123": [
                "find_needed_binaries"
            ],
            "126": [
                "find_needed_binaries"
            ],
            "127": [
                "find_needed_binaries"
            ],
            "133": [
                "all_keys"
            ],
            "135": [
                "all_keys"
            ],
            "179": [
                "import_key"
            ],
            "181": [
                "import_key"
            ],
            "201": [
                "add_key"
            ],
            "203": [
                "add_key"
            ],
            "207": [
                "add_key"
            ],
            "209": [
                "add_key"
            ],
            "217": [
                "remove_key"
            ],
            "219": [
                "remove_key"
            ],
            "237": [
                "main"
            ],
            "251": [
                "main"
            ],
            "252": [
                "main"
            ],
            "253": [
                "main"
            ],
            "254": [
                "main"
            ],
            "255": [
                "main"
            ],
            "257": [
                "main"
            ],
            "259": [
                "main"
            ],
            "261": [
                "main"
            ],
            "262": [
                "main"
            ],
            "263": [
                "main"
            ],
            "269": [
                "main"
            ],
            "274": [
                "main"
            ],
            "275": [
                "main"
            ],
            "277": [
                "main"
            ],
            "278": [
                "main"
            ],
            "279": [
                "main"
            ],
            "280": [
                "main"
            ],
            "281": [
                "main"
            ],
            "282": [
                "main"
            ],
            "283": [
                "main"
            ],
            "284": [
                "main"
            ],
            "285": [
                "main"
            ],
            "286": [
                "main"
            ],
            "287": [
                "main"
            ],
            "288": [
                "main"
            ],
            "289": [
                "main"
            ],
            "290": [
                "main"
            ],
            "291": [
                "main"
            ],
            "295": [
                "main"
            ],
            "303": [
                "main"
            ]
        },
        "addLocation": []
    }
}