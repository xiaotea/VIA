{
    "lib/engines/cuneiform.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 10,
                "afterPatchRowNumber": 10,
                "PatchRowcode": " # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU"
            },
            "1": {
                "beforePatchRowNumber": 11,
                "afterPatchRowNumber": 11,
                "PatchRowcode": " # General Public License for more details."
            },
            "2": {
                "beforePatchRowNumber": 12,
                "afterPatchRowNumber": 12,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 13,
                "PatchRowcode": "+from __future__ import with_statement"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 14,
                "PatchRowcode": "+"
            },
            "5": {
                "beforePatchRowNumber": 13,
                "afterPatchRowNumber": 15,
                "PatchRowcode": " import contextlib"
            },
            "6": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 16,
                "PatchRowcode": "+import os"
            },
            "7": {
                "beforePatchRowNumber": 14,
                "afterPatchRowNumber": 17,
                "PatchRowcode": " import re"
            },
            "8": {
                "beforePatchRowNumber": 15,
                "afterPatchRowNumber": 18,
                "PatchRowcode": " from cStringIO import StringIO"
            },
            "9": {
                "beforePatchRowNumber": 16,
                "afterPatchRowNumber": 19,
                "PatchRowcode": " "
            },
            "10": {
                "beforePatchRowNumber": 93,
                "afterPatchRowNumber": 96,
                "PatchRowcode": " "
            },
            "11": {
                "beforePatchRowNumber": 94,
                "afterPatchRowNumber": 97,
                "PatchRowcode": "     @staticmethod"
            },
            "12": {
                "beforePatchRowNumber": 95,
                "afterPatchRowNumber": 98,
                "PatchRowcode": "     def recognize(pbm_file, language, *args, **kwargs):"
            },
            "13": {
                "beforePatchRowNumber": 96,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        hocr_file = temporary.file(suffix='.html')"
            },
            "14": {
                "beforePatchRowNumber": 97,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        worker = ipc.Subprocess("
            },
            "15": {
                "beforePatchRowNumber": 98,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            ['cuneiform', '-l', iso_to_cuneiform(language), '-f', 'hocr', '-o', hocr_file.name, pbm_file.name],"
            },
            "16": {
                "beforePatchRowNumber": 99,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            stdin=ipc.PIPE,"
            },
            "17": {
                "beforePatchRowNumber": 100,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            stdout=ipc.PIPE,"
            },
            "18": {
                "beforePatchRowNumber": 101,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        )"
            },
            "19": {
                "beforePatchRowNumber": 102,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        worker.stdin.close()"
            },
            "20": {
                "beforePatchRowNumber": 103,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        worker.wait()"
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 99,
                "PatchRowcode": "+        with temporary.directory() as hocr_directory:"
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 100,
                "PatchRowcode": "+            # A separate non-world-writable directory is needed, as Cuneiform"
            },
            "23": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 101,
                "PatchRowcode": "+            # can create additional files, e.g. images."
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 102,
                "PatchRowcode": "+            hocr_file_name = os.path.join(hocr_directory, 'ocr.html')"
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 103,
                "PatchRowcode": "+            worker = ipc.Subprocess("
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 104,
                "PatchRowcode": "+                ['cuneiform', '-l', iso_to_cuneiform(language), '-f', 'hocr', '-o', hocr_file_name, pbm_file.name],"
            },
            "27": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 105,
                "PatchRowcode": "+                stdin=ipc.PIPE,"
            },
            "28": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 106,
                "PatchRowcode": "+                stdout=ipc.PIPE,"
            },
            "29": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 107,
                "PatchRowcode": "+            )"
            },
            "30": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 108,
                "PatchRowcode": "+            worker.stdin.close()"
            },
            "31": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 109,
                "PatchRowcode": "+            worker.wait()"
            },
            "32": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 110,
                "PatchRowcode": "+            with open(hocr_file_name, 'r') as hocr_file:"
            },
            "33": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 111,
                "PatchRowcode": "+                contents = hocr_file.read()"
            },
            "34": {
                "beforePatchRowNumber": 104,
                "afterPatchRowNumber": 112,
                "PatchRowcode": "         # Sometimes Cuneiform returns files with broken encoding or with control"
            },
            "35": {
                "beforePatchRowNumber": 105,
                "afterPatchRowNumber": 113,
                "PatchRowcode": "         # characters: https://bugs.launchpad.net/cuneiform-linux/+bug/585418"
            },
            "36": {
                "beforePatchRowNumber": 106,
                "afterPatchRowNumber": 114,
                "PatchRowcode": "         # Let's fix it."
            },
            "37": {
                "beforePatchRowNumber": 107,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        contents = hocr_file.read()"
            },
            "38": {
                "beforePatchRowNumber": 108,
                "afterPatchRowNumber": 115,
                "PatchRowcode": "         contents = utils.sanitize_utf8(contents)"
            },
            "39": {
                "beforePatchRowNumber": 109,
                "afterPatchRowNumber": 116,
                "PatchRowcode": "         return contextlib.closing(StringIO(contents))"
            },
            "40": {
                "beforePatchRowNumber": 110,
                "afterPatchRowNumber": 117,
                "PatchRowcode": " "
            }
        },
        "frontPatchFile": [
            "# encoding=UTF-8",
            "# Copyright \u00a9 2010 Jakub Wilk <jwilk@jwilk.net>",
            "#",
            "# This package is free software; you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation; version 2 dated June, 1991.",
            "#",
            "# This package is distributed in the hope that it will be useful, but",
            "# WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU",
            "# General Public License for more details.",
            "",
            "import contextlib",
            "import re",
            "from cStringIO import StringIO",
            "",
            "from .. import errors",
            "from .. import image_io",
            "from .. import ipc",
            "from .. import temporary",
            "from .. import utils",
            "",
            "_default_language = 'eng'",
            "_language_pattern = re.compile('^[a-z]{3}(-[a-z]+)?$')",
            "_language_info_pattern = re.compile(r\"^Supported languages: (.*)[.]$\")",
            "",
            "_cuneiform_to_iso = dict(",
            "    ger='deu',",
            "    ruseng='rus-eng',  # mixed Russian-English",
            ")",
            "",
            "_iso_to_cuneiform = dict((y, x) for x, y in _cuneiform_to_iso.iteritems())",
            "",
            "def cuneiform_to_iso(language):",
            "    return _cuneiform_to_iso.get(language, language)",
            "",
            "def iso_to_cuneiform(language):",
            "    return _iso_to_cuneiform.get(language, language)",
            "",
            "def get_languages():",
            "    try:",
            "        cuneiform = ipc.Subprocess(['cuneiform', '-l'],",
            "            stdout=ipc.PIPE,",
            "            stderr=ipc.PIPE,",
            "        )",
            "    except OSError:",
            "        raise errors.UnknownLanguageList",
            "    try:",
            "        for line in cuneiform.stdout:",
            "            m = _language_info_pattern.match(line)",
            "            if m is None:",
            "                continue",
            "            return map(cuneiform_to_iso, m.group(1).split())",
            "    finally:",
            "        try:",
            "            cuneiform.wait()",
            "        except ipc.CalledProcessError:",
            "            pass",
            "        else:",
            "            raise errors.UnknownLanguageList",
            "    raise errors.UnknownLanguageList",
            "",
            "class Engine(object):",
            "",
            "    name = 'cuneiform'",
            "    image_format = image_io.BMP",
            "    output_format = 'html'",
            "",
            "    def __init__(self):",
            "        try:",
            "            get_languages()",
            "        except errors.UnknownLanguageList:",
            "            raise errors.EngineNotFound(self.name)",
            "        # Import hocr late, so that importing lxml is not triggered if",
            "        # Cuneiform is not used.",
            "        from .. import hocr",
            "        self._hocr = hocr",
            "",
            "    @staticmethod",
            "    def get_default_language():",
            "        return _default_language",
            "",
            "    @staticmethod",
            "    def has_language(language):",
            "        language = cuneiform_to_iso(language)",
            "        if not _language_pattern.match(language):",
            "            raise errors.InvalidLanguageId(language)",
            "        return language in get_languages()",
            "",
            "    @staticmethod",
            "    def list_languages():",
            "        return iter(get_languages())",
            "",
            "    @staticmethod",
            "    def recognize(pbm_file, language, *args, **kwargs):",
            "        hocr_file = temporary.file(suffix='.html')",
            "        worker = ipc.Subprocess(",
            "            ['cuneiform', '-l', iso_to_cuneiform(language), '-f', 'hocr', '-o', hocr_file.name, pbm_file.name],",
            "            stdin=ipc.PIPE,",
            "            stdout=ipc.PIPE,",
            "        )",
            "        worker.stdin.close()",
            "        worker.wait()",
            "        # Sometimes Cuneiform returns files with broken encoding or with control",
            "        # characters: https://bugs.launchpad.net/cuneiform-linux/+bug/585418",
            "        # Let's fix it.",
            "        contents = hocr_file.read()",
            "        contents = utils.sanitize_utf8(contents)",
            "        return contextlib.closing(StringIO(contents))",
            "",
            "    def extract_text(self, *args, **kwargs):",
            "        return self._hocr.extract_text(*args, **kwargs)",
            "",
            "# vim:ts=4 sw=4 et"
        ],
        "afterPatchFile": [
            "# encoding=UTF-8",
            "# Copyright \u00a9 2010 Jakub Wilk <jwilk@jwilk.net>",
            "#",
            "# This package is free software; you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation; version 2 dated June, 1991.",
            "#",
            "# This package is distributed in the hope that it will be useful, but",
            "# WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU",
            "# General Public License for more details.",
            "",
            "from __future__ import with_statement",
            "",
            "import contextlib",
            "import os",
            "import re",
            "from cStringIO import StringIO",
            "",
            "from .. import errors",
            "from .. import image_io",
            "from .. import ipc",
            "from .. import temporary",
            "from .. import utils",
            "",
            "_default_language = 'eng'",
            "_language_pattern = re.compile('^[a-z]{3}(-[a-z]+)?$')",
            "_language_info_pattern = re.compile(r\"^Supported languages: (.*)[.]$\")",
            "",
            "_cuneiform_to_iso = dict(",
            "    ger='deu',",
            "    ruseng='rus-eng',  # mixed Russian-English",
            ")",
            "",
            "_iso_to_cuneiform = dict((y, x) for x, y in _cuneiform_to_iso.iteritems())",
            "",
            "def cuneiform_to_iso(language):",
            "    return _cuneiform_to_iso.get(language, language)",
            "",
            "def iso_to_cuneiform(language):",
            "    return _iso_to_cuneiform.get(language, language)",
            "",
            "def get_languages():",
            "    try:",
            "        cuneiform = ipc.Subprocess(['cuneiform', '-l'],",
            "            stdout=ipc.PIPE,",
            "            stderr=ipc.PIPE,",
            "        )",
            "    except OSError:",
            "        raise errors.UnknownLanguageList",
            "    try:",
            "        for line in cuneiform.stdout:",
            "            m = _language_info_pattern.match(line)",
            "            if m is None:",
            "                continue",
            "            return map(cuneiform_to_iso, m.group(1).split())",
            "    finally:",
            "        try:",
            "            cuneiform.wait()",
            "        except ipc.CalledProcessError:",
            "            pass",
            "        else:",
            "            raise errors.UnknownLanguageList",
            "    raise errors.UnknownLanguageList",
            "",
            "class Engine(object):",
            "",
            "    name = 'cuneiform'",
            "    image_format = image_io.BMP",
            "    output_format = 'html'",
            "",
            "    def __init__(self):",
            "        try:",
            "            get_languages()",
            "        except errors.UnknownLanguageList:",
            "            raise errors.EngineNotFound(self.name)",
            "        # Import hocr late, so that importing lxml is not triggered if",
            "        # Cuneiform is not used.",
            "        from .. import hocr",
            "        self._hocr = hocr",
            "",
            "    @staticmethod",
            "    def get_default_language():",
            "        return _default_language",
            "",
            "    @staticmethod",
            "    def has_language(language):",
            "        language = cuneiform_to_iso(language)",
            "        if not _language_pattern.match(language):",
            "            raise errors.InvalidLanguageId(language)",
            "        return language in get_languages()",
            "",
            "    @staticmethod",
            "    def list_languages():",
            "        return iter(get_languages())",
            "",
            "    @staticmethod",
            "    def recognize(pbm_file, language, *args, **kwargs):",
            "        with temporary.directory() as hocr_directory:",
            "            # A separate non-world-writable directory is needed, as Cuneiform",
            "            # can create additional files, e.g. images.",
            "            hocr_file_name = os.path.join(hocr_directory, 'ocr.html')",
            "            worker = ipc.Subprocess(",
            "                ['cuneiform', '-l', iso_to_cuneiform(language), '-f', 'hocr', '-o', hocr_file_name, pbm_file.name],",
            "                stdin=ipc.PIPE,",
            "                stdout=ipc.PIPE,",
            "            )",
            "            worker.stdin.close()",
            "            worker.wait()",
            "            with open(hocr_file_name, 'r') as hocr_file:",
            "                contents = hocr_file.read()",
            "        # Sometimes Cuneiform returns files with broken encoding or with control",
            "        # characters: https://bugs.launchpad.net/cuneiform-linux/+bug/585418",
            "        # Let's fix it.",
            "        contents = utils.sanitize_utf8(contents)",
            "        return contextlib.closing(StringIO(contents))",
            "",
            "    def extract_text(self, *args, **kwargs):",
            "        return self._hocr.extract_text(*args, **kwargs)",
            "",
            "# vim:ts=4 sw=4 et"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "96": [
                "Engine",
                "recognize"
            ],
            "97": [
                "Engine",
                "recognize"
            ],
            "98": [
                "Engine",
                "recognize"
            ],
            "99": [
                "Engine",
                "recognize"
            ],
            "100": [
                "Engine",
                "recognize"
            ],
            "101": [
                "Engine",
                "recognize"
            ],
            "102": [
                "Engine",
                "recognize"
            ],
            "103": [
                "Engine",
                "recognize"
            ],
            "107": [
                "Engine",
                "recognize"
            ]
        },
        "addLocation": []
    }
}