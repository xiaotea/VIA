{
    "jupyter_server/log.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 50,
                "afterPatchRowNumber": 50,
                "PatchRowcode": "         ns[\"referer\"] = request.headers.get(\"Referer\", \"None\")"
            },
            "1": {
                "beforePatchRowNumber": 51,
                "afterPatchRowNumber": 51,
                "PatchRowcode": "         msg = msg + \" referer={referer}\""
            },
            "2": {
                "beforePatchRowNumber": 52,
                "afterPatchRowNumber": 52,
                "PatchRowcode": "     if status >= 500 and status != 502:"
            },
            "3": {
                "beforePatchRowNumber": 53,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        # log all headers if it caused an error"
            },
            "4": {
                "beforePatchRowNumber": 54,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        log_method(json.dumps(dict(request.headers), indent=2))"
            },
            "5": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 53,
                "PatchRowcode": "+        # Log a subset of the headers if it caused an error."
            },
            "6": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 54,
                "PatchRowcode": "+        headers = {}"
            },
            "7": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 55,
                "PatchRowcode": "+        for header in ['Host', 'Accept', 'Referer', 'User-Agent']:"
            },
            "8": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 56,
                "PatchRowcode": "+            if header in request.headers:"
            },
            "9": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 57,
                "PatchRowcode": "+                headers[header] = request.headers[header]"
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 58,
                "PatchRowcode": "+        log_method(json.dumps(headers, indent=2))"
            },
            "11": {
                "beforePatchRowNumber": 55,
                "afterPatchRowNumber": 59,
                "PatchRowcode": "     log_method(msg.format(**ns))"
            },
            "12": {
                "beforePatchRowNumber": 56,
                "afterPatchRowNumber": 60,
                "PatchRowcode": "     prometheus_log_method(handler)"
            }
        },
        "frontPatchFile": [
            "# -----------------------------------------------------------------------------",
            "#  Copyright (c) Jupyter Development Team",
            "#",
            "#  Distributed under the terms of the BSD License.  The full license is in",
            "#  the file COPYING, distributed as part of this software.",
            "# -----------------------------------------------------------------------------",
            "import json",
            "",
            "from tornado.log import access_log",
            "",
            "from .prometheus.log_functions import prometheus_log_method",
            "",
            "",
            "def log_request(handler):",
            "    \"\"\"log a bit more information about each request than tornado's default",
            "",
            "    - move static file get success to debug-level (reduces noise)",
            "    - get proxied IP instead of proxy IP",
            "    - log referer for redirect and failed requests",
            "    - log user-agent for failed requests",
            "    \"\"\"",
            "    status = handler.get_status()",
            "    request = handler.request",
            "    try:",
            "        logger = handler.log",
            "    except AttributeError:",
            "        logger = access_log",
            "",
            "    if status < 300 or status == 304:",
            "        # Successes (or 304 FOUND) are debug-level",
            "        log_method = logger.debug",
            "    elif status < 400:",
            "        log_method = logger.info",
            "    elif status < 500:",
            "        log_method = logger.warning",
            "    else:",
            "        log_method = logger.error",
            "",
            "    request_time = 1000.0 * handler.request.request_time()",
            "    ns = dict(",
            "        status=status,",
            "        method=request.method,",
            "        ip=request.remote_ip,",
            "        uri=request.uri,",
            "        request_time=request_time,",
            "    )",
            "    msg = \"{status} {method} {uri} ({ip}) {request_time:.2f}ms\"",
            "    if status >= 400:",
            "        # log bad referers",
            "        ns[\"referer\"] = request.headers.get(\"Referer\", \"None\")",
            "        msg = msg + \" referer={referer}\"",
            "    if status >= 500 and status != 502:",
            "        # log all headers if it caused an error",
            "        log_method(json.dumps(dict(request.headers), indent=2))",
            "    log_method(msg.format(**ns))",
            "    prometheus_log_method(handler)"
        ],
        "afterPatchFile": [
            "# -----------------------------------------------------------------------------",
            "#  Copyright (c) Jupyter Development Team",
            "#",
            "#  Distributed under the terms of the BSD License.  The full license is in",
            "#  the file COPYING, distributed as part of this software.",
            "# -----------------------------------------------------------------------------",
            "import json",
            "",
            "from tornado.log import access_log",
            "",
            "from .prometheus.log_functions import prometheus_log_method",
            "",
            "",
            "def log_request(handler):",
            "    \"\"\"log a bit more information about each request than tornado's default",
            "",
            "    - move static file get success to debug-level (reduces noise)",
            "    - get proxied IP instead of proxy IP",
            "    - log referer for redirect and failed requests",
            "    - log user-agent for failed requests",
            "    \"\"\"",
            "    status = handler.get_status()",
            "    request = handler.request",
            "    try:",
            "        logger = handler.log",
            "    except AttributeError:",
            "        logger = access_log",
            "",
            "    if status < 300 or status == 304:",
            "        # Successes (or 304 FOUND) are debug-level",
            "        log_method = logger.debug",
            "    elif status < 400:",
            "        log_method = logger.info",
            "    elif status < 500:",
            "        log_method = logger.warning",
            "    else:",
            "        log_method = logger.error",
            "",
            "    request_time = 1000.0 * handler.request.request_time()",
            "    ns = dict(",
            "        status=status,",
            "        method=request.method,",
            "        ip=request.remote_ip,",
            "        uri=request.uri,",
            "        request_time=request_time,",
            "    )",
            "    msg = \"{status} {method} {uri} ({ip}) {request_time:.2f}ms\"",
            "    if status >= 400:",
            "        # log bad referers",
            "        ns[\"referer\"] = request.headers.get(\"Referer\", \"None\")",
            "        msg = msg + \" referer={referer}\"",
            "    if status >= 500 and status != 502:",
            "        # Log a subset of the headers if it caused an error.",
            "        headers = {}",
            "        for header in ['Host', 'Accept', 'Referer', 'User-Agent']:",
            "            if header in request.headers:",
            "                headers[header] = request.headers[header]",
            "        log_method(json.dumps(headers, indent=2))",
            "    log_method(msg.format(**ns))",
            "    prometheus_log_method(handler)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "53": [
                "log_request"
            ],
            "54": [
                "log_request"
            ]
        },
        "addLocation": []
    }
}