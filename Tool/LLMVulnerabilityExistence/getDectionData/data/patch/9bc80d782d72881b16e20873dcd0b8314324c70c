{
    "src/octoprint/server/api/access.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 11,
                "afterPatchRowNumber": 11,
                "PatchRowcode": " from octoprint.server import SUCCESS, groupManager, userManager"
            },
            "1": {
                "beforePatchRowNumber": 12,
                "afterPatchRowNumber": 12,
                "PatchRowcode": " from octoprint.server.api import api, valid_boolean_trues"
            },
            "2": {
                "beforePatchRowNumber": 13,
                "afterPatchRowNumber": 13,
                "PatchRowcode": " from octoprint.server.util.flask import ("
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 14,
                "PatchRowcode": "+    credentials_checked_recently,"
            },
            "4": {
                "beforePatchRowNumber": 14,
                "afterPatchRowNumber": 15,
                "PatchRowcode": "     ensure_credentials_checked_recently,"
            },
            "5": {
                "beforePatchRowNumber": 15,
                "afterPatchRowNumber": 16,
                "PatchRowcode": "     no_firstrun_access,"
            },
            "6": {
                "beforePatchRowNumber": 16,
                "afterPatchRowNumber": 17,
                "PatchRowcode": "     require_credentials_checked_recently,"
            },
            "7": {
                "beforePatchRowNumber": 132,
                "afterPatchRowNumber": 133,
                "PatchRowcode": " @no_firstrun_access"
            },
            "8": {
                "beforePatchRowNumber": 133,
                "afterPatchRowNumber": 134,
                "PatchRowcode": " @Permissions.ADMIN.require(403)"
            },
            "9": {
                "beforePatchRowNumber": 134,
                "afterPatchRowNumber": 135,
                "PatchRowcode": " def get_users():"
            },
            "10": {
                "beforePatchRowNumber": 135,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    return jsonify(users=list(map(lambda u: u.as_dict(), userManager.get_all_users())))"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 136,
                "PatchRowcode": "+    users = [u.as_dict() for u in userManager.get_all_users()]"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 137,
                "PatchRowcode": "+    if not credentials_checked_recently():"
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 138,
                "PatchRowcode": "+        for u in users:"
            },
            "14": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 139,
                "PatchRowcode": "+            u[\"apikey\"] = None"
            },
            "15": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 140,
                "PatchRowcode": "+    return jsonify(users=users)"
            },
            "16": {
                "beforePatchRowNumber": 136,
                "afterPatchRowNumber": 141,
                "PatchRowcode": " "
            },
            "17": {
                "beforePatchRowNumber": 137,
                "afterPatchRowNumber": 142,
                "PatchRowcode": " "
            },
            "18": {
                "beforePatchRowNumber": 138,
                "afterPatchRowNumber": 143,
                "PatchRowcode": " @api.route(\"/access/users\", methods=[\"POST\"])"
            },
            "19": {
                "beforePatchRowNumber": 178,
                "afterPatchRowNumber": 183,
                "PatchRowcode": "     ):"
            },
            "20": {
                "beforePatchRowNumber": 179,
                "afterPatchRowNumber": 184,
                "PatchRowcode": "         user = userManager.find_user(username)"
            },
            "21": {
                "beforePatchRowNumber": 180,
                "afterPatchRowNumber": 185,
                "PatchRowcode": "         if user is not None:"
            },
            "22": {
                "beforePatchRowNumber": 181,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            return jsonify(user)"
            },
            "23": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 186,
                "PatchRowcode": "+            user_dict = user.as_dict()"
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 187,
                "PatchRowcode": "+            if not credentials_checked_recently():"
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 188,
                "PatchRowcode": "+                user_dict[\"apikey\"] = None"
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 189,
                "PatchRowcode": "+            return jsonify(user_dict)"
            },
            "27": {
                "beforePatchRowNumber": 182,
                "afterPatchRowNumber": 190,
                "PatchRowcode": "         else:"
            },
            "28": {
                "beforePatchRowNumber": 183,
                "afterPatchRowNumber": 191,
                "PatchRowcode": "             abort(404)"
            },
            "29": {
                "beforePatchRowNumber": 184,
                "afterPatchRowNumber": 192,
                "PatchRowcode": "     else:"
            },
            "30": {
                "beforePatchRowNumber": 323,
                "afterPatchRowNumber": 331,
                "PatchRowcode": " "
            },
            "31": {
                "beforePatchRowNumber": 324,
                "afterPatchRowNumber": 332,
                "PatchRowcode": " @api.route(\"/access/users/<username>/apikey\", methods=[\"DELETE\"])"
            },
            "32": {
                "beforePatchRowNumber": 325,
                "afterPatchRowNumber": 333,
                "PatchRowcode": " @no_firstrun_access"
            },
            "33": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 334,
                "PatchRowcode": "+@require_credentials_checked_recently"
            },
            "34": {
                "beforePatchRowNumber": 326,
                "afterPatchRowNumber": 335,
                "PatchRowcode": " def delete_apikey_for_user(username):"
            },
            "35": {
                "beforePatchRowNumber": 327,
                "afterPatchRowNumber": 336,
                "PatchRowcode": "     if ("
            },
            "36": {
                "beforePatchRowNumber": 328,
                "afterPatchRowNumber": 337,
                "PatchRowcode": "         current_user is not None"
            },
            "37": {
                "beforePatchRowNumber": 347,
                "afterPatchRowNumber": 356,
                "PatchRowcode": " "
            },
            "38": {
                "beforePatchRowNumber": 348,
                "afterPatchRowNumber": 357,
                "PatchRowcode": " @api.route(\"/access/users/<username>/apikey\", methods=[\"POST\"])"
            },
            "39": {
                "beforePatchRowNumber": 349,
                "afterPatchRowNumber": 358,
                "PatchRowcode": " @no_firstrun_access"
            },
            "40": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 359,
                "PatchRowcode": "+@require_credentials_checked_recently"
            },
            "41": {
                "beforePatchRowNumber": 350,
                "afterPatchRowNumber": 360,
                "PatchRowcode": " def generate_apikey_for_user(username):"
            },
            "42": {
                "beforePatchRowNumber": 351,
                "afterPatchRowNumber": 361,
                "PatchRowcode": "     if not userManager.enabled:"
            },
            "43": {
                "beforePatchRowNumber": 352,
                "afterPatchRowNumber": 362,
                "PatchRowcode": "         return jsonify(SUCCESS)"
            }
        },
        "frontPatchFile": [
            "__author__ = \"Marc Hannappel <salandora@gmail.com>\"",
            "__license__ = \"GNU Affero General Public License http://www.gnu.org/licenses/agpl.html\"",
            "__copyright__ = \"Copyright (C) 2017 The OctoPrint Project - Released under terms of the AGPLv3 License\"",
            "",
            "from flask import abort, jsonify, request",
            "from flask_login import current_user",
            "",
            "import octoprint.access.groups as groups",
            "import octoprint.access.users as users",
            "from octoprint.access.permissions import Permissions",
            "from octoprint.server import SUCCESS, groupManager, userManager",
            "from octoprint.server.api import api, valid_boolean_trues",
            "from octoprint.server.util.flask import (",
            "    ensure_credentials_checked_recently,",
            "    no_firstrun_access,",
            "    require_credentials_checked_recently,",
            ")",
            "",
            "# ~~ permission api",
            "",
            "",
            "@api.route(\"/access/permissions\", methods=[\"GET\"])",
            "def get_permissions():",
            "    return jsonify(permissions=[permission.as_dict() for permission in Permissions.all()])",
            "",
            "",
            "# ~~ group api",
            "",
            "",
            "@api.route(\"/access/groups\", methods=[\"GET\"])",
            "@no_firstrun_access",
            "@Permissions.ADMIN.require(403)",
            "def get_groups():",
            "    return jsonify(groups=list(map(lambda g: g.as_dict(), groupManager.groups)))",
            "",
            "",
            "@api.route(\"/access/groups\", methods=[\"POST\"])",
            "@no_firstrun_access",
            "@require_credentials_checked_recently",
            "@Permissions.ADMIN.require(403)",
            "def add_group():",
            "    data = request.get_json()",
            "",
            "    if \"key\" not in data:",
            "        abort(400, description=\"key is missing\")",
            "    if \"name\" not in data:",
            "        abort(400, description=\"name is missing\")",
            "    if \"permissions\" not in data:",
            "        abort(400, description=\"permissions are missing\")",
            "",
            "    key = data[\"key\"]",
            "    name = data[\"name\"]",
            "    description = data.get(\"description\", \"\")",
            "    permissions = data[\"permissions\"]",
            "    subgroups = data[\"subgroups\"]",
            "    default = data.get(\"default\", False)",
            "",
            "    try:",
            "        groupManager.add_group(",
            "            key,",
            "            name,",
            "            description=description,",
            "            permissions=permissions,",
            "            subgroups=subgroups,",
            "            default=default,",
            "        )",
            "    except groups.GroupAlreadyExists:",
            "        abort(409)",
            "    return get_groups()",
            "",
            "",
            "@api.route(\"/access/groups/<key>\", methods=[\"GET\"])",
            "@no_firstrun_access",
            "@Permissions.ADMIN.require(403)",
            "def get_group(key):",
            "    group = groupManager.find_group(key)",
            "    if group is not None:",
            "        return jsonify(group)",
            "    else:",
            "        abort(404)",
            "",
            "",
            "@api.route(\"/access/groups/<key>\", methods=[\"PUT\"])",
            "@no_firstrun_access",
            "@require_credentials_checked_recently",
            "@Permissions.ADMIN.require(403)",
            "def update_group(key):",
            "    data = request.get_json()",
            "",
            "    try:",
            "        kwargs = {}",
            "",
            "        if \"permissions\" in data:",
            "            kwargs[\"permissions\"] = data[\"permissions\"]",
            "",
            "        if \"subgroups\" in data:",
            "            kwargs[\"subgroups\"] = data[\"subgroups\"]",
            "",
            "        if \"default\" in data:",
            "            kwargs[\"default\"] = data[\"default\"] in valid_boolean_trues",
            "",
            "        if \"description\" in data:",
            "            kwargs[\"description\"] = data[\"description\"]",
            "",
            "        groupManager.update_group(key, **kwargs)",
            "",
            "        return get_groups()",
            "    except groups.GroupCantBeChanged:",
            "        abort(403)",
            "    except groups.UnknownGroup:",
            "        abort(404)",
            "",
            "",
            "@api.route(\"/access/groups/<key>\", methods=[\"DELETE\"])",
            "@no_firstrun_access",
            "@require_credentials_checked_recently",
            "@Permissions.ADMIN.require(403)",
            "def remove_group(key):",
            "    try:",
            "        groupManager.remove_group(key)",
            "        return get_groups()",
            "    except groups.UnknownGroup:",
            "        abort(404)",
            "    except groups.GroupUnremovable:",
            "        abort(403)",
            "",
            "",
            "# ~~ user api",
            "",
            "",
            "@api.route(\"/access/users\", methods=[\"GET\"])",
            "@no_firstrun_access",
            "@Permissions.ADMIN.require(403)",
            "def get_users():",
            "    return jsonify(users=list(map(lambda u: u.as_dict(), userManager.get_all_users())))",
            "",
            "",
            "@api.route(\"/access/users\", methods=[\"POST\"])",
            "@no_firstrun_access",
            "@require_credentials_checked_recently",
            "@Permissions.ADMIN.require(403)",
            "def add_user():",
            "    data = request.get_json()",
            "",
            "    if \"name\" not in data:",
            "        abort(400, description=\"name is missing\")",
            "    if \"password\" not in data:",
            "        abort(400, description=\"password is missing\")",
            "    if \"active\" not in data:",
            "        abort(400, description=\"active is missing\")",
            "",
            "    name = data[\"name\"]",
            "    password = data[\"password\"]",
            "    active = data[\"active\"] in valid_boolean_trues",
            "",
            "    groups = data.get(\"groups\", None)",
            "    permissions = data.get(\"permissions\", None)",
            "",
            "    try:",
            "        userManager.add_user(name, password, active, permissions, groups)",
            "    except users.UserAlreadyExists:",
            "        abort(409)",
            "    except users.InvalidUsername:",
            "        abort(400, \"Username invalid\")",
            "    return get_users()",
            "",
            "",
            "@api.route(\"/access/users/<username>\", methods=[\"GET\"])",
            "@no_firstrun_access",
            "def get_user(username):",
            "    if (",
            "        current_user is not None",
            "        and not current_user.is_anonymous",
            "        and (",
            "            current_user.get_name() == username",
            "            or current_user.has_permission(Permissions.ADMIN)",
            "        )",
            "    ):",
            "        user = userManager.find_user(username)",
            "        if user is not None:",
            "            return jsonify(user)",
            "        else:",
            "            abort(404)",
            "    else:",
            "        abort(403)",
            "",
            "",
            "@api.route(\"/access/users/<username>\", methods=[\"PUT\"])",
            "@no_firstrun_access",
            "@require_credentials_checked_recently",
            "@Permissions.ADMIN.require(403)",
            "def update_user(username):",
            "    user = userManager.find_user(username)",
            "    if user is not None:",
            "        data = request.get_json()",
            "",
            "        # change groups",
            "        if \"groups\" in data:",
            "            groups = data[\"groups\"]",
            "            userManager.change_user_groups(username, groups)",
            "",
            "        # change permissions",
            "        if \"permissions\" in data:",
            "            permissions = data[\"permissions\"]",
            "            userManager.change_user_permissions(username, permissions)",
            "",
            "        # change activation",
            "        if \"active\" in data:",
            "            userManager.change_user_activation(",
            "                username, data[\"active\"] in valid_boolean_trues",
            "            )",
            "",
            "        return get_users()",
            "    else:",
            "        abort(404)",
            "",
            "",
            "@api.route(\"/access/users/<username>\", methods=[\"DELETE\"])",
            "@no_firstrun_access",
            "@require_credentials_checked_recently",
            "@Permissions.ADMIN.require(403)",
            "def remove_user(username):",
            "    if not userManager.enabled:",
            "        return jsonify(SUCCESS)",
            "",
            "    if current_user.get_name() == username:",
            "        abort(400, description=\"You cannot delete yourself\")",
            "",
            "    try:",
            "        userManager.remove_user(username)",
            "        return get_users()",
            "    except users.UnknownUser:",
            "        abort(404)",
            "",
            "",
            "@api.route(\"/access/users/<username>/password\", methods=[\"PUT\"])",
            "@no_firstrun_access",
            "def change_password_for_user(username):",
            "    if not userManager.enabled:",
            "        return jsonify(SUCCESS)",
            "",
            "    if (",
            "        current_user is not None",
            "        and not current_user.is_anonymous",
            "        and (",
            "            current_user.get_name() == username",
            "            or current_user.has_permission(Permissions.ADMIN)",
            "        )",
            "    ):",
            "        data = request.get_json()",
            "",
            "        if \"password\" not in data or not data[\"password\"]:",
            "            abort(400, description=\"new password is missing\")",
            "",
            "        if current_user.get_name() == username:",
            "            if \"current\" not in data or not data[\"current\"]:",
            "                abort(400, description=\"current password is missing\")",
            "",
            "            if not userManager.check_password(username, data[\"current\"]):",
            "                abort(403, description=\"Invalid current password\")",
            "",
            "        elif current_user.has_permission(Permissions.ADMIN):",
            "            ensure_credentials_checked_recently()",
            "",
            "        else:",
            "            # this should never happen",
            "            abort(403, description=\"You are not allowed to change this user's password\")",
            "",
            "        try:",
            "            userManager.change_user_password(username, data[\"password\"])",
            "        except users.UnknownUser:",
            "            abort(404)",
            "",
            "        return jsonify(SUCCESS)",
            "    else:",
            "        abort(403)",
            "",
            "",
            "@api.route(\"/access/users/<username>/settings\", methods=[\"GET\"])",
            "@no_firstrun_access",
            "def get_settings_for_user(username):",
            "    if (",
            "        current_user is None",
            "        or current_user.is_anonymous",
            "        or (",
            "            current_user.get_name() != username",
            "            and not current_user.has_permission(Permissions.ADMIN)",
            "        )",
            "    ):",
            "        abort(403)",
            "",
            "    try:",
            "        return jsonify(userManager.get_all_user_settings(username))",
            "    except users.UnknownUser:",
            "        abort(404)",
            "",
            "",
            "@api.route(\"/access/users/<username>/settings\", methods=[\"PATCH\"])",
            "@no_firstrun_access",
            "def change_settings_for_user(username):",
            "    if (",
            "        current_user is None",
            "        or current_user.is_anonymous",
            "        or (",
            "            current_user.get_name() != username",
            "            and not current_user.has_permission(Permissions.ADMIN)",
            "        )",
            "    ):",
            "        abort(403)",
            "",
            "    if current_user.get_name() != username:",
            "        # this must be an admin, so we need to ensure credentials were checked",
            "        ensure_credentials_checked_recently()",
            "",
            "    data = request.get_json()",
            "",
            "    try:",
            "        userManager.change_user_settings(username, data)",
            "        return jsonify(SUCCESS)",
            "    except users.UnknownUser:",
            "        abort(404)",
            "",
            "",
            "@api.route(\"/access/users/<username>/apikey\", methods=[\"DELETE\"])",
            "@no_firstrun_access",
            "def delete_apikey_for_user(username):",
            "    if (",
            "        current_user is not None",
            "        and not current_user.is_anonymous",
            "        and (",
            "            current_user.get_name() == username",
            "            or current_user.has_permission(Permissions.ADMIN)",
            "        )",
            "    ):",
            "        if current_user.get_name() != username:",
            "            # this must be an admin, so we need to ensure credentials were checked",
            "            ensure_credentials_checked_recently()",
            "",
            "        try:",
            "            userManager.delete_api_key(username)",
            "        except users.UnknownUser:",
            "            abort(404)",
            "        return jsonify(SUCCESS)",
            "    else:",
            "        abort(403)",
            "",
            "",
            "@api.route(\"/access/users/<username>/apikey\", methods=[\"POST\"])",
            "@no_firstrun_access",
            "def generate_apikey_for_user(username):",
            "    if not userManager.enabled:",
            "        return jsonify(SUCCESS)",
            "",
            "    if (",
            "        current_user is not None",
            "        and not current_user.is_anonymous",
            "        and (",
            "            current_user.get_name() == username",
            "            or current_user.has_permission(Permissions.ADMIN)",
            "        )",
            "    ):",
            "        if current_user.get_name() != username:",
            "            # this must be an admin, so we need to ensure credentials were checked",
            "            ensure_credentials_checked_recently()",
            "",
            "        try:",
            "            apikey = userManager.generate_api_key(username)",
            "        except users.UnknownUser:",
            "            abort(404)",
            "        return jsonify({\"apikey\": apikey})",
            "    else:",
            "        abort(403)",
            "",
            "",
            "def _to_external_permissions(*permissions):",
            "    return list(map(lambda p: p.get_name(), permissions))",
            "",
            "",
            "def _to_external_groups(*groups):",
            "    return list(map(lambda g: g.get_name(), groups))"
        ],
        "afterPatchFile": [
            "__author__ = \"Marc Hannappel <salandora@gmail.com>\"",
            "__license__ = \"GNU Affero General Public License http://www.gnu.org/licenses/agpl.html\"",
            "__copyright__ = \"Copyright (C) 2017 The OctoPrint Project - Released under terms of the AGPLv3 License\"",
            "",
            "from flask import abort, jsonify, request",
            "from flask_login import current_user",
            "",
            "import octoprint.access.groups as groups",
            "import octoprint.access.users as users",
            "from octoprint.access.permissions import Permissions",
            "from octoprint.server import SUCCESS, groupManager, userManager",
            "from octoprint.server.api import api, valid_boolean_trues",
            "from octoprint.server.util.flask import (",
            "    credentials_checked_recently,",
            "    ensure_credentials_checked_recently,",
            "    no_firstrun_access,",
            "    require_credentials_checked_recently,",
            ")",
            "",
            "# ~~ permission api",
            "",
            "",
            "@api.route(\"/access/permissions\", methods=[\"GET\"])",
            "def get_permissions():",
            "    return jsonify(permissions=[permission.as_dict() for permission in Permissions.all()])",
            "",
            "",
            "# ~~ group api",
            "",
            "",
            "@api.route(\"/access/groups\", methods=[\"GET\"])",
            "@no_firstrun_access",
            "@Permissions.ADMIN.require(403)",
            "def get_groups():",
            "    return jsonify(groups=list(map(lambda g: g.as_dict(), groupManager.groups)))",
            "",
            "",
            "@api.route(\"/access/groups\", methods=[\"POST\"])",
            "@no_firstrun_access",
            "@require_credentials_checked_recently",
            "@Permissions.ADMIN.require(403)",
            "def add_group():",
            "    data = request.get_json()",
            "",
            "    if \"key\" not in data:",
            "        abort(400, description=\"key is missing\")",
            "    if \"name\" not in data:",
            "        abort(400, description=\"name is missing\")",
            "    if \"permissions\" not in data:",
            "        abort(400, description=\"permissions are missing\")",
            "",
            "    key = data[\"key\"]",
            "    name = data[\"name\"]",
            "    description = data.get(\"description\", \"\")",
            "    permissions = data[\"permissions\"]",
            "    subgroups = data[\"subgroups\"]",
            "    default = data.get(\"default\", False)",
            "",
            "    try:",
            "        groupManager.add_group(",
            "            key,",
            "            name,",
            "            description=description,",
            "            permissions=permissions,",
            "            subgroups=subgroups,",
            "            default=default,",
            "        )",
            "    except groups.GroupAlreadyExists:",
            "        abort(409)",
            "    return get_groups()",
            "",
            "",
            "@api.route(\"/access/groups/<key>\", methods=[\"GET\"])",
            "@no_firstrun_access",
            "@Permissions.ADMIN.require(403)",
            "def get_group(key):",
            "    group = groupManager.find_group(key)",
            "    if group is not None:",
            "        return jsonify(group)",
            "    else:",
            "        abort(404)",
            "",
            "",
            "@api.route(\"/access/groups/<key>\", methods=[\"PUT\"])",
            "@no_firstrun_access",
            "@require_credentials_checked_recently",
            "@Permissions.ADMIN.require(403)",
            "def update_group(key):",
            "    data = request.get_json()",
            "",
            "    try:",
            "        kwargs = {}",
            "",
            "        if \"permissions\" in data:",
            "            kwargs[\"permissions\"] = data[\"permissions\"]",
            "",
            "        if \"subgroups\" in data:",
            "            kwargs[\"subgroups\"] = data[\"subgroups\"]",
            "",
            "        if \"default\" in data:",
            "            kwargs[\"default\"] = data[\"default\"] in valid_boolean_trues",
            "",
            "        if \"description\" in data:",
            "            kwargs[\"description\"] = data[\"description\"]",
            "",
            "        groupManager.update_group(key, **kwargs)",
            "",
            "        return get_groups()",
            "    except groups.GroupCantBeChanged:",
            "        abort(403)",
            "    except groups.UnknownGroup:",
            "        abort(404)",
            "",
            "",
            "@api.route(\"/access/groups/<key>\", methods=[\"DELETE\"])",
            "@no_firstrun_access",
            "@require_credentials_checked_recently",
            "@Permissions.ADMIN.require(403)",
            "def remove_group(key):",
            "    try:",
            "        groupManager.remove_group(key)",
            "        return get_groups()",
            "    except groups.UnknownGroup:",
            "        abort(404)",
            "    except groups.GroupUnremovable:",
            "        abort(403)",
            "",
            "",
            "# ~~ user api",
            "",
            "",
            "@api.route(\"/access/users\", methods=[\"GET\"])",
            "@no_firstrun_access",
            "@Permissions.ADMIN.require(403)",
            "def get_users():",
            "    users = [u.as_dict() for u in userManager.get_all_users()]",
            "    if not credentials_checked_recently():",
            "        for u in users:",
            "            u[\"apikey\"] = None",
            "    return jsonify(users=users)",
            "",
            "",
            "@api.route(\"/access/users\", methods=[\"POST\"])",
            "@no_firstrun_access",
            "@require_credentials_checked_recently",
            "@Permissions.ADMIN.require(403)",
            "def add_user():",
            "    data = request.get_json()",
            "",
            "    if \"name\" not in data:",
            "        abort(400, description=\"name is missing\")",
            "    if \"password\" not in data:",
            "        abort(400, description=\"password is missing\")",
            "    if \"active\" not in data:",
            "        abort(400, description=\"active is missing\")",
            "",
            "    name = data[\"name\"]",
            "    password = data[\"password\"]",
            "    active = data[\"active\"] in valid_boolean_trues",
            "",
            "    groups = data.get(\"groups\", None)",
            "    permissions = data.get(\"permissions\", None)",
            "",
            "    try:",
            "        userManager.add_user(name, password, active, permissions, groups)",
            "    except users.UserAlreadyExists:",
            "        abort(409)",
            "    except users.InvalidUsername:",
            "        abort(400, \"Username invalid\")",
            "    return get_users()",
            "",
            "",
            "@api.route(\"/access/users/<username>\", methods=[\"GET\"])",
            "@no_firstrun_access",
            "def get_user(username):",
            "    if (",
            "        current_user is not None",
            "        and not current_user.is_anonymous",
            "        and (",
            "            current_user.get_name() == username",
            "            or current_user.has_permission(Permissions.ADMIN)",
            "        )",
            "    ):",
            "        user = userManager.find_user(username)",
            "        if user is not None:",
            "            user_dict = user.as_dict()",
            "            if not credentials_checked_recently():",
            "                user_dict[\"apikey\"] = None",
            "            return jsonify(user_dict)",
            "        else:",
            "            abort(404)",
            "    else:",
            "        abort(403)",
            "",
            "",
            "@api.route(\"/access/users/<username>\", methods=[\"PUT\"])",
            "@no_firstrun_access",
            "@require_credentials_checked_recently",
            "@Permissions.ADMIN.require(403)",
            "def update_user(username):",
            "    user = userManager.find_user(username)",
            "    if user is not None:",
            "        data = request.get_json()",
            "",
            "        # change groups",
            "        if \"groups\" in data:",
            "            groups = data[\"groups\"]",
            "            userManager.change_user_groups(username, groups)",
            "",
            "        # change permissions",
            "        if \"permissions\" in data:",
            "            permissions = data[\"permissions\"]",
            "            userManager.change_user_permissions(username, permissions)",
            "",
            "        # change activation",
            "        if \"active\" in data:",
            "            userManager.change_user_activation(",
            "                username, data[\"active\"] in valid_boolean_trues",
            "            )",
            "",
            "        return get_users()",
            "    else:",
            "        abort(404)",
            "",
            "",
            "@api.route(\"/access/users/<username>\", methods=[\"DELETE\"])",
            "@no_firstrun_access",
            "@require_credentials_checked_recently",
            "@Permissions.ADMIN.require(403)",
            "def remove_user(username):",
            "    if not userManager.enabled:",
            "        return jsonify(SUCCESS)",
            "",
            "    if current_user.get_name() == username:",
            "        abort(400, description=\"You cannot delete yourself\")",
            "",
            "    try:",
            "        userManager.remove_user(username)",
            "        return get_users()",
            "    except users.UnknownUser:",
            "        abort(404)",
            "",
            "",
            "@api.route(\"/access/users/<username>/password\", methods=[\"PUT\"])",
            "@no_firstrun_access",
            "def change_password_for_user(username):",
            "    if not userManager.enabled:",
            "        return jsonify(SUCCESS)",
            "",
            "    if (",
            "        current_user is not None",
            "        and not current_user.is_anonymous",
            "        and (",
            "            current_user.get_name() == username",
            "            or current_user.has_permission(Permissions.ADMIN)",
            "        )",
            "    ):",
            "        data = request.get_json()",
            "",
            "        if \"password\" not in data or not data[\"password\"]:",
            "            abort(400, description=\"new password is missing\")",
            "",
            "        if current_user.get_name() == username:",
            "            if \"current\" not in data or not data[\"current\"]:",
            "                abort(400, description=\"current password is missing\")",
            "",
            "            if not userManager.check_password(username, data[\"current\"]):",
            "                abort(403, description=\"Invalid current password\")",
            "",
            "        elif current_user.has_permission(Permissions.ADMIN):",
            "            ensure_credentials_checked_recently()",
            "",
            "        else:",
            "            # this should never happen",
            "            abort(403, description=\"You are not allowed to change this user's password\")",
            "",
            "        try:",
            "            userManager.change_user_password(username, data[\"password\"])",
            "        except users.UnknownUser:",
            "            abort(404)",
            "",
            "        return jsonify(SUCCESS)",
            "    else:",
            "        abort(403)",
            "",
            "",
            "@api.route(\"/access/users/<username>/settings\", methods=[\"GET\"])",
            "@no_firstrun_access",
            "def get_settings_for_user(username):",
            "    if (",
            "        current_user is None",
            "        or current_user.is_anonymous",
            "        or (",
            "            current_user.get_name() != username",
            "            and not current_user.has_permission(Permissions.ADMIN)",
            "        )",
            "    ):",
            "        abort(403)",
            "",
            "    try:",
            "        return jsonify(userManager.get_all_user_settings(username))",
            "    except users.UnknownUser:",
            "        abort(404)",
            "",
            "",
            "@api.route(\"/access/users/<username>/settings\", methods=[\"PATCH\"])",
            "@no_firstrun_access",
            "def change_settings_for_user(username):",
            "    if (",
            "        current_user is None",
            "        or current_user.is_anonymous",
            "        or (",
            "            current_user.get_name() != username",
            "            and not current_user.has_permission(Permissions.ADMIN)",
            "        )",
            "    ):",
            "        abort(403)",
            "",
            "    if current_user.get_name() != username:",
            "        # this must be an admin, so we need to ensure credentials were checked",
            "        ensure_credentials_checked_recently()",
            "",
            "    data = request.get_json()",
            "",
            "    try:",
            "        userManager.change_user_settings(username, data)",
            "        return jsonify(SUCCESS)",
            "    except users.UnknownUser:",
            "        abort(404)",
            "",
            "",
            "@api.route(\"/access/users/<username>/apikey\", methods=[\"DELETE\"])",
            "@no_firstrun_access",
            "@require_credentials_checked_recently",
            "def delete_apikey_for_user(username):",
            "    if (",
            "        current_user is not None",
            "        and not current_user.is_anonymous",
            "        and (",
            "            current_user.get_name() == username",
            "            or current_user.has_permission(Permissions.ADMIN)",
            "        )",
            "    ):",
            "        if current_user.get_name() != username:",
            "            # this must be an admin, so we need to ensure credentials were checked",
            "            ensure_credentials_checked_recently()",
            "",
            "        try:",
            "            userManager.delete_api_key(username)",
            "        except users.UnknownUser:",
            "            abort(404)",
            "        return jsonify(SUCCESS)",
            "    else:",
            "        abort(403)",
            "",
            "",
            "@api.route(\"/access/users/<username>/apikey\", methods=[\"POST\"])",
            "@no_firstrun_access",
            "@require_credentials_checked_recently",
            "def generate_apikey_for_user(username):",
            "    if not userManager.enabled:",
            "        return jsonify(SUCCESS)",
            "",
            "    if (",
            "        current_user is not None",
            "        and not current_user.is_anonymous",
            "        and (",
            "            current_user.get_name() == username",
            "            or current_user.has_permission(Permissions.ADMIN)",
            "        )",
            "    ):",
            "        if current_user.get_name() != username:",
            "            # this must be an admin, so we need to ensure credentials were checked",
            "            ensure_credentials_checked_recently()",
            "",
            "        try:",
            "            apikey = userManager.generate_api_key(username)",
            "        except users.UnknownUser:",
            "            abort(404)",
            "        return jsonify({\"apikey\": apikey})",
            "    else:",
            "        abort(403)",
            "",
            "",
            "def _to_external_permissions(*permissions):",
            "    return list(map(lambda p: p.get_name(), permissions))",
            "",
            "",
            "def _to_external_groups(*groups):",
            "    return list(map(lambda g: g.get_name(), groups))"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "135": [
                "get_users"
            ],
            "181": [
                "get_user"
            ]
        },
        "addLocation": []
    },
    "src/octoprint/server/api/settings.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 16,
                "afterPatchRowNumber": 16,
                "PatchRowcode": " from octoprint.server.util.flask import ("
            },
            "1": {
                "beforePatchRowNumber": 17,
                "afterPatchRowNumber": 17,
                "PatchRowcode": "     credentials_checked_recently,"
            },
            "2": {
                "beforePatchRowNumber": 18,
                "afterPatchRowNumber": 18,
                "PatchRowcode": "     no_firstrun_access,"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 19,
                "PatchRowcode": "+    require_credentials_checked_recently,"
            },
            "4": {
                "beforePatchRowNumber": 19,
                "afterPatchRowNumber": 20,
                "PatchRowcode": "     with_revalidation_checking,"
            },
            "5": {
                "beforePatchRowNumber": 20,
                "afterPatchRowNumber": 21,
                "PatchRowcode": " )"
            },
            "6": {
                "beforePatchRowNumber": 21,
                "afterPatchRowNumber": 22,
                "PatchRowcode": " from octoprint.settings import settings, valid_boolean_trues"
            },
            "7": {
                "beforePatchRowNumber": 478,
                "afterPatchRowNumber": 479,
                "PatchRowcode": " @api.route(\"/settings/apikey\", methods=[\"POST\"])"
            },
            "8": {
                "beforePatchRowNumber": 479,
                "afterPatchRowNumber": 480,
                "PatchRowcode": " @no_firstrun_access"
            },
            "9": {
                "beforePatchRowNumber": 480,
                "afterPatchRowNumber": 481,
                "PatchRowcode": " @Permissions.ADMIN.require(403)"
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 482,
                "PatchRowcode": "+@require_credentials_checked_recently"
            },
            "11": {
                "beforePatchRowNumber": 481,
                "afterPatchRowNumber": 483,
                "PatchRowcode": " def generateApiKey():"
            },
            "12": {
                "beforePatchRowNumber": 482,
                "afterPatchRowNumber": 484,
                "PatchRowcode": "     apikey = settings().generateApiKey()"
            },
            "13": {
                "beforePatchRowNumber": 483,
                "afterPatchRowNumber": 485,
                "PatchRowcode": "     return jsonify(apikey=apikey)"
            },
            "14": {
                "beforePatchRowNumber": 486,
                "afterPatchRowNumber": 488,
                "PatchRowcode": " @api.route(\"/settings/apikey\", methods=[\"DELETE\"])"
            },
            "15": {
                "beforePatchRowNumber": 487,
                "afterPatchRowNumber": 489,
                "PatchRowcode": " @no_firstrun_access"
            },
            "16": {
                "beforePatchRowNumber": 488,
                "afterPatchRowNumber": 490,
                "PatchRowcode": " @Permissions.ADMIN.require(403)"
            },
            "17": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 491,
                "PatchRowcode": "+@require_credentials_checked_recently"
            },
            "18": {
                "beforePatchRowNumber": 489,
                "afterPatchRowNumber": 492,
                "PatchRowcode": " def deleteApiKey():"
            },
            "19": {
                "beforePatchRowNumber": 490,
                "afterPatchRowNumber": 493,
                "PatchRowcode": "     settings().deleteApiKey()"
            },
            "20": {
                "beforePatchRowNumber": 491,
                "afterPatchRowNumber": 494,
                "PatchRowcode": "     return NO_CONTENT"
            },
            "21": {
                "beforePatchRowNumber": 581,
                "afterPatchRowNumber": 584,
                "PatchRowcode": "             s.set([\"appearance\", \"color\"], data[\"appearance\"][\"color\"])"
            },
            "22": {
                "beforePatchRowNumber": 582,
                "afterPatchRowNumber": 585,
                "PatchRowcode": "         if \"colorTransparent\" in data[\"appearance\"]:"
            },
            "23": {
                "beforePatchRowNumber": 583,
                "afterPatchRowNumber": 586,
                "PatchRowcode": "             s.setBoolean("
            },
            "24": {
                "beforePatchRowNumber": 584,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                [\"appearance\", \"colorTransparent\"], data[\"appearance\"][\"colorTransparent\"]"
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 587,
                "PatchRowcode": "+                [\"appearance\", \"colorTransparent\"],"
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 588,
                "PatchRowcode": "+                data[\"appearance\"][\"colorTransparent\"],"
            },
            "27": {
                "beforePatchRowNumber": 585,
                "afterPatchRowNumber": 589,
                "PatchRowcode": "             )"
            },
            "28": {
                "beforePatchRowNumber": 586,
                "afterPatchRowNumber": 590,
                "PatchRowcode": "         if \"colorIcon\" in data[\"appearance\"]:"
            },
            "29": {
                "beforePatchRowNumber": 587,
                "afterPatchRowNumber": 591,
                "PatchRowcode": "             s.setBoolean([\"appearance\", \"colorIcon\"], data[\"appearance\"][\"colorIcon\"])"
            },
            "30": {
                "beforePatchRowNumber": 639,
                "afterPatchRowNumber": 643,
                "PatchRowcode": "         if \"ffmpegCommandline\" in data[\"webcam\"]:"
            },
            "31": {
                "beforePatchRowNumber": 640,
                "afterPatchRowNumber": 644,
                "PatchRowcode": "             commandline = data[\"webcam\"][\"ffmpegCommandline\"]"
            },
            "32": {
                "beforePatchRowNumber": 641,
                "afterPatchRowNumber": 645,
                "PatchRowcode": "             if not all("
            },
            "33": {
                "beforePatchRowNumber": 642,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                map(lambda x: \"{\" + x + \"}\" in commandline, (\"ffmpeg\", \"input\", \"output\"))"
            },
            "34": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 646,
                "PatchRowcode": "+                map("
            },
            "35": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 647,
                "PatchRowcode": "+                    lambda x: \"{\" + x + \"}\" in commandline,"
            },
            "36": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 648,
                "PatchRowcode": "+                    (\"ffmpeg\", \"input\", \"output\"),"
            },
            "37": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 649,
                "PatchRowcode": "+                )"
            },
            "38": {
                "beforePatchRowNumber": 643,
                "afterPatchRowNumber": 650,
                "PatchRowcode": "             ):"
            },
            "39": {
                "beforePatchRowNumber": 644,
                "afterPatchRowNumber": 651,
                "PatchRowcode": "                 abort("
            },
            "40": {
                "beforePatchRowNumber": 645,
                "afterPatchRowNumber": 652,
                "PatchRowcode": "                     400,"
            },
            "41": {
                "beforePatchRowNumber": 855,
                "afterPatchRowNumber": 862,
                "PatchRowcode": "             data[\"serial\"][\"blacklistedBaudrates\"], (list, tuple)"
            },
            "42": {
                "beforePatchRowNumber": 856,
                "afterPatchRowNumber": 863,
                "PatchRowcode": "         ):"
            },
            "43": {
                "beforePatchRowNumber": 857,
                "afterPatchRowNumber": 864,
                "PatchRowcode": "             s.set("
            },
            "44": {
                "beforePatchRowNumber": 858,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                [\"serial\", \"blacklistedBaudrates\"], data[\"serial\"][\"blacklistedBaudrates\"]"
            },
            "45": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 865,
                "PatchRowcode": "+                [\"serial\", \"blacklistedBaudrates\"],"
            },
            "46": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 866,
                "PatchRowcode": "+                data[\"serial\"][\"blacklistedBaudrates\"],"
            },
            "47": {
                "beforePatchRowNumber": 859,
                "afterPatchRowNumber": 867,
                "PatchRowcode": "             )"
            },
            "48": {
                "beforePatchRowNumber": 860,
                "afterPatchRowNumber": 868,
                "PatchRowcode": "         if \"longRunningCommands\" in data[\"serial\"] and isinstance("
            },
            "49": {
                "beforePatchRowNumber": 861,
                "afterPatchRowNumber": 869,
                "PatchRowcode": "             data[\"serial\"][\"longRunningCommands\"], (list, tuple)"
            },
            "50": {
                "beforePatchRowNumber": 942,
                "afterPatchRowNumber": 950,
                "PatchRowcode": "             s.setBoolean([\"serial\", \"sdLowerCase\"], data[\"serial\"][\"sdLowerCase\"])"
            },
            "51": {
                "beforePatchRowNumber": 943,
                "afterPatchRowNumber": 951,
                "PatchRowcode": "         if \"swallowOkAfterResend\" in data[\"serial\"]:"
            },
            "52": {
                "beforePatchRowNumber": 944,
                "afterPatchRowNumber": 952,
                "PatchRowcode": "             s.setBoolean("
            },
            "53": {
                "beforePatchRowNumber": 945,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                [\"serial\", \"swallowOkAfterResend\"], data[\"serial\"][\"swallowOkAfterResend\"]"
            },
            "54": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 953,
                "PatchRowcode": "+                [\"serial\", \"swallowOkAfterResend\"],"
            },
            "55": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 954,
                "PatchRowcode": "+                data[\"serial\"][\"swallowOkAfterResend\"],"
            },
            "56": {
                "beforePatchRowNumber": 946,
                "afterPatchRowNumber": 955,
                "PatchRowcode": "             )"
            },
            "57": {
                "beforePatchRowNumber": 947,
                "afterPatchRowNumber": 956,
                "PatchRowcode": "         if \"repetierTargetTemp\" in data[\"serial\"]:"
            },
            "58": {
                "beforePatchRowNumber": 948,
                "afterPatchRowNumber": 957,
                "PatchRowcode": "             s.setBoolean("
            },
            "59": {
                "beforePatchRowNumber": 1040,
                "afterPatchRowNumber": 1049,
                "PatchRowcode": "                 data[\"serial\"][\"capEmergencyParser\"],"
            },
            "60": {
                "beforePatchRowNumber": 1041,
                "afterPatchRowNumber": 1050,
                "PatchRowcode": "             )"
            },
            "61": {
                "beforePatchRowNumber": 1042,
                "afterPatchRowNumber": 1051,
                "PatchRowcode": "         if \"capExtendedM20\" in data[\"serial\"]:"
            },
            "62": {
                "beforePatchRowNumber": 1043,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            s.setBoolean("
            },
            "63": {
                "beforePatchRowNumber": 1044,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                [\"serial\", \"capabilities\", \"extended_m20\"],"
            },
            "64": {
                "beforePatchRowNumber": 1045,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                data[\"serial\"][\"capExtendedM20\"],"
            },
            "65": {
                "beforePatchRowNumber": 1046,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            ),"
            },
            "66": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 1052,
                "PatchRowcode": "+            ("
            },
            "67": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 1053,
                "PatchRowcode": "+                s.setBoolean("
            },
            "68": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 1054,
                "PatchRowcode": "+                    [\"serial\", \"capabilities\", \"extended_m20\"],"
            },
            "69": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 1055,
                "PatchRowcode": "+                    data[\"serial\"][\"capExtendedM20\"],"
            },
            "70": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 1056,
                "PatchRowcode": "+                ),"
            },
            "71": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 1057,
                "PatchRowcode": "+            )"
            },
            "72": {
                "beforePatchRowNumber": 1047,
                "afterPatchRowNumber": 1058,
                "PatchRowcode": "         if \"capLfnWrite\" in data[\"serial\"]:"
            },
            "73": {
                "beforePatchRowNumber": 1048,
                "afterPatchRowNumber": 1059,
                "PatchRowcode": "             s.setBoolean("
            },
            "74": {
                "beforePatchRowNumber": 1049,
                "afterPatchRowNumber": 1060,
                "PatchRowcode": "                 [\"serial\", \"capabilities\", \"lfn_write\"],"
            },
            "75": {
                "beforePatchRowNumber": 1050,
                "afterPatchRowNumber": 1061,
                "PatchRowcode": "                 data[\"serial\"][\"capLfnWrite\"],"
            },
            "76": {
                "beforePatchRowNumber": 1051,
                "afterPatchRowNumber": 1062,
                "PatchRowcode": "             )"
            },
            "77": {
                "beforePatchRowNumber": 1052,
                "afterPatchRowNumber": 1063,
                "PatchRowcode": "         if \"resendRatioThreshold\" in data[\"serial\"]:"
            },
            "78": {
                "beforePatchRowNumber": 1053,
                "afterPatchRowNumber": 1064,
                "PatchRowcode": "             s.setInt("
            },
            "79": {
                "beforePatchRowNumber": 1054,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                [\"serial\", \"resendRatioThreshold\"], data[\"serial\"][\"resendRatioThreshold\"]"
            },
            "80": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 1065,
                "PatchRowcode": "+                [\"serial\", \"resendRatioThreshold\"],"
            },
            "81": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 1066,
                "PatchRowcode": "+                data[\"serial\"][\"resendRatioThreshold\"],"
            },
            "82": {
                "beforePatchRowNumber": 1055,
                "afterPatchRowNumber": 1067,
                "PatchRowcode": "             )"
            },
            "83": {
                "beforePatchRowNumber": 1056,
                "afterPatchRowNumber": 1068,
                "PatchRowcode": "         if \"resendRatioStart\" in data[\"serial\"]:"
            },
            "84": {
                "beforePatchRowNumber": 1057,
                "afterPatchRowNumber": 1069,
                "PatchRowcode": "             s.setInt([\"serial\", \"resendRatioStart\"], data[\"serial\"][\"resendRatioStart\"])"
            }
        },
        "frontPatchFile": [
            "__author__ = \"Gina H\u00e4u\u00dfge <osd@foosel.net>\"",
            "__license__ = \"GNU Affero General Public License http://www.gnu.org/licenses/agpl.html\"",
            "__copyright__ = \"Copyright (C) 2014 The OctoPrint Project - Released under terms of the AGPLv3 License\"",
            "",
            "import logging",
            "import re",
            "",
            "from flask import abort, jsonify, request",
            "from flask_login import current_user",
            "",
            "import octoprint.plugin",
            "import octoprint.util",
            "from octoprint.access.permissions import Permissions",
            "from octoprint.server import pluginManager, printer, userManager",
            "from octoprint.server.api import NO_CONTENT, api",
            "from octoprint.server.util.flask import (",
            "    credentials_checked_recently,",
            "    no_firstrun_access,",
            "    with_revalidation_checking,",
            ")",
            "from octoprint.settings import settings, valid_boolean_trues",
            "from octoprint.timelapse import configure_timelapse",
            "from octoprint.webcams import (",
            "    get_default_webcam,",
            "    get_snapshot_webcam,",
            "    get_webcams_as_dicts,",
            ")",
            "",
            "# ~~ settings",
            "",
            "FOLDER_TYPES = (\"uploads\", \"timelapse\", \"watched\")",
            "TIMELAPSE_BITRATE_PATTERN = re.compile(r\"\\d+[KMGTPEZY]?i?B?\", flags=re.IGNORECASE)",
            "DEPRECATED_WEBCAM_KEYS = (",
            "    \"streamUrl\",",
            "    \"streamRatio\",",
            "    \"streamTimeout\",",
            "    \"streamWebrtcIceServers\",",
            "    \"snapshotUrl\",",
            "    \"snapshotTimeout\",",
            "    \"snapshotSslValidation\",",
            "    \"cacheBuster\",",
            "    \"flipH\",",
            "    \"flipV\",",
            "    \"rotate90\",",
            ")",
            "",
            "",
            "def _lastmodified():",
            "    return settings().last_modified",
            "",
            "",
            "def _etag(lm=None):",
            "    if lm is None:",
            "        lm = _lastmodified()",
            "",
            "    connection_options = printer.__class__.get_connection_options()",
            "    plugins = sorted(octoprint.plugin.plugin_manager().enabled_plugins)",
            "    plugin_settings = _get_plugin_settings()",
            "",
            "    from collections import OrderedDict",
            "",
            "    sorted_plugin_settings = OrderedDict()",
            "    for key in sorted(plugin_settings.keys()):",
            "        sorted_plugin_settings[key] = plugin_settings.get(key, {})",
            "",
            "    if current_user is not None and not current_user.is_anonymous:",
            "        roles = sorted(current_user.permissions, key=lambda x: x.key)",
            "    else:",
            "        roles = []",
            "",
            "    import hashlib",
            "",
            "    hash = hashlib.sha1()",
            "",
            "    def hash_update(value):",
            "        value = value.encode(\"utf-8\")",
            "        hash.update(value)",
            "",
            "    # last modified timestamp",
            "    hash_update(str(lm))",
            "",
            "    # effective config from config.yaml + overlays",
            "    hash_update(repr(settings().effective))",
            "",
            "    # might duplicate settings().effective, but plugins might also inject additional keys into the settings",
            "    # output that are not stored in config.yaml",
            "    hash_update(repr(sorted_plugin_settings))",
            "",
            "    # connection options are also part of the settings",
            "    hash_update(repr(connection_options))",
            "",
            "    # if the list of plugins changes, the settings structure changes too",
            "    hash_update(repr(plugins))",
            "",
            "    # and likewise if the role of the user changes",
            "    hash_update(repr(roles))",
            "",
            "    # of if the user reauthenticates",
            "    hash_update(repr(credentials_checked_recently()))",
            "",
            "    return hash.hexdigest()",
            "",
            "",
            "@api.route(\"/settings\", methods=[\"GET\"])",
            "@with_revalidation_checking(",
            "    etag_factory=_etag,",
            "    lastmodified_factory=_lastmodified,",
            "    unless=lambda: request.values.get(\"force\", \"false\") in valid_boolean_trues",
            "    or settings().getBoolean([\"server\", \"firstRun\"])",
            "    or not userManager.has_been_customized(),",
            ")",
            "def getSettings():",
            "    if not Permissions.SETTINGS_READ.can() and not (",
            "        settings().getBoolean([\"server\", \"firstRun\"])",
            "        or not userManager.has_been_customized()",
            "    ):",
            "        abort(403)",
            "",
            "    s = settings()",
            "",
            "    connectionOptions = printer.__class__.get_connection_options()",
            "",
            "    # NOTE: Remember to adjust the docs of the data model on the Settings API if anything",
            "    # is changed, added or removed here",
            "",
            "    data = {",
            "        \"api\": {",
            "            \"key\": (",
            "                s.get([\"api\", \"key\"])",
            "                if Permissions.ADMIN.can() and credentials_checked_recently()",
            "                else None",
            "            ),",
            "            \"allowCrossOrigin\": s.get([\"api\", \"allowCrossOrigin\"]),",
            "        },",
            "        \"appearance\": {",
            "            \"name\": s.get([\"appearance\", \"name\"]),",
            "            \"color\": s.get([\"appearance\", \"color\"]),",
            "            \"colorTransparent\": s.getBoolean([\"appearance\", \"colorTransparent\"]),",
            "            \"colorIcon\": s.getBoolean([\"appearance\", \"colorIcon\"]),",
            "            \"defaultLanguage\": s.get([\"appearance\", \"defaultLanguage\"]),",
            "            \"showFahrenheitAlso\": s.getBoolean([\"appearance\", \"showFahrenheitAlso\"]),",
            "            \"fuzzyTimes\": s.getBoolean([\"appearance\", \"fuzzyTimes\"]),",
            "            \"closeModalsWithClick\": s.getBoolean([\"appearance\", \"closeModalsWithClick\"]),",
            "            \"showInternalFilename\": s.getBoolean([\"appearance\", \"showInternalFilename\"]),",
            "        },",
            "        \"feature\": {",
            "            \"temperatureGraph\": s.getBoolean([\"feature\", \"temperatureGraph\"]),",
            "            \"sdSupport\": s.getBoolean([\"feature\", \"sdSupport\"]),",
            "            \"keyboardControl\": s.getBoolean([\"feature\", \"keyboardControl\"]),",
            "            \"pollWatched\": s.getBoolean([\"feature\", \"pollWatched\"]),",
            "            \"modelSizeDetection\": s.getBoolean([\"feature\", \"modelSizeDetection\"]),",
            "            \"rememberFileFolder\": s.getBoolean([\"feature\", \"rememberFileFolder\"]),",
            "            \"printStartConfirmation\": s.getBoolean([\"feature\", \"printStartConfirmation\"]),",
            "            \"printCancelConfirmation\": s.getBoolean(",
            "                [\"feature\", \"printCancelConfirmation\"]",
            "            ),",
            "            \"uploadOverwriteConfirmation\": s.getBoolean(",
            "                [\"feature\", \"uploadOverwriteConfirmation\"]",
            "            ),",
            "            \"g90InfluencesExtruder\": s.getBoolean([\"feature\", \"g90InfluencesExtruder\"]),",
            "            \"autoUppercaseBlacklist\": s.get([\"feature\", \"autoUppercaseBlacklist\"]),",
            "            \"enableDragDropUpload\": s.getBoolean([\"feature\", \"enableDragDropUpload\"]),",
            "        },",
            "        \"gcodeAnalysis\": {",
            "            \"runAt\": s.get([\"gcodeAnalysis\", \"runAt\"]),",
            "            \"bedZ\": s.getFloat([\"gcodeAnalysis\", \"bedZ\"]),",
            "        },",
            "        \"serial\": {",
            "            \"port\": connectionOptions[\"portPreference\"],",
            "            \"baudrate\": connectionOptions[\"baudratePreference\"],",
            "            \"exclusive\": s.getBoolean([\"serial\", \"exclusive\"]),",
            "            \"lowLatency\": s.getBoolean([\"serial\", \"lowLatency\"]),",
            "            \"portOptions\": connectionOptions[\"ports\"],",
            "            \"baudrateOptions\": connectionOptions[\"baudrates\"],",
            "            \"autoconnect\": s.getBoolean([\"serial\", \"autoconnect\"]),",
            "            \"timeoutConnection\": s.getFloat([\"serial\", \"timeout\", \"connection\"]),",
            "            \"timeoutDetectionFirst\": s.getFloat([\"serial\", \"timeout\", \"detectionFirst\"]),",
            "            \"timeoutDetectionConsecutive\": s.getFloat(",
            "                [\"serial\", \"timeout\", \"detectionConsecutive\"]",
            "            ),",
            "            \"timeoutCommunication\": s.getFloat([\"serial\", \"timeout\", \"communication\"]),",
            "            \"timeoutCommunicationBusy\": s.getFloat(",
            "                [\"serial\", \"timeout\", \"communicationBusy\"]",
            "            ),",
            "            \"timeoutTemperature\": s.getFloat([\"serial\", \"timeout\", \"temperature\"]),",
            "            \"timeoutTemperatureTargetSet\": s.getFloat(",
            "                [\"serial\", \"timeout\", \"temperatureTargetSet\"]",
            "            ),",
            "            \"timeoutTemperatureAutoreport\": s.getFloat(",
            "                [\"serial\", \"timeout\", \"temperatureAutoreport\"]",
            "            ),",
            "            \"timeoutSdStatus\": s.getFloat([\"serial\", \"timeout\", \"sdStatus\"]),",
            "            \"timeoutSdStatusAutoreport\": s.getFloat(",
            "                [\"serial\", \"timeout\", \"sdStatusAutoreport\"]",
            "            ),",
            "            \"timeoutPosAutoreport\": s.getFloat([\"serial\", \"timeout\", \"posAutoreport\"]),",
            "            \"timeoutBaudrateDetectionPause\": s.getFloat(",
            "                [\"serial\", \"timeout\", \"baudrateDetectionPause\"]",
            "            ),",
            "            \"timeoutPositionLogWait\": s.getFloat(",
            "                [\"serial\", \"timeout\", \"positionLogWait\"]",
            "            ),",
            "            \"log\": s.getBoolean([\"serial\", \"log\"]),",
            "            \"additionalPorts\": s.get([\"serial\", \"additionalPorts\"]),",
            "            \"additionalBaudrates\": s.get([\"serial\", \"additionalBaudrates\"]),",
            "            \"blacklistedPorts\": s.get([\"serial\", \"blacklistedPorts\"]),",
            "            \"blacklistedBaudrates\": s.get([\"serial\", \"blacklistedBaudrates\"]),",
            "            \"longRunningCommands\": s.get([\"serial\", \"longRunningCommands\"]),",
            "            \"checksumRequiringCommands\": s.get([\"serial\", \"checksumRequiringCommands\"]),",
            "            \"blockedCommands\": s.get([\"serial\", \"blockedCommands\"]),",
            "            \"ignoredCommands\": s.get([\"serial\", \"ignoredCommands\"]),",
            "            \"pausingCommands\": s.get([\"serial\", \"pausingCommands\"]),",
            "            \"sdCancelCommand\": s.get([\"serial\", \"sdCancelCommand\"]),",
            "            \"emergencyCommands\": s.get([\"serial\", \"emergencyCommands\"]),",
            "            \"helloCommand\": s.get([\"serial\", \"helloCommand\"]),",
            "            \"ignoreErrorsFromFirmware\": s.getBoolean(",
            "                [\"serial\", \"ignoreErrorsFromFirmware\"]",
            "            ),",
            "            \"disconnectOnErrors\": s.getBoolean([\"serial\", \"disconnectOnErrors\"]),",
            "            \"triggerOkForM29\": s.getBoolean([\"serial\", \"triggerOkForM29\"]),",
            "            \"logPositionOnPause\": s.getBoolean([\"serial\", \"logPositionOnPause\"]),",
            "            \"logPositionOnCancel\": s.getBoolean([\"serial\", \"logPositionOnCancel\"]),",
            "            \"abortHeatupOnCancel\": s.getBoolean([\"serial\", \"abortHeatupOnCancel\"]),",
            "            \"supportResendsWithoutOk\": s.get([\"serial\", \"supportResendsWithoutOk\"]),",
            "            \"waitForStart\": s.getBoolean([\"serial\", \"waitForStartOnConnect\"]),",
            "            \"waitToLoadSdFileList\": s.getBoolean([\"serial\", \"waitToLoadSdFileList\"]),",
            "            \"alwaysSendChecksum\": s.getBoolean([\"serial\", \"alwaysSendChecksum\"]),",
            "            \"neverSendChecksum\": s.getBoolean([\"serial\", \"neverSendChecksum\"]),",
            "            \"sendChecksumWithUnknownCommands\": s.getBoolean(",
            "                [\"serial\", \"sendChecksumWithUnknownCommands\"]",
            "            ),",
            "            \"unknownCommandsNeedAck\": s.getBoolean([\"serial\", \"unknownCommandsNeedAck\"]),",
            "            \"sdRelativePath\": s.getBoolean([\"serial\", \"sdRelativePath\"]),",
            "            \"sdAlwaysAvailable\": s.getBoolean([\"serial\", \"sdAlwaysAvailable\"]),",
            "            \"sdLowerCase\": s.getBoolean([\"serial\", \"sdLowerCase\"]),",
            "            \"swallowOkAfterResend\": s.getBoolean([\"serial\", \"swallowOkAfterResend\"]),",
            "            \"repetierTargetTemp\": s.getBoolean([\"serial\", \"repetierTargetTemp\"]),",
            "            \"externalHeatupDetection\": s.getBoolean(",
            "                [\"serial\", \"externalHeatupDetection\"]",
            "            ),",
            "            \"ignoreIdenticalResends\": s.getBoolean([\"serial\", \"ignoreIdenticalResends\"]),",
            "            \"firmwareDetection\": s.getBoolean([\"serial\", \"firmwareDetection\"]),",
            "            \"blockWhileDwelling\": s.getBoolean([\"serial\", \"blockWhileDwelling\"]),",
            "            \"useParityWorkaround\": s.get([\"serial\", \"useParityWorkaround\"]),",
            "            \"sanityCheckTools\": s.getBoolean([\"serial\", \"sanityCheckTools\"]),",
            "            \"notifySuppressedCommands\": s.get([\"serial\", \"notifySuppressedCommands\"]),",
            "            \"sendM112OnError\": s.getBoolean([\"serial\", \"sendM112OnError\"]),",
            "            \"disableSdPrintingDetection\": s.getBoolean(",
            "                [\"serial\", \"disableSdPrintingDetection\"]",
            "            ),",
            "            \"ackMax\": s.getInt([\"serial\", \"ackMax\"]),",
            "            \"maxTimeoutsIdle\": s.getInt([\"serial\", \"maxCommunicationTimeouts\", \"idle\"]),",
            "            \"maxTimeoutsPrinting\": s.getInt(",
            "                [\"serial\", \"maxCommunicationTimeouts\", \"printing\"]",
            "            ),",
            "            \"maxTimeoutsLong\": s.getInt([\"serial\", \"maxCommunicationTimeouts\", \"long\"]),",
            "            \"capAutoreportTemp\": s.getBoolean(",
            "                [\"serial\", \"capabilities\", \"autoreport_temp\"]",
            "            ),",
            "            \"capAutoreportSdStatus\": s.getBoolean(",
            "                [\"serial\", \"capabilities\", \"autoreport_sdstatus\"]",
            "            ),",
            "            \"capAutoreportPos\": s.getBoolean(",
            "                [\"serial\", \"capabilities\", \"autoreport_pos\"]",
            "            ),",
            "            \"capBusyProtocol\": s.getBoolean([\"serial\", \"capabilities\", \"busy_protocol\"]),",
            "            \"capEmergencyParser\": s.getBoolean(",
            "                [\"serial\", \"capabilities\", \"emergency_parser\"]",
            "            ),",
            "            \"capExtendedM20\": s.getBoolean([\"serial\", \"capabilities\", \"extended_m20\"]),",
            "            \"capLfnWrite\": s.getBoolean([\"serial\", \"capabilities\", \"lfn_write\"]),",
            "            \"resendRatioThreshold\": s.getInt([\"serial\", \"resendRatioThreshold\"]),",
            "            \"resendRatioStart\": s.getInt([\"serial\", \"resendRatioStart\"]),",
            "            \"ignoreEmptyPorts\": s.getBoolean([\"serial\", \"ignoreEmptyPorts\"]),",
            "            \"encoding\": s.get([\"serial\", \"encoding\"]),",
            "            \"enableShutdownActionCommand\": s.get(",
            "                [\"serial\", \"enableShutdownActionCommand\"]",
            "            ),",
            "        },",
            "        \"folder\": {",
            "            \"uploads\": s.getBaseFolder(\"uploads\"),",
            "            \"timelapse\": s.getBaseFolder(\"timelapse\"),",
            "            \"watched\": s.getBaseFolder(\"watched\"),",
            "        },",
            "        \"temperature\": {",
            "            \"profiles\": s.get([\"temperature\", \"profiles\"]),",
            "            \"cutoff\": s.getInt([\"temperature\", \"cutoff\"]),",
            "            \"sendAutomatically\": s.getBoolean([\"temperature\", \"sendAutomatically\"]),",
            "            \"sendAutomaticallyAfter\": s.getInt(",
            "                [\"temperature\", \"sendAutomaticallyAfter\"], min=0, max=30",
            "            ),",
            "        },",
            "        \"system\": {",
            "            \"actions\": s.get([\"system\", \"actions\"]),",
            "            \"events\": s.get([\"system\", \"events\"]),",
            "        },",
            "        \"terminalFilters\": s.get([\"terminalFilters\"]),",
            "        \"scripts\": {",
            "            \"gcode\": {",
            "                \"afterPrinterConnected\": None,",
            "                \"beforePrinterDisconnected\": None,",
            "                \"beforePrintStarted\": None,",
            "                \"afterPrintCancelled\": None,",
            "                \"afterPrintDone\": None,",
            "                \"beforePrintPaused\": None,",
            "                \"afterPrintResumed\": None,",
            "                \"beforeToolChange\": None,",
            "                \"afterToolChange\": None,",
            "                \"snippets\": {},",
            "            }",
            "        },",
            "        \"server\": {",
            "            \"commands\": {",
            "                \"systemShutdownCommand\": s.get(",
            "                    [\"server\", \"commands\", \"systemShutdownCommand\"]",
            "                ),",
            "                \"systemRestartCommand\": s.get(",
            "                    [\"server\", \"commands\", \"systemRestartCommand\"]",
            "                ),",
            "                \"serverRestartCommand\": s.get(",
            "                    [\"server\", \"commands\", \"serverRestartCommand\"]",
            "                ),",
            "            },",
            "            \"diskspace\": {",
            "                \"warning\": s.getInt([\"server\", \"diskspace\", \"warning\"]),",
            "                \"critical\": s.getInt([\"server\", \"diskspace\", \"critical\"]),",
            "            },",
            "            \"onlineCheck\": {",
            "                \"enabled\": s.getBoolean([\"server\", \"onlineCheck\", \"enabled\"]),",
            "                \"interval\": int(s.getInt([\"server\", \"onlineCheck\", \"interval\"]) / 60),",
            "                \"host\": s.get([\"server\", \"onlineCheck\", \"host\"]),",
            "                \"port\": s.getInt([\"server\", \"onlineCheck\", \"port\"]),",
            "                \"name\": s.get([\"server\", \"onlineCheck\", \"name\"]),",
            "            },",
            "            \"pluginBlacklist\": {",
            "                \"enabled\": s.getBoolean([\"server\", \"pluginBlacklist\", \"enabled\"]),",
            "                \"url\": s.get([\"server\", \"pluginBlacklist\", \"url\"]),",
            "                \"ttl\": int(s.getInt([\"server\", \"pluginBlacklist\", \"ttl\"]) / 60),",
            "            },",
            "            \"allowFraming\": s.getBoolean([\"server\", \"allowFraming\"]),",
            "        },",
            "        \"devel\": {\"pluginTimings\": s.getBoolean([\"devel\", \"pluginTimings\"])},",
            "        \"slicing\": {\"defaultSlicer\": s.get([\"slicing\", \"defaultSlicer\"])},",
            "    }",
            "",
            "    gcode_scripts = s.listScripts(\"gcode\")",
            "    if gcode_scripts:",
            "        data[\"scripts\"] = {\"gcode\": {}}",
            "        for name in gcode_scripts:",
            "            data[\"scripts\"][\"gcode\"][name] = s.loadScript(\"gcode\", name, source=True)",
            "",
            "    plugin_settings = _get_plugin_settings()",
            "    if len(plugin_settings):",
            "        data[\"plugins\"] = plugin_settings",
            "",
            "    if Permissions.WEBCAM.can() or (",
            "        settings().getBoolean([\"server\", \"firstRun\"])",
            "        and not userManager.has_been_customized()",
            "    ):",
            "        webcamsDict = get_webcams_as_dicts()",
            "        data[\"webcam\"] = {",
            "            \"webcamEnabled\": s.getBoolean([\"webcam\", \"webcamEnabled\"]),",
            "            \"timelapseEnabled\": s.getBoolean([\"webcam\", \"timelapseEnabled\"]),",
            "            \"ffmpegPath\": s.get([\"webcam\", \"ffmpeg\"]),",
            "            \"ffmpegCommandline\": s.get([\"webcam\", \"ffmpegCommandline\"]),",
            "            \"bitrate\": s.get([\"webcam\", \"bitrate\"]),",
            "            \"ffmpegThreads\": s.get([\"webcam\", \"ffmpegThreads\"]),",
            "            \"ffmpegVideoCodec\": s.get([\"webcam\", \"ffmpegVideoCodec\"]),",
            "            \"watermark\": s.getBoolean([\"webcam\", \"watermark\"]),",
            "            # webcams & defaults",
            "            \"webcams\": webcamsDict,",
            "            \"defaultWebcam\": None,",
            "            \"snapshotWebcam\": None,",
            "        }",
            "",
            "        for key in DEPRECATED_WEBCAM_KEYS:",
            "            data[\"webcam\"][key] = None",
            "",
            "        defaultWebcam = get_default_webcam()",
            "        if defaultWebcam:",
            "            data[\"webcam\"].update(",
            "                {",
            "                    \"flipH\": defaultWebcam.config.flipH,",
            "                    \"flipV\": defaultWebcam.config.flipV,",
            "                    \"rotate90\": defaultWebcam.config.rotate90,",
            "                    \"defaultWebcam\": defaultWebcam.config.name,",
            "                }",
            "            )",
            "",
            "        compatWebcam = defaultWebcam.config.compat if defaultWebcam is not None else None",
            "        if compatWebcam:",
            "            data[\"webcam\"].update(",
            "                {",
            "                    \"streamUrl\": compatWebcam.stream,",
            "                    \"streamRatio\": compatWebcam.streamRatio,",
            "                    \"streamTimeout\": compatWebcam.streamTimeout,",
            "                    \"streamWebrtcIceServers\": compatWebcam.streamWebrtcIceServers,",
            "                    \"snapshotUrl\": compatWebcam.snapshot,",
            "                    \"snapshotTimeout\": compatWebcam.snapshotTimeout,",
            "                    \"snapshotSslValidation\": compatWebcam.snapshotSslValidation,",
            "                    \"cacheBuster\": compatWebcam.cacheBuster,",
            "                }",
            "            )",
            "",
            "        snapshotWebcam = get_snapshot_webcam()",
            "        if snapshotWebcam:",
            "            data[\"webcam\"].update(",
            "                {",
            "                    \"snapshotWebcam\": snapshotWebcam.config.name,",
            "                }",
            "            )",
            "    else:",
            "        data[\"webcam\"] = {}",
            "",
            "    if Permissions.ADMIN.can():",
            "        data[\"accessControl\"] = {",
            "            \"autologinLocal\": s.getBoolean([\"accessControl\", \"autologinLocal\"]),",
            "            \"autologinHeadsupAcknowledged\": s.getBoolean(",
            "                [\"accessControl\", \"autologinHeadsupAcknowledged\"]",
            "            ),",
            "        }",
            "",
            "    return jsonify(data)",
            "",
            "",
            "def _get_plugin_settings():",
            "    logger = logging.getLogger(__name__)",
            "",
            "    data = {}",
            "",
            "    def process_plugin_result(name, result):",
            "        if result:",
            "            try:",
            "                jsonify(test=result)",
            "            except Exception:",
            "                logger.exception(",
            "                    \"Error while jsonifying settings from plugin {}, please contact the plugin author about this\".format(",
            "                        name",
            "                    )",
            "                )",
            "                raise",
            "            else:",
            "                if \"__enabled\" in result:",
            "                    del result[\"__enabled\"]",
            "                data[name] = result",
            "",
            "    for plugin in octoprint.plugin.plugin_manager().get_implementations(",
            "        octoprint.plugin.SettingsPlugin",
            "    ):",
            "        try:",
            "            result = plugin.on_settings_load()",
            "            process_plugin_result(plugin._identifier, result)",
            "        except Exception:",
            "            logger.exception(",
            "                \"Could not load settings for plugin {name} ({version})\".format(",
            "                    version=plugin._plugin_version, name=plugin._plugin_name",
            "                ),",
            "                extra={\"plugin\": plugin._identifier},",
            "            )",
            "",
            "    return data",
            "",
            "",
            "@api.route(\"/settings\", methods=[\"POST\"])",
            "@no_firstrun_access",
            "@Permissions.SETTINGS.require(403)",
            "def setSettings():",
            "    data = request.get_json()",
            "    if not isinstance(data, dict):",
            "        abort(400, description=\"Malformed JSON body in request\")",
            "",
            "    response = _saveSettings(data)",
            "    if response:",
            "        return response",
            "    return getSettings()",
            "",
            "",
            "@api.route(\"/settings/apikey\", methods=[\"POST\"])",
            "@no_firstrun_access",
            "@Permissions.ADMIN.require(403)",
            "def generateApiKey():",
            "    apikey = settings().generateApiKey()",
            "    return jsonify(apikey=apikey)",
            "",
            "",
            "@api.route(\"/settings/apikey\", methods=[\"DELETE\"])",
            "@no_firstrun_access",
            "@Permissions.ADMIN.require(403)",
            "def deleteApiKey():",
            "    settings().deleteApiKey()",
            "    return NO_CONTENT",
            "",
            "",
            "@api.route(\"/settings/templates\", methods=[\"GET\"])",
            "@no_firstrun_access",
            "@Permissions.SETTINGS.require(403)",
            "def fetchTemplateData():",
            "    from octoprint.server.views import fetch_template_data",
            "",
            "    refresh = request.values.get(\"refresh\", \"false\") in valid_boolean_trues",
            "    templates, _, _ = fetch_template_data(refresh=refresh)",
            "",
            "    result = {}",
            "    for tt in templates:",
            "        result[tt] = []",
            "        for key in templates[tt][\"order\"]:",
            "            entry = templates[tt][\"entries\"].get(key)",
            "            if not entry:",
            "                continue",
            "",
            "            if isinstance(entry, dict):",
            "                name = key",
            "            else:",
            "                name, entry = entry",
            "",
            "            data = {\"id\": key, \"name\": name}",
            "",
            "            if entry and \"_plugin\" in entry:",
            "                plugin = pluginManager.get_plugin_info(",
            "                    entry[\"_plugin\"], require_enabled=False",
            "                )",
            "                data[\"plugin_id\"] = plugin.key",
            "                data[\"plugin_name\"] = plugin.name",
            "",
            "            result[tt].append(data)",
            "",
            "    return jsonify(order=result)",
            "",
            "",
            "def _saveSettings(data):",
            "    logger = logging.getLogger(__name__)",
            "",
            "    s = settings()",
            "",
            "    # NOTE: Remember to adjust the docs of the data model on the Settings API if anything",
            "    # is changed, added or removed here",
            "",
            "    if \"folder\" in data:",
            "        try:",
            "            folders = data[\"folder\"]",
            "            future = {}",
            "            for folder in FOLDER_TYPES:",
            "                future[folder] = s.getBaseFolder(folder)",
            "                if folder in folders:",
            "                    future[folder] = folders[folder]",
            "",
            "            for folder in folders:",
            "                if folder not in FOLDER_TYPES:",
            "                    continue",
            "                for other_folder in FOLDER_TYPES:",
            "                    if folder == other_folder:",
            "                        continue",
            "                    if future[folder] == future[other_folder]:",
            "                        # duplicate detected, raise",
            "                        raise ValueError(",
            "                            \"Duplicate folder path for {} and {}\".format(",
            "                                folder, other_folder",
            "                            )",
            "                        )",
            "",
            "                s.setBaseFolder(folder, future[folder])",
            "        except Exception:",
            "            logger.exception(\"Something went wrong while saving a folder path\")",
            "            abort(400, description=\"At least one of the configured folders is invalid\")",
            "",
            "    if \"api\" in data:",
            "        if \"allowCrossOrigin\" in data[\"api\"]:",
            "            s.setBoolean([\"api\", \"allowCrossOrigin\"], data[\"api\"][\"allowCrossOrigin\"])",
            "",
            "    if \"accessControl\" in data:",
            "        if \"autologinHeadsupAcknowledged\" in data[\"accessControl\"]:",
            "            s.setBoolean(",
            "                [\"accessControl\", \"autologinHeadsupAcknowledged\"],",
            "                data[\"accessControl\"][\"autologinHeadsupAcknowledged\"],",
            "            )",
            "",
            "    if \"appearance\" in data:",
            "        if \"name\" in data[\"appearance\"]:",
            "            s.set([\"appearance\", \"name\"], data[\"appearance\"][\"name\"])",
            "        if \"color\" in data[\"appearance\"]:",
            "            s.set([\"appearance\", \"color\"], data[\"appearance\"][\"color\"])",
            "        if \"colorTransparent\" in data[\"appearance\"]:",
            "            s.setBoolean(",
            "                [\"appearance\", \"colorTransparent\"], data[\"appearance\"][\"colorTransparent\"]",
            "            )",
            "        if \"colorIcon\" in data[\"appearance\"]:",
            "            s.setBoolean([\"appearance\", \"colorIcon\"], data[\"appearance\"][\"colorIcon\"])",
            "        if \"defaultLanguage\" in data[\"appearance\"]:",
            "            s.set(",
            "                [\"appearance\", \"defaultLanguage\"], data[\"appearance\"][\"defaultLanguage\"]",
            "            )",
            "        if \"showFahrenheitAlso\" in data[\"appearance\"]:",
            "            s.setBoolean(",
            "                [\"appearance\", \"showFahrenheitAlso\"],",
            "                data[\"appearance\"][\"showFahrenheitAlso\"],",
            "            )",
            "        if \"fuzzyTimes\" in data[\"appearance\"]:",
            "            s.setBoolean([\"appearance\", \"fuzzyTimes\"], data[\"appearance\"][\"fuzzyTimes\"])",
            "        if \"closeModalsWithClick\" in data[\"appearance\"]:",
            "            s.setBoolean(",
            "                [\"appearance\", \"closeModalsWithClick\"],",
            "                data[\"appearance\"][\"closeModalsWithClick\"],",
            "            )",
            "        if \"showInternalFilename\" in data[\"appearance\"]:",
            "            s.setBoolean(",
            "                [\"appearance\", \"showInternalFilename\"],",
            "                data[\"appearance\"][\"showInternalFilename\"],",
            "            )",
            "",
            "    if \"printer\" in data:",
            "        if \"defaultExtrusionLength\" in data[\"printer\"]:",
            "            s.setInt(",
            "                [\"printerParameters\", \"defaultExtrusionLength\"],",
            "                data[\"printer\"][\"defaultExtrusionLength\"],",
            "            )",
            "",
            "    if \"webcam\" in data:",
            "        for key in DEPRECATED_WEBCAM_KEYS:",
            "            if key in data[\"webcam\"]:",
            "                logger.warning(",
            "                    f\"Setting webcam.{key} via the API is no longer supported, please use the individual settings of the default webcam instead.\"",
            "                )",
            "",
            "        if \"webcamEnabled\" in data[\"webcam\"]:",
            "            s.setBoolean([\"webcam\", \"webcamEnabled\"], data[\"webcam\"][\"webcamEnabled\"])",
            "        if \"timelapseEnabled\" in data[\"webcam\"]:",
            "            s.setBoolean(",
            "                [\"webcam\", \"timelapseEnabled\"], data[\"webcam\"][\"timelapseEnabled\"]",
            "            )",
            "        if \"snapshotTimeout\" in data[\"webcam\"]:",
            "            s.setInt([\"webcam\", \"snapshotTimeout\"], data[\"webcam\"][\"snapshotTimeout\"])",
            "        if \"snapshotSslValidation\" in data[\"webcam\"]:",
            "            s.setBoolean(",
            "                [\"webcam\", \"snapshotSslValidation\"],",
            "                data[\"webcam\"][\"snapshotSslValidation\"],",
            "            )",
            "        if \"ffmpegPath\" in data[\"webcam\"]:",
            "            s.set([\"webcam\", \"ffmpeg\"], data[\"webcam\"][\"ffmpegPath\"])",
            "        if \"ffmpegCommandline\" in data[\"webcam\"]:",
            "            commandline = data[\"webcam\"][\"ffmpegCommandline\"]",
            "            if not all(",
            "                map(lambda x: \"{\" + x + \"}\" in commandline, (\"ffmpeg\", \"input\", \"output\"))",
            "            ):",
            "                abort(",
            "                    400,",
            "                    description=\"Invalid webcam.ffmpegCommandline setting, lacks mandatory {ffmpeg}, {input} or {output}\",",
            "                )",
            "            try:",
            "                commandline.format(",
            "                    ffmpeg=\"ffmpeg\",",
            "                    fps=\"fps\",",
            "                    bitrate=\"bitrate\",",
            "                    threads=\"threads\",",
            "                    input=\"input\",",
            "                    output=\"output\",",
            "                    videocodec=\"videocodec\",",
            "                    containerformat=\"containerformat\",",
            "                    filters=\"filters\",",
            "                )",
            "            except Exception:",
            "                # some invalid data we'll refuse to set",
            "                logger.exception(\"Invalid webcam.ffmpegCommandline setting\")",
            "                abort(400, description=\"Invalid webcam.ffmpegCommandline setting\")",
            "            else:",
            "                s.set([\"webcam\", \"ffmpegCommandline\"], commandline)",
            "        if \"bitrate\" in data[\"webcam\"] and data[\"webcam\"][\"bitrate\"]:",
            "            bitrate = str(data[\"webcam\"][\"bitrate\"])",
            "            if not TIMELAPSE_BITRATE_PATTERN.match(bitrate):",
            "                abort(",
            "                    400,",
            "                    description=\"Invalid webcam.bitrate setting, needs to be a valid ffmpeg bitrate\",",
            "                )",
            "            s.set([\"webcam\", \"bitrate\"], bitrate)",
            "        if \"ffmpegThreads\" in data[\"webcam\"]:",
            "            s.setInt([\"webcam\", \"ffmpegThreads\"], data[\"webcam\"][\"ffmpegThreads\"])",
            "        if \"ffmpegVideoCodec\" in data[\"webcam\"] and data[\"webcam\"][",
            "            \"ffmpegVideoCodec\"",
            "        ] in (\"mpeg2video\", \"libx264\"):",
            "            s.set([\"webcam\", \"ffmpegVideoCodec\"], data[\"webcam\"][\"ffmpegVideoCodec\"])",
            "        if \"watermark\" in data[\"webcam\"]:",
            "            s.setBoolean([\"webcam\", \"watermark\"], data[\"webcam\"][\"watermark\"])",
            "        if \"defaultWebcam\" in data[\"webcam\"]:",
            "            s.set([\"webcam\", \"defaultWebcam\"], data[\"webcam\"][\"defaultWebcam\"])",
            "        if \"snapshotWebcam\" in data[\"webcam\"]:",
            "            s.set([\"webcam\", \"snapshotWebcam\"], data[\"webcam\"][\"snapshotWebcam\"])",
            "",
            "            # timelapse needs to be reconfigured now since it depends on the current snapshot webcam",
            "            configure_timelapse()",
            "",
            "    if \"feature\" in data:",
            "        if \"temperatureGraph\" in data[\"feature\"]:",
            "            s.setBoolean(",
            "                [\"feature\", \"temperatureGraph\"], data[\"feature\"][\"temperatureGraph\"]",
            "            )",
            "        if \"sdSupport\" in data[\"feature\"]:",
            "            s.setBoolean([\"feature\", \"sdSupport\"], data[\"feature\"][\"sdSupport\"])",
            "        if \"keyboardControl\" in data[\"feature\"]:",
            "            s.setBoolean(",
            "                [\"feature\", \"keyboardControl\"], data[\"feature\"][\"keyboardControl\"]",
            "            )",
            "        if \"pollWatched\" in data[\"feature\"]:",
            "            s.setBoolean([\"feature\", \"pollWatched\"], data[\"feature\"][\"pollWatched\"])",
            "        if \"modelSizeDetection\" in data[\"feature\"]:",
            "            s.setBoolean(",
            "                [\"feature\", \"modelSizeDetection\"], data[\"feature\"][\"modelSizeDetection\"]",
            "            )",
            "        if \"rememberFileFolder\" in data[\"feature\"]:",
            "            s.setBoolean(",
            "                [\"feature\", \"rememberFileFolder\"],",
            "                data[\"feature\"][\"rememberFileFolder\"],",
            "            )",
            "        if \"printStartConfirmation\" in data[\"feature\"]:",
            "            s.setBoolean(",
            "                [\"feature\", \"printStartConfirmation\"],",
            "                data[\"feature\"][\"printStartConfirmation\"],",
            "            )",
            "        if \"printCancelConfirmation\" in data[\"feature\"]:",
            "            s.setBoolean(",
            "                [\"feature\", \"printCancelConfirmation\"],",
            "                data[\"feature\"][\"printCancelConfirmation\"],",
            "            )",
            "        if \"uploadOverwriteConfirmation\" in data[\"feature\"]:",
            "            s.setBoolean(",
            "                [\"feature\", \"uploadOverwriteConfirmation\"],",
            "                data[\"feature\"][\"uploadOverwriteConfirmation\"],",
            "            )",
            "        if \"g90InfluencesExtruder\" in data[\"feature\"]:",
            "            s.setBoolean(",
            "                [\"feature\", \"g90InfluencesExtruder\"],",
            "                data[\"feature\"][\"g90InfluencesExtruder\"],",
            "            )",
            "        if \"autoUppercaseBlacklist\" in data[\"feature\"] and isinstance(",
            "            data[\"feature\"][\"autoUppercaseBlacklist\"], (list, tuple)",
            "        ):",
            "            s.set(",
            "                [\"feature\", \"autoUppercaseBlacklist\"],",
            "                data[\"feature\"][\"autoUppercaseBlacklist\"],",
            "            )",
            "        if \"enableDragDropUpload\" in data[\"feature\"]:",
            "            s.setBoolean(",
            "                [\"feature\", \"enableDragDropUpload\"],",
            "                data[\"feature\"][\"enableDragDropUpload\"],",
            "            )",
            "",
            "    if \"gcodeAnalysis\" in data:",
            "        if \"runAt\" in data[\"gcodeAnalysis\"]:",
            "            s.set([\"gcodeAnalysis\", \"runAt\"], data[\"gcodeAnalysis\"][\"runAt\"])",
            "        if \"bedZ\" in data[\"gcodeAnalysis\"]:",
            "            s.setFloat([\"gcodeAnalysis\", \"bedZ\"], data[\"gcodeAnalysis\"][\"bedZ\"])",
            "",
            "    if \"serial\" in data:",
            "        if \"autoconnect\" in data[\"serial\"]:",
            "            s.setBoolean([\"serial\", \"autoconnect\"], data[\"serial\"][\"autoconnect\"])",
            "        if \"port\" in data[\"serial\"]:",
            "            s.set([\"serial\", \"port\"], data[\"serial\"][\"port\"])",
            "        if \"baudrate\" in data[\"serial\"]:",
            "            s.setInt([\"serial\", \"baudrate\"], data[\"serial\"][\"baudrate\"])",
            "        if \"exclusive\" in data[\"serial\"]:",
            "            s.setBoolean([\"serial\", \"exclusive\"], data[\"serial\"][\"exclusive\"])",
            "        if \"lowLatency\" in data[\"serial\"]:",
            "            s.setBoolean([\"serial\", \"lowLatency\"], data[\"serial\"][\"lowLatency\"])",
            "        if \"timeoutConnection\" in data[\"serial\"]:",
            "            s.setFloat(",
            "                [\"serial\", \"timeout\", \"connection\"],",
            "                data[\"serial\"][\"timeoutConnection\"],",
            "                min=1.0,",
            "            )",
            "        if \"timeoutDetectionFirst\" in data[\"serial\"]:",
            "            s.setFloat(",
            "                [\"serial\", \"timeout\", \"detectionFirst\"],",
            "                data[\"serial\"][\"timeoutDetectionFirst\"],",
            "                min=1.0,",
            "            )",
            "        if \"timeoutDetectionConsecutive\" in data[\"serial\"]:",
            "            s.setFloat(",
            "                [\"serial\", \"timeout\", \"detectionConsecutive\"],",
            "                data[\"serial\"][\"timeoutDetectionConsecutive\"],",
            "                min=1.0,",
            "            )",
            "        if \"timeoutCommunication\" in data[\"serial\"]:",
            "            s.setFloat(",
            "                [\"serial\", \"timeout\", \"communication\"],",
            "                data[\"serial\"][\"timeoutCommunication\"],",
            "                min=1.0,",
            "            )",
            "        if \"timeoutCommunicationBusy\" in data[\"serial\"]:",
            "            s.setFloat(",
            "                [\"serial\", \"timeout\", \"communicationBusy\"],",
            "                data[\"serial\"][\"timeoutCommunicationBusy\"],",
            "                min=1.0,",
            "            )",
            "        if \"timeoutTemperature\" in data[\"serial\"]:",
            "            s.setFloat(",
            "                [\"serial\", \"timeout\", \"temperature\"],",
            "                data[\"serial\"][\"timeoutTemperature\"],",
            "                min=1.0,",
            "            )",
            "        if \"timeoutTemperatureTargetSet\" in data[\"serial\"]:",
            "            s.setFloat(",
            "                [\"serial\", \"timeout\", \"temperatureTargetSet\"],",
            "                data[\"serial\"][\"timeoutTemperatureTargetSet\"],",
            "                min=1.0,",
            "            )",
            "        if \"timeoutTemperatureAutoreport\" in data[\"serial\"]:",
            "            s.setFloat(",
            "                [\"serial\", \"timeout\", \"temperatureAutoreport\"],",
            "                data[\"serial\"][\"timeoutTemperatureAutoreport\"],",
            "                min=0.0,",
            "            )",
            "        if \"timeoutSdStatus\" in data[\"serial\"]:",
            "            s.setFloat(",
            "                [\"serial\", \"timeout\", \"sdStatus\"],",
            "                data[\"serial\"][\"timeoutSdStatus\"],",
            "                min=1.0,",
            "            )",
            "        if \"timeoutSdStatusAutoreport\" in data[\"serial\"]:",
            "            s.setFloat(",
            "                [\"serial\", \"timeout\", \"sdStatusAutoreport\"],",
            "                data[\"serial\"][\"timeoutSdStatusAutoreport\"],",
            "                min=0.0,",
            "            )",
            "        if \"timeoutPosAutoreport\" in data[\"serial\"]:",
            "            s.setFloat(",
            "                [\"serial\", \"timeout\", \"posAutoreport\"],",
            "                data[\"serial\"][\"timeoutPosAutoreport\"],",
            "                min=0.0,",
            "            )",
            "        if \"timeoutBaudrateDetectionPause\" in data[\"serial\"]:",
            "            s.setFloat(",
            "                [\"serial\", \"timeout\", \"baudrateDetectionPause\"],",
            "                data[\"serial\"][\"timeoutBaudrateDetectionPause\"],",
            "                min=0.0,",
            "            )",
            "        if \"timeoutPositionLogWait\" in data[\"serial\"]:",
            "            s.setFloat(",
            "                [\"serial\", \"timeout\", \"positionLogWait\"],",
            "                data[\"serial\"][\"timeoutPositionLogWait\"],",
            "                min=1.0,",
            "            )",
            "        if \"additionalPorts\" in data[\"serial\"] and isinstance(",
            "            data[\"serial\"][\"additionalPorts\"], (list, tuple)",
            "        ):",
            "            s.set([\"serial\", \"additionalPorts\"], data[\"serial\"][\"additionalPorts\"])",
            "        if \"additionalBaudrates\" in data[\"serial\"] and isinstance(",
            "            data[\"serial\"][\"additionalBaudrates\"], (list, tuple)",
            "        ):",
            "            s.set(",
            "                [\"serial\", \"additionalBaudrates\"], data[\"serial\"][\"additionalBaudrates\"]",
            "            )",
            "        if \"blacklistedPorts\" in data[\"serial\"] and isinstance(",
            "            data[\"serial\"][\"blacklistedPorts\"], (list, tuple)",
            "        ):",
            "            s.set([\"serial\", \"blacklistedPorts\"], data[\"serial\"][\"blacklistedPorts\"])",
            "        if \"blacklistedBaudrates\" in data[\"serial\"] and isinstance(",
            "            data[\"serial\"][\"blacklistedBaudrates\"], (list, tuple)",
            "        ):",
            "            s.set(",
            "                [\"serial\", \"blacklistedBaudrates\"], data[\"serial\"][\"blacklistedBaudrates\"]",
            "            )",
            "        if \"longRunningCommands\" in data[\"serial\"] and isinstance(",
            "            data[\"serial\"][\"longRunningCommands\"], (list, tuple)",
            "        ):",
            "            s.set(",
            "                [\"serial\", \"longRunningCommands\"], data[\"serial\"][\"longRunningCommands\"]",
            "            )",
            "        if \"checksumRequiringCommands\" in data[\"serial\"] and isinstance(",
            "            data[\"serial\"][\"checksumRequiringCommands\"], (list, tuple)",
            "        ):",
            "            s.set(",
            "                [\"serial\", \"checksumRequiringCommands\"],",
            "                data[\"serial\"][\"checksumRequiringCommands\"],",
            "            )",
            "        if \"blockedCommands\" in data[\"serial\"] and isinstance(",
            "            data[\"serial\"][\"blockedCommands\"], (list, tuple)",
            "        ):",
            "            s.set([\"serial\", \"blockedCommands\"], data[\"serial\"][\"blockedCommands\"])",
            "        if \"ignoredCommands\" in data[\"serial\"] and isinstance(",
            "            data[\"serial\"][\"ignoredCommands\"], (list, tuple)",
            "        ):",
            "            s.set([\"serial\", \"ignoredCommands\"], data[\"serial\"][\"ignoredCommands\"])",
            "        if \"pausingCommands\" in data[\"serial\"] and isinstance(",
            "            data[\"serial\"][\"pausingCommands\"], (list, tuple)",
            "        ):",
            "            s.set([\"serial\", \"pausingCommands\"], data[\"serial\"][\"pausingCommands\"])",
            "        if \"sdCancelCommand\" in data[\"serial\"]:",
            "            s.set([\"serial\", \"sdCancelCommand\"], data[\"serial\"][\"sdCancelCommand\"])",
            "        if \"emergencyCommands\" in data[\"serial\"] and isinstance(",
            "            data[\"serial\"][\"emergencyCommands\"], (list, tuple)",
            "        ):",
            "            s.set([\"serial\", \"emergencyCommands\"], data[\"serial\"][\"emergencyCommands\"])",
            "        if \"helloCommand\" in data[\"serial\"]:",
            "            s.set([\"serial\", \"helloCommand\"], data[\"serial\"][\"helloCommand\"])",
            "        if \"ignoreErrorsFromFirmware\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"ignoreErrorsFromFirmware\"],",
            "                data[\"serial\"][\"ignoreErrorsFromFirmware\"],",
            "            )",
            "        if \"disconnectOnErrors\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"disconnectOnErrors\"], data[\"serial\"][\"disconnectOnErrors\"]",
            "            )",
            "        if \"triggerOkForM29\" in data[\"serial\"]:",
            "            s.setBoolean([\"serial\", \"triggerOkForM29\"], data[\"serial\"][\"triggerOkForM29\"])",
            "        if \"supportResendsWithoutOk\" in data[\"serial\"]:",
            "            value = data[\"serial\"][\"supportResendsWithoutOk\"]",
            "            if value in (\"always\", \"detect\", \"never\"):",
            "                s.set([\"serial\", \"supportResendsWithoutOk\"], value)",
            "        if \"waitForStart\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"waitForStartOnConnect\"], data[\"serial\"][\"waitForStart\"]",
            "            )",
            "        if \"waitToLoadSdFileList\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"waitToLoadSdFileList\"],",
            "                data[\"serial\"][\"waitToLoadSdFileList\"],",
            "            )",
            "        if \"alwaysSendChecksum\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"alwaysSendChecksum\"], data[\"serial\"][\"alwaysSendChecksum\"]",
            "            )",
            "        if \"neverSendChecksum\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"neverSendChecksum\"], data[\"serial\"][\"neverSendChecksum\"]",
            "            )",
            "        if \"sendChecksumWithUnknownCommands\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"sendChecksumWithUnknownCommands\"],",
            "                data[\"serial\"][\"sendChecksumWithUnknownCommands\"],",
            "            )",
            "        if \"unknownCommandsNeedAck\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"unknownCommandsNeedAck\"],",
            "                data[\"serial\"][\"unknownCommandsNeedAck\"],",
            "            )",
            "        if \"sdRelativePath\" in data[\"serial\"]:",
            "            s.setBoolean([\"serial\", \"sdRelativePath\"], data[\"serial\"][\"sdRelativePath\"])",
            "        if \"sdAlwaysAvailable\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"sdAlwaysAvailable\"], data[\"serial\"][\"sdAlwaysAvailable\"]",
            "            )",
            "        if \"sdLowerCase\" in data[\"serial\"]:",
            "            s.setBoolean([\"serial\", \"sdLowerCase\"], data[\"serial\"][\"sdLowerCase\"])",
            "        if \"swallowOkAfterResend\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"swallowOkAfterResend\"], data[\"serial\"][\"swallowOkAfterResend\"]",
            "            )",
            "        if \"repetierTargetTemp\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"repetierTargetTemp\"], data[\"serial\"][\"repetierTargetTemp\"]",
            "            )",
            "        if \"externalHeatupDetection\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"externalHeatupDetection\"],",
            "                data[\"serial\"][\"externalHeatupDetection\"],",
            "            )",
            "        if \"ignoreIdenticalResends\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"ignoreIdenticalResends\"],",
            "                data[\"serial\"][\"ignoreIdenticalResends\"],",
            "            )",
            "        if \"firmwareDetection\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"firmwareDetection\"], data[\"serial\"][\"firmwareDetection\"]",
            "            )",
            "        if \"blockWhileDwelling\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"blockWhileDwelling\"], data[\"serial\"][\"blockWhileDwelling\"]",
            "            )",
            "        if \"useParityWorkaround\" in data[\"serial\"]:",
            "            value = data[\"serial\"][\"useParityWorkaround\"]",
            "            if value in (\"always\", \"detect\", \"never\"):",
            "                s.set([\"serial\", \"useParityWorkaround\"], value)",
            "        if \"sanityCheckTools\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"sanityCheckTools\"], data[\"serial\"][\"sanityCheckTools\"]",
            "            )",
            "        if \"notifySuppressedCommands\" in data[\"serial\"]:",
            "            value = data[\"serial\"][\"notifySuppressedCommands\"]",
            "            if value in (\"info\", \"warn\", \"never\"):",
            "                s.set([\"serial\", \"notifySuppressedCommands\"], value)",
            "        if \"sendM112OnError\" in data[\"serial\"]:",
            "            s.setBoolean([\"serial\", \"sendM112OnError\"], data[\"serial\"][\"sendM112OnError\"])",
            "        if \"disableSdPrintingDetection\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"disableSdPrintingDetection\"],",
            "                data[\"serial\"][\"disableSdPrintingDetection\"],",
            "            )",
            "        if \"ackMax\" in data[\"serial\"]:",
            "            s.setInt([\"serial\", \"ackMax\"], data[\"serial\"][\"ackMax\"])",
            "        if \"logPositionOnPause\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"logPositionOnPause\"], data[\"serial\"][\"logPositionOnPause\"]",
            "            )",
            "        if \"logPositionOnCancel\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"logPositionOnCancel\"], data[\"serial\"][\"logPositionOnCancel\"]",
            "            )",
            "        if \"abortHeatupOnCancel\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"abortHeatupOnCancel\"], data[\"serial\"][\"abortHeatupOnCancel\"]",
            "            )",
            "        if \"maxTimeoutsIdle\" in data[\"serial\"]:",
            "            s.setInt(",
            "                [\"serial\", \"maxCommunicationTimeouts\", \"idle\"],",
            "                data[\"serial\"][\"maxTimeoutsIdle\"],",
            "            )",
            "        if \"maxTimeoutsPrinting\" in data[\"serial\"]:",
            "            s.setInt(",
            "                [\"serial\", \"maxCommunicationTimeouts\", \"printing\"],",
            "                data[\"serial\"][\"maxTimeoutsPrinting\"],",
            "            )",
            "        if \"maxTimeoutsLong\" in data[\"serial\"]:",
            "            s.setInt(",
            "                [\"serial\", \"maxCommunicationTimeouts\", \"long\"],",
            "                data[\"serial\"][\"maxTimeoutsLong\"],",
            "            )",
            "        if \"capAutoreportTemp\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"capabilities\", \"autoreport_temp\"],",
            "                data[\"serial\"][\"capAutoreportTemp\"],",
            "            )",
            "        if \"capAutoreportSdStatus\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"capabilities\", \"autoreport_sdstatus\"],",
            "                data[\"serial\"][\"capAutoreportSdStatus\"],",
            "            )",
            "        if \"capAutoreportPos\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"capabilities\", \"autoreport_pos\"],",
            "                data[\"serial\"][\"capAutoreportPos\"],",
            "            )",
            "        if \"capBusyProtocol\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"capabilities\", \"busy_protocol\"],",
            "                data[\"serial\"][\"capBusyProtocol\"],",
            "            )",
            "        if \"capEmergencyParser\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"capabilities\", \"emergency_parser\"],",
            "                data[\"serial\"][\"capEmergencyParser\"],",
            "            )",
            "        if \"capExtendedM20\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"capabilities\", \"extended_m20\"],",
            "                data[\"serial\"][\"capExtendedM20\"],",
            "            ),",
            "        if \"capLfnWrite\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"capabilities\", \"lfn_write\"],",
            "                data[\"serial\"][\"capLfnWrite\"],",
            "            )",
            "        if \"resendRatioThreshold\" in data[\"serial\"]:",
            "            s.setInt(",
            "                [\"serial\", \"resendRatioThreshold\"], data[\"serial\"][\"resendRatioThreshold\"]",
            "            )",
            "        if \"resendRatioStart\" in data[\"serial\"]:",
            "            s.setInt([\"serial\", \"resendRatioStart\"], data[\"serial\"][\"resendRatioStart\"])",
            "        if \"ignoreEmptyPorts\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"ignoreEmptyPorts\"], data[\"serial\"][\"ignoreEmptyPorts\"]",
            "            )",
            "",
            "        if \"encoding\" in data[\"serial\"]:",
            "            s.set([\"serial\", \"encoding\"], data[\"serial\"][\"encoding\"])",
            "",
            "        if \"enableShutdownActionCommand\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"enableShutdownActionCommand\"],",
            "                data[\"serial\"][\"enableShutdownActionCommand\"],",
            "            )",
            "",
            "        oldLog = s.getBoolean([\"serial\", \"log\"])",
            "        if \"log\" in data[\"serial\"]:",
            "            s.setBoolean([\"serial\", \"log\"], data[\"serial\"][\"log\"])",
            "        if oldLog and not s.getBoolean([\"serial\", \"log\"]):",
            "            # disable debug logging to serial.log",
            "            logging.getLogger(\"SERIAL\").debug(\"Disabling serial logging\")",
            "            logging.getLogger(\"SERIAL\").setLevel(logging.CRITICAL)",
            "        elif not oldLog and s.getBoolean([\"serial\", \"log\"]):",
            "            # enable debug logging to serial.log",
            "            logging.getLogger(\"SERIAL\").setLevel(logging.DEBUG)",
            "            logging.getLogger(\"SERIAL\").debug(\"Enabling serial logging\")",
            "",
            "    if \"temperature\" in data:",
            "        if \"profiles\" in data[\"temperature\"]:",
            "            result = []",
            "            for profile in data[\"temperature\"][\"profiles\"]:",
            "                try:",
            "                    profile[\"bed\"] = int(profile[\"bed\"])",
            "                    profile[\"extruder\"] = int(profile[\"extruder\"])",
            "                except ValueError:",
            "                    pass",
            "                result.append(profile)",
            "            s.set([\"temperature\", \"profiles\"], result)",
            "        if \"cutoff\" in data[\"temperature\"]:",
            "            try:",
            "                cutoff = int(data[\"temperature\"][\"cutoff\"])",
            "                if cutoff > 1:",
            "                    s.setInt([\"temperature\", \"cutoff\"], cutoff)",
            "            except ValueError:",
            "                pass",
            "        if \"sendAutomatically\" in data[\"temperature\"]:",
            "            s.setBoolean(",
            "                [\"temperature\", \"sendAutomatically\"],",
            "                data[\"temperature\"][\"sendAutomatically\"],",
            "            )",
            "        if \"sendAutomaticallyAfter\" in data[\"temperature\"]:",
            "            s.setInt(",
            "                [\"temperature\", \"sendAutomaticallyAfter\"],",
            "                data[\"temperature\"][\"sendAutomaticallyAfter\"],",
            "                min=0,",
            "                max=30,",
            "            )",
            "",
            "    if \"terminalFilters\" in data:",
            "        s.set([\"terminalFilters\"], data[\"terminalFilters\"])",
            "",
            "    if \"system\" in data:",
            "        if \"actions\" in data[\"system\"]:",
            "            s.set([\"system\", \"actions\"], data[\"system\"][\"actions\"])",
            "        if \"events\" in data[\"system\"]:",
            "            s.set([\"system\", \"events\"], data[\"system\"][\"events\"])",
            "",
            "    if \"scripts\" in data:",
            "        if \"gcode\" in data[\"scripts\"] and isinstance(data[\"scripts\"][\"gcode\"], dict):",
            "            for name, script in data[\"scripts\"][\"gcode\"].items():",
            "                if name == \"snippets\":",
            "                    continue",
            "                if not isinstance(script, str):",
            "                    continue",
            "                s.saveScript(",
            "                    \"gcode\", name, script.replace(\"\\r\\n\", \"\\n\").replace(\"\\r\", \"\\n\")",
            "                )",
            "",
            "    if \"server\" in data:",
            "        if \"commands\" in data[\"server\"]:",
            "            if \"systemShutdownCommand\" in data[\"server\"][\"commands\"]:",
            "                s.set(",
            "                    [\"server\", \"commands\", \"systemShutdownCommand\"],",
            "                    data[\"server\"][\"commands\"][\"systemShutdownCommand\"],",
            "                )",
            "            if \"systemRestartCommand\" in data[\"server\"][\"commands\"]:",
            "                s.set(",
            "                    [\"server\", \"commands\", \"systemRestartCommand\"],",
            "                    data[\"server\"][\"commands\"][\"systemRestartCommand\"],",
            "                )",
            "            if \"serverRestartCommand\" in data[\"server\"][\"commands\"]:",
            "                s.set(",
            "                    [\"server\", \"commands\", \"serverRestartCommand\"],",
            "                    data[\"server\"][\"commands\"][\"serverRestartCommand\"],",
            "                )",
            "        if \"diskspace\" in data[\"server\"]:",
            "            if \"warning\" in data[\"server\"][\"diskspace\"]:",
            "                s.setInt(",
            "                    [\"server\", \"diskspace\", \"warning\"],",
            "                    data[\"server\"][\"diskspace\"][\"warning\"],",
            "                )",
            "            if \"critical\" in data[\"server\"][\"diskspace\"]:",
            "                s.setInt(",
            "                    [\"server\", \"diskspace\", \"critical\"],",
            "                    data[\"server\"][\"diskspace\"][\"critical\"],",
            "                )",
            "        if \"onlineCheck\" in data[\"server\"]:",
            "            if \"enabled\" in data[\"server\"][\"onlineCheck\"]:",
            "                s.setBoolean(",
            "                    [\"server\", \"onlineCheck\", \"enabled\"],",
            "                    data[\"server\"][\"onlineCheck\"][\"enabled\"],",
            "                )",
            "            if \"interval\" in data[\"server\"][\"onlineCheck\"]:",
            "                try:",
            "                    interval = int(data[\"server\"][\"onlineCheck\"][\"interval\"])",
            "                    s.setInt([\"server\", \"onlineCheck\", \"interval\"], interval * 60)",
            "                except ValueError:",
            "                    pass",
            "            if \"host\" in data[\"server\"][\"onlineCheck\"]:",
            "                s.set(",
            "                    [\"server\", \"onlineCheck\", \"host\"],",
            "                    data[\"server\"][\"onlineCheck\"][\"host\"],",
            "                )",
            "            if \"port\" in data[\"server\"][\"onlineCheck\"]:",
            "                s.setInt(",
            "                    [\"server\", \"onlineCheck\", \"port\"],",
            "                    data[\"server\"][\"onlineCheck\"][\"port\"],",
            "                )",
            "            if \"name\" in data[\"server\"][\"onlineCheck\"]:",
            "                s.set(",
            "                    [\"server\", \"onlineCheck\", \"name\"],",
            "                    data[\"server\"][\"onlineCheck\"][\"name\"],",
            "                )",
            "        if \"pluginBlacklist\" in data[\"server\"]:",
            "            if \"enabled\" in data[\"server\"][\"pluginBlacklist\"]:",
            "                s.setBoolean(",
            "                    [\"server\", \"pluginBlacklist\", \"enabled\"],",
            "                    data[\"server\"][\"pluginBlacklist\"][\"enabled\"],",
            "                )",
            "            if \"url\" in data[\"server\"][\"pluginBlacklist\"]:",
            "                s.set(",
            "                    [\"server\", \"pluginBlacklist\", \"url\"],",
            "                    data[\"server\"][\"pluginBlacklist\"][\"url\"],",
            "                )",
            "            if \"ttl\" in data[\"server\"][\"pluginBlacklist\"]:",
            "                try:",
            "                    ttl = int(data[\"server\"][\"pluginBlacklist\"][\"ttl\"])",
            "                    s.setInt([\"server\", \"pluginBlacklist\", \"ttl\"], ttl * 60)",
            "                except ValueError:",
            "                    pass",
            "        if \"allowFraming\" in data[\"server\"]:",
            "            s.setBoolean([\"server\", \"allowFraming\"], data[\"server\"][\"allowFraming\"])",
            "",
            "    if \"devel\" in data:",
            "        oldLog = s.getBoolean([\"devel\", \"pluginTimings\"])",
            "        if \"pluginTimings\" in data[\"devel\"]:",
            "            s.setBoolean([\"devel\", \"pluginTimings\"], data[\"devel\"][\"pluginTimings\"])",
            "        if oldLog and not s.getBoolean([\"devel\", \"pluginTimings\"]):",
            "            # disable plugin timing logging to plugintimings.log",
            "            logging.getLogger(\"PLUGIN_TIMINGS\").debug(\"Disabling plugin timings logging\")",
            "            logging.getLogger(\"PLUGIN_TIMINGS\").setLevel(logging.INFO)",
            "        elif not oldLog and s.getBoolean([\"devel\", \"pluginTimings\"]):",
            "            # enable plugin timing logging to plugintimings.log",
            "            logging.getLogger(\"PLUGIN_TIMINGS\").setLevel(logging.DEBUG)",
            "            logging.getLogger(\"PLUGIN_TIMINGS\").debug(\"Enabling plugin timings logging\")",
            "",
            "    if \"slicing\" in data:",
            "        if \"defaultSlicer\" in data[\"slicing\"]:",
            "            s.set([\"slicing\", \"defaultSlicer\"], data[\"slicing\"][\"defaultSlicer\"])",
            "",
            "    if \"plugins\" in data:",
            "        for plugin in octoprint.plugin.plugin_manager().get_implementations(",
            "            octoprint.plugin.SettingsPlugin",
            "        ):",
            "            plugin_id = plugin._identifier",
            "            if plugin_id in data[\"plugins\"]:",
            "                try:",
            "                    plugin.on_settings_save(data[\"plugins\"][plugin_id])",
            "                except TypeError:",
            "                    logger.warning(",
            "                        \"Could not save settings for plugin {name} ({version}). It may have called super(...)\".format(",
            "                            name=plugin._plugin_name, version=plugin._plugin_version",
            "                        )",
            "                    )",
            "                    logger.warning(",
            "                        \"in a way which has issues due to OctoPrint's dynamic reloading after plugin operations.\"",
            "                    )",
            "                    logger.warning(",
            "                        \"Please contact the plugin's author and ask to update the plugin to use a direct call like\"",
            "                    )",
            "                    logger.warning(",
            "                        \"octoprint.plugin.SettingsPlugin.on_settings_save(self, data) instead.\",",
            "                        exc_info=True,",
            "                    )",
            "                except Exception:",
            "                    logger.exception(",
            "                        \"Could not save settings for plugin {name} ({version})\".format(",
            "                            version=plugin._plugin_version, name=plugin._plugin_name",
            "                        ),",
            "                        extra={\"plugin\": plugin._identifier},",
            "                    )",
            "",
            "    s.save(trigger_event=True)"
        ],
        "afterPatchFile": [
            "__author__ = \"Gina H\u00e4u\u00dfge <osd@foosel.net>\"",
            "__license__ = \"GNU Affero General Public License http://www.gnu.org/licenses/agpl.html\"",
            "__copyright__ = \"Copyright (C) 2014 The OctoPrint Project - Released under terms of the AGPLv3 License\"",
            "",
            "import logging",
            "import re",
            "",
            "from flask import abort, jsonify, request",
            "from flask_login import current_user",
            "",
            "import octoprint.plugin",
            "import octoprint.util",
            "from octoprint.access.permissions import Permissions",
            "from octoprint.server import pluginManager, printer, userManager",
            "from octoprint.server.api import NO_CONTENT, api",
            "from octoprint.server.util.flask import (",
            "    credentials_checked_recently,",
            "    no_firstrun_access,",
            "    require_credentials_checked_recently,",
            "    with_revalidation_checking,",
            ")",
            "from octoprint.settings import settings, valid_boolean_trues",
            "from octoprint.timelapse import configure_timelapse",
            "from octoprint.webcams import (",
            "    get_default_webcam,",
            "    get_snapshot_webcam,",
            "    get_webcams_as_dicts,",
            ")",
            "",
            "# ~~ settings",
            "",
            "FOLDER_TYPES = (\"uploads\", \"timelapse\", \"watched\")",
            "TIMELAPSE_BITRATE_PATTERN = re.compile(r\"\\d+[KMGTPEZY]?i?B?\", flags=re.IGNORECASE)",
            "DEPRECATED_WEBCAM_KEYS = (",
            "    \"streamUrl\",",
            "    \"streamRatio\",",
            "    \"streamTimeout\",",
            "    \"streamWebrtcIceServers\",",
            "    \"snapshotUrl\",",
            "    \"snapshotTimeout\",",
            "    \"snapshotSslValidation\",",
            "    \"cacheBuster\",",
            "    \"flipH\",",
            "    \"flipV\",",
            "    \"rotate90\",",
            ")",
            "",
            "",
            "def _lastmodified():",
            "    return settings().last_modified",
            "",
            "",
            "def _etag(lm=None):",
            "    if lm is None:",
            "        lm = _lastmodified()",
            "",
            "    connection_options = printer.__class__.get_connection_options()",
            "    plugins = sorted(octoprint.plugin.plugin_manager().enabled_plugins)",
            "    plugin_settings = _get_plugin_settings()",
            "",
            "    from collections import OrderedDict",
            "",
            "    sorted_plugin_settings = OrderedDict()",
            "    for key in sorted(plugin_settings.keys()):",
            "        sorted_plugin_settings[key] = plugin_settings.get(key, {})",
            "",
            "    if current_user is not None and not current_user.is_anonymous:",
            "        roles = sorted(current_user.permissions, key=lambda x: x.key)",
            "    else:",
            "        roles = []",
            "",
            "    import hashlib",
            "",
            "    hash = hashlib.sha1()",
            "",
            "    def hash_update(value):",
            "        value = value.encode(\"utf-8\")",
            "        hash.update(value)",
            "",
            "    # last modified timestamp",
            "    hash_update(str(lm))",
            "",
            "    # effective config from config.yaml + overlays",
            "    hash_update(repr(settings().effective))",
            "",
            "    # might duplicate settings().effective, but plugins might also inject additional keys into the settings",
            "    # output that are not stored in config.yaml",
            "    hash_update(repr(sorted_plugin_settings))",
            "",
            "    # connection options are also part of the settings",
            "    hash_update(repr(connection_options))",
            "",
            "    # if the list of plugins changes, the settings structure changes too",
            "    hash_update(repr(plugins))",
            "",
            "    # and likewise if the role of the user changes",
            "    hash_update(repr(roles))",
            "",
            "    # of if the user reauthenticates",
            "    hash_update(repr(credentials_checked_recently()))",
            "",
            "    return hash.hexdigest()",
            "",
            "",
            "@api.route(\"/settings\", methods=[\"GET\"])",
            "@with_revalidation_checking(",
            "    etag_factory=_etag,",
            "    lastmodified_factory=_lastmodified,",
            "    unless=lambda: request.values.get(\"force\", \"false\") in valid_boolean_trues",
            "    or settings().getBoolean([\"server\", \"firstRun\"])",
            "    or not userManager.has_been_customized(),",
            ")",
            "def getSettings():",
            "    if not Permissions.SETTINGS_READ.can() and not (",
            "        settings().getBoolean([\"server\", \"firstRun\"])",
            "        or not userManager.has_been_customized()",
            "    ):",
            "        abort(403)",
            "",
            "    s = settings()",
            "",
            "    connectionOptions = printer.__class__.get_connection_options()",
            "",
            "    # NOTE: Remember to adjust the docs of the data model on the Settings API if anything",
            "    # is changed, added or removed here",
            "",
            "    data = {",
            "        \"api\": {",
            "            \"key\": (",
            "                s.get([\"api\", \"key\"])",
            "                if Permissions.ADMIN.can() and credentials_checked_recently()",
            "                else None",
            "            ),",
            "            \"allowCrossOrigin\": s.get([\"api\", \"allowCrossOrigin\"]),",
            "        },",
            "        \"appearance\": {",
            "            \"name\": s.get([\"appearance\", \"name\"]),",
            "            \"color\": s.get([\"appearance\", \"color\"]),",
            "            \"colorTransparent\": s.getBoolean([\"appearance\", \"colorTransparent\"]),",
            "            \"colorIcon\": s.getBoolean([\"appearance\", \"colorIcon\"]),",
            "            \"defaultLanguage\": s.get([\"appearance\", \"defaultLanguage\"]),",
            "            \"showFahrenheitAlso\": s.getBoolean([\"appearance\", \"showFahrenheitAlso\"]),",
            "            \"fuzzyTimes\": s.getBoolean([\"appearance\", \"fuzzyTimes\"]),",
            "            \"closeModalsWithClick\": s.getBoolean([\"appearance\", \"closeModalsWithClick\"]),",
            "            \"showInternalFilename\": s.getBoolean([\"appearance\", \"showInternalFilename\"]),",
            "        },",
            "        \"feature\": {",
            "            \"temperatureGraph\": s.getBoolean([\"feature\", \"temperatureGraph\"]),",
            "            \"sdSupport\": s.getBoolean([\"feature\", \"sdSupport\"]),",
            "            \"keyboardControl\": s.getBoolean([\"feature\", \"keyboardControl\"]),",
            "            \"pollWatched\": s.getBoolean([\"feature\", \"pollWatched\"]),",
            "            \"modelSizeDetection\": s.getBoolean([\"feature\", \"modelSizeDetection\"]),",
            "            \"rememberFileFolder\": s.getBoolean([\"feature\", \"rememberFileFolder\"]),",
            "            \"printStartConfirmation\": s.getBoolean([\"feature\", \"printStartConfirmation\"]),",
            "            \"printCancelConfirmation\": s.getBoolean(",
            "                [\"feature\", \"printCancelConfirmation\"]",
            "            ),",
            "            \"uploadOverwriteConfirmation\": s.getBoolean(",
            "                [\"feature\", \"uploadOverwriteConfirmation\"]",
            "            ),",
            "            \"g90InfluencesExtruder\": s.getBoolean([\"feature\", \"g90InfluencesExtruder\"]),",
            "            \"autoUppercaseBlacklist\": s.get([\"feature\", \"autoUppercaseBlacklist\"]),",
            "            \"enableDragDropUpload\": s.getBoolean([\"feature\", \"enableDragDropUpload\"]),",
            "        },",
            "        \"gcodeAnalysis\": {",
            "            \"runAt\": s.get([\"gcodeAnalysis\", \"runAt\"]),",
            "            \"bedZ\": s.getFloat([\"gcodeAnalysis\", \"bedZ\"]),",
            "        },",
            "        \"serial\": {",
            "            \"port\": connectionOptions[\"portPreference\"],",
            "            \"baudrate\": connectionOptions[\"baudratePreference\"],",
            "            \"exclusive\": s.getBoolean([\"serial\", \"exclusive\"]),",
            "            \"lowLatency\": s.getBoolean([\"serial\", \"lowLatency\"]),",
            "            \"portOptions\": connectionOptions[\"ports\"],",
            "            \"baudrateOptions\": connectionOptions[\"baudrates\"],",
            "            \"autoconnect\": s.getBoolean([\"serial\", \"autoconnect\"]),",
            "            \"timeoutConnection\": s.getFloat([\"serial\", \"timeout\", \"connection\"]),",
            "            \"timeoutDetectionFirst\": s.getFloat([\"serial\", \"timeout\", \"detectionFirst\"]),",
            "            \"timeoutDetectionConsecutive\": s.getFloat(",
            "                [\"serial\", \"timeout\", \"detectionConsecutive\"]",
            "            ),",
            "            \"timeoutCommunication\": s.getFloat([\"serial\", \"timeout\", \"communication\"]),",
            "            \"timeoutCommunicationBusy\": s.getFloat(",
            "                [\"serial\", \"timeout\", \"communicationBusy\"]",
            "            ),",
            "            \"timeoutTemperature\": s.getFloat([\"serial\", \"timeout\", \"temperature\"]),",
            "            \"timeoutTemperatureTargetSet\": s.getFloat(",
            "                [\"serial\", \"timeout\", \"temperatureTargetSet\"]",
            "            ),",
            "            \"timeoutTemperatureAutoreport\": s.getFloat(",
            "                [\"serial\", \"timeout\", \"temperatureAutoreport\"]",
            "            ),",
            "            \"timeoutSdStatus\": s.getFloat([\"serial\", \"timeout\", \"sdStatus\"]),",
            "            \"timeoutSdStatusAutoreport\": s.getFloat(",
            "                [\"serial\", \"timeout\", \"sdStatusAutoreport\"]",
            "            ),",
            "            \"timeoutPosAutoreport\": s.getFloat([\"serial\", \"timeout\", \"posAutoreport\"]),",
            "            \"timeoutBaudrateDetectionPause\": s.getFloat(",
            "                [\"serial\", \"timeout\", \"baudrateDetectionPause\"]",
            "            ),",
            "            \"timeoutPositionLogWait\": s.getFloat(",
            "                [\"serial\", \"timeout\", \"positionLogWait\"]",
            "            ),",
            "            \"log\": s.getBoolean([\"serial\", \"log\"]),",
            "            \"additionalPorts\": s.get([\"serial\", \"additionalPorts\"]),",
            "            \"additionalBaudrates\": s.get([\"serial\", \"additionalBaudrates\"]),",
            "            \"blacklistedPorts\": s.get([\"serial\", \"blacklistedPorts\"]),",
            "            \"blacklistedBaudrates\": s.get([\"serial\", \"blacklistedBaudrates\"]),",
            "            \"longRunningCommands\": s.get([\"serial\", \"longRunningCommands\"]),",
            "            \"checksumRequiringCommands\": s.get([\"serial\", \"checksumRequiringCommands\"]),",
            "            \"blockedCommands\": s.get([\"serial\", \"blockedCommands\"]),",
            "            \"ignoredCommands\": s.get([\"serial\", \"ignoredCommands\"]),",
            "            \"pausingCommands\": s.get([\"serial\", \"pausingCommands\"]),",
            "            \"sdCancelCommand\": s.get([\"serial\", \"sdCancelCommand\"]),",
            "            \"emergencyCommands\": s.get([\"serial\", \"emergencyCommands\"]),",
            "            \"helloCommand\": s.get([\"serial\", \"helloCommand\"]),",
            "            \"ignoreErrorsFromFirmware\": s.getBoolean(",
            "                [\"serial\", \"ignoreErrorsFromFirmware\"]",
            "            ),",
            "            \"disconnectOnErrors\": s.getBoolean([\"serial\", \"disconnectOnErrors\"]),",
            "            \"triggerOkForM29\": s.getBoolean([\"serial\", \"triggerOkForM29\"]),",
            "            \"logPositionOnPause\": s.getBoolean([\"serial\", \"logPositionOnPause\"]),",
            "            \"logPositionOnCancel\": s.getBoolean([\"serial\", \"logPositionOnCancel\"]),",
            "            \"abortHeatupOnCancel\": s.getBoolean([\"serial\", \"abortHeatupOnCancel\"]),",
            "            \"supportResendsWithoutOk\": s.get([\"serial\", \"supportResendsWithoutOk\"]),",
            "            \"waitForStart\": s.getBoolean([\"serial\", \"waitForStartOnConnect\"]),",
            "            \"waitToLoadSdFileList\": s.getBoolean([\"serial\", \"waitToLoadSdFileList\"]),",
            "            \"alwaysSendChecksum\": s.getBoolean([\"serial\", \"alwaysSendChecksum\"]),",
            "            \"neverSendChecksum\": s.getBoolean([\"serial\", \"neverSendChecksum\"]),",
            "            \"sendChecksumWithUnknownCommands\": s.getBoolean(",
            "                [\"serial\", \"sendChecksumWithUnknownCommands\"]",
            "            ),",
            "            \"unknownCommandsNeedAck\": s.getBoolean([\"serial\", \"unknownCommandsNeedAck\"]),",
            "            \"sdRelativePath\": s.getBoolean([\"serial\", \"sdRelativePath\"]),",
            "            \"sdAlwaysAvailable\": s.getBoolean([\"serial\", \"sdAlwaysAvailable\"]),",
            "            \"sdLowerCase\": s.getBoolean([\"serial\", \"sdLowerCase\"]),",
            "            \"swallowOkAfterResend\": s.getBoolean([\"serial\", \"swallowOkAfterResend\"]),",
            "            \"repetierTargetTemp\": s.getBoolean([\"serial\", \"repetierTargetTemp\"]),",
            "            \"externalHeatupDetection\": s.getBoolean(",
            "                [\"serial\", \"externalHeatupDetection\"]",
            "            ),",
            "            \"ignoreIdenticalResends\": s.getBoolean([\"serial\", \"ignoreIdenticalResends\"]),",
            "            \"firmwareDetection\": s.getBoolean([\"serial\", \"firmwareDetection\"]),",
            "            \"blockWhileDwelling\": s.getBoolean([\"serial\", \"blockWhileDwelling\"]),",
            "            \"useParityWorkaround\": s.get([\"serial\", \"useParityWorkaround\"]),",
            "            \"sanityCheckTools\": s.getBoolean([\"serial\", \"sanityCheckTools\"]),",
            "            \"notifySuppressedCommands\": s.get([\"serial\", \"notifySuppressedCommands\"]),",
            "            \"sendM112OnError\": s.getBoolean([\"serial\", \"sendM112OnError\"]),",
            "            \"disableSdPrintingDetection\": s.getBoolean(",
            "                [\"serial\", \"disableSdPrintingDetection\"]",
            "            ),",
            "            \"ackMax\": s.getInt([\"serial\", \"ackMax\"]),",
            "            \"maxTimeoutsIdle\": s.getInt([\"serial\", \"maxCommunicationTimeouts\", \"idle\"]),",
            "            \"maxTimeoutsPrinting\": s.getInt(",
            "                [\"serial\", \"maxCommunicationTimeouts\", \"printing\"]",
            "            ),",
            "            \"maxTimeoutsLong\": s.getInt([\"serial\", \"maxCommunicationTimeouts\", \"long\"]),",
            "            \"capAutoreportTemp\": s.getBoolean(",
            "                [\"serial\", \"capabilities\", \"autoreport_temp\"]",
            "            ),",
            "            \"capAutoreportSdStatus\": s.getBoolean(",
            "                [\"serial\", \"capabilities\", \"autoreport_sdstatus\"]",
            "            ),",
            "            \"capAutoreportPos\": s.getBoolean(",
            "                [\"serial\", \"capabilities\", \"autoreport_pos\"]",
            "            ),",
            "            \"capBusyProtocol\": s.getBoolean([\"serial\", \"capabilities\", \"busy_protocol\"]),",
            "            \"capEmergencyParser\": s.getBoolean(",
            "                [\"serial\", \"capabilities\", \"emergency_parser\"]",
            "            ),",
            "            \"capExtendedM20\": s.getBoolean([\"serial\", \"capabilities\", \"extended_m20\"]),",
            "            \"capLfnWrite\": s.getBoolean([\"serial\", \"capabilities\", \"lfn_write\"]),",
            "            \"resendRatioThreshold\": s.getInt([\"serial\", \"resendRatioThreshold\"]),",
            "            \"resendRatioStart\": s.getInt([\"serial\", \"resendRatioStart\"]),",
            "            \"ignoreEmptyPorts\": s.getBoolean([\"serial\", \"ignoreEmptyPorts\"]),",
            "            \"encoding\": s.get([\"serial\", \"encoding\"]),",
            "            \"enableShutdownActionCommand\": s.get(",
            "                [\"serial\", \"enableShutdownActionCommand\"]",
            "            ),",
            "        },",
            "        \"folder\": {",
            "            \"uploads\": s.getBaseFolder(\"uploads\"),",
            "            \"timelapse\": s.getBaseFolder(\"timelapse\"),",
            "            \"watched\": s.getBaseFolder(\"watched\"),",
            "        },",
            "        \"temperature\": {",
            "            \"profiles\": s.get([\"temperature\", \"profiles\"]),",
            "            \"cutoff\": s.getInt([\"temperature\", \"cutoff\"]),",
            "            \"sendAutomatically\": s.getBoolean([\"temperature\", \"sendAutomatically\"]),",
            "            \"sendAutomaticallyAfter\": s.getInt(",
            "                [\"temperature\", \"sendAutomaticallyAfter\"], min=0, max=30",
            "            ),",
            "        },",
            "        \"system\": {",
            "            \"actions\": s.get([\"system\", \"actions\"]),",
            "            \"events\": s.get([\"system\", \"events\"]),",
            "        },",
            "        \"terminalFilters\": s.get([\"terminalFilters\"]),",
            "        \"scripts\": {",
            "            \"gcode\": {",
            "                \"afterPrinterConnected\": None,",
            "                \"beforePrinterDisconnected\": None,",
            "                \"beforePrintStarted\": None,",
            "                \"afterPrintCancelled\": None,",
            "                \"afterPrintDone\": None,",
            "                \"beforePrintPaused\": None,",
            "                \"afterPrintResumed\": None,",
            "                \"beforeToolChange\": None,",
            "                \"afterToolChange\": None,",
            "                \"snippets\": {},",
            "            }",
            "        },",
            "        \"server\": {",
            "            \"commands\": {",
            "                \"systemShutdownCommand\": s.get(",
            "                    [\"server\", \"commands\", \"systemShutdownCommand\"]",
            "                ),",
            "                \"systemRestartCommand\": s.get(",
            "                    [\"server\", \"commands\", \"systemRestartCommand\"]",
            "                ),",
            "                \"serverRestartCommand\": s.get(",
            "                    [\"server\", \"commands\", \"serverRestartCommand\"]",
            "                ),",
            "            },",
            "            \"diskspace\": {",
            "                \"warning\": s.getInt([\"server\", \"diskspace\", \"warning\"]),",
            "                \"critical\": s.getInt([\"server\", \"diskspace\", \"critical\"]),",
            "            },",
            "            \"onlineCheck\": {",
            "                \"enabled\": s.getBoolean([\"server\", \"onlineCheck\", \"enabled\"]),",
            "                \"interval\": int(s.getInt([\"server\", \"onlineCheck\", \"interval\"]) / 60),",
            "                \"host\": s.get([\"server\", \"onlineCheck\", \"host\"]),",
            "                \"port\": s.getInt([\"server\", \"onlineCheck\", \"port\"]),",
            "                \"name\": s.get([\"server\", \"onlineCheck\", \"name\"]),",
            "            },",
            "            \"pluginBlacklist\": {",
            "                \"enabled\": s.getBoolean([\"server\", \"pluginBlacklist\", \"enabled\"]),",
            "                \"url\": s.get([\"server\", \"pluginBlacklist\", \"url\"]),",
            "                \"ttl\": int(s.getInt([\"server\", \"pluginBlacklist\", \"ttl\"]) / 60),",
            "            },",
            "            \"allowFraming\": s.getBoolean([\"server\", \"allowFraming\"]),",
            "        },",
            "        \"devel\": {\"pluginTimings\": s.getBoolean([\"devel\", \"pluginTimings\"])},",
            "        \"slicing\": {\"defaultSlicer\": s.get([\"slicing\", \"defaultSlicer\"])},",
            "    }",
            "",
            "    gcode_scripts = s.listScripts(\"gcode\")",
            "    if gcode_scripts:",
            "        data[\"scripts\"] = {\"gcode\": {}}",
            "        for name in gcode_scripts:",
            "            data[\"scripts\"][\"gcode\"][name] = s.loadScript(\"gcode\", name, source=True)",
            "",
            "    plugin_settings = _get_plugin_settings()",
            "    if len(plugin_settings):",
            "        data[\"plugins\"] = plugin_settings",
            "",
            "    if Permissions.WEBCAM.can() or (",
            "        settings().getBoolean([\"server\", \"firstRun\"])",
            "        and not userManager.has_been_customized()",
            "    ):",
            "        webcamsDict = get_webcams_as_dicts()",
            "        data[\"webcam\"] = {",
            "            \"webcamEnabled\": s.getBoolean([\"webcam\", \"webcamEnabled\"]),",
            "            \"timelapseEnabled\": s.getBoolean([\"webcam\", \"timelapseEnabled\"]),",
            "            \"ffmpegPath\": s.get([\"webcam\", \"ffmpeg\"]),",
            "            \"ffmpegCommandline\": s.get([\"webcam\", \"ffmpegCommandline\"]),",
            "            \"bitrate\": s.get([\"webcam\", \"bitrate\"]),",
            "            \"ffmpegThreads\": s.get([\"webcam\", \"ffmpegThreads\"]),",
            "            \"ffmpegVideoCodec\": s.get([\"webcam\", \"ffmpegVideoCodec\"]),",
            "            \"watermark\": s.getBoolean([\"webcam\", \"watermark\"]),",
            "            # webcams & defaults",
            "            \"webcams\": webcamsDict,",
            "            \"defaultWebcam\": None,",
            "            \"snapshotWebcam\": None,",
            "        }",
            "",
            "        for key in DEPRECATED_WEBCAM_KEYS:",
            "            data[\"webcam\"][key] = None",
            "",
            "        defaultWebcam = get_default_webcam()",
            "        if defaultWebcam:",
            "            data[\"webcam\"].update(",
            "                {",
            "                    \"flipH\": defaultWebcam.config.flipH,",
            "                    \"flipV\": defaultWebcam.config.flipV,",
            "                    \"rotate90\": defaultWebcam.config.rotate90,",
            "                    \"defaultWebcam\": defaultWebcam.config.name,",
            "                }",
            "            )",
            "",
            "        compatWebcam = defaultWebcam.config.compat if defaultWebcam is not None else None",
            "        if compatWebcam:",
            "            data[\"webcam\"].update(",
            "                {",
            "                    \"streamUrl\": compatWebcam.stream,",
            "                    \"streamRatio\": compatWebcam.streamRatio,",
            "                    \"streamTimeout\": compatWebcam.streamTimeout,",
            "                    \"streamWebrtcIceServers\": compatWebcam.streamWebrtcIceServers,",
            "                    \"snapshotUrl\": compatWebcam.snapshot,",
            "                    \"snapshotTimeout\": compatWebcam.snapshotTimeout,",
            "                    \"snapshotSslValidation\": compatWebcam.snapshotSslValidation,",
            "                    \"cacheBuster\": compatWebcam.cacheBuster,",
            "                }",
            "            )",
            "",
            "        snapshotWebcam = get_snapshot_webcam()",
            "        if snapshotWebcam:",
            "            data[\"webcam\"].update(",
            "                {",
            "                    \"snapshotWebcam\": snapshotWebcam.config.name,",
            "                }",
            "            )",
            "    else:",
            "        data[\"webcam\"] = {}",
            "",
            "    if Permissions.ADMIN.can():",
            "        data[\"accessControl\"] = {",
            "            \"autologinLocal\": s.getBoolean([\"accessControl\", \"autologinLocal\"]),",
            "            \"autologinHeadsupAcknowledged\": s.getBoolean(",
            "                [\"accessControl\", \"autologinHeadsupAcknowledged\"]",
            "            ),",
            "        }",
            "",
            "    return jsonify(data)",
            "",
            "",
            "def _get_plugin_settings():",
            "    logger = logging.getLogger(__name__)",
            "",
            "    data = {}",
            "",
            "    def process_plugin_result(name, result):",
            "        if result:",
            "            try:",
            "                jsonify(test=result)",
            "            except Exception:",
            "                logger.exception(",
            "                    \"Error while jsonifying settings from plugin {}, please contact the plugin author about this\".format(",
            "                        name",
            "                    )",
            "                )",
            "                raise",
            "            else:",
            "                if \"__enabled\" in result:",
            "                    del result[\"__enabled\"]",
            "                data[name] = result",
            "",
            "    for plugin in octoprint.plugin.plugin_manager().get_implementations(",
            "        octoprint.plugin.SettingsPlugin",
            "    ):",
            "        try:",
            "            result = plugin.on_settings_load()",
            "            process_plugin_result(plugin._identifier, result)",
            "        except Exception:",
            "            logger.exception(",
            "                \"Could not load settings for plugin {name} ({version})\".format(",
            "                    version=plugin._plugin_version, name=plugin._plugin_name",
            "                ),",
            "                extra={\"plugin\": plugin._identifier},",
            "            )",
            "",
            "    return data",
            "",
            "",
            "@api.route(\"/settings\", methods=[\"POST\"])",
            "@no_firstrun_access",
            "@Permissions.SETTINGS.require(403)",
            "def setSettings():",
            "    data = request.get_json()",
            "    if not isinstance(data, dict):",
            "        abort(400, description=\"Malformed JSON body in request\")",
            "",
            "    response = _saveSettings(data)",
            "    if response:",
            "        return response",
            "    return getSettings()",
            "",
            "",
            "@api.route(\"/settings/apikey\", methods=[\"POST\"])",
            "@no_firstrun_access",
            "@Permissions.ADMIN.require(403)",
            "@require_credentials_checked_recently",
            "def generateApiKey():",
            "    apikey = settings().generateApiKey()",
            "    return jsonify(apikey=apikey)",
            "",
            "",
            "@api.route(\"/settings/apikey\", methods=[\"DELETE\"])",
            "@no_firstrun_access",
            "@Permissions.ADMIN.require(403)",
            "@require_credentials_checked_recently",
            "def deleteApiKey():",
            "    settings().deleteApiKey()",
            "    return NO_CONTENT",
            "",
            "",
            "@api.route(\"/settings/templates\", methods=[\"GET\"])",
            "@no_firstrun_access",
            "@Permissions.SETTINGS.require(403)",
            "def fetchTemplateData():",
            "    from octoprint.server.views import fetch_template_data",
            "",
            "    refresh = request.values.get(\"refresh\", \"false\") in valid_boolean_trues",
            "    templates, _, _ = fetch_template_data(refresh=refresh)",
            "",
            "    result = {}",
            "    for tt in templates:",
            "        result[tt] = []",
            "        for key in templates[tt][\"order\"]:",
            "            entry = templates[tt][\"entries\"].get(key)",
            "            if not entry:",
            "                continue",
            "",
            "            if isinstance(entry, dict):",
            "                name = key",
            "            else:",
            "                name, entry = entry",
            "",
            "            data = {\"id\": key, \"name\": name}",
            "",
            "            if entry and \"_plugin\" in entry:",
            "                plugin = pluginManager.get_plugin_info(",
            "                    entry[\"_plugin\"], require_enabled=False",
            "                )",
            "                data[\"plugin_id\"] = plugin.key",
            "                data[\"plugin_name\"] = plugin.name",
            "",
            "            result[tt].append(data)",
            "",
            "    return jsonify(order=result)",
            "",
            "",
            "def _saveSettings(data):",
            "    logger = logging.getLogger(__name__)",
            "",
            "    s = settings()",
            "",
            "    # NOTE: Remember to adjust the docs of the data model on the Settings API if anything",
            "    # is changed, added or removed here",
            "",
            "    if \"folder\" in data:",
            "        try:",
            "            folders = data[\"folder\"]",
            "            future = {}",
            "            for folder in FOLDER_TYPES:",
            "                future[folder] = s.getBaseFolder(folder)",
            "                if folder in folders:",
            "                    future[folder] = folders[folder]",
            "",
            "            for folder in folders:",
            "                if folder not in FOLDER_TYPES:",
            "                    continue",
            "                for other_folder in FOLDER_TYPES:",
            "                    if folder == other_folder:",
            "                        continue",
            "                    if future[folder] == future[other_folder]:",
            "                        # duplicate detected, raise",
            "                        raise ValueError(",
            "                            \"Duplicate folder path for {} and {}\".format(",
            "                                folder, other_folder",
            "                            )",
            "                        )",
            "",
            "                s.setBaseFolder(folder, future[folder])",
            "        except Exception:",
            "            logger.exception(\"Something went wrong while saving a folder path\")",
            "            abort(400, description=\"At least one of the configured folders is invalid\")",
            "",
            "    if \"api\" in data:",
            "        if \"allowCrossOrigin\" in data[\"api\"]:",
            "            s.setBoolean([\"api\", \"allowCrossOrigin\"], data[\"api\"][\"allowCrossOrigin\"])",
            "",
            "    if \"accessControl\" in data:",
            "        if \"autologinHeadsupAcknowledged\" in data[\"accessControl\"]:",
            "            s.setBoolean(",
            "                [\"accessControl\", \"autologinHeadsupAcknowledged\"],",
            "                data[\"accessControl\"][\"autologinHeadsupAcknowledged\"],",
            "            )",
            "",
            "    if \"appearance\" in data:",
            "        if \"name\" in data[\"appearance\"]:",
            "            s.set([\"appearance\", \"name\"], data[\"appearance\"][\"name\"])",
            "        if \"color\" in data[\"appearance\"]:",
            "            s.set([\"appearance\", \"color\"], data[\"appearance\"][\"color\"])",
            "        if \"colorTransparent\" in data[\"appearance\"]:",
            "            s.setBoolean(",
            "                [\"appearance\", \"colorTransparent\"],",
            "                data[\"appearance\"][\"colorTransparent\"],",
            "            )",
            "        if \"colorIcon\" in data[\"appearance\"]:",
            "            s.setBoolean([\"appearance\", \"colorIcon\"], data[\"appearance\"][\"colorIcon\"])",
            "        if \"defaultLanguage\" in data[\"appearance\"]:",
            "            s.set(",
            "                [\"appearance\", \"defaultLanguage\"], data[\"appearance\"][\"defaultLanguage\"]",
            "            )",
            "        if \"showFahrenheitAlso\" in data[\"appearance\"]:",
            "            s.setBoolean(",
            "                [\"appearance\", \"showFahrenheitAlso\"],",
            "                data[\"appearance\"][\"showFahrenheitAlso\"],",
            "            )",
            "        if \"fuzzyTimes\" in data[\"appearance\"]:",
            "            s.setBoolean([\"appearance\", \"fuzzyTimes\"], data[\"appearance\"][\"fuzzyTimes\"])",
            "        if \"closeModalsWithClick\" in data[\"appearance\"]:",
            "            s.setBoolean(",
            "                [\"appearance\", \"closeModalsWithClick\"],",
            "                data[\"appearance\"][\"closeModalsWithClick\"],",
            "            )",
            "        if \"showInternalFilename\" in data[\"appearance\"]:",
            "            s.setBoolean(",
            "                [\"appearance\", \"showInternalFilename\"],",
            "                data[\"appearance\"][\"showInternalFilename\"],",
            "            )",
            "",
            "    if \"printer\" in data:",
            "        if \"defaultExtrusionLength\" in data[\"printer\"]:",
            "            s.setInt(",
            "                [\"printerParameters\", \"defaultExtrusionLength\"],",
            "                data[\"printer\"][\"defaultExtrusionLength\"],",
            "            )",
            "",
            "    if \"webcam\" in data:",
            "        for key in DEPRECATED_WEBCAM_KEYS:",
            "            if key in data[\"webcam\"]:",
            "                logger.warning(",
            "                    f\"Setting webcam.{key} via the API is no longer supported, please use the individual settings of the default webcam instead.\"",
            "                )",
            "",
            "        if \"webcamEnabled\" in data[\"webcam\"]:",
            "            s.setBoolean([\"webcam\", \"webcamEnabled\"], data[\"webcam\"][\"webcamEnabled\"])",
            "        if \"timelapseEnabled\" in data[\"webcam\"]:",
            "            s.setBoolean(",
            "                [\"webcam\", \"timelapseEnabled\"], data[\"webcam\"][\"timelapseEnabled\"]",
            "            )",
            "        if \"snapshotTimeout\" in data[\"webcam\"]:",
            "            s.setInt([\"webcam\", \"snapshotTimeout\"], data[\"webcam\"][\"snapshotTimeout\"])",
            "        if \"snapshotSslValidation\" in data[\"webcam\"]:",
            "            s.setBoolean(",
            "                [\"webcam\", \"snapshotSslValidation\"],",
            "                data[\"webcam\"][\"snapshotSslValidation\"],",
            "            )",
            "        if \"ffmpegPath\" in data[\"webcam\"]:",
            "            s.set([\"webcam\", \"ffmpeg\"], data[\"webcam\"][\"ffmpegPath\"])",
            "        if \"ffmpegCommandline\" in data[\"webcam\"]:",
            "            commandline = data[\"webcam\"][\"ffmpegCommandline\"]",
            "            if not all(",
            "                map(",
            "                    lambda x: \"{\" + x + \"}\" in commandline,",
            "                    (\"ffmpeg\", \"input\", \"output\"),",
            "                )",
            "            ):",
            "                abort(",
            "                    400,",
            "                    description=\"Invalid webcam.ffmpegCommandline setting, lacks mandatory {ffmpeg}, {input} or {output}\",",
            "                )",
            "            try:",
            "                commandline.format(",
            "                    ffmpeg=\"ffmpeg\",",
            "                    fps=\"fps\",",
            "                    bitrate=\"bitrate\",",
            "                    threads=\"threads\",",
            "                    input=\"input\",",
            "                    output=\"output\",",
            "                    videocodec=\"videocodec\",",
            "                    containerformat=\"containerformat\",",
            "                    filters=\"filters\",",
            "                )",
            "            except Exception:",
            "                # some invalid data we'll refuse to set",
            "                logger.exception(\"Invalid webcam.ffmpegCommandline setting\")",
            "                abort(400, description=\"Invalid webcam.ffmpegCommandline setting\")",
            "            else:",
            "                s.set([\"webcam\", \"ffmpegCommandline\"], commandline)",
            "        if \"bitrate\" in data[\"webcam\"] and data[\"webcam\"][\"bitrate\"]:",
            "            bitrate = str(data[\"webcam\"][\"bitrate\"])",
            "            if not TIMELAPSE_BITRATE_PATTERN.match(bitrate):",
            "                abort(",
            "                    400,",
            "                    description=\"Invalid webcam.bitrate setting, needs to be a valid ffmpeg bitrate\",",
            "                )",
            "            s.set([\"webcam\", \"bitrate\"], bitrate)",
            "        if \"ffmpegThreads\" in data[\"webcam\"]:",
            "            s.setInt([\"webcam\", \"ffmpegThreads\"], data[\"webcam\"][\"ffmpegThreads\"])",
            "        if \"ffmpegVideoCodec\" in data[\"webcam\"] and data[\"webcam\"][",
            "            \"ffmpegVideoCodec\"",
            "        ] in (\"mpeg2video\", \"libx264\"):",
            "            s.set([\"webcam\", \"ffmpegVideoCodec\"], data[\"webcam\"][\"ffmpegVideoCodec\"])",
            "        if \"watermark\" in data[\"webcam\"]:",
            "            s.setBoolean([\"webcam\", \"watermark\"], data[\"webcam\"][\"watermark\"])",
            "        if \"defaultWebcam\" in data[\"webcam\"]:",
            "            s.set([\"webcam\", \"defaultWebcam\"], data[\"webcam\"][\"defaultWebcam\"])",
            "        if \"snapshotWebcam\" in data[\"webcam\"]:",
            "            s.set([\"webcam\", \"snapshotWebcam\"], data[\"webcam\"][\"snapshotWebcam\"])",
            "",
            "            # timelapse needs to be reconfigured now since it depends on the current snapshot webcam",
            "            configure_timelapse()",
            "",
            "    if \"feature\" in data:",
            "        if \"temperatureGraph\" in data[\"feature\"]:",
            "            s.setBoolean(",
            "                [\"feature\", \"temperatureGraph\"], data[\"feature\"][\"temperatureGraph\"]",
            "            )",
            "        if \"sdSupport\" in data[\"feature\"]:",
            "            s.setBoolean([\"feature\", \"sdSupport\"], data[\"feature\"][\"sdSupport\"])",
            "        if \"keyboardControl\" in data[\"feature\"]:",
            "            s.setBoolean(",
            "                [\"feature\", \"keyboardControl\"], data[\"feature\"][\"keyboardControl\"]",
            "            )",
            "        if \"pollWatched\" in data[\"feature\"]:",
            "            s.setBoolean([\"feature\", \"pollWatched\"], data[\"feature\"][\"pollWatched\"])",
            "        if \"modelSizeDetection\" in data[\"feature\"]:",
            "            s.setBoolean(",
            "                [\"feature\", \"modelSizeDetection\"], data[\"feature\"][\"modelSizeDetection\"]",
            "            )",
            "        if \"rememberFileFolder\" in data[\"feature\"]:",
            "            s.setBoolean(",
            "                [\"feature\", \"rememberFileFolder\"],",
            "                data[\"feature\"][\"rememberFileFolder\"],",
            "            )",
            "        if \"printStartConfirmation\" in data[\"feature\"]:",
            "            s.setBoolean(",
            "                [\"feature\", \"printStartConfirmation\"],",
            "                data[\"feature\"][\"printStartConfirmation\"],",
            "            )",
            "        if \"printCancelConfirmation\" in data[\"feature\"]:",
            "            s.setBoolean(",
            "                [\"feature\", \"printCancelConfirmation\"],",
            "                data[\"feature\"][\"printCancelConfirmation\"],",
            "            )",
            "        if \"uploadOverwriteConfirmation\" in data[\"feature\"]:",
            "            s.setBoolean(",
            "                [\"feature\", \"uploadOverwriteConfirmation\"],",
            "                data[\"feature\"][\"uploadOverwriteConfirmation\"],",
            "            )",
            "        if \"g90InfluencesExtruder\" in data[\"feature\"]:",
            "            s.setBoolean(",
            "                [\"feature\", \"g90InfluencesExtruder\"],",
            "                data[\"feature\"][\"g90InfluencesExtruder\"],",
            "            )",
            "        if \"autoUppercaseBlacklist\" in data[\"feature\"] and isinstance(",
            "            data[\"feature\"][\"autoUppercaseBlacklist\"], (list, tuple)",
            "        ):",
            "            s.set(",
            "                [\"feature\", \"autoUppercaseBlacklist\"],",
            "                data[\"feature\"][\"autoUppercaseBlacklist\"],",
            "            )",
            "        if \"enableDragDropUpload\" in data[\"feature\"]:",
            "            s.setBoolean(",
            "                [\"feature\", \"enableDragDropUpload\"],",
            "                data[\"feature\"][\"enableDragDropUpload\"],",
            "            )",
            "",
            "    if \"gcodeAnalysis\" in data:",
            "        if \"runAt\" in data[\"gcodeAnalysis\"]:",
            "            s.set([\"gcodeAnalysis\", \"runAt\"], data[\"gcodeAnalysis\"][\"runAt\"])",
            "        if \"bedZ\" in data[\"gcodeAnalysis\"]:",
            "            s.setFloat([\"gcodeAnalysis\", \"bedZ\"], data[\"gcodeAnalysis\"][\"bedZ\"])",
            "",
            "    if \"serial\" in data:",
            "        if \"autoconnect\" in data[\"serial\"]:",
            "            s.setBoolean([\"serial\", \"autoconnect\"], data[\"serial\"][\"autoconnect\"])",
            "        if \"port\" in data[\"serial\"]:",
            "            s.set([\"serial\", \"port\"], data[\"serial\"][\"port\"])",
            "        if \"baudrate\" in data[\"serial\"]:",
            "            s.setInt([\"serial\", \"baudrate\"], data[\"serial\"][\"baudrate\"])",
            "        if \"exclusive\" in data[\"serial\"]:",
            "            s.setBoolean([\"serial\", \"exclusive\"], data[\"serial\"][\"exclusive\"])",
            "        if \"lowLatency\" in data[\"serial\"]:",
            "            s.setBoolean([\"serial\", \"lowLatency\"], data[\"serial\"][\"lowLatency\"])",
            "        if \"timeoutConnection\" in data[\"serial\"]:",
            "            s.setFloat(",
            "                [\"serial\", \"timeout\", \"connection\"],",
            "                data[\"serial\"][\"timeoutConnection\"],",
            "                min=1.0,",
            "            )",
            "        if \"timeoutDetectionFirst\" in data[\"serial\"]:",
            "            s.setFloat(",
            "                [\"serial\", \"timeout\", \"detectionFirst\"],",
            "                data[\"serial\"][\"timeoutDetectionFirst\"],",
            "                min=1.0,",
            "            )",
            "        if \"timeoutDetectionConsecutive\" in data[\"serial\"]:",
            "            s.setFloat(",
            "                [\"serial\", \"timeout\", \"detectionConsecutive\"],",
            "                data[\"serial\"][\"timeoutDetectionConsecutive\"],",
            "                min=1.0,",
            "            )",
            "        if \"timeoutCommunication\" in data[\"serial\"]:",
            "            s.setFloat(",
            "                [\"serial\", \"timeout\", \"communication\"],",
            "                data[\"serial\"][\"timeoutCommunication\"],",
            "                min=1.0,",
            "            )",
            "        if \"timeoutCommunicationBusy\" in data[\"serial\"]:",
            "            s.setFloat(",
            "                [\"serial\", \"timeout\", \"communicationBusy\"],",
            "                data[\"serial\"][\"timeoutCommunicationBusy\"],",
            "                min=1.0,",
            "            )",
            "        if \"timeoutTemperature\" in data[\"serial\"]:",
            "            s.setFloat(",
            "                [\"serial\", \"timeout\", \"temperature\"],",
            "                data[\"serial\"][\"timeoutTemperature\"],",
            "                min=1.0,",
            "            )",
            "        if \"timeoutTemperatureTargetSet\" in data[\"serial\"]:",
            "            s.setFloat(",
            "                [\"serial\", \"timeout\", \"temperatureTargetSet\"],",
            "                data[\"serial\"][\"timeoutTemperatureTargetSet\"],",
            "                min=1.0,",
            "            )",
            "        if \"timeoutTemperatureAutoreport\" in data[\"serial\"]:",
            "            s.setFloat(",
            "                [\"serial\", \"timeout\", \"temperatureAutoreport\"],",
            "                data[\"serial\"][\"timeoutTemperatureAutoreport\"],",
            "                min=0.0,",
            "            )",
            "        if \"timeoutSdStatus\" in data[\"serial\"]:",
            "            s.setFloat(",
            "                [\"serial\", \"timeout\", \"sdStatus\"],",
            "                data[\"serial\"][\"timeoutSdStatus\"],",
            "                min=1.0,",
            "            )",
            "        if \"timeoutSdStatusAutoreport\" in data[\"serial\"]:",
            "            s.setFloat(",
            "                [\"serial\", \"timeout\", \"sdStatusAutoreport\"],",
            "                data[\"serial\"][\"timeoutSdStatusAutoreport\"],",
            "                min=0.0,",
            "            )",
            "        if \"timeoutPosAutoreport\" in data[\"serial\"]:",
            "            s.setFloat(",
            "                [\"serial\", \"timeout\", \"posAutoreport\"],",
            "                data[\"serial\"][\"timeoutPosAutoreport\"],",
            "                min=0.0,",
            "            )",
            "        if \"timeoutBaudrateDetectionPause\" in data[\"serial\"]:",
            "            s.setFloat(",
            "                [\"serial\", \"timeout\", \"baudrateDetectionPause\"],",
            "                data[\"serial\"][\"timeoutBaudrateDetectionPause\"],",
            "                min=0.0,",
            "            )",
            "        if \"timeoutPositionLogWait\" in data[\"serial\"]:",
            "            s.setFloat(",
            "                [\"serial\", \"timeout\", \"positionLogWait\"],",
            "                data[\"serial\"][\"timeoutPositionLogWait\"],",
            "                min=1.0,",
            "            )",
            "        if \"additionalPorts\" in data[\"serial\"] and isinstance(",
            "            data[\"serial\"][\"additionalPorts\"], (list, tuple)",
            "        ):",
            "            s.set([\"serial\", \"additionalPorts\"], data[\"serial\"][\"additionalPorts\"])",
            "        if \"additionalBaudrates\" in data[\"serial\"] and isinstance(",
            "            data[\"serial\"][\"additionalBaudrates\"], (list, tuple)",
            "        ):",
            "            s.set(",
            "                [\"serial\", \"additionalBaudrates\"], data[\"serial\"][\"additionalBaudrates\"]",
            "            )",
            "        if \"blacklistedPorts\" in data[\"serial\"] and isinstance(",
            "            data[\"serial\"][\"blacklistedPorts\"], (list, tuple)",
            "        ):",
            "            s.set([\"serial\", \"blacklistedPorts\"], data[\"serial\"][\"blacklistedPorts\"])",
            "        if \"blacklistedBaudrates\" in data[\"serial\"] and isinstance(",
            "            data[\"serial\"][\"blacklistedBaudrates\"], (list, tuple)",
            "        ):",
            "            s.set(",
            "                [\"serial\", \"blacklistedBaudrates\"],",
            "                data[\"serial\"][\"blacklistedBaudrates\"],",
            "            )",
            "        if \"longRunningCommands\" in data[\"serial\"] and isinstance(",
            "            data[\"serial\"][\"longRunningCommands\"], (list, tuple)",
            "        ):",
            "            s.set(",
            "                [\"serial\", \"longRunningCommands\"], data[\"serial\"][\"longRunningCommands\"]",
            "            )",
            "        if \"checksumRequiringCommands\" in data[\"serial\"] and isinstance(",
            "            data[\"serial\"][\"checksumRequiringCommands\"], (list, tuple)",
            "        ):",
            "            s.set(",
            "                [\"serial\", \"checksumRequiringCommands\"],",
            "                data[\"serial\"][\"checksumRequiringCommands\"],",
            "            )",
            "        if \"blockedCommands\" in data[\"serial\"] and isinstance(",
            "            data[\"serial\"][\"blockedCommands\"], (list, tuple)",
            "        ):",
            "            s.set([\"serial\", \"blockedCommands\"], data[\"serial\"][\"blockedCommands\"])",
            "        if \"ignoredCommands\" in data[\"serial\"] and isinstance(",
            "            data[\"serial\"][\"ignoredCommands\"], (list, tuple)",
            "        ):",
            "            s.set([\"serial\", \"ignoredCommands\"], data[\"serial\"][\"ignoredCommands\"])",
            "        if \"pausingCommands\" in data[\"serial\"] and isinstance(",
            "            data[\"serial\"][\"pausingCommands\"], (list, tuple)",
            "        ):",
            "            s.set([\"serial\", \"pausingCommands\"], data[\"serial\"][\"pausingCommands\"])",
            "        if \"sdCancelCommand\" in data[\"serial\"]:",
            "            s.set([\"serial\", \"sdCancelCommand\"], data[\"serial\"][\"sdCancelCommand\"])",
            "        if \"emergencyCommands\" in data[\"serial\"] and isinstance(",
            "            data[\"serial\"][\"emergencyCommands\"], (list, tuple)",
            "        ):",
            "            s.set([\"serial\", \"emergencyCommands\"], data[\"serial\"][\"emergencyCommands\"])",
            "        if \"helloCommand\" in data[\"serial\"]:",
            "            s.set([\"serial\", \"helloCommand\"], data[\"serial\"][\"helloCommand\"])",
            "        if \"ignoreErrorsFromFirmware\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"ignoreErrorsFromFirmware\"],",
            "                data[\"serial\"][\"ignoreErrorsFromFirmware\"],",
            "            )",
            "        if \"disconnectOnErrors\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"disconnectOnErrors\"], data[\"serial\"][\"disconnectOnErrors\"]",
            "            )",
            "        if \"triggerOkForM29\" in data[\"serial\"]:",
            "            s.setBoolean([\"serial\", \"triggerOkForM29\"], data[\"serial\"][\"triggerOkForM29\"])",
            "        if \"supportResendsWithoutOk\" in data[\"serial\"]:",
            "            value = data[\"serial\"][\"supportResendsWithoutOk\"]",
            "            if value in (\"always\", \"detect\", \"never\"):",
            "                s.set([\"serial\", \"supportResendsWithoutOk\"], value)",
            "        if \"waitForStart\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"waitForStartOnConnect\"], data[\"serial\"][\"waitForStart\"]",
            "            )",
            "        if \"waitToLoadSdFileList\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"waitToLoadSdFileList\"],",
            "                data[\"serial\"][\"waitToLoadSdFileList\"],",
            "            )",
            "        if \"alwaysSendChecksum\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"alwaysSendChecksum\"], data[\"serial\"][\"alwaysSendChecksum\"]",
            "            )",
            "        if \"neverSendChecksum\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"neverSendChecksum\"], data[\"serial\"][\"neverSendChecksum\"]",
            "            )",
            "        if \"sendChecksumWithUnknownCommands\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"sendChecksumWithUnknownCommands\"],",
            "                data[\"serial\"][\"sendChecksumWithUnknownCommands\"],",
            "            )",
            "        if \"unknownCommandsNeedAck\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"unknownCommandsNeedAck\"],",
            "                data[\"serial\"][\"unknownCommandsNeedAck\"],",
            "            )",
            "        if \"sdRelativePath\" in data[\"serial\"]:",
            "            s.setBoolean([\"serial\", \"sdRelativePath\"], data[\"serial\"][\"sdRelativePath\"])",
            "        if \"sdAlwaysAvailable\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"sdAlwaysAvailable\"], data[\"serial\"][\"sdAlwaysAvailable\"]",
            "            )",
            "        if \"sdLowerCase\" in data[\"serial\"]:",
            "            s.setBoolean([\"serial\", \"sdLowerCase\"], data[\"serial\"][\"sdLowerCase\"])",
            "        if \"swallowOkAfterResend\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"swallowOkAfterResend\"],",
            "                data[\"serial\"][\"swallowOkAfterResend\"],",
            "            )",
            "        if \"repetierTargetTemp\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"repetierTargetTemp\"], data[\"serial\"][\"repetierTargetTemp\"]",
            "            )",
            "        if \"externalHeatupDetection\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"externalHeatupDetection\"],",
            "                data[\"serial\"][\"externalHeatupDetection\"],",
            "            )",
            "        if \"ignoreIdenticalResends\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"ignoreIdenticalResends\"],",
            "                data[\"serial\"][\"ignoreIdenticalResends\"],",
            "            )",
            "        if \"firmwareDetection\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"firmwareDetection\"], data[\"serial\"][\"firmwareDetection\"]",
            "            )",
            "        if \"blockWhileDwelling\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"blockWhileDwelling\"], data[\"serial\"][\"blockWhileDwelling\"]",
            "            )",
            "        if \"useParityWorkaround\" in data[\"serial\"]:",
            "            value = data[\"serial\"][\"useParityWorkaround\"]",
            "            if value in (\"always\", \"detect\", \"never\"):",
            "                s.set([\"serial\", \"useParityWorkaround\"], value)",
            "        if \"sanityCheckTools\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"sanityCheckTools\"], data[\"serial\"][\"sanityCheckTools\"]",
            "            )",
            "        if \"notifySuppressedCommands\" in data[\"serial\"]:",
            "            value = data[\"serial\"][\"notifySuppressedCommands\"]",
            "            if value in (\"info\", \"warn\", \"never\"):",
            "                s.set([\"serial\", \"notifySuppressedCommands\"], value)",
            "        if \"sendM112OnError\" in data[\"serial\"]:",
            "            s.setBoolean([\"serial\", \"sendM112OnError\"], data[\"serial\"][\"sendM112OnError\"])",
            "        if \"disableSdPrintingDetection\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"disableSdPrintingDetection\"],",
            "                data[\"serial\"][\"disableSdPrintingDetection\"],",
            "            )",
            "        if \"ackMax\" in data[\"serial\"]:",
            "            s.setInt([\"serial\", \"ackMax\"], data[\"serial\"][\"ackMax\"])",
            "        if \"logPositionOnPause\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"logPositionOnPause\"], data[\"serial\"][\"logPositionOnPause\"]",
            "            )",
            "        if \"logPositionOnCancel\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"logPositionOnCancel\"], data[\"serial\"][\"logPositionOnCancel\"]",
            "            )",
            "        if \"abortHeatupOnCancel\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"abortHeatupOnCancel\"], data[\"serial\"][\"abortHeatupOnCancel\"]",
            "            )",
            "        if \"maxTimeoutsIdle\" in data[\"serial\"]:",
            "            s.setInt(",
            "                [\"serial\", \"maxCommunicationTimeouts\", \"idle\"],",
            "                data[\"serial\"][\"maxTimeoutsIdle\"],",
            "            )",
            "        if \"maxTimeoutsPrinting\" in data[\"serial\"]:",
            "            s.setInt(",
            "                [\"serial\", \"maxCommunicationTimeouts\", \"printing\"],",
            "                data[\"serial\"][\"maxTimeoutsPrinting\"],",
            "            )",
            "        if \"maxTimeoutsLong\" in data[\"serial\"]:",
            "            s.setInt(",
            "                [\"serial\", \"maxCommunicationTimeouts\", \"long\"],",
            "                data[\"serial\"][\"maxTimeoutsLong\"],",
            "            )",
            "        if \"capAutoreportTemp\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"capabilities\", \"autoreport_temp\"],",
            "                data[\"serial\"][\"capAutoreportTemp\"],",
            "            )",
            "        if \"capAutoreportSdStatus\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"capabilities\", \"autoreport_sdstatus\"],",
            "                data[\"serial\"][\"capAutoreportSdStatus\"],",
            "            )",
            "        if \"capAutoreportPos\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"capabilities\", \"autoreport_pos\"],",
            "                data[\"serial\"][\"capAutoreportPos\"],",
            "            )",
            "        if \"capBusyProtocol\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"capabilities\", \"busy_protocol\"],",
            "                data[\"serial\"][\"capBusyProtocol\"],",
            "            )",
            "        if \"capEmergencyParser\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"capabilities\", \"emergency_parser\"],",
            "                data[\"serial\"][\"capEmergencyParser\"],",
            "            )",
            "        if \"capExtendedM20\" in data[\"serial\"]:",
            "            (",
            "                s.setBoolean(",
            "                    [\"serial\", \"capabilities\", \"extended_m20\"],",
            "                    data[\"serial\"][\"capExtendedM20\"],",
            "                ),",
            "            )",
            "        if \"capLfnWrite\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"capabilities\", \"lfn_write\"],",
            "                data[\"serial\"][\"capLfnWrite\"],",
            "            )",
            "        if \"resendRatioThreshold\" in data[\"serial\"]:",
            "            s.setInt(",
            "                [\"serial\", \"resendRatioThreshold\"],",
            "                data[\"serial\"][\"resendRatioThreshold\"],",
            "            )",
            "        if \"resendRatioStart\" in data[\"serial\"]:",
            "            s.setInt([\"serial\", \"resendRatioStart\"], data[\"serial\"][\"resendRatioStart\"])",
            "        if \"ignoreEmptyPorts\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"ignoreEmptyPorts\"], data[\"serial\"][\"ignoreEmptyPorts\"]",
            "            )",
            "",
            "        if \"encoding\" in data[\"serial\"]:",
            "            s.set([\"serial\", \"encoding\"], data[\"serial\"][\"encoding\"])",
            "",
            "        if \"enableShutdownActionCommand\" in data[\"serial\"]:",
            "            s.setBoolean(",
            "                [\"serial\", \"enableShutdownActionCommand\"],",
            "                data[\"serial\"][\"enableShutdownActionCommand\"],",
            "            )",
            "",
            "        oldLog = s.getBoolean([\"serial\", \"log\"])",
            "        if \"log\" in data[\"serial\"]:",
            "            s.setBoolean([\"serial\", \"log\"], data[\"serial\"][\"log\"])",
            "        if oldLog and not s.getBoolean([\"serial\", \"log\"]):",
            "            # disable debug logging to serial.log",
            "            logging.getLogger(\"SERIAL\").debug(\"Disabling serial logging\")",
            "            logging.getLogger(\"SERIAL\").setLevel(logging.CRITICAL)",
            "        elif not oldLog and s.getBoolean([\"serial\", \"log\"]):",
            "            # enable debug logging to serial.log",
            "            logging.getLogger(\"SERIAL\").setLevel(logging.DEBUG)",
            "            logging.getLogger(\"SERIAL\").debug(\"Enabling serial logging\")",
            "",
            "    if \"temperature\" in data:",
            "        if \"profiles\" in data[\"temperature\"]:",
            "            result = []",
            "            for profile in data[\"temperature\"][\"profiles\"]:",
            "                try:",
            "                    profile[\"bed\"] = int(profile[\"bed\"])",
            "                    profile[\"extruder\"] = int(profile[\"extruder\"])",
            "                except ValueError:",
            "                    pass",
            "                result.append(profile)",
            "            s.set([\"temperature\", \"profiles\"], result)",
            "        if \"cutoff\" in data[\"temperature\"]:",
            "            try:",
            "                cutoff = int(data[\"temperature\"][\"cutoff\"])",
            "                if cutoff > 1:",
            "                    s.setInt([\"temperature\", \"cutoff\"], cutoff)",
            "            except ValueError:",
            "                pass",
            "        if \"sendAutomatically\" in data[\"temperature\"]:",
            "            s.setBoolean(",
            "                [\"temperature\", \"sendAutomatically\"],",
            "                data[\"temperature\"][\"sendAutomatically\"],",
            "            )",
            "        if \"sendAutomaticallyAfter\" in data[\"temperature\"]:",
            "            s.setInt(",
            "                [\"temperature\", \"sendAutomaticallyAfter\"],",
            "                data[\"temperature\"][\"sendAutomaticallyAfter\"],",
            "                min=0,",
            "                max=30,",
            "            )",
            "",
            "    if \"terminalFilters\" in data:",
            "        s.set([\"terminalFilters\"], data[\"terminalFilters\"])",
            "",
            "    if \"system\" in data:",
            "        if \"actions\" in data[\"system\"]:",
            "            s.set([\"system\", \"actions\"], data[\"system\"][\"actions\"])",
            "        if \"events\" in data[\"system\"]:",
            "            s.set([\"system\", \"events\"], data[\"system\"][\"events\"])",
            "",
            "    if \"scripts\" in data:",
            "        if \"gcode\" in data[\"scripts\"] and isinstance(data[\"scripts\"][\"gcode\"], dict):",
            "            for name, script in data[\"scripts\"][\"gcode\"].items():",
            "                if name == \"snippets\":",
            "                    continue",
            "                if not isinstance(script, str):",
            "                    continue",
            "                s.saveScript(",
            "                    \"gcode\", name, script.replace(\"\\r\\n\", \"\\n\").replace(\"\\r\", \"\\n\")",
            "                )",
            "",
            "    if \"server\" in data:",
            "        if \"commands\" in data[\"server\"]:",
            "            if \"systemShutdownCommand\" in data[\"server\"][\"commands\"]:",
            "                s.set(",
            "                    [\"server\", \"commands\", \"systemShutdownCommand\"],",
            "                    data[\"server\"][\"commands\"][\"systemShutdownCommand\"],",
            "                )",
            "            if \"systemRestartCommand\" in data[\"server\"][\"commands\"]:",
            "                s.set(",
            "                    [\"server\", \"commands\", \"systemRestartCommand\"],",
            "                    data[\"server\"][\"commands\"][\"systemRestartCommand\"],",
            "                )",
            "            if \"serverRestartCommand\" in data[\"server\"][\"commands\"]:",
            "                s.set(",
            "                    [\"server\", \"commands\", \"serverRestartCommand\"],",
            "                    data[\"server\"][\"commands\"][\"serverRestartCommand\"],",
            "                )",
            "        if \"diskspace\" in data[\"server\"]:",
            "            if \"warning\" in data[\"server\"][\"diskspace\"]:",
            "                s.setInt(",
            "                    [\"server\", \"diskspace\", \"warning\"],",
            "                    data[\"server\"][\"diskspace\"][\"warning\"],",
            "                )",
            "            if \"critical\" in data[\"server\"][\"diskspace\"]:",
            "                s.setInt(",
            "                    [\"server\", \"diskspace\", \"critical\"],",
            "                    data[\"server\"][\"diskspace\"][\"critical\"],",
            "                )",
            "        if \"onlineCheck\" in data[\"server\"]:",
            "            if \"enabled\" in data[\"server\"][\"onlineCheck\"]:",
            "                s.setBoolean(",
            "                    [\"server\", \"onlineCheck\", \"enabled\"],",
            "                    data[\"server\"][\"onlineCheck\"][\"enabled\"],",
            "                )",
            "            if \"interval\" in data[\"server\"][\"onlineCheck\"]:",
            "                try:",
            "                    interval = int(data[\"server\"][\"onlineCheck\"][\"interval\"])",
            "                    s.setInt([\"server\", \"onlineCheck\", \"interval\"], interval * 60)",
            "                except ValueError:",
            "                    pass",
            "            if \"host\" in data[\"server\"][\"onlineCheck\"]:",
            "                s.set(",
            "                    [\"server\", \"onlineCheck\", \"host\"],",
            "                    data[\"server\"][\"onlineCheck\"][\"host\"],",
            "                )",
            "            if \"port\" in data[\"server\"][\"onlineCheck\"]:",
            "                s.setInt(",
            "                    [\"server\", \"onlineCheck\", \"port\"],",
            "                    data[\"server\"][\"onlineCheck\"][\"port\"],",
            "                )",
            "            if \"name\" in data[\"server\"][\"onlineCheck\"]:",
            "                s.set(",
            "                    [\"server\", \"onlineCheck\", \"name\"],",
            "                    data[\"server\"][\"onlineCheck\"][\"name\"],",
            "                )",
            "        if \"pluginBlacklist\" in data[\"server\"]:",
            "            if \"enabled\" in data[\"server\"][\"pluginBlacklist\"]:",
            "                s.setBoolean(",
            "                    [\"server\", \"pluginBlacklist\", \"enabled\"],",
            "                    data[\"server\"][\"pluginBlacklist\"][\"enabled\"],",
            "                )",
            "            if \"url\" in data[\"server\"][\"pluginBlacklist\"]:",
            "                s.set(",
            "                    [\"server\", \"pluginBlacklist\", \"url\"],",
            "                    data[\"server\"][\"pluginBlacklist\"][\"url\"],",
            "                )",
            "            if \"ttl\" in data[\"server\"][\"pluginBlacklist\"]:",
            "                try:",
            "                    ttl = int(data[\"server\"][\"pluginBlacklist\"][\"ttl\"])",
            "                    s.setInt([\"server\", \"pluginBlacklist\", \"ttl\"], ttl * 60)",
            "                except ValueError:",
            "                    pass",
            "        if \"allowFraming\" in data[\"server\"]:",
            "            s.setBoolean([\"server\", \"allowFraming\"], data[\"server\"][\"allowFraming\"])",
            "",
            "    if \"devel\" in data:",
            "        oldLog = s.getBoolean([\"devel\", \"pluginTimings\"])",
            "        if \"pluginTimings\" in data[\"devel\"]:",
            "            s.setBoolean([\"devel\", \"pluginTimings\"], data[\"devel\"][\"pluginTimings\"])",
            "        if oldLog and not s.getBoolean([\"devel\", \"pluginTimings\"]):",
            "            # disable plugin timing logging to plugintimings.log",
            "            logging.getLogger(\"PLUGIN_TIMINGS\").debug(\"Disabling plugin timings logging\")",
            "            logging.getLogger(\"PLUGIN_TIMINGS\").setLevel(logging.INFO)",
            "        elif not oldLog and s.getBoolean([\"devel\", \"pluginTimings\"]):",
            "            # enable plugin timing logging to plugintimings.log",
            "            logging.getLogger(\"PLUGIN_TIMINGS\").setLevel(logging.DEBUG)",
            "            logging.getLogger(\"PLUGIN_TIMINGS\").debug(\"Enabling plugin timings logging\")",
            "",
            "    if \"slicing\" in data:",
            "        if \"defaultSlicer\" in data[\"slicing\"]:",
            "            s.set([\"slicing\", \"defaultSlicer\"], data[\"slicing\"][\"defaultSlicer\"])",
            "",
            "    if \"plugins\" in data:",
            "        for plugin in octoprint.plugin.plugin_manager().get_implementations(",
            "            octoprint.plugin.SettingsPlugin",
            "        ):",
            "            plugin_id = plugin._identifier",
            "            if plugin_id in data[\"plugins\"]:",
            "                try:",
            "                    plugin.on_settings_save(data[\"plugins\"][plugin_id])",
            "                except TypeError:",
            "                    logger.warning(",
            "                        \"Could not save settings for plugin {name} ({version}). It may have called super(...)\".format(",
            "                            name=plugin._plugin_name, version=plugin._plugin_version",
            "                        )",
            "                    )",
            "                    logger.warning(",
            "                        \"in a way which has issues due to OctoPrint's dynamic reloading after plugin operations.\"",
            "                    )",
            "                    logger.warning(",
            "                        \"Please contact the plugin's author and ask to update the plugin to use a direct call like\"",
            "                    )",
            "                    logger.warning(",
            "                        \"octoprint.plugin.SettingsPlugin.on_settings_save(self, data) instead.\",",
            "                        exc_info=True,",
            "                    )",
            "                except Exception:",
            "                    logger.exception(",
            "                        \"Could not save settings for plugin {name} ({version})\".format(",
            "                            version=plugin._plugin_version, name=plugin._plugin_name",
            "                        ),",
            "                        extra={\"plugin\": plugin._identifier},",
            "                    )",
            "",
            "    s.save(trigger_event=True)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "584": [
                "_saveSettings"
            ],
            "642": [
                "_saveSettings"
            ],
            "858": [
                "_saveSettings"
            ],
            "945": [
                "_saveSettings"
            ],
            "1043": [
                "_saveSettings"
            ],
            "1044": [
                "_saveSettings"
            ],
            "1045": [
                "_saveSettings"
            ],
            "1046": [
                "_saveSettings"
            ],
            "1054": [
                "_saveSettings"
            ]
        },
        "addLocation": []
    }
}