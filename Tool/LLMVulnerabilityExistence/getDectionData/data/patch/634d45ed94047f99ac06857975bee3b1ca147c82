{
    "oslo_middleware/catch_errors.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 37,
                "afterPatchRowNumber": 37,
                "PatchRowcode": "         try:"
            },
            "1": {
                "beforePatchRowNumber": 38,
                "afterPatchRowNumber": 38,
                "PatchRowcode": "             response = req.get_response(self.application)"
            },
            "2": {
                "beforePatchRowNumber": 39,
                "afterPatchRowNumber": 39,
                "PatchRowcode": "         except Exception:"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 40,
                "PatchRowcode": "+            if hasattr(req, 'environ') and 'HTTP_X_AUTH_TOKEN' in req.environ:"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 41,
                "PatchRowcode": "+                req.environ['HTTP_X_AUTH_TOKEN'] = '*****'"
            },
            "5": {
                "beforePatchRowNumber": 40,
                "afterPatchRowNumber": 42,
                "PatchRowcode": "             LOG.exception(_LE('An error occurred during '"
            },
            "6": {
                "beforePatchRowNumber": 41,
                "afterPatchRowNumber": 43,
                "PatchRowcode": "                               'processing the request: %s'), req)"
            },
            "7": {
                "beforePatchRowNumber": 42,
                "afterPatchRowNumber": 44,
                "PatchRowcode": "             response = webob.exc.HTTPInternalServerError()"
            }
        },
        "frontPatchFile": [
            "# Copyright (c) 2013 NEC Corporation",
            "# All Rights Reserved.",
            "#",
            "#    Licensed under the Apache License, Version 2.0 (the \"License\"); you may",
            "#    not use this file except in compliance with the License. You may obtain",
            "#    a copy of the License at",
            "#",
            "#         http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "#    Unless required by applicable law or agreed to in writing, software",
            "#    distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
            "#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
            "#    License for the specific language governing permissions and limitations",
            "#    under the License.",
            "",
            "import logging",
            "",
            "import webob.dec",
            "import webob.exc",
            "",
            "from oslo_middleware._i18n import _LE",
            "from oslo_middleware import base",
            "",
            "",
            "LOG = logging.getLogger(__name__)",
            "",
            "",
            "class CatchErrors(base.ConfigurableMiddleware):",
            "    \"\"\"Middleware that provides high-level error handling.",
            "",
            "    It catches all exceptions from subsequent applications in WSGI pipeline",
            "    to hide internal errors from API response.",
            "    \"\"\"",
            "",
            "    @webob.dec.wsgify",
            "    def __call__(self, req):",
            "        try:",
            "            response = req.get_response(self.application)",
            "        except Exception:",
            "            LOG.exception(_LE('An error occurred during '",
            "                              'processing the request: %s'), req)",
            "            response = webob.exc.HTTPInternalServerError()",
            "        return response"
        ],
        "afterPatchFile": [
            "# Copyright (c) 2013 NEC Corporation",
            "# All Rights Reserved.",
            "#",
            "#    Licensed under the Apache License, Version 2.0 (the \"License\"); you may",
            "#    not use this file except in compliance with the License. You may obtain",
            "#    a copy of the License at",
            "#",
            "#         http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "#    Unless required by applicable law or agreed to in writing, software",
            "#    distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
            "#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
            "#    License for the specific language governing permissions and limitations",
            "#    under the License.",
            "",
            "import logging",
            "",
            "import webob.dec",
            "import webob.exc",
            "",
            "from oslo_middleware._i18n import _LE",
            "from oslo_middleware import base",
            "",
            "",
            "LOG = logging.getLogger(__name__)",
            "",
            "",
            "class CatchErrors(base.ConfigurableMiddleware):",
            "    \"\"\"Middleware that provides high-level error handling.",
            "",
            "    It catches all exceptions from subsequent applications in WSGI pipeline",
            "    to hide internal errors from API response.",
            "    \"\"\"",
            "",
            "    @webob.dec.wsgify",
            "    def __call__(self, req):",
            "        try:",
            "            response = req.get_response(self.application)",
            "        except Exception:",
            "            if hasattr(req, 'environ') and 'HTTP_X_AUTH_TOKEN' in req.environ:",
            "                req.environ['HTTP_X_AUTH_TOKEN'] = '*****'",
            "            LOG.exception(_LE('An error occurred during '",
            "                              'processing the request: %s'), req)",
            "            response = webob.exc.HTTPInternalServerError()",
            "        return response"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {},
        "addLocation": [
            "hyper_bump_it._hyper_bump_it.files"
        ]
    },
    "oslo_middleware/tests/test_catch_errors.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 26,
                "afterPatchRowNumber": 26,
                "PatchRowcode": "     def _test_has_request_id(self, application, expected_code=None):"
            },
            "1": {
                "beforePatchRowNumber": 27,
                "afterPatchRowNumber": 27,
                "PatchRowcode": "         app = catch_errors.CatchErrors(application)"
            },
            "2": {
                "beforePatchRowNumber": 28,
                "afterPatchRowNumber": 28,
                "PatchRowcode": "         req = webob.Request.blank('/test')"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 29,
                "PatchRowcode": "+        req.environ['HTTP_X_AUTH_TOKEN'] = 'hello=world'"
            },
            "4": {
                "beforePatchRowNumber": 29,
                "afterPatchRowNumber": 30,
                "PatchRowcode": "         res = req.get_response(app)"
            },
            "5": {
                "beforePatchRowNumber": 30,
                "afterPatchRowNumber": 31,
                "PatchRowcode": "         self.assertEqual(expected_code, res.status_int)"
            },
            "6": {
                "beforePatchRowNumber": 31,
                "afterPatchRowNumber": 32,
                "PatchRowcode": " "
            },
            "7": {
                "beforePatchRowNumber": 45,
                "afterPatchRowNumber": 46,
                "PatchRowcode": "             self._test_has_request_id(application,"
            },
            "8": {
                "beforePatchRowNumber": 46,
                "afterPatchRowNumber": 47,
                "PatchRowcode": "                                       webob.exc.HTTPInternalServerError.code)"
            },
            "9": {
                "beforePatchRowNumber": 47,
                "afterPatchRowNumber": 48,
                "PatchRowcode": "             self.assertEqual(1, log_exc.call_count)"
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 49,
                "PatchRowcode": "+            req_log = log_exc.call_args[0][1]"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 50,
                "PatchRowcode": "+            self.assertIn('X-Auth-Token: *****', str(req_log))"
            }
        },
        "frontPatchFile": [
            "# Copyright (c) 2013 NEC Corporation",
            "# All Rights Reserved.",
            "#",
            "#    Licensed under the Apache License, Version 2.0 (the \"License\"); you may",
            "#    not use this file except in compliance with the License. You may obtain",
            "#    a copy of the License at",
            "#",
            "#         http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "#    Unless required by applicable law or agreed to in writing, software",
            "#    distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
            "#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
            "#    License for the specific language governing permissions and limitations",
            "#    under the License.",
            "",
            "import mock",
            "from oslotest import base as test_base",
            "import webob.dec",
            "import webob.exc",
            "",
            "from oslo_middleware import catch_errors",
            "",
            "",
            "class CatchErrorsTest(test_base.BaseTestCase):",
            "",
            "    def _test_has_request_id(self, application, expected_code=None):",
            "        app = catch_errors.CatchErrors(application)",
            "        req = webob.Request.blank('/test')",
            "        res = req.get_response(app)",
            "        self.assertEqual(expected_code, res.status_int)",
            "",
            "    def test_success_response(self):",
            "        @webob.dec.wsgify",
            "        def application(req):",
            "            return 'Hello, World!!!'",
            "",
            "        self._test_has_request_id(application, webob.exc.HTTPOk.code)",
            "",
            "    def test_internal_server_error(self):",
            "        @webob.dec.wsgify",
            "        def application(req):",
            "            raise Exception()",
            "",
            "        with mock.patch.object(catch_errors.LOG, 'exception') as log_exc:",
            "            self._test_has_request_id(application,",
            "                                      webob.exc.HTTPInternalServerError.code)",
            "            self.assertEqual(1, log_exc.call_count)"
        ],
        "afterPatchFile": [
            "# Copyright (c) 2013 NEC Corporation",
            "# All Rights Reserved.",
            "#",
            "#    Licensed under the Apache License, Version 2.0 (the \"License\"); you may",
            "#    not use this file except in compliance with the License. You may obtain",
            "#    a copy of the License at",
            "#",
            "#         http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "#    Unless required by applicable law or agreed to in writing, software",
            "#    distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
            "#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
            "#    License for the specific language governing permissions and limitations",
            "#    under the License.",
            "",
            "import mock",
            "from oslotest import base as test_base",
            "import webob.dec",
            "import webob.exc",
            "",
            "from oslo_middleware import catch_errors",
            "",
            "",
            "class CatchErrorsTest(test_base.BaseTestCase):",
            "",
            "    def _test_has_request_id(self, application, expected_code=None):",
            "        app = catch_errors.CatchErrors(application)",
            "        req = webob.Request.blank('/test')",
            "        req.environ['HTTP_X_AUTH_TOKEN'] = 'hello=world'",
            "        res = req.get_response(app)",
            "        self.assertEqual(expected_code, res.status_int)",
            "",
            "    def test_success_response(self):",
            "        @webob.dec.wsgify",
            "        def application(req):",
            "            return 'Hello, World!!!'",
            "",
            "        self._test_has_request_id(application, webob.exc.HTTPOk.code)",
            "",
            "    def test_internal_server_error(self):",
            "        @webob.dec.wsgify",
            "        def application(req):",
            "            raise Exception()",
            "",
            "        with mock.patch.object(catch_errors.LOG, 'exception') as log_exc:",
            "            self._test_has_request_id(application,",
            "                                      webob.exc.HTTPInternalServerError.code)",
            "            self.assertEqual(1, log_exc.call_count)",
            "            req_log = log_exc.call_args[0][1]",
            "            self.assertIn('X-Auth-Token: *****', str(req_log))"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "-1",
            "-1"
        ],
        "dele_reviseLocation": {},
        "addLocation": [
            "oslo_middleware.tests.test_catch_errors.CatchErrorsTest.test_internal_server_error",
            "oslo_middleware.tests.test_catch_errors.CatchErrorsTest.test_success_response",
            "hyper_bump_it._hyper_bump_it.files"
        ]
    }
}