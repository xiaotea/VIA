{
    "dashboard/modules/reporter/profile_manager.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 1,
                "afterPatchRowNumber": 1,
                "PatchRowcode": " import asyncio"
            },
            "1": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2,
                "PatchRowcode": "+import shutil"
            },
            "2": {
                "beforePatchRowNumber": 2,
                "afterPatchRowNumber": 3,
                "PatchRowcode": " import subprocess"
            },
            "3": {
                "beforePatchRowNumber": 3,
                "afterPatchRowNumber": 4,
                "PatchRowcode": " import sys"
            },
            "4": {
                "beforePatchRowNumber": 4,
                "afterPatchRowNumber": 5,
                "PatchRowcode": " from pathlib import Path"
            },
            "5": {
                "beforePatchRowNumber": 49,
                "afterPatchRowNumber": 50,
                "PatchRowcode": " # If we can sudo, always try that. Otherwise, py-spy will only work if the user has"
            },
            "6": {
                "beforePatchRowNumber": 50,
                "afterPatchRowNumber": 51,
                "PatchRowcode": " # root privileges or has configured setuid on the py-spy script."
            },
            "7": {
                "beforePatchRowNumber": 51,
                "afterPatchRowNumber": 52,
                "PatchRowcode": " async def _can_passwordless_sudo() -> bool:"
            },
            "8": {
                "beforePatchRowNumber": 52,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    process = await asyncio.create_subprocess_shell("
            },
            "9": {
                "beforePatchRowNumber": 53,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        \"sudo -n true\","
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 53,
                "PatchRowcode": "+    process = await asyncio.create_subprocess_exec("
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 54,
                "PatchRowcode": "+        \"sudo\","
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 55,
                "PatchRowcode": "+        \"-n\","
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 56,
                "PatchRowcode": "+        \"true\","
            },
            "14": {
                "beforePatchRowNumber": 54,
                "afterPatchRowNumber": 57,
                "PatchRowcode": "         stdout=subprocess.PIPE,"
            },
            "15": {
                "beforePatchRowNumber": 55,
                "afterPatchRowNumber": 58,
                "PatchRowcode": "         stderr=subprocess.PIPE,"
            },
            "16": {
                "beforePatchRowNumber": 56,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        shell=True,"
            },
            "17": {
                "beforePatchRowNumber": 57,
                "afterPatchRowNumber": 59,
                "PatchRowcode": "     )"
            },
            "18": {
                "beforePatchRowNumber": 58,
                "afterPatchRowNumber": 60,
                "PatchRowcode": "     _, _ = await process.communicate()"
            },
            "19": {
                "beforePatchRowNumber": 59,
                "afterPatchRowNumber": 61,
                "PatchRowcode": "     return process.returncode == 0"
            },
            "20": {
                "beforePatchRowNumber": 65,
                "afterPatchRowNumber": 67,
                "PatchRowcode": "         self.profile_dir_path.mkdir(exist_ok=True)"
            },
            "21": {
                "beforePatchRowNumber": 66,
                "afterPatchRowNumber": 68,
                "PatchRowcode": " "
            },
            "22": {
                "beforePatchRowNumber": 67,
                "afterPatchRowNumber": 69,
                "PatchRowcode": "     async def trace_dump(self, pid: int, native: bool = False) -> (bool, str):"
            },
            "23": {
                "beforePatchRowNumber": 68,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        cmd = f\"py-spy dump -p {pid}\""
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 70,
                "PatchRowcode": "+        pyspy = shutil.which(\"py-spy\")"
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 71,
                "PatchRowcode": "+        if pyspy is None:"
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 72,
                "PatchRowcode": "+            return False, \"py-spy is not installed\""
            },
            "27": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 73,
                "PatchRowcode": "+"
            },
            "28": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 74,
                "PatchRowcode": "+        cmd = [pyspy, \"dump\", \"-p\", str(pid)]"
            },
            "29": {
                "beforePatchRowNumber": 69,
                "afterPatchRowNumber": 75,
                "PatchRowcode": "         # We"
            },
            "30": {
                "beforePatchRowNumber": 70,
                "afterPatchRowNumber": 76,
                "PatchRowcode": "         if sys.platform == \"linux\" and native:"
            },
            "31": {
                "beforePatchRowNumber": 71,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            cmd += \" --native\""
            },
            "32": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 77,
                "PatchRowcode": "+            cmd.append(\"--native\")"
            },
            "33": {
                "beforePatchRowNumber": 72,
                "afterPatchRowNumber": 78,
                "PatchRowcode": "         if await _can_passwordless_sudo():"
            },
            "34": {
                "beforePatchRowNumber": 73,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            cmd = \"sudo -n \" + cmd.replace(\"py-spy\", \"$(which py-spy)\")"
            },
            "35": {
                "beforePatchRowNumber": 74,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        process = await asyncio.create_subprocess_shell("
            },
            "36": {
                "beforePatchRowNumber": 75,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            cmd,"
            },
            "37": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 79,
                "PatchRowcode": "+            cmd = [\"sudo\", \"-n\"] + cmd"
            },
            "38": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 80,
                "PatchRowcode": "+        process = await asyncio.create_subprocess_exec("
            },
            "39": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 81,
                "PatchRowcode": "+            *cmd,"
            },
            "40": {
                "beforePatchRowNumber": 76,
                "afterPatchRowNumber": 82,
                "PatchRowcode": "             stdout=subprocess.PIPE,"
            },
            "41": {
                "beforePatchRowNumber": 77,
                "afterPatchRowNumber": 83,
                "PatchRowcode": "             stderr=subprocess.PIPE,"
            },
            "42": {
                "beforePatchRowNumber": 78,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            shell=True,"
            },
            "43": {
                "beforePatchRowNumber": 79,
                "afterPatchRowNumber": 84,
                "PatchRowcode": "         )"
            },
            "44": {
                "beforePatchRowNumber": 80,
                "afterPatchRowNumber": 85,
                "PatchRowcode": "         stdout, stderr = await process.communicate()"
            },
            "45": {
                "beforePatchRowNumber": 81,
                "afterPatchRowNumber": 86,
                "PatchRowcode": "         if process.returncode != 0:"
            },
            "46": {
                "beforePatchRowNumber": 86,
                "afterPatchRowNumber": 91,
                "PatchRowcode": "     async def cpu_profile("
            },
            "47": {
                "beforePatchRowNumber": 87,
                "afterPatchRowNumber": 92,
                "PatchRowcode": "         self, pid: int, format=\"flamegraph\", duration: float = 5, native: bool = False"
            },
            "48": {
                "beforePatchRowNumber": 88,
                "afterPatchRowNumber": 93,
                "PatchRowcode": "     ) -> (bool, str):"
            },
            "49": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 94,
                "PatchRowcode": "+        pyspy = shutil.which(\"py-spy\")"
            },
            "50": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 95,
                "PatchRowcode": "+        if pyspy is None:"
            },
            "51": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 96,
                "PatchRowcode": "+            return False, \"py-spy is not installed\""
            },
            "52": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 97,
                "PatchRowcode": "+"
            },
            "53": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 98,
                "PatchRowcode": "+        if format not in (\"flamegraph\", \"raw\", \"speedscope\"):"
            },
            "54": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 99,
                "PatchRowcode": "+            return ("
            },
            "55": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 100,
                "PatchRowcode": "+                False,"
            },
            "56": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 101,
                "PatchRowcode": "+                f\"Invalid format {format}, \" + \"must be [flamegraph, raw, speedscope]\","
            },
            "57": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 102,
                "PatchRowcode": "+            )"
            },
            "58": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 103,
                "PatchRowcode": "+"
            },
            "59": {
                "beforePatchRowNumber": 89,
                "afterPatchRowNumber": 104,
                "PatchRowcode": "         if format == \"flamegraph\":"
            },
            "60": {
                "beforePatchRowNumber": 90,
                "afterPatchRowNumber": 105,
                "PatchRowcode": "             extension = \"svg\""
            },
            "61": {
                "beforePatchRowNumber": 91,
                "afterPatchRowNumber": 106,
                "PatchRowcode": "         else:"
            },
            "62": {
                "beforePatchRowNumber": 92,
                "afterPatchRowNumber": 107,
                "PatchRowcode": "             extension = \"txt\""
            },
            "63": {
                "beforePatchRowNumber": 93,
                "afterPatchRowNumber": 108,
                "PatchRowcode": "         profile_file_path = ("
            },
            "64": {
                "beforePatchRowNumber": 94,
                "afterPatchRowNumber": 109,
                "PatchRowcode": "             self.profile_dir_path / f\"{format}_{pid}_cpu_profiling.{extension}\""
            },
            "65": {
                "beforePatchRowNumber": 95,
                "afterPatchRowNumber": 110,
                "PatchRowcode": "         )"
            },
            "66": {
                "beforePatchRowNumber": 96,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        cmd = ("
            },
            "67": {
                "beforePatchRowNumber": 97,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            f\"py-spy record \""
            },
            "68": {
                "beforePatchRowNumber": 98,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            f\"-o {profile_file_path} -p {pid} -d {duration} -f {format}\""
            },
            "69": {
                "beforePatchRowNumber": 99,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        )"
            },
            "70": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 111,
                "PatchRowcode": "+        cmd = ["
            },
            "71": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 112,
                "PatchRowcode": "+            pyspy,"
            },
            "72": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 113,
                "PatchRowcode": "+            \"record\","
            },
            "73": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 114,
                "PatchRowcode": "+            \"-o\","
            },
            "74": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 115,
                "PatchRowcode": "+            profile_file_path,"
            },
            "75": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 116,
                "PatchRowcode": "+            \"-p\","
            },
            "76": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 117,
                "PatchRowcode": "+            str(pid),"
            },
            "77": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 118,
                "PatchRowcode": "+            \"-d\","
            },
            "78": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 119,
                "PatchRowcode": "+            str(duration),"
            },
            "79": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 120,
                "PatchRowcode": "+            \"-f\","
            },
            "80": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 121,
                "PatchRowcode": "+            format,"
            },
            "81": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 122,
                "PatchRowcode": "+        ]"
            },
            "82": {
                "beforePatchRowNumber": 100,
                "afterPatchRowNumber": 123,
                "PatchRowcode": "         if sys.platform == \"linux\" and native:"
            },
            "83": {
                "beforePatchRowNumber": 101,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            cmd += \" --native\""
            },
            "84": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 124,
                "PatchRowcode": "+            cmd.append(\"--native\")"
            },
            "85": {
                "beforePatchRowNumber": 102,
                "afterPatchRowNumber": 125,
                "PatchRowcode": "         if await _can_passwordless_sudo():"
            },
            "86": {
                "beforePatchRowNumber": 103,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            cmd = \"sudo -n \" + cmd.replace(\"py-spy\", \"$(which py-spy)\")"
            },
            "87": {
                "beforePatchRowNumber": 104,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        process = await asyncio.create_subprocess_shell("
            },
            "88": {
                "beforePatchRowNumber": 105,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            cmd,"
            },
            "89": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 126,
                "PatchRowcode": "+            cmd = [\"sudo\", \"-n\"] + cmd"
            },
            "90": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 127,
                "PatchRowcode": "+        process = await asyncio.create_subprocess_exec("
            },
            "91": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 128,
                "PatchRowcode": "+            *cmd,"
            },
            "92": {
                "beforePatchRowNumber": 106,
                "afterPatchRowNumber": 129,
                "PatchRowcode": "             stdout=subprocess.PIPE,"
            },
            "93": {
                "beforePatchRowNumber": 107,
                "afterPatchRowNumber": 130,
                "PatchRowcode": "             stderr=subprocess.PIPE,"
            },
            "94": {
                "beforePatchRowNumber": 108,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            shell=True,"
            },
            "95": {
                "beforePatchRowNumber": 109,
                "afterPatchRowNumber": 131,
                "PatchRowcode": "         )"
            },
            "96": {
                "beforePatchRowNumber": 110,
                "afterPatchRowNumber": 132,
                "PatchRowcode": "         stdout, stderr = await process.communicate()"
            },
            "97": {
                "beforePatchRowNumber": 111,
                "afterPatchRowNumber": 133,
                "PatchRowcode": "         if process.returncode != 0:"
            }
        },
        "frontPatchFile": [
            "import asyncio",
            "import subprocess",
            "import sys",
            "from pathlib import Path",
            "",
            "import logging",
            "",
            "logger = logging.getLogger(__name__)",
            "",
            "DARWIN_SET_CHOWN_CMD = \"sudo chown root: `which py-spy`\"",
            "LINUX_SET_CHOWN_CMD = \"sudo chown root:root `which py-spy`\"",
            "",
            "PYSPY_PERMISSIONS_ERROR_MESSAGE = \"\"\"",
            "Note that this command requires `py-spy` to be installed with root permissions. You",
            "can install `py-spy` and give it root permissions as follows:",
            "  $ pip install py-spy",
            "  $ {set_chown_command}",
            "  $ sudo chmod u+s `which py-spy`",
            "",
            "Alternatively, you can start Ray with passwordless sudo / root permissions.",
            "",
            "\"\"\"",
            "",
            "",
            "def _format_failed_pyspy_command(cmd, stdout, stderr) -> str:",
            "    stderr_str = stderr.decode(\"utf-8\")",
            "    extra_message = \"\"",
            "",
            "    # If some sort of permission error returned, show a message about how",
            "    # to set up permissions correctly.",
            "    if \"permission\" in stderr_str.lower():",
            "        set_chown_command = (",
            "            DARWIN_SET_CHOWN_CMD if sys.platform == \"darwin\" else LINUX_SET_CHOWN_CMD",
            "        )",
            "        extra_message = PYSPY_PERMISSIONS_ERROR_MESSAGE.format(",
            "            set_chown_command=set_chown_command",
            "        )",
            "",
            "    return f\"\"\"Failed to execute `{cmd}`.",
            "{extra_message}",
            "=== stderr ===",
            "{stderr.decode(\"utf-8\")}",
            "",
            "=== stdout ===",
            "{stdout.decode(\"utf-8\")}",
            "\"\"\"",
            "",
            "",
            "# If we can sudo, always try that. Otherwise, py-spy will only work if the user has",
            "# root privileges or has configured setuid on the py-spy script.",
            "async def _can_passwordless_sudo() -> bool:",
            "    process = await asyncio.create_subprocess_shell(",
            "        \"sudo -n true\",",
            "        stdout=subprocess.PIPE,",
            "        stderr=subprocess.PIPE,",
            "        shell=True,",
            "    )",
            "    _, _ = await process.communicate()",
            "    return process.returncode == 0",
            "",
            "",
            "class CpuProfilingManager:",
            "    def __init__(self, profile_dir_path: str):",
            "        self.profile_dir_path = Path(profile_dir_path)",
            "        self.profile_dir_path.mkdir(exist_ok=True)",
            "",
            "    async def trace_dump(self, pid: int, native: bool = False) -> (bool, str):",
            "        cmd = f\"py-spy dump -p {pid}\"",
            "        # We",
            "        if sys.platform == \"linux\" and native:",
            "            cmd += \" --native\"",
            "        if await _can_passwordless_sudo():",
            "            cmd = \"sudo -n \" + cmd.replace(\"py-spy\", \"$(which py-spy)\")",
            "        process = await asyncio.create_subprocess_shell(",
            "            cmd,",
            "            stdout=subprocess.PIPE,",
            "            stderr=subprocess.PIPE,",
            "            shell=True,",
            "        )",
            "        stdout, stderr = await process.communicate()",
            "        if process.returncode != 0:",
            "            return False, _format_failed_pyspy_command(cmd, stdout, stderr)",
            "        else:",
            "            return True, stdout.decode(\"utf-8\")",
            "",
            "    async def cpu_profile(",
            "        self, pid: int, format=\"flamegraph\", duration: float = 5, native: bool = False",
            "    ) -> (bool, str):",
            "        if format == \"flamegraph\":",
            "            extension = \"svg\"",
            "        else:",
            "            extension = \"txt\"",
            "        profile_file_path = (",
            "            self.profile_dir_path / f\"{format}_{pid}_cpu_profiling.{extension}\"",
            "        )",
            "        cmd = (",
            "            f\"py-spy record \"",
            "            f\"-o {profile_file_path} -p {pid} -d {duration} -f {format}\"",
            "        )",
            "        if sys.platform == \"linux\" and native:",
            "            cmd += \" --native\"",
            "        if await _can_passwordless_sudo():",
            "            cmd = \"sudo -n \" + cmd.replace(\"py-spy\", \"$(which py-spy)\")",
            "        process = await asyncio.create_subprocess_shell(",
            "            cmd,",
            "            stdout=subprocess.PIPE,",
            "            stderr=subprocess.PIPE,",
            "            shell=True,",
            "        )",
            "        stdout, stderr = await process.communicate()",
            "        if process.returncode != 0:",
            "            return False, _format_failed_pyspy_command(cmd, stdout, stderr)",
            "        else:",
            "            return True, open(profile_file_path, \"rb\").read()"
        ],
        "afterPatchFile": [
            "import asyncio",
            "import shutil",
            "import subprocess",
            "import sys",
            "from pathlib import Path",
            "",
            "import logging",
            "",
            "logger = logging.getLogger(__name__)",
            "",
            "DARWIN_SET_CHOWN_CMD = \"sudo chown root: `which py-spy`\"",
            "LINUX_SET_CHOWN_CMD = \"sudo chown root:root `which py-spy`\"",
            "",
            "PYSPY_PERMISSIONS_ERROR_MESSAGE = \"\"\"",
            "Note that this command requires `py-spy` to be installed with root permissions. You",
            "can install `py-spy` and give it root permissions as follows:",
            "  $ pip install py-spy",
            "  $ {set_chown_command}",
            "  $ sudo chmod u+s `which py-spy`",
            "",
            "Alternatively, you can start Ray with passwordless sudo / root permissions.",
            "",
            "\"\"\"",
            "",
            "",
            "def _format_failed_pyspy_command(cmd, stdout, stderr) -> str:",
            "    stderr_str = stderr.decode(\"utf-8\")",
            "    extra_message = \"\"",
            "",
            "    # If some sort of permission error returned, show a message about how",
            "    # to set up permissions correctly.",
            "    if \"permission\" in stderr_str.lower():",
            "        set_chown_command = (",
            "            DARWIN_SET_CHOWN_CMD if sys.platform == \"darwin\" else LINUX_SET_CHOWN_CMD",
            "        )",
            "        extra_message = PYSPY_PERMISSIONS_ERROR_MESSAGE.format(",
            "            set_chown_command=set_chown_command",
            "        )",
            "",
            "    return f\"\"\"Failed to execute `{cmd}`.",
            "{extra_message}",
            "=== stderr ===",
            "{stderr.decode(\"utf-8\")}",
            "",
            "=== stdout ===",
            "{stdout.decode(\"utf-8\")}",
            "\"\"\"",
            "",
            "",
            "# If we can sudo, always try that. Otherwise, py-spy will only work if the user has",
            "# root privileges or has configured setuid on the py-spy script.",
            "async def _can_passwordless_sudo() -> bool:",
            "    process = await asyncio.create_subprocess_exec(",
            "        \"sudo\",",
            "        \"-n\",",
            "        \"true\",",
            "        stdout=subprocess.PIPE,",
            "        stderr=subprocess.PIPE,",
            "    )",
            "    _, _ = await process.communicate()",
            "    return process.returncode == 0",
            "",
            "",
            "class CpuProfilingManager:",
            "    def __init__(self, profile_dir_path: str):",
            "        self.profile_dir_path = Path(profile_dir_path)",
            "        self.profile_dir_path.mkdir(exist_ok=True)",
            "",
            "    async def trace_dump(self, pid: int, native: bool = False) -> (bool, str):",
            "        pyspy = shutil.which(\"py-spy\")",
            "        if pyspy is None:",
            "            return False, \"py-spy is not installed\"",
            "",
            "        cmd = [pyspy, \"dump\", \"-p\", str(pid)]",
            "        # We",
            "        if sys.platform == \"linux\" and native:",
            "            cmd.append(\"--native\")",
            "        if await _can_passwordless_sudo():",
            "            cmd = [\"sudo\", \"-n\"] + cmd",
            "        process = await asyncio.create_subprocess_exec(",
            "            *cmd,",
            "            stdout=subprocess.PIPE,",
            "            stderr=subprocess.PIPE,",
            "        )",
            "        stdout, stderr = await process.communicate()",
            "        if process.returncode != 0:",
            "            return False, _format_failed_pyspy_command(cmd, stdout, stderr)",
            "        else:",
            "            return True, stdout.decode(\"utf-8\")",
            "",
            "    async def cpu_profile(",
            "        self, pid: int, format=\"flamegraph\", duration: float = 5, native: bool = False",
            "    ) -> (bool, str):",
            "        pyspy = shutil.which(\"py-spy\")",
            "        if pyspy is None:",
            "            return False, \"py-spy is not installed\"",
            "",
            "        if format not in (\"flamegraph\", \"raw\", \"speedscope\"):",
            "            return (",
            "                False,",
            "                f\"Invalid format {format}, \" + \"must be [flamegraph, raw, speedscope]\",",
            "            )",
            "",
            "        if format == \"flamegraph\":",
            "            extension = \"svg\"",
            "        else:",
            "            extension = \"txt\"",
            "        profile_file_path = (",
            "            self.profile_dir_path / f\"{format}_{pid}_cpu_profiling.{extension}\"",
            "        )",
            "        cmd = [",
            "            pyspy,",
            "            \"record\",",
            "            \"-o\",",
            "            profile_file_path,",
            "            \"-p\",",
            "            str(pid),",
            "            \"-d\",",
            "            str(duration),",
            "            \"-f\",",
            "            format,",
            "        ]",
            "        if sys.platform == \"linux\" and native:",
            "            cmd.append(\"--native\")",
            "        if await _can_passwordless_sudo():",
            "            cmd = [\"sudo\", \"-n\"] + cmd",
            "        process = await asyncio.create_subprocess_exec(",
            "            *cmd,",
            "            stdout=subprocess.PIPE,",
            "            stderr=subprocess.PIPE,",
            "        )",
            "        stdout, stderr = await process.communicate()",
            "        if process.returncode != 0:",
            "            return False, _format_failed_pyspy_command(cmd, stdout, stderr)",
            "        else:",
            "            return True, open(profile_file_path, \"rb\").read()"
        ],
        "action": [
            "0",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "2",
            "2",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "2",
            "2",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "52": [
                "process"
            ],
            "53": [],
            "56": [],
            "68": [
                "CpuProfilingManager"
            ],
            "71": [
                "CpuProfilingManager"
            ],
            "73": [
                "CpuProfilingManager"
            ],
            "74": [
                "CpuProfilingManager"
            ],
            "75": [
                "CpuProfilingManager"
            ],
            "78": [
                "CpuProfilingManager"
            ],
            "96": [
                "CpuProfilingManager"
            ],
            "97": [
                "CpuProfilingManager"
            ],
            "98": [
                "CpuProfilingManager"
            ],
            "99": [
                "CpuProfilingManager"
            ],
            "101": [
                "CpuProfilingManager"
            ],
            "103": [
                "CpuProfilingManager"
            ],
            "104": [
                "CpuProfilingManager"
            ],
            "105": [
                "CpuProfilingManager"
            ],
            "108": [
                "CpuProfilingManager"
            ]
        },
        "addLocation": []
    }
}