{
    "rdiffweb/controller/page_admin.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 190,
                "afterPatchRowNumber": 190,
                "PatchRowcode": "         _('Quota Used'), validators=[validators.optional()], description=_(\"Disk spaces (in bytes) used by this user.\")"
            },
            "1": {
                "beforePatchRowNumber": 191,
                "afterPatchRowNumber": 191,
                "PatchRowcode": "     )"
            },
            "2": {
                "beforePatchRowNumber": 192,
                "afterPatchRowNumber": 192,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": 193,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    def __init__(self, *args, **kwargs):"
            },
            "4": {
                "beforePatchRowNumber": 194,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        super().__init__(*args, **kwargs)"
            },
            "5": {
                "beforePatchRowNumber": 195,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.password.validators += ["
            },
            "6": {
                "beforePatchRowNumber": 196,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            validators.length("
            },
            "7": {
                "beforePatchRowNumber": 197,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                min=self.app.cfg.password_min_length,"
            },
            "8": {
                "beforePatchRowNumber": 198,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                max=self.app.cfg.password_max_length,"
            },
            "9": {
                "beforePatchRowNumber": 199,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                message=_('Password must have between %(min)d and %(max)d characters.'),"
            },
            "10": {
                "beforePatchRowNumber": 200,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            )"
            },
            "11": {
                "beforePatchRowNumber": 201,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        ]"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 193,
                "PatchRowcode": "+    def validate_password(self, field):"
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 194,
                "PatchRowcode": "+        validator = validators.length("
            },
            "14": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 195,
                "PatchRowcode": "+            min=self.app.cfg.password_min_length,"
            },
            "15": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 196,
                "PatchRowcode": "+            max=self.app.cfg.password_max_length,"
            },
            "16": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 197,
                "PatchRowcode": "+            message=_('Password must have between %(min)d and %(max)d characters.'),"
            },
            "17": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 198,
                "PatchRowcode": "+        )"
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 199,
                "PatchRowcode": "+        validator(self, field)"
            },
            "19": {
                "beforePatchRowNumber": 202,
                "afterPatchRowNumber": 200,
                "PatchRowcode": " "
            },
            "20": {
                "beforePatchRowNumber": 203,
                "afterPatchRowNumber": 201,
                "PatchRowcode": "     @property"
            },
            "21": {
                "beforePatchRowNumber": 204,
                "afterPatchRowNumber": 202,
                "PatchRowcode": "     def app(self):"
            },
            "22": {
                "beforePatchRowNumber": 340,
                "afterPatchRowNumber": 338,
                "PatchRowcode": "             else:"
            },
            "23": {
                "beforePatchRowNumber": 341,
                "afterPatchRowNumber": 339,
                "PatchRowcode": "                 flash(_(\"Cannot edit user `%s`: user doesn't exists\") % username, level='error')"
            },
            "24": {
                "beforePatchRowNumber": 342,
                "afterPatchRowNumber": 340,
                "PatchRowcode": "         elif action == 'delete':"
            },
            "25": {
                "beforePatchRowNumber": 343,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            self._delete_user(action, DeleteUserForm())"
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 341,
                "PatchRowcode": "+            form = DeleteUserForm()"
            },
            "27": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 342,
                "PatchRowcode": "+            if form.validate_on_submit():"
            },
            "28": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 343,
                "PatchRowcode": "+                self._delete_user(action, form)"
            },
            "29": {
                "beforePatchRowNumber": 344,
                "afterPatchRowNumber": 344,
                "PatchRowcode": " "
            },
            "30": {
                "beforePatchRowNumber": 345,
                "afterPatchRowNumber": 345,
                "PatchRowcode": "         params = {"
            },
            "31": {
                "beforePatchRowNumber": 346,
                "afterPatchRowNumber": 346,
                "PatchRowcode": "             \"add_form\": UserForm(formdata=None),"
            }
        },
        "frontPatchFile": [
            "# -*- coding: utf-8 -*-",
            "# rdiffweb, A web interface to rdiff-backup repositories",
            "# Copyright (C) 2012-2021 rdiffweb contributors",
            "#",
            "# This program is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This program is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with this program.  If not, see <http://www.gnu.org/licenses/>.",
            "",
            "import grp",
            "import logging",
            "import os",
            "import platform",
            "import pwd",
            "import subprocess",
            "import sys",
            "from collections import OrderedDict",
            "",
            "import cherrypy",
            "import humanfriendly",
            "import psutil",
            "from wtforms import validators, widgets",
            "from wtforms.fields import Field, PasswordField, SelectField, StringField",
            "from wtforms.fields.html5 import EmailField",
            "",
            "from rdiffweb.controller import Controller, flash",
            "from rdiffweb.controller.cherrypy_wtf import CherryForm",
            "from rdiffweb.core.config import Option",
            "from rdiffweb.core.librdiff import rdiff_backup_version",
            "from rdiffweb.core.store import ADMIN_ROLE, MAINTAINER_ROLE, USER_ROLE",
            "from rdiffweb.tools.i18n import ugettext as _",
            "",
            "# Define the logger",
            "logger = logging.getLogger(__name__)",
            "",
            "",
            "def get_pyinfo():",
            "    try:",
            "        import distro",
            "",
            "        yield _('OS Version'), '%s %s (%s %s)' % (",
            "            platform.system(),",
            "            platform.release(),",
            "            distro.name().capitalize(),",
            "            distro.version(),",
            "        )",
            "    except Exception:",
            "        yield _('OS Version'), '%s %s' % (platform.system(), platform.release())",
            "    if hasattr(os, 'path'):",
            "        yield _('OS Path'), os.environ['PATH']",
            "    if hasattr(sys, 'version'):",
            "        yield _('Python Version'), ''.join(sys.version)",
            "    if hasattr(sys, 'subversion'):",
            "        yield _('Python Subversion'), ', '.join(sys.subversion)",
            "    if hasattr(sys, 'prefix'):",
            "        yield _('Python Prefix'), sys.prefix",
            "    if hasattr(sys, 'executable'):",
            "        yield _('Python Executable'), sys.executable",
            "    if hasattr(sys, 'path'):",
            "        yield _('Python Path'), ', '.join(sys.path)",
            "",
            "",
            "def get_osinfo():",
            "    def gr_name(gid):",
            "        try:",
            "            return grp.getgrgid(gid).gr_name",
            "        except Exception:",
            "            return",
            "",
            "    def pw_name(uid):",
            "        try:",
            "            return pwd.getpwuid(os.getuid()).pw_name",
            "        except Exception:",
            "            return",
            "",
            "    if hasattr(sys, 'getfilesystemencoding'):",
            "        yield _('File System Encoding'), sys.getfilesystemencoding()",
            "    if hasattr(os, 'getcwd'):",
            "        yield _('Current Working Directory'), os.getcwd()",
            "    if hasattr(os, 'getegid'):",
            "        yield _('Effective Group'), '%s (%s)' % (os.getegid(), gr_name(os.getegid()))",
            "    if hasattr(os, 'geteuid'):",
            "        yield _('Effective User'), '%s (%s)' % (os.geteuid(), pw_name(os.geteuid))",
            "    if hasattr(os, 'getgid'):",
            "        yield _('Group'), '%s (%s)' % (os.getgid(), gr_name(os.getgid()))",
            "    if hasattr(os, 'getuid'):",
            "        yield _('User'), '%s (%s)' % (os.getuid(), gr_name(os.getuid()))",
            "    if hasattr(os, 'getgroups'):",
            "        yield _('Group Membership'), ', '.join(['%s (%s)' % (gid, gr_name(gid)) for gid in os.getgroups()])",
            "    try:",
            "        if hasattr(os, 'getpid') and hasattr(os, 'getppid'):",
            "            yield _('Process ID'), ('%s (parent: %s)' % (os.getpid(), os.getppid()))",
            "    except Exception:",
            "        pass",
            "",
            "",
            "def get_hwinfo():",
            "    if hasattr(os, 'getloadavg'):",
            "        yield _('Load Average'), ', '.join(map(str, map(lambda x: round(x, 2), os.getloadavg())))",
            "    yield _('CPU Count'), psutil.cpu_count()",
            "    meminfo = psutil.virtual_memory()",
            "    yield _('Memory usage'), '%s / %s' % (",
            "        humanfriendly.format_size(meminfo.used),",
            "        humanfriendly.format_size(meminfo.total),",
            "    )",
            "",
            "",
            "def get_pkginfo():",
            "    yield _('Rdiff-Backup Version'), '.'.join([str(i) for i in rdiff_backup_version()])",
            "    import jinja2",
            "",
            "    yield _('Jinja2 Version'), getattr(jinja2, '__version__')",
            "    yield _('CherryPy Version'), getattr(cherrypy, '__version__')",
            "    import sqlalchemy",
            "",
            "    yield _('SQLAlchemy Version'), getattr(sqlalchemy, '__version__')",
            "    try:",
            "        import ldap",
            "",
            "        yield _('LDAP Version'), getattr(ldap, '__version__')",
            "        yield _('LDAP SASL Support (Cyrus-SASL)'), ldap.SASL_AVAIL  # @UndefinedVariable",
            "        yield _('LDAP TLS Support (OpenSSL)'), ldap.TLS_AVAIL  # @UndefinedVariable",
            "    except Exception:",
            "        pass",
            "",
            "",
            "class SizeField(Field):",
            "    \"\"\"",
            "    A text field which stores a file size as GiB or GB format.",
            "    \"\"\"",
            "",
            "    widget = widgets.TextInput()",
            "",
            "    def __init__(self, label=None, validators=None, **kwargs):",
            "        super(SizeField, self).__init__(label, validators, **kwargs)",
            "",
            "    def _value(self):",
            "        if self.raw_data:",
            "            return ' '.join(self.raw_data)",
            "        else:",
            "            return self.data and humanfriendly.format_size(self.data, binary=True) or ''",
            "",
            "    def process_formdata(self, valuelist):",
            "        if valuelist:",
            "            value_str = ''.join(valuelist)",
            "            # parse_size doesn't handle locales.this mean we need to",
            "            # replace ',' by '.' to get parse and prefix number with 0",
            "            value_str = value_str.replace(',', '.').strip()",
            "            # a value must start with a number.",
            "            if value_str.startswith('.'):",
            "                value_str = '0' + value_str",
            "            try:",
            "                self.data = humanfriendly.parse_size(value_str)",
            "            except humanfriendly.InvalidSize:",
            "                self.data = None",
            "                raise ValueError(self.gettext('Not a valid file size value'))",
            "",
            "",
            "class UserForm(CherryForm):",
            "    userid = StringField(_('UserID'))",
            "    username = StringField(_('Username'), validators=[validators.data_required()])",
            "    email = EmailField(_('Email'), validators=[validators.optional()])",
            "    password = PasswordField(_('Password'), validators=[validators.optional()])",
            "    user_root = StringField(",
            "        _('Root directory'), description=_(\"Absolute path defining the location of the repositories for this user.\")",
            "    )",
            "    role = SelectField(",
            "        _('User Role'),",
            "        coerce=int,",
            "        choices=[(ADMIN_ROLE, _(\"Admin\")), (MAINTAINER_ROLE, _(\"Maintainer\")), (USER_ROLE, _(\"User\"))],",
            "        default=USER_ROLE,",
            "        description=_(",
            "            \"Admin: may browse and delete everything. Maintainer: may browse and delete their own repo. User: may only browser their own repo.\"",
            "        ),",
            "    )",
            "    disk_quota = SizeField(",
            "        _('Disk space'),",
            "        validators=[validators.optional()],",
            "        description=_(\"Users disk spaces (in bytes). Set to 0 to remove quota (unlimited).\"),",
            "    )",
            "    disk_usage = SizeField(",
            "        _('Quota Used'), validators=[validators.optional()], description=_(\"Disk spaces (in bytes) used by this user.\")",
            "    )",
            "",
            "    def __init__(self, *args, **kwargs):",
            "        super().__init__(*args, **kwargs)",
            "        self.password.validators += [",
            "            validators.length(",
            "                min=self.app.cfg.password_min_length,",
            "                max=self.app.cfg.password_max_length,",
            "                message=_('Password must have between %(min)d and %(max)d characters.'),",
            "            )",
            "        ]",
            "",
            "    @property",
            "    def app(self):",
            "        return cherrypy.request.app",
            "",
            "    def validate_role(self, field):",
            "        # Don't allow the user to changes it's \"role\" state.",
            "        currentuser = cherrypy.request.currentuser",
            "        if self.username.data == currentuser.username and self.role.data != currentuser.role:",
            "            raise ValueError(_('Cannot edit your own role.'))",
            "",
            "    def populate_obj(self, userobj):",
            "        # Save password if defined",
            "        if self.password.data:",
            "            userobj.set_password(self.password.data, old_password=None)",
            "        userobj.role = self.role.data",
            "        userobj.email = self.email.data or ''",
            "        userobj.user_root = self.user_root.data",
            "        if not userobj.valid_user_root():",
            "            flash(_(\"User's root directory %s is not accessible!\") % userobj.user_root, level='error')",
            "            logger.warning(\"user's root directory %s is not accessible\" % userobj.user_root)",
            "        # Try to update disk quota if the human readable value changed.",
            "        # Report error using flash.",
            "        new_quota = self.disk_quota.data or 0",
            "        old_quota = humanfriendly.parse_size(humanfriendly.format_size(self.disk_quota.object_data or 0, binary=True))",
            "        if old_quota != new_quota:",
            "            userobj.disk_quota = new_quota",
            "            # Setting quota will silently fail. Check if quota was updated.",
            "            if userobj.disk_quota != new_quota:",
            "                flash(_(\"Setting user's quota is not supported\"), level='warning')",
            "",
            "",
            "class EditUserForm(UserForm):",
            "    def __init__(self, **kwargs):",
            "        super().__init__(**kwargs)",
            "        # Make username field read-only",
            "        self.username.render_kw = {'readonly': True}",
            "        self.username.populate_obj = lambda *args, **kwargs: None",
            "",
            "",
            "class DeleteUserForm(CherryForm):",
            "    username = StringField(_('Username'), validators=[validators.data_required()])",
            "",
            "",
            "@cherrypy.tools.is_admin()",
            "class AdminPage(Controller):",
            "    \"\"\"Administration pages. Allow to manage users database.\"\"\"",
            "",
            "    logfile = Option('log_file')",
            "    logaccessfile = Option('log_access_file')",
            "",
            "    def _delete_user(self, action, form):",
            "        assert action == 'delete'",
            "        assert form",
            "        # Validate form.",
            "        if not form.validate():",
            "            flash(form.error_message, level='error')",
            "            return",
            "        if form.username.data == self.app.currentuser.username:",
            "            flash(_(\"You cannot remove your own account!\"), level='error')",
            "        else:",
            "            try:",
            "                user = self.app.store.get_user(form.username.data)",
            "                if user:",
            "                    user.delete()",
            "                    flash(_(\"User account removed.\"))",
            "                else:",
            "                    flash(_(\"User doesn't exists!\"), level='warning')",
            "            except ValueError as e:",
            "                flash(e, level='error')",
            "",
            "    def _get_log_files(self):",
            "        \"\"\"",
            "        Return a list of log files to be shown in admin area.",
            "        \"\"\"",
            "        return [fn for fn in [self.logfile, self.logaccessfile] if fn]",
            "",
            "    def _get_log_data(self, fn, num=2000):",
            "        \"\"\"",
            "        Return a list of log files to be shown in admin area.",
            "        \"\"\"",
            "        try:",
            "            return subprocess.check_output(['tail', '-n', str(num), fn], stderr=subprocess.STDOUT).decode('utf-8')",
            "        except Exception:",
            "            logging.exception('fail to get log file content')",
            "            return \"Error getting file content\"",
            "",
            "    @cherrypy.expose",
            "    def default(self):",
            "        params = {\"user_count\": self.app.store.count_users(), \"repo_count\": self.app.store.count_repos()}",
            "",
            "        return self._compile_template(\"admin.html\", **params)",
            "",
            "    @cherrypy.expose",
            "    def logs(self, filename=u\"\"):",
            "        # get list of log file available.",
            "        data = \"\"",
            "        logfiles = OrderedDict([(os.path.basename(fn), fn) for fn in self._get_log_files()])",
            "        if logfiles:",
            "            filename = filename or list(logfiles.keys())[0]",
            "            if filename not in logfiles:",
            "                raise cherrypy.HTTPError(404, 'invalid log file: ' + filename)",
            "            data = self._get_log_data(logfiles.get(filename))",
            "",
            "        params = {",
            "            \"filename\": filename,",
            "            \"logfiles\": logfiles.keys(),",
            "            \"data\": data,",
            "        }",
            "        return self._compile_template(\"admin_logs.html\", **params)",
            "",
            "    @cherrypy.expose",
            "    def users(self, username=None, criteria=u\"\", search=u\"\", action=u\"\", **kwargs):",
            "",
            "        # If we're just showing the initial page, just do that",
            "        if action == \"add\":",
            "            form = UserForm()",
            "            if form.validate_on_submit():",
            "                try:",
            "                    user = self.app.store.add_user(username)",
            "                    form.populate_obj(user)",
            "                    flash(_(\"User added successfully.\"))",
            "                except Exception as e:",
            "                    flash(str(e), level='error')",
            "            else:",
            "                flash(form.error_message, level='error')",
            "        elif action == \"edit\":",
            "            user = self.app.store.get_user(username)",
            "            if user:",
            "                form = EditUserForm(obj=user)",
            "                if form.validate_on_submit():",
            "                    try:",
            "                        form.populate_obj(user)",
            "                        flash(_(\"User information modified successfully.\"))",
            "                    except Exception as e:",
            "                        flash(str(e), level='error')",
            "                else:",
            "                    flash(form.error_message, level='error')",
            "            else:",
            "                flash(_(\"Cannot edit user `%s`: user doesn't exists\") % username, level='error')",
            "        elif action == 'delete':",
            "            self._delete_user(action, DeleteUserForm())",
            "",
            "        params = {",
            "            \"add_form\": UserForm(formdata=None),",
            "            \"edit_form\": EditUserForm(formdata=None),",
            "            \"criteria\": criteria,",
            "            \"search\": search,",
            "            \"users\": list(self.app.store.users(search=search, criteria=criteria)),",
            "        }",
            "",
            "        # Build users page",
            "        return self._compile_template(\"admin_users.html\", **params)",
            "",
            "    @cherrypy.expose",
            "    def repos(self, criteria=u\"\", search=u\"\"):",
            "        params = {",
            "            \"criteria\": criteria,",
            "            \"search\": search,",
            "            \"repos\": list(self.app.store.repos(search=search, criteria=criteria)),",
            "        }",
            "        return self._compile_template(\"admin_repos.html\", **params)",
            "",
            "    @cherrypy.expose",
            "    def sysinfo(self):",
            "",
            "        params = {",
            "            \"version\": self.app.version,",
            "            # Config",
            "            \"cfg\": {k: '********' if 'password' in k else v for k, v in vars(self.app.cfg).items()},",
            "            # System Info entries",
            "            \"pyinfo\": list(get_pyinfo()),",
            "            \"osinfo\": list(get_osinfo()),",
            "            \"hwinfo\": list(get_hwinfo()),",
            "            \"ldapinfo\": list(get_pkginfo()),",
            "        }",
            "",
            "        return self._compile_template(\"admin_sysinfo.html\", **params)"
        ],
        "afterPatchFile": [
            "# -*- coding: utf-8 -*-",
            "# rdiffweb, A web interface to rdiff-backup repositories",
            "# Copyright (C) 2012-2021 rdiffweb contributors",
            "#",
            "# This program is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This program is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with this program.  If not, see <http://www.gnu.org/licenses/>.",
            "",
            "import grp",
            "import logging",
            "import os",
            "import platform",
            "import pwd",
            "import subprocess",
            "import sys",
            "from collections import OrderedDict",
            "",
            "import cherrypy",
            "import humanfriendly",
            "import psutil",
            "from wtforms import validators, widgets",
            "from wtforms.fields import Field, PasswordField, SelectField, StringField",
            "from wtforms.fields.html5 import EmailField",
            "",
            "from rdiffweb.controller import Controller, flash",
            "from rdiffweb.controller.cherrypy_wtf import CherryForm",
            "from rdiffweb.core.config import Option",
            "from rdiffweb.core.librdiff import rdiff_backup_version",
            "from rdiffweb.core.store import ADMIN_ROLE, MAINTAINER_ROLE, USER_ROLE",
            "from rdiffweb.tools.i18n import ugettext as _",
            "",
            "# Define the logger",
            "logger = logging.getLogger(__name__)",
            "",
            "",
            "def get_pyinfo():",
            "    try:",
            "        import distro",
            "",
            "        yield _('OS Version'), '%s %s (%s %s)' % (",
            "            platform.system(),",
            "            platform.release(),",
            "            distro.name().capitalize(),",
            "            distro.version(),",
            "        )",
            "    except Exception:",
            "        yield _('OS Version'), '%s %s' % (platform.system(), platform.release())",
            "    if hasattr(os, 'path'):",
            "        yield _('OS Path'), os.environ['PATH']",
            "    if hasattr(sys, 'version'):",
            "        yield _('Python Version'), ''.join(sys.version)",
            "    if hasattr(sys, 'subversion'):",
            "        yield _('Python Subversion'), ', '.join(sys.subversion)",
            "    if hasattr(sys, 'prefix'):",
            "        yield _('Python Prefix'), sys.prefix",
            "    if hasattr(sys, 'executable'):",
            "        yield _('Python Executable'), sys.executable",
            "    if hasattr(sys, 'path'):",
            "        yield _('Python Path'), ', '.join(sys.path)",
            "",
            "",
            "def get_osinfo():",
            "    def gr_name(gid):",
            "        try:",
            "            return grp.getgrgid(gid).gr_name",
            "        except Exception:",
            "            return",
            "",
            "    def pw_name(uid):",
            "        try:",
            "            return pwd.getpwuid(os.getuid()).pw_name",
            "        except Exception:",
            "            return",
            "",
            "    if hasattr(sys, 'getfilesystemencoding'):",
            "        yield _('File System Encoding'), sys.getfilesystemencoding()",
            "    if hasattr(os, 'getcwd'):",
            "        yield _('Current Working Directory'), os.getcwd()",
            "    if hasattr(os, 'getegid'):",
            "        yield _('Effective Group'), '%s (%s)' % (os.getegid(), gr_name(os.getegid()))",
            "    if hasattr(os, 'geteuid'):",
            "        yield _('Effective User'), '%s (%s)' % (os.geteuid(), pw_name(os.geteuid))",
            "    if hasattr(os, 'getgid'):",
            "        yield _('Group'), '%s (%s)' % (os.getgid(), gr_name(os.getgid()))",
            "    if hasattr(os, 'getuid'):",
            "        yield _('User'), '%s (%s)' % (os.getuid(), gr_name(os.getuid()))",
            "    if hasattr(os, 'getgroups'):",
            "        yield _('Group Membership'), ', '.join(['%s (%s)' % (gid, gr_name(gid)) for gid in os.getgroups()])",
            "    try:",
            "        if hasattr(os, 'getpid') and hasattr(os, 'getppid'):",
            "            yield _('Process ID'), ('%s (parent: %s)' % (os.getpid(), os.getppid()))",
            "    except Exception:",
            "        pass",
            "",
            "",
            "def get_hwinfo():",
            "    if hasattr(os, 'getloadavg'):",
            "        yield _('Load Average'), ', '.join(map(str, map(lambda x: round(x, 2), os.getloadavg())))",
            "    yield _('CPU Count'), psutil.cpu_count()",
            "    meminfo = psutil.virtual_memory()",
            "    yield _('Memory usage'), '%s / %s' % (",
            "        humanfriendly.format_size(meminfo.used),",
            "        humanfriendly.format_size(meminfo.total),",
            "    )",
            "",
            "",
            "def get_pkginfo():",
            "    yield _('Rdiff-Backup Version'), '.'.join([str(i) for i in rdiff_backup_version()])",
            "    import jinja2",
            "",
            "    yield _('Jinja2 Version'), getattr(jinja2, '__version__')",
            "    yield _('CherryPy Version'), getattr(cherrypy, '__version__')",
            "    import sqlalchemy",
            "",
            "    yield _('SQLAlchemy Version'), getattr(sqlalchemy, '__version__')",
            "    try:",
            "        import ldap",
            "",
            "        yield _('LDAP Version'), getattr(ldap, '__version__')",
            "        yield _('LDAP SASL Support (Cyrus-SASL)'), ldap.SASL_AVAIL  # @UndefinedVariable",
            "        yield _('LDAP TLS Support (OpenSSL)'), ldap.TLS_AVAIL  # @UndefinedVariable",
            "    except Exception:",
            "        pass",
            "",
            "",
            "class SizeField(Field):",
            "    \"\"\"",
            "    A text field which stores a file size as GiB or GB format.",
            "    \"\"\"",
            "",
            "    widget = widgets.TextInput()",
            "",
            "    def __init__(self, label=None, validators=None, **kwargs):",
            "        super(SizeField, self).__init__(label, validators, **kwargs)",
            "",
            "    def _value(self):",
            "        if self.raw_data:",
            "            return ' '.join(self.raw_data)",
            "        else:",
            "            return self.data and humanfriendly.format_size(self.data, binary=True) or ''",
            "",
            "    def process_formdata(self, valuelist):",
            "        if valuelist:",
            "            value_str = ''.join(valuelist)",
            "            # parse_size doesn't handle locales.this mean we need to",
            "            # replace ',' by '.' to get parse and prefix number with 0",
            "            value_str = value_str.replace(',', '.').strip()",
            "            # a value must start with a number.",
            "            if value_str.startswith('.'):",
            "                value_str = '0' + value_str",
            "            try:",
            "                self.data = humanfriendly.parse_size(value_str)",
            "            except humanfriendly.InvalidSize:",
            "                self.data = None",
            "                raise ValueError(self.gettext('Not a valid file size value'))",
            "",
            "",
            "class UserForm(CherryForm):",
            "    userid = StringField(_('UserID'))",
            "    username = StringField(_('Username'), validators=[validators.data_required()])",
            "    email = EmailField(_('Email'), validators=[validators.optional()])",
            "    password = PasswordField(_('Password'), validators=[validators.optional()])",
            "    user_root = StringField(",
            "        _('Root directory'), description=_(\"Absolute path defining the location of the repositories for this user.\")",
            "    )",
            "    role = SelectField(",
            "        _('User Role'),",
            "        coerce=int,",
            "        choices=[(ADMIN_ROLE, _(\"Admin\")), (MAINTAINER_ROLE, _(\"Maintainer\")), (USER_ROLE, _(\"User\"))],",
            "        default=USER_ROLE,",
            "        description=_(",
            "            \"Admin: may browse and delete everything. Maintainer: may browse and delete their own repo. User: may only browser their own repo.\"",
            "        ),",
            "    )",
            "    disk_quota = SizeField(",
            "        _('Disk space'),",
            "        validators=[validators.optional()],",
            "        description=_(\"Users disk spaces (in bytes). Set to 0 to remove quota (unlimited).\"),",
            "    )",
            "    disk_usage = SizeField(",
            "        _('Quota Used'), validators=[validators.optional()], description=_(\"Disk spaces (in bytes) used by this user.\")",
            "    )",
            "",
            "    def validate_password(self, field):",
            "        validator = validators.length(",
            "            min=self.app.cfg.password_min_length,",
            "            max=self.app.cfg.password_max_length,",
            "            message=_('Password must have between %(min)d and %(max)d characters.'),",
            "        )",
            "        validator(self, field)",
            "",
            "    @property",
            "    def app(self):",
            "        return cherrypy.request.app",
            "",
            "    def validate_role(self, field):",
            "        # Don't allow the user to changes it's \"role\" state.",
            "        currentuser = cherrypy.request.currentuser",
            "        if self.username.data == currentuser.username and self.role.data != currentuser.role:",
            "            raise ValueError(_('Cannot edit your own role.'))",
            "",
            "    def populate_obj(self, userobj):",
            "        # Save password if defined",
            "        if self.password.data:",
            "            userobj.set_password(self.password.data, old_password=None)",
            "        userobj.role = self.role.data",
            "        userobj.email = self.email.data or ''",
            "        userobj.user_root = self.user_root.data",
            "        if not userobj.valid_user_root():",
            "            flash(_(\"User's root directory %s is not accessible!\") % userobj.user_root, level='error')",
            "            logger.warning(\"user's root directory %s is not accessible\" % userobj.user_root)",
            "        # Try to update disk quota if the human readable value changed.",
            "        # Report error using flash.",
            "        new_quota = self.disk_quota.data or 0",
            "        old_quota = humanfriendly.parse_size(humanfriendly.format_size(self.disk_quota.object_data or 0, binary=True))",
            "        if old_quota != new_quota:",
            "            userobj.disk_quota = new_quota",
            "            # Setting quota will silently fail. Check if quota was updated.",
            "            if userobj.disk_quota != new_quota:",
            "                flash(_(\"Setting user's quota is not supported\"), level='warning')",
            "",
            "",
            "class EditUserForm(UserForm):",
            "    def __init__(self, **kwargs):",
            "        super().__init__(**kwargs)",
            "        # Make username field read-only",
            "        self.username.render_kw = {'readonly': True}",
            "        self.username.populate_obj = lambda *args, **kwargs: None",
            "",
            "",
            "class DeleteUserForm(CherryForm):",
            "    username = StringField(_('Username'), validators=[validators.data_required()])",
            "",
            "",
            "@cherrypy.tools.is_admin()",
            "class AdminPage(Controller):",
            "    \"\"\"Administration pages. Allow to manage users database.\"\"\"",
            "",
            "    logfile = Option('log_file')",
            "    logaccessfile = Option('log_access_file')",
            "",
            "    def _delete_user(self, action, form):",
            "        assert action == 'delete'",
            "        assert form",
            "        # Validate form.",
            "        if not form.validate():",
            "            flash(form.error_message, level='error')",
            "            return",
            "        if form.username.data == self.app.currentuser.username:",
            "            flash(_(\"You cannot remove your own account!\"), level='error')",
            "        else:",
            "            try:",
            "                user = self.app.store.get_user(form.username.data)",
            "                if user:",
            "                    user.delete()",
            "                    flash(_(\"User account removed.\"))",
            "                else:",
            "                    flash(_(\"User doesn't exists!\"), level='warning')",
            "            except ValueError as e:",
            "                flash(e, level='error')",
            "",
            "    def _get_log_files(self):",
            "        \"\"\"",
            "        Return a list of log files to be shown in admin area.",
            "        \"\"\"",
            "        return [fn for fn in [self.logfile, self.logaccessfile] if fn]",
            "",
            "    def _get_log_data(self, fn, num=2000):",
            "        \"\"\"",
            "        Return a list of log files to be shown in admin area.",
            "        \"\"\"",
            "        try:",
            "            return subprocess.check_output(['tail', '-n', str(num), fn], stderr=subprocess.STDOUT).decode('utf-8')",
            "        except Exception:",
            "            logging.exception('fail to get log file content')",
            "            return \"Error getting file content\"",
            "",
            "    @cherrypy.expose",
            "    def default(self):",
            "        params = {\"user_count\": self.app.store.count_users(), \"repo_count\": self.app.store.count_repos()}",
            "",
            "        return self._compile_template(\"admin.html\", **params)",
            "",
            "    @cherrypy.expose",
            "    def logs(self, filename=u\"\"):",
            "        # get list of log file available.",
            "        data = \"\"",
            "        logfiles = OrderedDict([(os.path.basename(fn), fn) for fn in self._get_log_files()])",
            "        if logfiles:",
            "            filename = filename or list(logfiles.keys())[0]",
            "            if filename not in logfiles:",
            "                raise cherrypy.HTTPError(404, 'invalid log file: ' + filename)",
            "            data = self._get_log_data(logfiles.get(filename))",
            "",
            "        params = {",
            "            \"filename\": filename,",
            "            \"logfiles\": logfiles.keys(),",
            "            \"data\": data,",
            "        }",
            "        return self._compile_template(\"admin_logs.html\", **params)",
            "",
            "    @cherrypy.expose",
            "    def users(self, username=None, criteria=u\"\", search=u\"\", action=u\"\", **kwargs):",
            "",
            "        # If we're just showing the initial page, just do that",
            "        if action == \"add\":",
            "            form = UserForm()",
            "            if form.validate_on_submit():",
            "                try:",
            "                    user = self.app.store.add_user(username)",
            "                    form.populate_obj(user)",
            "                    flash(_(\"User added successfully.\"))",
            "                except Exception as e:",
            "                    flash(str(e), level='error')",
            "            else:",
            "                flash(form.error_message, level='error')",
            "        elif action == \"edit\":",
            "            user = self.app.store.get_user(username)",
            "            if user:",
            "                form = EditUserForm(obj=user)",
            "                if form.validate_on_submit():",
            "                    try:",
            "                        form.populate_obj(user)",
            "                        flash(_(\"User information modified successfully.\"))",
            "                    except Exception as e:",
            "                        flash(str(e), level='error')",
            "                else:",
            "                    flash(form.error_message, level='error')",
            "            else:",
            "                flash(_(\"Cannot edit user `%s`: user doesn't exists\") % username, level='error')",
            "        elif action == 'delete':",
            "            form = DeleteUserForm()",
            "            if form.validate_on_submit():",
            "                self._delete_user(action, form)",
            "",
            "        params = {",
            "            \"add_form\": UserForm(formdata=None),",
            "            \"edit_form\": EditUserForm(formdata=None),",
            "            \"criteria\": criteria,",
            "            \"search\": search,",
            "            \"users\": list(self.app.store.users(search=search, criteria=criteria)),",
            "        }",
            "",
            "        # Build users page",
            "        return self._compile_template(\"admin_users.html\", **params)",
            "",
            "    @cherrypy.expose",
            "    def repos(self, criteria=u\"\", search=u\"\"):",
            "        params = {",
            "            \"criteria\": criteria,",
            "            \"search\": search,",
            "            \"repos\": list(self.app.store.repos(search=search, criteria=criteria)),",
            "        }",
            "        return self._compile_template(\"admin_repos.html\", **params)",
            "",
            "    @cherrypy.expose",
            "    def sysinfo(self):",
            "",
            "        params = {",
            "            \"version\": self.app.version,",
            "            # Config",
            "            \"cfg\": {k: '********' if 'password' in k else v for k, v in vars(self.app.cfg).items()},",
            "            # System Info entries",
            "            \"pyinfo\": list(get_pyinfo()),",
            "            \"osinfo\": list(get_osinfo()),",
            "            \"hwinfo\": list(get_hwinfo()),",
            "            \"ldapinfo\": list(get_pkginfo()),",
            "        }",
            "",
            "        return self._compile_template(\"admin_sysinfo.html\", **params)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "193": [
                "UserForm",
                "__init__"
            ],
            "194": [
                "UserForm",
                "__init__"
            ],
            "195": [
                "UserForm",
                "__init__"
            ],
            "196": [
                "UserForm",
                "__init__"
            ],
            "197": [
                "UserForm",
                "__init__"
            ],
            "198": [
                "UserForm",
                "__init__"
            ],
            "199": [
                "UserForm",
                "__init__"
            ],
            "200": [
                "UserForm",
                "__init__"
            ],
            "201": [
                "UserForm",
                "__init__"
            ],
            "343": [
                "AdminPage",
                "users"
            ]
        },
        "addLocation": []
    },
    "rdiffweb/controller/page_delete.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 22,
                "afterPatchRowNumber": 22,
                "PatchRowcode": " # Define the logger\r"
            },
            "1": {
                "beforePatchRowNumber": 23,
                "afterPatchRowNumber": 23,
                "PatchRowcode": " \r"
            },
            "2": {
                "beforePatchRowNumber": 24,
                "afterPatchRowNumber": 24,
                "PatchRowcode": " import logging\r"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 25,
                "PatchRowcode": "+import os\r"
            },
            "4": {
                "beforePatchRowNumber": 25,
                "afterPatchRowNumber": 26,
                "PatchRowcode": " \r"
            },
            "5": {
                "beforePatchRowNumber": 26,
                "afterPatchRowNumber": 27,
                "PatchRowcode": " import cherrypy\r"
            },
            "6": {
                "beforePatchRowNumber": 27,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-from wtforms import validators\r"
            },
            "7": {
                "beforePatchRowNumber": 28,
                "afterPatchRowNumber": 28,
                "PatchRowcode": " from wtforms.fields.core import StringField\r"
            },
            "8": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 29,
                "PatchRowcode": "+from wtforms.validators import DataRequired, ValidationError\r"
            },
            "9": {
                "beforePatchRowNumber": 29,
                "afterPatchRowNumber": 30,
                "PatchRowcode": " \r"
            },
            "10": {
                "beforePatchRowNumber": 30,
                "afterPatchRowNumber": 31,
                "PatchRowcode": " from rdiffweb.controller import Controller\r"
            },
            "11": {
                "beforePatchRowNumber": 31,
                "afterPatchRowNumber": 32,
                "PatchRowcode": " from rdiffweb.controller.cherrypy_wtf import CherryForm\r"
            },
            "12": {
                "beforePatchRowNumber": 32,
                "afterPatchRowNumber": 33,
                "PatchRowcode": " from rdiffweb.controller.dispatch import poppath\r"
            },
            "13": {
                "beforePatchRowNumber": 33,
                "afterPatchRowNumber": 34,
                "PatchRowcode": " from rdiffweb.controller.filter_authorization import is_maintainer\r"
            },
            "14": {
                "beforePatchRowNumber": 34,
                "afterPatchRowNumber": 35,
                "PatchRowcode": " from rdiffweb.core.librdiff import AccessDeniedError, DoesNotExistError\r"
            },
            "15": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 36,
                "PatchRowcode": "+from rdiffweb.core.rdw_templating import url_for\r"
            },
            "16": {
                "beforePatchRowNumber": 35,
                "afterPatchRowNumber": 37,
                "PatchRowcode": " from rdiffweb.tools.i18n import ugettext as _\r"
            },
            "17": {
                "beforePatchRowNumber": 36,
                "afterPatchRowNumber": 38,
                "PatchRowcode": " \r"
            },
            "18": {
                "beforePatchRowNumber": 37,
                "afterPatchRowNumber": 39,
                "PatchRowcode": " _logger = logging.getLogger(__name__)\r"
            },
            "19": {
                "beforePatchRowNumber": 38,
                "afterPatchRowNumber": 40,
                "PatchRowcode": " \r"
            },
            "20": {
                "beforePatchRowNumber": 39,
                "afterPatchRowNumber": 41,
                "PatchRowcode": " \r"
            },
            "21": {
                "beforePatchRowNumber": 40,
                "afterPatchRowNumber": 42,
                "PatchRowcode": " class DeleteRepoForm(CherryForm):\r"
            },
            "22": {
                "beforePatchRowNumber": 41,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    confirm = StringField(_('Confirmation'), validators=[validators.data_required()])\r"
            },
            "23": {
                "beforePatchRowNumber": 42,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    redirect = StringField(default='/')\r"
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 43,
                "PatchRowcode": "+    confirm = StringField(_('Confirmation'), validators=[DataRequired()])\r"
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 44,
                "PatchRowcode": "+\r"
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 45,
                "PatchRowcode": "+    def validate_confirm(self, field):\r"
            },
            "27": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 46,
                "PatchRowcode": "+        if self.confirm.data != self.expected_confirm:\r"
            },
            "28": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 47,
                "PatchRowcode": "+            raise ValidationError(_('Invalid value, must be: %s') % self.expected_confirm)\r"
            },
            "29": {
                "beforePatchRowNumber": 43,
                "afterPatchRowNumber": 48,
                "PatchRowcode": " \r"
            },
            "30": {
                "beforePatchRowNumber": 44,
                "afterPatchRowNumber": 49,
                "PatchRowcode": " \r"
            },
            "31": {
                "beforePatchRowNumber": 45,
                "afterPatchRowNumber": 50,
                "PatchRowcode": " @poppath()\r"
            },
            "32": {
                "beforePatchRowNumber": 61,
                "afterPatchRowNumber": 66,
                "PatchRowcode": " \r"
            },
            "33": {
                "beforePatchRowNumber": 62,
                "afterPatchRowNumber": 67,
                "PatchRowcode": "         # validate form\r"
            },
            "34": {
                "beforePatchRowNumber": 63,
                "afterPatchRowNumber": 68,
                "PatchRowcode": "         form = DeleteRepoForm()\r"
            },
            "35": {
                "beforePatchRowNumber": 64,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        if not form.validate():\r"
            },
            "36": {
                "beforePatchRowNumber": 65,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            raise cherrypy.HTTPError(400, form.error_message)\r"
            },
            "37": {
                "beforePatchRowNumber": 66,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-\r"
            },
            "38": {
                "beforePatchRowNumber": 67,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        # Validate the name\r"
            },
            "39": {
                "beforePatchRowNumber": 68,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        if form.confirm.data != path_obj.display_name:\r"
            },
            "40": {
                "beforePatchRowNumber": 69,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            _logger.info(\"do not delete repo, bad confirmation %r != %r\", form.confirm.data, path_obj.display_name)\r"
            },
            "41": {
                "beforePatchRowNumber": 70,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            raise cherrypy.HTTPError(400, 'bad confirmation')\r"
            },
            "42": {
                "beforePatchRowNumber": 71,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-\r"
            },
            "43": {
                "beforePatchRowNumber": 72,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        # Delete repository in background using a schedule task.\r"
            },
            "44": {
                "beforePatchRowNumber": 73,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        scheduled = cherrypy.engine.publish('schedule_task', repo.delete, path)\r"
            },
            "45": {
                "beforePatchRowNumber": 74,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        assert scheduled\r"
            },
            "46": {
                "beforePatchRowNumber": 75,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        raise cherrypy.HTTPRedirect(form.redirect.data)\r"
            },
            "47": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 69,
                "PatchRowcode": "+        form.expected_confirm = path_obj.display_name\r"
            },
            "48": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 70,
                "PatchRowcode": "+        if form.is_submitted():\r"
            },
            "49": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 71,
                "PatchRowcode": "+            if form.validate():\r"
            },
            "50": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 72,
                "PatchRowcode": "+                cherrypy.engine.publish('schedule_task', repo.delete, path)\r"
            },
            "51": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 73,
                "PatchRowcode": "+                # Redirect to parent folder or to root if repo get deleted\r"
            },
            "52": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 74,
                "PatchRowcode": "+                if path_obj.isroot:\r"
            },
            "53": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 75,
                "PatchRowcode": "+                    raise cherrypy.HTTPRedirect(url_for('/'))\r"
            },
            "54": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 76,
                "PatchRowcode": "+                else:\r"
            },
            "55": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 77,
                "PatchRowcode": "+                    parent_path = repo.fstat(os.path.dirname(path_obj.path))\r"
            },
            "56": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 78,
                "PatchRowcode": "+                    raise cherrypy.HTTPRedirect(url_for('browse', repo, parent_path))\r"
            },
            "57": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 79,
                "PatchRowcode": "+            else:\r"
            },
            "58": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 80,
                "PatchRowcode": "+                raise cherrypy.HTTPError(400, form.error_message)\r"
            },
            "59": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 81,
                "PatchRowcode": "+        else:\r"
            },
            "60": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 82,
                "PatchRowcode": "+            raise cherrypy.HTTPError(405)\r"
            }
        },
        "frontPatchFile": [
            "# -*- coding: utf-8 -*-\r",
            "# rdiffweb, A web interface to rdiff-backup repositories\r",
            "# Copyright (C) 2012-2021 rdiffweb contributors\r",
            "#\r",
            "# This program is free software: you can redistribute it and/or modify\r",
            "# it under the terms of the GNU General Public License as published by\r",
            "# the Free Software Foundation, either version 3 of the License, or\r",
            "# (at your option) any later version.\r",
            "#\r",
            "# This program is distributed in the hope that it will be useful,\r",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of\r",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r",
            "# GNU General Public License for more details.\r",
            "#\r",
            "# You should have received a copy of the GNU General Public License\r",
            "# along with this program.  If not, see <http://www.gnu.org/licenses/>.\r",
            "'''\r",
            "Created on Apr. 5, 2021\r",
            "\r",
            "@author: Patrik Dufresne <patrik@ikus-soft.com>\r",
            "'''\r",
            "# Define the logger\r",
            "\r",
            "import logging\r",
            "\r",
            "import cherrypy\r",
            "from wtforms import validators\r",
            "from wtforms.fields.core import StringField\r",
            "\r",
            "from rdiffweb.controller import Controller\r",
            "from rdiffweb.controller.cherrypy_wtf import CherryForm\r",
            "from rdiffweb.controller.dispatch import poppath\r",
            "from rdiffweb.controller.filter_authorization import is_maintainer\r",
            "from rdiffweb.core.librdiff import AccessDeniedError, DoesNotExistError\r",
            "from rdiffweb.tools.i18n import ugettext as _\r",
            "\r",
            "_logger = logging.getLogger(__name__)\r",
            "\r",
            "\r",
            "class DeleteRepoForm(CherryForm):\r",
            "    confirm = StringField(_('Confirmation'), validators=[validators.data_required()])\r",
            "    redirect = StringField(default='/')\r",
            "\r",
            "\r",
            "@poppath()\r",
            "class DeletePage(Controller):\r",
            "    @cherrypy.expose\r",
            "    @cherrypy.tools.errors(\r",
            "        error_table={\r",
            "            DoesNotExistError: 404,\r",
            "            AccessDeniedError: 403,\r",
            "        }\r",
            "    )\r",
            "    def default(self, path=b\"\", **kwargs):\r",
            "        # Check permissions on path/repo\r",
            "        repo, path = self.app.store.get_repo_path(path)\r",
            "        # Check if path exists with fstats\r",
            "        path_obj = repo.fstat(path)\r",
            "        # Check user's permissions\r",
            "        is_maintainer()\r",
            "\r",
            "        # validate form\r",
            "        form = DeleteRepoForm()\r",
            "        if not form.validate():\r",
            "            raise cherrypy.HTTPError(400, form.error_message)\r",
            "\r",
            "        # Validate the name\r",
            "        if form.confirm.data != path_obj.display_name:\r",
            "            _logger.info(\"do not delete repo, bad confirmation %r != %r\", form.confirm.data, path_obj.display_name)\r",
            "            raise cherrypy.HTTPError(400, 'bad confirmation')\r",
            "\r",
            "        # Delete repository in background using a schedule task.\r",
            "        scheduled = cherrypy.engine.publish('schedule_task', repo.delete, path)\r",
            "        assert scheduled\r",
            "        raise cherrypy.HTTPRedirect(form.redirect.data)\r"
        ],
        "afterPatchFile": [
            "# -*- coding: utf-8 -*-\r",
            "# rdiffweb, A web interface to rdiff-backup repositories\r",
            "# Copyright (C) 2012-2021 rdiffweb contributors\r",
            "#\r",
            "# This program is free software: you can redistribute it and/or modify\r",
            "# it under the terms of the GNU General Public License as published by\r",
            "# the Free Software Foundation, either version 3 of the License, or\r",
            "# (at your option) any later version.\r",
            "#\r",
            "# This program is distributed in the hope that it will be useful,\r",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of\r",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r",
            "# GNU General Public License for more details.\r",
            "#\r",
            "# You should have received a copy of the GNU General Public License\r",
            "# along with this program.  If not, see <http://www.gnu.org/licenses/>.\r",
            "'''\r",
            "Created on Apr. 5, 2021\r",
            "\r",
            "@author: Patrik Dufresne <patrik@ikus-soft.com>\r",
            "'''\r",
            "# Define the logger\r",
            "\r",
            "import logging\r",
            "import os\r",
            "\r",
            "import cherrypy\r",
            "from wtforms.fields.core import StringField\r",
            "from wtforms.validators import DataRequired, ValidationError\r",
            "\r",
            "from rdiffweb.controller import Controller\r",
            "from rdiffweb.controller.cherrypy_wtf import CherryForm\r",
            "from rdiffweb.controller.dispatch import poppath\r",
            "from rdiffweb.controller.filter_authorization import is_maintainer\r",
            "from rdiffweb.core.librdiff import AccessDeniedError, DoesNotExistError\r",
            "from rdiffweb.core.rdw_templating import url_for\r",
            "from rdiffweb.tools.i18n import ugettext as _\r",
            "\r",
            "_logger = logging.getLogger(__name__)\r",
            "\r",
            "\r",
            "class DeleteRepoForm(CherryForm):\r",
            "    confirm = StringField(_('Confirmation'), validators=[DataRequired()])\r",
            "\r",
            "    def validate_confirm(self, field):\r",
            "        if self.confirm.data != self.expected_confirm:\r",
            "            raise ValidationError(_('Invalid value, must be: %s') % self.expected_confirm)\r",
            "\r",
            "\r",
            "@poppath()\r",
            "class DeletePage(Controller):\r",
            "    @cherrypy.expose\r",
            "    @cherrypy.tools.errors(\r",
            "        error_table={\r",
            "            DoesNotExistError: 404,\r",
            "            AccessDeniedError: 403,\r",
            "        }\r",
            "    )\r",
            "    def default(self, path=b\"\", **kwargs):\r",
            "        # Check permissions on path/repo\r",
            "        repo, path = self.app.store.get_repo_path(path)\r",
            "        # Check if path exists with fstats\r",
            "        path_obj = repo.fstat(path)\r",
            "        # Check user's permissions\r",
            "        is_maintainer()\r",
            "\r",
            "        # validate form\r",
            "        form = DeleteRepoForm()\r",
            "        form.expected_confirm = path_obj.display_name\r",
            "        if form.is_submitted():\r",
            "            if form.validate():\r",
            "                cherrypy.engine.publish('schedule_task', repo.delete, path)\r",
            "                # Redirect to parent folder or to root if repo get deleted\r",
            "                if path_obj.isroot:\r",
            "                    raise cherrypy.HTTPRedirect(url_for('/'))\r",
            "                else:\r",
            "                    parent_path = repo.fstat(os.path.dirname(path_obj.path))\r",
            "                    raise cherrypy.HTTPRedirect(url_for('browse', repo, parent_path))\r",
            "            else:\r",
            "                raise cherrypy.HTTPError(400, form.error_message)\r",
            "        else:\r",
            "            raise cherrypy.HTTPError(405)\r"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "2",
            "0",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2"
        ],
        "dele_reviseLocation": {
            "27": [],
            "41": [
                "DeleteRepoForm"
            ],
            "42": [
                "DeleteRepoForm"
            ],
            "64": [
                "DeletePage",
                "default"
            ],
            "65": [
                "DeletePage",
                "default"
            ],
            "66": [
                "DeletePage",
                "default"
            ],
            "67": [
                "DeletePage",
                "default"
            ],
            "68": [
                "DeletePage",
                "default"
            ],
            "69": [
                "DeletePage",
                "default"
            ],
            "70": [
                "DeletePage",
                "default"
            ],
            "71": [
                "DeletePage",
                "default"
            ],
            "72": [
                "DeletePage",
                "default"
            ],
            "73": [
                "DeletePage",
                "default"
            ],
            "74": [
                "DeletePage",
                "default"
            ],
            "75": [
                "DeletePage",
                "default"
            ]
        },
        "addLocation": []
    },
    "rdiffweb/controller/pref_general.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 54,
                "afterPatchRowNumber": 54,
                "PatchRowcode": "         _('Confirm new password'), validators=[InputRequired(_(\"Confirmation password is missing.\"))]"
            },
            "1": {
                "beforePatchRowNumber": 55,
                "afterPatchRowNumber": 55,
                "PatchRowcode": "     )"
            },
            "2": {
                "beforePatchRowNumber": 56,
                "afterPatchRowNumber": 56,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": 57,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    def __init__(self, *args, **kwargs):"
            },
            "4": {
                "beforePatchRowNumber": 58,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        super().__init__(*args, **kwargs)"
            },
            "5": {
                "beforePatchRowNumber": 59,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.new.validators += ["
            },
            "6": {
                "beforePatchRowNumber": 60,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            Length("
            },
            "7": {
                "beforePatchRowNumber": 61,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                min=self.app.cfg.password_min_length,"
            },
            "8": {
                "beforePatchRowNumber": 62,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                max=self.app.cfg.password_max_length,"
            },
            "9": {
                "beforePatchRowNumber": 63,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                message=_('Password must have between %(min)d and %(max)d characters.'),"
            },
            "10": {
                "beforePatchRowNumber": 64,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            )"
            },
            "11": {
                "beforePatchRowNumber": 65,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        ]"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 57,
                "PatchRowcode": "+    def validate_new(self, field):"
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 58,
                "PatchRowcode": "+        validator = Length("
            },
            "14": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 59,
                "PatchRowcode": "+            min=self.app.cfg.password_min_length,"
            },
            "15": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 60,
                "PatchRowcode": "+            max=self.app.cfg.password_max_length,"
            },
            "16": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 61,
                "PatchRowcode": "+            message=_('Password must have between %(min)d and %(max)d characters.'),"
            },
            "17": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 62,
                "PatchRowcode": "+        )"
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 63,
                "PatchRowcode": "+        validator(self, field)"
            },
            "19": {
                "beforePatchRowNumber": 66,
                "afterPatchRowNumber": 64,
                "PatchRowcode": " "
            },
            "20": {
                "beforePatchRowNumber": 67,
                "afterPatchRowNumber": 65,
                "PatchRowcode": "     @property"
            },
            "21": {
                "beforePatchRowNumber": 68,
                "afterPatchRowNumber": 66,
                "PatchRowcode": "     def app(self):"
            }
        },
        "frontPatchFile": [
            "# -*- coding: utf-8 -*-",
            "# rdiffweb, A web interface to rdiff-backup repositories",
            "# Copyright (C) 2012-2021 rdiffweb contributors",
            "#",
            "# This program is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This program is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with this program.  If not, see <http://www.gnu.org/licenses/>.",
            "\"\"\"",
            "Default preference page to show general user information. It allows user",
            "to change password ans refresh it's repository view.",
            "\"\"\"",
            "",
            "import logging",
            "import re",
            "",
            "import cherrypy",
            "from wtforms.fields.html5 import EmailField",
            "from wtforms.fields.simple import PasswordField",
            "from wtforms.validators import DataRequired, EqualTo, InputRequired, Length, Regexp",
            "",
            "from rdiffweb.controller import Controller, flash",
            "from rdiffweb.controller.cherrypy_wtf import CherryForm",
            "from rdiffweb.tools.i18n import ugettext as _",
            "",
            "# Define the logger",
            "_logger = logging.getLogger(__name__)",
            "",
            "PATTERN_EMAIL = re.compile(r'[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,4}$')",
            "",
            "",
            "class UserProfileForm(CherryForm):",
            "    email = EmailField(_('Email'), validators=[DataRequired(), Regexp(PATTERN_EMAIL, message=_(\"Invalid email.\"))])",
            "",
            "",
            "class UserPasswordForm(CherryForm):",
            "    current = PasswordField(_('Current password'), validators=[InputRequired(_(\"Current password is missing.\"))])",
            "    new = PasswordField(",
            "        _('New password'),",
            "        validators=[",
            "            InputRequired(_(\"New password is missing.\")),",
            "            EqualTo('confirm', message=_(\"The new password and its confirmation do not match.\")),",
            "        ],",
            "    )",
            "    confirm = PasswordField(",
            "        _('Confirm new password'), validators=[InputRequired(_(\"Confirmation password is missing.\"))]",
            "    )",
            "",
            "    def __init__(self, *args, **kwargs):",
            "        super().__init__(*args, **kwargs)",
            "        self.new.validators += [",
            "            Length(",
            "                min=self.app.cfg.password_min_length,",
            "                max=self.app.cfg.password_max_length,",
            "                message=_('Password must have between %(min)d and %(max)d characters.'),",
            "            )",
            "        ]",
            "",
            "    @property",
            "    def app(self):",
            "        return cherrypy.request.app",
            "",
            "",
            "class PrefsGeneralPanelProvider(Controller):",
            "    \"\"\"",
            "    Plugin to change user profile and password.",
            "    \"\"\"",
            "",
            "    panel_id = 'general'",
            "",
            "    panel_name = _('Profile')",
            "",
            "    def _handle_set_password(self, action, form):",
            "        \"\"\"",
            "        Called when changing user password.",
            "        \"\"\"",
            "        assert self.app.currentuser",
            "        assert action == 'set_password'",
            "        assert form",
            "        # Validate form",
            "        if not form.validate():",
            "            flash(form.error_message, level='error')",
            "            return",
            "        # Update user password",
            "        try:",
            "            self.app.currentuser.set_password(form.new.data, old_password=form.current.data)",
            "            flash(_(\"Password updated successfully.\"), level='success')",
            "        except ValueError as e:",
            "            flash(str(e), level='warning')",
            "",
            "    def _handle_set_profile_info(self, action, form):",
            "        \"\"\"",
            "        Called when changing user profile.",
            "        \"\"\"",
            "        assert self.app.currentuser",
            "        assert action == 'set_profile_info'",
            "        assert form",
            "        # Validate form",
            "        if not form.validate():",
            "            flash(form.error_message, level='error')",
            "            return",
            "        # Update the user's email",
            "        username = self.app.currentuser.username",
            "        _logger.info(\"updating user [%s] email [%s]\", username, form.email.data)",
            "        self.app.currentuser.email = form.email.data",
            "        # Report success",
            "        flash(_(\"Profile updated successfully.\"), level='success')",
            "",
            "    def render_prefs_panel(self, panelid, action=None, **kwargs):  # @UnusedVariable",
            "        # Process the parameters.",
            "        profile_form = UserProfileForm(email=self.app.currentuser.email)",
            "        password_form = UserPasswordForm()",
            "        if action == \"set_profile_info\":",
            "            self._handle_set_profile_info(action, profile_form)",
            "        elif action == \"set_password\":",
            "            self._handle_set_password(action, password_form)",
            "        elif action == \"update_repos\":",
            "            self.app.currentuser.refresh_repos(delete=True)",
            "            flash(_(\"Repositories successfully updated\"), level='success')",
            "        elif action is None:",
            "            pass",
            "        else:",
            "            _logger.warning(\"unknown action: %s\", action)",
            "            raise cherrypy.NotFound(\"Unknown action\")",
            "        params = {",
            "            'profile_form': profile_form,",
            "            'password_form': password_form,",
            "        }",
            "        return \"prefs_general.html\", params"
        ],
        "afterPatchFile": [
            "# -*- coding: utf-8 -*-",
            "# rdiffweb, A web interface to rdiff-backup repositories",
            "# Copyright (C) 2012-2021 rdiffweb contributors",
            "#",
            "# This program is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This program is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with this program.  If not, see <http://www.gnu.org/licenses/>.",
            "\"\"\"",
            "Default preference page to show general user information. It allows user",
            "to change password ans refresh it's repository view.",
            "\"\"\"",
            "",
            "import logging",
            "import re",
            "",
            "import cherrypy",
            "from wtforms.fields.html5 import EmailField",
            "from wtforms.fields.simple import PasswordField",
            "from wtforms.validators import DataRequired, EqualTo, InputRequired, Length, Regexp",
            "",
            "from rdiffweb.controller import Controller, flash",
            "from rdiffweb.controller.cherrypy_wtf import CherryForm",
            "from rdiffweb.tools.i18n import ugettext as _",
            "",
            "# Define the logger",
            "_logger = logging.getLogger(__name__)",
            "",
            "PATTERN_EMAIL = re.compile(r'[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,4}$')",
            "",
            "",
            "class UserProfileForm(CherryForm):",
            "    email = EmailField(_('Email'), validators=[DataRequired(), Regexp(PATTERN_EMAIL, message=_(\"Invalid email.\"))])",
            "",
            "",
            "class UserPasswordForm(CherryForm):",
            "    current = PasswordField(_('Current password'), validators=[InputRequired(_(\"Current password is missing.\"))])",
            "    new = PasswordField(",
            "        _('New password'),",
            "        validators=[",
            "            InputRequired(_(\"New password is missing.\")),",
            "            EqualTo('confirm', message=_(\"The new password and its confirmation do not match.\")),",
            "        ],",
            "    )",
            "    confirm = PasswordField(",
            "        _('Confirm new password'), validators=[InputRequired(_(\"Confirmation password is missing.\"))]",
            "    )",
            "",
            "    def validate_new(self, field):",
            "        validator = Length(",
            "            min=self.app.cfg.password_min_length,",
            "            max=self.app.cfg.password_max_length,",
            "            message=_('Password must have between %(min)d and %(max)d characters.'),",
            "        )",
            "        validator(self, field)",
            "",
            "    @property",
            "    def app(self):",
            "        return cherrypy.request.app",
            "",
            "",
            "class PrefsGeneralPanelProvider(Controller):",
            "    \"\"\"",
            "    Plugin to change user profile and password.",
            "    \"\"\"",
            "",
            "    panel_id = 'general'",
            "",
            "    panel_name = _('Profile')",
            "",
            "    def _handle_set_password(self, action, form):",
            "        \"\"\"",
            "        Called when changing user password.",
            "        \"\"\"",
            "        assert self.app.currentuser",
            "        assert action == 'set_password'",
            "        assert form",
            "        # Validate form",
            "        if not form.validate():",
            "            flash(form.error_message, level='error')",
            "            return",
            "        # Update user password",
            "        try:",
            "            self.app.currentuser.set_password(form.new.data, old_password=form.current.data)",
            "            flash(_(\"Password updated successfully.\"), level='success')",
            "        except ValueError as e:",
            "            flash(str(e), level='warning')",
            "",
            "    def _handle_set_profile_info(self, action, form):",
            "        \"\"\"",
            "        Called when changing user profile.",
            "        \"\"\"",
            "        assert self.app.currentuser",
            "        assert action == 'set_profile_info'",
            "        assert form",
            "        # Validate form",
            "        if not form.validate():",
            "            flash(form.error_message, level='error')",
            "            return",
            "        # Update the user's email",
            "        username = self.app.currentuser.username",
            "        _logger.info(\"updating user [%s] email [%s]\", username, form.email.data)",
            "        self.app.currentuser.email = form.email.data",
            "        # Report success",
            "        flash(_(\"Profile updated successfully.\"), level='success')",
            "",
            "    def render_prefs_panel(self, panelid, action=None, **kwargs):  # @UnusedVariable",
            "        # Process the parameters.",
            "        profile_form = UserProfileForm(email=self.app.currentuser.email)",
            "        password_form = UserPasswordForm()",
            "        if action == \"set_profile_info\":",
            "            self._handle_set_profile_info(action, profile_form)",
            "        elif action == \"set_password\":",
            "            self._handle_set_password(action, password_form)",
            "        elif action == \"update_repos\":",
            "            self.app.currentuser.refresh_repos(delete=True)",
            "            flash(_(\"Repositories successfully updated\"), level='success')",
            "        elif action is None:",
            "            pass",
            "        else:",
            "            _logger.warning(\"unknown action: %s\", action)",
            "            raise cherrypy.NotFound(\"Unknown action\")",
            "        params = {",
            "            'profile_form': profile_form,",
            "            'password_form': password_form,",
            "        }",
            "        return \"prefs_general.html\", params"
        ],
        "action": [
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "57": [
                "UserPasswordForm",
                "__init__"
            ],
            "58": [
                "UserPasswordForm",
                "__init__"
            ],
            "59": [
                "UserPasswordForm",
                "__init__"
            ],
            "60": [
                "UserPasswordForm",
                "__init__"
            ],
            "61": [
                "UserPasswordForm",
                "__init__"
            ],
            "62": [
                "UserPasswordForm",
                "__init__"
            ],
            "63": [
                "UserPasswordForm",
                "__init__"
            ],
            "64": [
                "UserPasswordForm",
                "__init__"
            ],
            "65": [
                "UserPasswordForm",
                "__init__"
            ]
        },
        "addLocation": []
    },
    "rdiffweb/controller/tests/test_page_admin.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 267,
                "afterPatchRowNumber": 267,
                "PatchRowcode": "         self.assertStatus(200)"
            },
            "1": {
                "beforePatchRowNumber": 268,
                "afterPatchRowNumber": 268,
                "PatchRowcode": "         self.assertInBody(\"can&#39;t delete admin user\")"
            },
            "2": {
                "beforePatchRowNumber": 269,
                "afterPatchRowNumber": 269,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 270,
                "PatchRowcode": "+    def test_delete_user_method_get(self):"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 271,
                "PatchRowcode": "+        # Given a user"
            },
            "5": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 272,
                "PatchRowcode": "+        self.app.store.add_user('newuser')"
            },
            "6": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 273,
                "PatchRowcode": "+        # When trying to delete this user using method GET"
            },
            "7": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 274,
                "PatchRowcode": "+        self.getPage(\"/admin/users/?action=delete&username=newuser\", method='GET')"
            },
            "8": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 275,
                "PatchRowcode": "+        # Then page return without error"
            },
            "9": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 276,
                "PatchRowcode": "+        self.assertStatus(200)"
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 277,
                "PatchRowcode": "+        # Then user is not deleted"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 278,
                "PatchRowcode": "+        self.assertIsNotNone(self.app.store.get_user('newuser'))"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 279,
                "PatchRowcode": "+"
            },
            "13": {
                "beforePatchRowNumber": 270,
                "afterPatchRowNumber": 280,
                "PatchRowcode": "     def test_change_password_with_too_short(self):"
            },
            "14": {
                "beforePatchRowNumber": 271,
                "afterPatchRowNumber": 281,
                "PatchRowcode": "         self._edit_user(self.USERNAME, password='short')"
            },
            "15": {
                "beforePatchRowNumber": 272,
                "afterPatchRowNumber": 282,
                "PatchRowcode": "         self.assertInBody(\"Password must have between 8 and 128 characters.\")"
            }
        },
        "frontPatchFile": [
            "# -*- coding: utf-8 -*-",
            "# rdiffweb, A web interface to rdiff-backup repositories",
            "# Copyright (C) 2012-2021 rdiffweb contributors",
            "#",
            "# This program is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This program is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with this program.  If not, see <http://www.gnu.org/licenses/>.",
            "\"\"\"",
            "Created on Dec 30, 2015",
            "",
            "@author: Patrik Dufresne",
            "\"\"\"",
            "",
            "import os",
            "from unittest.mock import ANY, MagicMock",
            "",
            "import cherrypy",
            "",
            "import rdiffweb.test",
            "from rdiffweb.core.store import ADMIN_ROLE, MAINTAINER_ROLE, USER_ROLE",
            "",
            "",
            "class AbstractAdminTest(rdiffweb.test.WebCase):",
            "    \"\"\"Class to regroup command method to test admin page.\"\"\"",
            "",
            "    def setUp(self):",
            "        super().setUp()",
            "        self._quota = {}",
            "        self.listener = MagicMock()",
            "        cherrypy.engine.subscribe('user_added', self.listener.user_added, priority=50)",
            "        cherrypy.engine.subscribe('user_attr_changed', self.listener.user_attr_changed, priority=50)",
            "        cherrypy.engine.subscribe('user_deleted', self.listener.user_deleted, priority=50)",
            "        cherrypy.engine.subscribe('user_password_changed', self.listener.user_password_changed, priority=50)",
            "        self.listener.get_disk_quota.side_effect = self._load_quota",
            "        cherrypy.engine.subscribe('get_disk_quota', self.listener.get_disk_quota, priority=40)",
            "        self.listener.get_disk_usage.return_value = 0",
            "        cherrypy.engine.subscribe('get_disk_usage', self.listener.get_disk_usage, priority=40)",
            "        self.listener.set_disk_quota.side_effect = self._store_quota",
            "        cherrypy.engine.subscribe('set_disk_quota', self.listener.set_disk_quota, priority=40)",
            "",
            "    def tearDown(self):",
            "        cherrypy.engine.unsubscribe('user_added', self.listener.user_added)",
            "        cherrypy.engine.unsubscribe('user_attr_changed', self.listener.user_attr_changed)",
            "        cherrypy.engine.unsubscribe('user_deleted', self.listener.user_deleted)",
            "        cherrypy.engine.unsubscribe('user_password_changed', self.listener.user_password_changed)",
            "        cherrypy.engine.unsubscribe('get_disk_quota', self.listener.get_disk_quota)",
            "        cherrypy.engine.unsubscribe('get_disk_usage', self.listener.get_disk_usage)",
            "        cherrypy.engine.unsubscribe('set_disk_quota', self.listener.set_disk_quota)",
            "        return super().tearDown()",
            "",
            "    def _store_quota(self, userobj, value):",
            "        self._quota[userobj.username] = value",
            "",
            "    def _load_quota(self, userobj):",
            "        return self._quota.get(userobj.username, 0)",
            "",
            "    def _add_user(self, username=None, email=None, password=None, user_root=None, role=None):",
            "        b = {}",
            "        b['action'] = 'add'",
            "        if username is not None:",
            "            b['username'] = username",
            "        if email is not None:",
            "            b['email'] = email",
            "        if password is not None:",
            "            b['password'] = password",
            "        if user_root is not None:",
            "            b['user_root'] = user_root",
            "        if role is not None:",
            "            b['role'] = str(role)",
            "        self.getPage(\"/admin/users/\", method='POST', body=b)",
            "",
            "    def _edit_user(self, username=None, email=None, password=None, user_root=None, role=None, disk_quota=None):",
            "        b = {}",
            "        b['action'] = 'edit'",
            "        if username is not None:",
            "            b['username'] = username",
            "        if email is not None:",
            "            b['email'] = email",
            "        if password is not None:",
            "            b['password'] = password",
            "        if user_root is not None:",
            "            b['user_root'] = user_root",
            "        if role is not None:",
            "            b['role'] = str(role)",
            "        if disk_quota is not None:",
            "            b['disk_quota'] = disk_quota",
            "        self.getPage(\"/admin/users/\", method='POST', body=b)",
            "",
            "    def _delete_user(self, username='test1'):",
            "        b = {'action': 'delete', 'username': username}",
            "        self.getPage(\"/admin/users/\", method='POST', body=b)",
            "",
            "",
            "class AdminUsersAsAdminTest(AbstractAdminTest):",
            "    \"\"\"Integration test for page_admin\"\"\"",
            "",
            "    login = True",
            "",
            "    def test_add_user_with_role_admin(self):",
            "        # When trying to create a new user with role admin",
            "        self._add_user(\"admin_role\", \"admin_role@test.com\", \"password\", \"/home/\", ADMIN_ROLE)",
            "        # Then page return success",
            "        self.assertStatus(200)",
            "        # Then database is updated",
            "        userobj = self.app.store.get_user('admin_role')",
            "        self.assertEqual(ADMIN_ROLE, userobj.role)",
            "        # Then notification was raised",
            "        self.listener.user_added.assert_called_once_with(userobj)",
            "",
            "    def test_add_user_with_role_maintainer(self):",
            "        self._add_user(\"maintainer_role\", \"maintainer_role@test.com\", \"password\", \"/home/\", MAINTAINER_ROLE)",
            "        self.assertStatus(200)",
            "        self.assertEqual(MAINTAINER_ROLE, self.app.store.get_user('maintainer_role').role)",
            "",
            "    def test_add_user_with_role_user(self):",
            "        self._add_user(\"user_role\", \"user_role@test.com\", \"password\", \"/home/\", USER_ROLE)",
            "        self.assertStatus(200)",
            "        self.assertEqual(USER_ROLE, self.app.store.get_user('user_role').role)",
            "",
            "    def test_add_user_with_invalid_role(self):",
            "        # When trying to create a new user with an invalid role (admin instead of 0)",
            "        self._add_user(\"invalid\", \"invalid@test.com\", \"test1234\", \"/home/\", 'admin')",
            "        # Then an error message is displayed to the user",
            "        self.assertStatus(200)",
            "        self.assertInBody('role: Invalid Choice: could not coerce')",
            "        # Then listener are not called",
            "        self.listener.user_added.assert_not_called()",
            "",
            "        # When trying to create a new user with an invalid role (-1)",
            "        self._add_user(\"invalid\", \"invalid@test.com\", \"test2\", \"/home/\", -1)",
            "        # Then an error message is displayed to the user",
            "        self.assertStatus(200)",
            "        self.assertInBody('role: Not a valid choice')",
            "        # Then listener are not called",
            "        self.listener.user_added.assert_not_called()",
            "",
            "    def test_add_edit_delete(self):",
            "        #  Add user to be listed",
            "        self._add_user(\"test2\", \"test2@test.com\", \"test1234\", \"/home/\", USER_ROLE)",
            "        self.assertInBody(\"User added successfully.\")",
            "        self.assertInBody(\"test2\")",
            "        self.assertInBody(\"test2@test.com\")",
            "        self.listener.user_added.assert_called_once()",
            "        self.listener.user_password_changed.assert_called_once()",
            "        self.listener.user_password_changed.reset_mock()",
            "        #  Update user",
            "        self._edit_user(\"test2\", \"chaned@test.com\", \"new-password\", \"/tmp/\", ADMIN_ROLE)",
            "        self.listener.user_attr_changed.assert_called()",
            "        self.listener.user_password_changed.assert_called_once()",
            "        self.assertInBody(\"User information modified successfully.\")",
            "        self.assertInBody(\"test2\")",
            "        self.assertInBody(\"chaned@test.com\")",
            "        self.assertNotInBody(\"/home/\")",
            "        self.assertInBody(\"/tmp/\")",
            "        #  Check with filters",
            "        self.getPage(\"/admin/users/?criteria=admins\")",
            "        self.assertInBody(\"test2\")",
            "",
            "        self._delete_user(\"test2\")",
            "        self.listener.user_deleted.assert_called()",
            "        self.assertStatus(200)",
            "        self.assertInBody(\"User account removed.\")",
            "        self.assertNotInBody(\"test2\")",
            "",
            "    def test_add_edit_delete_user_with_encoding(self):",
            "        \"\"\"",
            "        Check creation of user with non-ascii char.",
            "        \"\"\"",
            "        self._add_user(\"\u00c9ric\", \"\u00e9ric@test.com\", \"password\", \"/home/\", USER_ROLE)",
            "        self.assertInBody(\"User added successfully.\")",
            "        self.assertInBody(\"\u00c9ric\")",
            "        self.assertInBody(\"\u00e9ric@test.com\")",
            "        # Update user",
            "        self._edit_user(\"\u00c9ric\", \"eric.l\u00e9tourno@test.com\", \"\u00e9cureuil\", \"/tmp/\", ADMIN_ROLE)",
            "        self.assertInBody(\"User information modified successfully.\")",
            "        self.assertInBody(\"\u00c9ric\")",
            "        self.assertInBody(\"eric.l\u00e9tourno@test.com\")",
            "        self.assertNotInBody(\"/home/\")",
            "        self.assertInBody(\"/tmp/\")",
            "        # Check with filter",
            "        self.getPage(\"/admin/users/?criteria=admins\")",
            "        self.assertInBody(\"\u00c9ric\")",
            "",
            "        self._delete_user(\"\u00c9ric\")",
            "        self.assertInBody(\"User account removed.\")",
            "        self.assertNotInBody(\"\u00c9ric\")",
            "",
            "    def test_add_user_with_empty_username(self):",
            "        \"\"\"",
            "        Verify failure trying to create user without username.",
            "        \"\"\"",
            "        self._add_user(\"\", \"test1@test.com\", \"test1\", \"/tmp/\", USER_ROLE)",
            "        self.assertStatus(200)",
            "        self.assertInBody(\"username: This field is required.\")",
            "",
            "    def test_add_user_with_existing_username(self):",
            "        \"\"\"",
            "        Verify failure trying to add the same user.",
            "        \"\"\"",
            "        # Given a user named `test1`",
            "        self._add_user(\"test1\", \"test1@test.com\", \"password\", \"/tmp/\", USER_ROLE)",
            "        # When trying to create a new user with the same name",
            "        self._add_user(\"test1\", \"test1@test.com\", \"password\", \"/tmp/\", USER_ROLE)",
            "        # Then the user list is displayed with an error message.",
            "        self.assertStatus(200)",
            "        self.assertInBody(\"User test1 already exists.\")",
            "",
            "    def test_add_user_with_invalid_root_directory(self):",
            "        \"\"\"",
            "        Verify failure to add a user with invalid root directory.",
            "        \"\"\"",
            "        try:",
            "            self._delete_user(\"test5\")",
            "        except Exception:",
            "            pass",
            "        self._add_user(\"test5\", \"test1@test.com\", \"password\", \"/var/invalid/\", USER_ROLE)",
            "        self.assertInBody(\"User added successfully.\")",
            "        self.assertInBody(\"User&#39;s root directory /var/invalid/ is not accessible!\")",
            "",
            "    def test_add_without_email(self):",
            "        #  Add user to be listed",
            "        self._add_user(\"test2\", None, \"password\", \"/tmp/\", USER_ROLE)",
            "        self.assertInBody(\"User added successfully.\")",
            "",
            "    def test_add_without_user_root(self):",
            "        #  Add user to be listed",
            "        self._add_user(\"test6\", None, \"password\", None, USER_ROLE)",
            "        self.assertInBody(\"User added successfully.\")",
            "",
            "        user = self.app.store.get_user('test6')",
            "        self.assertEqual('', user.user_root)",
            "",
            "    def test_delete_user_with_not_existing_username(self):",
            "        \"\"\"",
            "        Verify failure to delete invalid username.",
            "        \"\"\"",
            "        self._delete_user(\"test3\")",
            "        self.assertInBody(\"User doesn&#39;t exists!\")",
            "",
            "    def test_delete_our_self(self):",
            "        \"\"\"",
            "        Verify failure to delete our self.",
            "        \"\"\"",
            "        self._delete_user(self.USERNAME)",
            "        self.assertInBody(\"You cannot remove your own account!\")",
            "",
            "    def test_delete_user_admin(self):",
            "        \"\"\"",
            "        Verify failure to delete our self.",
            "        \"\"\"",
            "        # Create another admin user",
            "        self._add_user('admin2', '', 'password', '', ADMIN_ROLE)",
            "        self.getPage(\"/logout/\")",
            "        self._login('admin2', 'password')",
            "",
            "        # Try deleting admin user",
            "        self._delete_user(self.USERNAME)",
            "        self.assertStatus(200)",
            "        self.assertInBody(\"can&#39;t delete admin user\")",
            "",
            "    def test_change_password_with_too_short(self):",
            "        self._edit_user(self.USERNAME, password='short')",
            "        self.assertInBody(\"Password must have between 8 and 128 characters.\")",
            "",
            "    def test_change_password_with_too_long(self):",
            "        new_password = 'a' * 129",
            "        self._edit_user(self.USERNAME, password=new_password)",
            "        self.assertInBody(\"Password must have between 8 and 128 characters.\")",
            "",
            "    def test_change_admin_password(self):",
            "        # Given rdiffweb is configured with admin-password option",
            "        self.app.cfg.admin_password = 'hardcoded'",
            "        try:",
            "            # When trying to update admin password",
            "            self._edit_user('admin', password='new-password')",
            "            # Then the form is refused with 200 OK with an error message.",
            "            self.assertStatus(200)",
            "            self.assertInBody(\"can&#39;t update admin-password defined in configuration file\")",
            "        finally:",
            "            self.app.cfg.admin_password = None",
            "",
            "    def test_edit_user_with_invalid_path(self):",
            "        \"\"\"",
            "        Verify failure trying to update user with invalid path.",
            "        \"\"\"",
            "        self.app.store.add_user('test1')",
            "        self._edit_user(\"test1\", \"test1@test.com\", \"password\", \"/var/invalid/\", USER_ROLE)",
            "        self.assertNotInBody(\"User added successfully.\")",
            "        self.assertInBody(\"User&#39;s root directory /var/invalid/ is not accessible!\")",
            "",
            "    def test_list(self):",
            "        self.getPage(\"/admin/users/\")",
            "        self.assertInBody(\"Users\")",
            "        self.assertInBody(\"User management\")",
            "        self.assertInBody(\"Add user\")",
            "",
            "    def test_edit_user_with_not_existing_username(self):",
            "        \"\"\"",
            "        Verify failure trying to update invalid user.",
            "        \"\"\"",
            "        # Given an invalid username",
            "        username = 'invalid'",
            "        # When trying to edit the user",
            "        self._edit_user(username, \"test1@test.com\", \"test\", \"/var/invalid/\", USER_ROLE)",
            "        # Then the user list is displayed with an error message",
            "        self.assertStatus(200)",
            "        self.assertInBody(\"Cannot edit user `invalid`: user doesn&#39;t exists\")",
            "",
            "    def test_criteria(self):",
            "        \"\"\"",
            "        Check if admin criteria is working.",
            "        \"\"\"",
            "        self.app.store.add_user('test1')",
            "        self.getPage(\"/admin/users/?criteria=admins\")",
            "        self.assertNotInBody(\"test1\")",
            "",
            "    def test_search(self):",
            "        \"\"\"",
            "        Check if user search is working.",
            "        \"\"\"",
            "        self.app.store.add_user('test1')",
            "        self.getPage(\"/admin/users?search=tes\")",
            "        self.assertInBody(\"test1\")",
            "        self.getPage(\"/admin/users?search=coucou\")",
            "        self.assertNotInBody(\"test1\")",
            "",
            "    def test_user_invalid_root(self):",
            "        # Delete all user's",
            "        for user in self.app.store.users():",
            "            if user.username != self.USERNAME:",
            "                user.delete()",
            "        # Change the user's root",
            "        user = self.app.store.get_user('admin')",
            "        user.user_root = \"/invalid\"",
            "        self.getPage(\"/admin/users\")",
            "        self.assertInBody(\"Root directory not accessible!\")",
            "",
            "        # Query the page by default",
            "        user = self.app.store.get_user('admin')",
            "        user.user_root = \"/tmp/\"",
            "        self.getPage(\"/admin/users\")",
            "        self.assertNotInBody(\"Root directory not accessible!\")",
            "",
            "    def test_get_quota(self):",
            "        # Mock a quota.",
            "        self.listener.get_disk_quota.side_effect = None",
            "        self.listener.get_disk_quota.return_value = 654321",
            "        # When querying the user list",
            "        self.getPage(\"/admin/users/?criteria=admins\")",
            "        self.assertStatus(200)",
            "        # Then get_disk_quota listenre is called",
            "        self.listener.get_disk_quota.assert_called()",
            "        # Then the quota value is displayed in human readable format",
            "        self.assertInBody(\"638.99 KiB\")",
            "        self.assertStatus(200)",
            "",
            "    def test_set_quota(self):",
            "        # When updating user quota.",
            "        self._edit_user(\"admin\", disk_quota='8765432')",
            "        # Then listenr get called",
            "        self.listener.set_disk_quota.assert_called_once_with(ANY, 8765432)",
            "        # Then a success message is displayed",
            "        self.assertInBody(\"User information modified successfully.\")",
            "        self.assertStatus(200)",
            "",
            "    def test_set_quota_as_gib(self):",
            "        # When updating user quota",
            "        self._edit_user(\"admin\", disk_quota='1GiB')",
            "        # Then listern get called",
            "        self.listener.set_disk_quota.assert_called_once_with(ANY, 1073741824)",
            "        # Then a success message is displayed",
            "        self.assertInBody(\"User information modified successfully.\")",
            "        self.assertStatus(200)",
            "",
            "    def test_set_quota_as_with_comma(self):",
            "        # When updating quota with comma value",
            "        self._edit_user(\"admin\", disk_quota='1,5 GiB')",
            "        # Then listner get called",
            "        self.listener.set_disk_quota.assert_called_once_with(ANY, 1610612736)",
            "        # Then a success message is displayed",
            "        self.assertInBody(\"User information modified successfully.\")",
            "        self.assertStatus(200)",
            "",
            "    def test_set_quota_as_with_leading_dot(self):",
            "        # When updating quota with leading dot",
            "        self._edit_user(\"admin\", disk_quota='.5 GiB')",
            "        # Then listener get called",
            "        self.listener.set_disk_quota.assert_called_once_with(ANY, 536870912)",
            "        # Then a success message is displayed",
            "        self.assertInBody(\"User information modified successfully.\")",
            "        self.assertStatus(200)",
            "",
            "    def test_set_quota_empty(self):",
            "        # When quota is not defined",
            "        self._edit_user(\"admin\", disk_quota='')",
            "        # Then listener is not called.",
            "        self.listener.set_disk_quota.assert_not_called()",
            "        # Then message is not displayed",
            "        self.assertStatus(200)",
            "",
            "    def test_set_quota_same_value(self):",
            "        # Given an exiting quota",
            "        self.listener.get_disk_quota.side_effect = None",
            "        self.listener.get_disk_quota.return_value = 1234567890",
            "        # When setting the quota value to the same value",
            "        self._edit_user(\"admin\", disk_quota='1.15 GiB')",
            "        #  Then listener is not called",
            "        self.listener.set_disk_quota.assert_not_called()",
            "        # Then message is not displayed",
            "        self.assertStatus(200)",
            "",
            "    def test_set_quota_unsupported(self):",
            "        # Given setting quota is not supported",
            "        self.listener.set_disk_quota.side_effect = None",
            "        self.listener.set_disk_quota.return_value = None",
            "        # When updating the quota",
            "        self._edit_user(\"admin\", disk_quota='8765432')",
            "        # Then",
            "        self.listener.set_disk_quota.assert_called_once_with(ANY, 8765432)",
            "        self.assertInBody(\"Setting user&#39;s quota is not supported\")",
            "        self.assertStatus(200)",
            "",
            "",
            "class AdminUsersAsUserTest(AbstractAdminTest):",
            "    \"\"\"Integration test for page_admin\"\"\"",
            "",
            "    def setUp(self):",
            "        super().setUp()",
            "        # Add test user",
            "        self.app.store.add_user('test', 'test123')",
            "        self._login('test', 'test123')",
            "",
            "    def test_add_user(self):",
            "        \"\"\"",
            "        Check if adding user is forbidden.",
            "        \"\"\"",
            "        self._add_user(\"test2\", \"test2@test.com\", \"test2\", \"/tmp/\", USER_ROLE)",
            "        self.assertStatus(403)",
            "",
            "    def test_delete_user(self):",
            "        \"\"\"",
            "        Check if deleting user is forbidden.",
            "        \"\"\"",
            "        self._delete_user(\"test\")",
            "        self.assertStatus(403)",
            "",
            "    def test_edit_user(self):",
            "        \"\"\"",
            "        Check if editing user is forbidden.",
            "        \"\"\"",
            "        self._edit_user(\"test\", \"test1@test.com\", \"test\", \"/var/invalid/\", USER_ROLE)",
            "        self.assertStatus(403)",
            "",
            "    def test_users(self):",
            "        \"\"\"",
            "        Check if listing user is forbidden.",
            "        \"\"\"",
            "        self.getPage(\"/admin/users\")",
            "        self.assertStatus(403)",
            "",
            "    def test_repos(self):",
            "        \"\"\"",
            "        Check if listing user is forbidden.",
            "        \"\"\"",
            "        self.getPage(\"/admin/repos\")",
            "        self.assertStatus(403)",
            "",
            "",
            "class AdminWithNoLogsTest(rdiffweb.test.WebCase):",
            "",
            "    login = True",
            "",
            "    def test_logs(self):",
            "        self.getPage(\"/admin/logs/\")",
            "        self.assertStatus(200)",
            "        self.assertInBody(\"No log files\")",
            "",
            "",
            "class AdminWithLogsTest(rdiffweb.test.WebCase):",
            "",
            "    login = True",
            "    default_config = {'logfile': '/tmp/rdiffweb.log', 'logaccessfile': '/tmp/rdiffweb-access.log'}",
            "",
            "    def test_logs(self):",
            "        with open('/tmp/rdiffweb.log', 'w') as f:",
            "            f.write(\"content of log file\")",
            "        with open('/tmp/rdiffweb-access.log', 'w') as f:",
            "            f.write(\"content of log file\")",
            "        try:",
            "            self.getPage(\"/admin/logs/\")",
            "            self.assertStatus(200)",
            "            self.assertInBody(\"rdiffweb.log\")",
            "            self.assertInBody(\"content of log file\")",
            "            self.assertInBody(\"rdiffweb-access.log\")",
            "            self.assertNotInBody(\"Error getting file content\")",
            "        finally:",
            "            os.remove('/tmp/rdiffweb.log')",
            "            os.remove('/tmp/rdiffweb-access.log')",
            "",
            "",
            "class AdminWithLogMissingTest(rdiffweb.test.WebCase):",
            "",
            "    login = True",
            "    default_config = {'logfile': './rdiffweb.log', 'logaccessfile': './rdiffweb-access.log'}",
            "",
            "    def test_logs_with_no_file(self):",
            "        self.getPage(\"/admin/logs/\")",
            "        self.assertStatus(200)",
            "        self.assertInBody(\"rdiffweb.log\")",
            "        self.assertInBody(\"Error getting file content\")",
            "",
            "    def test_logs_with_invalid_file(self):",
            "        self.getPage(\"/admin/logs/invalid\")",
            "        self.assertStatus(404)",
            "",
            "",
            "class AdminReposTest(rdiffweb.test.WebCase):",
            "",
            "    login = True",
            "",
            "    def test_repos(self):",
            "        self.getPage(\"/admin/repos\")",
            "        self.assertStatus(200)",
            "",
            "    def test_repos_with_search(self):",
            "        # Search something that exists",
            "        self.getPage(\"/admin/repos?search=test\")",
            "        self.assertStatus(200)",
            "        self.assertInBody(self.REPO)",
            "",
            "        # Search something that doesn't exists",
            "        self.getPage(\"/admin/repos?search=coucou\")",
            "        self.assertStatus(200)",
            "        self.assertNotInBody(self.REPO)",
            "        self.assertInBody(\"No repository found\")",
            "",
            "    def test_repos_with_criteria(self):",
            "        # Search something that exists",
            "        self.getPage(\"/admin/repos?criteria=ok\")",
            "        self.assertStatus(200)",
            "        self.assertInBody(self.REPO)",
            "",
            "        # Search something that exists",
            "        self.getPage(\"/admin/repos?criteria=failed\")",
            "        self.assertStatus(200)",
            "        self.assertNotInBody(self.REPO)",
            "        self.assertInBody(\"No repository found\")",
            "",
            "",
            "class AdminSysinfoTest(rdiffweb.test.WebCase):",
            "",
            "    login = True",
            "",
            "    def test_sysinfo(self):",
            "        self.getPage(\"/admin/sysinfo\")",
            "        self.assertStatus(200)",
            "        self.assertInBody(\"Operating System Info\")",
            "        self.assertInBody(\"Python Info\")"
        ],
        "afterPatchFile": [
            "# -*- coding: utf-8 -*-",
            "# rdiffweb, A web interface to rdiff-backup repositories",
            "# Copyright (C) 2012-2021 rdiffweb contributors",
            "#",
            "# This program is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This program is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with this program.  If not, see <http://www.gnu.org/licenses/>.",
            "\"\"\"",
            "Created on Dec 30, 2015",
            "",
            "@author: Patrik Dufresne",
            "\"\"\"",
            "",
            "import os",
            "from unittest.mock import ANY, MagicMock",
            "",
            "import cherrypy",
            "",
            "import rdiffweb.test",
            "from rdiffweb.core.store import ADMIN_ROLE, MAINTAINER_ROLE, USER_ROLE",
            "",
            "",
            "class AbstractAdminTest(rdiffweb.test.WebCase):",
            "    \"\"\"Class to regroup command method to test admin page.\"\"\"",
            "",
            "    def setUp(self):",
            "        super().setUp()",
            "        self._quota = {}",
            "        self.listener = MagicMock()",
            "        cherrypy.engine.subscribe('user_added', self.listener.user_added, priority=50)",
            "        cherrypy.engine.subscribe('user_attr_changed', self.listener.user_attr_changed, priority=50)",
            "        cherrypy.engine.subscribe('user_deleted', self.listener.user_deleted, priority=50)",
            "        cherrypy.engine.subscribe('user_password_changed', self.listener.user_password_changed, priority=50)",
            "        self.listener.get_disk_quota.side_effect = self._load_quota",
            "        cherrypy.engine.subscribe('get_disk_quota', self.listener.get_disk_quota, priority=40)",
            "        self.listener.get_disk_usage.return_value = 0",
            "        cherrypy.engine.subscribe('get_disk_usage', self.listener.get_disk_usage, priority=40)",
            "        self.listener.set_disk_quota.side_effect = self._store_quota",
            "        cherrypy.engine.subscribe('set_disk_quota', self.listener.set_disk_quota, priority=40)",
            "",
            "    def tearDown(self):",
            "        cherrypy.engine.unsubscribe('user_added', self.listener.user_added)",
            "        cherrypy.engine.unsubscribe('user_attr_changed', self.listener.user_attr_changed)",
            "        cherrypy.engine.unsubscribe('user_deleted', self.listener.user_deleted)",
            "        cherrypy.engine.unsubscribe('user_password_changed', self.listener.user_password_changed)",
            "        cherrypy.engine.unsubscribe('get_disk_quota', self.listener.get_disk_quota)",
            "        cherrypy.engine.unsubscribe('get_disk_usage', self.listener.get_disk_usage)",
            "        cherrypy.engine.unsubscribe('set_disk_quota', self.listener.set_disk_quota)",
            "        return super().tearDown()",
            "",
            "    def _store_quota(self, userobj, value):",
            "        self._quota[userobj.username] = value",
            "",
            "    def _load_quota(self, userobj):",
            "        return self._quota.get(userobj.username, 0)",
            "",
            "    def _add_user(self, username=None, email=None, password=None, user_root=None, role=None):",
            "        b = {}",
            "        b['action'] = 'add'",
            "        if username is not None:",
            "            b['username'] = username",
            "        if email is not None:",
            "            b['email'] = email",
            "        if password is not None:",
            "            b['password'] = password",
            "        if user_root is not None:",
            "            b['user_root'] = user_root",
            "        if role is not None:",
            "            b['role'] = str(role)",
            "        self.getPage(\"/admin/users/\", method='POST', body=b)",
            "",
            "    def _edit_user(self, username=None, email=None, password=None, user_root=None, role=None, disk_quota=None):",
            "        b = {}",
            "        b['action'] = 'edit'",
            "        if username is not None:",
            "            b['username'] = username",
            "        if email is not None:",
            "            b['email'] = email",
            "        if password is not None:",
            "            b['password'] = password",
            "        if user_root is not None:",
            "            b['user_root'] = user_root",
            "        if role is not None:",
            "            b['role'] = str(role)",
            "        if disk_quota is not None:",
            "            b['disk_quota'] = disk_quota",
            "        self.getPage(\"/admin/users/\", method='POST', body=b)",
            "",
            "    def _delete_user(self, username='test1'):",
            "        b = {'action': 'delete', 'username': username}",
            "        self.getPage(\"/admin/users/\", method='POST', body=b)",
            "",
            "",
            "class AdminUsersAsAdminTest(AbstractAdminTest):",
            "    \"\"\"Integration test for page_admin\"\"\"",
            "",
            "    login = True",
            "",
            "    def test_add_user_with_role_admin(self):",
            "        # When trying to create a new user with role admin",
            "        self._add_user(\"admin_role\", \"admin_role@test.com\", \"password\", \"/home/\", ADMIN_ROLE)",
            "        # Then page return success",
            "        self.assertStatus(200)",
            "        # Then database is updated",
            "        userobj = self.app.store.get_user('admin_role')",
            "        self.assertEqual(ADMIN_ROLE, userobj.role)",
            "        # Then notification was raised",
            "        self.listener.user_added.assert_called_once_with(userobj)",
            "",
            "    def test_add_user_with_role_maintainer(self):",
            "        self._add_user(\"maintainer_role\", \"maintainer_role@test.com\", \"password\", \"/home/\", MAINTAINER_ROLE)",
            "        self.assertStatus(200)",
            "        self.assertEqual(MAINTAINER_ROLE, self.app.store.get_user('maintainer_role').role)",
            "",
            "    def test_add_user_with_role_user(self):",
            "        self._add_user(\"user_role\", \"user_role@test.com\", \"password\", \"/home/\", USER_ROLE)",
            "        self.assertStatus(200)",
            "        self.assertEqual(USER_ROLE, self.app.store.get_user('user_role').role)",
            "",
            "    def test_add_user_with_invalid_role(self):",
            "        # When trying to create a new user with an invalid role (admin instead of 0)",
            "        self._add_user(\"invalid\", \"invalid@test.com\", \"test1234\", \"/home/\", 'admin')",
            "        # Then an error message is displayed to the user",
            "        self.assertStatus(200)",
            "        self.assertInBody('role: Invalid Choice: could not coerce')",
            "        # Then listener are not called",
            "        self.listener.user_added.assert_not_called()",
            "",
            "        # When trying to create a new user with an invalid role (-1)",
            "        self._add_user(\"invalid\", \"invalid@test.com\", \"test2\", \"/home/\", -1)",
            "        # Then an error message is displayed to the user",
            "        self.assertStatus(200)",
            "        self.assertInBody('role: Not a valid choice')",
            "        # Then listener are not called",
            "        self.listener.user_added.assert_not_called()",
            "",
            "    def test_add_edit_delete(self):",
            "        #  Add user to be listed",
            "        self._add_user(\"test2\", \"test2@test.com\", \"test1234\", \"/home/\", USER_ROLE)",
            "        self.assertInBody(\"User added successfully.\")",
            "        self.assertInBody(\"test2\")",
            "        self.assertInBody(\"test2@test.com\")",
            "        self.listener.user_added.assert_called_once()",
            "        self.listener.user_password_changed.assert_called_once()",
            "        self.listener.user_password_changed.reset_mock()",
            "        #  Update user",
            "        self._edit_user(\"test2\", \"chaned@test.com\", \"new-password\", \"/tmp/\", ADMIN_ROLE)",
            "        self.listener.user_attr_changed.assert_called()",
            "        self.listener.user_password_changed.assert_called_once()",
            "        self.assertInBody(\"User information modified successfully.\")",
            "        self.assertInBody(\"test2\")",
            "        self.assertInBody(\"chaned@test.com\")",
            "        self.assertNotInBody(\"/home/\")",
            "        self.assertInBody(\"/tmp/\")",
            "        #  Check with filters",
            "        self.getPage(\"/admin/users/?criteria=admins\")",
            "        self.assertInBody(\"test2\")",
            "",
            "        self._delete_user(\"test2\")",
            "        self.listener.user_deleted.assert_called()",
            "        self.assertStatus(200)",
            "        self.assertInBody(\"User account removed.\")",
            "        self.assertNotInBody(\"test2\")",
            "",
            "    def test_add_edit_delete_user_with_encoding(self):",
            "        \"\"\"",
            "        Check creation of user with non-ascii char.",
            "        \"\"\"",
            "        self._add_user(\"\u00c9ric\", \"\u00e9ric@test.com\", \"password\", \"/home/\", USER_ROLE)",
            "        self.assertInBody(\"User added successfully.\")",
            "        self.assertInBody(\"\u00c9ric\")",
            "        self.assertInBody(\"\u00e9ric@test.com\")",
            "        # Update user",
            "        self._edit_user(\"\u00c9ric\", \"eric.l\u00e9tourno@test.com\", \"\u00e9cureuil\", \"/tmp/\", ADMIN_ROLE)",
            "        self.assertInBody(\"User information modified successfully.\")",
            "        self.assertInBody(\"\u00c9ric\")",
            "        self.assertInBody(\"eric.l\u00e9tourno@test.com\")",
            "        self.assertNotInBody(\"/home/\")",
            "        self.assertInBody(\"/tmp/\")",
            "        # Check with filter",
            "        self.getPage(\"/admin/users/?criteria=admins\")",
            "        self.assertInBody(\"\u00c9ric\")",
            "",
            "        self._delete_user(\"\u00c9ric\")",
            "        self.assertInBody(\"User account removed.\")",
            "        self.assertNotInBody(\"\u00c9ric\")",
            "",
            "    def test_add_user_with_empty_username(self):",
            "        \"\"\"",
            "        Verify failure trying to create user without username.",
            "        \"\"\"",
            "        self._add_user(\"\", \"test1@test.com\", \"test1\", \"/tmp/\", USER_ROLE)",
            "        self.assertStatus(200)",
            "        self.assertInBody(\"username: This field is required.\")",
            "",
            "    def test_add_user_with_existing_username(self):",
            "        \"\"\"",
            "        Verify failure trying to add the same user.",
            "        \"\"\"",
            "        # Given a user named `test1`",
            "        self._add_user(\"test1\", \"test1@test.com\", \"password\", \"/tmp/\", USER_ROLE)",
            "        # When trying to create a new user with the same name",
            "        self._add_user(\"test1\", \"test1@test.com\", \"password\", \"/tmp/\", USER_ROLE)",
            "        # Then the user list is displayed with an error message.",
            "        self.assertStatus(200)",
            "        self.assertInBody(\"User test1 already exists.\")",
            "",
            "    def test_add_user_with_invalid_root_directory(self):",
            "        \"\"\"",
            "        Verify failure to add a user with invalid root directory.",
            "        \"\"\"",
            "        try:",
            "            self._delete_user(\"test5\")",
            "        except Exception:",
            "            pass",
            "        self._add_user(\"test5\", \"test1@test.com\", \"password\", \"/var/invalid/\", USER_ROLE)",
            "        self.assertInBody(\"User added successfully.\")",
            "        self.assertInBody(\"User&#39;s root directory /var/invalid/ is not accessible!\")",
            "",
            "    def test_add_without_email(self):",
            "        #  Add user to be listed",
            "        self._add_user(\"test2\", None, \"password\", \"/tmp/\", USER_ROLE)",
            "        self.assertInBody(\"User added successfully.\")",
            "",
            "    def test_add_without_user_root(self):",
            "        #  Add user to be listed",
            "        self._add_user(\"test6\", None, \"password\", None, USER_ROLE)",
            "        self.assertInBody(\"User added successfully.\")",
            "",
            "        user = self.app.store.get_user('test6')",
            "        self.assertEqual('', user.user_root)",
            "",
            "    def test_delete_user_with_not_existing_username(self):",
            "        \"\"\"",
            "        Verify failure to delete invalid username.",
            "        \"\"\"",
            "        self._delete_user(\"test3\")",
            "        self.assertInBody(\"User doesn&#39;t exists!\")",
            "",
            "    def test_delete_our_self(self):",
            "        \"\"\"",
            "        Verify failure to delete our self.",
            "        \"\"\"",
            "        self._delete_user(self.USERNAME)",
            "        self.assertInBody(\"You cannot remove your own account!\")",
            "",
            "    def test_delete_user_admin(self):",
            "        \"\"\"",
            "        Verify failure to delete our self.",
            "        \"\"\"",
            "        # Create another admin user",
            "        self._add_user('admin2', '', 'password', '', ADMIN_ROLE)",
            "        self.getPage(\"/logout/\")",
            "        self._login('admin2', 'password')",
            "",
            "        # Try deleting admin user",
            "        self._delete_user(self.USERNAME)",
            "        self.assertStatus(200)",
            "        self.assertInBody(\"can&#39;t delete admin user\")",
            "",
            "    def test_delete_user_method_get(self):",
            "        # Given a user",
            "        self.app.store.add_user('newuser')",
            "        # When trying to delete this user using method GET",
            "        self.getPage(\"/admin/users/?action=delete&username=newuser\", method='GET')",
            "        # Then page return without error",
            "        self.assertStatus(200)",
            "        # Then user is not deleted",
            "        self.assertIsNotNone(self.app.store.get_user('newuser'))",
            "",
            "    def test_change_password_with_too_short(self):",
            "        self._edit_user(self.USERNAME, password='short')",
            "        self.assertInBody(\"Password must have between 8 and 128 characters.\")",
            "",
            "    def test_change_password_with_too_long(self):",
            "        new_password = 'a' * 129",
            "        self._edit_user(self.USERNAME, password=new_password)",
            "        self.assertInBody(\"Password must have between 8 and 128 characters.\")",
            "",
            "    def test_change_admin_password(self):",
            "        # Given rdiffweb is configured with admin-password option",
            "        self.app.cfg.admin_password = 'hardcoded'",
            "        try:",
            "            # When trying to update admin password",
            "            self._edit_user('admin', password='new-password')",
            "            # Then the form is refused with 200 OK with an error message.",
            "            self.assertStatus(200)",
            "            self.assertInBody(\"can&#39;t update admin-password defined in configuration file\")",
            "        finally:",
            "            self.app.cfg.admin_password = None",
            "",
            "    def test_edit_user_with_invalid_path(self):",
            "        \"\"\"",
            "        Verify failure trying to update user with invalid path.",
            "        \"\"\"",
            "        self.app.store.add_user('test1')",
            "        self._edit_user(\"test1\", \"test1@test.com\", \"password\", \"/var/invalid/\", USER_ROLE)",
            "        self.assertNotInBody(\"User added successfully.\")",
            "        self.assertInBody(\"User&#39;s root directory /var/invalid/ is not accessible!\")",
            "",
            "    def test_list(self):",
            "        self.getPage(\"/admin/users/\")",
            "        self.assertInBody(\"Users\")",
            "        self.assertInBody(\"User management\")",
            "        self.assertInBody(\"Add user\")",
            "",
            "    def test_edit_user_with_not_existing_username(self):",
            "        \"\"\"",
            "        Verify failure trying to update invalid user.",
            "        \"\"\"",
            "        # Given an invalid username",
            "        username = 'invalid'",
            "        # When trying to edit the user",
            "        self._edit_user(username, \"test1@test.com\", \"test\", \"/var/invalid/\", USER_ROLE)",
            "        # Then the user list is displayed with an error message",
            "        self.assertStatus(200)",
            "        self.assertInBody(\"Cannot edit user `invalid`: user doesn&#39;t exists\")",
            "",
            "    def test_criteria(self):",
            "        \"\"\"",
            "        Check if admin criteria is working.",
            "        \"\"\"",
            "        self.app.store.add_user('test1')",
            "        self.getPage(\"/admin/users/?criteria=admins\")",
            "        self.assertNotInBody(\"test1\")",
            "",
            "    def test_search(self):",
            "        \"\"\"",
            "        Check if user search is working.",
            "        \"\"\"",
            "        self.app.store.add_user('test1')",
            "        self.getPage(\"/admin/users?search=tes\")",
            "        self.assertInBody(\"test1\")",
            "        self.getPage(\"/admin/users?search=coucou\")",
            "        self.assertNotInBody(\"test1\")",
            "",
            "    def test_user_invalid_root(self):",
            "        # Delete all user's",
            "        for user in self.app.store.users():",
            "            if user.username != self.USERNAME:",
            "                user.delete()",
            "        # Change the user's root",
            "        user = self.app.store.get_user('admin')",
            "        user.user_root = \"/invalid\"",
            "        self.getPage(\"/admin/users\")",
            "        self.assertInBody(\"Root directory not accessible!\")",
            "",
            "        # Query the page by default",
            "        user = self.app.store.get_user('admin')",
            "        user.user_root = \"/tmp/\"",
            "        self.getPage(\"/admin/users\")",
            "        self.assertNotInBody(\"Root directory not accessible!\")",
            "",
            "    def test_get_quota(self):",
            "        # Mock a quota.",
            "        self.listener.get_disk_quota.side_effect = None",
            "        self.listener.get_disk_quota.return_value = 654321",
            "        # When querying the user list",
            "        self.getPage(\"/admin/users/?criteria=admins\")",
            "        self.assertStatus(200)",
            "        # Then get_disk_quota listenre is called",
            "        self.listener.get_disk_quota.assert_called()",
            "        # Then the quota value is displayed in human readable format",
            "        self.assertInBody(\"638.99 KiB\")",
            "        self.assertStatus(200)",
            "",
            "    def test_set_quota(self):",
            "        # When updating user quota.",
            "        self._edit_user(\"admin\", disk_quota='8765432')",
            "        # Then listenr get called",
            "        self.listener.set_disk_quota.assert_called_once_with(ANY, 8765432)",
            "        # Then a success message is displayed",
            "        self.assertInBody(\"User information modified successfully.\")",
            "        self.assertStatus(200)",
            "",
            "    def test_set_quota_as_gib(self):",
            "        # When updating user quota",
            "        self._edit_user(\"admin\", disk_quota='1GiB')",
            "        # Then listern get called",
            "        self.listener.set_disk_quota.assert_called_once_with(ANY, 1073741824)",
            "        # Then a success message is displayed",
            "        self.assertInBody(\"User information modified successfully.\")",
            "        self.assertStatus(200)",
            "",
            "    def test_set_quota_as_with_comma(self):",
            "        # When updating quota with comma value",
            "        self._edit_user(\"admin\", disk_quota='1,5 GiB')",
            "        # Then listner get called",
            "        self.listener.set_disk_quota.assert_called_once_with(ANY, 1610612736)",
            "        # Then a success message is displayed",
            "        self.assertInBody(\"User information modified successfully.\")",
            "        self.assertStatus(200)",
            "",
            "    def test_set_quota_as_with_leading_dot(self):",
            "        # When updating quota with leading dot",
            "        self._edit_user(\"admin\", disk_quota='.5 GiB')",
            "        # Then listener get called",
            "        self.listener.set_disk_quota.assert_called_once_with(ANY, 536870912)",
            "        # Then a success message is displayed",
            "        self.assertInBody(\"User information modified successfully.\")",
            "        self.assertStatus(200)",
            "",
            "    def test_set_quota_empty(self):",
            "        # When quota is not defined",
            "        self._edit_user(\"admin\", disk_quota='')",
            "        # Then listener is not called.",
            "        self.listener.set_disk_quota.assert_not_called()",
            "        # Then message is not displayed",
            "        self.assertStatus(200)",
            "",
            "    def test_set_quota_same_value(self):",
            "        # Given an exiting quota",
            "        self.listener.get_disk_quota.side_effect = None",
            "        self.listener.get_disk_quota.return_value = 1234567890",
            "        # When setting the quota value to the same value",
            "        self._edit_user(\"admin\", disk_quota='1.15 GiB')",
            "        #  Then listener is not called",
            "        self.listener.set_disk_quota.assert_not_called()",
            "        # Then message is not displayed",
            "        self.assertStatus(200)",
            "",
            "    def test_set_quota_unsupported(self):",
            "        # Given setting quota is not supported",
            "        self.listener.set_disk_quota.side_effect = None",
            "        self.listener.set_disk_quota.return_value = None",
            "        # When updating the quota",
            "        self._edit_user(\"admin\", disk_quota='8765432')",
            "        # Then",
            "        self.listener.set_disk_quota.assert_called_once_with(ANY, 8765432)",
            "        self.assertInBody(\"Setting user&#39;s quota is not supported\")",
            "        self.assertStatus(200)",
            "",
            "",
            "class AdminUsersAsUserTest(AbstractAdminTest):",
            "    \"\"\"Integration test for page_admin\"\"\"",
            "",
            "    def setUp(self):",
            "        super().setUp()",
            "        # Add test user",
            "        self.app.store.add_user('test', 'test123')",
            "        self._login('test', 'test123')",
            "",
            "    def test_add_user(self):",
            "        \"\"\"",
            "        Check if adding user is forbidden.",
            "        \"\"\"",
            "        self._add_user(\"test2\", \"test2@test.com\", \"test2\", \"/tmp/\", USER_ROLE)",
            "        self.assertStatus(403)",
            "",
            "    def test_delete_user(self):",
            "        \"\"\"",
            "        Check if deleting user is forbidden.",
            "        \"\"\"",
            "        self._delete_user(\"test\")",
            "        self.assertStatus(403)",
            "",
            "    def test_edit_user(self):",
            "        \"\"\"",
            "        Check if editing user is forbidden.",
            "        \"\"\"",
            "        self._edit_user(\"test\", \"test1@test.com\", \"test\", \"/var/invalid/\", USER_ROLE)",
            "        self.assertStatus(403)",
            "",
            "    def test_users(self):",
            "        \"\"\"",
            "        Check if listing user is forbidden.",
            "        \"\"\"",
            "        self.getPage(\"/admin/users\")",
            "        self.assertStatus(403)",
            "",
            "    def test_repos(self):",
            "        \"\"\"",
            "        Check if listing user is forbidden.",
            "        \"\"\"",
            "        self.getPage(\"/admin/repos\")",
            "        self.assertStatus(403)",
            "",
            "",
            "class AdminWithNoLogsTest(rdiffweb.test.WebCase):",
            "",
            "    login = True",
            "",
            "    def test_logs(self):",
            "        self.getPage(\"/admin/logs/\")",
            "        self.assertStatus(200)",
            "        self.assertInBody(\"No log files\")",
            "",
            "",
            "class AdminWithLogsTest(rdiffweb.test.WebCase):",
            "",
            "    login = True",
            "    default_config = {'logfile': '/tmp/rdiffweb.log', 'logaccessfile': '/tmp/rdiffweb-access.log'}",
            "",
            "    def test_logs(self):",
            "        with open('/tmp/rdiffweb.log', 'w') as f:",
            "            f.write(\"content of log file\")",
            "        with open('/tmp/rdiffweb-access.log', 'w') as f:",
            "            f.write(\"content of log file\")",
            "        try:",
            "            self.getPage(\"/admin/logs/\")",
            "            self.assertStatus(200)",
            "            self.assertInBody(\"rdiffweb.log\")",
            "            self.assertInBody(\"content of log file\")",
            "            self.assertInBody(\"rdiffweb-access.log\")",
            "            self.assertNotInBody(\"Error getting file content\")",
            "        finally:",
            "            os.remove('/tmp/rdiffweb.log')",
            "            os.remove('/tmp/rdiffweb-access.log')",
            "",
            "",
            "class AdminWithLogMissingTest(rdiffweb.test.WebCase):",
            "",
            "    login = True",
            "    default_config = {'logfile': './rdiffweb.log', 'logaccessfile': './rdiffweb-access.log'}",
            "",
            "    def test_logs_with_no_file(self):",
            "        self.getPage(\"/admin/logs/\")",
            "        self.assertStatus(200)",
            "        self.assertInBody(\"rdiffweb.log\")",
            "        self.assertInBody(\"Error getting file content\")",
            "",
            "    def test_logs_with_invalid_file(self):",
            "        self.getPage(\"/admin/logs/invalid\")",
            "        self.assertStatus(404)",
            "",
            "",
            "class AdminReposTest(rdiffweb.test.WebCase):",
            "",
            "    login = True",
            "",
            "    def test_repos(self):",
            "        self.getPage(\"/admin/repos\")",
            "        self.assertStatus(200)",
            "",
            "    def test_repos_with_search(self):",
            "        # Search something that exists",
            "        self.getPage(\"/admin/repos?search=test\")",
            "        self.assertStatus(200)",
            "        self.assertInBody(self.REPO)",
            "",
            "        # Search something that doesn't exists",
            "        self.getPage(\"/admin/repos?search=coucou\")",
            "        self.assertStatus(200)",
            "        self.assertNotInBody(self.REPO)",
            "        self.assertInBody(\"No repository found\")",
            "",
            "    def test_repos_with_criteria(self):",
            "        # Search something that exists",
            "        self.getPage(\"/admin/repos?criteria=ok\")",
            "        self.assertStatus(200)",
            "        self.assertInBody(self.REPO)",
            "",
            "        # Search something that exists",
            "        self.getPage(\"/admin/repos?criteria=failed\")",
            "        self.assertStatus(200)",
            "        self.assertNotInBody(self.REPO)",
            "        self.assertInBody(\"No repository found\")",
            "",
            "",
            "class AdminSysinfoTest(rdiffweb.test.WebCase):",
            "",
            "    login = True",
            "",
            "    def test_sysinfo(self):",
            "        self.getPage(\"/admin/sysinfo\")",
            "        self.assertStatus(200)",
            "        self.assertInBody(\"Operating System Info\")",
            "        self.assertInBody(\"Python Info\")"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {},
        "addLocation": [
            "rdiffweb.controller.tests.test_page_admin.AbstractAdminTest.self",
            "rdiffweb.controller.tests.test_page_admin.AdminUsersAsAdminTest.self",
            "jupyterhub.services.auth.HubOAuth"
        ]
    },
    "rdiffweb/controller/tests/test_page_delete.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 37,
                "afterPatchRowNumber": 37,
                "PatchRowcode": " "
            },
            "1": {
                "beforePatchRowNumber": 38,
                "afterPatchRowNumber": 38,
                "PatchRowcode": "     login = True"
            },
            "2": {
                "beforePatchRowNumber": 39,
                "afterPatchRowNumber": 39,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": 40,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    def _delete(self, user, repo, confirm, redirect=None):"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 40,
                "PatchRowcode": "+    def _delete(self, user, repo, confirm):"
            },
            "5": {
                "beforePatchRowNumber": 41,
                "afterPatchRowNumber": 41,
                "PatchRowcode": "         body = {}"
            },
            "6": {
                "beforePatchRowNumber": 42,
                "afterPatchRowNumber": 42,
                "PatchRowcode": "         if confirm is not None:"
            },
            "7": {
                "beforePatchRowNumber": 43,
                "afterPatchRowNumber": 43,
                "PatchRowcode": "             body.update({'confirm': confirm})"
            },
            "8": {
                "beforePatchRowNumber": 44,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        if redirect is not None:"
            },
            "9": {
                "beforePatchRowNumber": 45,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            body['redirect'] = redirect"
            },
            "10": {
                "beforePatchRowNumber": 46,
                "afterPatchRowNumber": 44,
                "PatchRowcode": "         self.getPage(\"/delete/\" + user + \"/\" + repo + \"/\", method=\"POST\", body=body)"
            },
            "11": {
                "beforePatchRowNumber": 47,
                "afterPatchRowNumber": 45,
                "PatchRowcode": " "
            },
            "12": {
                "beforePatchRowNumber": 48,
                "afterPatchRowNumber": 46,
                "PatchRowcode": "     @skipIf(RDIFF_BACKUP_VERSION < (2, 0, 1), \"rdiff-backup-delete is available since 2.0.1\")"
            },
            "13": {
                "beforePatchRowNumber": 49,
                "afterPatchRowNumber": 47,
                "PatchRowcode": "     @parameterized.expand("
            },
            "14": {
                "beforePatchRowNumber": 50,
                "afterPatchRowNumber": 48,
                "PatchRowcode": "         ["
            },
            "15": {
                "beforePatchRowNumber": 51,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            (\"with_dir\", 'admin', '/testcases/Revisions', 'Revisions', 303, 404),"
            },
            "16": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 49,
                "PatchRowcode": "+            (\"with_dir\", 'admin', '/testcases/Revisions', 'Revisions', 303, 404, '/browse/admin/testcases'),"
            },
            "17": {
                "beforePatchRowNumber": 52,
                "afterPatchRowNumber": 50,
                "PatchRowcode": "             (\"with_dir_wrong_confirmation\", 'admin', '/testcases/Revisions', 'invalid', 400, 200),"
            },
            "18": {
                "beforePatchRowNumber": 53,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            (\"with_file\", 'admin', '/testcases/Revisions/Data', 'Data', 303, 404),"
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 51,
                "PatchRowcode": "+            (\"with_file\", 'admin', '/testcases/Revisions/Data', 'Data', 303, 404, '/browse/admin/testcases/Revisions'),"
            },
            "20": {
                "beforePatchRowNumber": 54,
                "afterPatchRowNumber": 52,
                "PatchRowcode": "             (\"with_file_wrong_confirmation\", 'admin', '/testcases/Revisions/Data', 'invalid', 400, 200),"
            },
            "21": {
                "beforePatchRowNumber": 55,
                "afterPatchRowNumber": 53,
                "PatchRowcode": "             (\"with_invalid\", 'admin', '/testcases/invalid', 'invalid', 404, 404),"
            },
            "22": {
                "beforePatchRowNumber": 56,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            (\"with_broken_symlink\", 'admin', '/testcases/BrokenSymlink', 'BrokenSymlink', 303, 404),"
            },
            "23": {
                "beforePatchRowNumber": 57,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            (\"with_utf8\", 'admin', '/testcases/R%C3%A9pertoire%20Existant', 'R\u00e9pertoire Existant', 303, 404),"
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 54,
                "PatchRowcode": "+            ("
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 55,
                "PatchRowcode": "+                \"with_broken_symlink\","
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 56,
                "PatchRowcode": "+                'admin',"
            },
            "27": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 57,
                "PatchRowcode": "+                '/testcases/BrokenSymlink',"
            },
            "28": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 58,
                "PatchRowcode": "+                'BrokenSymlink',"
            },
            "29": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 59,
                "PatchRowcode": "+                303,"
            },
            "30": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 60,
                "PatchRowcode": "+                404,"
            },
            "31": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 61,
                "PatchRowcode": "+                '/browse/admin/testcases',"
            },
            "32": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 62,
                "PatchRowcode": "+            ),"
            },
            "33": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 63,
                "PatchRowcode": "+            ("
            },
            "34": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 64,
                "PatchRowcode": "+                \"with_utf8\","
            },
            "35": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 65,
                "PatchRowcode": "+                'admin',"
            },
            "36": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 66,
                "PatchRowcode": "+                '/testcases/R%C3%A9pertoire%20Existant',"
            },
            "37": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 67,
                "PatchRowcode": "+                'R\u00e9pertoire Existant',"
            },
            "38": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 68,
                "PatchRowcode": "+                303,"
            },
            "39": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 69,
                "PatchRowcode": "+                404,"
            },
            "40": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 70,
                "PatchRowcode": "+                '/browse/admin/testcases',"
            },
            "41": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 71,
                "PatchRowcode": "+            ),"
            },
            "42": {
                "beforePatchRowNumber": 58,
                "afterPatchRowNumber": 72,
                "PatchRowcode": "             (\"with_rdiff_backup_data\", 'admin', '/testcases/rdiff-backup-data', 'rdiff-backup-data', 404, 404),"
            },
            "43": {
                "beforePatchRowNumber": 59,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            (\"with_quoted_path\", 'admin', '/testcases/Char%20%3B090%20to%20quote', 'Char Z to quote', 303, 404),"
            },
            "44": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 73,
                "PatchRowcode": "+            ("
            },
            "45": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 74,
                "PatchRowcode": "+                \"with_quoted_path\","
            },
            "46": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 75,
                "PatchRowcode": "+                'admin',"
            },
            "47": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 76,
                "PatchRowcode": "+                '/testcases/Char%20%3B090%20to%20quote',"
            },
            "48": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 77,
                "PatchRowcode": "+                'Char Z to quote',"
            },
            "49": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 78,
                "PatchRowcode": "+                303,"
            },
            "50": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 79,
                "PatchRowcode": "+                404,"
            },
            "51": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 80,
                "PatchRowcode": "+                '/browse/admin/testcases',"
            },
            "52": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 81,
                "PatchRowcode": "+            ),"
            },
            "53": {
                "beforePatchRowNumber": 60,
                "afterPatchRowNumber": 82,
                "PatchRowcode": "         ]"
            },
            "54": {
                "beforePatchRowNumber": 61,
                "afterPatchRowNumber": 83,
                "PatchRowcode": "     )"
            },
            "55": {
                "beforePatchRowNumber": 62,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    def test_delete_path(self, unused, username, path, confirmation, expected_status, expected_history_status):"
            },
            "56": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 84,
                "PatchRowcode": "+    def test_delete_path("
            },
            "57": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 85,
                "PatchRowcode": "+        self, unused, username, path, confirmation, expected_status, expected_history_status, expected_redirect=None"
            },
            "58": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 86,
                "PatchRowcode": "+    ):"
            },
            "59": {
                "beforePatchRowNumber": 63,
                "afterPatchRowNumber": 87,
                "PatchRowcode": "         # When trying to delete a file or a folder with a confirmation"
            },
            "60": {
                "beforePatchRowNumber": 64,
                "afterPatchRowNumber": 88,
                "PatchRowcode": "         self._delete(username, path, confirmation)"
            },
            "61": {
                "beforePatchRowNumber": 65,
                "afterPatchRowNumber": 89,
                "PatchRowcode": "         # Then a status is returned"
            },
            "62": {
                "beforePatchRowNumber": 66,
                "afterPatchRowNumber": 90,
                "PatchRowcode": "         self.assertStatus(expected_status)"
            },
            "63": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 91,
                "PatchRowcode": "+        if expected_redirect:"
            },
            "64": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 92,
                "PatchRowcode": "+            self.assertHeaderItemValue('Location', self.baseurl + expected_redirect)"
            },
            "65": {
                "beforePatchRowNumber": 67,
                "afterPatchRowNumber": 93,
                "PatchRowcode": "         # Check filesystem"
            },
            "66": {
                "beforePatchRowNumber": 68,
                "afterPatchRowNumber": 94,
                "PatchRowcode": "         sleep(1)"
            },
            "67": {
                "beforePatchRowNumber": 69,
                "afterPatchRowNumber": 95,
                "PatchRowcode": "         self.getPage(\"/history/\" + username + \"/\" + path)"
            },
            "68": {
                "beforePatchRowNumber": 78,
                "afterPatchRowNumber": 104,
                "PatchRowcode": "         # Delete repo"
            },
            "69": {
                "beforePatchRowNumber": 79,
                "afterPatchRowNumber": 105,
                "PatchRowcode": "         self._delete(self.USERNAME, self.REPO, 'testcases')"
            },
            "70": {
                "beforePatchRowNumber": 80,
                "afterPatchRowNumber": 106,
                "PatchRowcode": "         self.assertStatus(303)"
            },
            "71": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 107,
                "PatchRowcode": "+        self.assertHeaderItemValue('Location', self.baseurl + '/')"
            },
            "72": {
                "beforePatchRowNumber": 81,
                "afterPatchRowNumber": 108,
                "PatchRowcode": "         # Check filesystem"
            },
            "73": {
                "beforePatchRowNumber": 82,
                "afterPatchRowNumber": 109,
                "PatchRowcode": "         sleep(1)"
            },
            "74": {
                "beforePatchRowNumber": 83,
                "afterPatchRowNumber": 110,
                "PatchRowcode": "         self.assertEqual(['broker-repo'], [r.name for r in self.app.store.get_user('admin').repo_objs])"
            },
            "75": {
                "beforePatchRowNumber": 89,
                "afterPatchRowNumber": 116,
                "PatchRowcode": "         # Then delete it."
            },
            "76": {
                "beforePatchRowNumber": 90,
                "afterPatchRowNumber": 117,
                "PatchRowcode": "         self._delete(self.USERNAME, self.REPO, 'testcases')"
            },
            "77": {
                "beforePatchRowNumber": 91,
                "afterPatchRowNumber": 118,
                "PatchRowcode": "         self.assertStatus(303)"
            },
            "78": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 119,
                "PatchRowcode": "+        self.assertHeaderItemValue('Location', self.baseurl + '/')"
            },
            "79": {
                "beforePatchRowNumber": 92,
                "afterPatchRowNumber": 120,
                "PatchRowcode": "         # Check filesystem"
            },
            "80": {
                "beforePatchRowNumber": 93,
                "afterPatchRowNumber": 121,
                "PatchRowcode": "         sleep(1)"
            },
            "81": {
                "beforePatchRowNumber": 94,
                "afterPatchRowNumber": 122,
                "PatchRowcode": "         self.assertEqual(['broker-repo'], [r.name for r in self.app.store.get_user('admin').repo_objs])"
            },
            "82": {
                "beforePatchRowNumber": 125,
                "afterPatchRowNumber": 153,
                "PatchRowcode": "         user_obj.user_root = self.testcases"
            },
            "83": {
                "beforePatchRowNumber": 126,
                "afterPatchRowNumber": 154,
                "PatchRowcode": "         self.assertEqual(['broker-repo', 'testcases'], [r.name for r in user_obj.repo_objs])"
            },
            "84": {
                "beforePatchRowNumber": 127,
                "afterPatchRowNumber": 155,
                "PatchRowcode": " "
            },
            "85": {
                "beforePatchRowNumber": 128,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self._delete('anotheruser', 'testcases', 'testcases', redirect='/admin/repos/')"
            },
            "86": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 156,
                "PatchRowcode": "+        self._delete('anotheruser', 'testcases', 'testcases')"
            },
            "87": {
                "beforePatchRowNumber": 129,
                "afterPatchRowNumber": 157,
                "PatchRowcode": "         self.assertStatus(303)"
            },
            "88": {
                "beforePatchRowNumber": 130,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        location = self.assertHeader('Location')"
            },
            "89": {
                "beforePatchRowNumber": 131,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertTrue(location.endswith('/admin/repos/'))"
            },
            "90": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 158,
                "PatchRowcode": "+        self.assertHeaderItemValue('Location', self.baseurl + '/')"
            },
            "91": {
                "beforePatchRowNumber": 132,
                "afterPatchRowNumber": 159,
                "PatchRowcode": " "
            },
            "92": {
                "beforePatchRowNumber": 133,
                "afterPatchRowNumber": 160,
                "PatchRowcode": "         # Check filesystem"
            },
            "93": {
                "beforePatchRowNumber": 134,
                "afterPatchRowNumber": 161,
                "PatchRowcode": "         sleep(1)"
            },
            "94": {
                "beforePatchRowNumber": 147,
                "afterPatchRowNumber": 174,
                "PatchRowcode": "         # Login as maintainer"
            },
            "95": {
                "beforePatchRowNumber": 148,
                "afterPatchRowNumber": 175,
                "PatchRowcode": "         self._login('maintainer', 'password')"
            },
            "96": {
                "beforePatchRowNumber": 149,
                "afterPatchRowNumber": 176,
                "PatchRowcode": " "
            },
            "97": {
                "beforePatchRowNumber": 150,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        # Try to delete own own repo"
            },
            "98": {
                "beforePatchRowNumber": 151,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self._delete('maintainer', 'testcases', 'testcases', redirect='/admin/repos/')"
            },
            "99": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 177,
                "PatchRowcode": "+        # Try to delete your own repo"
            },
            "100": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 178,
                "PatchRowcode": "+        self._delete('maintainer', 'testcases', 'testcases')"
            },
            "101": {
                "beforePatchRowNumber": 152,
                "afterPatchRowNumber": 179,
                "PatchRowcode": "         self.assertStatus(303)"
            },
            "102": {
                "beforePatchRowNumber": 153,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        location = self.assertHeader('Location')"
            },
            "103": {
                "beforePatchRowNumber": 154,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertTrue(location.endswith('/admin/repos/'))"
            },
            "104": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 180,
                "PatchRowcode": "+        self.assertHeaderItemValue('Location', self.baseurl + '/')"
            },
            "105": {
                "beforePatchRowNumber": 155,
                "afterPatchRowNumber": 181,
                "PatchRowcode": " "
            },
            "106": {
                "beforePatchRowNumber": 156,
                "afterPatchRowNumber": 182,
                "PatchRowcode": "         # Check filesystem"
            },
            "107": {
                "beforePatchRowNumber": 157,
                "afterPatchRowNumber": 183,
                "PatchRowcode": "         sleep(1)"
            },
            "108": {
                "beforePatchRowNumber": 169,
                "afterPatchRowNumber": 195,
                "PatchRowcode": "         self._login('user', 'password')"
            },
            "109": {
                "beforePatchRowNumber": 170,
                "afterPatchRowNumber": 196,
                "PatchRowcode": " "
            },
            "110": {
                "beforePatchRowNumber": 171,
                "afterPatchRowNumber": 197,
                "PatchRowcode": "         # Try to delete own own repo"
            },
            "111": {
                "beforePatchRowNumber": 172,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self._delete('user', 'testcases', 'testcases', redirect='/admin/repos/')"
            },
            "112": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 198,
                "PatchRowcode": "+        self._delete('user', 'testcases', 'testcases')"
            },
            "113": {
                "beforePatchRowNumber": 173,
                "afterPatchRowNumber": 199,
                "PatchRowcode": "         self.assertStatus(403)"
            },
            "114": {
                "beforePatchRowNumber": 174,
                "afterPatchRowNumber": 200,
                "PatchRowcode": " "
            },
            "115": {
                "beforePatchRowNumber": 175,
                "afterPatchRowNumber": 201,
                "PatchRowcode": "         # Check database don't change"
            },
            "116": {
                "beforePatchRowNumber": 183,
                "afterPatchRowNumber": 209,
                "PatchRowcode": "         self._delete(self.USERNAME, repo, repo)"
            },
            "117": {
                "beforePatchRowNumber": 184,
                "afterPatchRowNumber": 210,
                "PatchRowcode": "         # Then a 404 is return to the user"
            },
            "118": {
                "beforePatchRowNumber": 185,
                "afterPatchRowNumber": 211,
                "PatchRowcode": "         self.assertStatus(404)"
            },
            "119": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 212,
                "PatchRowcode": "+"
            },
            "120": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 213,
                "PatchRowcode": "+    def test_delete_method_get(self):"
            },
            "121": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 214,
                "PatchRowcode": "+        # Given a user with repo"
            },
            "122": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 215,
                "PatchRowcode": "+        self.assertEqual(['broker-repo', 'testcases'], [r.name for r in self.app.store.get_user('admin').repo_objs])"
            },
            "123": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 216,
                "PatchRowcode": "+        # When trying to deleted repo with GET method"
            },
            "124": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 217,
                "PatchRowcode": "+        self.getPage(\"/delete/\" + self.USERNAME + \"/\" + self.REPO + \"/?confirm=\" + self.REPO, method=\"GET\")"
            },
            "125": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 218,
                "PatchRowcode": "+        # Then An error is returned"
            },
            "126": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 219,
                "PatchRowcode": "+        self.assertStatus(405)"
            },
            "127": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 220,
                "PatchRowcode": "+        # Then repo still exists"
            },
            "128": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 221,
                "PatchRowcode": "+        self.assertEqual(['broker-repo', 'testcases'], [r.name for r in self.app.store.get_user('admin').repo_objs])"
            }
        },
        "frontPatchFile": [
            "# -*- coding: utf-8 -*-",
            "# rdiffweb, A web interface to rdiff-backup repositories",
            "# Copyright (C) 2012-2021 rdiffweb contributors",
            "#",
            "# This program is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This program is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with this program.  If not, see <http://www.gnu.org/licenses/>.",
            "\"\"\"",
            "Created on Apr 10, 2016",
            "",
            "@author: Patrik Dufresne <patrik@ikus-soft.com>",
            "\"\"\"",
            "",
            "import os",
            "from time import sleep",
            "from unittest.case import skipIf",
            "",
            "from parameterized import parameterized",
            "",
            "import rdiffweb.test",
            "from rdiffweb.core.librdiff import rdiff_backup_version",
            "from rdiffweb.core.store import MAINTAINER_ROLE, USER_ROLE",
            "",
            "RDIFF_BACKUP_VERSION = rdiff_backup_version()",
            "",
            "",
            "class DeleteRepoTest(rdiffweb.test.WebCase):",
            "",
            "    login = True",
            "",
            "    def _delete(self, user, repo, confirm, redirect=None):",
            "        body = {}",
            "        if confirm is not None:",
            "            body.update({'confirm': confirm})",
            "        if redirect is not None:",
            "            body['redirect'] = redirect",
            "        self.getPage(\"/delete/\" + user + \"/\" + repo + \"/\", method=\"POST\", body=body)",
            "",
            "    @skipIf(RDIFF_BACKUP_VERSION < (2, 0, 1), \"rdiff-backup-delete is available since 2.0.1\")",
            "    @parameterized.expand(",
            "        [",
            "            (\"with_dir\", 'admin', '/testcases/Revisions', 'Revisions', 303, 404),",
            "            (\"with_dir_wrong_confirmation\", 'admin', '/testcases/Revisions', 'invalid', 400, 200),",
            "            (\"with_file\", 'admin', '/testcases/Revisions/Data', 'Data', 303, 404),",
            "            (\"with_file_wrong_confirmation\", 'admin', '/testcases/Revisions/Data', 'invalid', 400, 200),",
            "            (\"with_invalid\", 'admin', '/testcases/invalid', 'invalid', 404, 404),",
            "            (\"with_broken_symlink\", 'admin', '/testcases/BrokenSymlink', 'BrokenSymlink', 303, 404),",
            "            (\"with_utf8\", 'admin', '/testcases/R%C3%A9pertoire%20Existant', 'R\u00e9pertoire Existant', 303, 404),",
            "            (\"with_rdiff_backup_data\", 'admin', '/testcases/rdiff-backup-data', 'rdiff-backup-data', 404, 404),",
            "            (\"with_quoted_path\", 'admin', '/testcases/Char%20%3B090%20to%20quote', 'Char Z to quote', 303, 404),",
            "        ]",
            "    )",
            "    def test_delete_path(self, unused, username, path, confirmation, expected_status, expected_history_status):",
            "        # When trying to delete a file or a folder with a confirmation",
            "        self._delete(username, path, confirmation)",
            "        # Then a status is returned",
            "        self.assertStatus(expected_status)",
            "        # Check filesystem",
            "        sleep(1)",
            "        self.getPage(\"/history/\" + username + \"/\" + path)",
            "        self.assertStatus(expected_history_status)",
            "",
            "    def test_delete_repo(self):",
            "        \"\"\"",
            "        Check to delete a repo.",
            "        \"\"\"",
            "        # Check initial list of repo",
            "        self.assertEqual(['broker-repo', 'testcases'], [r.name for r in self.app.store.get_user('admin').repo_objs])",
            "        # Delete repo",
            "        self._delete(self.USERNAME, self.REPO, 'testcases')",
            "        self.assertStatus(303)",
            "        # Check filesystem",
            "        sleep(1)",
            "        self.assertEqual(['broker-repo'], [r.name for r in self.app.store.get_user('admin').repo_objs])",
            "        self.assertFalse(os.path.isdir(os.path.join(self.testcases, 'testcases')))",
            "",
            "    def test_delete_repo_with_slash(self):",
            "        # Check initial list of repo",
            "        self.assertEqual(['broker-repo', 'testcases'], [r.name for r in self.app.store.get_user('admin').repo_objs])",
            "        # Then delete it.",
            "        self._delete(self.USERNAME, self.REPO, 'testcases')",
            "        self.assertStatus(303)",
            "        # Check filesystem",
            "        sleep(1)",
            "        self.assertEqual(['broker-repo'], [r.name for r in self.app.store.get_user('admin').repo_objs])",
            "        self.assertFalse(os.path.isdir(os.path.join(self.testcases, 'testcases')))",
            "",
            "    def test_delete_repo_wrong_confirm(self):",
            "        \"\"\"",
            "        Check failure to delete a repo with wrong confirmation.",
            "        \"\"\"",
            "        # Check initial list of repo",
            "        self.assertEqual(['broker-repo', 'testcases'], [r.name for r in self.app.store.get_user('admin').repo_objs])",
            "        # Delete repo with wrong confirmation.",
            "        self._delete(self.USERNAME, self.REPO, 'wrong')",
            "        # TODO Make sure the repository is not delete",
            "        self.assertStatus(400)",
            "        self.assertEqual(['broker-repo', 'testcases'], [r.name for r in self.app.store.get_user('admin').repo_objs])",
            "",
            "    def test_delete_repo_without_confirm(self):",
            "        \"\"\"",
            "        Check failure to delete a repo with wrong confirmation.",
            "        \"\"\"",
            "        # Check initial list of repo",
            "        self.assertEqual(['broker-repo', 'testcases'], [r.name for r in self.app.store.get_user('admin').repo_objs])",
            "        # Delete repo without confirmation.",
            "        self._delete(self.USERNAME, self.REPO, None)",
            "        # Make sure the repository is not delete",
            "        self.assertStatus(400)",
            "        self.assertInBody('confirm: This field is required')",
            "        self.assertEqual(['broker-repo', 'testcases'], [r.name for r in self.app.store.get_user('admin').repo_objs])",
            "",
            "    def test_delete_repo_as_admin(self):",
            "        # Create a another user with admin right",
            "        user_obj = self.app.store.add_user('anotheruser', 'password')",
            "        user_obj.user_root = self.testcases",
            "        self.assertEqual(['broker-repo', 'testcases'], [r.name for r in user_obj.repo_objs])",
            "",
            "        self._delete('anotheruser', 'testcases', 'testcases', redirect='/admin/repos/')",
            "        self.assertStatus(303)",
            "        location = self.assertHeader('Location')",
            "        self.assertTrue(location.endswith('/admin/repos/'))",
            "",
            "        # Check filesystem",
            "        sleep(1)",
            "        self.assertEqual(['broker-repo'], [r.name for r in user_obj.repo_objs])",
            "        self.assertFalse(os.path.isdir(os.path.join(self.testcases, 'testcases')))",
            "",
            "    def test_delete_repo_as_maintainer(self):",
            "        self.assertTrue(os.path.isdir(self.testcases))",
            "",
            "        # Create a another user with maintainer right",
            "        user_obj = self.app.store.add_user('maintainer', 'password')",
            "        user_obj.user_root = self.testcases",
            "        user_obj.role = MAINTAINER_ROLE",
            "        self.assertEqual(['broker-repo', 'testcases'], [r.name for r in user_obj.repo_objs])",
            "",
            "        # Login as maintainer",
            "        self._login('maintainer', 'password')",
            "",
            "        # Try to delete own own repo",
            "        self._delete('maintainer', 'testcases', 'testcases', redirect='/admin/repos/')",
            "        self.assertStatus(303)",
            "        location = self.assertHeader('Location')",
            "        self.assertTrue(location.endswith('/admin/repos/'))",
            "",
            "        # Check filesystem",
            "        sleep(1)",
            "        self.assertEqual(['broker-repo'], [r.name for r in user_obj.repo_objs])",
            "        self.assertFalse(os.path.isdir(os.path.join(self.testcases, 'testcases')))",
            "",
            "    def test_delete_repo_as_user(self):",
            "        # Create a another user with maintainer right",
            "        user_obj = self.app.store.add_user('user', 'password')",
            "        user_obj.user_root = self.testcases",
            "        user_obj.role = USER_ROLE",
            "        self.assertEqual(['broker-repo', 'testcases'], [r.name for r in user_obj.repo_objs])",
            "",
            "        # Login as maintainer",
            "        self._login('user', 'password')",
            "",
            "        # Try to delete own own repo",
            "        self._delete('user', 'testcases', 'testcases', redirect='/admin/repos/')",
            "        self.assertStatus(403)",
            "",
            "        # Check database don't change",
            "        self.assertEqual(['broker-repo', 'testcases'], [r.name for r in user_obj.repo_objs])",
            "        self.assertTrue(os.path.isdir(os.path.join(self.testcases, 'testcases')))",
            "",
            "    def test_delete_repo_does_not_exists(self):",
            "        # Given an invalid repo",
            "        repo = 'invalid'",
            "        # When trying to delete this repo",
            "        self._delete(self.USERNAME, repo, repo)",
            "        # Then a 404 is return to the user",
            "        self.assertStatus(404)"
        ],
        "afterPatchFile": [
            "# -*- coding: utf-8 -*-",
            "# rdiffweb, A web interface to rdiff-backup repositories",
            "# Copyright (C) 2012-2021 rdiffweb contributors",
            "#",
            "# This program is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This program is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with this program.  If not, see <http://www.gnu.org/licenses/>.",
            "\"\"\"",
            "Created on Apr 10, 2016",
            "",
            "@author: Patrik Dufresne <patrik@ikus-soft.com>",
            "\"\"\"",
            "",
            "import os",
            "from time import sleep",
            "from unittest.case import skipIf",
            "",
            "from parameterized import parameterized",
            "",
            "import rdiffweb.test",
            "from rdiffweb.core.librdiff import rdiff_backup_version",
            "from rdiffweb.core.store import MAINTAINER_ROLE, USER_ROLE",
            "",
            "RDIFF_BACKUP_VERSION = rdiff_backup_version()",
            "",
            "",
            "class DeleteRepoTest(rdiffweb.test.WebCase):",
            "",
            "    login = True",
            "",
            "    def _delete(self, user, repo, confirm):",
            "        body = {}",
            "        if confirm is not None:",
            "            body.update({'confirm': confirm})",
            "        self.getPage(\"/delete/\" + user + \"/\" + repo + \"/\", method=\"POST\", body=body)",
            "",
            "    @skipIf(RDIFF_BACKUP_VERSION < (2, 0, 1), \"rdiff-backup-delete is available since 2.0.1\")",
            "    @parameterized.expand(",
            "        [",
            "            (\"with_dir\", 'admin', '/testcases/Revisions', 'Revisions', 303, 404, '/browse/admin/testcases'),",
            "            (\"with_dir_wrong_confirmation\", 'admin', '/testcases/Revisions', 'invalid', 400, 200),",
            "            (\"with_file\", 'admin', '/testcases/Revisions/Data', 'Data', 303, 404, '/browse/admin/testcases/Revisions'),",
            "            (\"with_file_wrong_confirmation\", 'admin', '/testcases/Revisions/Data', 'invalid', 400, 200),",
            "            (\"with_invalid\", 'admin', '/testcases/invalid', 'invalid', 404, 404),",
            "            (",
            "                \"with_broken_symlink\",",
            "                'admin',",
            "                '/testcases/BrokenSymlink',",
            "                'BrokenSymlink',",
            "                303,",
            "                404,",
            "                '/browse/admin/testcases',",
            "            ),",
            "            (",
            "                \"with_utf8\",",
            "                'admin',",
            "                '/testcases/R%C3%A9pertoire%20Existant',",
            "                'R\u00e9pertoire Existant',",
            "                303,",
            "                404,",
            "                '/browse/admin/testcases',",
            "            ),",
            "            (\"with_rdiff_backup_data\", 'admin', '/testcases/rdiff-backup-data', 'rdiff-backup-data', 404, 404),",
            "            (",
            "                \"with_quoted_path\",",
            "                'admin',",
            "                '/testcases/Char%20%3B090%20to%20quote',",
            "                'Char Z to quote',",
            "                303,",
            "                404,",
            "                '/browse/admin/testcases',",
            "            ),",
            "        ]",
            "    )",
            "    def test_delete_path(",
            "        self, unused, username, path, confirmation, expected_status, expected_history_status, expected_redirect=None",
            "    ):",
            "        # When trying to delete a file or a folder with a confirmation",
            "        self._delete(username, path, confirmation)",
            "        # Then a status is returned",
            "        self.assertStatus(expected_status)",
            "        if expected_redirect:",
            "            self.assertHeaderItemValue('Location', self.baseurl + expected_redirect)",
            "        # Check filesystem",
            "        sleep(1)",
            "        self.getPage(\"/history/\" + username + \"/\" + path)",
            "        self.assertStatus(expected_history_status)",
            "",
            "    def test_delete_repo(self):",
            "        \"\"\"",
            "        Check to delete a repo.",
            "        \"\"\"",
            "        # Check initial list of repo",
            "        self.assertEqual(['broker-repo', 'testcases'], [r.name for r in self.app.store.get_user('admin').repo_objs])",
            "        # Delete repo",
            "        self._delete(self.USERNAME, self.REPO, 'testcases')",
            "        self.assertStatus(303)",
            "        self.assertHeaderItemValue('Location', self.baseurl + '/')",
            "        # Check filesystem",
            "        sleep(1)",
            "        self.assertEqual(['broker-repo'], [r.name for r in self.app.store.get_user('admin').repo_objs])",
            "        self.assertFalse(os.path.isdir(os.path.join(self.testcases, 'testcases')))",
            "",
            "    def test_delete_repo_with_slash(self):",
            "        # Check initial list of repo",
            "        self.assertEqual(['broker-repo', 'testcases'], [r.name for r in self.app.store.get_user('admin').repo_objs])",
            "        # Then delete it.",
            "        self._delete(self.USERNAME, self.REPO, 'testcases')",
            "        self.assertStatus(303)",
            "        self.assertHeaderItemValue('Location', self.baseurl + '/')",
            "        # Check filesystem",
            "        sleep(1)",
            "        self.assertEqual(['broker-repo'], [r.name for r in self.app.store.get_user('admin').repo_objs])",
            "        self.assertFalse(os.path.isdir(os.path.join(self.testcases, 'testcases')))",
            "",
            "    def test_delete_repo_wrong_confirm(self):",
            "        \"\"\"",
            "        Check failure to delete a repo with wrong confirmation.",
            "        \"\"\"",
            "        # Check initial list of repo",
            "        self.assertEqual(['broker-repo', 'testcases'], [r.name for r in self.app.store.get_user('admin').repo_objs])",
            "        # Delete repo with wrong confirmation.",
            "        self._delete(self.USERNAME, self.REPO, 'wrong')",
            "        # TODO Make sure the repository is not delete",
            "        self.assertStatus(400)",
            "        self.assertEqual(['broker-repo', 'testcases'], [r.name for r in self.app.store.get_user('admin').repo_objs])",
            "",
            "    def test_delete_repo_without_confirm(self):",
            "        \"\"\"",
            "        Check failure to delete a repo with wrong confirmation.",
            "        \"\"\"",
            "        # Check initial list of repo",
            "        self.assertEqual(['broker-repo', 'testcases'], [r.name for r in self.app.store.get_user('admin').repo_objs])",
            "        # Delete repo without confirmation.",
            "        self._delete(self.USERNAME, self.REPO, None)",
            "        # Make sure the repository is not delete",
            "        self.assertStatus(400)",
            "        self.assertInBody('confirm: This field is required')",
            "        self.assertEqual(['broker-repo', 'testcases'], [r.name for r in self.app.store.get_user('admin').repo_objs])",
            "",
            "    def test_delete_repo_as_admin(self):",
            "        # Create a another user with admin right",
            "        user_obj = self.app.store.add_user('anotheruser', 'password')",
            "        user_obj.user_root = self.testcases",
            "        self.assertEqual(['broker-repo', 'testcases'], [r.name for r in user_obj.repo_objs])",
            "",
            "        self._delete('anotheruser', 'testcases', 'testcases')",
            "        self.assertStatus(303)",
            "        self.assertHeaderItemValue('Location', self.baseurl + '/')",
            "",
            "        # Check filesystem",
            "        sleep(1)",
            "        self.assertEqual(['broker-repo'], [r.name for r in user_obj.repo_objs])",
            "        self.assertFalse(os.path.isdir(os.path.join(self.testcases, 'testcases')))",
            "",
            "    def test_delete_repo_as_maintainer(self):",
            "        self.assertTrue(os.path.isdir(self.testcases))",
            "",
            "        # Create a another user with maintainer right",
            "        user_obj = self.app.store.add_user('maintainer', 'password')",
            "        user_obj.user_root = self.testcases",
            "        user_obj.role = MAINTAINER_ROLE",
            "        self.assertEqual(['broker-repo', 'testcases'], [r.name for r in user_obj.repo_objs])",
            "",
            "        # Login as maintainer",
            "        self._login('maintainer', 'password')",
            "",
            "        # Try to delete your own repo",
            "        self._delete('maintainer', 'testcases', 'testcases')",
            "        self.assertStatus(303)",
            "        self.assertHeaderItemValue('Location', self.baseurl + '/')",
            "",
            "        # Check filesystem",
            "        sleep(1)",
            "        self.assertEqual(['broker-repo'], [r.name for r in user_obj.repo_objs])",
            "        self.assertFalse(os.path.isdir(os.path.join(self.testcases, 'testcases')))",
            "",
            "    def test_delete_repo_as_user(self):",
            "        # Create a another user with maintainer right",
            "        user_obj = self.app.store.add_user('user', 'password')",
            "        user_obj.user_root = self.testcases",
            "        user_obj.role = USER_ROLE",
            "        self.assertEqual(['broker-repo', 'testcases'], [r.name for r in user_obj.repo_objs])",
            "",
            "        # Login as maintainer",
            "        self._login('user', 'password')",
            "",
            "        # Try to delete own own repo",
            "        self._delete('user', 'testcases', 'testcases')",
            "        self.assertStatus(403)",
            "",
            "        # Check database don't change",
            "        self.assertEqual(['broker-repo', 'testcases'], [r.name for r in user_obj.repo_objs])",
            "        self.assertTrue(os.path.isdir(os.path.join(self.testcases, 'testcases')))",
            "",
            "    def test_delete_repo_does_not_exists(self):",
            "        # Given an invalid repo",
            "        repo = 'invalid'",
            "        # When trying to delete this repo",
            "        self._delete(self.USERNAME, repo, repo)",
            "        # Then a 404 is return to the user",
            "        self.assertStatus(404)",
            "",
            "    def test_delete_method_get(self):",
            "        # Given a user with repo",
            "        self.assertEqual(['broker-repo', 'testcases'], [r.name for r in self.app.store.get_user('admin').repo_objs])",
            "        # When trying to deleted repo with GET method",
            "        self.getPage(\"/delete/\" + self.USERNAME + \"/\" + self.REPO + \"/?confirm=\" + self.REPO, method=\"GET\")",
            "        # Then An error is returned",
            "        self.assertStatus(405)",
            "        # Then repo still exists",
            "        self.assertEqual(['broker-repo', 'testcases'], [r.name for r in self.app.store.get_user('admin').repo_objs])"
        ],
        "action": [
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "2",
            "2",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "0",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2"
        ],
        "dele_reviseLocation": {
            "40": [
                "DeleteRepoTest",
                "_delete"
            ],
            "44": [
                "DeleteRepoTest",
                "_delete"
            ],
            "45": [
                "DeleteRepoTest",
                "_delete"
            ],
            "51": [
                "DeleteRepoTest"
            ],
            "53": [
                "DeleteRepoTest"
            ],
            "56": [
                "DeleteRepoTest"
            ],
            "57": [
                "DeleteRepoTest"
            ],
            "59": [
                "DeleteRepoTest"
            ],
            "62": [
                "DeleteRepoTest",
                "test_delete_path"
            ],
            "128": [
                "DeleteRepoTest",
                "test_delete_repo_as_admin"
            ],
            "130": [
                "DeleteRepoTest",
                "test_delete_repo_as_admin"
            ],
            "131": [
                "DeleteRepoTest",
                "test_delete_repo_as_admin"
            ],
            "150": [
                "DeleteRepoTest",
                "test_delete_repo_as_maintainer"
            ],
            "151": [
                "DeleteRepoTest",
                "test_delete_repo_as_maintainer"
            ],
            "153": [
                "DeleteRepoTest",
                "test_delete_repo_as_maintainer"
            ],
            "154": [
                "DeleteRepoTest",
                "test_delete_repo_as_maintainer"
            ],
            "172": [
                "DeleteRepoTest",
                "test_delete_repo_as_user"
            ]
        },
        "addLocation": []
    }
}