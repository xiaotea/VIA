{
    "radicale/pathutils.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 20,
                "afterPatchRowNumber": 20,
                "PatchRowcode": " "
            },
            "1": {
                "beforePatchRowNumber": 21,
                "afterPatchRowNumber": 21,
                "PatchRowcode": " \"\"\""
            },
            "2": {
                "beforePatchRowNumber": 22,
                "afterPatchRowNumber": 22,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 23,
                "PatchRowcode": "+import os"
            },
            "4": {
                "beforePatchRowNumber": 23,
                "afterPatchRowNumber": 24,
                "PatchRowcode": " import posixpath"
            },
            "5": {
                "beforePatchRowNumber": 24,
                "afterPatchRowNumber": 25,
                "PatchRowcode": " "
            },
            "6": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 26,
                "PatchRowcode": "+from . import log"
            },
            "7": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 27,
                "PatchRowcode": "+"
            },
            "8": {
                "beforePatchRowNumber": 25,
                "afterPatchRowNumber": 28,
                "PatchRowcode": " "
            },
            "9": {
                "beforePatchRowNumber": 26,
                "afterPatchRowNumber": 29,
                "PatchRowcode": " def sanitize_path(path):"
            },
            "10": {
                "beforePatchRowNumber": 27,
                "afterPatchRowNumber": 30,
                "PatchRowcode": "     \"\"\"Make absolute (with leading slash) to prevent access to other data."
            },
            "11": {
                "beforePatchRowNumber": 34,
                "afterPatchRowNumber": 37,
                "PatchRowcode": "             continue"
            },
            "12": {
                "beforePatchRowNumber": 35,
                "afterPatchRowNumber": 38,
                "PatchRowcode": "         new_path = posixpath.join(new_path, part)"
            },
            "13": {
                "beforePatchRowNumber": 36,
                "afterPatchRowNumber": 39,
                "PatchRowcode": "     trailing_slash = \"\" if new_path.endswith(\"/\") else trailing_slash"
            },
            "14": {
                "beforePatchRowNumber": 37,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    return new_path + trailing_slash"
            },
            "15": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 40,
                "PatchRowcode": "+    return new_path + trailing_slash"
            },
            "16": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 41,
                "PatchRowcode": "+"
            },
            "17": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 42,
                "PatchRowcode": "+"
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 43,
                "PatchRowcode": "+def is_safe_filesystem_path_component(path):"
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 44,
                "PatchRowcode": "+    \"\"\"Checks if path is a single component of a local filesystem path"
            },
            "20": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 45,
                "PatchRowcode": "+       and is safe to join\"\"\""
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 46,
                "PatchRowcode": "+    if not path:"
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 47,
                "PatchRowcode": "+        return False"
            },
            "23": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 48,
                "PatchRowcode": "+    drive, _ = os.path.splitdrive(path)"
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 49,
                "PatchRowcode": "+    if drive:"
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 50,
                "PatchRowcode": "+        return False"
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 51,
                "PatchRowcode": "+    head, _ = os.path.split(path)"
            },
            "27": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 52,
                "PatchRowcode": "+    if head:"
            },
            "28": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 53,
                "PatchRowcode": "+        return False"
            },
            "29": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 54,
                "PatchRowcode": "+    if path in (os.curdir, os.pardir):"
            },
            "30": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 55,
                "PatchRowcode": "+        return False"
            },
            "31": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 56,
                "PatchRowcode": "+    return True"
            },
            "32": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 57,
                "PatchRowcode": "+"
            },
            "33": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 58,
                "PatchRowcode": "+"
            },
            "34": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 59,
                "PatchRowcode": "+def path_to_filesystem(path, base_folder):"
            },
            "35": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 60,
                "PatchRowcode": "+    \"\"\"Converts path to a local filesystem path relative to base_folder"
            },
            "36": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 61,
                "PatchRowcode": "+        in a secure manner or raises ValueError.\"\"\""
            },
            "37": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 62,
                "PatchRowcode": "+    sane_path = sanitize_path(path).strip(\"/\")"
            },
            "38": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 63,
                "PatchRowcode": "+    safe_path = base_folder"
            },
            "39": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 64,
                "PatchRowcode": "+    if not sane_path:"
            },
            "40": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 65,
                "PatchRowcode": "+        return safe_path"
            },
            "41": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 66,
                "PatchRowcode": "+    for part in sane_path.split(\"/\"):"
            },
            "42": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 67,
                "PatchRowcode": "+        if not is_safe_filesystem_path_component(part):"
            },
            "43": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 68,
                "PatchRowcode": "+            log.LOGGER.debug(\"Can't translate path safely to filesystem: %s\","
            },
            "44": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 69,
                "PatchRowcode": "+                             path)"
            },
            "45": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 70,
                "PatchRowcode": "+            raise ValueError(\"Unsafe path\")"
            },
            "46": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 71,
                "PatchRowcode": "+        safe_path = os.path.join(safe_path, part)"
            },
            "47": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 72,
                "PatchRowcode": "+    return safe_path"
            }
        },
        "frontPatchFile": [
            "# -*- coding: utf-8 -*-",
            "#",
            "# This file is part of Radicale Server - Calendar Server",
            "#",
            "# This library is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This library is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with Radicale.  If not, see <http://www.gnu.org/licenses/>.",
            "",
            "\"\"\"",
            "Helper functions for working with paths",
            "",
            "\"\"\"",
            "",
            "import posixpath",
            "",
            "",
            "def sanitize_path(path):",
            "    \"\"\"Make absolute (with leading slash) to prevent access to other data.",
            "       Preserves an potential trailing slash.\"\"\"",
            "    trailing_slash = \"/\" if path.endswith(\"/\") else \"\"",
            "    path = posixpath.normpath(path)",
            "    new_path = \"/\"",
            "    for part in path.split(\"/\"):",
            "        if not part or part in (\".\", \"..\"):",
            "            continue",
            "        new_path = posixpath.join(new_path, part)",
            "    trailing_slash = \"\" if new_path.endswith(\"/\") else trailing_slash",
            "    return new_path + trailing_slash"
        ],
        "afterPatchFile": [
            "# -*- coding: utf-8 -*-",
            "#",
            "# This file is part of Radicale Server - Calendar Server",
            "#",
            "# This library is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This library is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with Radicale.  If not, see <http://www.gnu.org/licenses/>.",
            "",
            "\"\"\"",
            "Helper functions for working with paths",
            "",
            "\"\"\"",
            "",
            "import os",
            "import posixpath",
            "",
            "from . import log",
            "",
            "",
            "def sanitize_path(path):",
            "    \"\"\"Make absolute (with leading slash) to prevent access to other data.",
            "       Preserves an potential trailing slash.\"\"\"",
            "    trailing_slash = \"/\" if path.endswith(\"/\") else \"\"",
            "    path = posixpath.normpath(path)",
            "    new_path = \"/\"",
            "    for part in path.split(\"/\"):",
            "        if not part or part in (\".\", \"..\"):",
            "            continue",
            "        new_path = posixpath.join(new_path, part)",
            "    trailing_slash = \"\" if new_path.endswith(\"/\") else trailing_slash",
            "    return new_path + trailing_slash",
            "",
            "",
            "def is_safe_filesystem_path_component(path):",
            "    \"\"\"Checks if path is a single component of a local filesystem path",
            "       and is safe to join\"\"\"",
            "    if not path:",
            "        return False",
            "    drive, _ = os.path.splitdrive(path)",
            "    if drive:",
            "        return False",
            "    head, _ = os.path.split(path)",
            "    if head:",
            "        return False",
            "    if path in (os.curdir, os.pardir):",
            "        return False",
            "    return True",
            "",
            "",
            "def path_to_filesystem(path, base_folder):",
            "    \"\"\"Converts path to a local filesystem path relative to base_folder",
            "        in a secure manner or raises ValueError.\"\"\"",
            "    sane_path = sanitize_path(path).strip(\"/\")",
            "    safe_path = base_folder",
            "    if not sane_path:",
            "        return safe_path",
            "    for part in sane_path.split(\"/\"):",
            "        if not is_safe_filesystem_path_component(part):",
            "            log.LOGGER.debug(\"Can't translate path safely to filesystem: %s\",",
            "                             path)",
            "            raise ValueError(\"Unsafe path\")",
            "        safe_path = os.path.join(safe_path, part)",
            "    return safe_path"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "-1",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2"
        ],
        "dele_reviseLocation": {
            "37": [
                "sanitize_path"
            ]
        },
        "addLocation": []
    },
    "radicale/storage/filesystem.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 28,
                "afterPatchRowNumber": 28,
                "PatchRowcode": " import time"
            },
            "1": {
                "beforePatchRowNumber": 29,
                "afterPatchRowNumber": 29,
                "PatchRowcode": " import sys"
            },
            "2": {
                "beforePatchRowNumber": 30,
                "afterPatchRowNumber": 30,
                "PatchRowcode": " from contextlib import contextmanager"
            },
            "3": {
                "beforePatchRowNumber": 31,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-from .. import config, ical"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 31,
                "PatchRowcode": "+"
            },
            "5": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 32,
                "PatchRowcode": "+from .. import config, ical, pathutils"
            },
            "6": {
                "beforePatchRowNumber": 32,
                "afterPatchRowNumber": 33,
                "PatchRowcode": " "
            },
            "7": {
                "beforePatchRowNumber": 33,
                "afterPatchRowNumber": 34,
                "PatchRowcode": " "
            },
            "8": {
                "beforePatchRowNumber": 34,
                "afterPatchRowNumber": 35,
                "PatchRowcode": " FOLDER = os.path.expanduser(config.get(\"storage\", \"filesystem_folder\"))"
            },
            "9": {
                "beforePatchRowNumber": 63,
                "afterPatchRowNumber": 64,
                "PatchRowcode": " class Collection(ical.Collection):"
            },
            "10": {
                "beforePatchRowNumber": 64,
                "afterPatchRowNumber": 65,
                "PatchRowcode": "     \"\"\"Collection stored in a flat ical file.\"\"\""
            },
            "11": {
                "beforePatchRowNumber": 65,
                "afterPatchRowNumber": 66,
                "PatchRowcode": "     @property"
            },
            "12": {
                "beforePatchRowNumber": 66,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    def _path(self):"
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 67,
                "PatchRowcode": "+    def _filesystem_path(self):"
            },
            "14": {
                "beforePatchRowNumber": 67,
                "afterPatchRowNumber": 68,
                "PatchRowcode": "         \"\"\"Absolute path of the file at local ``path``.\"\"\""
            },
            "15": {
                "beforePatchRowNumber": 68,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        return os.path.join(FOLDER, self.path.replace(\"/\", os.sep))"
            },
            "16": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 69,
                "PatchRowcode": "+        return pathutils.path_to_filesystem(self.path, FOLDER)"
            },
            "17": {
                "beforePatchRowNumber": 69,
                "afterPatchRowNumber": 70,
                "PatchRowcode": " "
            },
            "18": {
                "beforePatchRowNumber": 70,
                "afterPatchRowNumber": 71,
                "PatchRowcode": "     @property"
            },
            "19": {
                "beforePatchRowNumber": 71,
                "afterPatchRowNumber": 72,
                "PatchRowcode": "     def _props_path(self):"
            },
            "20": {
                "beforePatchRowNumber": 72,
                "afterPatchRowNumber": 73,
                "PatchRowcode": "         \"\"\"Absolute path of the file storing the collection properties.\"\"\""
            },
            "21": {
                "beforePatchRowNumber": 73,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        return self._path + \".props\""
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 74,
                "PatchRowcode": "+        return self._filesystem_path + \".props\""
            },
            "23": {
                "beforePatchRowNumber": 74,
                "afterPatchRowNumber": 75,
                "PatchRowcode": " "
            },
            "24": {
                "beforePatchRowNumber": 75,
                "afterPatchRowNumber": 76,
                "PatchRowcode": "     def _create_dirs(self):"
            },
            "25": {
                "beforePatchRowNumber": 76,
                "afterPatchRowNumber": 77,
                "PatchRowcode": "         \"\"\"Create folder storing the collection if absent.\"\"\""
            },
            "26": {
                "beforePatchRowNumber": 77,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        if not os.path.exists(os.path.dirname(self._path)):"
            },
            "27": {
                "beforePatchRowNumber": 78,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            os.makedirs(os.path.dirname(self._path))"
            },
            "28": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 78,
                "PatchRowcode": "+        if not os.path.exists(os.path.dirname(self._filesystem_path)):"
            },
            "29": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 79,
                "PatchRowcode": "+            os.makedirs(os.path.dirname(self._filesystem_path))"
            },
            "30": {
                "beforePatchRowNumber": 79,
                "afterPatchRowNumber": 80,
                "PatchRowcode": " "
            },
            "31": {
                "beforePatchRowNumber": 80,
                "afterPatchRowNumber": 81,
                "PatchRowcode": "     def save(self, text):"
            },
            "32": {
                "beforePatchRowNumber": 81,
                "afterPatchRowNumber": 82,
                "PatchRowcode": "         self._create_dirs()"
            },
            "33": {
                "beforePatchRowNumber": 82,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        with open(self._path, \"w\") as fd:"
            },
            "34": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 83,
                "PatchRowcode": "+        with open(self._filesystem_path, \"w\") as fd:"
            },
            "35": {
                "beforePatchRowNumber": 83,
                "afterPatchRowNumber": 84,
                "PatchRowcode": "             fd.write(text)"
            },
            "36": {
                "beforePatchRowNumber": 84,
                "afterPatchRowNumber": 85,
                "PatchRowcode": " "
            },
            "37": {
                "beforePatchRowNumber": 85,
                "afterPatchRowNumber": 86,
                "PatchRowcode": "     def delete(self):"
            },
            "38": {
                "beforePatchRowNumber": 86,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        os.remove(self._path)"
            },
            "39": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 87,
                "PatchRowcode": "+        os.remove(self._filesystem_path)"
            },
            "40": {
                "beforePatchRowNumber": 87,
                "afterPatchRowNumber": 88,
                "PatchRowcode": "         os.remove(self._props_path)"
            },
            "41": {
                "beforePatchRowNumber": 88,
                "afterPatchRowNumber": 89,
                "PatchRowcode": " "
            },
            "42": {
                "beforePatchRowNumber": 89,
                "afterPatchRowNumber": 90,
                "PatchRowcode": "     @property"
            },
            "43": {
                "beforePatchRowNumber": 90,
                "afterPatchRowNumber": 91,
                "PatchRowcode": "     def text(self):"
            },
            "44": {
                "beforePatchRowNumber": 91,
                "afterPatchRowNumber": 92,
                "PatchRowcode": "         try:"
            },
            "45": {
                "beforePatchRowNumber": 92,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            with open(self._path) as fd:"
            },
            "46": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 93,
                "PatchRowcode": "+            with open(self._filesystem_path) as fd:"
            },
            "47": {
                "beforePatchRowNumber": 93,
                "afterPatchRowNumber": 94,
                "PatchRowcode": "                 return fd.read()"
            },
            "48": {
                "beforePatchRowNumber": 94,
                "afterPatchRowNumber": 95,
                "PatchRowcode": "         except IOError:"
            },
            "49": {
                "beforePatchRowNumber": 95,
                "afterPatchRowNumber": 96,
                "PatchRowcode": "             return \"\""
            },
            "50": {
                "beforePatchRowNumber": 96,
                "afterPatchRowNumber": 97,
                "PatchRowcode": " "
            },
            "51": {
                "beforePatchRowNumber": 97,
                "afterPatchRowNumber": 98,
                "PatchRowcode": "     @classmethod"
            },
            "52": {
                "beforePatchRowNumber": 98,
                "afterPatchRowNumber": 99,
                "PatchRowcode": "     def children(cls, path):"
            },
            "53": {
                "beforePatchRowNumber": 99,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        abs_path = os.path.join(FOLDER, path.replace(\"/\", os.sep))"
            },
            "54": {
                "beforePatchRowNumber": 100,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        _, directories, files = next(os.walk(abs_path))"
            },
            "55": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 100,
                "PatchRowcode": "+        filesystem_path = pathutils.path_to_filesystem(path, FOLDER)"
            },
            "56": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 101,
                "PatchRowcode": "+        _, directories, files = next(os.walk(filesystem_path))"
            },
            "57": {
                "beforePatchRowNumber": 101,
                "afterPatchRowNumber": 102,
                "PatchRowcode": "         for filename in directories + files:"
            },
            "58": {
                "beforePatchRowNumber": 102,
                "afterPatchRowNumber": 103,
                "PatchRowcode": "             rel_filename = posixpath.join(path, filename)"
            },
            "59": {
                "beforePatchRowNumber": 103,
                "afterPatchRowNumber": 104,
                "PatchRowcode": "             if cls.is_node(rel_filename) or cls.is_leaf(rel_filename):"
            },
            "60": {
                "beforePatchRowNumber": 104,
                "afterPatchRowNumber": 105,
                "PatchRowcode": "                 yield cls(rel_filename)"
            },
            "61": {
                "beforePatchRowNumber": 105,
                "afterPatchRowNumber": 106,
                "PatchRowcode": " "
            },
            "62": {
                "beforePatchRowNumber": 106,
                "afterPatchRowNumber": 107,
                "PatchRowcode": "     @classmethod"
            },
            "63": {
                "beforePatchRowNumber": 107,
                "afterPatchRowNumber": 108,
                "PatchRowcode": "     def is_node(cls, path):"
            },
            "64": {
                "beforePatchRowNumber": 108,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        abs_path = os.path.join(FOLDER, path.replace(\"/\", os.sep))"
            },
            "65": {
                "beforePatchRowNumber": 109,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        return os.path.isdir(abs_path)"
            },
            "66": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 109,
                "PatchRowcode": "+        filesystem_path = pathutils.path_to_filesystem(path, FOLDER)"
            },
            "67": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 110,
                "PatchRowcode": "+        return os.path.isdir(filesystem_path)"
            },
            "68": {
                "beforePatchRowNumber": 110,
                "afterPatchRowNumber": 111,
                "PatchRowcode": " "
            },
            "69": {
                "beforePatchRowNumber": 111,
                "afterPatchRowNumber": 112,
                "PatchRowcode": "     @classmethod"
            },
            "70": {
                "beforePatchRowNumber": 112,
                "afterPatchRowNumber": 113,
                "PatchRowcode": "     def is_leaf(cls, path):"
            },
            "71": {
                "beforePatchRowNumber": 113,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        abs_path = os.path.join(FOLDER, path.replace(\"/\", os.sep))"
            },
            "72": {
                "beforePatchRowNumber": 114,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        return os.path.isfile(abs_path) and not abs_path.endswith(\".props\")"
            },
            "73": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 114,
                "PatchRowcode": "+        filesystem_path = pathutils.path_to_filesystem(path, FOLDER)"
            },
            "74": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 115,
                "PatchRowcode": "+        return (os.path.isfile(filesystem_path) and not"
            },
            "75": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 116,
                "PatchRowcode": "+                filesystem_path.endswith(\".props\"))"
            },
            "76": {
                "beforePatchRowNumber": 115,
                "afterPatchRowNumber": 117,
                "PatchRowcode": " "
            },
            "77": {
                "beforePatchRowNumber": 116,
                "afterPatchRowNumber": 118,
                "PatchRowcode": "     @property"
            },
            "78": {
                "beforePatchRowNumber": 117,
                "afterPatchRowNumber": 119,
                "PatchRowcode": "     def last_modified(self):"
            },
            "79": {
                "beforePatchRowNumber": 118,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        modification_time = time.gmtime(os.path.getmtime(self._path))"
            },
            "80": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 120,
                "PatchRowcode": "+        modification_time = \\"
            },
            "81": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 121,
                "PatchRowcode": "+            time.gmtime(os.path.getmtime(self._filesystem_path))"
            },
            "82": {
                "beforePatchRowNumber": 119,
                "afterPatchRowNumber": 122,
                "PatchRowcode": "         return time.strftime(\"%a, %d %b %Y %H:%M:%S +0000\", modification_time)"
            },
            "83": {
                "beforePatchRowNumber": 120,
                "afterPatchRowNumber": 123,
                "PatchRowcode": " "
            },
            "84": {
                "beforePatchRowNumber": 121,
                "afterPatchRowNumber": 124,
                "PatchRowcode": "     @property"
            }
        },
        "frontPatchFile": [
            "# -*- coding: utf-8 -*-",
            "#",
            "# This file is part of Radicale Server - Calendar Server",
            "# Copyright \u00a9 2012-2015 Guillaume Ayoub",
            "#",
            "# This library is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This library is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with Radicale.  If not, see <http://www.gnu.org/licenses/>.",
            "",
            "\"\"\"",
            "Filesystem storage backend.",
            "",
            "\"\"\"",
            "",
            "import codecs",
            "import os",
            "import posixpath",
            "import json",
            "import time",
            "import sys",
            "from contextlib import contextmanager",
            "from .. import config, ical",
            "",
            "",
            "FOLDER = os.path.expanduser(config.get(\"storage\", \"filesystem_folder\"))",
            "FILESYSTEM_ENCODING = sys.getfilesystemencoding()",
            "",
            "try:",
            "    from dulwich.repo import Repo",
            "    GIT_REPOSITORY = Repo(FOLDER)",
            "except:",
            "    GIT_REPOSITORY = None",
            "",
            "",
            "# This function overrides the builtin ``open`` function for this module",
            "# pylint: disable=W0622",
            "@contextmanager",
            "def open(path, mode=\"r\"):",
            "    \"\"\"Open a file at ``path`` with encoding set in the configuration.\"\"\"",
            "    # On enter",
            "    abs_path = os.path.join(FOLDER, path.replace(\"/\", os.sep))",
            "    with codecs.open(abs_path, mode, config.get(\"encoding\", \"stock\")) as fd:",
            "        yield fd",
            "    # On exit",
            "    if GIT_REPOSITORY and mode == \"w\":",
            "        path = os.path.relpath(abs_path, FOLDER)",
            "        GIT_REPOSITORY.stage([path])",
            "        committer = config.get(\"git\", \"committer\")",
            "        GIT_REPOSITORY.do_commit(",
            "            path.encode(\"utf-8\"), committer=committer.encode(\"utf-8\"))",
            "# pylint: enable=W0622",
            "",
            "",
            "class Collection(ical.Collection):",
            "    \"\"\"Collection stored in a flat ical file.\"\"\"",
            "    @property",
            "    def _path(self):",
            "        \"\"\"Absolute path of the file at local ``path``.\"\"\"",
            "        return os.path.join(FOLDER, self.path.replace(\"/\", os.sep))",
            "",
            "    @property",
            "    def _props_path(self):",
            "        \"\"\"Absolute path of the file storing the collection properties.\"\"\"",
            "        return self._path + \".props\"",
            "",
            "    def _create_dirs(self):",
            "        \"\"\"Create folder storing the collection if absent.\"\"\"",
            "        if not os.path.exists(os.path.dirname(self._path)):",
            "            os.makedirs(os.path.dirname(self._path))",
            "",
            "    def save(self, text):",
            "        self._create_dirs()",
            "        with open(self._path, \"w\") as fd:",
            "            fd.write(text)",
            "",
            "    def delete(self):",
            "        os.remove(self._path)",
            "        os.remove(self._props_path)",
            "",
            "    @property",
            "    def text(self):",
            "        try:",
            "            with open(self._path) as fd:",
            "                return fd.read()",
            "        except IOError:",
            "            return \"\"",
            "",
            "    @classmethod",
            "    def children(cls, path):",
            "        abs_path = os.path.join(FOLDER, path.replace(\"/\", os.sep))",
            "        _, directories, files = next(os.walk(abs_path))",
            "        for filename in directories + files:",
            "            rel_filename = posixpath.join(path, filename)",
            "            if cls.is_node(rel_filename) or cls.is_leaf(rel_filename):",
            "                yield cls(rel_filename)",
            "",
            "    @classmethod",
            "    def is_node(cls, path):",
            "        abs_path = os.path.join(FOLDER, path.replace(\"/\", os.sep))",
            "        return os.path.isdir(abs_path)",
            "",
            "    @classmethod",
            "    def is_leaf(cls, path):",
            "        abs_path = os.path.join(FOLDER, path.replace(\"/\", os.sep))",
            "        return os.path.isfile(abs_path) and not abs_path.endswith(\".props\")",
            "",
            "    @property",
            "    def last_modified(self):",
            "        modification_time = time.gmtime(os.path.getmtime(self._path))",
            "        return time.strftime(\"%a, %d %b %Y %H:%M:%S +0000\", modification_time)",
            "",
            "    @property",
            "    @contextmanager",
            "    def props(self):",
            "        # On enter",
            "        properties = {}",
            "        if os.path.exists(self._props_path):",
            "            with open(self._props_path) as prop_file:",
            "                properties.update(json.load(prop_file))",
            "        old_properties = properties.copy()",
            "        yield properties",
            "        # On exit",
            "        self._create_dirs()",
            "        if old_properties != properties:",
            "            with open(self._props_path, \"w\") as prop_file:",
            "                json.dump(properties, prop_file)"
        ],
        "afterPatchFile": [
            "# -*- coding: utf-8 -*-",
            "#",
            "# This file is part of Radicale Server - Calendar Server",
            "# Copyright \u00a9 2012-2015 Guillaume Ayoub",
            "#",
            "# This library is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This library is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with Radicale.  If not, see <http://www.gnu.org/licenses/>.",
            "",
            "\"\"\"",
            "Filesystem storage backend.",
            "",
            "\"\"\"",
            "",
            "import codecs",
            "import os",
            "import posixpath",
            "import json",
            "import time",
            "import sys",
            "from contextlib import contextmanager",
            "",
            "from .. import config, ical, pathutils",
            "",
            "",
            "FOLDER = os.path.expanduser(config.get(\"storage\", \"filesystem_folder\"))",
            "FILESYSTEM_ENCODING = sys.getfilesystemencoding()",
            "",
            "try:",
            "    from dulwich.repo import Repo",
            "    GIT_REPOSITORY = Repo(FOLDER)",
            "except:",
            "    GIT_REPOSITORY = None",
            "",
            "",
            "# This function overrides the builtin ``open`` function for this module",
            "# pylint: disable=W0622",
            "@contextmanager",
            "def open(path, mode=\"r\"):",
            "    \"\"\"Open a file at ``path`` with encoding set in the configuration.\"\"\"",
            "    # On enter",
            "    abs_path = os.path.join(FOLDER, path.replace(\"/\", os.sep))",
            "    with codecs.open(abs_path, mode, config.get(\"encoding\", \"stock\")) as fd:",
            "        yield fd",
            "    # On exit",
            "    if GIT_REPOSITORY and mode == \"w\":",
            "        path = os.path.relpath(abs_path, FOLDER)",
            "        GIT_REPOSITORY.stage([path])",
            "        committer = config.get(\"git\", \"committer\")",
            "        GIT_REPOSITORY.do_commit(",
            "            path.encode(\"utf-8\"), committer=committer.encode(\"utf-8\"))",
            "# pylint: enable=W0622",
            "",
            "",
            "class Collection(ical.Collection):",
            "    \"\"\"Collection stored in a flat ical file.\"\"\"",
            "    @property",
            "    def _filesystem_path(self):",
            "        \"\"\"Absolute path of the file at local ``path``.\"\"\"",
            "        return pathutils.path_to_filesystem(self.path, FOLDER)",
            "",
            "    @property",
            "    def _props_path(self):",
            "        \"\"\"Absolute path of the file storing the collection properties.\"\"\"",
            "        return self._filesystem_path + \".props\"",
            "",
            "    def _create_dirs(self):",
            "        \"\"\"Create folder storing the collection if absent.\"\"\"",
            "        if not os.path.exists(os.path.dirname(self._filesystem_path)):",
            "            os.makedirs(os.path.dirname(self._filesystem_path))",
            "",
            "    def save(self, text):",
            "        self._create_dirs()",
            "        with open(self._filesystem_path, \"w\") as fd:",
            "            fd.write(text)",
            "",
            "    def delete(self):",
            "        os.remove(self._filesystem_path)",
            "        os.remove(self._props_path)",
            "",
            "    @property",
            "    def text(self):",
            "        try:",
            "            with open(self._filesystem_path) as fd:",
            "                return fd.read()",
            "        except IOError:",
            "            return \"\"",
            "",
            "    @classmethod",
            "    def children(cls, path):",
            "        filesystem_path = pathutils.path_to_filesystem(path, FOLDER)",
            "        _, directories, files = next(os.walk(filesystem_path))",
            "        for filename in directories + files:",
            "            rel_filename = posixpath.join(path, filename)",
            "            if cls.is_node(rel_filename) or cls.is_leaf(rel_filename):",
            "                yield cls(rel_filename)",
            "",
            "    @classmethod",
            "    def is_node(cls, path):",
            "        filesystem_path = pathutils.path_to_filesystem(path, FOLDER)",
            "        return os.path.isdir(filesystem_path)",
            "",
            "    @classmethod",
            "    def is_leaf(cls, path):",
            "        filesystem_path = pathutils.path_to_filesystem(path, FOLDER)",
            "        return (os.path.isfile(filesystem_path) and not",
            "                filesystem_path.endswith(\".props\"))",
            "",
            "    @property",
            "    def last_modified(self):",
            "        modification_time = \\",
            "            time.gmtime(os.path.getmtime(self._filesystem_path))",
            "        return time.strftime(\"%a, %d %b %Y %H:%M:%S +0000\", modification_time)",
            "",
            "    @property",
            "    @contextmanager",
            "    def props(self):",
            "        # On enter",
            "        properties = {}",
            "        if os.path.exists(self._props_path):",
            "            with open(self._props_path) as prop_file:",
            "                properties.update(json.load(prop_file))",
            "        old_properties = properties.copy()",
            "        yield properties",
            "        # On exit",
            "        self._create_dirs()",
            "        if old_properties != properties:",
            "            with open(self._props_path, \"w\") as prop_file:",
            "                json.dump(properties, prop_file)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "31": [],
            "66": [
                "Collection",
                "_path"
            ],
            "68": [
                "Collection",
                "_path"
            ],
            "73": [
                "Collection",
                "_props_path"
            ],
            "77": [
                "Collection",
                "_create_dirs"
            ],
            "78": [
                "Collection",
                "_create_dirs"
            ],
            "82": [
                "Collection",
                "save"
            ],
            "86": [
                "Collection",
                "delete"
            ],
            "92": [
                "Collection",
                "text"
            ],
            "99": [
                "Collection",
                "children"
            ],
            "100": [
                "Collection",
                "children"
            ],
            "108": [
                "Collection",
                "is_node"
            ],
            "109": [
                "Collection",
                "is_node"
            ],
            "113": [
                "Collection",
                "is_leaf"
            ],
            "114": [
                "Collection",
                "is_leaf"
            ],
            "118": [
                "Collection",
                "last_modified"
            ]
        },
        "addLocation": []
    },
    "radicale/storage/multifilesystem.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 30,
                "afterPatchRowNumber": 30,
                "PatchRowcode": " from . import filesystem"
            },
            "1": {
                "beforePatchRowNumber": 31,
                "afterPatchRowNumber": 31,
                "PatchRowcode": " from .. import ical"
            },
            "2": {
                "beforePatchRowNumber": 32,
                "afterPatchRowNumber": 32,
                "PatchRowcode": " from .. import log"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 33,
                "PatchRowcode": "+from .. import pathutils"
            },
            "4": {
                "beforePatchRowNumber": 33,
                "afterPatchRowNumber": 34,
                "PatchRowcode": " "
            },
            "5": {
                "beforePatchRowNumber": 34,
                "afterPatchRowNumber": 35,
                "PatchRowcode": " "
            },
            "6": {
                "beforePatchRowNumber": 35,
                "afterPatchRowNumber": 36,
                "PatchRowcode": " class Collection(filesystem.Collection):"
            },
            "7": {
                "beforePatchRowNumber": 36,
                "afterPatchRowNumber": 37,
                "PatchRowcode": "     \"\"\"Collection stored in several files per calendar.\"\"\""
            },
            "8": {
                "beforePatchRowNumber": 37,
                "afterPatchRowNumber": 38,
                "PatchRowcode": "     def _create_dirs(self):"
            },
            "9": {
                "beforePatchRowNumber": 38,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        if not os.path.exists(self._path):"
            },
            "10": {
                "beforePatchRowNumber": 39,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            os.makedirs(self._path)"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 39,
                "PatchRowcode": "+        if not os.path.exists(self._filesystem_path):"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 40,
                "PatchRowcode": "+            os.makedirs(self._filesystem_path)"
            },
            "13": {
                "beforePatchRowNumber": 40,
                "afterPatchRowNumber": 41,
                "PatchRowcode": " "
            },
            "14": {
                "beforePatchRowNumber": 41,
                "afterPatchRowNumber": 42,
                "PatchRowcode": "     @property"
            },
            "15": {
                "beforePatchRowNumber": 42,
                "afterPatchRowNumber": 43,
                "PatchRowcode": "     def headers(self):"
            },
            "16": {
                "beforePatchRowNumber": 52,
                "afterPatchRowNumber": 53,
                "PatchRowcode": "             name = ("
            },
            "17": {
                "beforePatchRowNumber": 53,
                "afterPatchRowNumber": 54,
                "PatchRowcode": "                 component.name if sys.version_info[0] >= 3 else"
            },
            "18": {
                "beforePatchRowNumber": 54,
                "afterPatchRowNumber": 55,
                "PatchRowcode": "                 component.name.encode(filesystem.FILESYSTEM_ENCODING))"
            },
            "19": {
                "beforePatchRowNumber": 55,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            path = os.path.join(self._path, name)"
            },
            "20": {
                "beforePatchRowNumber": 56,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            with filesystem.open(path, \"w\") as fd:"
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 56,
                "PatchRowcode": "+            filesystem_path = os.path.join(self._filesystem_path, name)"
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 57,
                "PatchRowcode": "+            with filesystem.open(filesystem_path, \"w\") as fd:"
            },
            "23": {
                "beforePatchRowNumber": 57,
                "afterPatchRowNumber": 58,
                "PatchRowcode": "                 fd.write(text)"
            },
            "24": {
                "beforePatchRowNumber": 58,
                "afterPatchRowNumber": 59,
                "PatchRowcode": " "
            },
            "25": {
                "beforePatchRowNumber": 59,
                "afterPatchRowNumber": 60,
                "PatchRowcode": "     def delete(self):"
            },
            "26": {
                "beforePatchRowNumber": 60,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        shutil.rmtree(self._path)"
            },
            "27": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 61,
                "PatchRowcode": "+        shutil.rmtree(self._filesystem_path)"
            },
            "28": {
                "beforePatchRowNumber": 61,
                "afterPatchRowNumber": 62,
                "PatchRowcode": "         os.remove(self._props_path)"
            },
            "29": {
                "beforePatchRowNumber": 62,
                "afterPatchRowNumber": 63,
                "PatchRowcode": " "
            },
            "30": {
                "beforePatchRowNumber": 63,
                "afterPatchRowNumber": 64,
                "PatchRowcode": "     def remove(self, name):"
            },
            "31": {
                "beforePatchRowNumber": 64,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        if os.path.exists(os.path.join(self._path, name)):"
            },
            "32": {
                "beforePatchRowNumber": 65,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            os.remove(os.path.join(self._path, name))"
            },
            "33": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 65,
                "PatchRowcode": "+        filesystem_path = os.path.join(self._filesystem_path, name)"
            },
            "34": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 66,
                "PatchRowcode": "+        if os.path.exists(filesystem_path):"
            },
            "35": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 67,
                "PatchRowcode": "+            os.remove(filesystem_path)"
            },
            "36": {
                "beforePatchRowNumber": 66,
                "afterPatchRowNumber": 68,
                "PatchRowcode": " "
            },
            "37": {
                "beforePatchRowNumber": 67,
                "afterPatchRowNumber": 69,
                "PatchRowcode": "     @property"
            },
            "38": {
                "beforePatchRowNumber": 68,
                "afterPatchRowNumber": 70,
                "PatchRowcode": "     def text(self):"
            },
            "39": {
                "beforePatchRowNumber": 69,
                "afterPatchRowNumber": 71,
                "PatchRowcode": "         components = ("
            },
            "40": {
                "beforePatchRowNumber": 70,
                "afterPatchRowNumber": 72,
                "PatchRowcode": "             ical.Timezone, ical.Event, ical.Todo, ical.Journal, ical.Card)"
            },
            "41": {
                "beforePatchRowNumber": 71,
                "afterPatchRowNumber": 73,
                "PatchRowcode": "         items = set()"
            },
            "42": {
                "beforePatchRowNumber": 72,
                "afterPatchRowNumber": 74,
                "PatchRowcode": "         try:"
            },
            "43": {
                "beforePatchRowNumber": 73,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            filenames = os.listdir(self._path)"
            },
            "44": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 75,
                "PatchRowcode": "+            filenames = os.listdir(self._filesystem_path)"
            },
            "45": {
                "beforePatchRowNumber": 74,
                "afterPatchRowNumber": 76,
                "PatchRowcode": "         except (OSError, IOError) as e:"
            },
            "46": {
                "beforePatchRowNumber": 75,
                "afterPatchRowNumber": 77,
                "PatchRowcode": "             log.LOGGER.info('Error while reading collection %r: %r'"
            },
            "47": {
                "beforePatchRowNumber": 76,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                            % (self._path, e))"
            },
            "48": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 78,
                "PatchRowcode": "+                            % (self._filesystem_path, e))"
            },
            "49": {
                "beforePatchRowNumber": 77,
                "afterPatchRowNumber": 79,
                "PatchRowcode": "             return \"\""
            },
            "50": {
                "beforePatchRowNumber": 78,
                "afterPatchRowNumber": 80,
                "PatchRowcode": " "
            },
            "51": {
                "beforePatchRowNumber": 79,
                "afterPatchRowNumber": 81,
                "PatchRowcode": "         for filename in filenames:"
            },
            "52": {
                "beforePatchRowNumber": 80,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            path = os.path.join(self._path, filename)"
            },
            "53": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 82,
                "PatchRowcode": "+            path = os.path.join(self._filesystem_path, filename)"
            },
            "54": {
                "beforePatchRowNumber": 81,
                "afterPatchRowNumber": 83,
                "PatchRowcode": "             try:"
            },
            "55": {
                "beforePatchRowNumber": 82,
                "afterPatchRowNumber": 84,
                "PatchRowcode": "                 with filesystem.open(path) as fd:"
            },
            "56": {
                "beforePatchRowNumber": 83,
                "afterPatchRowNumber": 85,
                "PatchRowcode": "                     items.update(self._parse(fd.read(), components))"
            },
            "57": {
                "beforePatchRowNumber": 90,
                "afterPatchRowNumber": 92,
                "PatchRowcode": " "
            },
            "58": {
                "beforePatchRowNumber": 91,
                "afterPatchRowNumber": 93,
                "PatchRowcode": "     @classmethod"
            },
            "59": {
                "beforePatchRowNumber": 92,
                "afterPatchRowNumber": 94,
                "PatchRowcode": "     def is_node(cls, path):"
            },
            "60": {
                "beforePatchRowNumber": 93,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        path = os.path.join(filesystem.FOLDER, path.replace(\"/\", os.sep))"
            },
            "61": {
                "beforePatchRowNumber": 94,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        return os.path.isdir(path) and not os.path.exists(path + \".props\")"
            },
            "62": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 95,
                "PatchRowcode": "+        filesystem_path = pathutils.path_to_filesystem(path,"
            },
            "63": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 96,
                "PatchRowcode": "+                                                       filesystem.FOLDER)"
            },
            "64": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 97,
                "PatchRowcode": "+        return (os.path.isdir(filesystem_path) and"
            },
            "65": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 98,
                "PatchRowcode": "+                not os.path.exists(filesystem_path + \".props\"))"
            },
            "66": {
                "beforePatchRowNumber": 95,
                "afterPatchRowNumber": 99,
                "PatchRowcode": " "
            },
            "67": {
                "beforePatchRowNumber": 96,
                "afterPatchRowNumber": 100,
                "PatchRowcode": "     @classmethod"
            },
            "68": {
                "beforePatchRowNumber": 97,
                "afterPatchRowNumber": 101,
                "PatchRowcode": "     def is_leaf(cls, path):"
            },
            "69": {
                "beforePatchRowNumber": 98,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        path = os.path.join(filesystem.FOLDER, path.replace(\"/\", os.sep))"
            },
            "70": {
                "beforePatchRowNumber": 99,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        return os.path.isdir(path) and os.path.exists(path + \".props\")"
            },
            "71": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 102,
                "PatchRowcode": "+        filesystem_path = pathutils.path_to_filesystem(path,"
            },
            "72": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 103,
                "PatchRowcode": "+                                                       filesystem.FOLDER)"
            },
            "73": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 104,
                "PatchRowcode": "+        return (os.path.isdir(filesystem_path) and"
            },
            "74": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 105,
                "PatchRowcode": "+                os.path.exists(path + \".props\"))"
            },
            "75": {
                "beforePatchRowNumber": 100,
                "afterPatchRowNumber": 106,
                "PatchRowcode": " "
            },
            "76": {
                "beforePatchRowNumber": 101,
                "afterPatchRowNumber": 107,
                "PatchRowcode": "     @property"
            },
            "77": {
                "beforePatchRowNumber": 102,
                "afterPatchRowNumber": 108,
                "PatchRowcode": "     def last_modified(self):"
            },
            "78": {
                "beforePatchRowNumber": 103,
                "afterPatchRowNumber": 109,
                "PatchRowcode": "         last = max(["
            },
            "79": {
                "beforePatchRowNumber": 104,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            os.path.getmtime(os.path.join(self._path, filename))"
            },
            "80": {
                "beforePatchRowNumber": 105,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            for filename in os.listdir(self._path)] or [0])"
            },
            "81": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 110,
                "PatchRowcode": "+            os.path.getmtime(os.path.join(self._filesystem_path, filename))"
            },
            "82": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 111,
                "PatchRowcode": "+            for filename in os.listdir(self._filesystem_path)] or [0])"
            },
            "83": {
                "beforePatchRowNumber": 106,
                "afterPatchRowNumber": 112,
                "PatchRowcode": "         return time.strftime(\"%a, %d %b %Y %H:%M:%S +0000\", time.gmtime(last))"
            }
        },
        "frontPatchFile": [
            "# -*- coding: utf-8 -*-",
            "#",
            "# This file is part of Radicale Server - Calendar Server",
            "# Copyright \u00a9 2014 Jean-Marc Martins",
            "# Copyright \u00a9 2014-2015 Guillaume Ayoub",
            "#",
            "# This library is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This library is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with Radicale.  If not, see <http://www.gnu.org/licenses/>.",
            "",
            "\"\"\"",
            "Multi files per calendar filesystem storage backend.",
            "",
            "\"\"\"",
            "",
            "import os",
            "import shutil",
            "import time",
            "import sys",
            "",
            "from . import filesystem",
            "from .. import ical",
            "from .. import log",
            "",
            "",
            "class Collection(filesystem.Collection):",
            "    \"\"\"Collection stored in several files per calendar.\"\"\"",
            "    def _create_dirs(self):",
            "        if not os.path.exists(self._path):",
            "            os.makedirs(self._path)",
            "",
            "    @property",
            "    def headers(self):",
            "        return (",
            "            ical.Header(\"PRODID:-//Radicale//NONSGML Radicale Server//EN\"),",
            "            ical.Header(\"VERSION:%s\" % self.version))",
            "",
            "    def write(self):",
            "        self._create_dirs()",
            "        for component in self.components:",
            "            text = ical.serialize(",
            "                self.tag, self.headers, [component] + self.timezones)",
            "            name = (",
            "                component.name if sys.version_info[0] >= 3 else",
            "                component.name.encode(filesystem.FILESYSTEM_ENCODING))",
            "            path = os.path.join(self._path, name)",
            "            with filesystem.open(path, \"w\") as fd:",
            "                fd.write(text)",
            "",
            "    def delete(self):",
            "        shutil.rmtree(self._path)",
            "        os.remove(self._props_path)",
            "",
            "    def remove(self, name):",
            "        if os.path.exists(os.path.join(self._path, name)):",
            "            os.remove(os.path.join(self._path, name))",
            "",
            "    @property",
            "    def text(self):",
            "        components = (",
            "            ical.Timezone, ical.Event, ical.Todo, ical.Journal, ical.Card)",
            "        items = set()",
            "        try:",
            "            filenames = os.listdir(self._path)",
            "        except (OSError, IOError) as e:",
            "            log.LOGGER.info('Error while reading collection %r: %r'",
            "                            % (self._path, e))",
            "            return \"\"",
            "",
            "        for filename in filenames:",
            "            path = os.path.join(self._path, filename)",
            "            try:",
            "                with filesystem.open(path) as fd:",
            "                    items.update(self._parse(fd.read(), components))",
            "            except (OSError, IOError) as e:",
            "                log.LOGGER.warning('Error while reading item %r: %r'",
            "                                   % (path, e))",
            "",
            "        return ical.serialize(",
            "            self.tag, self.headers, sorted(items, key=lambda x: x.name))",
            "",
            "    @classmethod",
            "    def is_node(cls, path):",
            "        path = os.path.join(filesystem.FOLDER, path.replace(\"/\", os.sep))",
            "        return os.path.isdir(path) and not os.path.exists(path + \".props\")",
            "",
            "    @classmethod",
            "    def is_leaf(cls, path):",
            "        path = os.path.join(filesystem.FOLDER, path.replace(\"/\", os.sep))",
            "        return os.path.isdir(path) and os.path.exists(path + \".props\")",
            "",
            "    @property",
            "    def last_modified(self):",
            "        last = max([",
            "            os.path.getmtime(os.path.join(self._path, filename))",
            "            for filename in os.listdir(self._path)] or [0])",
            "        return time.strftime(\"%a, %d %b %Y %H:%M:%S +0000\", time.gmtime(last))"
        ],
        "afterPatchFile": [
            "# -*- coding: utf-8 -*-",
            "#",
            "# This file is part of Radicale Server - Calendar Server",
            "# Copyright \u00a9 2014 Jean-Marc Martins",
            "# Copyright \u00a9 2014-2015 Guillaume Ayoub",
            "#",
            "# This library is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This library is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with Radicale.  If not, see <http://www.gnu.org/licenses/>.",
            "",
            "\"\"\"",
            "Multi files per calendar filesystem storage backend.",
            "",
            "\"\"\"",
            "",
            "import os",
            "import shutil",
            "import time",
            "import sys",
            "",
            "from . import filesystem",
            "from .. import ical",
            "from .. import log",
            "from .. import pathutils",
            "",
            "",
            "class Collection(filesystem.Collection):",
            "    \"\"\"Collection stored in several files per calendar.\"\"\"",
            "    def _create_dirs(self):",
            "        if not os.path.exists(self._filesystem_path):",
            "            os.makedirs(self._filesystem_path)",
            "",
            "    @property",
            "    def headers(self):",
            "        return (",
            "            ical.Header(\"PRODID:-//Radicale//NONSGML Radicale Server//EN\"),",
            "            ical.Header(\"VERSION:%s\" % self.version))",
            "",
            "    def write(self):",
            "        self._create_dirs()",
            "        for component in self.components:",
            "            text = ical.serialize(",
            "                self.tag, self.headers, [component] + self.timezones)",
            "            name = (",
            "                component.name if sys.version_info[0] >= 3 else",
            "                component.name.encode(filesystem.FILESYSTEM_ENCODING))",
            "            filesystem_path = os.path.join(self._filesystem_path, name)",
            "            with filesystem.open(filesystem_path, \"w\") as fd:",
            "                fd.write(text)",
            "",
            "    def delete(self):",
            "        shutil.rmtree(self._filesystem_path)",
            "        os.remove(self._props_path)",
            "",
            "    def remove(self, name):",
            "        filesystem_path = os.path.join(self._filesystem_path, name)",
            "        if os.path.exists(filesystem_path):",
            "            os.remove(filesystem_path)",
            "",
            "    @property",
            "    def text(self):",
            "        components = (",
            "            ical.Timezone, ical.Event, ical.Todo, ical.Journal, ical.Card)",
            "        items = set()",
            "        try:",
            "            filenames = os.listdir(self._filesystem_path)",
            "        except (OSError, IOError) as e:",
            "            log.LOGGER.info('Error while reading collection %r: %r'",
            "                            % (self._filesystem_path, e))",
            "            return \"\"",
            "",
            "        for filename in filenames:",
            "            path = os.path.join(self._filesystem_path, filename)",
            "            try:",
            "                with filesystem.open(path) as fd:",
            "                    items.update(self._parse(fd.read(), components))",
            "            except (OSError, IOError) as e:",
            "                log.LOGGER.warning('Error while reading item %r: %r'",
            "                                   % (path, e))",
            "",
            "        return ical.serialize(",
            "            self.tag, self.headers, sorted(items, key=lambda x: x.name))",
            "",
            "    @classmethod",
            "    def is_node(cls, path):",
            "        filesystem_path = pathutils.path_to_filesystem(path,",
            "                                                       filesystem.FOLDER)",
            "        return (os.path.isdir(filesystem_path) and",
            "                not os.path.exists(filesystem_path + \".props\"))",
            "",
            "    @classmethod",
            "    def is_leaf(cls, path):",
            "        filesystem_path = pathutils.path_to_filesystem(path,",
            "                                                       filesystem.FOLDER)",
            "        return (os.path.isdir(filesystem_path) and",
            "                os.path.exists(path + \".props\"))",
            "",
            "    @property",
            "    def last_modified(self):",
            "        last = max([",
            "            os.path.getmtime(os.path.join(self._filesystem_path, filename))",
            "            for filename in os.listdir(self._filesystem_path)] or [0])",
            "        return time.strftime(\"%a, %d %b %Y %H:%M:%S +0000\", time.gmtime(last))"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "0"
        ],
        "dele_reviseLocation": {
            "38": [
                "Collection",
                "_create_dirs"
            ],
            "39": [
                "Collection",
                "_create_dirs"
            ],
            "55": [
                "Collection",
                "write"
            ],
            "56": [
                "Collection",
                "write"
            ],
            "60": [
                "Collection",
                "delete"
            ],
            "64": [
                "Collection",
                "remove"
            ],
            "65": [
                "Collection",
                "remove"
            ],
            "73": [
                "Collection",
                "text"
            ],
            "76": [
                "Collection",
                "text"
            ],
            "80": [
                "Collection",
                "text"
            ],
            "93": [
                "Collection",
                "is_node"
            ],
            "94": [
                "Collection",
                "is_node"
            ],
            "98": [
                "Collection",
                "is_leaf"
            ],
            "99": [
                "Collection",
                "is_leaf"
            ],
            "104": [
                "Collection",
                "last_modified"
            ],
            "105": [
                "Collection",
                "last_modified"
            ]
        },
        "addLocation": []
    }
}