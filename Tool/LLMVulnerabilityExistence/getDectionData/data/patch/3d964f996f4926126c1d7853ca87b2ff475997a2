{
    "examples/example_plugin/example_plugin/jobs.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 152,
                "afterPatchRowNumber": 152,
                "PatchRowcode": "         # Run Device Job function"
            },
            "1": {
                "beforePatchRowNumber": 153,
                "afterPatchRowNumber": 153,
                "PatchRowcode": " "
            },
            "2": {
                "beforePatchRowNumber": 154,
                "afterPatchRowNumber": 154,
                "PatchRowcode": "     def receive_job_button(self, obj):"
            },
            "3": {
                "beforePatchRowNumber": 155,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        user = self.request.user"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 155,
                "PatchRowcode": "+        user = self.user"
            },
            "5": {
                "beforePatchRowNumber": 156,
                "afterPatchRowNumber": 156,
                "PatchRowcode": "         if isinstance(obj, Location):"
            },
            "6": {
                "beforePatchRowNumber": 157,
                "afterPatchRowNumber": 157,
                "PatchRowcode": "             if not user.has_perm(\"dcim.add_location\"):"
            },
            "7": {
                "beforePatchRowNumber": 158,
                "afterPatchRowNumber": 158,
                "PatchRowcode": "                 self.logger.error(\"User '%s' does not have permission to add a Location.\", user, extra={\"object\": obj})"
            },
            "8": {
                "beforePatchRowNumber": 159,
                "afterPatchRowNumber": 159,
                "PatchRowcode": "             else:"
            },
            "9": {
                "beforePatchRowNumber": 160,
                "afterPatchRowNumber": 160,
                "PatchRowcode": "                 self._run_location_job(obj)"
            },
            "10": {
                "beforePatchRowNumber": 161,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        if isinstance(obj, Device):"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 161,
                "PatchRowcode": "+        elif isinstance(obj, Device):"
            },
            "12": {
                "beforePatchRowNumber": 162,
                "afterPatchRowNumber": 162,
                "PatchRowcode": "             if not user.has_perm(\"dcim.add_device\"):"
            },
            "13": {
                "beforePatchRowNumber": 163,
                "afterPatchRowNumber": 163,
                "PatchRowcode": "                 self.logger.error(\"User '%s' does not have permission to add a Device.\", user, extra={\"object\": obj})"
            },
            "14": {
                "beforePatchRowNumber": 164,
                "afterPatchRowNumber": 164,
                "PatchRowcode": "             else:"
            },
            "15": {
                "beforePatchRowNumber": 165,
                "afterPatchRowNumber": 165,
                "PatchRowcode": "                 self._run_device_job(obj)"
            },
            "16": {
                "beforePatchRowNumber": 166,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.logger.error(\"Unable to run Job Button for type %s.\", type(obj).__name__, extra={\"object\": obj})"
            },
            "17": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 166,
                "PatchRowcode": "+        else:"
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 167,
                "PatchRowcode": "+            self.logger.error(\"Unable to run Job Button for type %s.\", type(obj).__name__, extra={\"object\": obj})"
            },
            "19": {
                "beforePatchRowNumber": 167,
                "afterPatchRowNumber": 168,
                "PatchRowcode": " "
            },
            "20": {
                "beforePatchRowNumber": 168,
                "afterPatchRowNumber": 169,
                "PatchRowcode": " "
            },
            "21": {
                "beforePatchRowNumber": 169,
                "afterPatchRowNumber": 170,
                "PatchRowcode": " jobs = ("
            }
        },
        "frontPatchFile": [
            "import sys",
            "import time",
            "",
            "from django.conf import settings",
            "from django.db import transaction",
            "",
            "from nautobot.apps.jobs import (",
            "    DryRunVar,",
            "    IntegerVar,",
            "    Job,",
            "    JobButtonReceiver,",
            "    JobHookReceiver,",
            "    register_jobs,",
            ")",
            "from nautobot.dcim.models import Device, Location",
            "from nautobot.extras.choices import ObjectChangeActionChoices",
            "",
            "",
            "name = \"ExamplePlugin jobs\"",
            "",
            "",
            "class ExampleDryRunJob(Job):",
            "    dryrun = DryRunVar()",
            "",
            "    class Meta:",
            "        approval_required = True",
            "        has_sensitive_variables = False",
            "        description = \"Example job to remove serial number on all devices, supports dryrun mode.\"",
            "",
            "    def run(self, dryrun):",
            "        try:",
            "            with transaction.atomic():",
            "                devices_with_serial = Device.objects.exclude(serial=\"\")",
            "                log_msg = \"Removing serial on %s devices.\"",
            "                if dryrun:",
            "                    log_msg += \" (DRYRUN)\"",
            "                self.logger.info(log_msg, devices_with_serial.count())",
            "                for device in devices_with_serial:",
            "                    if not dryrun:",
            "                        device.serial = \"\"",
            "                        device.save()",
            "        except Exception:",
            "            self.logger.error(\"%s failed. Database changes rolled back.\", self.__name__)",
            "            raise",
            "",
            "",
            "class ExampleJob(Job):",
            "    # specify template_name to override the default job scheduling template",
            "    template_name = \"example_plugin/example_with_custom_template.html\"",
            "",
            "    class Meta:",
            "        name = \"Example job, does nothing\"",
            "        description = \"\"\"",
            "            Markdown Formatting",
            "",
            "            *This is italicized*",
            "        \"\"\"",
            "",
            "    def run(self):",
            "        pass",
            "",
            "",
            "class ExampleHiddenJob(Job):",
            "    class Meta:",
            "        hidden = True",
            "        name = \"Example hidden job\"",
            "        description = \"I should not show in the UI!\"",
            "",
            "    def run(self):",
            "        pass",
            "",
            "",
            "class ExampleLoggingJob(Job):",
            "    interval = IntegerVar(default=4, description=\"The time in seconds to sleep.\")",
            "",
            "    class Meta:",
            "        name = \"Example logging job.\"",
            "        description = \"I log stuff to demonstrate how UI logging works.\"",
            "        task_queues = [",
            "            settings.CELERY_TASK_DEFAULT_QUEUE,",
            "            \"priority\",",
            "            \"bulk\",",
            "        ]",
            "",
            "    def run(self, interval):",
            "        self.logger.debug(\"Running for %s seconds.\", interval)",
            "        for step in range(1, interval + 1):",
            "            time.sleep(1)",
            "            self.logger.info(\"Step %s\", step)",
            "            print(f\"stdout logging for step {step}, task: {self.request.id}\")",
            "            print(f\"stderr logging for step {step}, task: {self.request.id}\", file=sys.stderr)",
            "        self.logger.critical(",
            "            \"This log message will not be logged to the database but will be logged to the console.\",",
            "            extra={\"skip_db_logging\": True},",
            "        )",
            "        self.logger.info(\"Success\", extra={\"object\": self.job_model, \"grouping\": \"job_run_success\"})",
            "        return f\"Ran for {interval} seconds\"",
            "",
            "",
            "class ExampleJobHookReceiver(JobHookReceiver):",
            "    class Meta:",
            "        name = \"Example job hook receiver\"",
            "        description = \"Validate changes to object serial field\"",
            "",
            "    def receive_job_hook(self, change, action, changed_object):",
            "        # return on delete action",
            "        if action == ObjectChangeActionChoices.ACTION_DELETE:",
            "            return",
            "",
            "        # log diff output",
            "        snapshots = change.get_snapshots()",
            "        self.logger.info(\"DIFF: %s\", snapshots[\"differences\"])",
            "",
            "        # validate changes to serial field",
            "        if \"serial\" in snapshots[\"differences\"][\"added\"]:",
            "            old_serial = snapshots[\"differences\"][\"removed\"][\"serial\"]",
            "            new_serial = snapshots[\"differences\"][\"added\"][\"serial\"]",
            "            self.logger.info(\"%s serial has been changed from %s to %s\", changed_object, old_serial, new_serial)",
            "",
            "            # Check the new serial is valid and revert if necessary",
            "            if not self.validate_serial(new_serial):",
            "                changed_object.serial = old_serial",
            "                changed_object.save()",
            "                self.logger.info(\"%s serial %s was not valid. Reverted to %s\", changed_object, new_serial, old_serial)",
            "",
            "            self.logger.info(\"Serial validation completed for %s\", changed_object)",
            "",
            "    def validate_serial(self, serial):",
            "        # add business logic to validate serial",
            "        return False",
            "",
            "",
            "class ExampleSimpleJobButtonReceiver(JobButtonReceiver):",
            "    class Meta:",
            "        name = \"Example Simple Job Button Receiver\"",
            "",
            "    def receive_job_button(self, obj):",
            "        self.logger.info(\"Running Job Button Receiver.\", extra={\"object\": obj})",
            "        # Add job logic here",
            "",
            "",
            "class ExampleComplexJobButtonReceiver(JobButtonReceiver):",
            "    class Meta:",
            "        name = \"Example Complex Job Button Receiver\"",
            "",
            "    def _run_location_job(self, obj):",
            "        self.logger.info(\"Running Location Job Button Receiver.\", extra={\"object\": obj})",
            "        # Run Location Job function",
            "",
            "    def _run_device_job(self, obj):",
            "        self.logger.info(\"Running Device Job Button Receiver.\", extra={\"object\": obj})",
            "        # Run Device Job function",
            "",
            "    def receive_job_button(self, obj):",
            "        user = self.request.user",
            "        if isinstance(obj, Location):",
            "            if not user.has_perm(\"dcim.add_location\"):",
            "                self.logger.error(\"User '%s' does not have permission to add a Location.\", user, extra={\"object\": obj})",
            "            else:",
            "                self._run_location_job(obj)",
            "        if isinstance(obj, Device):",
            "            if not user.has_perm(\"dcim.add_device\"):",
            "                self.logger.error(\"User '%s' does not have permission to add a Device.\", user, extra={\"object\": obj})",
            "            else:",
            "                self._run_device_job(obj)",
            "        self.logger.error(\"Unable to run Job Button for type %s.\", type(obj).__name__, extra={\"object\": obj})",
            "",
            "",
            "jobs = (",
            "    ExampleDryRunJob,",
            "    ExampleJob,",
            "    ExampleHiddenJob,",
            "    ExampleLoggingJob,",
            "    ExampleJobHookReceiver,",
            "    ExampleSimpleJobButtonReceiver,",
            "    ExampleComplexJobButtonReceiver,",
            ")",
            "register_jobs(*jobs)"
        ],
        "afterPatchFile": [
            "import sys",
            "import time",
            "",
            "from django.conf import settings",
            "from django.db import transaction",
            "",
            "from nautobot.apps.jobs import (",
            "    DryRunVar,",
            "    IntegerVar,",
            "    Job,",
            "    JobButtonReceiver,",
            "    JobHookReceiver,",
            "    register_jobs,",
            ")",
            "from nautobot.dcim.models import Device, Location",
            "from nautobot.extras.choices import ObjectChangeActionChoices",
            "",
            "",
            "name = \"ExamplePlugin jobs\"",
            "",
            "",
            "class ExampleDryRunJob(Job):",
            "    dryrun = DryRunVar()",
            "",
            "    class Meta:",
            "        approval_required = True",
            "        has_sensitive_variables = False",
            "        description = \"Example job to remove serial number on all devices, supports dryrun mode.\"",
            "",
            "    def run(self, dryrun):",
            "        try:",
            "            with transaction.atomic():",
            "                devices_with_serial = Device.objects.exclude(serial=\"\")",
            "                log_msg = \"Removing serial on %s devices.\"",
            "                if dryrun:",
            "                    log_msg += \" (DRYRUN)\"",
            "                self.logger.info(log_msg, devices_with_serial.count())",
            "                for device in devices_with_serial:",
            "                    if not dryrun:",
            "                        device.serial = \"\"",
            "                        device.save()",
            "        except Exception:",
            "            self.logger.error(\"%s failed. Database changes rolled back.\", self.__name__)",
            "            raise",
            "",
            "",
            "class ExampleJob(Job):",
            "    # specify template_name to override the default job scheduling template",
            "    template_name = \"example_plugin/example_with_custom_template.html\"",
            "",
            "    class Meta:",
            "        name = \"Example job, does nothing\"",
            "        description = \"\"\"",
            "            Markdown Formatting",
            "",
            "            *This is italicized*",
            "        \"\"\"",
            "",
            "    def run(self):",
            "        pass",
            "",
            "",
            "class ExampleHiddenJob(Job):",
            "    class Meta:",
            "        hidden = True",
            "        name = \"Example hidden job\"",
            "        description = \"I should not show in the UI!\"",
            "",
            "    def run(self):",
            "        pass",
            "",
            "",
            "class ExampleLoggingJob(Job):",
            "    interval = IntegerVar(default=4, description=\"The time in seconds to sleep.\")",
            "",
            "    class Meta:",
            "        name = \"Example logging job.\"",
            "        description = \"I log stuff to demonstrate how UI logging works.\"",
            "        task_queues = [",
            "            settings.CELERY_TASK_DEFAULT_QUEUE,",
            "            \"priority\",",
            "            \"bulk\",",
            "        ]",
            "",
            "    def run(self, interval):",
            "        self.logger.debug(\"Running for %s seconds.\", interval)",
            "        for step in range(1, interval + 1):",
            "            time.sleep(1)",
            "            self.logger.info(\"Step %s\", step)",
            "            print(f\"stdout logging for step {step}, task: {self.request.id}\")",
            "            print(f\"stderr logging for step {step}, task: {self.request.id}\", file=sys.stderr)",
            "        self.logger.critical(",
            "            \"This log message will not be logged to the database but will be logged to the console.\",",
            "            extra={\"skip_db_logging\": True},",
            "        )",
            "        self.logger.info(\"Success\", extra={\"object\": self.job_model, \"grouping\": \"job_run_success\"})",
            "        return f\"Ran for {interval} seconds\"",
            "",
            "",
            "class ExampleJobHookReceiver(JobHookReceiver):",
            "    class Meta:",
            "        name = \"Example job hook receiver\"",
            "        description = \"Validate changes to object serial field\"",
            "",
            "    def receive_job_hook(self, change, action, changed_object):",
            "        # return on delete action",
            "        if action == ObjectChangeActionChoices.ACTION_DELETE:",
            "            return",
            "",
            "        # log diff output",
            "        snapshots = change.get_snapshots()",
            "        self.logger.info(\"DIFF: %s\", snapshots[\"differences\"])",
            "",
            "        # validate changes to serial field",
            "        if \"serial\" in snapshots[\"differences\"][\"added\"]:",
            "            old_serial = snapshots[\"differences\"][\"removed\"][\"serial\"]",
            "            new_serial = snapshots[\"differences\"][\"added\"][\"serial\"]",
            "            self.logger.info(\"%s serial has been changed from %s to %s\", changed_object, old_serial, new_serial)",
            "",
            "            # Check the new serial is valid and revert if necessary",
            "            if not self.validate_serial(new_serial):",
            "                changed_object.serial = old_serial",
            "                changed_object.save()",
            "                self.logger.info(\"%s serial %s was not valid. Reverted to %s\", changed_object, new_serial, old_serial)",
            "",
            "            self.logger.info(\"Serial validation completed for %s\", changed_object)",
            "",
            "    def validate_serial(self, serial):",
            "        # add business logic to validate serial",
            "        return False",
            "",
            "",
            "class ExampleSimpleJobButtonReceiver(JobButtonReceiver):",
            "    class Meta:",
            "        name = \"Example Simple Job Button Receiver\"",
            "",
            "    def receive_job_button(self, obj):",
            "        self.logger.info(\"Running Job Button Receiver.\", extra={\"object\": obj})",
            "        # Add job logic here",
            "",
            "",
            "class ExampleComplexJobButtonReceiver(JobButtonReceiver):",
            "    class Meta:",
            "        name = \"Example Complex Job Button Receiver\"",
            "",
            "    def _run_location_job(self, obj):",
            "        self.logger.info(\"Running Location Job Button Receiver.\", extra={\"object\": obj})",
            "        # Run Location Job function",
            "",
            "    def _run_device_job(self, obj):",
            "        self.logger.info(\"Running Device Job Button Receiver.\", extra={\"object\": obj})",
            "        # Run Device Job function",
            "",
            "    def receive_job_button(self, obj):",
            "        user = self.user",
            "        if isinstance(obj, Location):",
            "            if not user.has_perm(\"dcim.add_location\"):",
            "                self.logger.error(\"User '%s' does not have permission to add a Location.\", user, extra={\"object\": obj})",
            "            else:",
            "                self._run_location_job(obj)",
            "        elif isinstance(obj, Device):",
            "            if not user.has_perm(\"dcim.add_device\"):",
            "                self.logger.error(\"User '%s' does not have permission to add a Device.\", user, extra={\"object\": obj})",
            "            else:",
            "                self._run_device_job(obj)",
            "        else:",
            "            self.logger.error(\"Unable to run Job Button for type %s.\", type(obj).__name__, extra={\"object\": obj})",
            "",
            "",
            "jobs = (",
            "    ExampleDryRunJob,",
            "    ExampleJob,",
            "    ExampleHiddenJob,",
            "    ExampleLoggingJob,",
            "    ExampleJobHookReceiver,",
            "    ExampleSimpleJobButtonReceiver,",
            "    ExampleComplexJobButtonReceiver,",
            ")",
            "register_jobs(*jobs)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "155": [
                "ExampleComplexJobButtonReceiver",
                "receive_job_button"
            ],
            "161": [
                "ExampleComplexJobButtonReceiver",
                "receive_job_button"
            ],
            "166": [
                "ExampleComplexJobButtonReceiver",
                "receive_job_button"
            ]
        },
        "addLocation": []
    },
    "nautobot/extras/templatetags/job_buttons.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 6,
                "afterPatchRowNumber": 6,
                "PatchRowcode": " from django.utils.html import format_html"
            },
            "1": {
                "beforePatchRowNumber": 7,
                "afterPatchRowNumber": 7,
                "PatchRowcode": " from django.utils.safestring import mark_safe"
            },
            "2": {
                "beforePatchRowNumber": 8,
                "afterPatchRowNumber": 8,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": 9,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-from nautobot.extras.models import JobButton"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 9,
                "PatchRowcode": "+from nautobot.extras.models import Job, JobButton"
            },
            "5": {
                "beforePatchRowNumber": 10,
                "afterPatchRowNumber": 10,
                "PatchRowcode": " from nautobot.core.utils.data import render_jinja2"
            },
            "6": {
                "beforePatchRowNumber": 11,
                "afterPatchRowNumber": 11,
                "PatchRowcode": " "
            },
            "7": {
                "beforePatchRowNumber": 12,
                "afterPatchRowNumber": 12,
                "PatchRowcode": " "
            },
            "8": {
                "beforePatchRowNumber": 27,
                "afterPatchRowNumber": 27,
                "PatchRowcode": " <input type=\"hidden\" name=\"csrfmiddlewaretoken\" value=\"{csrf_token}\">"
            },
            "9": {
                "beforePatchRowNumber": 28,
                "afterPatchRowNumber": 28,
                "PatchRowcode": " <input type=\"hidden\" name=\"object_pk\" value=\"{object_pk}\">"
            },
            "10": {
                "beforePatchRowNumber": 29,
                "afterPatchRowNumber": 29,
                "PatchRowcode": " <input type=\"hidden\" name=\"object_model_name\" value=\"{object_model_name}\">"
            },
            "11": {
                "beforePatchRowNumber": 30,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-<input type=\"hidden\" name=\"redirect_path\" value=\"{redirect_path}\">"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 30,
                "PatchRowcode": "+<input type=\"hidden\" name=\"_schedule_type\" value=\"immediately\">"
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 31,
                "PatchRowcode": "+<input type=\"hidden\" name=\"_return_url\" value=\"{redirect_path}\">"
            },
            "14": {
                "beforePatchRowNumber": 31,
                "afterPatchRowNumber": 32,
                "PatchRowcode": " \"\"\""
            },
            "15": {
                "beforePatchRowNumber": 32,
                "afterPatchRowNumber": 33,
                "PatchRowcode": " "
            },
            "16": {
                "beforePatchRowNumber": 33,
                "afterPatchRowNumber": 34,
                "PatchRowcode": " NO_CONFIRM_BUTTON = \"\"\""
            },
            "17": {
                "beforePatchRowNumber": 69,
                "afterPatchRowNumber": 70,
                "PatchRowcode": " </div>"
            },
            "18": {
                "beforePatchRowNumber": 70,
                "afterPatchRowNumber": 71,
                "PatchRowcode": " \"\"\""
            },
            "19": {
                "beforePatchRowNumber": 71,
                "afterPatchRowNumber": 72,
                "PatchRowcode": " "
            },
            "20": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 73,
                "PatchRowcode": "+SAFE_EMPTY_STR = mark_safe(\"\")  # noqa: S308"
            },
            "21": {
                "beforePatchRowNumber": 72,
                "afterPatchRowNumber": 74,
                "PatchRowcode": " "
            },
            "22": {
                "beforePatchRowNumber": 73,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-@register.simple_tag(takes_context=True)"
            },
            "23": {
                "beforePatchRowNumber": 74,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-def job_buttons(context, obj):"
            },
            "24": {
                "beforePatchRowNumber": 75,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    \"\"\""
            },
            "25": {
                "beforePatchRowNumber": 76,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    Render all applicable job buttons for the given object."
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 75,
                "PatchRowcode": "+"
            },
            "27": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 76,
                "PatchRowcode": "+def _render_job_button_for_obj(job_button, obj, context, content_type):"
            },
            "28": {
                "beforePatchRowNumber": 77,
                "afterPatchRowNumber": 77,
                "PatchRowcode": "     \"\"\""
            },
            "29": {
                "beforePatchRowNumber": 78,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    content_type = ContentType.objects.get_for_model(obj)"
            },
            "30": {
                "beforePatchRowNumber": 79,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    buttons = JobButton.objects.filter(content_types=content_type)"
            },
            "31": {
                "beforePatchRowNumber": 80,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    if not buttons:"
            },
            "32": {
                "beforePatchRowNumber": 81,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        return \"\""
            },
            "33": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 78,
                "PatchRowcode": "+    Helper method for job_buttons templatetag to reduce repetition of code."
            },
            "34": {
                "beforePatchRowNumber": 82,
                "afterPatchRowNumber": 79,
                "PatchRowcode": " "
            },
            "35": {
                "beforePatchRowNumber": 83,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    # Pass select context data when rendering the JobButton"
            },
            "36": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 80,
                "PatchRowcode": "+    Returns:"
            },
            "37": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 81,
                "PatchRowcode": "+       (str, str): (button_html, form_html)"
            },
            "38": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 82,
                "PatchRowcode": "+    \"\"\""
            },
            "39": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 83,
                "PatchRowcode": "+    # Pass select context data when rendering the JobButton text as Jinja2"
            },
            "40": {
                "beforePatchRowNumber": 84,
                "afterPatchRowNumber": 84,
                "PatchRowcode": "     button_context = {"
            },
            "41": {
                "beforePatchRowNumber": 85,
                "afterPatchRowNumber": 85,
                "PatchRowcode": "         \"obj\": obj,"
            },
            "42": {
                "beforePatchRowNumber": 86,
                "afterPatchRowNumber": 86,
                "PatchRowcode": "         \"debug\": context.get(\"debug\", False),  # django.template.context_processors.debug"
            },
            "43": {
                "beforePatchRowNumber": 87,
                "afterPatchRowNumber": 87,
                "PatchRowcode": "         \"request\": context[\"request\"],  # django.template.context_processors.request"
            },
            "44": {
                "beforePatchRowNumber": 88,
                "afterPatchRowNumber": 88,
                "PatchRowcode": "         \"user\": context[\"user\"],  # django.contrib.auth.context_processors.auth"
            },
            "45": {
                "beforePatchRowNumber": 89,
                "afterPatchRowNumber": 89,
                "PatchRowcode": "         \"perms\": context[\"perms\"],  # django.contrib.auth.context_processors.auth"
            },
            "46": {
                "beforePatchRowNumber": 90,
                "afterPatchRowNumber": 90,
                "PatchRowcode": "     }"
            },
            "47": {
                "beforePatchRowNumber": 91,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    buttons_html = forms_html = mark_safe(\"\")  # noqa: S308"
            },
            "48": {
                "beforePatchRowNumber": 92,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    group_names = OrderedDict()"
            },
            "49": {
                "beforePatchRowNumber": 93,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "50": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 91,
                "PatchRowcode": "+    try:"
            },
            "51": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 92,
                "PatchRowcode": "+        text_rendered = render_jinja2(job_button.text, button_context)"
            },
            "52": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 93,
                "PatchRowcode": "+    except Exception as exc:"
            },
            "53": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 94,
                "PatchRowcode": "+        return ("
            },
            "54": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 95,
                "PatchRowcode": "+            format_html("
            },
            "55": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 96,
                "PatchRowcode": "+                '<a class=\"btn btn-sm btn-{}\" disabled=\"disabled\" title=\"{}\"><i class=\"mdi mdi-alert\"></i> {}</a>\\n',"
            },
            "56": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 97,
                "PatchRowcode": "+                \"default\" if not job_button.group_name else \"link\","
            },
            "57": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 98,
                "PatchRowcode": "+                exc,"
            },
            "58": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 99,
                "PatchRowcode": "+                job_button.name,"
            },
            "59": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 100,
                "PatchRowcode": "+            ),"
            },
            "60": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 101,
                "PatchRowcode": "+            SAFE_EMPTY_STR,"
            },
            "61": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 102,
                "PatchRowcode": "+        )"
            },
            "62": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 103,
                "PatchRowcode": "+"
            },
            "63": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 104,
                "PatchRowcode": "+    if not text_rendered:"
            },
            "64": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 105,
                "PatchRowcode": "+        return (SAFE_EMPTY_STR, SAFE_EMPTY_STR)"
            },
            "65": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 106,
                "PatchRowcode": "+"
            },
            "66": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 107,
                "PatchRowcode": "+    # Disable buttons if the user doesn't have permission to run the underlying Job."
            },
            "67": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 108,
                "PatchRowcode": "+    has_run_perm = Job.objects.check_perms(context[\"user\"], instance=job_button.job, action=\"run\")"
            },
            "68": {
                "beforePatchRowNumber": 94,
                "afterPatchRowNumber": 109,
                "PatchRowcode": "     hidden_inputs = format_html("
            },
            "69": {
                "beforePatchRowNumber": 95,
                "afterPatchRowNumber": 110,
                "PatchRowcode": "         HIDDEN_INPUTS,"
            },
            "70": {
                "beforePatchRowNumber": 96,
                "afterPatchRowNumber": 111,
                "PatchRowcode": "         csrf_token=context[\"csrf_token\"],"
            },
            "71": {
                "beforePatchRowNumber": 97,
                "afterPatchRowNumber": 112,
                "PatchRowcode": "         object_pk=obj.pk,"
            },
            "72": {
                "beforePatchRowNumber": 98,
                "afterPatchRowNumber": 113,
                "PatchRowcode": "         object_model_name=f\"{content_type.app_label}.{content_type.model}\","
            },
            "73": {
                "beforePatchRowNumber": 99,
                "afterPatchRowNumber": 114,
                "PatchRowcode": "         redirect_path=context[\"request\"].path,"
            },
            "74": {
                "beforePatchRowNumber": 100,
                "afterPatchRowNumber": 115,
                "PatchRowcode": "     )"
            },
            "75": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 116,
                "PatchRowcode": "+    template_args = {"
            },
            "76": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 117,
                "PatchRowcode": "+        \"button_id\": job_button.pk,"
            },
            "77": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 118,
                "PatchRowcode": "+        \"button_text\": text_rendered,"
            },
            "78": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 119,
                "PatchRowcode": "+        \"button_class\": job_button.button_class if not job_button.group_name else \"link\","
            },
            "79": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 120,
                "PatchRowcode": "+        \"button_url\": reverse(\"extras:job_run\", kwargs={\"pk\": job_button.job.pk}),"
            },
            "80": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 121,
                "PatchRowcode": "+        \"object\": obj,"
            },
            "81": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 122,
                "PatchRowcode": "+        \"job\": job_button.job,"
            },
            "82": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 123,
                "PatchRowcode": "+        \"hidden_inputs\": hidden_inputs,"
            },
            "83": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 124,
                "PatchRowcode": "+        \"disabled\": \"\" if has_run_perm else \"disabled\","
            },
            "84": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 125,
                "PatchRowcode": "+    }"
            },
            "85": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 126,
                "PatchRowcode": "+"
            },
            "86": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 127,
                "PatchRowcode": "+    if job_button.confirmation:"
            },
            "87": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 128,
                "PatchRowcode": "+        return ("
            },
            "88": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 129,
                "PatchRowcode": "+            format_html(CONFIRM_BUTTON, **template_args),"
            },
            "89": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 130,
                "PatchRowcode": "+            format_html(CONFIRM_MODAL, **template_args),"
            },
            "90": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 131,
                "PatchRowcode": "+        )"
            },
            "91": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 132,
                "PatchRowcode": "+    else:"
            },
            "92": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 133,
                "PatchRowcode": "+        return ("
            },
            "93": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 134,
                "PatchRowcode": "+            format_html(NO_CONFIRM_BUTTON, **template_args),"
            },
            "94": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 135,
                "PatchRowcode": "+            format_html(NO_CONFIRM_FORM, **template_args),"
            },
            "95": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 136,
                "PatchRowcode": "+        )"
            },
            "96": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 137,
                "PatchRowcode": "+"
            },
            "97": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 138,
                "PatchRowcode": "+"
            },
            "98": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 139,
                "PatchRowcode": "+@register.simple_tag(takes_context=True)"
            },
            "99": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 140,
                "PatchRowcode": "+def job_buttons(context, obj):"
            },
            "100": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 141,
                "PatchRowcode": "+    \"\"\""
            },
            "101": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 142,
                "PatchRowcode": "+    Render all applicable job buttons for the given object."
            },
            "102": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 143,
                "PatchRowcode": "+    \"\"\""
            },
            "103": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 144,
                "PatchRowcode": "+    content_type = ContentType.objects.get_for_model(obj)"
            },
            "104": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 145,
                "PatchRowcode": "+    # We will enforce \"run\" permission later in deciding which buttons to show as disabled."
            },
            "105": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 146,
                "PatchRowcode": "+    buttons = JobButton.objects.filter(content_types=content_type)"
            },
            "106": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 147,
                "PatchRowcode": "+    if not buttons:"
            },
            "107": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 148,
                "PatchRowcode": "+        return SAFE_EMPTY_STR"
            },
            "108": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 149,
                "PatchRowcode": "+"
            },
            "109": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 150,
                "PatchRowcode": "+    buttons_html = forms_html = SAFE_EMPTY_STR"
            },
            "110": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 151,
                "PatchRowcode": "+    group_names = OrderedDict()"
            },
            "111": {
                "beforePatchRowNumber": 101,
                "afterPatchRowNumber": 152,
                "PatchRowcode": " "
            },
            "112": {
                "beforePatchRowNumber": 102,
                "afterPatchRowNumber": 153,
                "PatchRowcode": "     for jb in buttons:"
            },
            "113": {
                "beforePatchRowNumber": 103,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        template_args = {"
            },
            "114": {
                "beforePatchRowNumber": 104,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            \"button_id\": jb.pk,"
            },
            "115": {
                "beforePatchRowNumber": 105,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            \"button_text\": jb.text,"
            },
            "116": {
                "beforePatchRowNumber": 106,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            \"button_class\": jb.button_class,"
            },
            "117": {
                "beforePatchRowNumber": 107,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            \"button_url\": reverse(\"extras:jobbutton_run\", kwargs={\"pk\": jb.pk}),"
            },
            "118": {
                "beforePatchRowNumber": 108,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            \"object\": obj,"
            },
            "119": {
                "beforePatchRowNumber": 109,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            \"job\": jb.job,"
            },
            "120": {
                "beforePatchRowNumber": 110,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            \"hidden_inputs\": hidden_inputs,"
            },
            "121": {
                "beforePatchRowNumber": 111,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            \"disabled\": \"\" if context[\"user\"].has_perms((\"extras.run_jobbutton\", \"extras.run_job\")) else \"disabled\","
            },
            "122": {
                "beforePatchRowNumber": 112,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        }"
            },
            "123": {
                "beforePatchRowNumber": 113,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "124": {
                "beforePatchRowNumber": 114,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        # Organize job buttons by group"
            },
            "125": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 154,
                "PatchRowcode": "+        # Organize job buttons by group for later processing"
            },
            "126": {
                "beforePatchRowNumber": 115,
                "afterPatchRowNumber": 155,
                "PatchRowcode": "         if jb.group_name:"
            },
            "127": {
                "beforePatchRowNumber": 116,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            group_names.setdefault(jb.group_name, [])"
            },
            "128": {
                "beforePatchRowNumber": 117,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            group_names[jb.group_name].append(jb)"
            },
            "129": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 156,
                "PatchRowcode": "+            group_names.setdefault(jb.group_name, []).append(jb)"
            },
            "130": {
                "beforePatchRowNumber": 118,
                "afterPatchRowNumber": 157,
                "PatchRowcode": " "
            },
            "131": {
                "beforePatchRowNumber": 119,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        # Add non-grouped buttons"
            },
            "132": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 158,
                "PatchRowcode": "+        # Render and add non-grouped buttons"
            },
            "133": {
                "beforePatchRowNumber": 120,
                "afterPatchRowNumber": 159,
                "PatchRowcode": "         else:"
            },
            "134": {
                "beforePatchRowNumber": 121,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            try:"
            },
            "135": {
                "beforePatchRowNumber": 122,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                text_rendered = render_jinja2(jb.text, button_context)"
            },
            "136": {
                "beforePatchRowNumber": 123,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                if text_rendered:"
            },
            "137": {
                "beforePatchRowNumber": 124,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    template_args[\"button_text\"] = text_rendered"
            },
            "138": {
                "beforePatchRowNumber": 125,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    if jb.confirmation:"
            },
            "139": {
                "beforePatchRowNumber": 126,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                        buttons_html += format_html(CONFIRM_BUTTON, **template_args)"
            },
            "140": {
                "beforePatchRowNumber": 127,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                        forms_html += format_html(CONFIRM_MODAL, **template_args)"
            },
            "141": {
                "beforePatchRowNumber": 128,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    else:"
            },
            "142": {
                "beforePatchRowNumber": 129,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                        buttons_html += format_html(NO_CONFIRM_BUTTON, **template_args)"
            },
            "143": {
                "beforePatchRowNumber": 130,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                        forms_html += format_html(NO_CONFIRM_FORM, **template_args)"
            },
            "144": {
                "beforePatchRowNumber": 131,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            except Exception as e:"
            },
            "145": {
                "beforePatchRowNumber": 132,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                buttons_html += format_html("
            },
            "146": {
                "beforePatchRowNumber": 133,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    '<a class=\"btn btn-sm btn-default\" disabled=\"disabled\" title=\"{}\">'"
            },
            "147": {
                "beforePatchRowNumber": 134,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    '<i class=\"mdi mdi-alert\"></i> {}</a>\\n',"
            },
            "148": {
                "beforePatchRowNumber": 135,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    e,"
            },
            "149": {
                "beforePatchRowNumber": 136,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    jb.name,"
            },
            "150": {
                "beforePatchRowNumber": 137,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                )"
            },
            "151": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 160,
                "PatchRowcode": "+            button_html, form_html = _render_job_button_for_obj(jb, obj, context, content_type)"
            },
            "152": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 161,
                "PatchRowcode": "+            buttons_html += button_html"
            },
            "153": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 162,
                "PatchRowcode": "+            forms_html += form_html"
            },
            "154": {
                "beforePatchRowNumber": 138,
                "afterPatchRowNumber": 163,
                "PatchRowcode": " "
            },
            "155": {
                "beforePatchRowNumber": 139,
                "afterPatchRowNumber": 164,
                "PatchRowcode": "     # Add grouped buttons to template"
            },
            "156": {
                "beforePatchRowNumber": 140,
                "afterPatchRowNumber": 165,
                "PatchRowcode": "     for group_name, buttons in group_names.items():"
            },
            "157": {
                "beforePatchRowNumber": 141,
                "afterPatchRowNumber": 166,
                "PatchRowcode": "         group_button_class = buttons[0].button_class"
            },
            "158": {
                "beforePatchRowNumber": 142,
                "afterPatchRowNumber": 167,
                "PatchRowcode": " "
            },
            "159": {
                "beforePatchRowNumber": 143,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        buttons_rendered = mark_safe(\"\")  # noqa: S308"
            },
            "160": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 168,
                "PatchRowcode": "+        buttons_rendered = SAFE_EMPTY_STR"
            },
            "161": {
                "beforePatchRowNumber": 144,
                "afterPatchRowNumber": 169,
                "PatchRowcode": " "
            },
            "162": {
                "beforePatchRowNumber": 145,
                "afterPatchRowNumber": 170,
                "PatchRowcode": "         for jb in buttons:"
            },
            "163": {
                "beforePatchRowNumber": 146,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            template_args = {"
            },
            "164": {
                "beforePatchRowNumber": 147,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                \"button_id\": jb.pk,"
            },
            "165": {
                "beforePatchRowNumber": 148,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                \"button_text\": jb.text,"
            },
            "166": {
                "beforePatchRowNumber": 149,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                \"button_class\": \"link\","
            },
            "167": {
                "beforePatchRowNumber": 150,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                \"button_url\": reverse(\"extras:jobbutton_run\", kwargs={\"pk\": jb.pk}),"
            },
            "168": {
                "beforePatchRowNumber": 151,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                \"object\": obj,"
            },
            "169": {
                "beforePatchRowNumber": 152,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                \"job\": jb.job,"
            },
            "170": {
                "beforePatchRowNumber": 153,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                \"hidden_inputs\": hidden_inputs,"
            },
            "171": {
                "beforePatchRowNumber": 154,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                \"disabled\": \"\" if context[\"user\"].has_perms((\"extras.run_jobbutton\", \"extras.run_job\")) else \"disabled\","
            },
            "172": {
                "beforePatchRowNumber": 155,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            }"
            },
            "173": {
                "beforePatchRowNumber": 156,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            try:"
            },
            "174": {
                "beforePatchRowNumber": 157,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                text_rendered = render_jinja2(jb.text, button_context)"
            },
            "175": {
                "beforePatchRowNumber": 158,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                if text_rendered:"
            },
            "176": {
                "beforePatchRowNumber": 159,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    template_args[\"button_text\"] = text_rendered"
            },
            "177": {
                "beforePatchRowNumber": 160,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    if jb.confirmation:"
            },
            "178": {
                "beforePatchRowNumber": 161,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                        buttons_rendered += ("
            },
            "179": {
                "beforePatchRowNumber": 162,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                            mark_safe(\"<li>\")  # noqa: S308"
            },
            "180": {
                "beforePatchRowNumber": 163,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                            + format_html(CONFIRM_BUTTON, **template_args)"
            },
            "181": {
                "beforePatchRowNumber": 164,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                            + mark_safe(\"</li>\")  # noqa: S308"
            },
            "182": {
                "beforePatchRowNumber": 165,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                        )"
            },
            "183": {
                "beforePatchRowNumber": 166,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                        forms_html += format_html(CONFIRM_MODAL, **template_args)"
            },
            "184": {
                "beforePatchRowNumber": 167,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    else:"
            },
            "185": {
                "beforePatchRowNumber": 168,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                        buttons_rendered += ("
            },
            "186": {
                "beforePatchRowNumber": 169,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                            mark_safe(\"<li>\")  # noqa: S308"
            },
            "187": {
                "beforePatchRowNumber": 170,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                            + format_html(NO_CONFIRM_BUTTON, **template_args)"
            },
            "188": {
                "beforePatchRowNumber": 171,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                            + mark_safe(\"</li>\")  # noqa: S308"
            },
            "189": {
                "beforePatchRowNumber": 172,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                        )"
            },
            "190": {
                "beforePatchRowNumber": 173,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                        forms_html += format_html(NO_CONFIRM_FORM, **template_args)"
            },
            "191": {
                "beforePatchRowNumber": 174,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            except Exception as e:"
            },
            "192": {
                "beforePatchRowNumber": 175,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                buttons_rendered += format_html("
            },
            "193": {
                "beforePatchRowNumber": 176,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    '<li><a disabled=\"disabled\" title=\"{}\"><span class=\"text-muted\">'"
            },
            "194": {
                "beforePatchRowNumber": 177,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    '<i class=\"mdi mdi-alert\"></i> {}</span></a></li>',"
            },
            "195": {
                "beforePatchRowNumber": 178,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    e,"
            },
            "196": {
                "beforePatchRowNumber": 179,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    jb.name,"
            },
            "197": {
                "beforePatchRowNumber": 180,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                )"
            },
            "198": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 171,
                "PatchRowcode": "+            # Render grouped buttons as list items"
            },
            "199": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 172,
                "PatchRowcode": "+            button_html, form_html = _render_job_button_for_obj(jb, obj, context, content_type)"
            },
            "200": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 173,
                "PatchRowcode": "+            buttons_rendered += format_html(\"<li>{}</li>\", button_html)"
            },
            "201": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 174,
                "PatchRowcode": "+            forms_html += form_html"
            },
            "202": {
                "beforePatchRowNumber": 181,
                "afterPatchRowNumber": 175,
                "PatchRowcode": " "
            },
            "203": {
                "beforePatchRowNumber": 182,
                "afterPatchRowNumber": 176,
                "PatchRowcode": "         if buttons_rendered:"
            },
            "204": {
                "beforePatchRowNumber": 183,
                "afterPatchRowNumber": 177,
                "PatchRowcode": "             buttons_html += format_html("
            }
        },
        "frontPatchFile": [
            "from collections import OrderedDict",
            "",
            "from django import template",
            "from django.contrib.contenttypes.models import ContentType",
            "from django.urls import reverse",
            "from django.utils.html import format_html",
            "from django.utils.safestring import mark_safe",
            "",
            "from nautobot.extras.models import JobButton",
            "from nautobot.core.utils.data import render_jinja2",
            "",
            "",
            "register = template.Library()",
            "",
            "GROUP_DROPDOWN = \"\"\"",
            "<div class=\"btn-group\">",
            "  <button type=\"button\" class=\"btn btn-sm btn-{group_button_class} dropdown-toggle\" data-toggle=\"dropdown\">",
            "    {group_name} <span class=\"caret\"></span>",
            "  </button>",
            "  <ul class=\"dropdown-menu pull-right\">",
            "    {grouped_buttons}",
            "  </ul>",
            "</div>",
            "\"\"\"",
            "",
            "HIDDEN_INPUTS = \"\"\"",
            "<input type=\"hidden\" name=\"csrfmiddlewaretoken\" value=\"{csrf_token}\">",
            "<input type=\"hidden\" name=\"object_pk\" value=\"{object_pk}\">",
            "<input type=\"hidden\" name=\"object_model_name\" value=\"{object_model_name}\">",
            "<input type=\"hidden\" name=\"redirect_path\" value=\"{redirect_path}\">",
            "\"\"\"",
            "",
            "NO_CONFIRM_BUTTON = \"\"\"",
            "<button type=\"submit\" form=\"form_id_{button_id}\" class=\"btn btn-sm btn-{button_class}\" {disabled}>{button_text}</button>",
            "\"\"\"",
            "",
            "NO_CONFIRM_FORM = \"\"\"",
            "<form id=\"form_id_{button_id}\" action=\"{button_url}\" method=\"post\" class=\"form\">",
            "  {hidden_inputs}",
            "</form>",
            "\"\"\"",
            "",
            "CONFIRM_BUTTON = \"\"\"",
            "<button type=\"button\" class=\"btn btn-sm btn-{button_class}\" data-toggle=\"modal\" data-target=\"#confirm_modal_id_{button_id}\" {disabled}>",
            "  {button_text}",
            "</button>",
            "\"\"\"",
            "",
            "CONFIRM_MODAL = \"\"\"",
            "<div class=\"modal fade\" id=\"confirm_modal_id_{button_id}\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"confirm_modal_label_{button_id}\">",
            "  <div class=\"modal-dialog\" role=\"document\">",
            "    <div class=\"modal-content\">",
            "      <div class=\"modal-header\">",
            "        <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>",
            "        <h4 class=\"modal-title\" id=\"confirm_modal_label_{button_id}\">Confirmation</h4>",
            "      </div>",
            "      <form id=\"form_id_{button_id}\" action=\"{button_url}\" method=\"post\" class=\"form\">",
            "        <div class=\"modal-body\">",
            "          {hidden_inputs}",
            "          Run Job <strong>'{job}'</strong> with object <strong>'{object}'</strong>?",
            "        </div>",
            "        <div class=\"modal-footer\">",
            "          <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Cancel</button>",
            "          <button type=\"submit\" class=\"btn btn-primary\">Confirm</button>",
            "        </div>",
            "      </form>",
            "    </div>",
            "  </div>",
            "</div>",
            "\"\"\"",
            "",
            "",
            "@register.simple_tag(takes_context=True)",
            "def job_buttons(context, obj):",
            "    \"\"\"",
            "    Render all applicable job buttons for the given object.",
            "    \"\"\"",
            "    content_type = ContentType.objects.get_for_model(obj)",
            "    buttons = JobButton.objects.filter(content_types=content_type)",
            "    if not buttons:",
            "        return \"\"",
            "",
            "    # Pass select context data when rendering the JobButton",
            "    button_context = {",
            "        \"obj\": obj,",
            "        \"debug\": context.get(\"debug\", False),  # django.template.context_processors.debug",
            "        \"request\": context[\"request\"],  # django.template.context_processors.request",
            "        \"user\": context[\"user\"],  # django.contrib.auth.context_processors.auth",
            "        \"perms\": context[\"perms\"],  # django.contrib.auth.context_processors.auth",
            "    }",
            "    buttons_html = forms_html = mark_safe(\"\")  # noqa: S308",
            "    group_names = OrderedDict()",
            "",
            "    hidden_inputs = format_html(",
            "        HIDDEN_INPUTS,",
            "        csrf_token=context[\"csrf_token\"],",
            "        object_pk=obj.pk,",
            "        object_model_name=f\"{content_type.app_label}.{content_type.model}\",",
            "        redirect_path=context[\"request\"].path,",
            "    )",
            "",
            "    for jb in buttons:",
            "        template_args = {",
            "            \"button_id\": jb.pk,",
            "            \"button_text\": jb.text,",
            "            \"button_class\": jb.button_class,",
            "            \"button_url\": reverse(\"extras:jobbutton_run\", kwargs={\"pk\": jb.pk}),",
            "            \"object\": obj,",
            "            \"job\": jb.job,",
            "            \"hidden_inputs\": hidden_inputs,",
            "            \"disabled\": \"\" if context[\"user\"].has_perms((\"extras.run_jobbutton\", \"extras.run_job\")) else \"disabled\",",
            "        }",
            "",
            "        # Organize job buttons by group",
            "        if jb.group_name:",
            "            group_names.setdefault(jb.group_name, [])",
            "            group_names[jb.group_name].append(jb)",
            "",
            "        # Add non-grouped buttons",
            "        else:",
            "            try:",
            "                text_rendered = render_jinja2(jb.text, button_context)",
            "                if text_rendered:",
            "                    template_args[\"button_text\"] = text_rendered",
            "                    if jb.confirmation:",
            "                        buttons_html += format_html(CONFIRM_BUTTON, **template_args)",
            "                        forms_html += format_html(CONFIRM_MODAL, **template_args)",
            "                    else:",
            "                        buttons_html += format_html(NO_CONFIRM_BUTTON, **template_args)",
            "                        forms_html += format_html(NO_CONFIRM_FORM, **template_args)",
            "            except Exception as e:",
            "                buttons_html += format_html(",
            "                    '<a class=\"btn btn-sm btn-default\" disabled=\"disabled\" title=\"{}\">'",
            "                    '<i class=\"mdi mdi-alert\"></i> {}</a>\\n',",
            "                    e,",
            "                    jb.name,",
            "                )",
            "",
            "    # Add grouped buttons to template",
            "    for group_name, buttons in group_names.items():",
            "        group_button_class = buttons[0].button_class",
            "",
            "        buttons_rendered = mark_safe(\"\")  # noqa: S308",
            "",
            "        for jb in buttons:",
            "            template_args = {",
            "                \"button_id\": jb.pk,",
            "                \"button_text\": jb.text,",
            "                \"button_class\": \"link\",",
            "                \"button_url\": reverse(\"extras:jobbutton_run\", kwargs={\"pk\": jb.pk}),",
            "                \"object\": obj,",
            "                \"job\": jb.job,",
            "                \"hidden_inputs\": hidden_inputs,",
            "                \"disabled\": \"\" if context[\"user\"].has_perms((\"extras.run_jobbutton\", \"extras.run_job\")) else \"disabled\",",
            "            }",
            "            try:",
            "                text_rendered = render_jinja2(jb.text, button_context)",
            "                if text_rendered:",
            "                    template_args[\"button_text\"] = text_rendered",
            "                    if jb.confirmation:",
            "                        buttons_rendered += (",
            "                            mark_safe(\"<li>\")  # noqa: S308",
            "                            + format_html(CONFIRM_BUTTON, **template_args)",
            "                            + mark_safe(\"</li>\")  # noqa: S308",
            "                        )",
            "                        forms_html += format_html(CONFIRM_MODAL, **template_args)",
            "                    else:",
            "                        buttons_rendered += (",
            "                            mark_safe(\"<li>\")  # noqa: S308",
            "                            + format_html(NO_CONFIRM_BUTTON, **template_args)",
            "                            + mark_safe(\"</li>\")  # noqa: S308",
            "                        )",
            "                        forms_html += format_html(NO_CONFIRM_FORM, **template_args)",
            "            except Exception as e:",
            "                buttons_rendered += format_html(",
            "                    '<li><a disabled=\"disabled\" title=\"{}\"><span class=\"text-muted\">'",
            "                    '<i class=\"mdi mdi-alert\"></i> {}</span></a></li>',",
            "                    e,",
            "                    jb.name,",
            "                )",
            "",
            "        if buttons_rendered:",
            "            buttons_html += format_html(",
            "                GROUP_DROPDOWN,",
            "                group_button_class=group_button_class,",
            "                group_name=group_name,",
            "                grouped_buttons=buttons_rendered,",
            "            )",
            "",
            "    # We want all of the buttons first and then any modals and forms so the buttons render properly",
            "    return buttons_html + forms_html"
        ],
        "afterPatchFile": [
            "from collections import OrderedDict",
            "",
            "from django import template",
            "from django.contrib.contenttypes.models import ContentType",
            "from django.urls import reverse",
            "from django.utils.html import format_html",
            "from django.utils.safestring import mark_safe",
            "",
            "from nautobot.extras.models import Job, JobButton",
            "from nautobot.core.utils.data import render_jinja2",
            "",
            "",
            "register = template.Library()",
            "",
            "GROUP_DROPDOWN = \"\"\"",
            "<div class=\"btn-group\">",
            "  <button type=\"button\" class=\"btn btn-sm btn-{group_button_class} dropdown-toggle\" data-toggle=\"dropdown\">",
            "    {group_name} <span class=\"caret\"></span>",
            "  </button>",
            "  <ul class=\"dropdown-menu pull-right\">",
            "    {grouped_buttons}",
            "  </ul>",
            "</div>",
            "\"\"\"",
            "",
            "HIDDEN_INPUTS = \"\"\"",
            "<input type=\"hidden\" name=\"csrfmiddlewaretoken\" value=\"{csrf_token}\">",
            "<input type=\"hidden\" name=\"object_pk\" value=\"{object_pk}\">",
            "<input type=\"hidden\" name=\"object_model_name\" value=\"{object_model_name}\">",
            "<input type=\"hidden\" name=\"_schedule_type\" value=\"immediately\">",
            "<input type=\"hidden\" name=\"_return_url\" value=\"{redirect_path}\">",
            "\"\"\"",
            "",
            "NO_CONFIRM_BUTTON = \"\"\"",
            "<button type=\"submit\" form=\"form_id_{button_id}\" class=\"btn btn-sm btn-{button_class}\" {disabled}>{button_text}</button>",
            "\"\"\"",
            "",
            "NO_CONFIRM_FORM = \"\"\"",
            "<form id=\"form_id_{button_id}\" action=\"{button_url}\" method=\"post\" class=\"form\">",
            "  {hidden_inputs}",
            "</form>",
            "\"\"\"",
            "",
            "CONFIRM_BUTTON = \"\"\"",
            "<button type=\"button\" class=\"btn btn-sm btn-{button_class}\" data-toggle=\"modal\" data-target=\"#confirm_modal_id_{button_id}\" {disabled}>",
            "  {button_text}",
            "</button>",
            "\"\"\"",
            "",
            "CONFIRM_MODAL = \"\"\"",
            "<div class=\"modal fade\" id=\"confirm_modal_id_{button_id}\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"confirm_modal_label_{button_id}\">",
            "  <div class=\"modal-dialog\" role=\"document\">",
            "    <div class=\"modal-content\">",
            "      <div class=\"modal-header\">",
            "        <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>",
            "        <h4 class=\"modal-title\" id=\"confirm_modal_label_{button_id}\">Confirmation</h4>",
            "      </div>",
            "      <form id=\"form_id_{button_id}\" action=\"{button_url}\" method=\"post\" class=\"form\">",
            "        <div class=\"modal-body\">",
            "          {hidden_inputs}",
            "          Run Job <strong>'{job}'</strong> with object <strong>'{object}'</strong>?",
            "        </div>",
            "        <div class=\"modal-footer\">",
            "          <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Cancel</button>",
            "          <button type=\"submit\" class=\"btn btn-primary\">Confirm</button>",
            "        </div>",
            "      </form>",
            "    </div>",
            "  </div>",
            "</div>",
            "\"\"\"",
            "",
            "SAFE_EMPTY_STR = mark_safe(\"\")  # noqa: S308",
            "",
            "",
            "def _render_job_button_for_obj(job_button, obj, context, content_type):",
            "    \"\"\"",
            "    Helper method for job_buttons templatetag to reduce repetition of code.",
            "",
            "    Returns:",
            "       (str, str): (button_html, form_html)",
            "    \"\"\"",
            "    # Pass select context data when rendering the JobButton text as Jinja2",
            "    button_context = {",
            "        \"obj\": obj,",
            "        \"debug\": context.get(\"debug\", False),  # django.template.context_processors.debug",
            "        \"request\": context[\"request\"],  # django.template.context_processors.request",
            "        \"user\": context[\"user\"],  # django.contrib.auth.context_processors.auth",
            "        \"perms\": context[\"perms\"],  # django.contrib.auth.context_processors.auth",
            "    }",
            "    try:",
            "        text_rendered = render_jinja2(job_button.text, button_context)",
            "    except Exception as exc:",
            "        return (",
            "            format_html(",
            "                '<a class=\"btn btn-sm btn-{}\" disabled=\"disabled\" title=\"{}\"><i class=\"mdi mdi-alert\"></i> {}</a>\\n',",
            "                \"default\" if not job_button.group_name else \"link\",",
            "                exc,",
            "                job_button.name,",
            "            ),",
            "            SAFE_EMPTY_STR,",
            "        )",
            "",
            "    if not text_rendered:",
            "        return (SAFE_EMPTY_STR, SAFE_EMPTY_STR)",
            "",
            "    # Disable buttons if the user doesn't have permission to run the underlying Job.",
            "    has_run_perm = Job.objects.check_perms(context[\"user\"], instance=job_button.job, action=\"run\")",
            "    hidden_inputs = format_html(",
            "        HIDDEN_INPUTS,",
            "        csrf_token=context[\"csrf_token\"],",
            "        object_pk=obj.pk,",
            "        object_model_name=f\"{content_type.app_label}.{content_type.model}\",",
            "        redirect_path=context[\"request\"].path,",
            "    )",
            "    template_args = {",
            "        \"button_id\": job_button.pk,",
            "        \"button_text\": text_rendered,",
            "        \"button_class\": job_button.button_class if not job_button.group_name else \"link\",",
            "        \"button_url\": reverse(\"extras:job_run\", kwargs={\"pk\": job_button.job.pk}),",
            "        \"object\": obj,",
            "        \"job\": job_button.job,",
            "        \"hidden_inputs\": hidden_inputs,",
            "        \"disabled\": \"\" if has_run_perm else \"disabled\",",
            "    }",
            "",
            "    if job_button.confirmation:",
            "        return (",
            "            format_html(CONFIRM_BUTTON, **template_args),",
            "            format_html(CONFIRM_MODAL, **template_args),",
            "        )",
            "    else:",
            "        return (",
            "            format_html(NO_CONFIRM_BUTTON, **template_args),",
            "            format_html(NO_CONFIRM_FORM, **template_args),",
            "        )",
            "",
            "",
            "@register.simple_tag(takes_context=True)",
            "def job_buttons(context, obj):",
            "    \"\"\"",
            "    Render all applicable job buttons for the given object.",
            "    \"\"\"",
            "    content_type = ContentType.objects.get_for_model(obj)",
            "    # We will enforce \"run\" permission later in deciding which buttons to show as disabled.",
            "    buttons = JobButton.objects.filter(content_types=content_type)",
            "    if not buttons:",
            "        return SAFE_EMPTY_STR",
            "",
            "    buttons_html = forms_html = SAFE_EMPTY_STR",
            "    group_names = OrderedDict()",
            "",
            "    for jb in buttons:",
            "        # Organize job buttons by group for later processing",
            "        if jb.group_name:",
            "            group_names.setdefault(jb.group_name, []).append(jb)",
            "",
            "        # Render and add non-grouped buttons",
            "        else:",
            "            button_html, form_html = _render_job_button_for_obj(jb, obj, context, content_type)",
            "            buttons_html += button_html",
            "            forms_html += form_html",
            "",
            "    # Add grouped buttons to template",
            "    for group_name, buttons in group_names.items():",
            "        group_button_class = buttons[0].button_class",
            "",
            "        buttons_rendered = SAFE_EMPTY_STR",
            "",
            "        for jb in buttons:",
            "            # Render grouped buttons as list items",
            "            button_html, form_html = _render_job_button_for_obj(jb, obj, context, content_type)",
            "            buttons_rendered += format_html(\"<li>{}</li>\", button_html)",
            "            forms_html += form_html",
            "",
            "        if buttons_rendered:",
            "            buttons_html += format_html(",
            "                GROUP_DROPDOWN,",
            "                group_button_class=group_button_class,",
            "                group_name=group_name,",
            "                grouped_buttons=buttons_rendered,",
            "            )",
            "",
            "    # We want all of the buttons first and then any modals and forms so the buttons render properly",
            "    return buttons_html + forms_html"
        ],
        "action": [
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "2",
            "2",
            "2",
            "0",
            "2",
            "2",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "9": [],
            "30": [],
            "73": [],
            "74": [
                "job_buttons"
            ],
            "75": [
                "job_buttons"
            ],
            "76": [
                "job_buttons"
            ],
            "78": [
                "job_buttons"
            ],
            "79": [
                "job_buttons"
            ],
            "80": [
                "job_buttons"
            ],
            "81": [
                "job_buttons"
            ],
            "83": [
                "job_buttons"
            ],
            "91": [
                "job_buttons"
            ],
            "92": [
                "job_buttons"
            ],
            "93": [
                "job_buttons"
            ],
            "103": [
                "job_buttons"
            ],
            "104": [
                "job_buttons"
            ],
            "105": [
                "job_buttons"
            ],
            "106": [
                "job_buttons"
            ],
            "107": [
                "job_buttons"
            ],
            "108": [
                "job_buttons"
            ],
            "109": [
                "job_buttons"
            ],
            "110": [
                "job_buttons"
            ],
            "111": [
                "job_buttons"
            ],
            "112": [
                "job_buttons"
            ],
            "113": [
                "job_buttons"
            ],
            "114": [
                "job_buttons"
            ],
            "116": [
                "job_buttons"
            ],
            "117": [
                "job_buttons"
            ],
            "119": [
                "job_buttons"
            ],
            "121": [
                "job_buttons"
            ],
            "122": [
                "job_buttons"
            ],
            "123": [
                "job_buttons"
            ],
            "124": [
                "job_buttons"
            ],
            "125": [
                "job_buttons"
            ],
            "126": [
                "job_buttons"
            ],
            "127": [
                "job_buttons"
            ],
            "128": [
                "job_buttons"
            ],
            "129": [
                "job_buttons"
            ],
            "130": [
                "job_buttons"
            ],
            "131": [
                "job_buttons"
            ],
            "132": [
                "job_buttons"
            ],
            "133": [
                "job_buttons"
            ],
            "134": [
                "job_buttons"
            ],
            "135": [
                "job_buttons"
            ],
            "136": [
                "job_buttons"
            ],
            "137": [
                "job_buttons"
            ],
            "143": [
                "job_buttons"
            ],
            "146": [
                "job_buttons"
            ],
            "147": [
                "job_buttons"
            ],
            "148": [
                "job_buttons"
            ],
            "149": [
                "job_buttons"
            ],
            "150": [
                "job_buttons"
            ],
            "151": [
                "job_buttons"
            ],
            "152": [
                "job_buttons"
            ],
            "153": [
                "job_buttons"
            ],
            "154": [
                "job_buttons"
            ],
            "155": [
                "job_buttons"
            ],
            "156": [
                "job_buttons"
            ],
            "157": [
                "job_buttons"
            ],
            "158": [
                "job_buttons"
            ],
            "159": [
                "job_buttons"
            ],
            "160": [
                "job_buttons"
            ],
            "161": [
                "job_buttons"
            ],
            "162": [
                "job_buttons"
            ],
            "163": [
                "job_buttons"
            ],
            "164": [
                "job_buttons"
            ],
            "165": [
                "job_buttons"
            ],
            "166": [
                "job_buttons"
            ],
            "167": [
                "job_buttons"
            ],
            "168": [
                "job_buttons"
            ],
            "169": [
                "job_buttons"
            ],
            "170": [
                "job_buttons"
            ],
            "171": [
                "job_buttons"
            ],
            "172": [
                "job_buttons"
            ],
            "173": [
                "job_buttons"
            ],
            "174": [
                "job_buttons"
            ],
            "175": [
                "job_buttons"
            ],
            "176": [
                "job_buttons"
            ],
            "177": [
                "job_buttons"
            ],
            "178": [
                "job_buttons"
            ],
            "179": [
                "job_buttons"
            ],
            "180": [
                "job_buttons"
            ]
        },
        "addLocation": []
    },
    "nautobot/extras/tests/test_views.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 51,
                "afterPatchRowNumber": 51,
                "PatchRowcode": "     Tag,"
            },
            "1": {
                "beforePatchRowNumber": 52,
                "afterPatchRowNumber": 52,
                "PatchRowcode": "     Webhook,"
            },
            "2": {
                "beforePatchRowNumber": 53,
                "afterPatchRowNumber": 53,
                "PatchRowcode": " )"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 54,
                "PatchRowcode": "+from nautobot.extras.templatetags.job_buttons import NO_CONFIRM_BUTTON"
            },
            "4": {
                "beforePatchRowNumber": 54,
                "afterPatchRowNumber": 55,
                "PatchRowcode": " from nautobot.extras.tests.constants import BIG_GRAPHQL_DEVICE_QUERY"
            },
            "5": {
                "beforePatchRowNumber": 55,
                "afterPatchRowNumber": 56,
                "PatchRowcode": " from nautobot.extras.tests.test_relationships import RequiredRelationshipTestMixin"
            },
            "6": {
                "beforePatchRowNumber": 56,
                "afterPatchRowNumber": 57,
                "PatchRowcode": " from nautobot.extras.utils import RoleModelsQuery, TaggableClassesQuery"
            },
            "7": {
                "beforePatchRowNumber": 1995,
                "afterPatchRowNumber": 1996,
                "PatchRowcode": " "
            },
            "8": {
                "beforePatchRowNumber": 1996,
                "afterPatchRowNumber": 1997,
                "PatchRowcode": "     def setUp(self):"
            },
            "9": {
                "beforePatchRowNumber": 1997,
                "afterPatchRowNumber": 1998,
                "PatchRowcode": "         super().setUp()"
            },
            "10": {
                "beforePatchRowNumber": 1998,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.job_button = JobButton("
            },
            "11": {
                "beforePatchRowNumber": 1999,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            name=\"JobButton\","
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 1999,
                "PatchRowcode": "+        self.job_button_1 = JobButton("
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2000,
                "PatchRowcode": "+            name=\"JobButton 1\","
            },
            "14": {
                "beforePatchRowNumber": 2000,
                "afterPatchRowNumber": 2001,
                "PatchRowcode": "             text=\"JobButton {{ obj.name }}\","
            },
            "15": {
                "beforePatchRowNumber": 2001,
                "afterPatchRowNumber": 2002,
                "PatchRowcode": "             job=Job.objects.get(job_class_name=\"TestJobButtonReceiverSimple\"),"
            },
            "16": {
                "beforePatchRowNumber": 2002,
                "afterPatchRowNumber": 2003,
                "PatchRowcode": "             confirmation=False,"
            },
            "17": {
                "beforePatchRowNumber": 2003,
                "afterPatchRowNumber": 2004,
                "PatchRowcode": "         )"
            },
            "18": {
                "beforePatchRowNumber": 2004,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.job_button.validated_save()"
            },
            "19": {
                "beforePatchRowNumber": 2005,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.job_button.content_types.add(ContentType.objects.get_for_model(LocationType))"
            },
            "20": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2005,
                "PatchRowcode": "+        self.job_button_1.validated_save()"
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2006,
                "PatchRowcode": "+        self.job_button_1.content_types.add(ContentType.objects.get_for_model(LocationType))"
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2007,
                "PatchRowcode": "+"
            },
            "23": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2008,
                "PatchRowcode": "+        self.job_button_2 = JobButton("
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2009,
                "PatchRowcode": "+            name=\"JobButton 2\","
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2010,
                "PatchRowcode": "+            text=\"Click me!\","
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2011,
                "PatchRowcode": "+            job=Job.objects.get(job_class_name=\"TestJobButtonReceiverComplex\"),"
            },
            "27": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2012,
                "PatchRowcode": "+            confirmation=False,"
            },
            "28": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2013,
                "PatchRowcode": "+        )"
            },
            "29": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2014,
                "PatchRowcode": "+        self.job_button_2.validated_save()"
            },
            "30": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2015,
                "PatchRowcode": "+        self.job_button_2.content_types.add(ContentType.objects.get_for_model(LocationType))"
            },
            "31": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2016,
                "PatchRowcode": "+"
            },
            "32": {
                "beforePatchRowNumber": 2006,
                "afterPatchRowNumber": 2017,
                "PatchRowcode": "         self.location_type = LocationType.objects.get(name=\"Campus\")"
            },
            "33": {
                "beforePatchRowNumber": 2007,
                "afterPatchRowNumber": 2018,
                "PatchRowcode": " "
            },
            "34": {
                "beforePatchRowNumber": 2008,
                "afterPatchRowNumber": 2019,
                "PatchRowcode": "     def test_view_object_with_job_button(self):"
            },
            "35": {
                "beforePatchRowNumber": 2011,
                "afterPatchRowNumber": 2022,
                "PatchRowcode": "         self.assertEqual(response.status_code, 200)"
            },
            "36": {
                "beforePatchRowNumber": 2012,
                "afterPatchRowNumber": 2023,
                "PatchRowcode": "         content = extract_page_body(response.content.decode(response.charset))"
            },
            "37": {
                "beforePatchRowNumber": 2013,
                "afterPatchRowNumber": 2024,
                "PatchRowcode": "         self.assertIn(f\"JobButton {self.location_type.name}\", content, content)"
            },
            "38": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2025,
                "PatchRowcode": "+        self.assertIn(\"Click me!\", content, content)"
            },
            "39": {
                "beforePatchRowNumber": 2014,
                "afterPatchRowNumber": 2026,
                "PatchRowcode": " "
            },
            "40": {
                "beforePatchRowNumber": 2015,
                "afterPatchRowNumber": 2027,
                "PatchRowcode": "     def test_view_object_with_unsafe_text(self):"
            },
            "41": {
                "beforePatchRowNumber": 2016,
                "afterPatchRowNumber": 2028,
                "PatchRowcode": "         \"\"\"Ensure that JobButton text can't be used as a vector for XSS.\"\"\""
            },
            "42": {
                "beforePatchRowNumber": 2017,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.job_button.text = '<script>alert(\"Hello world!\")</script>'"
            },
            "43": {
                "beforePatchRowNumber": 2018,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.job_button.validated_save()"
            },
            "44": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2029,
                "PatchRowcode": "+        self.job_button_1.text = '<script>alert(\"Hello world!\")</script>'"
            },
            "45": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2030,
                "PatchRowcode": "+        self.job_button_1.validated_save()"
            },
            "46": {
                "beforePatchRowNumber": 2019,
                "afterPatchRowNumber": 2031,
                "PatchRowcode": "         response = self.client.get(self.location_type.get_absolute_url(), follow=True)"
            },
            "47": {
                "beforePatchRowNumber": 2020,
                "afterPatchRowNumber": 2032,
                "PatchRowcode": "         self.assertEqual(response.status_code, 200)"
            },
            "48": {
                "beforePatchRowNumber": 2021,
                "afterPatchRowNumber": 2033,
                "PatchRowcode": "         content = extract_page_body(response.content.decode(response.charset))"
            },
            "49": {
                "beforePatchRowNumber": 2022,
                "afterPatchRowNumber": 2034,
                "PatchRowcode": "         self.assertNotIn(\"<script>alert\", content, content)"
            },
            "50": {
                "beforePatchRowNumber": 2023,
                "afterPatchRowNumber": 2035,
                "PatchRowcode": "         self.assertIn(\"&lt;script&gt;alert\", content, content)"
            },
            "51": {
                "beforePatchRowNumber": 2024,
                "afterPatchRowNumber": 2036,
                "PatchRowcode": " "
            },
            "52": {
                "beforePatchRowNumber": 2025,
                "afterPatchRowNumber": 2037,
                "PatchRowcode": "         # Make sure grouped rendering is safe too"
            },
            "53": {
                "beforePatchRowNumber": 2026,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.job_button.group = '<script>alert(\"Goodbye\")</script>'"
            },
            "54": {
                "beforePatchRowNumber": 2027,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.job_button.validated_save()"
            },
            "55": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2038,
                "PatchRowcode": "+        self.job_button_1.group_name = '<script>alert(\"Goodbye\")</script>'"
            },
            "56": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2039,
                "PatchRowcode": "+        self.job_button_1.validated_save()"
            },
            "57": {
                "beforePatchRowNumber": 2028,
                "afterPatchRowNumber": 2040,
                "PatchRowcode": "         response = self.client.get(self.location_type.get_absolute_url(), follow=True)"
            },
            "58": {
                "beforePatchRowNumber": 2029,
                "afterPatchRowNumber": 2041,
                "PatchRowcode": "         self.assertEqual(response.status_code, 200)"
            },
            "59": {
                "beforePatchRowNumber": 2030,
                "afterPatchRowNumber": 2042,
                "PatchRowcode": "         content = extract_page_body(response.content.decode(response.charset))"
            },
            "60": {
                "beforePatchRowNumber": 2033,
                "afterPatchRowNumber": 2045,
                "PatchRowcode": " "
            },
            "61": {
                "beforePatchRowNumber": 2034,
                "afterPatchRowNumber": 2046,
                "PatchRowcode": "     def test_view_object_with_unsafe_name(self):"
            },
            "62": {
                "beforePatchRowNumber": 2035,
                "afterPatchRowNumber": 2047,
                "PatchRowcode": "         \"\"\"Ensure that JobButton names can't be used as a vector for XSS.\"\"\""
            },
            "63": {
                "beforePatchRowNumber": 2036,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.job_button.text = \"JobButton {{ obj\""
            },
            "64": {
                "beforePatchRowNumber": 2037,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.job_button.name = '<script>alert(\"Yo\")</script>'"
            },
            "65": {
                "beforePatchRowNumber": 2038,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.job_button.validated_save()"
            },
            "66": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2048,
                "PatchRowcode": "+        self.job_button_1.text = \"JobButton {{ obj\""
            },
            "67": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2049,
                "PatchRowcode": "+        self.job_button_1.name = '<script>alert(\"Yo\")</script>'"
            },
            "68": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2050,
                "PatchRowcode": "+        self.job_button_1.validated_save()"
            },
            "69": {
                "beforePatchRowNumber": 2039,
                "afterPatchRowNumber": 2051,
                "PatchRowcode": "         response = self.client.get(self.location_type.get_absolute_url(), follow=True)"
            },
            "70": {
                "beforePatchRowNumber": 2040,
                "afterPatchRowNumber": 2052,
                "PatchRowcode": "         self.assertEqual(response.status_code, 200)"
            },
            "71": {
                "beforePatchRowNumber": 2041,
                "afterPatchRowNumber": 2053,
                "PatchRowcode": "         content = extract_page_body(response.content.decode(response.charset))"
            },
            "72": {
                "beforePatchRowNumber": 2042,
                "afterPatchRowNumber": 2054,
                "PatchRowcode": "         self.assertNotIn(\"<script>alert\", content, content)"
            },
            "73": {
                "beforePatchRowNumber": 2043,
                "afterPatchRowNumber": 2055,
                "PatchRowcode": "         self.assertIn(\"&lt;script&gt;alert\", content, content)"
            },
            "74": {
                "beforePatchRowNumber": 2044,
                "afterPatchRowNumber": 2056,
                "PatchRowcode": " "
            },
            "75": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2057,
                "PatchRowcode": "+    def test_render_constrained_run_permissions(self):"
            },
            "76": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2058,
                "PatchRowcode": "+        obj_perm = ObjectPermission("
            },
            "77": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2059,
                "PatchRowcode": "+            name=\"Test permission\","
            },
            "78": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2060,
                "PatchRowcode": "+            constraints={\"pk\": self.job_button_1.job.pk},"
            },
            "79": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2061,
                "PatchRowcode": "+            actions=[\"run\"],"
            },
            "80": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2062,
                "PatchRowcode": "+        )"
            },
            "81": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2063,
                "PatchRowcode": "+        obj_perm.save()"
            },
            "82": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2064,
                "PatchRowcode": "+        obj_perm.users.add(self.user)"
            },
            "83": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2065,
                "PatchRowcode": "+        obj_perm.object_types.add(ContentType.objects.get_for_model(Job))"
            },
            "84": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2066,
                "PatchRowcode": "+"
            },
            "85": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2067,
                "PatchRowcode": "+        with self.subTest(\"Ungrouped buttons\"):"
            },
            "86": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2068,
                "PatchRowcode": "+            response = self.client.get(self.location_type.get_absolute_url(), follow=True)"
            },
            "87": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2069,
                "PatchRowcode": "+            self.assertEqual(response.status_code, 200)"
            },
            "88": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2070,
                "PatchRowcode": "+            content = extract_page_body(response.content.decode(response.charset))"
            },
            "89": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2071,
                "PatchRowcode": "+            self.assertInHTML("
            },
            "90": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2072,
                "PatchRowcode": "+                NO_CONFIRM_BUTTON.format("
            },
            "91": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2073,
                "PatchRowcode": "+                    button_id=self.job_button_1.pk,"
            },
            "92": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2074,
                "PatchRowcode": "+                    button_text=f\"JobButton {self.location_type.name}\","
            },
            "93": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2075,
                "PatchRowcode": "+                    button_class=self.job_button_1.button_class,"
            },
            "94": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2076,
                "PatchRowcode": "+                    disabled=\"\","
            },
            "95": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2077,
                "PatchRowcode": "+                ),"
            },
            "96": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2078,
                "PatchRowcode": "+                content,"
            },
            "97": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2079,
                "PatchRowcode": "+            )"
            },
            "98": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2080,
                "PatchRowcode": "+            self.assertInHTML("
            },
            "99": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2081,
                "PatchRowcode": "+                NO_CONFIRM_BUTTON.format("
            },
            "100": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2082,
                "PatchRowcode": "+                    button_id=self.job_button_2.pk,"
            },
            "101": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2083,
                "PatchRowcode": "+                    button_text=\"Click me!\","
            },
            "102": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2084,
                "PatchRowcode": "+                    button_class=self.job_button_2.button_class,"
            },
            "103": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2085,
                "PatchRowcode": "+                    disabled=\"disabled\","
            },
            "104": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2086,
                "PatchRowcode": "+                ),"
            },
            "105": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2087,
                "PatchRowcode": "+                content,"
            },
            "106": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2088,
                "PatchRowcode": "+            )"
            },
            "107": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2089,
                "PatchRowcode": "+"
            },
            "108": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2090,
                "PatchRowcode": "+        with self.subTest(\"Grouped buttons\"):"
            },
            "109": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2091,
                "PatchRowcode": "+            self.job_button_1.group_name = \"Grouping\""
            },
            "110": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2092,
                "PatchRowcode": "+            self.job_button_1.validated_save()"
            },
            "111": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2093,
                "PatchRowcode": "+            self.job_button_2.group_name = \"Grouping\""
            },
            "112": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2094,
                "PatchRowcode": "+            self.job_button_2.validated_save()"
            },
            "113": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2095,
                "PatchRowcode": "+"
            },
            "114": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2096,
                "PatchRowcode": "+            response = self.client.get(self.location_type.get_absolute_url(), follow=True)"
            },
            "115": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2097,
                "PatchRowcode": "+            self.assertEqual(response.status_code, 200)"
            },
            "116": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2098,
                "PatchRowcode": "+            content = extract_page_body(response.content.decode(response.charset))"
            },
            "117": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2099,
                "PatchRowcode": "+            self.assertInHTML("
            },
            "118": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2100,
                "PatchRowcode": "+                \"<li>\""
            },
            "119": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2101,
                "PatchRowcode": "+                + NO_CONFIRM_BUTTON.format("
            },
            "120": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2102,
                "PatchRowcode": "+                    button_id=self.job_button_1.pk,"
            },
            "121": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2103,
                "PatchRowcode": "+                    button_text=f\"JobButton {self.location_type.name}\","
            },
            "122": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2104,
                "PatchRowcode": "+                    button_class=\"link\","
            },
            "123": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2105,
                "PatchRowcode": "+                    disabled=\"\","
            },
            "124": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2106,
                "PatchRowcode": "+                )"
            },
            "125": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2107,
                "PatchRowcode": "+                + \"</li>\","
            },
            "126": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2108,
                "PatchRowcode": "+                content,"
            },
            "127": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2109,
                "PatchRowcode": "+            )"
            },
            "128": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2110,
                "PatchRowcode": "+            self.assertInHTML("
            },
            "129": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2111,
                "PatchRowcode": "+                \"<li>\""
            },
            "130": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2112,
                "PatchRowcode": "+                + NO_CONFIRM_BUTTON.format("
            },
            "131": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2113,
                "PatchRowcode": "+                    button_id=self.job_button_2.pk,"
            },
            "132": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2114,
                "PatchRowcode": "+                    button_text=\"Click me!\","
            },
            "133": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2115,
                "PatchRowcode": "+                    button_class=\"link\","
            },
            "134": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2116,
                "PatchRowcode": "+                    disabled=\"disabled\","
            },
            "135": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2117,
                "PatchRowcode": "+                )"
            },
            "136": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2118,
                "PatchRowcode": "+                + \"</li>\","
            },
            "137": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2119,
                "PatchRowcode": "+                content,"
            },
            "138": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2120,
                "PatchRowcode": "+            )"
            },
            "139": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2121,
                "PatchRowcode": "+"
            },
            "140": {
                "beforePatchRowNumber": 2045,
                "afterPatchRowNumber": 2122,
                "PatchRowcode": " "
            },
            "141": {
                "beforePatchRowNumber": 2046,
                "afterPatchRowNumber": 2123,
                "PatchRowcode": " # TODO: Convert to StandardTestCases.Views"
            },
            "142": {
                "beforePatchRowNumber": 2047,
                "afterPatchRowNumber": 2124,
                "PatchRowcode": " class ObjectChangeTestCase(TestCase):"
            }
        },
        "frontPatchFile": [
            "from datetime import timedelta",
            "import urllib.parse",
            "import uuid",
            "",
            "from django.contrib.auth import get_user_model",
            "from django.contrib.contenttypes.models import ContentType",
            "from django.core.exceptions import ValidationError",
            "from django.test import override_settings",
            "from django.urls import reverse",
            "from django.utils import timezone",
            "from django.utils.html import format_html",
            "from unittest import mock",
            "",
            "from nautobot.core.choices import ColorChoices",
            "from nautobot.core.models.fields import slugify_dashes_to_underscores",
            "from nautobot.core.testing import ViewTestCases, TestCase, extract_page_body, extract_form_failures",
            "from nautobot.core.testing.utils import disable_warnings, post_data",
            "from nautobot.dcim.models import ConsolePort, Device, DeviceType, Interface, Manufacturer, Location, LocationType",
            "from nautobot.dcim.tests import test_views",
            "from nautobot.extras.choices import (",
            "    CustomFieldTypeChoices,",
            "    JobExecutionType,",
            "    ObjectChangeActionChoices,",
            "    SecretsGroupAccessTypeChoices,",
            "    SecretsGroupSecretTypeChoices,",
            ")",
            "from nautobot.extras.constants import HTTP_CONTENT_TYPE_JSON",
            "from nautobot.extras.models import (",
            "    ComputedField,",
            "    ConfigContext,",
            "    ConfigContextSchema,",
            "    CustomField,",
            "    CustomLink,",
            "    DynamicGroup,",
            "    ExportTemplate,",
            "    GitRepository,",
            "    GraphQLQuery,",
            "    Job,",
            "    JobButton,",
            "    JobResult,",
            "    Note,",
            "    ObjectChange,",
            "    Relationship,",
            "    RelationshipAssociation,",
            "    Role,",
            "    ScheduledJob,",
            "    Secret,",
            "    SecretsGroup,",
            "    SecretsGroupAssociation,",
            "    Status,",
            "    Tag,",
            "    Webhook,",
            ")",
            "from nautobot.extras.tests.constants import BIG_GRAPHQL_DEVICE_QUERY",
            "from nautobot.extras.tests.test_relationships import RequiredRelationshipTestMixin",
            "from nautobot.extras.utils import RoleModelsQuery, TaggableClassesQuery",
            "from nautobot.ipam.models import IPAddress, Prefix, VLAN, VLANGroup",
            "from nautobot.users.models import ObjectPermission",
            "",
            "",
            "# Use the proper swappable User model",
            "User = get_user_model()",
            "",
            "",
            "class ComputedFieldTestCase(",
            "    ViewTestCases.BulkDeleteObjectsViewTestCase,",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "):",
            "    model = ComputedField",
            "    slug_source = \"label\"",
            "    slugify_function = staticmethod(slugify_dashes_to_underscores)",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        obj_type = ContentType.objects.get_for_model(Location)",
            "",
            "        computed_fields = (",
            "            ComputedField(",
            "                content_type=obj_type,",
            "                label=\"Computed Field One\",",
            "                key=\"computed_field_one\",",
            "                template=\"Location name is {{ obj.name }}\",",
            "                fallback_value=\"Template error\",",
            "                weight=100,",
            "            ),",
            "            ComputedField(",
            "                content_type=obj_type,",
            "                key=\"computed_field_two\",",
            "                label=\"Computed Field Two\",",
            "                template=\"Location name is {{ obj.name }}\",",
            "                fallback_value=\"Template error\",",
            "                weight=100,",
            "            ),",
            "            ComputedField(",
            "                content_type=obj_type,",
            "                key=\"computed_field_three\",",
            "                label=\"Computed Field Three\",",
            "                template=\"Location name is {{ obj.name }}\",",
            "                weight=100,",
            "            ),",
            "            ComputedField(",
            "                content_type=obj_type,",
            "                label=\"Computed Field Five\",",
            "                template=\"Location name is {{ obj.name }}\",",
            "                fallback_value=\"Template error\",",
            "                weight=100,",
            "            ),",
            "        )",
            "        cls.location_type = LocationType.objects.get(name=\"Campus\")",
            "        status = Status.objects.get_for_model(Location).first()",
            "        cls.location1 = Location(name=\"NYC\", location_type=cls.location_type, status=status)",
            "        cls.location1.save()",
            "",
            "        for cf in computed_fields:",
            "            cf.save()",
            "",
            "        cls.form_data = {",
            "            \"content_type\": obj_type.pk,",
            "            \"key\": \"computed_field_four\",",
            "            \"label\": \"Computed Field Four\",",
            "            \"template\": \"{{ obj.name }} is the best Location!\",",
            "            \"fallback_value\": \":skull_emoji:\",",
            "            \"weight\": 100,",
            "        }",
            "",
            "        cls.slug_test_object = \"Computed Field Five\"",
            "",
            "",
            "class ComputedFieldRenderingTestCase(TestCase):",
            "    \"\"\"Tests for the inclusion of ComputedFields, distinct from tests of the ComputedField views themselves.\"\"\"",
            "",
            "    user_permissions = [\"dcim.view_locationtype\"]",
            "",
            "    def setUp(self):",
            "        super().setUp()",
            "        self.computedfield = ComputedField(",
            "            content_type=ContentType.objects.get_for_model(LocationType),",
            "            key=\"test\",",
            "            label=\"Computed Field\",",
            "            template=\"FOO {{ obj.name }} BAR\",",
            "            fallback_value=\"Fallback Value\",",
            "            weight=100,",
            "        )",
            "        self.computedfield.validated_save()",
            "        self.location_type = LocationType.objects.get(name=\"Campus\")",
            "",
            "    def test_view_object_with_computed_field(self):",
            "        \"\"\"Ensure that the computed field template is rendered.\"\"\"",
            "        response = self.client.get(self.location_type.get_absolute_url(), follow=True)",
            "        self.assertEqual(response.status_code, 200)",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "        self.assertIn(f\"FOO {self.location_type.name} BAR\", content, content)",
            "",
            "    def test_view_object_with_computed_field_fallback_value(self):",
            "        \"\"\"Ensure that the fallback_value is rendered if the template fails to render.\"\"\"",
            "        # Make the template invalid to demonstrate the fallback value",
            "        self.computedfield.template = \"FOO {{ obj.\"",
            "        self.computedfield.validated_save()",
            "        response = self.client.get(self.location_type.get_absolute_url(), follow=True)",
            "        self.assertEqual(response.status_code, 200)",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "        self.assertIn(\"Fallback Value\", content, content)",
            "",
            "    def test_view_object_with_computed_field_unsafe_template(self):",
            "        \"\"\"Ensure that computed field templates can't be used as an XSS vector.\"\"\"",
            "        self.computedfield.template = '<script>alert(\"Hello world!\"</script>'",
            "        self.computedfield.validated_save()",
            "        response = self.client.get(self.location_type.get_absolute_url(), follow=True)",
            "        self.assertEqual(response.status_code, 200)",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "        self.assertNotIn(\"<script>alert\", content, content)",
            "        self.assertIn(\"&lt;script&gt;alert\", content, content)",
            "",
            "    def test_view_object_with_computed_field_unsafe_fallback_value(self):",
            "        \"\"\"Ensure that computed field fallback values can't be used as an XSS vector.\"\"\"",
            "        self.computedfield.template = \"FOO {{ obj.\"",
            "        self.computedfield.fallback_value = '<script>alert(\"Hello world!\"</script>'",
            "        self.computedfield.validated_save()",
            "        response = self.client.get(self.location_type.get_absolute_url(), follow=True)",
            "        self.assertEqual(response.status_code, 200)",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "        self.assertNotIn(\"<script>alert\", content, content)",
            "        self.assertIn(\"&lt;script&gt;alert\", content, content)",
            "",
            "",
            "# TODO: Change base class to PrimaryObjectViewTestCase",
            "# Blocked by absence of standard create/edit, bulk create views",
            "class ConfigContextTestCase(",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "    ViewTestCases.BulkEditObjectsViewTestCase,",
            "    ViewTestCases.BulkDeleteObjectsViewTestCase,",
            "):",
            "    model = ConfigContext",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        location = Location.objects.filter(location_type=LocationType.objects.get(name=\"Campus\")).first()",
            "",
            "        # Create three ConfigContexts",
            "        for i in range(1, 4):",
            "            configcontext = ConfigContext(name=f\"Config Context {i}\", data={\"foo\": i})",
            "            configcontext.save()",
            "            configcontext.locations.add(location)",
            "",
            "        cls.form_data = {",
            "            \"name\": \"Config Context X\",",
            "            \"weight\": 200,",
            "            \"description\": \"A new config context\",",
            "            \"is_active\": True,",
            "            \"regions\": [],",
            "            \"locations\": [location.pk],",
            "            \"roles\": [],",
            "            \"device_types\": [],",
            "            \"platforms\": [],",
            "            \"tenant_groups\": [],",
            "            \"tenants\": [],",
            "            \"tags\": [],",
            "            \"data\": '{\"foo\": 123}',",
            "        }",
            "",
            "        cls.bulk_edit_data = {",
            "            \"weight\": 300,",
            "            \"is_active\": False,",
            "            \"description\": \"New description\",",
            "        }",
            "",
            "    def test_schema_validation_pass(self):",
            "        \"\"\"",
            "        Given a config context schema",
            "        And a config context that conforms to that schema",
            "        Assert that the config context passes schema validation via full_clean()",
            "        \"\"\"",
            "        schema = ConfigContextSchema.objects.create(",
            "            name=\"Schema 1\", data_schema={\"type\": \"object\", \"properties\": {\"foo\": {\"type\": \"string\"}}}",
            "        )",
            "        self.add_permissions(\"extras.add_configcontext\")",
            "        self.add_permissions(\"extras.view_configcontextschema\")",
            "",
            "        form_data = {",
            "            \"name\": \"Config Context with schema\",",
            "            \"weight\": 200,",
            "            \"description\": \"A new config context\",",
            "            \"is_active\": True,",
            "            \"regions\": [],",
            "            \"locations\": [],",
            "            \"roles\": [],",
            "            \"device_types\": [],",
            "            \"platforms\": [],",
            "            \"tenant_groups\": [],",
            "            \"tenants\": [],",
            "            \"tags\": [],",
            "            \"data\": '{\"foo\": \"bar\"}',",
            "            \"config_context_schema\": schema.pk,",
            "        }",
            "",
            "        # Try POST with model-level permission",
            "        request = {",
            "            \"path\": self._get_url(\"add\"),",
            "            \"data\": post_data(form_data),",
            "        }",
            "        self.assertHttpStatus(self.client.post(**request), 302)",
            "        self.assertEqual(",
            "            self._get_queryset().get(name=\"Config Context with schema\").config_context_schema.pk, schema.pk",
            "        )",
            "",
            "    def test_schema_validation_fails(self):",
            "        \"\"\"",
            "        Given a config context schema",
            "        And a config context that *does not* conform to that schema",
            "        Assert that the config context fails schema validation via full_clean()",
            "        \"\"\"",
            "        schema = ConfigContextSchema.objects.create(",
            "            name=\"Schema 1\", data_schema={\"type\": \"object\", \"properties\": {\"foo\": {\"type\": \"integer\"}}}",
            "        )",
            "        self.add_permissions(\"extras.add_configcontext\")",
            "        self.add_permissions(\"extras.view_configcontextschema\")",
            "",
            "        form_data = {",
            "            \"name\": \"Config Context with bad schema\",",
            "            \"weight\": 200,",
            "            \"description\": \"A new config context\",",
            "            \"is_active\": True,",
            "            \"regions\": [],",
            "            \"locations\": [],",
            "            \"roles\": [],",
            "            \"device_types\": [],",
            "            \"platforms\": [],",
            "            \"tenant_groups\": [],",
            "            \"tenants\": [],",
            "            \"tags\": [],",
            "            \"data\": '{\"foo\": \"bar\"}',",
            "            \"config_context_schema\": schema.pk,",
            "        }",
            "",
            "        # Try POST with model-level permission",
            "        request = {",
            "            \"path\": self._get_url(\"add\"),",
            "            \"data\": post_data(form_data),",
            "        }",
            "        self.assertHttpStatus(self.client.post(**request), 200)",
            "        self.assertEqual(self._get_queryset().filter(name=\"Config Context with schema\").count(), 0)",
            "",
            "",
            "# This OrganizationalObjectViewTestCase less BulkImportObjectsViewTestCase",
            "# because it doesn't make sense to support CSV for schemas.",
            "class ConfigContextSchemaTestCase(",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "    ViewTestCases.BulkDeleteObjectsViewTestCase,",
            "    ViewTestCases.BulkEditObjectsViewTestCase,",
            "):",
            "    model = ConfigContextSchema",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        # Create three ConfigContextSchema records",
            "        ConfigContextSchema.objects.create(",
            "            name=\"Schema 1\", data_schema={\"type\": \"object\", \"properties\": {\"foo\": {\"type\": \"string\"}}}",
            "        )",
            "        ConfigContextSchema.objects.create(",
            "            name=\"Schema 2\", data_schema={\"type\": \"object\", \"properties\": {\"bar\": {\"type\": \"string\"}}}",
            "        )",
            "        ConfigContextSchema.objects.create(",
            "            name=\"Schema 3\", data_schema={\"type\": \"object\", \"properties\": {\"baz\": {\"type\": \"string\"}}}",
            "        )",
            "        ConfigContextSchema.objects.create(",
            "            name=\"Schema 4\", data_schema={\"type\": \"object\", \"properties\": {\"baz\": {\"type\": \"string\"}}}",
            "        )",
            "",
            "        cls.form_data = {",
            "            \"name\": \"Schema X\",",
            "            \"data_schema\": '{\"type\": \"object\",\"properties\": {\"baz\": {\"type\": \"string\"}}}',  # Intentionally misformatted (missing space) to ensure proper formatting on output",
            "        }",
            "",
            "        cls.bulk_edit_data = {",
            "            \"description\": \"New description\",",
            "        }",
            "",
            "",
            "class CustomLinkTestCase(",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "):",
            "    model = CustomLink",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        obj_type = ContentType.objects.get_for_model(Location)",
            "",
            "        customlinks = (",
            "            CustomLink(",
            "                content_type=obj_type,",
            "                name=\"customlink-1\",",
            "                text=\"customlink text 1\",",
            "                target_url=\"http://customlink1.com\",",
            "                weight=100,",
            "                button_class=\"default\",",
            "                new_window=False,",
            "            ),",
            "            CustomLink(",
            "                content_type=obj_type,",
            "                name=\"customlink-2\",",
            "                text=\"customlink text 2\",",
            "                target_url=\"http://customlink2.com\",",
            "                weight=100,",
            "                button_class=\"default\",",
            "                new_window=False,",
            "            ),",
            "            CustomLink(",
            "                content_type=obj_type,",
            "                name=\"customlink-3\",",
            "                text=\"customlink text 3\",",
            "                target_url=\"http://customlink3.com\",",
            "                weight=100,",
            "                button_class=\"default\",",
            "                new_window=False,",
            "            ),",
            "        )",
            "",
            "        for link in customlinks:",
            "            link.save()",
            "",
            "        cls.form_data = {",
            "            \"content_type\": obj_type.pk,",
            "            \"name\": \"customlink-4\",",
            "            \"text\": \"customlink text 4\",",
            "            \"target_url\": \"http://customlink4.com\",",
            "            \"weight\": 100,",
            "            \"button_class\": \"default\",",
            "            \"new_window\": False,",
            "        }",
            "",
            "",
            "class CustomFieldTestCase(",
            "    # No NotesViewTestCase or BulkImportObjectsViewTestCase, at least for now",
            "    ViewTestCases.BulkDeleteObjectsViewTestCase,",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "):",
            "    model = CustomField",
            "    slugify_function = staticmethod(slugify_dashes_to_underscores)",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        obj_type = ContentType.objects.get_for_model(Location)",
            "",
            "        custom_fields = [",
            "            CustomField(",
            "                type=CustomFieldTypeChoices.TYPE_BOOLEAN,",
            "                label=\"Custom Field Boolean Type\",",
            "                default=\"\",",
            "            ),",
            "            CustomField(",
            "                type=CustomFieldTypeChoices.TYPE_TEXT,",
            "                label=\"Custom Field Text\",",
            "                default=\"\",",
            "            ),",
            "            CustomField(",
            "                type=CustomFieldTypeChoices.TYPE_INTEGER,",
            "                label=\"Custom Field Integer\",",
            "                default=\"\",",
            "            ),",
            "            CustomField(",
            "                type=CustomFieldTypeChoices.TYPE_TEXT,",
            "                # https://github.com/nautobot/nautobot/issues/1962",
            "                label=\"Custom field? With special / unusual characters!\",",
            "                default=\"\",",
            "            ),",
            "        ]",
            "",
            "        cls.slug_test_object = \"Custom Field Integer\"",
            "",
            "        for custom_field in custom_fields:",
            "            custom_field.validated_save()",
            "            custom_field.content_types.set([obj_type])",
            "",
            "        cls.form_data = {",
            "            \"content_types\": [obj_type.pk],",
            "            \"type\": CustomFieldTypeChoices.TYPE_BOOLEAN,  # type is mandatory but cannot be changed once set.",
            "            \"key\": \"custom_field_boolean_type\",  # key is mandatory but cannot be changed once set.",
            "            \"label\": \"Custom Field Boolean\",",
            "            \"default\": None,",
            "            \"filter_logic\": \"loose\",",
            "            \"weight\": 100,",
            "            # These are the \"management_form\" fields required by the dynamic CustomFieldChoice formsets.",
            "            \"custom_field_choices-TOTAL_FORMS\": \"0\",  # Set to 0 so validation succeeds until we need it",
            "            \"custom_field_choices-INITIAL_FORMS\": \"1\",",
            "            \"custom_field_choices-MIN_NUM_FORMS\": \"0\",",
            "            \"custom_field_choices-MAX_NUM_FORMS\": \"1000\",",
            "        }",
            "",
            "    def test_create_object_without_permission(self):",
            "        # Can't have two CustomFields with the same \"key\"",
            "        self.form_data = self.form_data.copy()",
            "        self.form_data[\"key\"] = \"custom_field_boolean_2\"",
            "        super().test_create_object_without_permission()",
            "",
            "    def test_create_object_with_permission(self):",
            "        # Can't have two CustomFields with the same \"key\"",
            "        self.form_data = self.form_data.copy()",
            "        self.form_data[\"key\"] = \"custom_field_boolean_2\"",
            "        super().test_create_object_with_permission()",
            "",
            "    def test_create_object_with_constrained_permission(self):",
            "        # Can't have two CustomFields with the same \"key\"",
            "        self.form_data = self.form_data.copy()",
            "        self.form_data[\"key\"] = \"custom_field_boolean_2\"",
            "        super().test_create_object_with_constrained_permission()",
            "",
            "",
            "class CustomLinkRenderingTestCase(TestCase):",
            "    \"\"\"Tests for the inclusion of CustomLinks, distinct from tests of the CustomLink views themselves.\"\"\"",
            "",
            "    user_permissions = [\"dcim.view_location\"]",
            "",
            "    def test_view_object_with_custom_link(self):",
            "        customlink = CustomLink(",
            "            content_type=ContentType.objects.get_for_model(Location),",
            "            name=\"Test\",",
            "            text=\"FOO {{ obj.name }} BAR\",",
            "            target_url=\"http://example.com/?location={{ obj.name }}\",",
            "            new_window=False,",
            "        )",
            "        customlink.save()",
            "        location_type = LocationType.objects.get(name=\"Campus\")",
            "        status = Status.objects.get_for_model(Location).first()",
            "        location = Location(name=\"Test Location\", location_type=location_type, status=status)",
            "        location.save()",
            "",
            "        response = self.client.get(location.get_absolute_url(), follow=True)",
            "        self.assertEqual(response.status_code, 200)",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "        self.assertIn(f\"FOO {location.name} BAR\", content, content)",
            "",
            "    def test_view_object_with_unsafe_custom_link_text(self):",
            "        \"\"\"Ensure that custom links can't be used as a vector for injecting scripts or breaking HTML.\"\"\"",
            "        customlink = CustomLink(",
            "            content_type=ContentType.objects.get_for_model(Location),",
            "            name=\"Test\",",
            "            text='<script>alert(\"Hello world!\")</script>',",
            "            target_url=\"http://example.com/?location=None\",",
            "            new_window=False,",
            "        )",
            "        customlink.validated_save()",
            "        location_type = LocationType.objects.get(name=\"Campus\")",
            "        status = Status.objects.get_for_model(Location).first()",
            "        location = Location(name=\"Test Location\", location_type=location_type, status=status)",
            "        location.save()",
            "",
            "        response = self.client.get(location.get_absolute_url(), follow=True)",
            "        self.assertEqual(response.status_code, 200)",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "        self.assertNotIn(\"<script>alert\", content, content)",
            "        self.assertIn(\"&lt;script&gt;alert\", content, content)",
            "        self.assertIn(format_html('<a href=\"{}\"', customlink.target_url), content, content)",
            "",
            "    def test_view_object_with_unsafe_custom_link_url(self):",
            "        \"\"\"Ensure that custom links can't be used as a vector for injecting scripts or breaking HTML.\"\"\"",
            "        customlink = CustomLink(",
            "            content_type=ContentType.objects.get_for_model(Location),",
            "            name=\"Test\",",
            "            text=\"Hello\",",
            "            target_url='\"><script>alert(\"Hello world!\")</script><a href=\"',",
            "            new_window=False,",
            "        )",
            "        customlink.validated_save()",
            "        location_type = LocationType.objects.get(name=\"Campus\")",
            "        status = Status.objects.get_for_model(Location).first()",
            "        location = Location(name=\"Test Location\", location_type=location_type, status=status)",
            "        location.save()",
            "",
            "        response = self.client.get(location.get_absolute_url(), follow=True)",
            "        self.assertEqual(response.status_code, 200)",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "        self.assertNotIn(\"<script>alert\", content, content)",
            "        self.assertIn(\"&lt;script&gt;alert\", content, content)",
            "        self.assertIn(format_html('<a href=\"{}\"', customlink.target_url), content, content)",
            "",
            "    def test_view_object_with_unsafe_custom_link_name(self):",
            "        \"\"\"Ensure that custom links can't be used as a vector for injecting scripts or breaking HTML.\"\"\"",
            "        customlink = CustomLink(",
            "            content_type=ContentType.objects.get_for_model(Location),",
            "            name='<script>alert(\"Hello World\")</script>',",
            "            text=\"Hello\",",
            "            target_url=\"http://example.com/?location={{ obj.name \",  # intentionally bad jinja2 to trigger error case",
            "            new_window=False,",
            "        )",
            "        customlink.validated_save()",
            "        location_type = LocationType.objects.get(name=\"Campus\")",
            "        status = Status.objects.get_for_model(Location).first()",
            "        location = Location(name=\"Test Location\", location_type=location_type, status=status)",
            "        location.save()",
            "",
            "        response = self.client.get(location.get_absolute_url(), follow=True)",
            "        self.assertEqual(response.status_code, 200)",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "        self.assertNotIn(\"<script>alert\", content, content)",
            "        self.assertIn(\"&lt;script&gt;alert\", content, content)",
            "",
            "",
            "class DynamicGroupTestCase(",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "    ViewTestCases.BulkDeleteObjectsViewTestCase,",
            "    # NOTE: This isn't using `ViewTestCases.PrimaryObjectViewTestCase` because bulk-import/edit",
            "    # views for DynamicGroup do not make sense at this time, primarily because `content_type` is",
            "    # immutable after create.",
            "):",
            "    model = DynamicGroup",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        content_type = ContentType.objects.get_for_model(Device)",
            "",
            "        # DynamicGroup objects to test.",
            "        DynamicGroup.objects.create(name=\"DG 1\", content_type=content_type)",
            "        DynamicGroup.objects.create(name=\"DG 2\", content_type=content_type)",
            "        DynamicGroup.objects.create(name=\"DG 3\", content_type=content_type)",
            "",
            "        cls.form_data = {",
            "            \"name\": \"new_dynamic_group\",",
            "            \"description\": \"I am a new dynamic group object.\",",
            "            \"content_type\": content_type.pk,",
            "            # Management form fields required for the dynamic formset",
            "            \"dynamic_group_memberships-TOTAL_FORMS\": \"0\",",
            "            \"dynamic_group_memberships-INITIAL_FORMS\": \"1\",",
            "            \"dynamic_group_memberships-MIN_NUM_FORMS\": \"0\",",
            "            \"dynamic_group_memberships-MAX_NUM_FORMS\": \"1000\",",
            "        }",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[\"*\"])",
            "    def test_edit_saved_filter(self):",
            "        \"\"\"Test that editing a filter works using the edit view.\"\"\"",
            "        self.add_permissions(\"extras.add_dynamicgroup\", \"extras.change_dynamicgroup\")",
            "",
            "        # Create the object first.",
            "        data = self.form_data.copy()",
            "        request = {",
            "            \"path\": self._get_url(\"add\"),",
            "            \"data\": post_data(data),",
            "        }",
            "        self.assertHttpStatus(self.client.post(**request), 302)",
            "",
            "        # Now update it.",
            "        instance = self._get_queryset().get(name=data[\"name\"])",
            "        data[\"filter-serial\"] = [\"abc123\"]",
            "        request = {",
            "            \"path\": self._get_url(\"edit\", instance),",
            "            \"data\": post_data(data),",
            "        }",
            "        self.assertHttpStatus(self.client.post(**request), 302)",
            "",
            "        instance.refresh_from_db()",
            "        self.assertEqual(instance.filter, {\"serial\": data[\"filter-serial\"]})",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[\"*\"])",
            "    def test_filter_by_content_type(self):",
            "        \"\"\"",
            "        Test that filtering by `content_type` in the UI succeeds.",
            "",
            "        This is a regression test for https://github.com/nautobot/nautobot/issues/3612",
            "        \"\"\"",
            "        path = self._get_url(\"list\")",
            "        response = self.client.get(path + \"?content_type=dcim.device\")",
            "        self.assertHttpStatus(response, 200)",
            "",
            "",
            "class ExportTemplateTestCase(",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "):",
            "    model = ExportTemplate",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        obj_type = ContentType.objects.get_for_model(Location)",
            "",
            "        templates = (",
            "            ExportTemplate(",
            "                name=\"template-1\",",
            "                template_code=\"template-1 test1\",",
            "                content_type=obj_type,",
            "            ),",
            "            ExportTemplate(",
            "                name=\"template-2\",",
            "                template_code=\"template-2 test2\",",
            "                content_type=obj_type,",
            "            ),",
            "            ExportTemplate(",
            "                name=\"template-3\",",
            "                template_code=\"template-3 test3\",",
            "                content_type=obj_type,",
            "            ),",
            "        )",
            "",
            "        for template in templates:",
            "            template.save()",
            "",
            "        cls.form_data = {",
            "            \"name\": \"template-4\",",
            "            \"content_type\": obj_type.pk,",
            "            \"template_code\": \"template-4 test4\",",
            "        }",
            "",
            "",
            "class GitRepositoryTestCase(",
            "    ViewTestCases.BulkDeleteObjectsViewTestCase,",
            "    ViewTestCases.BulkImportObjectsViewTestCase,",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "):",
            "    model = GitRepository",
            "    slugify_function = staticmethod(slugify_dashes_to_underscores)",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        secrets_groups = (",
            "            SecretsGroup.objects.create(name=\"Secrets Group 1\"),",
            "            SecretsGroup.objects.create(name=\"Secrets Group 2\"),",
            "        )",
            "",
            "        # Create four GitRepository records",
            "        repos = (",
            "            GitRepository(name=\"Repo 1\", slug=\"repo_1\", remote_url=\"https://example.com/repo1.git\"),",
            "            GitRepository(name=\"Repo 2\", slug=\"repo_2\", remote_url=\"https://example.com/repo2.git\"),",
            "            GitRepository(name=\"Repo 3\", slug=\"repo_3\", remote_url=\"https://example.com/repo3.git\"),",
            "            GitRepository(name=\"Repo 4\", remote_url=\"https://example.com/repo4.git\", secrets_group=secrets_groups[0]),",
            "        )",
            "        for repo in repos:",
            "            repo.validated_save()",
            "",
            "        cls.form_data = {",
            "            \"name\": \"A new Git repository\",",
            "            \"slug\": \"a_new_git_repository\",",
            "            \"remote_url\": \"http://example.com/a_new_git_repository.git\",",
            "            \"branch\": \"develop\",",
            "            \"_token\": \"1234567890abcdef1234567890abcdef\",",
            "            \"secrets_group\": secrets_groups[1].pk,",
            "            \"provided_contents\": [",
            "                \"extras.configcontext\",",
            "                \"extras.job\",",
            "                \"extras.exporttemplate\",",
            "            ],",
            "        }",
            "",
            "        cls.csv_data = (",
            "            \"name,slug,remote_url,branch,secrets_group,provided_contents\",",
            "            \"Git Repository 5,git_repo_5,https://example.com,main,,extras.configcontext\",",
            "            \"Git Repository 6,git_repo_6,https://example.com,develop,Secrets Group 2,\",",
            "            'Git Repository 7,git_repo_7,https://example.com,next,Secrets Group 2,\"extras.job,extras.configcontext\"',",
            "        )",
            "",
            "        cls.slug_source = \"name\"",
            "        cls.slug_test_object = \"Repo 4\"",
            "",
            "    def test_edit_object_with_permission(self):",
            "        instance = self._get_queryset().first()",
            "        form_data = self.form_data.copy()",
            "        form_data[\"slug\"] = instance.slug  # Slug is not editable",
            "        self.form_data = form_data",
            "        super().test_edit_object_with_permission()",
            "",
            "    def test_edit_object_with_constrained_permission(self):",
            "        instance = self._get_queryset().first()",
            "        form_data = self.form_data.copy()",
            "        form_data[\"slug\"] = instance.slug  # Slug is not editable",
            "        self.form_data = form_data",
            "        super().test_edit_object_with_constrained_permission()",
            "",
            "",
            "class NoteTestCase(",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "):",
            "    model = Note",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        content_type = ContentType.objects.get_for_model(Location)",
            "        cls.location = Location.objects.filter(location_type=LocationType.objects.get(name=\"Campus\")).first()",
            "        user = User.objects.first()",
            "",
            "        # Notes Objects to test",
            "        Note.objects.create(",
            "            note=\"Location has been placed on maintenance.\",",
            "            user=user,",
            "            assigned_object_type=content_type,",
            "            assigned_object_id=cls.location.pk,",
            "        )",
            "        Note.objects.create(",
            "            note=\"Location maintenance has ended.\",",
            "            user=user,",
            "            assigned_object_type=content_type,",
            "            assigned_object_id=cls.location.pk,",
            "        )",
            "        Note.objects.create(",
            "            note=\"Location is under duress.\",",
            "            user=user,",
            "            assigned_object_type=content_type,",
            "            assigned_object_id=cls.location.pk,",
            "        )",
            "",
            "        cls.form_data = {",
            "            \"note\": \"This is Location note.\",",
            "            \"assigned_object_type\": content_type.pk,",
            "            \"assigned_object_id\": cls.location.pk,",
            "        }",
            "        cls.expected_object_note = '<textarea name=\"object_note\" cols=\"40\" rows=\"10\" class=\"form-control\" placeholder=\"Note\" id=\"id_object_note\"></textarea>'",
            "",
            "    def test_note_on_bulk_update_perms(self):",
            "        self.add_permissions(\"dcim.add_location\", \"extras.add_note\")",
            "        response = self.client.get(reverse(\"dcim:location_add\"))",
            "        self.assertContains(response, self.expected_object_note, html=True)",
            "",
            "    def test_note_on_bulk_update_no_perms(self):",
            "        self.add_permissions(\"dcim.add_location\")",
            "        response = self.client.get(reverse(\"dcim:location_add\"))",
            "        self.assertNotContains(response, self.expected_object_note, html=True)",
            "",
            "    def test_note_on_create_edit_perms(self):",
            "        self.add_permissions(\"dcim.change_location\", \"extras.add_note\")",
            "        response = self.client.post(reverse(\"dcim:location_bulk_edit\"), data={\"pk\": self.location.pk})",
            "        self.assertContains(response, self.expected_object_note, html=True)",
            "",
            "    def test_note_on_create_edit_no_perms(self):",
            "        self.add_permissions(\"dcim.change_location\")",
            "        response = self.client.post(reverse(\"dcim:location_bulk_edit\"), data={\"pk\": self.location.pk})",
            "        self.assertNotContains(response, self.expected_object_note, html=True)",
            "",
            "",
            "# Not a full-fledged PrimaryObjectViewTestCase as there's no BulkEditView for Secrets",
            "class SecretTestCase(",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "    ViewTestCases.BulkImportObjectsViewTestCase,",
            "    ViewTestCases.BulkDeleteObjectsViewTestCase,",
            "):",
            "    model = Secret",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        secrets = (",
            "            Secret(",
            "                name=\"View Test 1\",",
            "                provider=\"environment-variable\",",
            "                parameters={\"variable\": \"VIEW_TEST_1\"},",
            "                tags=[t.pk for t in Tag.objects.get_for_model(Secret)],",
            "            ),",
            "            Secret(",
            "                name=\"View Test 2\",",
            "                provider=\"environment-variable\",",
            "                parameters={\"variable\": \"VIEW_TEST_2\"},",
            "            ),",
            "            Secret(",
            "                name=\"View Test 3\",",
            "                provider=\"environment-variable\",",
            "                parameters={\"variable\": \"VIEW_TEST_3\"},",
            "            ),",
            "        )",
            "",
            "        for secret in secrets:",
            "            secret.validated_save()",
            "",
            "        cls.form_data = {",
            "            \"name\": \"View Test 4\",",
            "            \"provider\": \"environment-variable\",",
            "            \"parameters\": '{\"variable\": \"VIEW_TEST_4\"}',",
            "        }",
            "",
            "        cls.csv_data = (",
            "            \"name,provider,parameters\",",
            "            'View Test 5,environment-variable,{\"variable\": \"VIEW_TEST_5\"}',",
            "            'View Test 6,environment-variable,{\"variable\": \"VIEW_TEST_6\"}',",
            "            'View Test 7,environment-variable,{\"variable\": \"VIEW_TEST_7\"}',",
            "        )",
            "",
            "",
            "# Not a full-fledged OrganizationalObjectViewTestCase as there's no BulkImportView for SecretsGroups",
            "class SecretsGroupTestCase(",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "    ViewTestCases.BulkDeleteObjectsViewTestCase,",
            "):",
            "    model = SecretsGroup",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        secrets_groups = (",
            "            SecretsGroup.objects.create(name=\"Group 1\", description=\"First Group\"),",
            "            SecretsGroup.objects.create(name=\"Group 2\"),",
            "            SecretsGroup.objects.create(name=\"Group 3\"),",
            "        )",
            "",
            "        secrets = (",
            "            Secret.objects.create(name=\"secret 1\", provider=\"text-file\", parameters={\"path\": \"/tmp\"}),",
            "            Secret.objects.create(name=\"secret 2\", provider=\"text-file\", parameters={\"path\": \"/tmp\"}),",
            "            Secret.objects.create(name=\"secret 3\", provider=\"text-file\", parameters={\"path\": \"/tmp\"}),",
            "        )",
            "",
            "        SecretsGroupAssociation.objects.create(",
            "            secrets_group=secrets_groups[0],",
            "            secret=secrets[0],",
            "            access_type=SecretsGroupAccessTypeChoices.TYPE_GENERIC,",
            "            secret_type=SecretsGroupSecretTypeChoices.TYPE_USERNAME,",
            "        )",
            "        SecretsGroupAssociation.objects.create(",
            "            secrets_group=secrets_groups[0],",
            "            secret=secrets[1],",
            "            access_type=SecretsGroupAccessTypeChoices.TYPE_GENERIC,",
            "            secret_type=SecretsGroupSecretTypeChoices.TYPE_PASSWORD,",
            "        )",
            "        SecretsGroupAssociation.objects.create(",
            "            secrets_group=secrets_groups[1],",
            "            secret=secrets[1],",
            "            access_type=SecretsGroupAccessTypeChoices.TYPE_GENERIC,",
            "            secret_type=SecretsGroupSecretTypeChoices.TYPE_PASSWORD,",
            "        )",
            "",
            "        cls.form_data = {",
            "            \"name\": \"Group 4\",",
            "            \"description\": \"Some description\",",
            "            # Management form fields required for the dynamic Secret formset",
            "            \"secrets_group_associations-TOTAL_FORMS\": \"0\",",
            "            \"secrets_group_associations-INITIAL_FORMS\": \"1\",",
            "            \"secrets_group_associations-MIN_NUM_FORMS\": \"0\",",
            "            \"secrets_group_associations-MAX_NUM_FORMS\": \"1000\",",
            "        }",
            "",
            "",
            "class GraphQLQueriesTestCase(",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "):",
            "    model = GraphQLQuery",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        graphqlqueries = (",
            "            GraphQLQuery(",
            "                name=\"graphql-query-1\",",
            "                query=\"{ query: locations {name} }\",",
            "            ),",
            "            GraphQLQuery(",
            "                name=\"graphql-query-2\",",
            "                query='{ devices(role: \"edge\") { id, name, device_role { name } } }',",
            "            ),",
            "            GraphQLQuery(",
            "                name=\"graphql-query-3\",",
            "                query=BIG_GRAPHQL_DEVICE_QUERY,",
            "            ),",
            "            GraphQLQuery(",
            "                name=\"Graphql Query 5\",",
            "                query='{ devices(role: \"edge\") { id, name, device_role { name } } }',",
            "            ),",
            "        )",
            "",
            "        for query in graphqlqueries:",
            "            query.full_clean()",
            "            query.save()",
            "",
            "        cls.form_data = {",
            "            \"name\": \"graphql-query-4\",",
            "            \"query\": \"{query: locations {name}}\",",
            "        }",
            "",
            "",
            "#",
            "# Jobs, Scheduling, and Approvals",
            "#",
            "",
            "",
            "class ScheduledJobTestCase(",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.BulkDeleteObjectsViewTestCase,",
            "):",
            "    model = ScheduledJob",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        user = User.objects.create(username=\"user1\", is_active=True)",
            "        ScheduledJob.objects.create(",
            "            name=\"test1\",",
            "            task=\"pass.TestPass\",",
            "            interval=JobExecutionType.TYPE_IMMEDIATELY,",
            "            user=user,",
            "            start_time=timezone.now(),",
            "        )",
            "        ScheduledJob.objects.create(",
            "            name=\"test2\",",
            "            task=\"pass.TestPass\",",
            "            interval=JobExecutionType.TYPE_IMMEDIATELY,",
            "            user=user,",
            "            start_time=timezone.now(),",
            "        )",
            "        ScheduledJob.objects.create(",
            "            name=\"test3\",",
            "            task=\"pass.TestPass\",",
            "            interval=JobExecutionType.TYPE_IMMEDIATELY,",
            "            user=user,",
            "            start_time=timezone.now(),",
            "        )",
            "",
            "    def test_only_enabled_is_listed(self):",
            "        self.add_permissions(\"extras.view_scheduledjob\")",
            "",
            "        # this should not appear, since it\u2019s not enabled",
            "        ScheduledJob.objects.create(",
            "            enabled=False,",
            "            name=\"test4\",",
            "            task=\"pass.TestPass\",",
            "            interval=JobExecutionType.TYPE_IMMEDIATELY,",
            "            user=self.user,",
            "            start_time=timezone.now(),",
            "        )",
            "",
            "        response = self.client.get(self._get_url(\"list\"))",
            "        self.assertHttpStatus(response, 200)",
            "        self.assertNotIn(\"test4\", extract_page_body(response.content.decode(response.charset)))",
            "",
            "    def test_non_valid_crontab_syntax(self):",
            "        self.add_permissions(\"extras.view_scheduledjob\")",
            "",
            "        def scheduled_job_factory(name, crontab):",
            "            ScheduledJob.objects.create(",
            "                enabled=True,",
            "                name=name,",
            "                task=\"pass.TestPass\",",
            "                interval=JobExecutionType.TYPE_CUSTOM,",
            "                user=self.user,",
            "                start_time=timezone.now(),",
            "                crontab=crontab,",
            "            )",
            "",
            "        with self.assertRaises(ValidationError):",
            "            scheduled_job_factory(\"test5\", None)",
            "",
            "        with self.assertRaises(ValidationError):",
            "            scheduled_job_factory(\"test6\", \"\")",
            "",
            "        with self.assertRaises(ValidationError):",
            "            scheduled_job_factory(\"test7\", \"not_enough_values_to_unpack\")",
            "",
            "        with self.assertRaises(ValidationError):",
            "            scheduled_job_factory(\"test8\", \"one too many values to unpack\")",
            "",
            "        with self.assertRaises(ValidationError):",
            "            scheduled_job_factory(\"test9\", \"-1 * * * *\")",
            "",
            "        with self.assertRaises(ValidationError):",
            "            scheduled_job_factory(\"test10\", \"invalid literal * * *\")",
            "",
            "    def test_valid_crontab_syntax(self):",
            "        self.add_permissions(\"extras.view_scheduledjob\")",
            "",
            "        ScheduledJob.objects.create(",
            "            enabled=True,",
            "            name=\"test11\",",
            "            task=\"pass.TestPass\",",
            "            interval=JobExecutionType.TYPE_CUSTOM,",
            "            user=self.user,",
            "            start_time=timezone.now(),",
            "            crontab=\"*/15 9,17 3 * 1-5\",",
            "        )",
            "",
            "        response = self.client.get(self._get_url(\"list\"))",
            "        self.assertHttpStatus(response, 200)",
            "        self.assertIn(\"test11\", extract_page_body(response.content.decode(response.charset)))",
            "",
            "",
            "class ApprovalQueueTestCase(",
            "    # It would be nice to use ViewTestCases.GetObjectViewTestCase as well,",
            "    # but we can't directly use it as it uses instance.get_absolute_url() rather than self._get_url(\"view\", instance)",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "):",
            "    model = ScheduledJob",
            "    # Many interactions with a ScheduledJob also require permissions to view the associated Job",
            "    user_permissions = (\"extras.view_job\",)",
            "",
            "    def _get_url(self, action, instance=None):",
            "        if action == \"list\":",
            "            return reverse(\"extras:scheduledjob_approval_queue_list\")",
            "        if action == \"view\" and instance is not None:",
            "            return reverse(\"extras:scheduledjob_approval_request_view\", kwargs={\"pk\": instance.pk})",
            "        raise ValueError(\"This override is only valid for list and view test cases\")",
            "",
            "    def setUp(self):",
            "        super().setUp()",
            "        self.job_model = Job.objects.get_for_class_path(\"dry_run.TestDryRun\")",
            "        self.job_model_2 = Job.objects.get_for_class_path(\"fail.TestFail\")",
            "",
            "        ScheduledJob.objects.create(",
            "            name=\"test1\",",
            "            task=\"dry_run.TestDryRun\",",
            "            job_model=self.job_model,",
            "            interval=JobExecutionType.TYPE_IMMEDIATELY,",
            "            user=self.user,",
            "            approval_required=True,",
            "            start_time=timezone.now(),",
            "        )",
            "        ScheduledJob.objects.create(",
            "            name=\"test2\",",
            "            task=\"fail.TestFail\",",
            "            job_model=self.job_model_2,",
            "            interval=JobExecutionType.TYPE_IMMEDIATELY,",
            "            user=self.user,",
            "            approval_required=True,",
            "            start_time=timezone.now(),",
            "        )",
            "",
            "    def test_only_approvable_is_listed(self):",
            "        self.add_permissions(\"extras.view_scheduledjob\")",
            "",
            "        ScheduledJob.objects.create(",
            "            name=\"test4\",",
            "            task=\"pass.TestPass\",",
            "            job_model=self.job_model,",
            "            interval=JobExecutionType.TYPE_IMMEDIATELY,",
            "            user=self.user,",
            "            approval_required=False,",
            "            start_time=timezone.now(),",
            "        )",
            "",
            "        response = self.client.get(self._get_url(\"list\"))",
            "        self.assertHttpStatus(response, 200)",
            "        self.assertNotIn(\"test4\", extract_page_body(response.content.decode(response.charset)))",
            "",
            "    #",
            "    # Reimplementations of ViewTestCases.GetObjectViewTestCase test functions.",
            "    # Needed because those use instance.get_absolute_url() instead of self._get_url(\"view\", instance)...",
            "    #",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[\"*\"])",
            "    def test_get_object_anonymous(self):",
            "        self.client.logout()",
            "        response = self.client.get(self._get_url(\"view\", self._get_queryset().first()))",
            "        self.assertHttpStatus(response, 200)",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[])",
            "    def test_get_object_without_permission(self):",
            "        instance = self._get_queryset().first()",
            "",
            "        with disable_warnings(\"django.request\"):",
            "            self.assertHttpStatus(self.client.get(self._get_url(\"view\", instance)), 403)",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[])",
            "    def test_get_object_with_permission(self):",
            "        instance = self._get_queryset().first()",
            "",
            "        # Add model-level permission",
            "        obj_perm = ObjectPermission(name=\"Test permission\", actions=[\"view\"])",
            "        obj_perm.save()",
            "        obj_perm.users.add(self.user)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(self.model))",
            "",
            "        # Try GET with model-level permission",
            "        response = self.client.get(self._get_url(\"view\", instance))",
            "        self.assertHttpStatus(response, 200)",
            "",
            "        response_body = extract_page_body(response.content.decode(response.charset))",
            "",
            "        # The object's display name or string representation should appear in the response",
            "        self.assertIn(getattr(instance, \"display\", str(instance)), response_body, msg=response_body)",
            "",
            "        # skip GetObjectViewTestCase checks for Relationships and Custom Fields since this isn't actually a detail view",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[])",
            "    def test_get_object_with_constrained_permission(self):",
            "        instance1, instance2 = self._get_queryset().all()[:2]",
            "",
            "        # Add object-level permission",
            "        obj_perm = ObjectPermission(",
            "            name=\"Test permission\",",
            "            constraints={\"pk\": instance1.pk},",
            "            # To get a different rendering flow than the \"test_get_object_with_permission\" test above,",
            "            # enable additional permissions for this object so that interaction buttons are rendered.",
            "            actions=[\"view\", \"add\", \"change\", \"delete\"],",
            "        )",
            "        obj_perm.save()",
            "        obj_perm.users.add(self.user)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(self.model))",
            "",
            "        # Try GET to permitted object",
            "        self.assertHttpStatus(self.client.get(self._get_url(\"view\", instance1)), 200)",
            "",
            "        # Try GET to non-permitted object",
            "        self.assertHttpStatus(self.client.get(self._get_url(\"view\", instance2)), 404)",
            "",
            "    #",
            "    # Additional test cases specific to the job approval view",
            "    #",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[\"*\"])",
            "    def test_post_anonymous(self):",
            "        \"\"\"Anonymous users may not take any action with regard to job approval requests.\"\"\"",
            "        self.client.logout()",
            "        response = self.client.post(self._get_url(\"view\", self._get_queryset().first()))",
            "        self.assertHttpStatus(response, 200)",
            "        response_body = extract_page_body(response.content.decode(response.charset))",
            "        self.assertIn(\"You do not have permission to run jobs\", response_body)",
            "        # No job was submitted",
            "        self.assertFalse(JobResult.objects.filter(name=self.job_model.name).exists())",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[])",
            "    def test_post_dry_run_not_runnable(self):",
            "        \"\"\"A non-enabled job cannot be dry-run.\"\"\"",
            "        self.add_permissions(\"extras.view_scheduledjob\")",
            "        instance = self._get_queryset().first()",
            "        data = {\"_dry_run\": True}",
            "",
            "        response = self.client.post(self._get_url(\"view\", instance), data)",
            "        self.assertHttpStatus(response, 200)",
            "        response_body = extract_page_body(response.content.decode(response.charset))",
            "        self.assertIn(\"This job cannot be run at this time\", response_body)",
            "        # No job was submitted",
            "        self.assertFalse(JobResult.objects.filter(name=instance.job_model.name).exists())",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[])",
            "    def test_post_dry_run_needs_job_run_permission(self):",
            "        \"\"\"A user without run_job permission cannot dry-run a job.\"\"\"",
            "        self.add_permissions(\"extras.view_scheduledjob\")",
            "        instance = self._get_queryset().first()",
            "        instance.job_model.enabled = True",
            "        instance.job_model.save()",
            "        data = {\"_dry_run\": True}",
            "",
            "        response = self.client.post(self._get_url(\"view\", instance), data)",
            "        self.assertHttpStatus(response, 200)",
            "        response_body = extract_page_body(response.content.decode(response.charset))",
            "        self.assertIn(\"You do not have permission to run this job\", response_body)",
            "        # No job was submitted",
            "        self.assertFalse(JobResult.objects.filter(name=instance.job_model.name).exists())",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[])",
            "    def test_post_dry_run_needs_specific_job_run_permission(self):",
            "        \"\"\"A user without run_job permission FOR THAT SPECIFIC JOB cannot dry-run a job.\"\"\"",
            "        self.add_permissions(\"extras.view_scheduledjob\")",
            "        instance1, instance2 = self._get_queryset().all()[:2]",
            "        data = {\"_dry_run\": True}",
            "        obj_perm = ObjectPermission(name=\"Test permission\", constraints={\"pk\": instance1.job_model.pk}, actions=[\"run\"])",
            "        obj_perm.save()",
            "        obj_perm.users.add(self.user)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(Job))",
            "        instance1.job_model.enabled = True",
            "        instance1.job_model.save()",
            "        instance2.job_model.enabled = True",
            "        instance2.job_model.save()",
            "",
            "        response = self.client.post(self._get_url(\"view\", instance2), data)",
            "        self.assertHttpStatus(response, 200)",
            "        response_body = extract_page_body(response.content.decode(response.charset))",
            "        self.assertIn(\"You do not have permission to run this job\", response_body)",
            "        # No job was submitted",
            "        job_names = [instance1.job_model.name, instance2.job_model.name]",
            "        self.assertFalse(JobResult.objects.filter(name__in=job_names).exists())",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[\"*\"])",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=1)",
            "    def test_post_dry_run_not_supported(self, _):",
            "        \"\"\"Request a dry run on a job that doesn't support dryrun.\"\"\"",
            "        self.add_permissions(\"extras.view_scheduledjob\")",
            "        instance = ScheduledJob.objects.filter(name=\"test2\").first()",
            "        instance.job_model.enabled = True",
            "        instance.job_model.save()",
            "        obj_perm = ObjectPermission(name=\"Test permission\", constraints={\"pk\": instance.job_model.pk}, actions=[\"run\"])",
            "        obj_perm.save()",
            "        obj_perm.users.add(self.user)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(Job))",
            "        data = {\"_dry_run\": True}",
            "",
            "        response = self.client.post(self._get_url(\"view\", instance), data)",
            "        # Job was not submitted",
            "        self.assertFalse(JobResult.objects.filter(name=instance.job_model.class_path).exists())",
            "        self.assertContains(response, \"This job does not support dryrun\")",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[\"*\"])",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=1)",
            "    @mock.patch(\"nautobot.extras.models.jobs.JobResult.enqueue_job\")",
            "    def test_post_dry_run_success(self, mock_enqueue_job, _):",
            "        \"\"\"Successfully request a dry run based on object-based run_job permissions.\"\"\"",
            "        self.add_permissions(\"extras.view_scheduledjob\")",
            "        instance = ScheduledJob.objects.filter(name=\"test1\").first()",
            "        instance.job_model.enabled = True",
            "        instance.job_model.save()",
            "        obj_perm = ObjectPermission(name=\"Test permission\", constraints={\"pk\": instance.job_model.pk}, actions=[\"run\"])",
            "        obj_perm.save()",
            "        obj_perm.users.add(self.user)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(Job))",
            "        data = {\"_dry_run\": True}",
            "",
            "        mock_enqueue_job.side_effect = lambda job_model, *args, **kwargs: JobResult.objects.create(name=job_model.name)",
            "",
            "        response = self.client.post(self._get_url(\"view\", instance), data)",
            "        # Job was submitted",
            "        mock_enqueue_job.assert_called_once()",
            "        job_result = JobResult.objects.get(name=instance.job_model.name)",
            "        self.assertRedirects(response, reverse(\"extras:jobresult\", kwargs={\"pk\": job_result.pk}))",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[\"*\"])",
            "    def test_post_deny_different_user_lacking_permissions(self):",
            "        \"\"\"A user needs both delete_scheduledjob and approve_job permissions to deny a job request.\"\"\"",
            "        user1 = User.objects.create_user(username=\"testuser1\")",
            "        user2 = User.objects.create_user(username=\"testuser2\")",
            "",
            "        # Give both users view_scheduledjob permission",
            "        obj_perm = ObjectPermission(name=\"View\", actions=[\"view\"])",
            "        obj_perm.save()",
            "        obj_perm.users.add(user1, user2)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(ScheduledJob))",
            "",
            "        # Give user1 delete_scheduledjob permission but not approve_job permission",
            "        obj_perm = ObjectPermission(name=\"Delete\", actions=[\"delete\"])",
            "        obj_perm.save()",
            "        obj_perm.users.add(user1)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(ScheduledJob))",
            "",
            "        # Give user2 approve_job permission but not delete_scheduledjob permission",
            "        obj_perm = ObjectPermission(name=\"Approve\", actions=[\"approve\"])",
            "        obj_perm.save()",
            "        obj_perm.users.add(user2)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(Job))",
            "",
            "        instance = self._get_queryset().first()",
            "        data = {\"_deny\": True}",
            "",
            "        for user in (user1, user2):",
            "            self.client.force_login(user)",
            "            response = self.client.post(self._get_url(\"view\", instance), data)",
            "            self.assertHttpStatus(response, 200, msg=str(user))",
            "            response_body = extract_page_body(response.content.decode(response.charset))",
            "            self.assertIn(\"You do not have permission\", response_body, msg=str(user))",
            "            # Request was not deleted",
            "            self.assertEqual(1, len(ScheduledJob.objects.filter(pk=instance.pk)), msg=str(user))",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[\"*\"])",
            "    def test_post_deny_different_user_permitted(self):",
            "        \"\"\"A user with appropriate permissions can deny a job request.\"\"\"",
            "        user = User.objects.create_user(username=\"testuser1\")",
            "        instance = self._get_queryset().first()",
            "",
            "        # Give user view_scheduledjob and delete_scheduledjob permissions",
            "        obj_perm = ObjectPermission(name=\"View\", actions=[\"view\", \"delete\"], constraints={\"pk\": instance.pk})",
            "        obj_perm.save()",
            "        obj_perm.users.add(user)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(ScheduledJob))",
            "",
            "        # Give user approve_job permission",
            "        obj_perm = ObjectPermission(name=\"Approve\", actions=[\"approve\"], constraints={\"pk\": instance.job_model.pk})",
            "        obj_perm.save()",
            "        obj_perm.users.add(user)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(Job))",
            "",
            "        data = {\"_deny\": True}",
            "",
            "        self.client.force_login(user)",
            "        response = self.client.post(self._get_url(\"view\", instance), data)",
            "        self.assertRedirects(response, reverse(\"extras:scheduledjob_approval_queue_list\"))",
            "        # Request was deleted",
            "        self.assertEqual(0, len(ScheduledJob.objects.filter(pk=instance.pk)))",
            "",
            "        # Check object-based permissions are enforced for a different instance",
            "        instance = self._get_queryset().first()",
            "        response = self.client.post(self._get_url(\"view\", instance), data)",
            "        self.assertHttpStatus(response, 200, msg=str(user))",
            "        response_body = extract_page_body(response.content.decode(response.charset))",
            "        self.assertIn(\"You do not have permission\", response_body, msg=str(user))",
            "        # Request was not deleted",
            "        self.assertEqual(1, len(ScheduledJob.objects.filter(pk=instance.pk)), msg=str(user))",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[\"*\"])",
            "    def test_post_approve_cannot_self_approve(self):",
            "        self.add_permissions(\"extras.change_scheduledjob\")",
            "        self.add_permissions(\"extras.approve_job\")",
            "        instance = self._get_queryset().first()",
            "        data = {\"_approve\": True}",
            "",
            "        response = self.client.post(self._get_url(\"view\", instance), data)",
            "        self.assertHttpStatus(response, 200)",
            "        response_body = extract_page_body(response.content.decode(response.charset))",
            "        self.assertIn(\"You cannot approve your own job request\", response_body)",
            "        # Job was not approved",
            "        instance.refresh_from_db()",
            "        self.assertIsNone(instance.approved_by_user)",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[\"*\"])",
            "    def test_post_approve_different_user_lacking_permissions(self):",
            "        \"\"\"A user needs both change_scheduledjob and approve_job permissions to approve a job request.\"\"\"",
            "        user1 = User.objects.create_user(username=\"testuser1\")",
            "        user2 = User.objects.create_user(username=\"testuser2\")",
            "",
            "        # Give both users view_scheduledjob permission",
            "        obj_perm = ObjectPermission(name=\"View\", actions=[\"view\"])",
            "        obj_perm.save()",
            "        obj_perm.users.add(user1, user2)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(ScheduledJob))",
            "",
            "        # Give user1 change_scheduledjob permission but not approve_job permission",
            "        obj_perm = ObjectPermission(name=\"Change\", actions=[\"change\"])",
            "        obj_perm.save()",
            "        obj_perm.users.add(user1)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(ScheduledJob))",
            "",
            "        # Give user2 approve_job permission but not change_scheduledjob permission",
            "        obj_perm = ObjectPermission(name=\"Approve\", actions=[\"approve\"])",
            "        obj_perm.save()",
            "        obj_perm.users.add(user2)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(Job))",
            "",
            "        instance = self._get_queryset().first()",
            "        data = {\"_approve\": True}",
            "",
            "        for user in (user1, user2):",
            "            self.client.force_login(user)",
            "            response = self.client.post(self._get_url(\"view\", instance), data)",
            "            self.assertHttpStatus(response, 200, msg=str(user))",
            "            response_body = extract_page_body(response.content.decode(response.charset))",
            "            self.assertIn(\"You do not have permission\", response_body, msg=str(user))",
            "            # Job was not approved",
            "            instance.refresh_from_db()",
            "            self.assertIsNone(instance.approved_by_user)",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[\"*\"])",
            "    def test_post_approve_different_user_permitted(self):",
            "        \"\"\"A user with appropriate permissions can approve a job request.\"\"\"",
            "        user = User.objects.create_user(username=\"testuser1\")",
            "        instance = self._get_queryset().first()",
            "",
            "        # Give user view_scheduledjob and change_scheduledjob permissions",
            "        obj_perm = ObjectPermission(name=\"View\", actions=[\"view\", \"change\"], constraints={\"pk\": instance.pk})",
            "        obj_perm.save()",
            "        obj_perm.users.add(user)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(ScheduledJob))",
            "",
            "        # Give user approve_job permission",
            "        obj_perm = ObjectPermission(name=\"Approve\", actions=[\"approve\"], constraints={\"pk\": instance.job_model.pk})",
            "        obj_perm.save()",
            "        obj_perm.users.add(user)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(Job))",
            "",
            "        data = {\"_approve\": True}",
            "",
            "        self.client.force_login(user)",
            "        response = self.client.post(self._get_url(\"view\", instance), data)",
            "        self.assertRedirects(response, reverse(\"extras:scheduledjob_approval_queue_list\"))",
            "        # Job was scheduled",
            "        instance.refresh_from_db()",
            "        self.assertEqual(instance.approved_by_user, user)",
            "",
            "        # Check object-based permissions are enforced for a different instance",
            "        instance = self._get_queryset().last()",
            "        response = self.client.post(self._get_url(\"view\", instance), data)",
            "        self.assertHttpStatus(response, 200, msg=str(user))",
            "        response_body = extract_page_body(response.content.decode(response.charset))",
            "        self.assertIn(\"You do not have permission\", response_body, msg=str(user))",
            "        # Job was not scheduled",
            "        instance.refresh_from_db()",
            "        self.assertIsNone(instance.approved_by_user)",
            "",
            "",
            "class JobResultTestCase(",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.BulkDeleteObjectsViewTestCase,",
            "):",
            "    model = JobResult",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        JobResult.objects.create(name=\"pass.TestPass\")",
            "        JobResult.objects.create(name=\"fail.TestFail\")",
            "",
            "",
            "class JobTestCase(",
            "    # note no CreateObjectViewTestCase - we do not support user creation of Job records",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "):",
            "    \"\"\"",
            "    The Job view test cases.",
            "    \"\"\"",
            "",
            "    model = Job",
            "",
            "    def _get_queryset(self):",
            "        \"\"\"Don't include hidden Jobs, non-installed Jobs, JobHookReceivers or JobButtonReceivers as they won't appear in the UI by default.\"\"\"",
            "        return self.model.objects.filter(",
            "            installed=True, hidden=False, is_job_hook_receiver=False, is_job_button_receiver=False",
            "        )",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        # Job model objects are automatically created during database migrations",
            "",
            "        # But we do need to make sure the ones we're testing are flagged appropriately",
            "        cls.test_pass = Job.objects.get(job_class_name=\"TestPass\")",
            "        cls.test_pass.enabled = True",
            "        cls.test_pass.save()",
            "",
            "        cls.run_urls = (",
            "            # Legacy URL (job class path based)",
            "            reverse(\"extras:job_run_by_class_path\", kwargs={\"class_path\": cls.test_pass.class_path}),",
            "            # Current URL (job model pk based)",
            "            reverse(\"extras:job_run\", kwargs={\"pk\": cls.test_pass.pk}),",
            "        )",
            "",
            "        cls.test_required_args = Job.objects.get(job_class_name=\"TestRequired\")",
            "        cls.test_required_args.enabled = True",
            "        cls.test_required_args.save()",
            "",
            "        cls.extra_run_urls = (",
            "            # Legacy URL (job class path based)",
            "            reverse(\"extras:job_run_by_class_path\", kwargs={\"class_path\": cls.test_required_args.class_path}),",
            "            # Current URL (job model pk based)",
            "            reverse(\"extras:job_run\", kwargs={\"pk\": cls.test_required_args.pk}),",
            "        )",
            "",
            "        # Create an entry for a non-installed Job as well",
            "        cls.test_not_installed = Job(",
            "            module_name=\"nonexistent\",",
            "            job_class_name=\"NoSuchJob\",",
            "            grouping=\"Nonexistent Jobs\",",
            "            name=\"No such job\",",
            "            enabled=True,",
            "            installed=False,",
            "        )",
            "        cls.test_not_installed.validated_save()",
            "",
            "        cls.data_run_immediately = {",
            "            \"_schedule_type\": \"immediately\",",
            "        }",
            "",
            "        cls.form_data = {",
            "            \"enabled\": True,",
            "            \"grouping_override\": True,",
            "            \"grouping\": \"Overridden Grouping\",",
            "            \"name_override\": True,",
            "            \"name\": \"Overridden Name\",",
            "            \"description_override\": True,",
            "            \"description\": \"This is an overridden description of a job.\",",
            "            \"dryrun_default_override\": True,",
            "            \"dryrun_default\": True,",
            "            \"hidden_override\": True,",
            "            \"hidden\": False,",
            "            \"approval_required_override\": True,",
            "            \"approval_required\": True,",
            "            \"soft_time_limit_override\": True,",
            "            \"soft_time_limit\": 350,",
            "            \"time_limit_override\": True,",
            "            \"time_limit\": 650,",
            "            \"has_sensitive_variables\": False,",
            "            \"has_sensitive_variables_override\": True,",
            "            \"task_queues\": \"overridden,priority\",",
            "            \"task_queues_override\": True,",
            "        }",
            "",
            "    #",
            "    # Additional test cases for the \"job\" (legacy run) and \"job_run\" (updated run) views follow",
            "    #",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[])",
            "    def test_get_run_without_permission(self):",
            "        for run_url in self.run_urls:",
            "            self.assertHttpStatus(self.client.get(run_url), 403, msg=run_url)",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[])",
            "    def test_get_run_with_permission(self):",
            "        \"\"\"",
            "        Get view with appropriate global permissions.",
            "",
            "        Note that this view is conditional on run_job permission, not view_job permission,",
            "        so EXEMPT_VIEW_PERMISSIONS=[\"*\"] does NOT apply here.",
            "        \"\"\"",
            "        self.add_permissions(\"extras.run_job\")",
            "        for run_url in self.run_urls:",
            "            response = self.client.get(run_url)",
            "            self.assertHttpStatus(response, 200, msg=run_url)",
            "",
            "            response_body = extract_page_body(response.content.decode(response.charset))",
            "            self.assertIn(\"TestPass\", response_body)",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[])",
            "    def test_get_run_with_constrained_permission(self):",
            "        \"\"\"Get view with appropriate object-based permissions.\"\"\"",
            "        obj_perm = ObjectPermission(",
            "            name=\"Job permission\",",
            "            constraints={\"module_name\": self.test_pass.module_name},",
            "            actions=[\"run\"],",
            "        )",
            "        obj_perm.save()",
            "        obj_perm.users.add(self.user)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(Job))",
            "",
            "        # Try GET with a permitted object",
            "        for run_url in self.run_urls:",
            "            self.assertHttpStatus(self.client.get(run_url), 200, msg=run_url)",
            "",
            "        # Try GET with a non-permitted object",
            "        for run_url in self.extra_run_urls:",
            "            self.assertHttpStatus(self.client.get(run_url), 404, msg=run_url)",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[])",
            "    def test_run_without_permission(self):",
            "        for run_url in self.run_urls:",
            "            self.assertHttpStatus(self.client.post(run_url), 403, msg=run_url)",
            "",
            "    def test_run_missing_schedule(self):",
            "        self.add_permissions(\"extras.run_job\")",
            "",
            "        for run_url in self.run_urls:",
            "            response = self.client.post(run_url)",
            "            self.assertHttpStatus(response, 200, msg=run_url)",
            "",
            "            errors = extract_form_failures(response.content.decode(response.charset))",
            "            self.assertEqual(errors, [\"_schedule_type: This field is required.\"])",
            "",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=0)",
            "    def test_run_now_no_worker(self, _):",
            "        self.add_permissions(\"extras.run_job\")",
            "",
            "        for run_url in self.run_urls:",
            "            response = self.client.post(run_url, self.data_run_immediately)",
            "            self.assertHttpStatus(response, 200, msg=run_url)",
            "",
            "            content = extract_page_body(response.content.decode(response.charset))",
            "            self.assertIn(\"Celery worker process not running.\", content)",
            "",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=1)",
            "    def test_run_now(self, _):",
            "        self.add_permissions(\"extras.run_job\")",
            "        self.add_permissions(\"extras.view_jobresult\")",
            "",
            "        for run_url in self.run_urls:",
            "            response = self.client.post(run_url, self.data_run_immediately)",
            "",
            "            result = JobResult.objects.latest()",
            "            self.assertRedirects(response, reverse(\"extras:jobresult\", kwargs={\"pk\": result.pk}))",
            "",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=1)",
            "    def test_run_now_constrained_permissions(self, _):",
            "        obj_perm = ObjectPermission(",
            "            name=\"Job permission\",",
            "            constraints={\"module_name\": self.test_pass.module_name},",
            "            actions=[\"run\"],",
            "        )",
            "        obj_perm.save()",
            "        obj_perm.users.add(self.user)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(Job))",
            "",
            "        self.add_permissions(\"extras.view_jobresult\")",
            "",
            "        # Try POST with a permitted object",
            "        for run_url in self.run_urls:",
            "            response = self.client.post(run_url, self.data_run_immediately)",
            "",
            "            result = JobResult.objects.latest()",
            "            self.assertIsNotNone(result, msg=run_url)",
            "            self.assertRedirects(response, reverse(\"extras:jobresult\", kwargs={\"pk\": result.pk}))",
            "",
            "        # Try POST with a non-permitted object",
            "        for run_url in self.extra_run_urls:",
            "            self.assertHttpStatus(self.client.post(run_url, self.data_run_immediately), 404, msg=run_url)",
            "",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=1)",
            "    def test_run_now_not_installed(self, _):",
            "        self.add_permissions(\"extras.run_job\")",
            "",
            "        for run_url in (",
            "            reverse(\"extras:job_run_by_class_path\", kwargs={\"class_path\": self.test_not_installed.class_path}),",
            "            reverse(\"extras:job_run\", kwargs={\"pk\": self.test_not_installed.pk}),",
            "        ):",
            "            response = self.client.post(run_url, self.data_run_immediately)",
            "            self.assertEqual(response.status_code, 200, msg=run_url)",
            "            response_body = extract_page_body(response.content.decode(response.charset))",
            "            self.assertIn(\"Job is not presently installed\", response_body)",
            "",
            "            self.assertFalse(JobResult.objects.filter(name=self.test_not_installed.name).exists())",
            "",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=1)",
            "    def test_run_now_not_enabled(self, _):",
            "        self.add_permissions(\"extras.run_job\")",
            "",
            "        for run_url in (",
            "            reverse(\"extras:job_run_by_class_path\", kwargs={\"class_path\": \"fail.TestFail\"}),",
            "            reverse(\"extras:job_run\", kwargs={\"pk\": Job.objects.get(job_class_name=\"TestFail\").pk}),",
            "        ):",
            "            response = self.client.post(run_url, self.data_run_immediately)",
            "            self.assertEqual(response.status_code, 200, msg=run_url)",
            "            response_body = extract_page_body(response.content.decode(response.charset))",
            "            self.assertIn(\"Job is not enabled to be run\", response_body)",
            "            self.assertFalse(JobResult.objects.filter(name=\"fail.TestFail\").exists())",
            "",
            "    def test_run_now_missing_args(self):",
            "        self.add_permissions(\"extras.run_job\")",
            "",
            "        for run_url in self.extra_run_urls:",
            "            response = self.client.post(run_url, self.data_run_immediately)",
            "            self.assertHttpStatus(response, 200, msg=run_url)",
            "",
            "            errors = extract_form_failures(response.content.decode(response.charset))",
            "            self.assertEqual(errors, [\"var: This field is required.\"])",
            "",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=1)",
            "    def test_run_now_with_args(self, _):",
            "        self.add_permissions(\"extras.run_job\")",
            "        self.add_permissions(\"extras.view_jobresult\")",
            "",
            "        data = {",
            "            \"_schedule_type\": \"immediately\",",
            "            \"var\": \"12\",",
            "        }",
            "",
            "        for run_url in self.extra_run_urls:",
            "            response = self.client.post(run_url, data)",
            "",
            "            result = JobResult.objects.latest()",
            "            self.assertRedirects(response, reverse(\"extras:jobresult\", kwargs={\"pk\": result.pk}))",
            "",
            "    @mock.patch(\"nautobot.extras.jobs.task_queues_as_choices\")",
            "    def test_rerun_job(self, mock_task_queues_as_choices):",
            "        self.add_permissions(\"extras.run_job\")",
            "        self.add_permissions(\"extras.view_jobresult\")",
            "",
            "        mock_task_queues_as_choices.return_value = [(\"default\", \"\"), (\"queue1\", \"\"), (\"uniquequeue\", \"\")]",
            "        job_celery_kwargs = {",
            "            \"nautobot_job_job_model_id\": self.test_required_args.id,",
            "            \"nautobot_job_profile\": True,",
            "            \"nautobot_job_user_id\": self.user.id,",
            "            \"queue\": \"uniquequeue\",",
            "        }",
            "",
            "        previous_result = JobResult.objects.create(",
            "            job_model=self.test_required_args,",
            "            user=self.user,",
            "            task_kwargs={\"var\": \"456\"},",
            "            celery_kwargs=job_celery_kwargs,",
            "        )",
            "",
            "        run_url = reverse(\"extras:job_run\", kwargs={\"pk\": self.test_required_args.pk})",
            "        response = self.client.get(f\"{run_url}?kwargs_from_job_result={previous_result.pk!s}\")",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "",
            "        self.assertInHTML('<option value=\"uniquequeue\" selected>', content)",
            "        self.assertInHTML(",
            "            '<input type=\"text\" name=\"var\" value=\"456\" class=\"form-control form-control\" required placeholder=\"None\" id=\"id_var\">',",
            "            content,",
            "        )",
            "        self.assertInHTML('<input type=\"hidden\" name=\"_profile\" value=\"True\" id=\"id__profile\">', content)",
            "",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=1)",
            "    def test_run_later_missing_name(self, _):",
            "        self.add_permissions(\"extras.run_job\")",
            "",
            "        data = {",
            "            \"_schedule_type\": \"future\",",
            "        }",
            "",
            "        for run_url in self.run_urls:",
            "            response = self.client.post(run_url, data)",
            "            self.assertHttpStatus(response, 200, msg=run_url)",
            "",
            "            errors = extract_form_failures(response.content.decode(response.charset))",
            "            self.assertEqual(errors, [\"_schedule_name: Please provide a name for the job schedule.\"])",
            "",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=1)",
            "    def test_run_later_missing_date(self, _):",
            "        self.add_permissions(\"extras.run_job\")",
            "",
            "        data = {",
            "            \"_schedule_type\": \"future\",",
            "            \"_schedule_name\": \"test\",",
            "        }",
            "",
            "        for i, run_url in enumerate(self.run_urls):",
            "            data[\"_schedule_name\"] = f\"test {i}\"",
            "            response = self.client.post(run_url, data)",
            "            self.assertHttpStatus(response, 200, msg=run_url)",
            "",
            "            errors = extract_form_failures(response.content.decode(response.charset))",
            "            self.assertEqual(",
            "                errors,",
            "                [",
            "                    \"_schedule_start_time: Please enter a valid date and time greater than or equal to the current date and time.\"",
            "                ],",
            "            )",
            "",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=1)",
            "    def test_run_later_date_passed(self, _):",
            "        self.add_permissions(\"extras.run_job\")",
            "",
            "        data = {",
            "            \"_schedule_type\": \"future\",",
            "            \"_schedule_name\": \"test\",",
            "            \"_schedule_start_time\": str(timezone.now() - timedelta(minutes=1)),",
            "        }",
            "",
            "        for i, run_url in enumerate(self.run_urls):",
            "            data[\"_schedule_name\"] = f\"test {i}\"",
            "            response = self.client.post(run_url, data)",
            "            self.assertHttpStatus(response, 200, msg=run_url)",
            "",
            "            errors = extract_form_failures(response.content.decode(response.charset))",
            "            self.assertEqual(",
            "                errors,",
            "                [",
            "                    \"_schedule_start_time: Please enter a valid date and time greater than or equal to the current date and time.\"",
            "                ],",
            "            )",
            "",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=1)",
            "    def test_run_later(self, _):",
            "        self.add_permissions(\"extras.run_job\")",
            "        self.add_permissions(\"extras.view_scheduledjob\")",
            "",
            "        start_time = timezone.now() + timedelta(minutes=1)",
            "        data = {",
            "            \"_schedule_type\": \"future\",",
            "            \"_schedule_name\": \"test\",",
            "            \"_schedule_start_time\": str(start_time),",
            "        }",
            "",
            "        for i, run_url in enumerate(self.run_urls):",
            "            data[\"_schedule_name\"] = f\"test {i}\"",
            "            response = self.client.post(run_url, data)",
            "            self.assertRedirects(response, reverse(\"extras:scheduledjob_list\"))",
            "",
            "            scheduled = ScheduledJob.objects.get(name=f\"test {i}\")",
            "            self.assertEqual(scheduled.start_time, start_time)",
            "",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=1)",
            "    def test_run_job_with_sensitive_variables_for_future(self, _):",
            "        self.add_permissions(\"extras.run_job\")",
            "        self.add_permissions(\"extras.view_scheduledjob\")",
            "",
            "        self.test_pass.has_sensitive_variables = True",
            "        self.test_pass.has_sensitive_variables_override = True",
            "        self.test_pass.validated_save()",
            "",
            "        start_time = timezone.now() + timedelta(minutes=1)",
            "        data = {",
            "            \"_schedule_type\": \"future\",",
            "            \"_schedule_name\": \"test\",",
            "            \"_schedule_start_time\": str(start_time),",
            "        }",
            "        for i, run_url in enumerate(self.run_urls):",
            "            data[\"_schedule_name\"] = f\"test {i}\"",
            "            response = self.client.post(run_url, data)",
            "            self.assertHttpStatus(response, 200, msg=self.run_urls[1])",
            "",
            "            content = extract_page_body(response.content.decode(response.charset))",
            "            self.assertIn(\"Unable to schedule job: Job may have sensitive input variables.\", content)",
            "",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=1)",
            "    def test_run_job_with_invalid_task_queue(self, _):",
            "        self.add_permissions(\"extras.run_job\")",
            "        self.add_permissions(\"extras.view_jobresult\")",
            "",
            "        self.test_pass.task_queues = []",
            "        self.test_pass.task_queues_override = True",
            "        self.test_pass.validated_save()",
            "",
            "        data = {",
            "            \"_schedule_type\": \"immediately\",",
            "            \"_task_queue\": \"invalid\",",
            "        }",
            "",
            "        for run_url in self.run_urls:",
            "            response = self.client.post(run_url, data)",
            "            self.assertHttpStatus(response, 200, msg=run_url)",
            "",
            "            errors = extract_form_failures(response.content.decode(response.charset))",
            "            self.assertEqual(",
            "                errors,",
            "                [\"_task_queue: Select a valid choice. invalid is not one of the available choices.\"],",
            "            )",
            "",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=1)",
            "    def test_run_job_with_sensitive_variables_and_requires_approval(self, _):",
            "        self.add_permissions(\"extras.run_job\")",
            "        self.add_permissions(\"extras.view_scheduledjob\")",
            "",
            "        self.test_pass.has_sensitive_variables = True",
            "        self.test_pass.approval_required = True",
            "        self.test_pass.save()",
            "",
            "        data = {",
            "            \"_schedule_type\": \"immediately\",",
            "        }",
            "        for run_url in self.run_urls:",
            "            # Assert warning message shows in get",
            "            response = self.client.get(run_url)",
            "            content = extract_page_body(response.content.decode(response.charset))",
            "            self.assertIn(",
            "                \"This job is flagged as possibly having sensitive variables but is also flagged as requiring approval.\",",
            "                content,",
            "            )",
            "",
            "            # Assert run button is disabled",
            "            self.assertInHTML(",
            "                \"\"\"",
            "                <button type=\"submit\" name=\"_run\" id=\"id__run\" class=\"btn btn-primary\" disabled=\"disabled\">",
            "                    <i class=\"mdi mdi-play\"></i> Run Job Now",
            "                </button>",
            "                \"\"\",",
            "                content,",
            "            )",
            "            # Assert error message shows after post",
            "            response = self.client.post(run_url, data)",
            "            self.assertHttpStatus(response, 200, msg=self.run_urls[1])",
            "",
            "            content = extract_page_body(response.content.decode(response.charset))",
            "            self.assertIn(",
            "                \"Unable to run or schedule job: \"",
            "                \"This job is flagged as possibly having sensitive variables but is also flagged as requiring approval.\"",
            "                \"One of these two flags must be removed before this job can be scheduled or run.\",",
            "                content,",
            "            )",
            "",
            "    def test_job_object_change_log_view(self):",
            "        \"\"\"Assert Job change log view displays appropriate header\"\"\"",
            "        instance = self.test_pass",
            "        self.add_permissions(\"extras.view_objectchange\", \"extras.view_job\")",
            "        response = self.client.get(instance.get_changelog_url())",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "",
            "        self.assertHttpStatus(response, 200)",
            "        self.assertIn(f\"<h1>{instance.name} - Change Log</h1>\", content)",
            "",
            "",
            "class JobButtonTestCase(",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "):",
            "    model = JobButton",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        job_buttons = (",
            "            JobButton.objects.create(",
            "                name=\"JobButton1\",",
            "                text=\"JobButton1\",",
            "                job=Job.objects.get(job_class_name=\"TestJobButtonReceiverSimple\"),",
            "                confirmation=True,",
            "            ),",
            "            JobButton.objects.create(",
            "                name=\"JobButton2\",",
            "                text=\"JobButton2\",",
            "                job=Job.objects.get(job_class_name=\"TestJobButtonReceiverSimple\"),",
            "                confirmation=False,",
            "            ),",
            "            JobButton.objects.create(",
            "                name=\"JobButton3\",",
            "                text=\"JobButton3\",",
            "                job=Job.objects.get(job_class_name=\"TestJobButtonReceiverComplex\"),",
            "                confirmation=True,",
            "                weight=50,",
            "            ),",
            "        )",
            "",
            "        location_ct = ContentType.objects.get_for_model(Location)",
            "        for jb in job_buttons:",
            "            jb.content_types.set([location_ct])",
            "",
            "        cls.form_data = {",
            "            \"content_types\": [location_ct.pk],",
            "            \"name\": \"jobbutton-4\",",
            "            \"text\": \"jobbutton text 4\",",
            "            \"job\": Job.objects.get(job_class_name=\"TestJobButtonReceiverComplex\").pk,",
            "            \"weight\": 100,",
            "            \"button_class\": \"default\",",
            "            \"confirmation\": False,",
            "        }",
            "",
            "",
            "class JobButtonRenderingTestCase(TestCase):",
            "    \"\"\"Tests for the rendering of JobButtons, distinct from tests of the JobButton views themselves.\"\"\"",
            "",
            "    user_permissions = [\"dcim.view_locationtype\"]",
            "",
            "    def setUp(self):",
            "        super().setUp()",
            "        self.job_button = JobButton(",
            "            name=\"JobButton\",",
            "            text=\"JobButton {{ obj.name }}\",",
            "            job=Job.objects.get(job_class_name=\"TestJobButtonReceiverSimple\"),",
            "            confirmation=False,",
            "        )",
            "        self.job_button.validated_save()",
            "        self.job_button.content_types.add(ContentType.objects.get_for_model(LocationType))",
            "        self.location_type = LocationType.objects.get(name=\"Campus\")",
            "",
            "    def test_view_object_with_job_button(self):",
            "        \"\"\"Ensure that the job button is rendered.\"\"\"",
            "        response = self.client.get(self.location_type.get_absolute_url(), follow=True)",
            "        self.assertEqual(response.status_code, 200)",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "        self.assertIn(f\"JobButton {self.location_type.name}\", content, content)",
            "",
            "    def test_view_object_with_unsafe_text(self):",
            "        \"\"\"Ensure that JobButton text can't be used as a vector for XSS.\"\"\"",
            "        self.job_button.text = '<script>alert(\"Hello world!\")</script>'",
            "        self.job_button.validated_save()",
            "        response = self.client.get(self.location_type.get_absolute_url(), follow=True)",
            "        self.assertEqual(response.status_code, 200)",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "        self.assertNotIn(\"<script>alert\", content, content)",
            "        self.assertIn(\"&lt;script&gt;alert\", content, content)",
            "",
            "        # Make sure grouped rendering is safe too",
            "        self.job_button.group = '<script>alert(\"Goodbye\")</script>'",
            "        self.job_button.validated_save()",
            "        response = self.client.get(self.location_type.get_absolute_url(), follow=True)",
            "        self.assertEqual(response.status_code, 200)",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "        self.assertNotIn(\"<script>alert\", content, content)",
            "        self.assertIn(\"&lt;script&gt;alert\", content, content)",
            "",
            "    def test_view_object_with_unsafe_name(self):",
            "        \"\"\"Ensure that JobButton names can't be used as a vector for XSS.\"\"\"",
            "        self.job_button.text = \"JobButton {{ obj\"",
            "        self.job_button.name = '<script>alert(\"Yo\")</script>'",
            "        self.job_button.validated_save()",
            "        response = self.client.get(self.location_type.get_absolute_url(), follow=True)",
            "        self.assertEqual(response.status_code, 200)",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "        self.assertNotIn(\"<script>alert\", content, content)",
            "        self.assertIn(\"&lt;script&gt;alert\", content, content)",
            "",
            "",
            "# TODO: Convert to StandardTestCases.Views",
            "class ObjectChangeTestCase(TestCase):",
            "    user_permissions = (\"extras.view_objectchange\",)",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        location_type = LocationType.objects.get(name=\"Campus\")",
            "        location_status = Status.objects.get_for_model(Location).first()",
            "        location = Location(name=\"Location 1\", location_type=location_type, status=location_status)",
            "        location.save()",
            "",
            "        # Create three ObjectChanges",
            "        user = User.objects.create_user(username=\"testuser2\")",
            "        for _ in range(1, 4):",
            "            oc = location.to_objectchange(action=ObjectChangeActionChoices.ACTION_UPDATE)",
            "            oc.user = user",
            "            oc.request_id = uuid.uuid4()",
            "            oc.save()",
            "",
            "    def test_objectchange_list(self):",
            "        url = reverse(\"extras:objectchange_list\")",
            "        params = {",
            "            \"user\": User.objects.first().pk,",
            "        }",
            "",
            "        response = self.client.get(f\"{url}?{urllib.parse.urlencode(params)}\")",
            "        self.assertHttpStatus(response, 200)",
            "",
            "    def test_objectchange(self):",
            "        objectchange = ObjectChange.objects.first()",
            "        response = self.client.get(objectchange.get_absolute_url())",
            "        self.assertHttpStatus(response, 200)",
            "",
            "",
            "class RelationshipTestCase(",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.BulkDeleteObjectsViewTestCase,",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "    RequiredRelationshipTestMixin,",
            "):",
            "    model = Relationship",
            "    slug_source = \"label\"",
            "    slugify_function = staticmethod(slugify_dashes_to_underscores)",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        interface_type = ContentType.objects.get_for_model(Interface)",
            "        device_type = ContentType.objects.get_for_model(Device)",
            "        vlan_type = ContentType.objects.get_for_model(VLAN)",
            "        status = Status.objects.get_for_model(Interface).first()",
            "",
            "        Relationship(",
            "            label=\"Device VLANs\",",
            "            key=\"device_vlans\",",
            "            type=\"many-to-many\",",
            "            source_type=device_type,",
            "            destination_type=vlan_type,",
            "        ).validated_save()",
            "        Relationship(",
            "            label=\"Primary VLAN\",",
            "            key=\"primary_vlan\",",
            "            type=\"one-to-many\",",
            "            source_type=vlan_type,",
            "            destination_type=device_type,",
            "        ).validated_save()",
            "        Relationship(",
            "            label=\"Primary Interface\",",
            "            type=\"one-to-one\",",
            "            source_type=device_type,",
            "            destination_type=interface_type,",
            "        ).validated_save()",
            "",
            "        cls.form_data = {",
            "            \"label\": \"VLAN-to-Interface\",",
            "            \"key\": \"vlan_to_interface\",",
            "            \"type\": \"many-to-many\",",
            "            \"source_type\": vlan_type.pk,",
            "            \"source_label\": \"Interfaces\",",
            "            \"source_hidden\": False,",
            "            \"source_filter\": '{\"status\": [\"' + status.name + '\"]}',",
            "            \"destination_type\": interface_type.pk,",
            "            \"destination_label\": \"VLANs\",",
            "            \"destination_hidden\": True,",
            "            \"destination_filter\": None,",
            "        }",
            "",
            "        cls.slug_test_object = \"Primary Interface\"",
            "",
            "    def test_required_relationships(self):",
            "        \"\"\"",
            "        1. Try creating an object when no required target object exists",
            "        2. Try creating an object without specifying required target object(s)",
            "        3. Try creating an object when all required data is present",
            "        4. Test bulk edit",
            "        \"\"\"",
            "",
            "        # Delete existing factory generated objects that may interfere with this test",
            "        IPAddress.objects.all().delete()",
            "        Prefix.objects.update(parent=None)",
            "        Prefix.objects.all().delete()",
            "        VLAN.objects.all().delete()",
            "",
            "        # Parameterized tests (for creating and updating single objects):",
            "        self.required_relationships_test(interact_with=\"ui\")",
            "",
            "        # 4. Bulk create/edit tests:",
            "",
            "        vlan_status = Status.objects.get_for_model(VLAN).first()",
            "        vlans = (",
            "            VLAN.objects.create(name=\"test_required_relationships1\", vid=1, status=vlan_status),",
            "            VLAN.objects.create(name=\"test_required_relationships2\", vid=2, status=vlan_status),",
            "            VLAN.objects.create(name=\"test_required_relationships3\", vid=3, status=vlan_status),",
            "            VLAN.objects.create(name=\"test_required_relationships4\", vid=4, status=vlan_status),",
            "            VLAN.objects.create(name=\"test_required_relationships5\", vid=5, status=vlan_status),",
            "            VLAN.objects.create(name=\"test_required_relationships6\", vid=6, status=vlan_status),",
            "        )",
            "",
            "        # Try deleting all devices and then editing the 6 VLANs (fails):",
            "        Device.objects.all().delete()",
            "        response = self.client.post(",
            "            reverse(\"ipam:vlan_bulk_edit\"), data={\"pk\": [str(vlan.id) for vlan in vlans], \"_apply\": [\"\"]}",
            "        )",
            "        self.assertContains(response, \"VLANs require at least one device, but no devices exist yet.\")",
            "",
            "        # Create test device for association",
            "        device_for_association = test_views.create_test_device(\"VLAN Required Device\")",
            "",
            "        # Try editing all 6 VLANs without adding the required device(fails):",
            "        response = self.client.post(",
            "            reverse(\"ipam:vlan_bulk_edit\"), data={\"pk\": [str(vlan.id) for vlan in vlans], \"_apply\": [\"\"]}",
            "        )",
            "        self.assertContains(",
            "            response,",
            "            \"6 VLANs require a device for the required relationship &quot;VLANs require at least one Device&quot;\",",
            "        )",
            "",
            "        # Try editing 3 VLANs without adding the required device(fails):",
            "        response = self.client.post(",
            "            reverse(\"ipam:vlan_bulk_edit\"), data={\"pk\": [str(vlan.id) for vlan in vlans[:3]], \"_apply\": [\"\"]}",
            "        )",
            "        self.assertContains(",
            "            response,",
            "            \"These VLANs require a device for the required \"",
            "            \"relationship &quot;VLANs require at least one Device&quot;\",",
            "        )",
            "        for vlan in vlans[:3]:",
            "            self.assertContains(response, f\"{str(vlan)}\")",
            "",
            "        # Try editing 6 VLANs and adding the required device (succeeds):",
            "        response = self.client.post(",
            "            reverse(\"ipam:vlan_bulk_edit\"),",
            "            data={",
            "                \"pk\": [str(vlan.id) for vlan in vlans],",
            "                \"add_cr_vlans_devices_m2m__source\": [str(device_for_association.id)],",
            "                \"_apply\": [\"\"],",
            "            },",
            "            follow=True,",
            "        )",
            "        self.assertContains(response, \"Updated 6 VLANs\")",
            "",
            "        # Try editing 6 VLANs and removing the required device (fails):",
            "        response = self.client.post(",
            "            reverse(\"ipam:vlan_bulk_edit\"),",
            "            data={",
            "                \"pk\": [str(vlan.id) for vlan in vlans],",
            "                \"remove_cr_vlans_devices_m2m__source\": [str(device_for_association.id)],",
            "                \"_apply\": [\"\"],",
            "            },",
            "        )",
            "        self.assertContains(",
            "            response,",
            "            \"6 VLANs require a device for the required relationship &quot;VLANs require at least one Device&quot;\",",
            "        )",
            "",
            "",
            "class RelationshipAssociationTestCase(",
            "    # TODO? ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    # TODO? ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.BulkDeleteObjectsViewTestCase,",
            "    # TODO? ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "):",
            "    model = RelationshipAssociation",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        device_type = ContentType.objects.get_for_model(Device)",
            "        vlan_type = ContentType.objects.get_for_model(VLAN)",
            "",
            "        # Since RelationshipAssociation.get_absolute_url() is actually the Relationship's URL,",
            "        # we want to have separate Relationships as well to allow distinguishing between them.",
            "        relationship_1 = Relationship(",
            "            label=\"Device VLANs 1\",",
            "            key=\"device_vlans_1\",",
            "            type=\"many-to-many\",",
            "            source_type=device_type,",
            "            destination_type=vlan_type,",
            "        )",
            "        relationship_2 = Relationship(",
            "            label=\"Device VLANs 2\",",
            "            key=\"device_vlans_2\",",
            "            type=\"many-to-many\",",
            "            source_type=device_type,",
            "            destination_type=vlan_type,",
            "        )",
            "        relationship_3 = Relationship(",
            "            label=\"Device VLANs 3\",",
            "            key=\"device_vlans_3\",",
            "            type=\"many-to-many\",",
            "            source_type=device_type,",
            "            destination_type=vlan_type,",
            "        )",
            "        cls.relationship = relationship_1",
            "        relationship_1.validated_save()",
            "        relationship_2.validated_save()",
            "        relationship_3.validated_save()",
            "        manufacturer = Manufacturer.objects.first()",
            "        devicetype = DeviceType.objects.create(manufacturer=manufacturer, model=\"Device Type 1\")",
            "        devicerole = Role.objects.get_for_model(Device).first()",
            "        devicestatus = Status.objects.get_for_model(Device).first()",
            "        location = Location.objects.first()",
            "        devices = (",
            "            Device.objects.create(",
            "                name=\"Device 1\", device_type=devicetype, role=devicerole, location=location, status=devicestatus",
            "            ),",
            "            Device.objects.create(",
            "                name=\"Device 2\", device_type=devicetype, role=devicerole, location=location, status=devicestatus",
            "            ),",
            "            Device.objects.create(",
            "                name=\"Device 3\", device_type=devicetype, role=devicerole, location=location, status=devicestatus",
            "            ),",
            "        )",
            "        vlan_status = Status.objects.get_for_model(VLAN).first()",
            "        vlan_group = VLANGroup.objects.first()",
            "        vlans = (",
            "            VLAN.objects.create(vid=1, name=\"VLAN 1\", status=vlan_status, vlan_group=vlan_group),",
            "            VLAN.objects.create(vid=2, name=\"VLAN 2\", status=vlan_status, vlan_group=vlan_group),",
            "            VLAN.objects.create(vid=3, name=\"VLAN 3\", status=vlan_status, vlan_group=vlan_group),",
            "        )",
            "",
            "        RelationshipAssociation(",
            "            relationship=relationship_1,",
            "            source_type=device_type,",
            "            source_id=devices[0].pk,",
            "            destination_type=vlan_type,",
            "            destination_id=vlans[0].pk,",
            "        ).validated_save()",
            "        RelationshipAssociation(",
            "            relationship=relationship_2,",
            "            source_type=device_type,",
            "            source_id=devices[1].pk,",
            "            destination_type=vlan_type,",
            "            destination_id=vlans[1].pk,",
            "        ).validated_save()",
            "        RelationshipAssociation(",
            "            relationship=relationship_3,",
            "            source_type=device_type,",
            "            source_id=devices[2].pk,",
            "            destination_type=vlan_type,",
            "            destination_id=vlans[2].pk,",
            "        ).validated_save()",
            "",
            "    def test_list_objects_with_constrained_permission(self):",
            "        instance1, instance2 = RelationshipAssociation.objects.all()[:2]",
            "",
            "        # Add object-level permission",
            "        obj_perm = ObjectPermission(",
            "            name=\"Test permission\",",
            "            constraints={\"pk\": instance1.pk},",
            "            actions=[\"view\"],",
            "        )",
            "        obj_perm.save()",
            "        obj_perm.users.add(self.user)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(self.model))",
            "",
            "        response = self.client.get(self._get_url(\"list\"))",
            "        self.assertHttpStatus(response, 200)",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "        # TODO: it'd make test failures more readable if we strip the page headers/footers from the content",
            "        self.assertIn(instance1.source.name, content, msg=content)",
            "        self.assertIn(instance1.destination.name, content, msg=content)",
            "        self.assertNotIn(instance2.source.name, content, msg=content)",
            "        self.assertNotIn(instance2.destination.name, content, msg=content)",
            "",
            "",
            "class StatusTestCase(",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "):",
            "    model = Status",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        # Status objects to test.",
            "        content_type = ContentType.objects.get_for_model(Device)",
            "",
            "        cls.form_data = {",
            "            \"name\": \"new_status\",",
            "            \"description\": \"I am a new status object.\",",
            "            \"color\": \"ffcc00\",",
            "            \"content_types\": [content_type.pk],",
            "        }",
            "",
            "        cls.csv_data = (",
            "            \"name,color,content_types\"",
            "            \"test_status1,ffffff,dcim.device\"",
            "            'test_status2,ffffff,\"dcim.device,dcim.location\"'",
            "            \"test_status3,ffffff,dcim.device\"",
            "            \"test_status4,ffffff,dcim.device\"",
            "        )",
            "",
            "        cls.bulk_edit_data = {",
            "            \"color\": \"000000\",",
            "        }",
            "",
            "",
            "class TagTestCase(ViewTestCases.OrganizationalObjectViewTestCase):",
            "    model = Tag",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        cls.form_data = {",
            "            \"name\": \"Tag X\",",
            "            \"color\": \"c0c0c0\",",
            "            \"comments\": \"Some comments\",",
            "            \"content_types\": [ct.id for ct in TaggableClassesQuery().as_queryset()],",
            "        }",
            "",
            "        cls.csv_data = (",
            "            \"name,color,description,content_types\",",
            "            \"Tag 4,ff0000,Fourth tag,dcim.device\",",
            "            'Tag 5,00ff00,Fifth tag,\"dcim.device,dcim.location\"',",
            "            \"Tag 6,0000ff,Sixth tag,dcim.location\",",
            "        )",
            "",
            "        cls.bulk_edit_data = {",
            "            \"color\": \"00ff00\",",
            "        }",
            "",
            "    def test_create_tags_with_content_types(self):",
            "        self.add_permissions(\"extras.add_tag\")",
            "        location_content_type = ContentType.objects.get_for_model(Location)",
            "",
            "        form_data = {",
            "            **self.form_data,",
            "            \"content_types\": [location_content_type.id],",
            "        }",
            "",
            "        request = {",
            "            \"path\": self._get_url(\"add\"),",
            "            \"data\": post_data(form_data),",
            "        }",
            "        self.assertHttpStatus(self.client.post(**request), 302)",
            "",
            "        tag = Tag.objects.filter(name=self.form_data[\"name\"])",
            "        self.assertTrue(tag.exists())",
            "        self.assertEqual(tag[0].content_types.first(), location_content_type)",
            "",
            "    def test_create_tags_with_invalid_content_types(self):",
            "        self.add_permissions(\"extras.add_tag\")",
            "        vlangroup_content_type = ContentType.objects.get_for_model(VLANGroup)",
            "",
            "        form_data = {",
            "            **self.form_data,",
            "            \"content_types\": [vlangroup_content_type.id],",
            "        }",
            "",
            "        request = {",
            "            \"path\": self._get_url(\"add\"),",
            "            \"data\": post_data(form_data),",
            "        }",
            "",
            "        response = self.client.post(**request)",
            "        tag = Tag.objects.filter(name=self.form_data[\"name\"])",
            "        self.assertFalse(tag.exists())",
            "        self.assertIn(\"content_types: Select a valid choice\", str(response.content))",
            "",
            "    def test_update_tags_remove_content_type(self):",
            "        \"\"\"Test removing a tag content_type that is been tagged to a model\"\"\"",
            "        self.add_permissions(\"extras.change_tag\")",
            "",
            "        tag_1 = Tag.objects.get_for_model(Location).first()",
            "        location = Location.objects.first()",
            "        location.tags.add(tag_1)",
            "",
            "        form_data = {",
            "            \"name\": tag_1.name,",
            "            \"color\": \"c0c0c0\",",
            "            \"content_types\": [ContentType.objects.get_for_model(Device).id],",
            "        }",
            "",
            "        request = {",
            "            \"path\": self._get_url(\"edit\", tag_1),",
            "            \"data\": post_data(form_data),",
            "        }",
            "",
            "        response = self.client.post(**request)",
            "        self.assertHttpStatus(",
            "            response, 200, [\"content_types: Unable to remove dcim.location. Dependent objects were found.\"]",
            "        )",
            "",
            "",
            "class WebhookTestCase(",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "):",
            "    model = Webhook",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        webhooks = (",
            "            Webhook(",
            "                name=\"webhook-1\",",
            "                enabled=True,",
            "                type_create=True,",
            "                payload_url=\"http://test-url.com/test-1\",",
            "                http_content_type=HTTP_CONTENT_TYPE_JSON,",
            "            ),",
            "            Webhook(",
            "                name=\"webhook-2\",",
            "                enabled=True,",
            "                type_update=True,",
            "                payload_url=\"http://test-url.com/test-2\",",
            "                http_content_type=HTTP_CONTENT_TYPE_JSON,",
            "            ),",
            "            Webhook(",
            "                name=\"webhook-3\",",
            "                enabled=True,",
            "                type_delete=True,",
            "                payload_url=\"http://test-url.com/test-3\",",
            "                http_content_type=HTTP_CONTENT_TYPE_JSON,",
            "            ),",
            "        )",
            "",
            "        obj_type = ContentType.objects.get_for_model(ConsolePort)",
            "",
            "        for webhook in webhooks:",
            "            webhook.save()",
            "            webhook.content_types.set([obj_type])",
            "",
            "        cls.form_data = {",
            "            \"name\": \"webhook-4\",",
            "            \"content_types\": [obj_type.pk],",
            "            \"enabled\": True,",
            "            \"type_create\": True,",
            "            \"payload_url\": \"http://test-url.com/test-4\",",
            "            \"http_method\": \"POST\",",
            "            \"http_content_type\": \"application/json\",",
            "        }",
            "",
            "",
            "class RoleTestCase(ViewTestCases.OrganizationalObjectViewTestCase):",
            "    model = Role",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        # Status objects to test.",
            "        content_type = ContentType.objects.get_for_model(Device)",
            "",
            "        cls.form_data = {",
            "            \"name\": \"New Role\",",
            "            \"description\": \"I am a new role object.\",",
            "            \"color\": ColorChoices.COLOR_GREY,",
            "            \"content_types\": [content_type.pk],",
            "        }",
            "",
            "        cls.csv_data = (",
            "            \"name,weight,color,content_types,description\",",
            "            \"test_role1,1000,ffffff,dcim.device,A Role\",",
            "            'test_role2,200,ffffff,\"dcim.device,dcim.rack\",A Role',",
            "            'test_role3,100,ffffff,\"dcim.device,ipam.prefix\",A Role',",
            "            'test_role4,50,ffffff,\"ipam.ipaddress,ipam.vlan\",A Role',",
            "            'test_role5,25,ffffff,\"virtualization.virtualmachine\",A Role',",
            "        )",
            "",
            "        cls.bulk_edit_data = {",
            "            \"color\": \"000000\",",
            "        }",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[\"*\"])",
            "    def test_view_with_content_types(self):",
            "        \"\"\"",
            "        Check that the expected panel headings are rendered and unexpected panel headings are not rendered",
            "        \"\"\"",
            "        eligible_ct_model_classes = RoleModelsQuery().list_subclasses()",
            "        for instance in self._get_queryset().all():",
            "            response = self.client.get(instance.get_absolute_url())",
            "            response_body = extract_page_body(response.content.decode(response.charset))",
            "            role_content_types = instance.content_types.all()",
            "            for model_class in eligible_ct_model_classes:",
            "                verbose_name_plural = model_class._meta.verbose_name_plural",
            "                content_type = ContentType.objects.get_for_model(model_class)",
            "                result = \" \".join(elem.capitalize() for elem in verbose_name_plural.split())",
            "                if result == \"Ip Addresses\":",
            "                    result = \"IP Addresses\"",
            "                elif result == \"Vlans\":",
            "                    result = \"VLANs\"",
            "                # Assert tables are correctly rendered",
            "                if content_type not in role_content_types:",
            "                    self.assertNotIn(f\"<strong>{result}</strong>\", response_body)",
            "                else:",
            "                    self.assertIn(f\"<strong>{result}</strong>\", response_body)"
        ],
        "afterPatchFile": [
            "from datetime import timedelta",
            "import urllib.parse",
            "import uuid",
            "",
            "from django.contrib.auth import get_user_model",
            "from django.contrib.contenttypes.models import ContentType",
            "from django.core.exceptions import ValidationError",
            "from django.test import override_settings",
            "from django.urls import reverse",
            "from django.utils import timezone",
            "from django.utils.html import format_html",
            "from unittest import mock",
            "",
            "from nautobot.core.choices import ColorChoices",
            "from nautobot.core.models.fields import slugify_dashes_to_underscores",
            "from nautobot.core.testing import ViewTestCases, TestCase, extract_page_body, extract_form_failures",
            "from nautobot.core.testing.utils import disable_warnings, post_data",
            "from nautobot.dcim.models import ConsolePort, Device, DeviceType, Interface, Manufacturer, Location, LocationType",
            "from nautobot.dcim.tests import test_views",
            "from nautobot.extras.choices import (",
            "    CustomFieldTypeChoices,",
            "    JobExecutionType,",
            "    ObjectChangeActionChoices,",
            "    SecretsGroupAccessTypeChoices,",
            "    SecretsGroupSecretTypeChoices,",
            ")",
            "from nautobot.extras.constants import HTTP_CONTENT_TYPE_JSON",
            "from nautobot.extras.models import (",
            "    ComputedField,",
            "    ConfigContext,",
            "    ConfigContextSchema,",
            "    CustomField,",
            "    CustomLink,",
            "    DynamicGroup,",
            "    ExportTemplate,",
            "    GitRepository,",
            "    GraphQLQuery,",
            "    Job,",
            "    JobButton,",
            "    JobResult,",
            "    Note,",
            "    ObjectChange,",
            "    Relationship,",
            "    RelationshipAssociation,",
            "    Role,",
            "    ScheduledJob,",
            "    Secret,",
            "    SecretsGroup,",
            "    SecretsGroupAssociation,",
            "    Status,",
            "    Tag,",
            "    Webhook,",
            ")",
            "from nautobot.extras.templatetags.job_buttons import NO_CONFIRM_BUTTON",
            "from nautobot.extras.tests.constants import BIG_GRAPHQL_DEVICE_QUERY",
            "from nautobot.extras.tests.test_relationships import RequiredRelationshipTestMixin",
            "from nautobot.extras.utils import RoleModelsQuery, TaggableClassesQuery",
            "from nautobot.ipam.models import IPAddress, Prefix, VLAN, VLANGroup",
            "from nautobot.users.models import ObjectPermission",
            "",
            "",
            "# Use the proper swappable User model",
            "User = get_user_model()",
            "",
            "",
            "class ComputedFieldTestCase(",
            "    ViewTestCases.BulkDeleteObjectsViewTestCase,",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "):",
            "    model = ComputedField",
            "    slug_source = \"label\"",
            "    slugify_function = staticmethod(slugify_dashes_to_underscores)",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        obj_type = ContentType.objects.get_for_model(Location)",
            "",
            "        computed_fields = (",
            "            ComputedField(",
            "                content_type=obj_type,",
            "                label=\"Computed Field One\",",
            "                key=\"computed_field_one\",",
            "                template=\"Location name is {{ obj.name }}\",",
            "                fallback_value=\"Template error\",",
            "                weight=100,",
            "            ),",
            "            ComputedField(",
            "                content_type=obj_type,",
            "                key=\"computed_field_two\",",
            "                label=\"Computed Field Two\",",
            "                template=\"Location name is {{ obj.name }}\",",
            "                fallback_value=\"Template error\",",
            "                weight=100,",
            "            ),",
            "            ComputedField(",
            "                content_type=obj_type,",
            "                key=\"computed_field_three\",",
            "                label=\"Computed Field Three\",",
            "                template=\"Location name is {{ obj.name }}\",",
            "                weight=100,",
            "            ),",
            "            ComputedField(",
            "                content_type=obj_type,",
            "                label=\"Computed Field Five\",",
            "                template=\"Location name is {{ obj.name }}\",",
            "                fallback_value=\"Template error\",",
            "                weight=100,",
            "            ),",
            "        )",
            "        cls.location_type = LocationType.objects.get(name=\"Campus\")",
            "        status = Status.objects.get_for_model(Location).first()",
            "        cls.location1 = Location(name=\"NYC\", location_type=cls.location_type, status=status)",
            "        cls.location1.save()",
            "",
            "        for cf in computed_fields:",
            "            cf.save()",
            "",
            "        cls.form_data = {",
            "            \"content_type\": obj_type.pk,",
            "            \"key\": \"computed_field_four\",",
            "            \"label\": \"Computed Field Four\",",
            "            \"template\": \"{{ obj.name }} is the best Location!\",",
            "            \"fallback_value\": \":skull_emoji:\",",
            "            \"weight\": 100,",
            "        }",
            "",
            "        cls.slug_test_object = \"Computed Field Five\"",
            "",
            "",
            "class ComputedFieldRenderingTestCase(TestCase):",
            "    \"\"\"Tests for the inclusion of ComputedFields, distinct from tests of the ComputedField views themselves.\"\"\"",
            "",
            "    user_permissions = [\"dcim.view_locationtype\"]",
            "",
            "    def setUp(self):",
            "        super().setUp()",
            "        self.computedfield = ComputedField(",
            "            content_type=ContentType.objects.get_for_model(LocationType),",
            "            key=\"test\",",
            "            label=\"Computed Field\",",
            "            template=\"FOO {{ obj.name }} BAR\",",
            "            fallback_value=\"Fallback Value\",",
            "            weight=100,",
            "        )",
            "        self.computedfield.validated_save()",
            "        self.location_type = LocationType.objects.get(name=\"Campus\")",
            "",
            "    def test_view_object_with_computed_field(self):",
            "        \"\"\"Ensure that the computed field template is rendered.\"\"\"",
            "        response = self.client.get(self.location_type.get_absolute_url(), follow=True)",
            "        self.assertEqual(response.status_code, 200)",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "        self.assertIn(f\"FOO {self.location_type.name} BAR\", content, content)",
            "",
            "    def test_view_object_with_computed_field_fallback_value(self):",
            "        \"\"\"Ensure that the fallback_value is rendered if the template fails to render.\"\"\"",
            "        # Make the template invalid to demonstrate the fallback value",
            "        self.computedfield.template = \"FOO {{ obj.\"",
            "        self.computedfield.validated_save()",
            "        response = self.client.get(self.location_type.get_absolute_url(), follow=True)",
            "        self.assertEqual(response.status_code, 200)",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "        self.assertIn(\"Fallback Value\", content, content)",
            "",
            "    def test_view_object_with_computed_field_unsafe_template(self):",
            "        \"\"\"Ensure that computed field templates can't be used as an XSS vector.\"\"\"",
            "        self.computedfield.template = '<script>alert(\"Hello world!\"</script>'",
            "        self.computedfield.validated_save()",
            "        response = self.client.get(self.location_type.get_absolute_url(), follow=True)",
            "        self.assertEqual(response.status_code, 200)",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "        self.assertNotIn(\"<script>alert\", content, content)",
            "        self.assertIn(\"&lt;script&gt;alert\", content, content)",
            "",
            "    def test_view_object_with_computed_field_unsafe_fallback_value(self):",
            "        \"\"\"Ensure that computed field fallback values can't be used as an XSS vector.\"\"\"",
            "        self.computedfield.template = \"FOO {{ obj.\"",
            "        self.computedfield.fallback_value = '<script>alert(\"Hello world!\"</script>'",
            "        self.computedfield.validated_save()",
            "        response = self.client.get(self.location_type.get_absolute_url(), follow=True)",
            "        self.assertEqual(response.status_code, 200)",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "        self.assertNotIn(\"<script>alert\", content, content)",
            "        self.assertIn(\"&lt;script&gt;alert\", content, content)",
            "",
            "",
            "# TODO: Change base class to PrimaryObjectViewTestCase",
            "# Blocked by absence of standard create/edit, bulk create views",
            "class ConfigContextTestCase(",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "    ViewTestCases.BulkEditObjectsViewTestCase,",
            "    ViewTestCases.BulkDeleteObjectsViewTestCase,",
            "):",
            "    model = ConfigContext",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        location = Location.objects.filter(location_type=LocationType.objects.get(name=\"Campus\")).first()",
            "",
            "        # Create three ConfigContexts",
            "        for i in range(1, 4):",
            "            configcontext = ConfigContext(name=f\"Config Context {i}\", data={\"foo\": i})",
            "            configcontext.save()",
            "            configcontext.locations.add(location)",
            "",
            "        cls.form_data = {",
            "            \"name\": \"Config Context X\",",
            "            \"weight\": 200,",
            "            \"description\": \"A new config context\",",
            "            \"is_active\": True,",
            "            \"regions\": [],",
            "            \"locations\": [location.pk],",
            "            \"roles\": [],",
            "            \"device_types\": [],",
            "            \"platforms\": [],",
            "            \"tenant_groups\": [],",
            "            \"tenants\": [],",
            "            \"tags\": [],",
            "            \"data\": '{\"foo\": 123}',",
            "        }",
            "",
            "        cls.bulk_edit_data = {",
            "            \"weight\": 300,",
            "            \"is_active\": False,",
            "            \"description\": \"New description\",",
            "        }",
            "",
            "    def test_schema_validation_pass(self):",
            "        \"\"\"",
            "        Given a config context schema",
            "        And a config context that conforms to that schema",
            "        Assert that the config context passes schema validation via full_clean()",
            "        \"\"\"",
            "        schema = ConfigContextSchema.objects.create(",
            "            name=\"Schema 1\", data_schema={\"type\": \"object\", \"properties\": {\"foo\": {\"type\": \"string\"}}}",
            "        )",
            "        self.add_permissions(\"extras.add_configcontext\")",
            "        self.add_permissions(\"extras.view_configcontextschema\")",
            "",
            "        form_data = {",
            "            \"name\": \"Config Context with schema\",",
            "            \"weight\": 200,",
            "            \"description\": \"A new config context\",",
            "            \"is_active\": True,",
            "            \"regions\": [],",
            "            \"locations\": [],",
            "            \"roles\": [],",
            "            \"device_types\": [],",
            "            \"platforms\": [],",
            "            \"tenant_groups\": [],",
            "            \"tenants\": [],",
            "            \"tags\": [],",
            "            \"data\": '{\"foo\": \"bar\"}',",
            "            \"config_context_schema\": schema.pk,",
            "        }",
            "",
            "        # Try POST with model-level permission",
            "        request = {",
            "            \"path\": self._get_url(\"add\"),",
            "            \"data\": post_data(form_data),",
            "        }",
            "        self.assertHttpStatus(self.client.post(**request), 302)",
            "        self.assertEqual(",
            "            self._get_queryset().get(name=\"Config Context with schema\").config_context_schema.pk, schema.pk",
            "        )",
            "",
            "    def test_schema_validation_fails(self):",
            "        \"\"\"",
            "        Given a config context schema",
            "        And a config context that *does not* conform to that schema",
            "        Assert that the config context fails schema validation via full_clean()",
            "        \"\"\"",
            "        schema = ConfigContextSchema.objects.create(",
            "            name=\"Schema 1\", data_schema={\"type\": \"object\", \"properties\": {\"foo\": {\"type\": \"integer\"}}}",
            "        )",
            "        self.add_permissions(\"extras.add_configcontext\")",
            "        self.add_permissions(\"extras.view_configcontextschema\")",
            "",
            "        form_data = {",
            "            \"name\": \"Config Context with bad schema\",",
            "            \"weight\": 200,",
            "            \"description\": \"A new config context\",",
            "            \"is_active\": True,",
            "            \"regions\": [],",
            "            \"locations\": [],",
            "            \"roles\": [],",
            "            \"device_types\": [],",
            "            \"platforms\": [],",
            "            \"tenant_groups\": [],",
            "            \"tenants\": [],",
            "            \"tags\": [],",
            "            \"data\": '{\"foo\": \"bar\"}',",
            "            \"config_context_schema\": schema.pk,",
            "        }",
            "",
            "        # Try POST with model-level permission",
            "        request = {",
            "            \"path\": self._get_url(\"add\"),",
            "            \"data\": post_data(form_data),",
            "        }",
            "        self.assertHttpStatus(self.client.post(**request), 200)",
            "        self.assertEqual(self._get_queryset().filter(name=\"Config Context with schema\").count(), 0)",
            "",
            "",
            "# This OrganizationalObjectViewTestCase less BulkImportObjectsViewTestCase",
            "# because it doesn't make sense to support CSV for schemas.",
            "class ConfigContextSchemaTestCase(",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "    ViewTestCases.BulkDeleteObjectsViewTestCase,",
            "    ViewTestCases.BulkEditObjectsViewTestCase,",
            "):",
            "    model = ConfigContextSchema",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        # Create three ConfigContextSchema records",
            "        ConfigContextSchema.objects.create(",
            "            name=\"Schema 1\", data_schema={\"type\": \"object\", \"properties\": {\"foo\": {\"type\": \"string\"}}}",
            "        )",
            "        ConfigContextSchema.objects.create(",
            "            name=\"Schema 2\", data_schema={\"type\": \"object\", \"properties\": {\"bar\": {\"type\": \"string\"}}}",
            "        )",
            "        ConfigContextSchema.objects.create(",
            "            name=\"Schema 3\", data_schema={\"type\": \"object\", \"properties\": {\"baz\": {\"type\": \"string\"}}}",
            "        )",
            "        ConfigContextSchema.objects.create(",
            "            name=\"Schema 4\", data_schema={\"type\": \"object\", \"properties\": {\"baz\": {\"type\": \"string\"}}}",
            "        )",
            "",
            "        cls.form_data = {",
            "            \"name\": \"Schema X\",",
            "            \"data_schema\": '{\"type\": \"object\",\"properties\": {\"baz\": {\"type\": \"string\"}}}',  # Intentionally misformatted (missing space) to ensure proper formatting on output",
            "        }",
            "",
            "        cls.bulk_edit_data = {",
            "            \"description\": \"New description\",",
            "        }",
            "",
            "",
            "class CustomLinkTestCase(",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "):",
            "    model = CustomLink",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        obj_type = ContentType.objects.get_for_model(Location)",
            "",
            "        customlinks = (",
            "            CustomLink(",
            "                content_type=obj_type,",
            "                name=\"customlink-1\",",
            "                text=\"customlink text 1\",",
            "                target_url=\"http://customlink1.com\",",
            "                weight=100,",
            "                button_class=\"default\",",
            "                new_window=False,",
            "            ),",
            "            CustomLink(",
            "                content_type=obj_type,",
            "                name=\"customlink-2\",",
            "                text=\"customlink text 2\",",
            "                target_url=\"http://customlink2.com\",",
            "                weight=100,",
            "                button_class=\"default\",",
            "                new_window=False,",
            "            ),",
            "            CustomLink(",
            "                content_type=obj_type,",
            "                name=\"customlink-3\",",
            "                text=\"customlink text 3\",",
            "                target_url=\"http://customlink3.com\",",
            "                weight=100,",
            "                button_class=\"default\",",
            "                new_window=False,",
            "            ),",
            "        )",
            "",
            "        for link in customlinks:",
            "            link.save()",
            "",
            "        cls.form_data = {",
            "            \"content_type\": obj_type.pk,",
            "            \"name\": \"customlink-4\",",
            "            \"text\": \"customlink text 4\",",
            "            \"target_url\": \"http://customlink4.com\",",
            "            \"weight\": 100,",
            "            \"button_class\": \"default\",",
            "            \"new_window\": False,",
            "        }",
            "",
            "",
            "class CustomFieldTestCase(",
            "    # No NotesViewTestCase or BulkImportObjectsViewTestCase, at least for now",
            "    ViewTestCases.BulkDeleteObjectsViewTestCase,",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "):",
            "    model = CustomField",
            "    slugify_function = staticmethod(slugify_dashes_to_underscores)",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        obj_type = ContentType.objects.get_for_model(Location)",
            "",
            "        custom_fields = [",
            "            CustomField(",
            "                type=CustomFieldTypeChoices.TYPE_BOOLEAN,",
            "                label=\"Custom Field Boolean Type\",",
            "                default=\"\",",
            "            ),",
            "            CustomField(",
            "                type=CustomFieldTypeChoices.TYPE_TEXT,",
            "                label=\"Custom Field Text\",",
            "                default=\"\",",
            "            ),",
            "            CustomField(",
            "                type=CustomFieldTypeChoices.TYPE_INTEGER,",
            "                label=\"Custom Field Integer\",",
            "                default=\"\",",
            "            ),",
            "            CustomField(",
            "                type=CustomFieldTypeChoices.TYPE_TEXT,",
            "                # https://github.com/nautobot/nautobot/issues/1962",
            "                label=\"Custom field? With special / unusual characters!\",",
            "                default=\"\",",
            "            ),",
            "        ]",
            "",
            "        cls.slug_test_object = \"Custom Field Integer\"",
            "",
            "        for custom_field in custom_fields:",
            "            custom_field.validated_save()",
            "            custom_field.content_types.set([obj_type])",
            "",
            "        cls.form_data = {",
            "            \"content_types\": [obj_type.pk],",
            "            \"type\": CustomFieldTypeChoices.TYPE_BOOLEAN,  # type is mandatory but cannot be changed once set.",
            "            \"key\": \"custom_field_boolean_type\",  # key is mandatory but cannot be changed once set.",
            "            \"label\": \"Custom Field Boolean\",",
            "            \"default\": None,",
            "            \"filter_logic\": \"loose\",",
            "            \"weight\": 100,",
            "            # These are the \"management_form\" fields required by the dynamic CustomFieldChoice formsets.",
            "            \"custom_field_choices-TOTAL_FORMS\": \"0\",  # Set to 0 so validation succeeds until we need it",
            "            \"custom_field_choices-INITIAL_FORMS\": \"1\",",
            "            \"custom_field_choices-MIN_NUM_FORMS\": \"0\",",
            "            \"custom_field_choices-MAX_NUM_FORMS\": \"1000\",",
            "        }",
            "",
            "    def test_create_object_without_permission(self):",
            "        # Can't have two CustomFields with the same \"key\"",
            "        self.form_data = self.form_data.copy()",
            "        self.form_data[\"key\"] = \"custom_field_boolean_2\"",
            "        super().test_create_object_without_permission()",
            "",
            "    def test_create_object_with_permission(self):",
            "        # Can't have two CustomFields with the same \"key\"",
            "        self.form_data = self.form_data.copy()",
            "        self.form_data[\"key\"] = \"custom_field_boolean_2\"",
            "        super().test_create_object_with_permission()",
            "",
            "    def test_create_object_with_constrained_permission(self):",
            "        # Can't have two CustomFields with the same \"key\"",
            "        self.form_data = self.form_data.copy()",
            "        self.form_data[\"key\"] = \"custom_field_boolean_2\"",
            "        super().test_create_object_with_constrained_permission()",
            "",
            "",
            "class CustomLinkRenderingTestCase(TestCase):",
            "    \"\"\"Tests for the inclusion of CustomLinks, distinct from tests of the CustomLink views themselves.\"\"\"",
            "",
            "    user_permissions = [\"dcim.view_location\"]",
            "",
            "    def test_view_object_with_custom_link(self):",
            "        customlink = CustomLink(",
            "            content_type=ContentType.objects.get_for_model(Location),",
            "            name=\"Test\",",
            "            text=\"FOO {{ obj.name }} BAR\",",
            "            target_url=\"http://example.com/?location={{ obj.name }}\",",
            "            new_window=False,",
            "        )",
            "        customlink.save()",
            "        location_type = LocationType.objects.get(name=\"Campus\")",
            "        status = Status.objects.get_for_model(Location).first()",
            "        location = Location(name=\"Test Location\", location_type=location_type, status=status)",
            "        location.save()",
            "",
            "        response = self.client.get(location.get_absolute_url(), follow=True)",
            "        self.assertEqual(response.status_code, 200)",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "        self.assertIn(f\"FOO {location.name} BAR\", content, content)",
            "",
            "    def test_view_object_with_unsafe_custom_link_text(self):",
            "        \"\"\"Ensure that custom links can't be used as a vector for injecting scripts or breaking HTML.\"\"\"",
            "        customlink = CustomLink(",
            "            content_type=ContentType.objects.get_for_model(Location),",
            "            name=\"Test\",",
            "            text='<script>alert(\"Hello world!\")</script>',",
            "            target_url=\"http://example.com/?location=None\",",
            "            new_window=False,",
            "        )",
            "        customlink.validated_save()",
            "        location_type = LocationType.objects.get(name=\"Campus\")",
            "        status = Status.objects.get_for_model(Location).first()",
            "        location = Location(name=\"Test Location\", location_type=location_type, status=status)",
            "        location.save()",
            "",
            "        response = self.client.get(location.get_absolute_url(), follow=True)",
            "        self.assertEqual(response.status_code, 200)",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "        self.assertNotIn(\"<script>alert\", content, content)",
            "        self.assertIn(\"&lt;script&gt;alert\", content, content)",
            "        self.assertIn(format_html('<a href=\"{}\"', customlink.target_url), content, content)",
            "",
            "    def test_view_object_with_unsafe_custom_link_url(self):",
            "        \"\"\"Ensure that custom links can't be used as a vector for injecting scripts or breaking HTML.\"\"\"",
            "        customlink = CustomLink(",
            "            content_type=ContentType.objects.get_for_model(Location),",
            "            name=\"Test\",",
            "            text=\"Hello\",",
            "            target_url='\"><script>alert(\"Hello world!\")</script><a href=\"',",
            "            new_window=False,",
            "        )",
            "        customlink.validated_save()",
            "        location_type = LocationType.objects.get(name=\"Campus\")",
            "        status = Status.objects.get_for_model(Location).first()",
            "        location = Location(name=\"Test Location\", location_type=location_type, status=status)",
            "        location.save()",
            "",
            "        response = self.client.get(location.get_absolute_url(), follow=True)",
            "        self.assertEqual(response.status_code, 200)",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "        self.assertNotIn(\"<script>alert\", content, content)",
            "        self.assertIn(\"&lt;script&gt;alert\", content, content)",
            "        self.assertIn(format_html('<a href=\"{}\"', customlink.target_url), content, content)",
            "",
            "    def test_view_object_with_unsafe_custom_link_name(self):",
            "        \"\"\"Ensure that custom links can't be used as a vector for injecting scripts or breaking HTML.\"\"\"",
            "        customlink = CustomLink(",
            "            content_type=ContentType.objects.get_for_model(Location),",
            "            name='<script>alert(\"Hello World\")</script>',",
            "            text=\"Hello\",",
            "            target_url=\"http://example.com/?location={{ obj.name \",  # intentionally bad jinja2 to trigger error case",
            "            new_window=False,",
            "        )",
            "        customlink.validated_save()",
            "        location_type = LocationType.objects.get(name=\"Campus\")",
            "        status = Status.objects.get_for_model(Location).first()",
            "        location = Location(name=\"Test Location\", location_type=location_type, status=status)",
            "        location.save()",
            "",
            "        response = self.client.get(location.get_absolute_url(), follow=True)",
            "        self.assertEqual(response.status_code, 200)",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "        self.assertNotIn(\"<script>alert\", content, content)",
            "        self.assertIn(\"&lt;script&gt;alert\", content, content)",
            "",
            "",
            "class DynamicGroupTestCase(",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "    ViewTestCases.BulkDeleteObjectsViewTestCase,",
            "    # NOTE: This isn't using `ViewTestCases.PrimaryObjectViewTestCase` because bulk-import/edit",
            "    # views for DynamicGroup do not make sense at this time, primarily because `content_type` is",
            "    # immutable after create.",
            "):",
            "    model = DynamicGroup",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        content_type = ContentType.objects.get_for_model(Device)",
            "",
            "        # DynamicGroup objects to test.",
            "        DynamicGroup.objects.create(name=\"DG 1\", content_type=content_type)",
            "        DynamicGroup.objects.create(name=\"DG 2\", content_type=content_type)",
            "        DynamicGroup.objects.create(name=\"DG 3\", content_type=content_type)",
            "",
            "        cls.form_data = {",
            "            \"name\": \"new_dynamic_group\",",
            "            \"description\": \"I am a new dynamic group object.\",",
            "            \"content_type\": content_type.pk,",
            "            # Management form fields required for the dynamic formset",
            "            \"dynamic_group_memberships-TOTAL_FORMS\": \"0\",",
            "            \"dynamic_group_memberships-INITIAL_FORMS\": \"1\",",
            "            \"dynamic_group_memberships-MIN_NUM_FORMS\": \"0\",",
            "            \"dynamic_group_memberships-MAX_NUM_FORMS\": \"1000\",",
            "        }",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[\"*\"])",
            "    def test_edit_saved_filter(self):",
            "        \"\"\"Test that editing a filter works using the edit view.\"\"\"",
            "        self.add_permissions(\"extras.add_dynamicgroup\", \"extras.change_dynamicgroup\")",
            "",
            "        # Create the object first.",
            "        data = self.form_data.copy()",
            "        request = {",
            "            \"path\": self._get_url(\"add\"),",
            "            \"data\": post_data(data),",
            "        }",
            "        self.assertHttpStatus(self.client.post(**request), 302)",
            "",
            "        # Now update it.",
            "        instance = self._get_queryset().get(name=data[\"name\"])",
            "        data[\"filter-serial\"] = [\"abc123\"]",
            "        request = {",
            "            \"path\": self._get_url(\"edit\", instance),",
            "            \"data\": post_data(data),",
            "        }",
            "        self.assertHttpStatus(self.client.post(**request), 302)",
            "",
            "        instance.refresh_from_db()",
            "        self.assertEqual(instance.filter, {\"serial\": data[\"filter-serial\"]})",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[\"*\"])",
            "    def test_filter_by_content_type(self):",
            "        \"\"\"",
            "        Test that filtering by `content_type` in the UI succeeds.",
            "",
            "        This is a regression test for https://github.com/nautobot/nautobot/issues/3612",
            "        \"\"\"",
            "        path = self._get_url(\"list\")",
            "        response = self.client.get(path + \"?content_type=dcim.device\")",
            "        self.assertHttpStatus(response, 200)",
            "",
            "",
            "class ExportTemplateTestCase(",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "):",
            "    model = ExportTemplate",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        obj_type = ContentType.objects.get_for_model(Location)",
            "",
            "        templates = (",
            "            ExportTemplate(",
            "                name=\"template-1\",",
            "                template_code=\"template-1 test1\",",
            "                content_type=obj_type,",
            "            ),",
            "            ExportTemplate(",
            "                name=\"template-2\",",
            "                template_code=\"template-2 test2\",",
            "                content_type=obj_type,",
            "            ),",
            "            ExportTemplate(",
            "                name=\"template-3\",",
            "                template_code=\"template-3 test3\",",
            "                content_type=obj_type,",
            "            ),",
            "        )",
            "",
            "        for template in templates:",
            "            template.save()",
            "",
            "        cls.form_data = {",
            "            \"name\": \"template-4\",",
            "            \"content_type\": obj_type.pk,",
            "            \"template_code\": \"template-4 test4\",",
            "        }",
            "",
            "",
            "class GitRepositoryTestCase(",
            "    ViewTestCases.BulkDeleteObjectsViewTestCase,",
            "    ViewTestCases.BulkImportObjectsViewTestCase,",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "):",
            "    model = GitRepository",
            "    slugify_function = staticmethod(slugify_dashes_to_underscores)",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        secrets_groups = (",
            "            SecretsGroup.objects.create(name=\"Secrets Group 1\"),",
            "            SecretsGroup.objects.create(name=\"Secrets Group 2\"),",
            "        )",
            "",
            "        # Create four GitRepository records",
            "        repos = (",
            "            GitRepository(name=\"Repo 1\", slug=\"repo_1\", remote_url=\"https://example.com/repo1.git\"),",
            "            GitRepository(name=\"Repo 2\", slug=\"repo_2\", remote_url=\"https://example.com/repo2.git\"),",
            "            GitRepository(name=\"Repo 3\", slug=\"repo_3\", remote_url=\"https://example.com/repo3.git\"),",
            "            GitRepository(name=\"Repo 4\", remote_url=\"https://example.com/repo4.git\", secrets_group=secrets_groups[0]),",
            "        )",
            "        for repo in repos:",
            "            repo.validated_save()",
            "",
            "        cls.form_data = {",
            "            \"name\": \"A new Git repository\",",
            "            \"slug\": \"a_new_git_repository\",",
            "            \"remote_url\": \"http://example.com/a_new_git_repository.git\",",
            "            \"branch\": \"develop\",",
            "            \"_token\": \"1234567890abcdef1234567890abcdef\",",
            "            \"secrets_group\": secrets_groups[1].pk,",
            "            \"provided_contents\": [",
            "                \"extras.configcontext\",",
            "                \"extras.job\",",
            "                \"extras.exporttemplate\",",
            "            ],",
            "        }",
            "",
            "        cls.csv_data = (",
            "            \"name,slug,remote_url,branch,secrets_group,provided_contents\",",
            "            \"Git Repository 5,git_repo_5,https://example.com,main,,extras.configcontext\",",
            "            \"Git Repository 6,git_repo_6,https://example.com,develop,Secrets Group 2,\",",
            "            'Git Repository 7,git_repo_7,https://example.com,next,Secrets Group 2,\"extras.job,extras.configcontext\"',",
            "        )",
            "",
            "        cls.slug_source = \"name\"",
            "        cls.slug_test_object = \"Repo 4\"",
            "",
            "    def test_edit_object_with_permission(self):",
            "        instance = self._get_queryset().first()",
            "        form_data = self.form_data.copy()",
            "        form_data[\"slug\"] = instance.slug  # Slug is not editable",
            "        self.form_data = form_data",
            "        super().test_edit_object_with_permission()",
            "",
            "    def test_edit_object_with_constrained_permission(self):",
            "        instance = self._get_queryset().first()",
            "        form_data = self.form_data.copy()",
            "        form_data[\"slug\"] = instance.slug  # Slug is not editable",
            "        self.form_data = form_data",
            "        super().test_edit_object_with_constrained_permission()",
            "",
            "",
            "class NoteTestCase(",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "):",
            "    model = Note",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        content_type = ContentType.objects.get_for_model(Location)",
            "        cls.location = Location.objects.filter(location_type=LocationType.objects.get(name=\"Campus\")).first()",
            "        user = User.objects.first()",
            "",
            "        # Notes Objects to test",
            "        Note.objects.create(",
            "            note=\"Location has been placed on maintenance.\",",
            "            user=user,",
            "            assigned_object_type=content_type,",
            "            assigned_object_id=cls.location.pk,",
            "        )",
            "        Note.objects.create(",
            "            note=\"Location maintenance has ended.\",",
            "            user=user,",
            "            assigned_object_type=content_type,",
            "            assigned_object_id=cls.location.pk,",
            "        )",
            "        Note.objects.create(",
            "            note=\"Location is under duress.\",",
            "            user=user,",
            "            assigned_object_type=content_type,",
            "            assigned_object_id=cls.location.pk,",
            "        )",
            "",
            "        cls.form_data = {",
            "            \"note\": \"This is Location note.\",",
            "            \"assigned_object_type\": content_type.pk,",
            "            \"assigned_object_id\": cls.location.pk,",
            "        }",
            "        cls.expected_object_note = '<textarea name=\"object_note\" cols=\"40\" rows=\"10\" class=\"form-control\" placeholder=\"Note\" id=\"id_object_note\"></textarea>'",
            "",
            "    def test_note_on_bulk_update_perms(self):",
            "        self.add_permissions(\"dcim.add_location\", \"extras.add_note\")",
            "        response = self.client.get(reverse(\"dcim:location_add\"))",
            "        self.assertContains(response, self.expected_object_note, html=True)",
            "",
            "    def test_note_on_bulk_update_no_perms(self):",
            "        self.add_permissions(\"dcim.add_location\")",
            "        response = self.client.get(reverse(\"dcim:location_add\"))",
            "        self.assertNotContains(response, self.expected_object_note, html=True)",
            "",
            "    def test_note_on_create_edit_perms(self):",
            "        self.add_permissions(\"dcim.change_location\", \"extras.add_note\")",
            "        response = self.client.post(reverse(\"dcim:location_bulk_edit\"), data={\"pk\": self.location.pk})",
            "        self.assertContains(response, self.expected_object_note, html=True)",
            "",
            "    def test_note_on_create_edit_no_perms(self):",
            "        self.add_permissions(\"dcim.change_location\")",
            "        response = self.client.post(reverse(\"dcim:location_bulk_edit\"), data={\"pk\": self.location.pk})",
            "        self.assertNotContains(response, self.expected_object_note, html=True)",
            "",
            "",
            "# Not a full-fledged PrimaryObjectViewTestCase as there's no BulkEditView for Secrets",
            "class SecretTestCase(",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "    ViewTestCases.BulkImportObjectsViewTestCase,",
            "    ViewTestCases.BulkDeleteObjectsViewTestCase,",
            "):",
            "    model = Secret",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        secrets = (",
            "            Secret(",
            "                name=\"View Test 1\",",
            "                provider=\"environment-variable\",",
            "                parameters={\"variable\": \"VIEW_TEST_1\"},",
            "                tags=[t.pk for t in Tag.objects.get_for_model(Secret)],",
            "            ),",
            "            Secret(",
            "                name=\"View Test 2\",",
            "                provider=\"environment-variable\",",
            "                parameters={\"variable\": \"VIEW_TEST_2\"},",
            "            ),",
            "            Secret(",
            "                name=\"View Test 3\",",
            "                provider=\"environment-variable\",",
            "                parameters={\"variable\": \"VIEW_TEST_3\"},",
            "            ),",
            "        )",
            "",
            "        for secret in secrets:",
            "            secret.validated_save()",
            "",
            "        cls.form_data = {",
            "            \"name\": \"View Test 4\",",
            "            \"provider\": \"environment-variable\",",
            "            \"parameters\": '{\"variable\": \"VIEW_TEST_4\"}',",
            "        }",
            "",
            "        cls.csv_data = (",
            "            \"name,provider,parameters\",",
            "            'View Test 5,environment-variable,{\"variable\": \"VIEW_TEST_5\"}',",
            "            'View Test 6,environment-variable,{\"variable\": \"VIEW_TEST_6\"}',",
            "            'View Test 7,environment-variable,{\"variable\": \"VIEW_TEST_7\"}',",
            "        )",
            "",
            "",
            "# Not a full-fledged OrganizationalObjectViewTestCase as there's no BulkImportView for SecretsGroups",
            "class SecretsGroupTestCase(",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "    ViewTestCases.BulkDeleteObjectsViewTestCase,",
            "):",
            "    model = SecretsGroup",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        secrets_groups = (",
            "            SecretsGroup.objects.create(name=\"Group 1\", description=\"First Group\"),",
            "            SecretsGroup.objects.create(name=\"Group 2\"),",
            "            SecretsGroup.objects.create(name=\"Group 3\"),",
            "        )",
            "",
            "        secrets = (",
            "            Secret.objects.create(name=\"secret 1\", provider=\"text-file\", parameters={\"path\": \"/tmp\"}),",
            "            Secret.objects.create(name=\"secret 2\", provider=\"text-file\", parameters={\"path\": \"/tmp\"}),",
            "            Secret.objects.create(name=\"secret 3\", provider=\"text-file\", parameters={\"path\": \"/tmp\"}),",
            "        )",
            "",
            "        SecretsGroupAssociation.objects.create(",
            "            secrets_group=secrets_groups[0],",
            "            secret=secrets[0],",
            "            access_type=SecretsGroupAccessTypeChoices.TYPE_GENERIC,",
            "            secret_type=SecretsGroupSecretTypeChoices.TYPE_USERNAME,",
            "        )",
            "        SecretsGroupAssociation.objects.create(",
            "            secrets_group=secrets_groups[0],",
            "            secret=secrets[1],",
            "            access_type=SecretsGroupAccessTypeChoices.TYPE_GENERIC,",
            "            secret_type=SecretsGroupSecretTypeChoices.TYPE_PASSWORD,",
            "        )",
            "        SecretsGroupAssociation.objects.create(",
            "            secrets_group=secrets_groups[1],",
            "            secret=secrets[1],",
            "            access_type=SecretsGroupAccessTypeChoices.TYPE_GENERIC,",
            "            secret_type=SecretsGroupSecretTypeChoices.TYPE_PASSWORD,",
            "        )",
            "",
            "        cls.form_data = {",
            "            \"name\": \"Group 4\",",
            "            \"description\": \"Some description\",",
            "            # Management form fields required for the dynamic Secret formset",
            "            \"secrets_group_associations-TOTAL_FORMS\": \"0\",",
            "            \"secrets_group_associations-INITIAL_FORMS\": \"1\",",
            "            \"secrets_group_associations-MIN_NUM_FORMS\": \"0\",",
            "            \"secrets_group_associations-MAX_NUM_FORMS\": \"1000\",",
            "        }",
            "",
            "",
            "class GraphQLQueriesTestCase(",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "):",
            "    model = GraphQLQuery",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        graphqlqueries = (",
            "            GraphQLQuery(",
            "                name=\"graphql-query-1\",",
            "                query=\"{ query: locations {name} }\",",
            "            ),",
            "            GraphQLQuery(",
            "                name=\"graphql-query-2\",",
            "                query='{ devices(role: \"edge\") { id, name, device_role { name } } }',",
            "            ),",
            "            GraphQLQuery(",
            "                name=\"graphql-query-3\",",
            "                query=BIG_GRAPHQL_DEVICE_QUERY,",
            "            ),",
            "            GraphQLQuery(",
            "                name=\"Graphql Query 5\",",
            "                query='{ devices(role: \"edge\") { id, name, device_role { name } } }',",
            "            ),",
            "        )",
            "",
            "        for query in graphqlqueries:",
            "            query.full_clean()",
            "            query.save()",
            "",
            "        cls.form_data = {",
            "            \"name\": \"graphql-query-4\",",
            "            \"query\": \"{query: locations {name}}\",",
            "        }",
            "",
            "",
            "#",
            "# Jobs, Scheduling, and Approvals",
            "#",
            "",
            "",
            "class ScheduledJobTestCase(",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.BulkDeleteObjectsViewTestCase,",
            "):",
            "    model = ScheduledJob",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        user = User.objects.create(username=\"user1\", is_active=True)",
            "        ScheduledJob.objects.create(",
            "            name=\"test1\",",
            "            task=\"pass.TestPass\",",
            "            interval=JobExecutionType.TYPE_IMMEDIATELY,",
            "            user=user,",
            "            start_time=timezone.now(),",
            "        )",
            "        ScheduledJob.objects.create(",
            "            name=\"test2\",",
            "            task=\"pass.TestPass\",",
            "            interval=JobExecutionType.TYPE_IMMEDIATELY,",
            "            user=user,",
            "            start_time=timezone.now(),",
            "        )",
            "        ScheduledJob.objects.create(",
            "            name=\"test3\",",
            "            task=\"pass.TestPass\",",
            "            interval=JobExecutionType.TYPE_IMMEDIATELY,",
            "            user=user,",
            "            start_time=timezone.now(),",
            "        )",
            "",
            "    def test_only_enabled_is_listed(self):",
            "        self.add_permissions(\"extras.view_scheduledjob\")",
            "",
            "        # this should not appear, since it\u2019s not enabled",
            "        ScheduledJob.objects.create(",
            "            enabled=False,",
            "            name=\"test4\",",
            "            task=\"pass.TestPass\",",
            "            interval=JobExecutionType.TYPE_IMMEDIATELY,",
            "            user=self.user,",
            "            start_time=timezone.now(),",
            "        )",
            "",
            "        response = self.client.get(self._get_url(\"list\"))",
            "        self.assertHttpStatus(response, 200)",
            "        self.assertNotIn(\"test4\", extract_page_body(response.content.decode(response.charset)))",
            "",
            "    def test_non_valid_crontab_syntax(self):",
            "        self.add_permissions(\"extras.view_scheduledjob\")",
            "",
            "        def scheduled_job_factory(name, crontab):",
            "            ScheduledJob.objects.create(",
            "                enabled=True,",
            "                name=name,",
            "                task=\"pass.TestPass\",",
            "                interval=JobExecutionType.TYPE_CUSTOM,",
            "                user=self.user,",
            "                start_time=timezone.now(),",
            "                crontab=crontab,",
            "            )",
            "",
            "        with self.assertRaises(ValidationError):",
            "            scheduled_job_factory(\"test5\", None)",
            "",
            "        with self.assertRaises(ValidationError):",
            "            scheduled_job_factory(\"test6\", \"\")",
            "",
            "        with self.assertRaises(ValidationError):",
            "            scheduled_job_factory(\"test7\", \"not_enough_values_to_unpack\")",
            "",
            "        with self.assertRaises(ValidationError):",
            "            scheduled_job_factory(\"test8\", \"one too many values to unpack\")",
            "",
            "        with self.assertRaises(ValidationError):",
            "            scheduled_job_factory(\"test9\", \"-1 * * * *\")",
            "",
            "        with self.assertRaises(ValidationError):",
            "            scheduled_job_factory(\"test10\", \"invalid literal * * *\")",
            "",
            "    def test_valid_crontab_syntax(self):",
            "        self.add_permissions(\"extras.view_scheduledjob\")",
            "",
            "        ScheduledJob.objects.create(",
            "            enabled=True,",
            "            name=\"test11\",",
            "            task=\"pass.TestPass\",",
            "            interval=JobExecutionType.TYPE_CUSTOM,",
            "            user=self.user,",
            "            start_time=timezone.now(),",
            "            crontab=\"*/15 9,17 3 * 1-5\",",
            "        )",
            "",
            "        response = self.client.get(self._get_url(\"list\"))",
            "        self.assertHttpStatus(response, 200)",
            "        self.assertIn(\"test11\", extract_page_body(response.content.decode(response.charset)))",
            "",
            "",
            "class ApprovalQueueTestCase(",
            "    # It would be nice to use ViewTestCases.GetObjectViewTestCase as well,",
            "    # but we can't directly use it as it uses instance.get_absolute_url() rather than self._get_url(\"view\", instance)",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "):",
            "    model = ScheduledJob",
            "    # Many interactions with a ScheduledJob also require permissions to view the associated Job",
            "    user_permissions = (\"extras.view_job\",)",
            "",
            "    def _get_url(self, action, instance=None):",
            "        if action == \"list\":",
            "            return reverse(\"extras:scheduledjob_approval_queue_list\")",
            "        if action == \"view\" and instance is not None:",
            "            return reverse(\"extras:scheduledjob_approval_request_view\", kwargs={\"pk\": instance.pk})",
            "        raise ValueError(\"This override is only valid for list and view test cases\")",
            "",
            "    def setUp(self):",
            "        super().setUp()",
            "        self.job_model = Job.objects.get_for_class_path(\"dry_run.TestDryRun\")",
            "        self.job_model_2 = Job.objects.get_for_class_path(\"fail.TestFail\")",
            "",
            "        ScheduledJob.objects.create(",
            "            name=\"test1\",",
            "            task=\"dry_run.TestDryRun\",",
            "            job_model=self.job_model,",
            "            interval=JobExecutionType.TYPE_IMMEDIATELY,",
            "            user=self.user,",
            "            approval_required=True,",
            "            start_time=timezone.now(),",
            "        )",
            "        ScheduledJob.objects.create(",
            "            name=\"test2\",",
            "            task=\"fail.TestFail\",",
            "            job_model=self.job_model_2,",
            "            interval=JobExecutionType.TYPE_IMMEDIATELY,",
            "            user=self.user,",
            "            approval_required=True,",
            "            start_time=timezone.now(),",
            "        )",
            "",
            "    def test_only_approvable_is_listed(self):",
            "        self.add_permissions(\"extras.view_scheduledjob\")",
            "",
            "        ScheduledJob.objects.create(",
            "            name=\"test4\",",
            "            task=\"pass.TestPass\",",
            "            job_model=self.job_model,",
            "            interval=JobExecutionType.TYPE_IMMEDIATELY,",
            "            user=self.user,",
            "            approval_required=False,",
            "            start_time=timezone.now(),",
            "        )",
            "",
            "        response = self.client.get(self._get_url(\"list\"))",
            "        self.assertHttpStatus(response, 200)",
            "        self.assertNotIn(\"test4\", extract_page_body(response.content.decode(response.charset)))",
            "",
            "    #",
            "    # Reimplementations of ViewTestCases.GetObjectViewTestCase test functions.",
            "    # Needed because those use instance.get_absolute_url() instead of self._get_url(\"view\", instance)...",
            "    #",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[\"*\"])",
            "    def test_get_object_anonymous(self):",
            "        self.client.logout()",
            "        response = self.client.get(self._get_url(\"view\", self._get_queryset().first()))",
            "        self.assertHttpStatus(response, 200)",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[])",
            "    def test_get_object_without_permission(self):",
            "        instance = self._get_queryset().first()",
            "",
            "        with disable_warnings(\"django.request\"):",
            "            self.assertHttpStatus(self.client.get(self._get_url(\"view\", instance)), 403)",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[])",
            "    def test_get_object_with_permission(self):",
            "        instance = self._get_queryset().first()",
            "",
            "        # Add model-level permission",
            "        obj_perm = ObjectPermission(name=\"Test permission\", actions=[\"view\"])",
            "        obj_perm.save()",
            "        obj_perm.users.add(self.user)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(self.model))",
            "",
            "        # Try GET with model-level permission",
            "        response = self.client.get(self._get_url(\"view\", instance))",
            "        self.assertHttpStatus(response, 200)",
            "",
            "        response_body = extract_page_body(response.content.decode(response.charset))",
            "",
            "        # The object's display name or string representation should appear in the response",
            "        self.assertIn(getattr(instance, \"display\", str(instance)), response_body, msg=response_body)",
            "",
            "        # skip GetObjectViewTestCase checks for Relationships and Custom Fields since this isn't actually a detail view",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[])",
            "    def test_get_object_with_constrained_permission(self):",
            "        instance1, instance2 = self._get_queryset().all()[:2]",
            "",
            "        # Add object-level permission",
            "        obj_perm = ObjectPermission(",
            "            name=\"Test permission\",",
            "            constraints={\"pk\": instance1.pk},",
            "            # To get a different rendering flow than the \"test_get_object_with_permission\" test above,",
            "            # enable additional permissions for this object so that interaction buttons are rendered.",
            "            actions=[\"view\", \"add\", \"change\", \"delete\"],",
            "        )",
            "        obj_perm.save()",
            "        obj_perm.users.add(self.user)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(self.model))",
            "",
            "        # Try GET to permitted object",
            "        self.assertHttpStatus(self.client.get(self._get_url(\"view\", instance1)), 200)",
            "",
            "        # Try GET to non-permitted object",
            "        self.assertHttpStatus(self.client.get(self._get_url(\"view\", instance2)), 404)",
            "",
            "    #",
            "    # Additional test cases specific to the job approval view",
            "    #",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[\"*\"])",
            "    def test_post_anonymous(self):",
            "        \"\"\"Anonymous users may not take any action with regard to job approval requests.\"\"\"",
            "        self.client.logout()",
            "        response = self.client.post(self._get_url(\"view\", self._get_queryset().first()))",
            "        self.assertHttpStatus(response, 200)",
            "        response_body = extract_page_body(response.content.decode(response.charset))",
            "        self.assertIn(\"You do not have permission to run jobs\", response_body)",
            "        # No job was submitted",
            "        self.assertFalse(JobResult.objects.filter(name=self.job_model.name).exists())",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[])",
            "    def test_post_dry_run_not_runnable(self):",
            "        \"\"\"A non-enabled job cannot be dry-run.\"\"\"",
            "        self.add_permissions(\"extras.view_scheduledjob\")",
            "        instance = self._get_queryset().first()",
            "        data = {\"_dry_run\": True}",
            "",
            "        response = self.client.post(self._get_url(\"view\", instance), data)",
            "        self.assertHttpStatus(response, 200)",
            "        response_body = extract_page_body(response.content.decode(response.charset))",
            "        self.assertIn(\"This job cannot be run at this time\", response_body)",
            "        # No job was submitted",
            "        self.assertFalse(JobResult.objects.filter(name=instance.job_model.name).exists())",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[])",
            "    def test_post_dry_run_needs_job_run_permission(self):",
            "        \"\"\"A user without run_job permission cannot dry-run a job.\"\"\"",
            "        self.add_permissions(\"extras.view_scheduledjob\")",
            "        instance = self._get_queryset().first()",
            "        instance.job_model.enabled = True",
            "        instance.job_model.save()",
            "        data = {\"_dry_run\": True}",
            "",
            "        response = self.client.post(self._get_url(\"view\", instance), data)",
            "        self.assertHttpStatus(response, 200)",
            "        response_body = extract_page_body(response.content.decode(response.charset))",
            "        self.assertIn(\"You do not have permission to run this job\", response_body)",
            "        # No job was submitted",
            "        self.assertFalse(JobResult.objects.filter(name=instance.job_model.name).exists())",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[])",
            "    def test_post_dry_run_needs_specific_job_run_permission(self):",
            "        \"\"\"A user without run_job permission FOR THAT SPECIFIC JOB cannot dry-run a job.\"\"\"",
            "        self.add_permissions(\"extras.view_scheduledjob\")",
            "        instance1, instance2 = self._get_queryset().all()[:2]",
            "        data = {\"_dry_run\": True}",
            "        obj_perm = ObjectPermission(name=\"Test permission\", constraints={\"pk\": instance1.job_model.pk}, actions=[\"run\"])",
            "        obj_perm.save()",
            "        obj_perm.users.add(self.user)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(Job))",
            "        instance1.job_model.enabled = True",
            "        instance1.job_model.save()",
            "        instance2.job_model.enabled = True",
            "        instance2.job_model.save()",
            "",
            "        response = self.client.post(self._get_url(\"view\", instance2), data)",
            "        self.assertHttpStatus(response, 200)",
            "        response_body = extract_page_body(response.content.decode(response.charset))",
            "        self.assertIn(\"You do not have permission to run this job\", response_body)",
            "        # No job was submitted",
            "        job_names = [instance1.job_model.name, instance2.job_model.name]",
            "        self.assertFalse(JobResult.objects.filter(name__in=job_names).exists())",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[\"*\"])",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=1)",
            "    def test_post_dry_run_not_supported(self, _):",
            "        \"\"\"Request a dry run on a job that doesn't support dryrun.\"\"\"",
            "        self.add_permissions(\"extras.view_scheduledjob\")",
            "        instance = ScheduledJob.objects.filter(name=\"test2\").first()",
            "        instance.job_model.enabled = True",
            "        instance.job_model.save()",
            "        obj_perm = ObjectPermission(name=\"Test permission\", constraints={\"pk\": instance.job_model.pk}, actions=[\"run\"])",
            "        obj_perm.save()",
            "        obj_perm.users.add(self.user)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(Job))",
            "        data = {\"_dry_run\": True}",
            "",
            "        response = self.client.post(self._get_url(\"view\", instance), data)",
            "        # Job was not submitted",
            "        self.assertFalse(JobResult.objects.filter(name=instance.job_model.class_path).exists())",
            "        self.assertContains(response, \"This job does not support dryrun\")",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[\"*\"])",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=1)",
            "    @mock.patch(\"nautobot.extras.models.jobs.JobResult.enqueue_job\")",
            "    def test_post_dry_run_success(self, mock_enqueue_job, _):",
            "        \"\"\"Successfully request a dry run based on object-based run_job permissions.\"\"\"",
            "        self.add_permissions(\"extras.view_scheduledjob\")",
            "        instance = ScheduledJob.objects.filter(name=\"test1\").first()",
            "        instance.job_model.enabled = True",
            "        instance.job_model.save()",
            "        obj_perm = ObjectPermission(name=\"Test permission\", constraints={\"pk\": instance.job_model.pk}, actions=[\"run\"])",
            "        obj_perm.save()",
            "        obj_perm.users.add(self.user)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(Job))",
            "        data = {\"_dry_run\": True}",
            "",
            "        mock_enqueue_job.side_effect = lambda job_model, *args, **kwargs: JobResult.objects.create(name=job_model.name)",
            "",
            "        response = self.client.post(self._get_url(\"view\", instance), data)",
            "        # Job was submitted",
            "        mock_enqueue_job.assert_called_once()",
            "        job_result = JobResult.objects.get(name=instance.job_model.name)",
            "        self.assertRedirects(response, reverse(\"extras:jobresult\", kwargs={\"pk\": job_result.pk}))",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[\"*\"])",
            "    def test_post_deny_different_user_lacking_permissions(self):",
            "        \"\"\"A user needs both delete_scheduledjob and approve_job permissions to deny a job request.\"\"\"",
            "        user1 = User.objects.create_user(username=\"testuser1\")",
            "        user2 = User.objects.create_user(username=\"testuser2\")",
            "",
            "        # Give both users view_scheduledjob permission",
            "        obj_perm = ObjectPermission(name=\"View\", actions=[\"view\"])",
            "        obj_perm.save()",
            "        obj_perm.users.add(user1, user2)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(ScheduledJob))",
            "",
            "        # Give user1 delete_scheduledjob permission but not approve_job permission",
            "        obj_perm = ObjectPermission(name=\"Delete\", actions=[\"delete\"])",
            "        obj_perm.save()",
            "        obj_perm.users.add(user1)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(ScheduledJob))",
            "",
            "        # Give user2 approve_job permission but not delete_scheduledjob permission",
            "        obj_perm = ObjectPermission(name=\"Approve\", actions=[\"approve\"])",
            "        obj_perm.save()",
            "        obj_perm.users.add(user2)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(Job))",
            "",
            "        instance = self._get_queryset().first()",
            "        data = {\"_deny\": True}",
            "",
            "        for user in (user1, user2):",
            "            self.client.force_login(user)",
            "            response = self.client.post(self._get_url(\"view\", instance), data)",
            "            self.assertHttpStatus(response, 200, msg=str(user))",
            "            response_body = extract_page_body(response.content.decode(response.charset))",
            "            self.assertIn(\"You do not have permission\", response_body, msg=str(user))",
            "            # Request was not deleted",
            "            self.assertEqual(1, len(ScheduledJob.objects.filter(pk=instance.pk)), msg=str(user))",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[\"*\"])",
            "    def test_post_deny_different_user_permitted(self):",
            "        \"\"\"A user with appropriate permissions can deny a job request.\"\"\"",
            "        user = User.objects.create_user(username=\"testuser1\")",
            "        instance = self._get_queryset().first()",
            "",
            "        # Give user view_scheduledjob and delete_scheduledjob permissions",
            "        obj_perm = ObjectPermission(name=\"View\", actions=[\"view\", \"delete\"], constraints={\"pk\": instance.pk})",
            "        obj_perm.save()",
            "        obj_perm.users.add(user)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(ScheduledJob))",
            "",
            "        # Give user approve_job permission",
            "        obj_perm = ObjectPermission(name=\"Approve\", actions=[\"approve\"], constraints={\"pk\": instance.job_model.pk})",
            "        obj_perm.save()",
            "        obj_perm.users.add(user)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(Job))",
            "",
            "        data = {\"_deny\": True}",
            "",
            "        self.client.force_login(user)",
            "        response = self.client.post(self._get_url(\"view\", instance), data)",
            "        self.assertRedirects(response, reverse(\"extras:scheduledjob_approval_queue_list\"))",
            "        # Request was deleted",
            "        self.assertEqual(0, len(ScheduledJob.objects.filter(pk=instance.pk)))",
            "",
            "        # Check object-based permissions are enforced for a different instance",
            "        instance = self._get_queryset().first()",
            "        response = self.client.post(self._get_url(\"view\", instance), data)",
            "        self.assertHttpStatus(response, 200, msg=str(user))",
            "        response_body = extract_page_body(response.content.decode(response.charset))",
            "        self.assertIn(\"You do not have permission\", response_body, msg=str(user))",
            "        # Request was not deleted",
            "        self.assertEqual(1, len(ScheduledJob.objects.filter(pk=instance.pk)), msg=str(user))",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[\"*\"])",
            "    def test_post_approve_cannot_self_approve(self):",
            "        self.add_permissions(\"extras.change_scheduledjob\")",
            "        self.add_permissions(\"extras.approve_job\")",
            "        instance = self._get_queryset().first()",
            "        data = {\"_approve\": True}",
            "",
            "        response = self.client.post(self._get_url(\"view\", instance), data)",
            "        self.assertHttpStatus(response, 200)",
            "        response_body = extract_page_body(response.content.decode(response.charset))",
            "        self.assertIn(\"You cannot approve your own job request\", response_body)",
            "        # Job was not approved",
            "        instance.refresh_from_db()",
            "        self.assertIsNone(instance.approved_by_user)",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[\"*\"])",
            "    def test_post_approve_different_user_lacking_permissions(self):",
            "        \"\"\"A user needs both change_scheduledjob and approve_job permissions to approve a job request.\"\"\"",
            "        user1 = User.objects.create_user(username=\"testuser1\")",
            "        user2 = User.objects.create_user(username=\"testuser2\")",
            "",
            "        # Give both users view_scheduledjob permission",
            "        obj_perm = ObjectPermission(name=\"View\", actions=[\"view\"])",
            "        obj_perm.save()",
            "        obj_perm.users.add(user1, user2)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(ScheduledJob))",
            "",
            "        # Give user1 change_scheduledjob permission but not approve_job permission",
            "        obj_perm = ObjectPermission(name=\"Change\", actions=[\"change\"])",
            "        obj_perm.save()",
            "        obj_perm.users.add(user1)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(ScheduledJob))",
            "",
            "        # Give user2 approve_job permission but not change_scheduledjob permission",
            "        obj_perm = ObjectPermission(name=\"Approve\", actions=[\"approve\"])",
            "        obj_perm.save()",
            "        obj_perm.users.add(user2)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(Job))",
            "",
            "        instance = self._get_queryset().first()",
            "        data = {\"_approve\": True}",
            "",
            "        for user in (user1, user2):",
            "            self.client.force_login(user)",
            "            response = self.client.post(self._get_url(\"view\", instance), data)",
            "            self.assertHttpStatus(response, 200, msg=str(user))",
            "            response_body = extract_page_body(response.content.decode(response.charset))",
            "            self.assertIn(\"You do not have permission\", response_body, msg=str(user))",
            "            # Job was not approved",
            "            instance.refresh_from_db()",
            "            self.assertIsNone(instance.approved_by_user)",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[\"*\"])",
            "    def test_post_approve_different_user_permitted(self):",
            "        \"\"\"A user with appropriate permissions can approve a job request.\"\"\"",
            "        user = User.objects.create_user(username=\"testuser1\")",
            "        instance = self._get_queryset().first()",
            "",
            "        # Give user view_scheduledjob and change_scheduledjob permissions",
            "        obj_perm = ObjectPermission(name=\"View\", actions=[\"view\", \"change\"], constraints={\"pk\": instance.pk})",
            "        obj_perm.save()",
            "        obj_perm.users.add(user)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(ScheduledJob))",
            "",
            "        # Give user approve_job permission",
            "        obj_perm = ObjectPermission(name=\"Approve\", actions=[\"approve\"], constraints={\"pk\": instance.job_model.pk})",
            "        obj_perm.save()",
            "        obj_perm.users.add(user)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(Job))",
            "",
            "        data = {\"_approve\": True}",
            "",
            "        self.client.force_login(user)",
            "        response = self.client.post(self._get_url(\"view\", instance), data)",
            "        self.assertRedirects(response, reverse(\"extras:scheduledjob_approval_queue_list\"))",
            "        # Job was scheduled",
            "        instance.refresh_from_db()",
            "        self.assertEqual(instance.approved_by_user, user)",
            "",
            "        # Check object-based permissions are enforced for a different instance",
            "        instance = self._get_queryset().last()",
            "        response = self.client.post(self._get_url(\"view\", instance), data)",
            "        self.assertHttpStatus(response, 200, msg=str(user))",
            "        response_body = extract_page_body(response.content.decode(response.charset))",
            "        self.assertIn(\"You do not have permission\", response_body, msg=str(user))",
            "        # Job was not scheduled",
            "        instance.refresh_from_db()",
            "        self.assertIsNone(instance.approved_by_user)",
            "",
            "",
            "class JobResultTestCase(",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.BulkDeleteObjectsViewTestCase,",
            "):",
            "    model = JobResult",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        JobResult.objects.create(name=\"pass.TestPass\")",
            "        JobResult.objects.create(name=\"fail.TestFail\")",
            "",
            "",
            "class JobTestCase(",
            "    # note no CreateObjectViewTestCase - we do not support user creation of Job records",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "):",
            "    \"\"\"",
            "    The Job view test cases.",
            "    \"\"\"",
            "",
            "    model = Job",
            "",
            "    def _get_queryset(self):",
            "        \"\"\"Don't include hidden Jobs, non-installed Jobs, JobHookReceivers or JobButtonReceivers as they won't appear in the UI by default.\"\"\"",
            "        return self.model.objects.filter(",
            "            installed=True, hidden=False, is_job_hook_receiver=False, is_job_button_receiver=False",
            "        )",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        # Job model objects are automatically created during database migrations",
            "",
            "        # But we do need to make sure the ones we're testing are flagged appropriately",
            "        cls.test_pass = Job.objects.get(job_class_name=\"TestPass\")",
            "        cls.test_pass.enabled = True",
            "        cls.test_pass.save()",
            "",
            "        cls.run_urls = (",
            "            # Legacy URL (job class path based)",
            "            reverse(\"extras:job_run_by_class_path\", kwargs={\"class_path\": cls.test_pass.class_path}),",
            "            # Current URL (job model pk based)",
            "            reverse(\"extras:job_run\", kwargs={\"pk\": cls.test_pass.pk}),",
            "        )",
            "",
            "        cls.test_required_args = Job.objects.get(job_class_name=\"TestRequired\")",
            "        cls.test_required_args.enabled = True",
            "        cls.test_required_args.save()",
            "",
            "        cls.extra_run_urls = (",
            "            # Legacy URL (job class path based)",
            "            reverse(\"extras:job_run_by_class_path\", kwargs={\"class_path\": cls.test_required_args.class_path}),",
            "            # Current URL (job model pk based)",
            "            reverse(\"extras:job_run\", kwargs={\"pk\": cls.test_required_args.pk}),",
            "        )",
            "",
            "        # Create an entry for a non-installed Job as well",
            "        cls.test_not_installed = Job(",
            "            module_name=\"nonexistent\",",
            "            job_class_name=\"NoSuchJob\",",
            "            grouping=\"Nonexistent Jobs\",",
            "            name=\"No such job\",",
            "            enabled=True,",
            "            installed=False,",
            "        )",
            "        cls.test_not_installed.validated_save()",
            "",
            "        cls.data_run_immediately = {",
            "            \"_schedule_type\": \"immediately\",",
            "        }",
            "",
            "        cls.form_data = {",
            "            \"enabled\": True,",
            "            \"grouping_override\": True,",
            "            \"grouping\": \"Overridden Grouping\",",
            "            \"name_override\": True,",
            "            \"name\": \"Overridden Name\",",
            "            \"description_override\": True,",
            "            \"description\": \"This is an overridden description of a job.\",",
            "            \"dryrun_default_override\": True,",
            "            \"dryrun_default\": True,",
            "            \"hidden_override\": True,",
            "            \"hidden\": False,",
            "            \"approval_required_override\": True,",
            "            \"approval_required\": True,",
            "            \"soft_time_limit_override\": True,",
            "            \"soft_time_limit\": 350,",
            "            \"time_limit_override\": True,",
            "            \"time_limit\": 650,",
            "            \"has_sensitive_variables\": False,",
            "            \"has_sensitive_variables_override\": True,",
            "            \"task_queues\": \"overridden,priority\",",
            "            \"task_queues_override\": True,",
            "        }",
            "",
            "    #",
            "    # Additional test cases for the \"job\" (legacy run) and \"job_run\" (updated run) views follow",
            "    #",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[])",
            "    def test_get_run_without_permission(self):",
            "        for run_url in self.run_urls:",
            "            self.assertHttpStatus(self.client.get(run_url), 403, msg=run_url)",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[])",
            "    def test_get_run_with_permission(self):",
            "        \"\"\"",
            "        Get view with appropriate global permissions.",
            "",
            "        Note that this view is conditional on run_job permission, not view_job permission,",
            "        so EXEMPT_VIEW_PERMISSIONS=[\"*\"] does NOT apply here.",
            "        \"\"\"",
            "        self.add_permissions(\"extras.run_job\")",
            "        for run_url in self.run_urls:",
            "            response = self.client.get(run_url)",
            "            self.assertHttpStatus(response, 200, msg=run_url)",
            "",
            "            response_body = extract_page_body(response.content.decode(response.charset))",
            "            self.assertIn(\"TestPass\", response_body)",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[])",
            "    def test_get_run_with_constrained_permission(self):",
            "        \"\"\"Get view with appropriate object-based permissions.\"\"\"",
            "        obj_perm = ObjectPermission(",
            "            name=\"Job permission\",",
            "            constraints={\"module_name\": self.test_pass.module_name},",
            "            actions=[\"run\"],",
            "        )",
            "        obj_perm.save()",
            "        obj_perm.users.add(self.user)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(Job))",
            "",
            "        # Try GET with a permitted object",
            "        for run_url in self.run_urls:",
            "            self.assertHttpStatus(self.client.get(run_url), 200, msg=run_url)",
            "",
            "        # Try GET with a non-permitted object",
            "        for run_url in self.extra_run_urls:",
            "            self.assertHttpStatus(self.client.get(run_url), 404, msg=run_url)",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[])",
            "    def test_run_without_permission(self):",
            "        for run_url in self.run_urls:",
            "            self.assertHttpStatus(self.client.post(run_url), 403, msg=run_url)",
            "",
            "    def test_run_missing_schedule(self):",
            "        self.add_permissions(\"extras.run_job\")",
            "",
            "        for run_url in self.run_urls:",
            "            response = self.client.post(run_url)",
            "            self.assertHttpStatus(response, 200, msg=run_url)",
            "",
            "            errors = extract_form_failures(response.content.decode(response.charset))",
            "            self.assertEqual(errors, [\"_schedule_type: This field is required.\"])",
            "",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=0)",
            "    def test_run_now_no_worker(self, _):",
            "        self.add_permissions(\"extras.run_job\")",
            "",
            "        for run_url in self.run_urls:",
            "            response = self.client.post(run_url, self.data_run_immediately)",
            "            self.assertHttpStatus(response, 200, msg=run_url)",
            "",
            "            content = extract_page_body(response.content.decode(response.charset))",
            "            self.assertIn(\"Celery worker process not running.\", content)",
            "",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=1)",
            "    def test_run_now(self, _):",
            "        self.add_permissions(\"extras.run_job\")",
            "        self.add_permissions(\"extras.view_jobresult\")",
            "",
            "        for run_url in self.run_urls:",
            "            response = self.client.post(run_url, self.data_run_immediately)",
            "",
            "            result = JobResult.objects.latest()",
            "            self.assertRedirects(response, reverse(\"extras:jobresult\", kwargs={\"pk\": result.pk}))",
            "",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=1)",
            "    def test_run_now_constrained_permissions(self, _):",
            "        obj_perm = ObjectPermission(",
            "            name=\"Job permission\",",
            "            constraints={\"module_name\": self.test_pass.module_name},",
            "            actions=[\"run\"],",
            "        )",
            "        obj_perm.save()",
            "        obj_perm.users.add(self.user)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(Job))",
            "",
            "        self.add_permissions(\"extras.view_jobresult\")",
            "",
            "        # Try POST with a permitted object",
            "        for run_url in self.run_urls:",
            "            response = self.client.post(run_url, self.data_run_immediately)",
            "",
            "            result = JobResult.objects.latest()",
            "            self.assertIsNotNone(result, msg=run_url)",
            "            self.assertRedirects(response, reverse(\"extras:jobresult\", kwargs={\"pk\": result.pk}))",
            "",
            "        # Try POST with a non-permitted object",
            "        for run_url in self.extra_run_urls:",
            "            self.assertHttpStatus(self.client.post(run_url, self.data_run_immediately), 404, msg=run_url)",
            "",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=1)",
            "    def test_run_now_not_installed(self, _):",
            "        self.add_permissions(\"extras.run_job\")",
            "",
            "        for run_url in (",
            "            reverse(\"extras:job_run_by_class_path\", kwargs={\"class_path\": self.test_not_installed.class_path}),",
            "            reverse(\"extras:job_run\", kwargs={\"pk\": self.test_not_installed.pk}),",
            "        ):",
            "            response = self.client.post(run_url, self.data_run_immediately)",
            "            self.assertEqual(response.status_code, 200, msg=run_url)",
            "            response_body = extract_page_body(response.content.decode(response.charset))",
            "            self.assertIn(\"Job is not presently installed\", response_body)",
            "",
            "            self.assertFalse(JobResult.objects.filter(name=self.test_not_installed.name).exists())",
            "",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=1)",
            "    def test_run_now_not_enabled(self, _):",
            "        self.add_permissions(\"extras.run_job\")",
            "",
            "        for run_url in (",
            "            reverse(\"extras:job_run_by_class_path\", kwargs={\"class_path\": \"fail.TestFail\"}),",
            "            reverse(\"extras:job_run\", kwargs={\"pk\": Job.objects.get(job_class_name=\"TestFail\").pk}),",
            "        ):",
            "            response = self.client.post(run_url, self.data_run_immediately)",
            "            self.assertEqual(response.status_code, 200, msg=run_url)",
            "            response_body = extract_page_body(response.content.decode(response.charset))",
            "            self.assertIn(\"Job is not enabled to be run\", response_body)",
            "            self.assertFalse(JobResult.objects.filter(name=\"fail.TestFail\").exists())",
            "",
            "    def test_run_now_missing_args(self):",
            "        self.add_permissions(\"extras.run_job\")",
            "",
            "        for run_url in self.extra_run_urls:",
            "            response = self.client.post(run_url, self.data_run_immediately)",
            "            self.assertHttpStatus(response, 200, msg=run_url)",
            "",
            "            errors = extract_form_failures(response.content.decode(response.charset))",
            "            self.assertEqual(errors, [\"var: This field is required.\"])",
            "",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=1)",
            "    def test_run_now_with_args(self, _):",
            "        self.add_permissions(\"extras.run_job\")",
            "        self.add_permissions(\"extras.view_jobresult\")",
            "",
            "        data = {",
            "            \"_schedule_type\": \"immediately\",",
            "            \"var\": \"12\",",
            "        }",
            "",
            "        for run_url in self.extra_run_urls:",
            "            response = self.client.post(run_url, data)",
            "",
            "            result = JobResult.objects.latest()",
            "            self.assertRedirects(response, reverse(\"extras:jobresult\", kwargs={\"pk\": result.pk}))",
            "",
            "    @mock.patch(\"nautobot.extras.jobs.task_queues_as_choices\")",
            "    def test_rerun_job(self, mock_task_queues_as_choices):",
            "        self.add_permissions(\"extras.run_job\")",
            "        self.add_permissions(\"extras.view_jobresult\")",
            "",
            "        mock_task_queues_as_choices.return_value = [(\"default\", \"\"), (\"queue1\", \"\"), (\"uniquequeue\", \"\")]",
            "        job_celery_kwargs = {",
            "            \"nautobot_job_job_model_id\": self.test_required_args.id,",
            "            \"nautobot_job_profile\": True,",
            "            \"nautobot_job_user_id\": self.user.id,",
            "            \"queue\": \"uniquequeue\",",
            "        }",
            "",
            "        previous_result = JobResult.objects.create(",
            "            job_model=self.test_required_args,",
            "            user=self.user,",
            "            task_kwargs={\"var\": \"456\"},",
            "            celery_kwargs=job_celery_kwargs,",
            "        )",
            "",
            "        run_url = reverse(\"extras:job_run\", kwargs={\"pk\": self.test_required_args.pk})",
            "        response = self.client.get(f\"{run_url}?kwargs_from_job_result={previous_result.pk!s}\")",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "",
            "        self.assertInHTML('<option value=\"uniquequeue\" selected>', content)",
            "        self.assertInHTML(",
            "            '<input type=\"text\" name=\"var\" value=\"456\" class=\"form-control form-control\" required placeholder=\"None\" id=\"id_var\">',",
            "            content,",
            "        )",
            "        self.assertInHTML('<input type=\"hidden\" name=\"_profile\" value=\"True\" id=\"id__profile\">', content)",
            "",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=1)",
            "    def test_run_later_missing_name(self, _):",
            "        self.add_permissions(\"extras.run_job\")",
            "",
            "        data = {",
            "            \"_schedule_type\": \"future\",",
            "        }",
            "",
            "        for run_url in self.run_urls:",
            "            response = self.client.post(run_url, data)",
            "            self.assertHttpStatus(response, 200, msg=run_url)",
            "",
            "            errors = extract_form_failures(response.content.decode(response.charset))",
            "            self.assertEqual(errors, [\"_schedule_name: Please provide a name for the job schedule.\"])",
            "",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=1)",
            "    def test_run_later_missing_date(self, _):",
            "        self.add_permissions(\"extras.run_job\")",
            "",
            "        data = {",
            "            \"_schedule_type\": \"future\",",
            "            \"_schedule_name\": \"test\",",
            "        }",
            "",
            "        for i, run_url in enumerate(self.run_urls):",
            "            data[\"_schedule_name\"] = f\"test {i}\"",
            "            response = self.client.post(run_url, data)",
            "            self.assertHttpStatus(response, 200, msg=run_url)",
            "",
            "            errors = extract_form_failures(response.content.decode(response.charset))",
            "            self.assertEqual(",
            "                errors,",
            "                [",
            "                    \"_schedule_start_time: Please enter a valid date and time greater than or equal to the current date and time.\"",
            "                ],",
            "            )",
            "",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=1)",
            "    def test_run_later_date_passed(self, _):",
            "        self.add_permissions(\"extras.run_job\")",
            "",
            "        data = {",
            "            \"_schedule_type\": \"future\",",
            "            \"_schedule_name\": \"test\",",
            "            \"_schedule_start_time\": str(timezone.now() - timedelta(minutes=1)),",
            "        }",
            "",
            "        for i, run_url in enumerate(self.run_urls):",
            "            data[\"_schedule_name\"] = f\"test {i}\"",
            "            response = self.client.post(run_url, data)",
            "            self.assertHttpStatus(response, 200, msg=run_url)",
            "",
            "            errors = extract_form_failures(response.content.decode(response.charset))",
            "            self.assertEqual(",
            "                errors,",
            "                [",
            "                    \"_schedule_start_time: Please enter a valid date and time greater than or equal to the current date and time.\"",
            "                ],",
            "            )",
            "",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=1)",
            "    def test_run_later(self, _):",
            "        self.add_permissions(\"extras.run_job\")",
            "        self.add_permissions(\"extras.view_scheduledjob\")",
            "",
            "        start_time = timezone.now() + timedelta(minutes=1)",
            "        data = {",
            "            \"_schedule_type\": \"future\",",
            "            \"_schedule_name\": \"test\",",
            "            \"_schedule_start_time\": str(start_time),",
            "        }",
            "",
            "        for i, run_url in enumerate(self.run_urls):",
            "            data[\"_schedule_name\"] = f\"test {i}\"",
            "            response = self.client.post(run_url, data)",
            "            self.assertRedirects(response, reverse(\"extras:scheduledjob_list\"))",
            "",
            "            scheduled = ScheduledJob.objects.get(name=f\"test {i}\")",
            "            self.assertEqual(scheduled.start_time, start_time)",
            "",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=1)",
            "    def test_run_job_with_sensitive_variables_for_future(self, _):",
            "        self.add_permissions(\"extras.run_job\")",
            "        self.add_permissions(\"extras.view_scheduledjob\")",
            "",
            "        self.test_pass.has_sensitive_variables = True",
            "        self.test_pass.has_sensitive_variables_override = True",
            "        self.test_pass.validated_save()",
            "",
            "        start_time = timezone.now() + timedelta(minutes=1)",
            "        data = {",
            "            \"_schedule_type\": \"future\",",
            "            \"_schedule_name\": \"test\",",
            "            \"_schedule_start_time\": str(start_time),",
            "        }",
            "        for i, run_url in enumerate(self.run_urls):",
            "            data[\"_schedule_name\"] = f\"test {i}\"",
            "            response = self.client.post(run_url, data)",
            "            self.assertHttpStatus(response, 200, msg=self.run_urls[1])",
            "",
            "            content = extract_page_body(response.content.decode(response.charset))",
            "            self.assertIn(\"Unable to schedule job: Job may have sensitive input variables.\", content)",
            "",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=1)",
            "    def test_run_job_with_invalid_task_queue(self, _):",
            "        self.add_permissions(\"extras.run_job\")",
            "        self.add_permissions(\"extras.view_jobresult\")",
            "",
            "        self.test_pass.task_queues = []",
            "        self.test_pass.task_queues_override = True",
            "        self.test_pass.validated_save()",
            "",
            "        data = {",
            "            \"_schedule_type\": \"immediately\",",
            "            \"_task_queue\": \"invalid\",",
            "        }",
            "",
            "        for run_url in self.run_urls:",
            "            response = self.client.post(run_url, data)",
            "            self.assertHttpStatus(response, 200, msg=run_url)",
            "",
            "            errors = extract_form_failures(response.content.decode(response.charset))",
            "            self.assertEqual(",
            "                errors,",
            "                [\"_task_queue: Select a valid choice. invalid is not one of the available choices.\"],",
            "            )",
            "",
            "    @mock.patch(\"nautobot.extras.views.get_worker_count\", return_value=1)",
            "    def test_run_job_with_sensitive_variables_and_requires_approval(self, _):",
            "        self.add_permissions(\"extras.run_job\")",
            "        self.add_permissions(\"extras.view_scheduledjob\")",
            "",
            "        self.test_pass.has_sensitive_variables = True",
            "        self.test_pass.approval_required = True",
            "        self.test_pass.save()",
            "",
            "        data = {",
            "            \"_schedule_type\": \"immediately\",",
            "        }",
            "        for run_url in self.run_urls:",
            "            # Assert warning message shows in get",
            "            response = self.client.get(run_url)",
            "            content = extract_page_body(response.content.decode(response.charset))",
            "            self.assertIn(",
            "                \"This job is flagged as possibly having sensitive variables but is also flagged as requiring approval.\",",
            "                content,",
            "            )",
            "",
            "            # Assert run button is disabled",
            "            self.assertInHTML(",
            "                \"\"\"",
            "                <button type=\"submit\" name=\"_run\" id=\"id__run\" class=\"btn btn-primary\" disabled=\"disabled\">",
            "                    <i class=\"mdi mdi-play\"></i> Run Job Now",
            "                </button>",
            "                \"\"\",",
            "                content,",
            "            )",
            "            # Assert error message shows after post",
            "            response = self.client.post(run_url, data)",
            "            self.assertHttpStatus(response, 200, msg=self.run_urls[1])",
            "",
            "            content = extract_page_body(response.content.decode(response.charset))",
            "            self.assertIn(",
            "                \"Unable to run or schedule job: \"",
            "                \"This job is flagged as possibly having sensitive variables but is also flagged as requiring approval.\"",
            "                \"One of these two flags must be removed before this job can be scheduled or run.\",",
            "                content,",
            "            )",
            "",
            "    def test_job_object_change_log_view(self):",
            "        \"\"\"Assert Job change log view displays appropriate header\"\"\"",
            "        instance = self.test_pass",
            "        self.add_permissions(\"extras.view_objectchange\", \"extras.view_job\")",
            "        response = self.client.get(instance.get_changelog_url())",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "",
            "        self.assertHttpStatus(response, 200)",
            "        self.assertIn(f\"<h1>{instance.name} - Change Log</h1>\", content)",
            "",
            "",
            "class JobButtonTestCase(",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "):",
            "    model = JobButton",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        job_buttons = (",
            "            JobButton.objects.create(",
            "                name=\"JobButton1\",",
            "                text=\"JobButton1\",",
            "                job=Job.objects.get(job_class_name=\"TestJobButtonReceiverSimple\"),",
            "                confirmation=True,",
            "            ),",
            "            JobButton.objects.create(",
            "                name=\"JobButton2\",",
            "                text=\"JobButton2\",",
            "                job=Job.objects.get(job_class_name=\"TestJobButtonReceiverSimple\"),",
            "                confirmation=False,",
            "            ),",
            "            JobButton.objects.create(",
            "                name=\"JobButton3\",",
            "                text=\"JobButton3\",",
            "                job=Job.objects.get(job_class_name=\"TestJobButtonReceiverComplex\"),",
            "                confirmation=True,",
            "                weight=50,",
            "            ),",
            "        )",
            "",
            "        location_ct = ContentType.objects.get_for_model(Location)",
            "        for jb in job_buttons:",
            "            jb.content_types.set([location_ct])",
            "",
            "        cls.form_data = {",
            "            \"content_types\": [location_ct.pk],",
            "            \"name\": \"jobbutton-4\",",
            "            \"text\": \"jobbutton text 4\",",
            "            \"job\": Job.objects.get(job_class_name=\"TestJobButtonReceiverComplex\").pk,",
            "            \"weight\": 100,",
            "            \"button_class\": \"default\",",
            "            \"confirmation\": False,",
            "        }",
            "",
            "",
            "class JobButtonRenderingTestCase(TestCase):",
            "    \"\"\"Tests for the rendering of JobButtons, distinct from tests of the JobButton views themselves.\"\"\"",
            "",
            "    user_permissions = [\"dcim.view_locationtype\"]",
            "",
            "    def setUp(self):",
            "        super().setUp()",
            "        self.job_button_1 = JobButton(",
            "            name=\"JobButton 1\",",
            "            text=\"JobButton {{ obj.name }}\",",
            "            job=Job.objects.get(job_class_name=\"TestJobButtonReceiverSimple\"),",
            "            confirmation=False,",
            "        )",
            "        self.job_button_1.validated_save()",
            "        self.job_button_1.content_types.add(ContentType.objects.get_for_model(LocationType))",
            "",
            "        self.job_button_2 = JobButton(",
            "            name=\"JobButton 2\",",
            "            text=\"Click me!\",",
            "            job=Job.objects.get(job_class_name=\"TestJobButtonReceiverComplex\"),",
            "            confirmation=False,",
            "        )",
            "        self.job_button_2.validated_save()",
            "        self.job_button_2.content_types.add(ContentType.objects.get_for_model(LocationType))",
            "",
            "        self.location_type = LocationType.objects.get(name=\"Campus\")",
            "",
            "    def test_view_object_with_job_button(self):",
            "        \"\"\"Ensure that the job button is rendered.\"\"\"",
            "        response = self.client.get(self.location_type.get_absolute_url(), follow=True)",
            "        self.assertEqual(response.status_code, 200)",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "        self.assertIn(f\"JobButton {self.location_type.name}\", content, content)",
            "        self.assertIn(\"Click me!\", content, content)",
            "",
            "    def test_view_object_with_unsafe_text(self):",
            "        \"\"\"Ensure that JobButton text can't be used as a vector for XSS.\"\"\"",
            "        self.job_button_1.text = '<script>alert(\"Hello world!\")</script>'",
            "        self.job_button_1.validated_save()",
            "        response = self.client.get(self.location_type.get_absolute_url(), follow=True)",
            "        self.assertEqual(response.status_code, 200)",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "        self.assertNotIn(\"<script>alert\", content, content)",
            "        self.assertIn(\"&lt;script&gt;alert\", content, content)",
            "",
            "        # Make sure grouped rendering is safe too",
            "        self.job_button_1.group_name = '<script>alert(\"Goodbye\")</script>'",
            "        self.job_button_1.validated_save()",
            "        response = self.client.get(self.location_type.get_absolute_url(), follow=True)",
            "        self.assertEqual(response.status_code, 200)",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "        self.assertNotIn(\"<script>alert\", content, content)",
            "        self.assertIn(\"&lt;script&gt;alert\", content, content)",
            "",
            "    def test_view_object_with_unsafe_name(self):",
            "        \"\"\"Ensure that JobButton names can't be used as a vector for XSS.\"\"\"",
            "        self.job_button_1.text = \"JobButton {{ obj\"",
            "        self.job_button_1.name = '<script>alert(\"Yo\")</script>'",
            "        self.job_button_1.validated_save()",
            "        response = self.client.get(self.location_type.get_absolute_url(), follow=True)",
            "        self.assertEqual(response.status_code, 200)",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "        self.assertNotIn(\"<script>alert\", content, content)",
            "        self.assertIn(\"&lt;script&gt;alert\", content, content)",
            "",
            "    def test_render_constrained_run_permissions(self):",
            "        obj_perm = ObjectPermission(",
            "            name=\"Test permission\",",
            "            constraints={\"pk\": self.job_button_1.job.pk},",
            "            actions=[\"run\"],",
            "        )",
            "        obj_perm.save()",
            "        obj_perm.users.add(self.user)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(Job))",
            "",
            "        with self.subTest(\"Ungrouped buttons\"):",
            "            response = self.client.get(self.location_type.get_absolute_url(), follow=True)",
            "            self.assertEqual(response.status_code, 200)",
            "            content = extract_page_body(response.content.decode(response.charset))",
            "            self.assertInHTML(",
            "                NO_CONFIRM_BUTTON.format(",
            "                    button_id=self.job_button_1.pk,",
            "                    button_text=f\"JobButton {self.location_type.name}\",",
            "                    button_class=self.job_button_1.button_class,",
            "                    disabled=\"\",",
            "                ),",
            "                content,",
            "            )",
            "            self.assertInHTML(",
            "                NO_CONFIRM_BUTTON.format(",
            "                    button_id=self.job_button_2.pk,",
            "                    button_text=\"Click me!\",",
            "                    button_class=self.job_button_2.button_class,",
            "                    disabled=\"disabled\",",
            "                ),",
            "                content,",
            "            )",
            "",
            "        with self.subTest(\"Grouped buttons\"):",
            "            self.job_button_1.group_name = \"Grouping\"",
            "            self.job_button_1.validated_save()",
            "            self.job_button_2.group_name = \"Grouping\"",
            "            self.job_button_2.validated_save()",
            "",
            "            response = self.client.get(self.location_type.get_absolute_url(), follow=True)",
            "            self.assertEqual(response.status_code, 200)",
            "            content = extract_page_body(response.content.decode(response.charset))",
            "            self.assertInHTML(",
            "                \"<li>\"",
            "                + NO_CONFIRM_BUTTON.format(",
            "                    button_id=self.job_button_1.pk,",
            "                    button_text=f\"JobButton {self.location_type.name}\",",
            "                    button_class=\"link\",",
            "                    disabled=\"\",",
            "                )",
            "                + \"</li>\",",
            "                content,",
            "            )",
            "            self.assertInHTML(",
            "                \"<li>\"",
            "                + NO_CONFIRM_BUTTON.format(",
            "                    button_id=self.job_button_2.pk,",
            "                    button_text=\"Click me!\",",
            "                    button_class=\"link\",",
            "                    disabled=\"disabled\",",
            "                )",
            "                + \"</li>\",",
            "                content,",
            "            )",
            "",
            "",
            "# TODO: Convert to StandardTestCases.Views",
            "class ObjectChangeTestCase(TestCase):",
            "    user_permissions = (\"extras.view_objectchange\",)",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        location_type = LocationType.objects.get(name=\"Campus\")",
            "        location_status = Status.objects.get_for_model(Location).first()",
            "        location = Location(name=\"Location 1\", location_type=location_type, status=location_status)",
            "        location.save()",
            "",
            "        # Create three ObjectChanges",
            "        user = User.objects.create_user(username=\"testuser2\")",
            "        for _ in range(1, 4):",
            "            oc = location.to_objectchange(action=ObjectChangeActionChoices.ACTION_UPDATE)",
            "            oc.user = user",
            "            oc.request_id = uuid.uuid4()",
            "            oc.save()",
            "",
            "    def test_objectchange_list(self):",
            "        url = reverse(\"extras:objectchange_list\")",
            "        params = {",
            "            \"user\": User.objects.first().pk,",
            "        }",
            "",
            "        response = self.client.get(f\"{url}?{urllib.parse.urlencode(params)}\")",
            "        self.assertHttpStatus(response, 200)",
            "",
            "    def test_objectchange(self):",
            "        objectchange = ObjectChange.objects.first()",
            "        response = self.client.get(objectchange.get_absolute_url())",
            "        self.assertHttpStatus(response, 200)",
            "",
            "",
            "class RelationshipTestCase(",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.BulkDeleteObjectsViewTestCase,",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "    RequiredRelationshipTestMixin,",
            "):",
            "    model = Relationship",
            "    slug_source = \"label\"",
            "    slugify_function = staticmethod(slugify_dashes_to_underscores)",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        interface_type = ContentType.objects.get_for_model(Interface)",
            "        device_type = ContentType.objects.get_for_model(Device)",
            "        vlan_type = ContentType.objects.get_for_model(VLAN)",
            "        status = Status.objects.get_for_model(Interface).first()",
            "",
            "        Relationship(",
            "            label=\"Device VLANs\",",
            "            key=\"device_vlans\",",
            "            type=\"many-to-many\",",
            "            source_type=device_type,",
            "            destination_type=vlan_type,",
            "        ).validated_save()",
            "        Relationship(",
            "            label=\"Primary VLAN\",",
            "            key=\"primary_vlan\",",
            "            type=\"one-to-many\",",
            "            source_type=vlan_type,",
            "            destination_type=device_type,",
            "        ).validated_save()",
            "        Relationship(",
            "            label=\"Primary Interface\",",
            "            type=\"one-to-one\",",
            "            source_type=device_type,",
            "            destination_type=interface_type,",
            "        ).validated_save()",
            "",
            "        cls.form_data = {",
            "            \"label\": \"VLAN-to-Interface\",",
            "            \"key\": \"vlan_to_interface\",",
            "            \"type\": \"many-to-many\",",
            "            \"source_type\": vlan_type.pk,",
            "            \"source_label\": \"Interfaces\",",
            "            \"source_hidden\": False,",
            "            \"source_filter\": '{\"status\": [\"' + status.name + '\"]}',",
            "            \"destination_type\": interface_type.pk,",
            "            \"destination_label\": \"VLANs\",",
            "            \"destination_hidden\": True,",
            "            \"destination_filter\": None,",
            "        }",
            "",
            "        cls.slug_test_object = \"Primary Interface\"",
            "",
            "    def test_required_relationships(self):",
            "        \"\"\"",
            "        1. Try creating an object when no required target object exists",
            "        2. Try creating an object without specifying required target object(s)",
            "        3. Try creating an object when all required data is present",
            "        4. Test bulk edit",
            "        \"\"\"",
            "",
            "        # Delete existing factory generated objects that may interfere with this test",
            "        IPAddress.objects.all().delete()",
            "        Prefix.objects.update(parent=None)",
            "        Prefix.objects.all().delete()",
            "        VLAN.objects.all().delete()",
            "",
            "        # Parameterized tests (for creating and updating single objects):",
            "        self.required_relationships_test(interact_with=\"ui\")",
            "",
            "        # 4. Bulk create/edit tests:",
            "",
            "        vlan_status = Status.objects.get_for_model(VLAN).first()",
            "        vlans = (",
            "            VLAN.objects.create(name=\"test_required_relationships1\", vid=1, status=vlan_status),",
            "            VLAN.objects.create(name=\"test_required_relationships2\", vid=2, status=vlan_status),",
            "            VLAN.objects.create(name=\"test_required_relationships3\", vid=3, status=vlan_status),",
            "            VLAN.objects.create(name=\"test_required_relationships4\", vid=4, status=vlan_status),",
            "            VLAN.objects.create(name=\"test_required_relationships5\", vid=5, status=vlan_status),",
            "            VLAN.objects.create(name=\"test_required_relationships6\", vid=6, status=vlan_status),",
            "        )",
            "",
            "        # Try deleting all devices and then editing the 6 VLANs (fails):",
            "        Device.objects.all().delete()",
            "        response = self.client.post(",
            "            reverse(\"ipam:vlan_bulk_edit\"), data={\"pk\": [str(vlan.id) for vlan in vlans], \"_apply\": [\"\"]}",
            "        )",
            "        self.assertContains(response, \"VLANs require at least one device, but no devices exist yet.\")",
            "",
            "        # Create test device for association",
            "        device_for_association = test_views.create_test_device(\"VLAN Required Device\")",
            "",
            "        # Try editing all 6 VLANs without adding the required device(fails):",
            "        response = self.client.post(",
            "            reverse(\"ipam:vlan_bulk_edit\"), data={\"pk\": [str(vlan.id) for vlan in vlans], \"_apply\": [\"\"]}",
            "        )",
            "        self.assertContains(",
            "            response,",
            "            \"6 VLANs require a device for the required relationship &quot;VLANs require at least one Device&quot;\",",
            "        )",
            "",
            "        # Try editing 3 VLANs without adding the required device(fails):",
            "        response = self.client.post(",
            "            reverse(\"ipam:vlan_bulk_edit\"), data={\"pk\": [str(vlan.id) for vlan in vlans[:3]], \"_apply\": [\"\"]}",
            "        )",
            "        self.assertContains(",
            "            response,",
            "            \"These VLANs require a device for the required \"",
            "            \"relationship &quot;VLANs require at least one Device&quot;\",",
            "        )",
            "        for vlan in vlans[:3]:",
            "            self.assertContains(response, f\"{str(vlan)}\")",
            "",
            "        # Try editing 6 VLANs and adding the required device (succeeds):",
            "        response = self.client.post(",
            "            reverse(\"ipam:vlan_bulk_edit\"),",
            "            data={",
            "                \"pk\": [str(vlan.id) for vlan in vlans],",
            "                \"add_cr_vlans_devices_m2m__source\": [str(device_for_association.id)],",
            "                \"_apply\": [\"\"],",
            "            },",
            "            follow=True,",
            "        )",
            "        self.assertContains(response, \"Updated 6 VLANs\")",
            "",
            "        # Try editing 6 VLANs and removing the required device (fails):",
            "        response = self.client.post(",
            "            reverse(\"ipam:vlan_bulk_edit\"),",
            "            data={",
            "                \"pk\": [str(vlan.id) for vlan in vlans],",
            "                \"remove_cr_vlans_devices_m2m__source\": [str(device_for_association.id)],",
            "                \"_apply\": [\"\"],",
            "            },",
            "        )",
            "        self.assertContains(",
            "            response,",
            "            \"6 VLANs require a device for the required relationship &quot;VLANs require at least one Device&quot;\",",
            "        )",
            "",
            "",
            "class RelationshipAssociationTestCase(",
            "    # TODO? ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    # TODO? ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.BulkDeleteObjectsViewTestCase,",
            "    # TODO? ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "):",
            "    model = RelationshipAssociation",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        device_type = ContentType.objects.get_for_model(Device)",
            "        vlan_type = ContentType.objects.get_for_model(VLAN)",
            "",
            "        # Since RelationshipAssociation.get_absolute_url() is actually the Relationship's URL,",
            "        # we want to have separate Relationships as well to allow distinguishing between them.",
            "        relationship_1 = Relationship(",
            "            label=\"Device VLANs 1\",",
            "            key=\"device_vlans_1\",",
            "            type=\"many-to-many\",",
            "            source_type=device_type,",
            "            destination_type=vlan_type,",
            "        )",
            "        relationship_2 = Relationship(",
            "            label=\"Device VLANs 2\",",
            "            key=\"device_vlans_2\",",
            "            type=\"many-to-many\",",
            "            source_type=device_type,",
            "            destination_type=vlan_type,",
            "        )",
            "        relationship_3 = Relationship(",
            "            label=\"Device VLANs 3\",",
            "            key=\"device_vlans_3\",",
            "            type=\"many-to-many\",",
            "            source_type=device_type,",
            "            destination_type=vlan_type,",
            "        )",
            "        cls.relationship = relationship_1",
            "        relationship_1.validated_save()",
            "        relationship_2.validated_save()",
            "        relationship_3.validated_save()",
            "        manufacturer = Manufacturer.objects.first()",
            "        devicetype = DeviceType.objects.create(manufacturer=manufacturer, model=\"Device Type 1\")",
            "        devicerole = Role.objects.get_for_model(Device).first()",
            "        devicestatus = Status.objects.get_for_model(Device).first()",
            "        location = Location.objects.first()",
            "        devices = (",
            "            Device.objects.create(",
            "                name=\"Device 1\", device_type=devicetype, role=devicerole, location=location, status=devicestatus",
            "            ),",
            "            Device.objects.create(",
            "                name=\"Device 2\", device_type=devicetype, role=devicerole, location=location, status=devicestatus",
            "            ),",
            "            Device.objects.create(",
            "                name=\"Device 3\", device_type=devicetype, role=devicerole, location=location, status=devicestatus",
            "            ),",
            "        )",
            "        vlan_status = Status.objects.get_for_model(VLAN).first()",
            "        vlan_group = VLANGroup.objects.first()",
            "        vlans = (",
            "            VLAN.objects.create(vid=1, name=\"VLAN 1\", status=vlan_status, vlan_group=vlan_group),",
            "            VLAN.objects.create(vid=2, name=\"VLAN 2\", status=vlan_status, vlan_group=vlan_group),",
            "            VLAN.objects.create(vid=3, name=\"VLAN 3\", status=vlan_status, vlan_group=vlan_group),",
            "        )",
            "",
            "        RelationshipAssociation(",
            "            relationship=relationship_1,",
            "            source_type=device_type,",
            "            source_id=devices[0].pk,",
            "            destination_type=vlan_type,",
            "            destination_id=vlans[0].pk,",
            "        ).validated_save()",
            "        RelationshipAssociation(",
            "            relationship=relationship_2,",
            "            source_type=device_type,",
            "            source_id=devices[1].pk,",
            "            destination_type=vlan_type,",
            "            destination_id=vlans[1].pk,",
            "        ).validated_save()",
            "        RelationshipAssociation(",
            "            relationship=relationship_3,",
            "            source_type=device_type,",
            "            source_id=devices[2].pk,",
            "            destination_type=vlan_type,",
            "            destination_id=vlans[2].pk,",
            "        ).validated_save()",
            "",
            "    def test_list_objects_with_constrained_permission(self):",
            "        instance1, instance2 = RelationshipAssociation.objects.all()[:2]",
            "",
            "        # Add object-level permission",
            "        obj_perm = ObjectPermission(",
            "            name=\"Test permission\",",
            "            constraints={\"pk\": instance1.pk},",
            "            actions=[\"view\"],",
            "        )",
            "        obj_perm.save()",
            "        obj_perm.users.add(self.user)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(self.model))",
            "",
            "        response = self.client.get(self._get_url(\"list\"))",
            "        self.assertHttpStatus(response, 200)",
            "        content = extract_page_body(response.content.decode(response.charset))",
            "        # TODO: it'd make test failures more readable if we strip the page headers/footers from the content",
            "        self.assertIn(instance1.source.name, content, msg=content)",
            "        self.assertIn(instance1.destination.name, content, msg=content)",
            "        self.assertNotIn(instance2.source.name, content, msg=content)",
            "        self.assertNotIn(instance2.destination.name, content, msg=content)",
            "",
            "",
            "class StatusTestCase(",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "):",
            "    model = Status",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        # Status objects to test.",
            "        content_type = ContentType.objects.get_for_model(Device)",
            "",
            "        cls.form_data = {",
            "            \"name\": \"new_status\",",
            "            \"description\": \"I am a new status object.\",",
            "            \"color\": \"ffcc00\",",
            "            \"content_types\": [content_type.pk],",
            "        }",
            "",
            "        cls.csv_data = (",
            "            \"name,color,content_types\"",
            "            \"test_status1,ffffff,dcim.device\"",
            "            'test_status2,ffffff,\"dcim.device,dcim.location\"'",
            "            \"test_status3,ffffff,dcim.device\"",
            "            \"test_status4,ffffff,dcim.device\"",
            "        )",
            "",
            "        cls.bulk_edit_data = {",
            "            \"color\": \"000000\",",
            "        }",
            "",
            "",
            "class TagTestCase(ViewTestCases.OrganizationalObjectViewTestCase):",
            "    model = Tag",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        cls.form_data = {",
            "            \"name\": \"Tag X\",",
            "            \"color\": \"c0c0c0\",",
            "            \"comments\": \"Some comments\",",
            "            \"content_types\": [ct.id for ct in TaggableClassesQuery().as_queryset()],",
            "        }",
            "",
            "        cls.csv_data = (",
            "            \"name,color,description,content_types\",",
            "            \"Tag 4,ff0000,Fourth tag,dcim.device\",",
            "            'Tag 5,00ff00,Fifth tag,\"dcim.device,dcim.location\"',",
            "            \"Tag 6,0000ff,Sixth tag,dcim.location\",",
            "        )",
            "",
            "        cls.bulk_edit_data = {",
            "            \"color\": \"00ff00\",",
            "        }",
            "",
            "    def test_create_tags_with_content_types(self):",
            "        self.add_permissions(\"extras.add_tag\")",
            "        location_content_type = ContentType.objects.get_for_model(Location)",
            "",
            "        form_data = {",
            "            **self.form_data,",
            "            \"content_types\": [location_content_type.id],",
            "        }",
            "",
            "        request = {",
            "            \"path\": self._get_url(\"add\"),",
            "            \"data\": post_data(form_data),",
            "        }",
            "        self.assertHttpStatus(self.client.post(**request), 302)",
            "",
            "        tag = Tag.objects.filter(name=self.form_data[\"name\"])",
            "        self.assertTrue(tag.exists())",
            "        self.assertEqual(tag[0].content_types.first(), location_content_type)",
            "",
            "    def test_create_tags_with_invalid_content_types(self):",
            "        self.add_permissions(\"extras.add_tag\")",
            "        vlangroup_content_type = ContentType.objects.get_for_model(VLANGroup)",
            "",
            "        form_data = {",
            "            **self.form_data,",
            "            \"content_types\": [vlangroup_content_type.id],",
            "        }",
            "",
            "        request = {",
            "            \"path\": self._get_url(\"add\"),",
            "            \"data\": post_data(form_data),",
            "        }",
            "",
            "        response = self.client.post(**request)",
            "        tag = Tag.objects.filter(name=self.form_data[\"name\"])",
            "        self.assertFalse(tag.exists())",
            "        self.assertIn(\"content_types: Select a valid choice\", str(response.content))",
            "",
            "    def test_update_tags_remove_content_type(self):",
            "        \"\"\"Test removing a tag content_type that is been tagged to a model\"\"\"",
            "        self.add_permissions(\"extras.change_tag\")",
            "",
            "        tag_1 = Tag.objects.get_for_model(Location).first()",
            "        location = Location.objects.first()",
            "        location.tags.add(tag_1)",
            "",
            "        form_data = {",
            "            \"name\": tag_1.name,",
            "            \"color\": \"c0c0c0\",",
            "            \"content_types\": [ContentType.objects.get_for_model(Device).id],",
            "        }",
            "",
            "        request = {",
            "            \"path\": self._get_url(\"edit\", tag_1),",
            "            \"data\": post_data(form_data),",
            "        }",
            "",
            "        response = self.client.post(**request)",
            "        self.assertHttpStatus(",
            "            response, 200, [\"content_types: Unable to remove dcim.location. Dependent objects were found.\"]",
            "        )",
            "",
            "",
            "class WebhookTestCase(",
            "    ViewTestCases.CreateObjectViewTestCase,",
            "    ViewTestCases.DeleteObjectViewTestCase,",
            "    ViewTestCases.EditObjectViewTestCase,",
            "    ViewTestCases.GetObjectViewTestCase,",
            "    ViewTestCases.GetObjectChangelogViewTestCase,",
            "    ViewTestCases.ListObjectsViewTestCase,",
            "):",
            "    model = Webhook",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        webhooks = (",
            "            Webhook(",
            "                name=\"webhook-1\",",
            "                enabled=True,",
            "                type_create=True,",
            "                payload_url=\"http://test-url.com/test-1\",",
            "                http_content_type=HTTP_CONTENT_TYPE_JSON,",
            "            ),",
            "            Webhook(",
            "                name=\"webhook-2\",",
            "                enabled=True,",
            "                type_update=True,",
            "                payload_url=\"http://test-url.com/test-2\",",
            "                http_content_type=HTTP_CONTENT_TYPE_JSON,",
            "            ),",
            "            Webhook(",
            "                name=\"webhook-3\",",
            "                enabled=True,",
            "                type_delete=True,",
            "                payload_url=\"http://test-url.com/test-3\",",
            "                http_content_type=HTTP_CONTENT_TYPE_JSON,",
            "            ),",
            "        )",
            "",
            "        obj_type = ContentType.objects.get_for_model(ConsolePort)",
            "",
            "        for webhook in webhooks:",
            "            webhook.save()",
            "            webhook.content_types.set([obj_type])",
            "",
            "        cls.form_data = {",
            "            \"name\": \"webhook-4\",",
            "            \"content_types\": [obj_type.pk],",
            "            \"enabled\": True,",
            "            \"type_create\": True,",
            "            \"payload_url\": \"http://test-url.com/test-4\",",
            "            \"http_method\": \"POST\",",
            "            \"http_content_type\": \"application/json\",",
            "        }",
            "",
            "",
            "class RoleTestCase(ViewTestCases.OrganizationalObjectViewTestCase):",
            "    model = Role",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        # Status objects to test.",
            "        content_type = ContentType.objects.get_for_model(Device)",
            "",
            "        cls.form_data = {",
            "            \"name\": \"New Role\",",
            "            \"description\": \"I am a new role object.\",",
            "            \"color\": ColorChoices.COLOR_GREY,",
            "            \"content_types\": [content_type.pk],",
            "        }",
            "",
            "        cls.csv_data = (",
            "            \"name,weight,color,content_types,description\",",
            "            \"test_role1,1000,ffffff,dcim.device,A Role\",",
            "            'test_role2,200,ffffff,\"dcim.device,dcim.rack\",A Role',",
            "            'test_role3,100,ffffff,\"dcim.device,ipam.prefix\",A Role',",
            "            'test_role4,50,ffffff,\"ipam.ipaddress,ipam.vlan\",A Role',",
            "            'test_role5,25,ffffff,\"virtualization.virtualmachine\",A Role',",
            "        )",
            "",
            "        cls.bulk_edit_data = {",
            "            \"color\": \"000000\",",
            "        }",
            "",
            "    @override_settings(EXEMPT_VIEW_PERMISSIONS=[\"*\"])",
            "    def test_view_with_content_types(self):",
            "        \"\"\"",
            "        Check that the expected panel headings are rendered and unexpected panel headings are not rendered",
            "        \"\"\"",
            "        eligible_ct_model_classes = RoleModelsQuery().list_subclasses()",
            "        for instance in self._get_queryset().all():",
            "            response = self.client.get(instance.get_absolute_url())",
            "            response_body = extract_page_body(response.content.decode(response.charset))",
            "            role_content_types = instance.content_types.all()",
            "            for model_class in eligible_ct_model_classes:",
            "                verbose_name_plural = model_class._meta.verbose_name_plural",
            "                content_type = ContentType.objects.get_for_model(model_class)",
            "                result = \" \".join(elem.capitalize() for elem in verbose_name_plural.split())",
            "                if result == \"Ip Addresses\":",
            "                    result = \"IP Addresses\"",
            "                elif result == \"Vlans\":",
            "                    result = \"VLANs\"",
            "                # Assert tables are correctly rendered",
            "                if content_type not in role_content_types:",
            "                    self.assertNotIn(f\"<strong>{result}</strong>\", response_body)",
            "                else:",
            "                    self.assertIn(f\"<strong>{result}</strong>\", response_body)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "1998": [
                "JobButtonRenderingTestCase",
                "setUp"
            ],
            "1999": [
                "JobButtonRenderingTestCase",
                "setUp"
            ],
            "2004": [
                "JobButtonRenderingTestCase",
                "setUp"
            ],
            "2005": [
                "JobButtonRenderingTestCase",
                "setUp"
            ],
            "2017": [
                "JobButtonRenderingTestCase",
                "test_view_object_with_unsafe_text"
            ],
            "2018": [
                "JobButtonRenderingTestCase",
                "test_view_object_with_unsafe_text"
            ],
            "2026": [
                "JobButtonRenderingTestCase",
                "test_view_object_with_unsafe_text"
            ],
            "2027": [
                "JobButtonRenderingTestCase",
                "test_view_object_with_unsafe_text"
            ],
            "2036": [
                "JobButtonRenderingTestCase",
                "test_view_object_with_unsafe_name"
            ],
            "2037": [
                "JobButtonRenderingTestCase",
                "test_view_object_with_unsafe_name"
            ],
            "2038": [
                "JobButtonRenderingTestCase",
                "test_view_object_with_unsafe_name"
            ]
        },
        "addLocation": []
    }
}