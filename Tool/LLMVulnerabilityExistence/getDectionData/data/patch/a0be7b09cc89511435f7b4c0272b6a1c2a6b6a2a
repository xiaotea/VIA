{
    "Tests/test_imageshow.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 14,
                "afterPatchRowNumber": 14,
                "PatchRowcode": "         # Test registering a viewer that is not a class"
            },
            "1": {
                "beforePatchRowNumber": 15,
                "afterPatchRowNumber": 15,
                "PatchRowcode": "         ImageShow.register(\"not a class\")"
            },
            "2": {
                "beforePatchRowNumber": 16,
                "afterPatchRowNumber": 16,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 17,
                "PatchRowcode": "+        # Restore original state"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 18,
                "PatchRowcode": "+        ImageShow._viewers.pop()"
            },
            "5": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 19,
                "PatchRowcode": "+"
            },
            "6": {
                "beforePatchRowNumber": 17,
                "afterPatchRowNumber": 20,
                "PatchRowcode": "     def test_show(self):"
            },
            "7": {
                "beforePatchRowNumber": 18,
                "afterPatchRowNumber": 21,
                "PatchRowcode": "         class TestViewer:"
            },
            "8": {
                "beforePatchRowNumber": 19,
                "afterPatchRowNumber": 22,
                "PatchRowcode": "             methodCalled = False"
            },
            "9": {
                "beforePatchRowNumber": 28,
                "afterPatchRowNumber": 31,
                "PatchRowcode": "         self.assertTrue(ImageShow.show(im))"
            },
            "10": {
                "beforePatchRowNumber": 29,
                "afterPatchRowNumber": 32,
                "PatchRowcode": "         self.assertTrue(viewer.methodCalled)"
            },
            "11": {
                "beforePatchRowNumber": 30,
                "afterPatchRowNumber": 33,
                "PatchRowcode": " "
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 34,
                "PatchRowcode": "+        # Restore original state"
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 35,
                "PatchRowcode": "+        ImageShow._viewers.pop(0)"
            },
            "14": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 36,
                "PatchRowcode": "+"
            },
            "15": {
                "beforePatchRowNumber": 31,
                "afterPatchRowNumber": 37,
                "PatchRowcode": "     def test_viewer(self):"
            },
            "16": {
                "beforePatchRowNumber": 32,
                "afterPatchRowNumber": 38,
                "PatchRowcode": "         viewer = ImageShow.Viewer()"
            },
            "17": {
                "beforePatchRowNumber": 33,
                "afterPatchRowNumber": 39,
                "PatchRowcode": " "
            },
            "18": {
                "beforePatchRowNumber": 34,
                "afterPatchRowNumber": 40,
                "PatchRowcode": "         self.assertIsNone(viewer.get_format(None))"
            },
            "19": {
                "beforePatchRowNumber": 35,
                "afterPatchRowNumber": 41,
                "PatchRowcode": " "
            },
            "20": {
                "beforePatchRowNumber": 36,
                "afterPatchRowNumber": 42,
                "PatchRowcode": "         self.assertRaises(NotImplementedError, viewer.get_command, None)"
            },
            "21": {
                "beforePatchRowNumber": 37,
                "afterPatchRowNumber": 43,
                "PatchRowcode": " "
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 44,
                "PatchRowcode": "+    def test_viewers(self):"
            },
            "23": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 45,
                "PatchRowcode": "+        for viewer in ImageShow._viewers:"
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 46,
                "PatchRowcode": "+            viewer.get_command('test.jpg')"
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 47,
                "PatchRowcode": "+"
            },
            "26": {
                "beforePatchRowNumber": 38,
                "afterPatchRowNumber": 48,
                "PatchRowcode": " "
            },
            "27": {
                "beforePatchRowNumber": 39,
                "afterPatchRowNumber": 49,
                "PatchRowcode": " if __name__ == '__main__':"
            },
            "28": {
                "beforePatchRowNumber": 40,
                "afterPatchRowNumber": 50,
                "PatchRowcode": "     unittest.main()"
            }
        },
        "frontPatchFile": [
            "from helper import unittest, PillowTestCase, hopper",
            "",
            "from PIL import Image",
            "from PIL import ImageShow",
            "",
            "",
            "class TestImageShow(PillowTestCase):",
            "",
            "    def test_sanity(self):",
            "        dir(Image)",
            "        dir(ImageShow)",
            "",
            "    def test_register(self):",
            "        # Test registering a viewer that is not a class",
            "        ImageShow.register(\"not a class\")",
            "",
            "    def test_show(self):",
            "        class TestViewer:",
            "            methodCalled = False",
            "",
            "            def show(self, image, title=None, **options):",
            "                self.methodCalled = True",
            "                return True",
            "        viewer = TestViewer()",
            "        ImageShow.register(viewer, -1)",
            "",
            "        im = hopper()",
            "        self.assertTrue(ImageShow.show(im))",
            "        self.assertTrue(viewer.methodCalled)",
            "",
            "    def test_viewer(self):",
            "        viewer = ImageShow.Viewer()",
            "",
            "        self.assertIsNone(viewer.get_format(None))",
            "",
            "        self.assertRaises(NotImplementedError, viewer.get_command, None)",
            "",
            "",
            "if __name__ == '__main__':",
            "    unittest.main()"
        ],
        "afterPatchFile": [
            "from helper import unittest, PillowTestCase, hopper",
            "",
            "from PIL import Image",
            "from PIL import ImageShow",
            "",
            "",
            "class TestImageShow(PillowTestCase):",
            "",
            "    def test_sanity(self):",
            "        dir(Image)",
            "        dir(ImageShow)",
            "",
            "    def test_register(self):",
            "        # Test registering a viewer that is not a class",
            "        ImageShow.register(\"not a class\")",
            "",
            "        # Restore original state",
            "        ImageShow._viewers.pop()",
            "",
            "    def test_show(self):",
            "        class TestViewer:",
            "            methodCalled = False",
            "",
            "            def show(self, image, title=None, **options):",
            "                self.methodCalled = True",
            "                return True",
            "        viewer = TestViewer()",
            "        ImageShow.register(viewer, -1)",
            "",
            "        im = hopper()",
            "        self.assertTrue(ImageShow.show(im))",
            "        self.assertTrue(viewer.methodCalled)",
            "",
            "        # Restore original state",
            "        ImageShow._viewers.pop(0)",
            "",
            "    def test_viewer(self):",
            "        viewer = ImageShow.Viewer()",
            "",
            "        self.assertIsNone(viewer.get_format(None))",
            "",
            "        self.assertRaises(NotImplementedError, viewer.get_command, None)",
            "",
            "    def test_viewers(self):",
            "        for viewer in ImageShow._viewers:",
            "            viewer.get_command('test.jpg')",
            "",
            "",
            "if __name__ == '__main__':",
            "    unittest.main()"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {},
        "addLocation": [
            "Tests.test_imageshow.TestImageShow.self"
        ]
    },
    "src/PIL/ImageShow.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 148,
                "afterPatchRowNumber": 148,
                "PatchRowcode": "         format = \"PNG\""
            },
            "1": {
                "beforePatchRowNumber": 149,
                "afterPatchRowNumber": 149,
                "PatchRowcode": "         options = {'compress_level': 1}"
            },
            "2": {
                "beforePatchRowNumber": 150,
                "afterPatchRowNumber": 150,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": 151,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        def show_file(self, file, **options):"
            },
            "4": {
                "beforePatchRowNumber": 152,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            command, executable = self.get_command_ex(file, **options)"
            },
            "5": {
                "beforePatchRowNumber": 153,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            command = \"(%s %s; rm -f %s)&\" % (command, quote(file),"
            },
            "6": {
                "beforePatchRowNumber": 154,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                                              quote(file))"
            },
            "7": {
                "beforePatchRowNumber": 155,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            os.system(command)"
            },
            "8": {
                "beforePatchRowNumber": 156,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            return 1"
            },
            "9": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 151,
                "PatchRowcode": "+        def get_command(self, file, **options):"
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 152,
                "PatchRowcode": "+            command = self.get_command_ex(file, **options)[0]"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 153,
                "PatchRowcode": "+            return \"(%s %s; rm -f %s)&\" % (command, quote(file), quote(file))"
            },
            "12": {
                "beforePatchRowNumber": 157,
                "afterPatchRowNumber": 154,
                "PatchRowcode": " "
            },
            "13": {
                "beforePatchRowNumber": 158,
                "afterPatchRowNumber": 155,
                "PatchRowcode": "     # implementations"
            },
            "14": {
                "beforePatchRowNumber": 159,
                "afterPatchRowNumber": 156,
                "PatchRowcode": " "
            }
        },
        "frontPatchFile": [
            "#",
            "# The Python Imaging Library.",
            "# $Id$",
            "#",
            "# im.show() drivers",
            "#",
            "# History:",
            "# 2008-04-06 fl   Created",
            "#",
            "# Copyright (c) Secret Labs AB 2008.",
            "#",
            "# See the README file for information on usage and redistribution.",
            "#",
            "",
            "from __future__ import print_function",
            "",
            "from PIL import Image",
            "import os",
            "import sys",
            "",
            "if sys.version_info.major >= 3:",
            "    from shlex import quote",
            "else:",
            "    from pipes import quote",
            "",
            "_viewers = []",
            "",
            "",
            "def register(viewer, order=1):",
            "    try:",
            "        if issubclass(viewer, Viewer):",
            "            viewer = viewer()",
            "    except TypeError:",
            "        pass  # raised if viewer wasn't a class",
            "    if order > 0:",
            "        _viewers.append(viewer)",
            "    elif order < 0:",
            "        _viewers.insert(0, viewer)",
            "",
            "",
            "def show(image, title=None, **options):",
            "    r\"\"\"",
            "    Display a given image.",
            "",
            "    :param image: An image object.",
            "    :param title: Optional title.  Not all viewers can display the title.",
            "    :param \\**options: Additional viewer options.",
            "    :returns: True if a suitable viewer was found, false otherwise.",
            "    \"\"\"",
            "    for viewer in _viewers:",
            "        if viewer.show(image, title=title, **options):",
            "            return 1",
            "    return 0",
            "",
            "",
            "class Viewer(object):",
            "    \"\"\"Base class for viewers.\"\"\"",
            "",
            "    # main api",
            "",
            "    def show(self, image, **options):",
            "",
            "        # save temporary image to disk",
            "        if image.mode[:4] == \"I;16\":",
            "            # @PIL88 @PIL101",
            "            # \"I;16\" isn't an 'official' mode, but we still want to",
            "            # provide a simple way to show 16-bit images.",
            "            base = \"L\"",
            "            # FIXME: auto-contrast if max() > 255?",
            "        else:",
            "            base = Image.getmodebase(image.mode)",
            "        if base != image.mode and image.mode != \"1\" and image.mode != \"RGBA\":",
            "            image = image.convert(base)",
            "",
            "        return self.show_image(image, **options)",
            "",
            "    # hook methods",
            "",
            "    format = None",
            "    options = {}",
            "",
            "    def get_format(self, image):",
            "        \"\"\"Return format name, or None to save as PGM/PPM\"\"\"",
            "        return self.format",
            "",
            "    def get_command(self, file, **options):",
            "        raise NotImplementedError",
            "",
            "    def save_image(self, image):",
            "        \"\"\"Save to temporary file, and return filename\"\"\"",
            "        return image._dump(format=self.get_format(image), **self.options)",
            "",
            "    def show_image(self, image, **options):",
            "        \"\"\"Display given image\"\"\"",
            "        return self.show_file(self.save_image(image), **options)",
            "",
            "    def show_file(self, file, **options):",
            "        \"\"\"Display given file\"\"\"",
            "        os.system(self.get_command(file, **options))",
            "        return 1",
            "",
            "# --------------------------------------------------------------------",
            "",
            "",
            "if sys.platform == \"win32\":",
            "",
            "    class WindowsViewer(Viewer):",
            "        format = \"BMP\"",
            "",
            "        def get_command(self, file, **options):",
            "            return ('start \"Pillow\" /WAIT \"%s\" '",
            "                    '&& ping -n 2 127.0.0.1 >NUL '",
            "                    '&& del /f \"%s\"' % (file, file))",
            "",
            "    register(WindowsViewer)",
            "",
            "elif sys.platform == \"darwin\":",
            "",
            "    class MacViewer(Viewer):",
            "        format = \"PNG\"",
            "        options = {'compress_level': 1}",
            "",
            "        def get_command(self, file, **options):",
            "            # on darwin open returns immediately resulting in the temp",
            "            # file removal while app is opening",
            "            command = \"open -a /Applications/Preview.app\"",
            "            command = \"(%s %s; sleep 20; rm -f %s)&\" % (command, quote(file),",
            "                                                        quote(file))",
            "            return command",
            "",
            "    register(MacViewer)",
            "",
            "else:",
            "",
            "    # unixoids",
            "",
            "    def which(executable):",
            "        path = os.environ.get(\"PATH\")",
            "        if not path:",
            "            return None",
            "        for dirname in path.split(os.pathsep):",
            "            filename = os.path.join(dirname, executable)",
            "            if os.path.isfile(filename) and os.access(filename, os.X_OK):",
            "                return filename",
            "        return None",
            "",
            "    class UnixViewer(Viewer):",
            "        format = \"PNG\"",
            "        options = {'compress_level': 1}",
            "",
            "        def show_file(self, file, **options):",
            "            command, executable = self.get_command_ex(file, **options)",
            "            command = \"(%s %s; rm -f %s)&\" % (command, quote(file),",
            "                                              quote(file))",
            "            os.system(command)",
            "            return 1",
            "",
            "    # implementations",
            "",
            "    class DisplayViewer(UnixViewer):",
            "        def get_command_ex(self, file, **options):",
            "            command = executable = \"display\"",
            "            return command, executable",
            "",
            "    if which(\"display\"):",
            "        register(DisplayViewer)",
            "",
            "    class EogViewer(UnixViewer):",
            "        def get_command_ex(self, file, **options):",
            "            command = executable = \"eog\"",
            "            return command, executable",
            "",
            "    if which(\"eog\"):",
            "        register(EogViewer)",
            "",
            "    class XVViewer(UnixViewer):",
            "        def get_command_ex(self, file, title=None, **options):",
            "            # note: xv is pretty outdated.  most modern systems have",
            "            # imagemagick's display command instead.",
            "            command = executable = \"xv\"",
            "            if title:",
            "                command += \" -name %s\" % quote(title)",
            "            return command, executable",
            "",
            "    if which(\"xv\"):",
            "        register(XVViewer)",
            "",
            "if __name__ == \"__main__\":",
            "",
            "    if len(sys.argv) < 2:",
            "        print(\"Syntax: python ImageShow.py imagefile [title]\")",
            "        sys.exit()",
            "",
            "    print(show(Image.open(sys.argv[1]), *sys.argv[2:]))"
        ],
        "afterPatchFile": [
            "#",
            "# The Python Imaging Library.",
            "# $Id$",
            "#",
            "# im.show() drivers",
            "#",
            "# History:",
            "# 2008-04-06 fl   Created",
            "#",
            "# Copyright (c) Secret Labs AB 2008.",
            "#",
            "# See the README file for information on usage and redistribution.",
            "#",
            "",
            "from __future__ import print_function",
            "",
            "from PIL import Image",
            "import os",
            "import sys",
            "",
            "if sys.version_info.major >= 3:",
            "    from shlex import quote",
            "else:",
            "    from pipes import quote",
            "",
            "_viewers = []",
            "",
            "",
            "def register(viewer, order=1):",
            "    try:",
            "        if issubclass(viewer, Viewer):",
            "            viewer = viewer()",
            "    except TypeError:",
            "        pass  # raised if viewer wasn't a class",
            "    if order > 0:",
            "        _viewers.append(viewer)",
            "    elif order < 0:",
            "        _viewers.insert(0, viewer)",
            "",
            "",
            "def show(image, title=None, **options):",
            "    r\"\"\"",
            "    Display a given image.",
            "",
            "    :param image: An image object.",
            "    :param title: Optional title.  Not all viewers can display the title.",
            "    :param \\**options: Additional viewer options.",
            "    :returns: True if a suitable viewer was found, false otherwise.",
            "    \"\"\"",
            "    for viewer in _viewers:",
            "        if viewer.show(image, title=title, **options):",
            "            return 1",
            "    return 0",
            "",
            "",
            "class Viewer(object):",
            "    \"\"\"Base class for viewers.\"\"\"",
            "",
            "    # main api",
            "",
            "    def show(self, image, **options):",
            "",
            "        # save temporary image to disk",
            "        if image.mode[:4] == \"I;16\":",
            "            # @PIL88 @PIL101",
            "            # \"I;16\" isn't an 'official' mode, but we still want to",
            "            # provide a simple way to show 16-bit images.",
            "            base = \"L\"",
            "            # FIXME: auto-contrast if max() > 255?",
            "        else:",
            "            base = Image.getmodebase(image.mode)",
            "        if base != image.mode and image.mode != \"1\" and image.mode != \"RGBA\":",
            "            image = image.convert(base)",
            "",
            "        return self.show_image(image, **options)",
            "",
            "    # hook methods",
            "",
            "    format = None",
            "    options = {}",
            "",
            "    def get_format(self, image):",
            "        \"\"\"Return format name, or None to save as PGM/PPM\"\"\"",
            "        return self.format",
            "",
            "    def get_command(self, file, **options):",
            "        raise NotImplementedError",
            "",
            "    def save_image(self, image):",
            "        \"\"\"Save to temporary file, and return filename\"\"\"",
            "        return image._dump(format=self.get_format(image), **self.options)",
            "",
            "    def show_image(self, image, **options):",
            "        \"\"\"Display given image\"\"\"",
            "        return self.show_file(self.save_image(image), **options)",
            "",
            "    def show_file(self, file, **options):",
            "        \"\"\"Display given file\"\"\"",
            "        os.system(self.get_command(file, **options))",
            "        return 1",
            "",
            "# --------------------------------------------------------------------",
            "",
            "",
            "if sys.platform == \"win32\":",
            "",
            "    class WindowsViewer(Viewer):",
            "        format = \"BMP\"",
            "",
            "        def get_command(self, file, **options):",
            "            return ('start \"Pillow\" /WAIT \"%s\" '",
            "                    '&& ping -n 2 127.0.0.1 >NUL '",
            "                    '&& del /f \"%s\"' % (file, file))",
            "",
            "    register(WindowsViewer)",
            "",
            "elif sys.platform == \"darwin\":",
            "",
            "    class MacViewer(Viewer):",
            "        format = \"PNG\"",
            "        options = {'compress_level': 1}",
            "",
            "        def get_command(self, file, **options):",
            "            # on darwin open returns immediately resulting in the temp",
            "            # file removal while app is opening",
            "            command = \"open -a /Applications/Preview.app\"",
            "            command = \"(%s %s; sleep 20; rm -f %s)&\" % (command, quote(file),",
            "                                                        quote(file))",
            "            return command",
            "",
            "    register(MacViewer)",
            "",
            "else:",
            "",
            "    # unixoids",
            "",
            "    def which(executable):",
            "        path = os.environ.get(\"PATH\")",
            "        if not path:",
            "            return None",
            "        for dirname in path.split(os.pathsep):",
            "            filename = os.path.join(dirname, executable)",
            "            if os.path.isfile(filename) and os.access(filename, os.X_OK):",
            "                return filename",
            "        return None",
            "",
            "    class UnixViewer(Viewer):",
            "        format = \"PNG\"",
            "        options = {'compress_level': 1}",
            "",
            "        def get_command(self, file, **options):",
            "            command = self.get_command_ex(file, **options)[0]",
            "            return \"(%s %s; rm -f %s)&\" % (command, quote(file), quote(file))",
            "",
            "    # implementations",
            "",
            "    class DisplayViewer(UnixViewer):",
            "        def get_command_ex(self, file, **options):",
            "            command = executable = \"display\"",
            "            return command, executable",
            "",
            "    if which(\"display\"):",
            "        register(DisplayViewer)",
            "",
            "    class EogViewer(UnixViewer):",
            "        def get_command_ex(self, file, **options):",
            "            command = executable = \"eog\"",
            "            return command, executable",
            "",
            "    if which(\"eog\"):",
            "        register(EogViewer)",
            "",
            "    class XVViewer(UnixViewer):",
            "        def get_command_ex(self, file, title=None, **options):",
            "            # note: xv is pretty outdated.  most modern systems have",
            "            # imagemagick's display command instead.",
            "            command = executable = \"xv\"",
            "            if title:",
            "                command += \" -name %s\" % quote(title)",
            "            return command, executable",
            "",
            "    if which(\"xv\"):",
            "        register(XVViewer)",
            "",
            "if __name__ == \"__main__\":",
            "",
            "    if len(sys.argv) < 2:",
            "        print(\"Syntax: python ImageShow.py imagefile [title]\")",
            "        sys.exit()",
            "",
            "    print(show(Image.open(sys.argv[1]), *sys.argv[2:]))"
        ],
        "action": [
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "151": [],
            "152": [],
            "153": [
                "command"
            ],
            "154": [],
            "155": [],
            "156": []
        },
        "addLocation": []
    }
}