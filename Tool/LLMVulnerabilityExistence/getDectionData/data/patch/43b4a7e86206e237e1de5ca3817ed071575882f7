{
    "src/plone/rest/tests/test_traversal.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 10,
                "afterPatchRowNumber": 10,
                "PatchRowcode": " from plone.app.testing import TEST_USER_ID"
            },
            "1": {
                "beforePatchRowNumber": 11,
                "afterPatchRowNumber": 11,
                "PatchRowcode": " from plone.rest.service import Service"
            },
            "2": {
                "beforePatchRowNumber": 12,
                "afterPatchRowNumber": 12,
                "PatchRowcode": " from plone.rest.testing import PLONE_REST_INTEGRATION_TESTING"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 13,
                "PatchRowcode": "+from zExceptions import NotFound"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 14,
                "PatchRowcode": "+from zExceptions import Redirect"
            },
            "5": {
                "beforePatchRowNumber": 13,
                "afterPatchRowNumber": 15,
                "PatchRowcode": " from zope.event import notify"
            },
            "6": {
                "beforePatchRowNumber": 14,
                "afterPatchRowNumber": 16,
                "PatchRowcode": " from zope.interface import alsoProvides"
            },
            "7": {
                "beforePatchRowNumber": 15,
                "afterPatchRowNumber": 17,
                "PatchRowcode": " from zope.publisher.interfaces.browser import IBrowserView"
            },
            "8": {
                "beforePatchRowNumber": 106,
                "afterPatchRowNumber": 108,
                "PatchRowcode": "         obj = self.traverse(path=\"/plone/folder1/search\", accept=\"text/html\")"
            },
            "9": {
                "beforePatchRowNumber": 107,
                "afterPatchRowNumber": 109,
                "PatchRowcode": "         self.assertFalse(isinstance(obj, Service), \"Got a service\")"
            },
            "10": {
                "beforePatchRowNumber": 108,
                "afterPatchRowNumber": 110,
                "PatchRowcode": " "
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 111,
                "PatchRowcode": "+    def test_html_request_via_api_returns_service(self):"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 112,
                "PatchRowcode": "+        obj = self.traverse(path=\"/plone/++api++\", accept=\"text/html\")"
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 113,
                "PatchRowcode": "+        self.assertTrue(isinstance(obj, Service), \"Not a service\")"
            },
            "14": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 114,
                "PatchRowcode": "+"
            },
            "15": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 115,
                "PatchRowcode": "+    def test_html_request_via_double_apis_raises_redirect(self):"
            },
            "16": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 116,
                "PatchRowcode": "+        portal_url = self.portal.absolute_url()"
            },
            "17": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 117,
                "PatchRowcode": "+        with self.assertRaises(Redirect) as exc:"
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 118,
                "PatchRowcode": "+            self.traverse(path=\"/plone/++api++/++api++\", accept=\"text/html\")"
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 119,
                "PatchRowcode": "+        self.assertEqual("
            },
            "20": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 120,
                "PatchRowcode": "+            exc.exception.headers[\"Location\"],"
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 121,
                "PatchRowcode": "+            \"{}/++api++\".format(portal_url),"
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 122,
                "PatchRowcode": "+        )"
            },
            "23": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 123,
                "PatchRowcode": "+"
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 124,
                "PatchRowcode": "+    def test_html_request_via_multiple_apis_raises_redirect(self):"
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 125,
                "PatchRowcode": "+        portal_url = self.portal.absolute_url()"
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 126,
                "PatchRowcode": "+        with self.assertRaises(Redirect) as exc:"
            },
            "27": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 127,
                "PatchRowcode": "+            self.traverse("
            },
            "28": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 128,
                "PatchRowcode": "+                path=\"/plone/++api++/++api++/++api++/search\", accept=\"text/html\""
            },
            "29": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 129,
                "PatchRowcode": "+            )"
            },
            "30": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 130,
                "PatchRowcode": "+        self.assertEqual("
            },
            "31": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 131,
                "PatchRowcode": "+            exc.exception.headers[\"Location\"],"
            },
            "32": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 132,
                "PatchRowcode": "+            \"{}/++api++/search\".format(portal_url),"
            },
            "33": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 133,
                "PatchRowcode": "+        )"
            },
            "34": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 134,
                "PatchRowcode": "+"
            },
            "35": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 135,
                "PatchRowcode": "+    def test_html_request_via_multiple_bad_apis_raises_not_found(self):"
            },
            "36": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 136,
                "PatchRowcode": "+        with self.assertRaises(NotFound):"
            },
            "37": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 137,
                "PatchRowcode": "+            self.traverse(path=\"/plone/++api++/search/++api++\", accept=\"text/html\")"
            },
            "38": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 138,
                "PatchRowcode": "+"
            },
            "39": {
                "beforePatchRowNumber": 109,
                "afterPatchRowNumber": 139,
                "PatchRowcode": "     def test_virtual_hosting(self):"
            },
            "40": {
                "beforePatchRowNumber": 110,
                "afterPatchRowNumber": 140,
                "PatchRowcode": "         app = self.layer[\"app\"]"
            },
            "41": {
                "beforePatchRowNumber": 111,
                "afterPatchRowNumber": 141,
                "PatchRowcode": "         vhm = VirtualHostMonster()"
            }
        },
        "frontPatchFile": [
            "# -*- coding: utf-8 -*-",
            "from Products.SiteAccess.VirtualHostMonster import VirtualHostMonster",
            "from ZPublisher import BeforeTraverse",
            "from ZPublisher.pubevents import PubStart",
            "from base64 import b64encode",
            "from plone.app.layout.navigation.interfaces import INavigationRoot",
            "from plone.app.testing import setRoles",
            "from plone.app.testing import SITE_OWNER_NAME",
            "from plone.app.testing import SITE_OWNER_PASSWORD",
            "from plone.app.testing import TEST_USER_ID",
            "from plone.rest.service import Service",
            "from plone.rest.testing import PLONE_REST_INTEGRATION_TESTING",
            "from zope.event import notify",
            "from zope.interface import alsoProvides",
            "from zope.publisher.interfaces.browser import IBrowserView",
            "",
            "import unittest",
            "",
            "",
            "class TestTraversal(unittest.TestCase):",
            "",
            "    layer = PLONE_REST_INTEGRATION_TESTING",
            "",
            "    def setUp(self):",
            "        self.portal = self.layer[\"portal\"]",
            "        self.request = self.layer[\"request\"]",
            "        setRoles(self.portal, TEST_USER_ID, [\"Manager\"])",
            "",
            "    def traverse(self, path=\"/plone\", accept=\"application/json\", method=\"GET\"):",
            "        request = self.layer[\"request\"]",
            "        request.environ[\"PATH_INFO\"] = path",
            "        request.environ[\"PATH_TRANSLATED\"] = path",
            "        request.environ[\"HTTP_ACCEPT\"] = accept",
            "        request.environ[\"REQUEST_METHOD\"] = method",
            "        auth = \"%s:%s\" % (SITE_OWNER_NAME, SITE_OWNER_PASSWORD)",
            "        b64auth = b64encode(auth.encode(\"utf8\"))",
            "        request._auth = \"Basic %s\" % b64auth.decode(\"utf8\")",
            "        notify(PubStart(request))",
            "        return request.traverse(path)",
            "",
            "    def test_json_request_on_portal_root_returns_service(self):",
            "        obj = self.traverse()",
            "        self.assertTrue(isinstance(obj, Service), \"Not a service\")",
            "",
            "    def test_json_request_on_portal_root_with_layout_returns_service(self):",
            "        self.portal.setLayout(\"summary_view\")",
            "        obj = self.traverse()",
            "        self.assertTrue(isinstance(obj, Service), \"Not a service\")",
            "",
            "    def test_json_request_on_portal_root_with_default_page_returns_service(self):",
            "        self.portal.invokeFactory(\"Document\", id=\"doc1\")",
            "        self.portal.setDefaultPage(\"doc1\")",
            "        obj = self.traverse()",
            "        self.assertTrue(isinstance(obj, Service), \"Not a service\")",
            "",
            "    def test_json_request_on_content_object_returns_service(self):",
            "        self.portal.invokeFactory(\"Document\", id=\"doc1\")",
            "        obj = self.traverse(path=\"/plone/doc1\")",
            "        self.assertTrue(isinstance(obj, Service), \"Not a service\")",
            "",
            "    def test_html_request_on_portal_root_returns_default_view(self):",
            "        obj = self.traverse(accept=\"text/html\")",
            "        self.assertEqual(self.portal.getDefaultLayout(), obj.__name__)",
            "",
            "    def test_html_request_on_portal_root_returns_dynamic_view(self):",
            "        self.portal.setLayout(\"summary_view\")",
            "        obj = self.traverse(accept=\"text/html\")",
            "        self.assertEqual(\"summary_view\", obj.__name__)",
            "",
            "    def test_html_request_on_portal_root_returns_default_page(self):",
            "        self.portal.invokeFactory(\"Document\", id=\"doc1\")",
            "        self.portal.setDefaultPage(\"doc1\")",
            "        obj = self.traverse(accept=\"text/html\")",
            "        self.assertEqual(\"document_view\", obj.__name__)",
            "",
            "    def test_json_request_on_object_with_multihook(self):",
            "        doc1 = self.portal[self.portal.invokeFactory(\"Document\", id=\"doc1\")]",
            "",
            "        # Register a function to be called before traversal",
            "        def btr_test(container, request):",
            "            request._btr_test_called = 1",
            "",
            "        doc1.btr_test = btr_test",
            "        nc = BeforeTraverse.NameCaller(\"btr_test\")",
            "        BeforeTraverse.registerBeforeTraverse(doc1, nc, \"Document/btr_test\")",
            "",
            "        obj = self.traverse(path=\"/plone/doc1\")",
            "        self.assertTrue(isinstance(obj, Service), \"Not a service\")",
            "        self.assertEqual(1, self.request._btr_test_called)",
            "",
            "    def test_json_request_on_existing_view_returns_named_service(self):",
            "        obj = self.traverse(\"/plone/search\")",
            "        self.assertTrue(isinstance(obj, Service), \"Not a service\")",
            "",
            "        folder = self.portal[self.portal.invokeFactory(\"Folder\", id=\"folder1\")]",
            "        alsoProvides(folder, INavigationRoot)",
            "        obj = self.traverse(\"/plone/folder1/search\")",
            "        self.assertTrue(isinstance(obj, Service), \"Not a service\")",
            "",
            "    def test_html_request_on_existing_view_returns_view(self):",
            "        obj = self.traverse(path=\"/plone/search\", accept=\"text/html\")",
            "        self.assertFalse(isinstance(obj, Service), \"Got a service\")",
            "",
            "        folder = self.portal[self.portal.invokeFactory(\"Folder\", id=\"folder1\")]",
            "        alsoProvides(folder, INavigationRoot)",
            "        obj = self.traverse(path=\"/plone/folder1/search\", accept=\"text/html\")",
            "        self.assertFalse(isinstance(obj, Service), \"Got a service\")",
            "",
            "    def test_virtual_hosting(self):",
            "        app = self.layer[\"app\"]",
            "        vhm = VirtualHostMonster()",
            "        vhm.id = \"virtual_hosting\"",
            "        vhm.addToContainer(app)",
            "        obj = self.traverse(",
            "            path=\"/VirtualHostBase/http/localhost:8080/plone/VirtualHostRoot/\"",
            "        )  # noqa",
            "        self.assertTrue(isinstance(obj, Service), \"Not a service\")",
            "        del app[\"virtual_hosting\"]",
            "",
            "    def test_json_request_to_regular_view_returns_view(self):",
            "        obj = self.traverse(\"/plone/folder_contents\")",
            "        self.assertTrue(IBrowserView.providedBy(obj), \"IBrowserView expected\")",
            "",
            "        self.portal[self.portal.invokeFactory(\"Folder\", id=\"folder1\")]",
            "        obj = self.traverse(\"/plone/folder1/folder_contents\")",
            "        self.assertTrue(IBrowserView.providedBy(obj), \"IBrowserView expected\")",
            "",
            "    def test_json_request_to_view_namespace_returns_view(self):",
            "        obj = self.traverse(\"/plone/@@folder_contents\")",
            "        self.assertTrue(IBrowserView.providedBy(obj), \"IBrowserView expected\")",
            "",
            "        self.portal[self.portal.invokeFactory(\"Folder\", id=\"folder1\")]",
            "        obj = self.traverse(\"/plone/folder1/@@folder_contents\")",
            "        self.assertTrue(IBrowserView.providedBy(obj), \"IBrowserView expected\")"
        ],
        "afterPatchFile": [
            "# -*- coding: utf-8 -*-",
            "from Products.SiteAccess.VirtualHostMonster import VirtualHostMonster",
            "from ZPublisher import BeforeTraverse",
            "from ZPublisher.pubevents import PubStart",
            "from base64 import b64encode",
            "from plone.app.layout.navigation.interfaces import INavigationRoot",
            "from plone.app.testing import setRoles",
            "from plone.app.testing import SITE_OWNER_NAME",
            "from plone.app.testing import SITE_OWNER_PASSWORD",
            "from plone.app.testing import TEST_USER_ID",
            "from plone.rest.service import Service",
            "from plone.rest.testing import PLONE_REST_INTEGRATION_TESTING",
            "from zExceptions import NotFound",
            "from zExceptions import Redirect",
            "from zope.event import notify",
            "from zope.interface import alsoProvides",
            "from zope.publisher.interfaces.browser import IBrowserView",
            "",
            "import unittest",
            "",
            "",
            "class TestTraversal(unittest.TestCase):",
            "",
            "    layer = PLONE_REST_INTEGRATION_TESTING",
            "",
            "    def setUp(self):",
            "        self.portal = self.layer[\"portal\"]",
            "        self.request = self.layer[\"request\"]",
            "        setRoles(self.portal, TEST_USER_ID, [\"Manager\"])",
            "",
            "    def traverse(self, path=\"/plone\", accept=\"application/json\", method=\"GET\"):",
            "        request = self.layer[\"request\"]",
            "        request.environ[\"PATH_INFO\"] = path",
            "        request.environ[\"PATH_TRANSLATED\"] = path",
            "        request.environ[\"HTTP_ACCEPT\"] = accept",
            "        request.environ[\"REQUEST_METHOD\"] = method",
            "        auth = \"%s:%s\" % (SITE_OWNER_NAME, SITE_OWNER_PASSWORD)",
            "        b64auth = b64encode(auth.encode(\"utf8\"))",
            "        request._auth = \"Basic %s\" % b64auth.decode(\"utf8\")",
            "        notify(PubStart(request))",
            "        return request.traverse(path)",
            "",
            "    def test_json_request_on_portal_root_returns_service(self):",
            "        obj = self.traverse()",
            "        self.assertTrue(isinstance(obj, Service), \"Not a service\")",
            "",
            "    def test_json_request_on_portal_root_with_layout_returns_service(self):",
            "        self.portal.setLayout(\"summary_view\")",
            "        obj = self.traverse()",
            "        self.assertTrue(isinstance(obj, Service), \"Not a service\")",
            "",
            "    def test_json_request_on_portal_root_with_default_page_returns_service(self):",
            "        self.portal.invokeFactory(\"Document\", id=\"doc1\")",
            "        self.portal.setDefaultPage(\"doc1\")",
            "        obj = self.traverse()",
            "        self.assertTrue(isinstance(obj, Service), \"Not a service\")",
            "",
            "    def test_json_request_on_content_object_returns_service(self):",
            "        self.portal.invokeFactory(\"Document\", id=\"doc1\")",
            "        obj = self.traverse(path=\"/plone/doc1\")",
            "        self.assertTrue(isinstance(obj, Service), \"Not a service\")",
            "",
            "    def test_html_request_on_portal_root_returns_default_view(self):",
            "        obj = self.traverse(accept=\"text/html\")",
            "        self.assertEqual(self.portal.getDefaultLayout(), obj.__name__)",
            "",
            "    def test_html_request_on_portal_root_returns_dynamic_view(self):",
            "        self.portal.setLayout(\"summary_view\")",
            "        obj = self.traverse(accept=\"text/html\")",
            "        self.assertEqual(\"summary_view\", obj.__name__)",
            "",
            "    def test_html_request_on_portal_root_returns_default_page(self):",
            "        self.portal.invokeFactory(\"Document\", id=\"doc1\")",
            "        self.portal.setDefaultPage(\"doc1\")",
            "        obj = self.traverse(accept=\"text/html\")",
            "        self.assertEqual(\"document_view\", obj.__name__)",
            "",
            "    def test_json_request_on_object_with_multihook(self):",
            "        doc1 = self.portal[self.portal.invokeFactory(\"Document\", id=\"doc1\")]",
            "",
            "        # Register a function to be called before traversal",
            "        def btr_test(container, request):",
            "            request._btr_test_called = 1",
            "",
            "        doc1.btr_test = btr_test",
            "        nc = BeforeTraverse.NameCaller(\"btr_test\")",
            "        BeforeTraverse.registerBeforeTraverse(doc1, nc, \"Document/btr_test\")",
            "",
            "        obj = self.traverse(path=\"/plone/doc1\")",
            "        self.assertTrue(isinstance(obj, Service), \"Not a service\")",
            "        self.assertEqual(1, self.request._btr_test_called)",
            "",
            "    def test_json_request_on_existing_view_returns_named_service(self):",
            "        obj = self.traverse(\"/plone/search\")",
            "        self.assertTrue(isinstance(obj, Service), \"Not a service\")",
            "",
            "        folder = self.portal[self.portal.invokeFactory(\"Folder\", id=\"folder1\")]",
            "        alsoProvides(folder, INavigationRoot)",
            "        obj = self.traverse(\"/plone/folder1/search\")",
            "        self.assertTrue(isinstance(obj, Service), \"Not a service\")",
            "",
            "    def test_html_request_on_existing_view_returns_view(self):",
            "        obj = self.traverse(path=\"/plone/search\", accept=\"text/html\")",
            "        self.assertFalse(isinstance(obj, Service), \"Got a service\")",
            "",
            "        folder = self.portal[self.portal.invokeFactory(\"Folder\", id=\"folder1\")]",
            "        alsoProvides(folder, INavigationRoot)",
            "        obj = self.traverse(path=\"/plone/folder1/search\", accept=\"text/html\")",
            "        self.assertFalse(isinstance(obj, Service), \"Got a service\")",
            "",
            "    def test_html_request_via_api_returns_service(self):",
            "        obj = self.traverse(path=\"/plone/++api++\", accept=\"text/html\")",
            "        self.assertTrue(isinstance(obj, Service), \"Not a service\")",
            "",
            "    def test_html_request_via_double_apis_raises_redirect(self):",
            "        portal_url = self.portal.absolute_url()",
            "        with self.assertRaises(Redirect) as exc:",
            "            self.traverse(path=\"/plone/++api++/++api++\", accept=\"text/html\")",
            "        self.assertEqual(",
            "            exc.exception.headers[\"Location\"],",
            "            \"{}/++api++\".format(portal_url),",
            "        )",
            "",
            "    def test_html_request_via_multiple_apis_raises_redirect(self):",
            "        portal_url = self.portal.absolute_url()",
            "        with self.assertRaises(Redirect) as exc:",
            "            self.traverse(",
            "                path=\"/plone/++api++/++api++/++api++/search\", accept=\"text/html\"",
            "            )",
            "        self.assertEqual(",
            "            exc.exception.headers[\"Location\"],",
            "            \"{}/++api++/search\".format(portal_url),",
            "        )",
            "",
            "    def test_html_request_via_multiple_bad_apis_raises_not_found(self):",
            "        with self.assertRaises(NotFound):",
            "            self.traverse(path=\"/plone/++api++/search/++api++\", accept=\"text/html\")",
            "",
            "    def test_virtual_hosting(self):",
            "        app = self.layer[\"app\"]",
            "        vhm = VirtualHostMonster()",
            "        vhm.id = \"virtual_hosting\"",
            "        vhm.addToContainer(app)",
            "        obj = self.traverse(",
            "            path=\"/VirtualHostBase/http/localhost:8080/plone/VirtualHostRoot/\"",
            "        )  # noqa",
            "        self.assertTrue(isinstance(obj, Service), \"Not a service\")",
            "        del app[\"virtual_hosting\"]",
            "",
            "    def test_json_request_to_regular_view_returns_view(self):",
            "        obj = self.traverse(\"/plone/folder_contents\")",
            "        self.assertTrue(IBrowserView.providedBy(obj), \"IBrowserView expected\")",
            "",
            "        self.portal[self.portal.invokeFactory(\"Folder\", id=\"folder1\")]",
            "        obj = self.traverse(\"/plone/folder1/folder_contents\")",
            "        self.assertTrue(IBrowserView.providedBy(obj), \"IBrowserView expected\")",
            "",
            "    def test_json_request_to_view_namespace_returns_view(self):",
            "        obj = self.traverse(\"/plone/@@folder_contents\")",
            "        self.assertTrue(IBrowserView.providedBy(obj), \"IBrowserView expected\")",
            "",
            "        self.portal[self.portal.invokeFactory(\"Folder\", id=\"folder1\")]",
            "        obj = self.traverse(\"/plone/folder1/@@folder_contents\")",
            "        self.assertTrue(IBrowserView.providedBy(obj), \"IBrowserView expected\")"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {},
        "addLocation": [
            "src.plone.rest.tests.test_traversal.TestTraversal.self",
            "litestar.connection.request"
        ]
    },
    "src/plone/rest/traverse.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 5,
                "afterPatchRowNumber": 5,
                "PatchRowcode": " from plone.rest.interfaces import IAPIRequest"
            },
            "1": {
                "beforePatchRowNumber": 6,
                "afterPatchRowNumber": 6,
                "PatchRowcode": " from plone.rest.interfaces import IService"
            },
            "2": {
                "beforePatchRowNumber": 7,
                "afterPatchRowNumber": 7,
                "PatchRowcode": " from plone.rest.events import mark_as_api_request"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 8,
                "PatchRowcode": "+from zExceptions import Redirect"
            },
            "4": {
                "beforePatchRowNumber": 8,
                "afterPatchRowNumber": 9,
                "PatchRowcode": " from zope.component import adapter"
            },
            "5": {
                "beforePatchRowNumber": 9,
                "afterPatchRowNumber": 10,
                "PatchRowcode": " from zope.component import queryMultiAdapter"
            },
            "6": {
                "beforePatchRowNumber": 10,
                "afterPatchRowNumber": 11,
                "PatchRowcode": " from zope.interface import implementer"
            },
            "7": {
                "beforePatchRowNumber": 64,
                "afterPatchRowNumber": 65,
                "PatchRowcode": "         self.request = request"
            },
            "8": {
                "beforePatchRowNumber": 65,
                "afterPatchRowNumber": 66,
                "PatchRowcode": " "
            },
            "9": {
                "beforePatchRowNumber": 66,
                "afterPatchRowNumber": 67,
                "PatchRowcode": "     def traverse(self, name_ignored, subpath_ignored):"
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 68,
                "PatchRowcode": "+        name = \"/++api++\""
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 69,
                "PatchRowcode": "+        url = self.request.ACTUAL_URL"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 70,
                "PatchRowcode": "+        if url.count(name) > 1:"
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 71,
                "PatchRowcode": "+            # Redirect to proper url."
            },
            "14": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 72,
                "PatchRowcode": "+            while name + name in url:"
            },
            "15": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 73,
                "PatchRowcode": "+                url = url.replace(name + name, name)"
            },
            "16": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 74,
                "PatchRowcode": "+            if url.count(name) > 1:"
            },
            "17": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 75,
                "PatchRowcode": "+                # Something like: .../++api++/something/++api++"
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 76,
                "PatchRowcode": "+                # Return nothing, so a NotFound is raised."
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 77,
                "PatchRowcode": "+                return"
            },
            "20": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 78,
                "PatchRowcode": "+            # Raise a redirect exception to stop execution of the current request."
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 79,
                "PatchRowcode": "+            raise Redirect(url)"
            },
            "22": {
                "beforePatchRowNumber": 67,
                "afterPatchRowNumber": 80,
                "PatchRowcode": "         mark_as_api_request(self.request, \"application/json\")"
            },
            "23": {
                "beforePatchRowNumber": 68,
                "afterPatchRowNumber": 81,
                "PatchRowcode": "         return self.context"
            },
            "24": {
                "beforePatchRowNumber": 69,
                "afterPatchRowNumber": 82,
                "PatchRowcode": " "
            }
        },
        "frontPatchFile": [
            "# -*- coding: utf-8 -*-",
            "from Products.CMFCore.interfaces import ISiteRoot",
            "from Products.SiteAccess.VirtualHostMonster import VirtualHostMonster",
            "from ZPublisher.BaseRequest import DefaultPublishTraverse",
            "from plone.rest.interfaces import IAPIRequest",
            "from plone.rest.interfaces import IService",
            "from plone.rest.events import mark_as_api_request",
            "from zope.component import adapter",
            "from zope.component import queryMultiAdapter",
            "from zope.interface import implementer",
            "from zope.publisher.interfaces.browser import IBrowserPublisher",
            "from zope.traversing.interfaces import ITraversable",
            "from Products.CMFCore.interfaces import IContentish",
            "",
            "",
            "@adapter(ISiteRoot, IAPIRequest)",
            "class RESTTraverse(DefaultPublishTraverse):",
            "    def publishTraverse(self, request, name):",
            "        try:",
            "            obj = super(RESTTraverse, self).publishTraverse(request, name)",
            "            if not IContentish.providedBy(obj) and not IService.providedBy(obj):",
            "                if isinstance(obj, VirtualHostMonster):",
            "                    return obj",
            "                else:",
            "                    raise KeyError",
            "        except KeyError:",
            "            # No object, maybe a named rest service",
            "            service = queryMultiAdapter(",
            "                (self.context, request), name=request._rest_service_id + name",
            "            )",
            "            if service is None:",
            "                # No service, fallback to regular view",
            "                view = queryMultiAdapter((self.context, request), name=name)",
            "                if view is not None:",
            "                    return view",
            "                raise",
            "            return service",
            "",
            "        if name.startswith(request._rest_service_id):",
            "            return obj",
            "",
            "        # Do not handle view namespace",
            "        if \"@@\" in request[\"PATH_INFO\"] or \"++view++\" in request[\"PATH_INFO\"]:",
            "            return obj",
            "",
            "        # Wrap object to ensure we handle further traversal",
            "        return RESTWrapper(obj, request)",
            "",
            "    def browserDefault(self, request):",
            "        # Called when we have reached the end of the path",
            "        # In our case this means an unamed service",
            "        return self.context, (request._rest_service_id,)",
            "",
            "",
            "@implementer(ITraversable)",
            "class MarkAsRESTTraverser(object):",
            "    \"\"\"",
            "    Traversal adapter for the ``++api++`` namespace.",
            "    It marks the request as API request.",
            "    \"\"\"",
            "",
            "    def __init__(self, context, request):",
            "        self.context = context",
            "        self.request = request",
            "",
            "    def traverse(self, name_ignored, subpath_ignored):",
            "        mark_as_api_request(self.request, \"application/json\")",
            "        return self.context",
            "",
            "",
            "@implementer(IBrowserPublisher)",
            "class RESTWrapper(object):",
            "    \"\"\"A wrapper for objects traversed during a REST request.\"\"\"",
            "",
            "    def __init__(self, context, request):",
            "        self.context = context",
            "        self.request = request",
            "        self._bpth_called = False",
            "",
            "    def __getattr__(self, name):",
            "        # Delegate attribute access to the wrapped object",
            "        # Needed for security checks in ZPublisher traversal",
            "        return getattr(self.context, name)",
            "",
            "    def __getitem__(self, name):",
            "        # Delegate key access to the wrapped object",
            "        return self.context[name]",
            "",
            "    # MultiHook requries this to be a class attribute",
            "    def __before_publishing_traverse__(self, arg1, arg2=None):",
            "        bpth = getattr(self.context, \"__before_publishing_traverse__\", False)",
            "        if bpth:",
            "            if not self._bpth_called:",
            "                self._bpth_called = True",
            "                bpth(arg1, arg2)",
            "",
            "    def publishTraverse(self, request, name):",
            "        # Try to get an object using default traversal",
            "        adapter = DefaultPublishTraverse(self.context, request)",
            "        try:",
            "            obj = adapter.publishTraverse(request, name)",
            "            if not IContentish.providedBy(obj) and not IService.providedBy(obj):",
            "                raise KeyError",
            "",
            "        # If there's no object with the given name, we get a KeyError.",
            "        # In a non-folderish context a key lookup results in an AttributeError.",
            "        except (KeyError, AttributeError):",
            "            # No object, maybe a named rest service",
            "            service = queryMultiAdapter(",
            "                (self.context, request), name=request._rest_service_id + name",
            "            )",
            "            if service is None:",
            "                # No service, fallback to regular view",
            "                view = queryMultiAdapter((self.context, request), name=name)",
            "                if view is not None:",
            "                    return view",
            "                raise",
            "            return service",
            "        else:",
            "            # Wrap object to ensure we handle further traversal",
            "            return RESTWrapper(obj, request)",
            "",
            "    def browserDefault(self, request):",
            "        # Called when we have reached the end of the path",
            "        # In our case this means an unamed service",
            "        return self.context, (request._rest_service_id,)"
        ],
        "afterPatchFile": [
            "# -*- coding: utf-8 -*-",
            "from Products.CMFCore.interfaces import ISiteRoot",
            "from Products.SiteAccess.VirtualHostMonster import VirtualHostMonster",
            "from ZPublisher.BaseRequest import DefaultPublishTraverse",
            "from plone.rest.interfaces import IAPIRequest",
            "from plone.rest.interfaces import IService",
            "from plone.rest.events import mark_as_api_request",
            "from zExceptions import Redirect",
            "from zope.component import adapter",
            "from zope.component import queryMultiAdapter",
            "from zope.interface import implementer",
            "from zope.publisher.interfaces.browser import IBrowserPublisher",
            "from zope.traversing.interfaces import ITraversable",
            "from Products.CMFCore.interfaces import IContentish",
            "",
            "",
            "@adapter(ISiteRoot, IAPIRequest)",
            "class RESTTraverse(DefaultPublishTraverse):",
            "    def publishTraverse(self, request, name):",
            "        try:",
            "            obj = super(RESTTraverse, self).publishTraverse(request, name)",
            "            if not IContentish.providedBy(obj) and not IService.providedBy(obj):",
            "                if isinstance(obj, VirtualHostMonster):",
            "                    return obj",
            "                else:",
            "                    raise KeyError",
            "        except KeyError:",
            "            # No object, maybe a named rest service",
            "            service = queryMultiAdapter(",
            "                (self.context, request), name=request._rest_service_id + name",
            "            )",
            "            if service is None:",
            "                # No service, fallback to regular view",
            "                view = queryMultiAdapter((self.context, request), name=name)",
            "                if view is not None:",
            "                    return view",
            "                raise",
            "            return service",
            "",
            "        if name.startswith(request._rest_service_id):",
            "            return obj",
            "",
            "        # Do not handle view namespace",
            "        if \"@@\" in request[\"PATH_INFO\"] or \"++view++\" in request[\"PATH_INFO\"]:",
            "            return obj",
            "",
            "        # Wrap object to ensure we handle further traversal",
            "        return RESTWrapper(obj, request)",
            "",
            "    def browserDefault(self, request):",
            "        # Called when we have reached the end of the path",
            "        # In our case this means an unamed service",
            "        return self.context, (request._rest_service_id,)",
            "",
            "",
            "@implementer(ITraversable)",
            "class MarkAsRESTTraverser(object):",
            "    \"\"\"",
            "    Traversal adapter for the ``++api++`` namespace.",
            "    It marks the request as API request.",
            "    \"\"\"",
            "",
            "    def __init__(self, context, request):",
            "        self.context = context",
            "        self.request = request",
            "",
            "    def traverse(self, name_ignored, subpath_ignored):",
            "        name = \"/++api++\"",
            "        url = self.request.ACTUAL_URL",
            "        if url.count(name) > 1:",
            "            # Redirect to proper url.",
            "            while name + name in url:",
            "                url = url.replace(name + name, name)",
            "            if url.count(name) > 1:",
            "                # Something like: .../++api++/something/++api++",
            "                # Return nothing, so a NotFound is raised.",
            "                return",
            "            # Raise a redirect exception to stop execution of the current request.",
            "            raise Redirect(url)",
            "        mark_as_api_request(self.request, \"application/json\")",
            "        return self.context",
            "",
            "",
            "@implementer(IBrowserPublisher)",
            "class RESTWrapper(object):",
            "    \"\"\"A wrapper for objects traversed during a REST request.\"\"\"",
            "",
            "    def __init__(self, context, request):",
            "        self.context = context",
            "        self.request = request",
            "        self._bpth_called = False",
            "",
            "    def __getattr__(self, name):",
            "        # Delegate attribute access to the wrapped object",
            "        # Needed for security checks in ZPublisher traversal",
            "        return getattr(self.context, name)",
            "",
            "    def __getitem__(self, name):",
            "        # Delegate key access to the wrapped object",
            "        return self.context[name]",
            "",
            "    # MultiHook requries this to be a class attribute",
            "    def __before_publishing_traverse__(self, arg1, arg2=None):",
            "        bpth = getattr(self.context, \"__before_publishing_traverse__\", False)",
            "        if bpth:",
            "            if not self._bpth_called:",
            "                self._bpth_called = True",
            "                bpth(arg1, arg2)",
            "",
            "    def publishTraverse(self, request, name):",
            "        # Try to get an object using default traversal",
            "        adapter = DefaultPublishTraverse(self.context, request)",
            "        try:",
            "            obj = adapter.publishTraverse(request, name)",
            "            if not IContentish.providedBy(obj) and not IService.providedBy(obj):",
            "                raise KeyError",
            "",
            "        # If there's no object with the given name, we get a KeyError.",
            "        # In a non-folderish context a key lookup results in an AttributeError.",
            "        except (KeyError, AttributeError):",
            "            # No object, maybe a named rest service",
            "            service = queryMultiAdapter(",
            "                (self.context, request), name=request._rest_service_id + name",
            "            )",
            "            if service is None:",
            "                # No service, fallback to regular view",
            "                view = queryMultiAdapter((self.context, request), name=name)",
            "                if view is not None:",
            "                    return view",
            "                raise",
            "            return service",
            "        else:",
            "            # Wrap object to ensure we handle further traversal",
            "            return RESTWrapper(obj, request)",
            "",
            "    def browserDefault(self, request):",
            "        # Called when we have reached the end of the path",
            "        # In our case this means an unamed service",
            "        return self.context, (request._rest_service_id,)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {},
        "addLocation": [
            "litestar.connection.request"
        ]
    }
}