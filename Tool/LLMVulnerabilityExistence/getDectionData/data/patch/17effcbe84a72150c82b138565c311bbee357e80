{
    "nautobot/core/constants.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 1,
                "PatchRowcode": "+from copy import deepcopy"
            },
            "1": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2,
                "PatchRowcode": "+"
            },
            "2": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 3,
                "PatchRowcode": "+import nh3"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 4,
                "PatchRowcode": "+"
            },
            "4": {
                "beforePatchRowNumber": 1,
                "afterPatchRowNumber": 5,
                "PatchRowcode": " SEARCH_MAX_RESULTS = 15"
            },
            "5": {
                "beforePatchRowNumber": 2,
                "afterPatchRowNumber": 6,
                "PatchRowcode": " "
            },
            "6": {
                "beforePatchRowNumber": 3,
                "afterPatchRowNumber": 7,
                "PatchRowcode": " #"
            },
            "7": {
                "beforePatchRowNumber": 32,
                "afterPatchRowNumber": 36,
                "PatchRowcode": " "
            },
            "8": {
                "beforePatchRowNumber": 33,
                "afterPatchRowNumber": 37,
                "PatchRowcode": " FILTER_NEGATION_LOOKUP_MAP = {\"n\": \"exact\"}"
            },
            "9": {
                "beforePatchRowNumber": 34,
                "afterPatchRowNumber": 38,
                "PatchRowcode": " "
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 39,
                "PatchRowcode": "+#"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 40,
                "PatchRowcode": "+# User input sanitization"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 41,
                "PatchRowcode": "+#"
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 42,
                "PatchRowcode": "+"
            },
            "14": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 43,
                "PatchRowcode": "+# Subset of the HTML tags allowed by default by ammonia:"
            },
            "15": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 44,
                "PatchRowcode": "+# https://github.com/rust-ammonia/ammonia/blob/master/src/lib.rs"
            },
            "16": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 45,
                "PatchRowcode": "+HTML_ALLOWED_TAGS = nh3.ALLOWED_TAGS - {"
            },
            "17": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 46,
                "PatchRowcode": "+    # no image maps at present"
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 47,
                "PatchRowcode": "+    \"area\","
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 48,
                "PatchRowcode": "+    \"map\","
            },
            "20": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 49,
                "PatchRowcode": "+    # no document-level markup at present"
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 50,
                "PatchRowcode": "+    \"article\","
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 51,
                "PatchRowcode": "+    \"aside\","
            },
            "23": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 52,
                "PatchRowcode": "+    \"footer\","
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 53,
                "PatchRowcode": "+    \"header\","
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 54,
                "PatchRowcode": "+    \"nav\","
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 55,
                "PatchRowcode": "+    # miscellaneous out-of-scope for now"
            },
            "27": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 56,
                "PatchRowcode": "+    \"data\","
            },
            "28": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 57,
                "PatchRowcode": "+    \"dfn\","
            },
            "29": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 58,
                "PatchRowcode": "+    \"figcaption\","
            },
            "30": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 59,
                "PatchRowcode": "+    \"figure\","
            },
            "31": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 60,
                "PatchRowcode": "+}"
            },
            "32": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 61,
                "PatchRowcode": "+"
            },
            "33": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 62,
                "PatchRowcode": "+# Variant of the HTML attributes allowed by default by ammonia:"
            },
            "34": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 63,
                "PatchRowcode": "+# https://github.com/rust-ammonia/ammonia/blob/master/src/lib.rs"
            },
            "35": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 64,
                "PatchRowcode": "+# at present we just copy nh3.ALLOWED_ATTRIBUTES but we can modify this later as desired and appropriate"
            },
            "36": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 65,
                "PatchRowcode": "+HTML_ALLOWED_ATTRIBUTES = deepcopy(nh3.ALLOWED_ATTRIBUTES)"
            },
            "37": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 66,
                "PatchRowcode": "+"
            },
            "38": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 67,
                "PatchRowcode": "+"
            },
            "39": {
                "beforePatchRowNumber": 35,
                "afterPatchRowNumber": 68,
                "PatchRowcode": " #"
            },
            "40": {
                "beforePatchRowNumber": 36,
                "afterPatchRowNumber": 69,
                "PatchRowcode": " # Reserved Names"
            },
            "41": {
                "beforePatchRowNumber": 37,
                "afterPatchRowNumber": 70,
                "PatchRowcode": " #"
            }
        },
        "frontPatchFile": [
            "SEARCH_MAX_RESULTS = 15",
            "",
            "#",
            "# Filter lookup expressions",
            "#",
            "",
            "SEARCH_MAX_RESULTS = 15",
            "",
            "FILTER_CHAR_BASED_LOOKUP_MAP = {",
            "    \"n\": \"exact\",",
            "    \"ic\": \"icontains\",",
            "    \"nic\": \"icontains\",",
            "    \"iew\": \"iendswith\",",
            "    \"niew\": \"iendswith\",",
            "    \"isw\": \"istartswith\",",
            "    \"nisw\": \"istartswith\",",
            "    \"ie\": \"iexact\",",
            "    \"nie\": \"iexact\",",
            "    \"re\": \"regex\",",
            "    \"nre\": \"regex\",",
            "    \"ire\": \"iregex\",",
            "    \"nire\": \"iregex\",",
            "}",
            "",
            "FILTER_NUMERIC_BASED_LOOKUP_MAP = {",
            "    \"n\": \"exact\",",
            "    \"lte\": \"lte\",",
            "    \"lt\": \"lt\",",
            "    \"gte\": \"gte\",",
            "    \"gt\": \"gt\",",
            "}",
            "",
            "FILTER_NEGATION_LOOKUP_MAP = {\"n\": \"exact\"}",
            "",
            "#",
            "# Reserved Names",
            "#",
            "",
            "RESERVED_NAMES_FOR_OBJECT_DETAIL_VIEW_SCHEMA = [\"Other Fields\", \"Object Details\"]",
            "",
            "#",
            "# Factory defaults",
            "#",
            "",
            "NAUTOBOT_BOOL_ITERATOR_DEFAULT_LENGTH = 8",
            "NAUTOBOT_BOOL_ITERATOR_DEFAULT_PROBABILITY = 50",
            "",
            "",
            "#",
            "# CSV Import/Export",
            "#",
            "",
            "CSV_NULL_TYPE = \"NULL\"",
            "CSV_NO_OBJECT = \"NoObject\"",
            "# VarbinaryIPField Represents b'NoObject' as `::4e6f:4f62:6a65:6374`",
            "VARBINARY_IP_FIELD_REPR_OF_CSV_NO_OBJECT = \"::4e6f:4f62:6a65:6374\"",
            "",
            "",
            "# For our purposes, COMPOSITE_KEY_SEPARATOR needs to be:",
            "# 1. Safe in a URL path component (so that we can do URLS like \"/dcim/devices/<composite_key>/delete/\")",
            "#    Per RFC3986 section 2.3 the general \"unreserved\" characters are ALPHA and DIGIT and the characters -._~",
            "#    Per RFC3986 section 3.3 path components also permit characters :@ and the \"sub-delims\" characters !$&'()*+,;=",
            "# 2. Not readily confused with characters commonly seen in un-escaped natural key component fields",
            "#    \".\" is already ruled out as an unreserved character but also would appear in IPv4 IPAddress and Prefix objects",
            "#    \":\" similarly would appear in IPv6 IPAddress/Prefix objects",
            "#    \"/\" would appear in Prefix objects as well as various numbered device component names",
            "# 3. Safe in a URL query string component (so that we can do URLs like \"/dcim/devices/?location=<composite_key>\"",
            "#    This rules out \"&\" and \"=\"",
            "COMPOSITE_KEY_SEPARATOR = \";\"",
            "",
            "# For the natural slug separator, it's much simpler and we can just go with \"_\".",
            "NATURAL_SLUG_SEPARATOR = \"_\""
        ],
        "afterPatchFile": [
            "from copy import deepcopy",
            "",
            "import nh3",
            "",
            "SEARCH_MAX_RESULTS = 15",
            "",
            "#",
            "# Filter lookup expressions",
            "#",
            "",
            "SEARCH_MAX_RESULTS = 15",
            "",
            "FILTER_CHAR_BASED_LOOKUP_MAP = {",
            "    \"n\": \"exact\",",
            "    \"ic\": \"icontains\",",
            "    \"nic\": \"icontains\",",
            "    \"iew\": \"iendswith\",",
            "    \"niew\": \"iendswith\",",
            "    \"isw\": \"istartswith\",",
            "    \"nisw\": \"istartswith\",",
            "    \"ie\": \"iexact\",",
            "    \"nie\": \"iexact\",",
            "    \"re\": \"regex\",",
            "    \"nre\": \"regex\",",
            "    \"ire\": \"iregex\",",
            "    \"nire\": \"iregex\",",
            "}",
            "",
            "FILTER_NUMERIC_BASED_LOOKUP_MAP = {",
            "    \"n\": \"exact\",",
            "    \"lte\": \"lte\",",
            "    \"lt\": \"lt\",",
            "    \"gte\": \"gte\",",
            "    \"gt\": \"gt\",",
            "}",
            "",
            "FILTER_NEGATION_LOOKUP_MAP = {\"n\": \"exact\"}",
            "",
            "#",
            "# User input sanitization",
            "#",
            "",
            "# Subset of the HTML tags allowed by default by ammonia:",
            "# https://github.com/rust-ammonia/ammonia/blob/master/src/lib.rs",
            "HTML_ALLOWED_TAGS = nh3.ALLOWED_TAGS - {",
            "    # no image maps at present",
            "    \"area\",",
            "    \"map\",",
            "    # no document-level markup at present",
            "    \"article\",",
            "    \"aside\",",
            "    \"footer\",",
            "    \"header\",",
            "    \"nav\",",
            "    # miscellaneous out-of-scope for now",
            "    \"data\",",
            "    \"dfn\",",
            "    \"figcaption\",",
            "    \"figure\",",
            "}",
            "",
            "# Variant of the HTML attributes allowed by default by ammonia:",
            "# https://github.com/rust-ammonia/ammonia/blob/master/src/lib.rs",
            "# at present we just copy nh3.ALLOWED_ATTRIBUTES but we can modify this later as desired and appropriate",
            "HTML_ALLOWED_ATTRIBUTES = deepcopy(nh3.ALLOWED_ATTRIBUTES)",
            "",
            "",
            "#",
            "# Reserved Names",
            "#",
            "",
            "RESERVED_NAMES_FOR_OBJECT_DETAIL_VIEW_SCHEMA = [\"Other Fields\", \"Object Details\"]",
            "",
            "#",
            "# Factory defaults",
            "#",
            "",
            "NAUTOBOT_BOOL_ITERATOR_DEFAULT_LENGTH = 8",
            "NAUTOBOT_BOOL_ITERATOR_DEFAULT_PROBABILITY = 50",
            "",
            "",
            "#",
            "# CSV Import/Export",
            "#",
            "",
            "CSV_NULL_TYPE = \"NULL\"",
            "CSV_NO_OBJECT = \"NoObject\"",
            "# VarbinaryIPField Represents b'NoObject' as `::4e6f:4f62:6a65:6374`",
            "VARBINARY_IP_FIELD_REPR_OF_CSV_NO_OBJECT = \"::4e6f:4f62:6a65:6374\"",
            "",
            "",
            "# For our purposes, COMPOSITE_KEY_SEPARATOR needs to be:",
            "# 1. Safe in a URL path component (so that we can do URLS like \"/dcim/devices/<composite_key>/delete/\")",
            "#    Per RFC3986 section 2.3 the general \"unreserved\" characters are ALPHA and DIGIT and the characters -._~",
            "#    Per RFC3986 section 3.3 path components also permit characters :@ and the \"sub-delims\" characters !$&'()*+,;=",
            "# 2. Not readily confused with characters commonly seen in un-escaped natural key component fields",
            "#    \".\" is already ruled out as an unreserved character but also would appear in IPv4 IPAddress and Prefix objects",
            "#    \":\" similarly would appear in IPv6 IPAddress/Prefix objects",
            "#    \"/\" would appear in Prefix objects as well as various numbered device component names",
            "# 3. Safe in a URL query string component (so that we can do URLs like \"/dcim/devices/?location=<composite_key>\"",
            "#    This rules out \"&\" and \"=\"",
            "COMPOSITE_KEY_SEPARATOR = \";\"",
            "",
            "# For the natural slug separator, it's much simpler and we can just go with \"_\".",
            "NATURAL_SLUG_SEPARATOR = \"_\""
        ],
        "action": [
            "-1",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {},
        "addLocation": []
    },
    "nautobot/core/forms/fields.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 9,
                "afterPatchRowNumber": 9,
                "PatchRowcode": " from django.core.exceptions import MultipleObjectsReturned, ObjectDoesNotExist, ValidationError"
            },
            "1": {
                "beforePatchRowNumber": 10,
                "afterPatchRowNumber": 10,
                "PatchRowcode": " from django.db.models import Q"
            },
            "2": {
                "beforePatchRowNumber": 11,
                "afterPatchRowNumber": 11,
                "PatchRowcode": " from django.forms.fields import BoundField, InvalidJSONInput, JSONField as _JSONField"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 12,
                "PatchRowcode": "+from django.templatetags.static import static"
            },
            "4": {
                "beforePatchRowNumber": 12,
                "afterPatchRowNumber": 13,
                "PatchRowcode": " from django.urls import reverse"
            },
            "5": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 14,
                "PatchRowcode": "+from django.utils.html import format_html"
            },
            "6": {
                "beforePatchRowNumber": 13,
                "afterPatchRowNumber": 15,
                "PatchRowcode": " import django_filters"
            },
            "7": {
                "beforePatchRowNumber": 14,
                "afterPatchRowNumber": 16,
                "PatchRowcode": " from netaddr import EUI"
            },
            "8": {
                "beforePatchRowNumber": 15,
                "afterPatchRowNumber": 17,
                "PatchRowcode": " from netaddr.core import AddrFormatError"
            },
            "9": {
                "beforePatchRowNumber": 372,
                "afterPatchRowNumber": 374,
                "PatchRowcode": " "
            },
            "10": {
                "beforePatchRowNumber": 373,
                "afterPatchRowNumber": 375,
                "PatchRowcode": "     widget = django_forms.Textarea"
            },
            "11": {
                "beforePatchRowNumber": 374,
                "afterPatchRowNumber": 376,
                "PatchRowcode": "     default_label = \"\""
            },
            "12": {
                "beforePatchRowNumber": 375,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    # TODO: Port Markdown cheat sheet to internal documentation"
            },
            "13": {
                "beforePatchRowNumber": 376,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    default_helptext = ("
            },
            "14": {
                "beforePatchRowNumber": 377,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        '<i class=\"mdi mdi-information-outline\"></i> '"
            },
            "15": {
                "beforePatchRowNumber": 378,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        '<a href=\"https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet\" target=\"_blank\">'"
            },
            "16": {
                "beforePatchRowNumber": 379,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        \"Markdown</a> syntax is supported\""
            },
            "17": {
                "beforePatchRowNumber": 380,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    )"
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 377,
                "PatchRowcode": "+"
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 378,
                "PatchRowcode": "+    @property"
            },
            "20": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 379,
                "PatchRowcode": "+    def default_helptext(self):"
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 380,
                "PatchRowcode": "+        # TODO: Port Markdown cheat sheet to internal documentation"
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 381,
                "PatchRowcode": "+        return format_html("
            },
            "23": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 382,
                "PatchRowcode": "+            '<i class=\"mdi mdi-information-outline\"></i> '"
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 383,
                "PatchRowcode": "+            '<a href=\"https://www.markdownguide.org/cheat-sheet/#basic-syntax\" rel=\"noopener noreferrer\">Markdown</a> '"
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 384,
                "PatchRowcode": "+            'syntax is supported, as well as <a href=\"{}#render_markdown\">a limited subset of HTML</a>.',"
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 385,
                "PatchRowcode": "+            static(\"docs/user-guide/platform-functionality/template-filters.html\"),"
            },
            "27": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 386,
                "PatchRowcode": "+        )"
            },
            "28": {
                "beforePatchRowNumber": 381,
                "afterPatchRowNumber": 387,
                "PatchRowcode": " "
            },
            "29": {
                "beforePatchRowNumber": 382,
                "afterPatchRowNumber": 388,
                "PatchRowcode": "     def __init__(self, *args, **kwargs):"
            },
            "30": {
                "beforePatchRowNumber": 383,
                "afterPatchRowNumber": 389,
                "PatchRowcode": "         required = kwargs.pop(\"required\", False)"
            }
        },
        "frontPatchFile": [
            "import json",
            "import re",
            "",
            "from django import forms as django_forms",
            "from django.apps import apps",
            "from django.conf import settings",
            "from django.contrib.contenttypes.models import ContentType",
            "from django.contrib.postgres.forms import SimpleArrayField",
            "from django.core.exceptions import MultipleObjectsReturned, ObjectDoesNotExist, ValidationError",
            "from django.db.models import Q",
            "from django.forms.fields import BoundField, InvalidJSONInput, JSONField as _JSONField",
            "from django.urls import reverse",
            "import django_filters",
            "from netaddr import EUI",
            "from netaddr.core import AddrFormatError",
            "",
            "from nautobot.core import choices as core_choices, forms",
            "from nautobot.core.forms import widgets",
            "from nautobot.core.models import validators",
            "from nautobot.core.utils import data as data_utils, lookup",
            "",
            "__all__ = (",
            "    \"CommentField\",",
            "    \"CSVChoiceField\",",
            "    \"CSVContentTypeField\",",
            "    \"CSVDataField\",",
            "    \"CSVFileField\",",
            "    \"CSVModelChoiceField\",",
            "    \"CSVMultipleChoiceField\",",
            "    \"CSVMultipleContentTypeField\",",
            "    \"DynamicModelChoiceField\",",
            "    \"DynamicModelMultipleChoiceField\",",
            "    \"ExpandableIPAddressField\",",
            "    \"ExpandableNameField\",",
            "    \"JSONField\",",
            "    \"JSONArrayFormField\",",
            "    \"LaxURLField\",",
            "    \"MACAddressField\",",
            "    \"MultipleContentTypeField\",",
            "    \"MultiMatchModelMultipleChoiceField\",",
            "    \"NumericArrayField\",",
            "    \"SlugField\",",
            "    \"TagFilterField\",",
            ")",
            "",
            "",
            "class CSVDataField(django_forms.CharField):",
            "    \"\"\"",
            "    A CharField (rendered as a Textarea) which expects CSV-formatted data.",
            "",
            "    Initial value is a list of headers corresponding to the required fields for the given serializer class.",
            "",
            "    This no longer actually does any CSV parsing or validation on its own,",
            "    as that is now handled by the NautobotCSVParser class and the REST API serializers.",
            "",
            "    Args:",
            "        required_field_names (list[str]): List of field names representing required fields for this import.",
            "    \"\"\"",
            "",
            "    widget = django_forms.Textarea",
            "",
            "    def __init__(self, *args, required_field_names=\"\", **kwargs):",
            "        self.required_field_names = required_field_names",
            "        kwargs.setdefault(\"required\", False)",
            "",
            "        super().__init__(*args, **kwargs)",
            "",
            "        self.strip = False",
            "        if not self.label:",
            "            self.label = \"\"",
            "        if not self.initial:",
            "            self.initial = \",\".join(self.required_field_names) + \"\\n\"",
            "        if not self.help_text:",
            "            self.help_text = (",
            "                \"Enter the list of column headers followed by one line per record to be imported, using \"",
            "                \"commas to separate values. Multi-line data and values containing commas may be wrapped \"",
            "                \"in double quotes.\"",
            "            )",
            "",
            "",
            "class CSVFileField(django_forms.FileField):",
            "    \"\"\"",
            "    A FileField (rendered as a ClearableFileInput) which expects a file containing CSV-formatted data.",
            "",
            "    This no longer actually does any CSV parsing or validation on its own,",
            "    as that is now handled by the NautobotCSVParser class and the REST API serializers.",
            "    \"\"\"",
            "",
            "    def __init__(self, *args, **kwargs):",
            "        kwargs.setdefault(\"required\", False)",
            "",
            "        super().__init__(*args, **kwargs)",
            "",
            "        if not self.label:",
            "            self.label = \"CSV File\"",
            "        if not self.help_text:",
            "            self.help_text = (",
            "                \"Select a CSV file to upload. It should contain column headers in the first row and use commas \"",
            "                \"to separate values. Multi-line data and values containing commas may be wrapped \"",
            "                \"in double quotes.\"",
            "            )",
            "",
            "    def to_python(self, file):",
            "        \"\"\"For parity with CSVDataField, this returns the CSV text rather than an UploadedFile object.\"\"\"",
            "        if file is None:",
            "            return None",
            "",
            "        file = super().to_python(file)",
            "        return file.read().decode(\"utf-8-sig\").strip()",
            "",
            "",
            "class CSVChoiceField(django_forms.ChoiceField):",
            "    \"\"\"",
            "    Invert the provided set of choices to take the human-friendly label as input, and return the database value.",
            "",
            "    Despite the name, this is no longer used in CSV imports since 2.0, but *is* used in JSON/YAML import of DeviceTypes.",
            "    \"\"\"",
            "",
            "    STATIC_CHOICES = True",
            "",
            "    def __init__(self, *, choices=(), **kwargs):",
            "        super().__init__(choices=choices, **kwargs)",
            "        self.choices = core_choices.unpack_grouped_choices(choices)",
            "",
            "",
            "class CSVMultipleChoiceField(CSVChoiceField):",
            "    \"\"\"",
            "    A version of CSVChoiceField that supports and emits a list of choice values.",
            "",
            "    As with CSVChoiceField, the name is misleading, as this is no longer used for CSV imports, but is used for",
            "    JSON/YAML import of DeviceTypes still.",
            "    \"\"\"",
            "",
            "    def to_python(self, value):",
            "        \"\"\"Return a list of strings.\"\"\"",
            "        if value in self.empty_values:",
            "            return \"\"",
            "        return [v.strip() for v in str(value).split(\",\")]",
            "",
            "    def validate(self, value):",
            "        \"\"\"Validate that each of the input values is in self.choices.\"\"\"",
            "        for v in value:",
            "            super().validate(v)",
            "",
            "",
            "class CSVModelChoiceField(django_forms.ModelChoiceField):",
            "    \"\"\"",
            "    Provides additional validation for model choices entered as CSV data.",
            "",
            "    Note: class name is misleading; the subclass CSVContentTypeField (below) is also used in FilterSets, where it has",
            "    nothing to do with CSV data.",
            "    \"\"\"",
            "",
            "    default_error_messages = {",
            "        \"invalid_choice\": \"Object not found.\",",
            "    }",
            "",
            "    def to_python(self, value):",
            "        try:",
            "            return super().to_python(value)",
            "        except MultipleObjectsReturned:",
            "            raise ValidationError(f'\"{value}\" is not a unique value for this field; multiple objects were found')",
            "",
            "",
            "class CSVContentTypeField(CSVModelChoiceField):",
            "    \"\"\"",
            "    Reference a ContentType in the form `{app_label}.{model}`.",
            "",
            "    Note: class name is misleading; this field is also used in numerous FilterSets where it has nothing to do with CSV.",
            "    \"\"\"",
            "",
            "    STATIC_CHOICES = True",
            "",
            "    def prepare_value(self, value):",
            "        \"\"\"",
            "        Allow this field to support `{app_label}.{model}` style, null values, or PK-based lookups",
            "        depending on how the field is used.",
            "        \"\"\"",
            "        if value is None:",
            "            return \"\"",
            "",
            "        # Only pass through strings if they aren't numeric. Otherwise cast to `int`.",
            "        if isinstance(value, str):",
            "            if not value.isdigit():",
            "                return value",
            "            else:",
            "                value = int(value)",
            "",
            "        # Integers are PKs",
            "        if isinstance(value, int):",
            "            value = self.queryset.get(pk=value)",
            "",
            "        return f\"{value.app_label}.{value.model}\"",
            "",
            "    def to_python(self, value):",
            "        value = self.prepare_value(value)",
            "        try:",
            "            app_label, model = value.split(\".\")",
            "        except ValueError:",
            "            raise ValidationError('Object type must be specified as \"<app_label>.<model>\"')",
            "        try:",
            "            return self.queryset.get(app_label=app_label, model=model)",
            "        except ObjectDoesNotExist:",
            "            raise ValidationError(\"Invalid object type\")",
            "",
            "",
            "class MultipleContentTypeField(django_forms.ModelMultipleChoiceField):",
            "    \"\"\"",
            "    Field for choosing any number of `ContentType` objects.",
            "",
            "    Optionally can restrict the available ContentTypes to those supporting a particular feature only.",
            "    Optionally can pass the selection through as a list of `{app_label}.{model}` strings instead of PK values.",
            "    \"\"\"",
            "",
            "    STATIC_CHOICES = True",
            "",
            "    def __init__(self, *args, feature=None, choices_as_strings=False, **kwargs):",
            "        \"\"\"",
            "        Construct a MultipleContentTypeField.",
            "",
            "        Args:",
            "            feature (str): Feature name to use in constructing a FeatureQuery to restrict the available ContentTypes.",
            "            choices_as_strings (bool): If True, render selection as a list of `\"{app_label}.{model}\"` strings.",
            "        \"\"\"",
            "        from nautobot.extras import utils as extras_utils",
            "",
            "        if \"queryset\" not in kwargs:",
            "            if feature is not None:",
            "                kwargs[\"queryset\"] = ContentType.objects.filter(",
            "                    extras_utils.FeatureQuery(feature).get_query()",
            "                ).order_by(\"app_label\", \"model\")",
            "            else:",
            "                kwargs[\"queryset\"] = ContentType.objects.order_by(\"app_label\", \"model\")",
            "        if \"widget\" not in kwargs:",
            "            kwargs[\"widget\"] = forms.StaticSelect2Multiple()",
            "",
            "        super().__init__(*args, **kwargs)",
            "",
            "        if choices_as_strings:",
            "            self.choices = self._string_choices_from_queryset",
            "",
            "    def _string_choices_from_queryset(self):",
            "        \"\"\"Overload choices to return `{app_label}.{model}` instead of PKs.\"\"\"",
            "        return [(f\"{m.app_label}.{m.model}\", m.app_labeled_name) for m in self.queryset.all()]",
            "",
            "",
            "class MultiValueCharField(django_forms.CharField):",
            "    \"\"\"",
            "    CharField that takes multiple user character inputs and render them as tags in the form field.",
            "    Press enter to complete an input.",
            "    \"\"\"",
            "",
            "    widget = widgets.MultiValueCharInput()",
            "",
            "    def get_bound_field(self, form, field_name):",
            "        bound_field = BoundField(form, self, field_name)",
            "        value = bound_field.value()",
            "        widget = bound_field.field.widget",
            "        # Save the selected choices in the widget even after the filterform is submitted",
            "        if value is not None:",
            "            widget.choices = [(v, v) for v in value]",
            "",
            "        return bound_field",
            "",
            "    def to_python(self, value):",
            "        self.field_class = django_forms.CharField",
            "        if not value:",
            "            return []",
            "",
            "        # Make it a list if it's a string.",
            "        if isinstance(value, str):",
            "            value = [value]",
            "",
            "        return [",
            "            # Only append non-empty values (this avoids e.g. trying to cast '' as an integer)",
            "            self.field_class.to_python(self, v)",
            "            for v in value",
            "            if v",
            "        ]",
            "",
            "",
            "class CSVMultipleContentTypeField(MultipleContentTypeField):",
            "    \"\"\"",
            "    Reference a list of `ContentType` objects in the form `{app_label}.{model}'.",
            "",
            "    Note: This is unused in Nautobot core at this time, but some apps (data-validation-engine) use this for non-CSV",
            "    purposes, similar to CSVContentTypeField above.",
            "    \"\"\"",
            "",
            "    def prepare_value(self, value):",
            "        \"\"\"Parse a comma-separated string of model names into a list of PKs.\"\"\"",
            "        # \"\".split(\",\") yields [\"\"] rather than [], which we don't want!",
            "        if isinstance(value, str) and value:",
            "            value = value.split(\",\")",
            "",
            "        # For each model name, retrieve the model object and extract its",
            "        # content-type PK.",
            "        pk_list = []",
            "        if isinstance(value, (list, tuple)):",
            "            for v in value:",
            "                try:",
            "                    model = apps.get_model(v)",
            "                except (ValueError, LookupError):",
            "                    raise ValidationError(",
            "                        self.error_messages[\"invalid_choice\"],",
            "                        code=\"invalid_choice\",",
            "                        params={\"value\": v},",
            "                    )",
            "                ct = self.queryset.model.objects.get_for_model(model)",
            "                pk_list.append(ct.pk)",
            "",
            "        return super().prepare_value(pk_list)",
            "",
            "",
            "class ExpandableNameField(django_forms.CharField):",
            "    \"\"\"",
            "    A field which allows for numeric range expansion",
            "      Example: 'Gi0/[1-3]' => ['Gi0/1', 'Gi0/2', 'Gi0/3']",
            "    \"\"\"",
            "",
            "    def __init__(self, *args, **kwargs):",
            "        super().__init__(*args, **kwargs)",
            "        if not self.help_text:",
            "            self.help_text = \"\"\"",
            "                Alphanumeric ranges are supported for bulk creation. Mixed cases and types within a single range",
            "                are not supported. Examples:",
            "                <ul>",
            "                    <li><code>[ge,xe]-0/0/[0-9]</code></li>",
            "                    <li><code>e[0-3][a-d,f]</code></li>",
            "                </ul>",
            "                \"\"\"",
            "",
            "    def to_python(self, value):",
            "        if not value:",
            "            return \"\"",
            "        if re.search(forms.ALPHANUMERIC_EXPANSION_PATTERN, value):",
            "            return list(forms.expand_alphanumeric_pattern(value))",
            "        return [value]",
            "",
            "",
            "class ExpandableIPAddressField(django_forms.CharField):",
            "    \"\"\"",
            "    A field which allows for expansion of IP address ranges",
            "      Example: '192.0.2.[1-254]/24' => ['192.0.2.1/24', '192.0.2.2/24', '192.0.2.3/24' ... '192.0.2.254/24']",
            "    \"\"\"",
            "",
            "    def __init__(self, *args, **kwargs):",
            "        super().__init__(*args, **kwargs)",
            "        if not self.help_text:",
            "            self.help_text = (",
            "                \"Specify a numeric range to create multiple IPs.<br />Example: <code>192.0.2.[1,5,100-254]/24</code>\"",
            "            )",
            "",
            "    def to_python(self, value):",
            "        # Ensure that a subnet mask has been specified. This prevents IPs from defaulting to a /32 or /128.",
            "        if len(value.split(\"/\")) != 2:",
            "            raise ValidationError(\"CIDR mask (e.g. /24) is required.\")",
            "",
            "        # Hackish address version detection but it's all we have to work with",
            "        if \".\" in value and re.search(forms.IP4_EXPANSION_PATTERN, value):",
            "            return list(forms.expand_ipaddress_pattern(value, 4))",
            "        elif \":\" in value and re.search(forms.IP6_EXPANSION_PATTERN, value):",
            "            return list(forms.expand_ipaddress_pattern(value, 6))",
            "",
            "        return [value]",
            "",
            "",
            "class CommentField(django_forms.CharField):",
            "    \"\"\"",
            "    A textarea with support for Markdown rendering. Exists mostly just to add a standard help_text.",
            "    \"\"\"",
            "",
            "    widget = django_forms.Textarea",
            "    default_label = \"\"",
            "    # TODO: Port Markdown cheat sheet to internal documentation",
            "    default_helptext = (",
            "        '<i class=\"mdi mdi-information-outline\"></i> '",
            "        '<a href=\"https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet\" target=\"_blank\">'",
            "        \"Markdown</a> syntax is supported\"",
            "    )",
            "",
            "    def __init__(self, *args, **kwargs):",
            "        required = kwargs.pop(\"required\", False)",
            "        label = kwargs.pop(\"label\", self.default_label)",
            "        help_text = kwargs.pop(\"help_text\", self.default_helptext)",
            "        super().__init__(required=required, label=label, help_text=help_text, *args, **kwargs)",
            "",
            "",
            "class MACAddressField(django_forms.Field):",
            "    widget = django_forms.CharField",
            "    default_error_messages = {",
            "        \"invalid\": \"MAC address must be in EUI-48 format\",",
            "    }",
            "",
            "    def to_python(self, value):",
            "        value = super().to_python(value)",
            "",
            "        # Validate MAC address format",
            "        try:",
            "            value = EUI(value.strip())",
            "        except AddrFormatError:",
            "            raise ValidationError(self.error_messages[\"invalid\"], code=\"invalid\")",
            "",
            "        return value",
            "",
            "",
            "class NullableDateField(django_forms.DateField):",
            "    def to_python(self, value):",
            "        if not value:",
            "            return None",
            "        elif value == \"null\":",
            "            return value",
            "        return super().to_python(value)",
            "",
            "",
            "class SlugField(django_forms.SlugField):",
            "    \"\"\"",
            "    Extend the built-in SlugField to automatically populate from a field called `name` unless otherwise specified.",
            "    \"\"\"",
            "",
            "    def __init__(self, slug_source=\"name\", *args, **kwargs):",
            "        \"\"\"",
            "        Instantiate a SlugField.",
            "",
            "        Args:",
            "            slug_source (str, tuple): Name of the field (or a list of field names) that will be used to suggest a slug.",
            "        \"\"\"",
            "        kwargs.setdefault(\"label\", \"Slug\")",
            "        kwargs.setdefault(\"help_text\", \"URL-friendly unique shorthand\")",
            "        kwargs.setdefault(\"widget\", forms.SlugWidget)",
            "        super().__init__(*args, **kwargs)",
            "        if isinstance(slug_source, (tuple, list)):",
            "            slug_source = \" \".join(slug_source)",
            "        self.widget.attrs[\"slug-source\"] = slug_source",
            "",
            "",
            "class DynamicModelChoiceMixin:",
            "    \"\"\"",
            "    :param display_field: The name of the attribute of an API response object to display in the selection list",
            "    :param query_params: A dictionary of additional key/value pairs to attach to the API request",
            "    :param initial_params: A dictionary of child field references to use for selecting a parent field's initial value",
            "    :param null_option: The string used to represent a null selection (if any)",
            "    :param disabled_indicator: The name of the field which, if populated, will disable selection of the",
            "        choice (optional)",
            "    :param depth: Nested serialization depth when making API requests (default: `0` or a flat representation)",
            "    \"\"\"",
            "",
            "    filter = django_filters.ModelChoiceFilter  # 2.0 TODO(Glenn): can we rename this? pylint: disable=redefined-builtin",
            "    widget = widgets.APISelect",
            "",
            "    def __init__(",
            "        self,",
            "        display_field=\"display\",",
            "        query_params=None,",
            "        initial_params=None,",
            "        null_option=None,",
            "        disabled_indicator=None,",
            "        depth=0,",
            "        *args,",
            "        **kwargs,",
            "    ):",
            "        self.display_field = display_field",
            "        self.query_params = query_params or {}",
            "        self.initial_params = initial_params or {}",
            "        self.null_option = null_option",
            "        self.disabled_indicator = disabled_indicator",
            "        self.depth = depth",
            "",
            "        # to_field_name is set by ModelChoiceField.__init__(), but we need to set it early for reference",
            "        # by widget_attrs()",
            "        self.to_field_name = kwargs.get(\"to_field_name\")",
            "",
            "        super().__init__(*args, **kwargs)",
            "",
            "    def widget_attrs(self, widget):",
            "        attrs = {",
            "            \"display-field\": self.display_field,",
            "        }",
            "",
            "        # Set value-field attribute if the field specifies to_field_name",
            "        if self.to_field_name:",
            "            attrs[\"value-field\"] = self.to_field_name",
            "",
            "        # Set the string used to represent a null option",
            "        if self.null_option is not None:",
            "            attrs[\"data-null-option\"] = self.null_option",
            "",
            "        # Set the disabled indicator, if any",
            "        if self.disabled_indicator is not None:",
            "            attrs[\"disabled-indicator\"] = self.disabled_indicator",
            "",
            "        # Toggle depth",
            "        attrs[\"data-depth\"] = self.depth",
            "",
            "        # Attach any static query parameters",
            "        for key, value in self.query_params.items():",
            "            widget.add_query_param(key, value)",
            "",
            "        return attrs",
            "",
            "    def prepare_value(self, value):",
            "        \"\"\"",
            "        Augment the behavior of forms.ModelChoiceField.prepare_value().",
            "",
            "        Specifically, if `value` is a PK, but we have `to_field_name` set, we need to look up the model instance",
            "        from the given PK, so that the base class will get the appropriate field value rather than just keeping the PK,",
            "        because the rendered form field needs this in order to correctly prepopulate a default selection.",
            "        \"\"\"",
            "        if self.to_field_name and data_utils.is_uuid(value):",
            "            try:",
            "                value = self.queryset.get(pk=value)",
            "            except ObjectDoesNotExist:",
            "                pass",
            "        return super().prepare_value(value)",
            "",
            "    def get_bound_field(self, form, field_name):",
            "        bound_field = BoundField(form, self, field_name)",
            "",
            "        # Set initial value based on prescribed child fields (if not already set)",
            "        if not self.initial and self.initial_params:",
            "            filter_kwargs = {}",
            "            for kwarg, child_field in self.initial_params.items():",
            "                value = form.initial.get(child_field.lstrip(\"$\"))",
            "                if value:",
            "                    filter_kwargs[kwarg] = value",
            "            if filter_kwargs:",
            "                self.initial = self.queryset.filter(**filter_kwargs).first()",
            "",
            "        # Modify the QuerySet of the field before we return it. Limit choices to any data already bound: Options",
            "        # will be populated on-demand via the APISelect widget.",
            "        data = bound_field.value()",
            "        if data:",
            "            field_name = getattr(self, \"to_field_name\") or \"pk\"",
            "            filter_ = self.filter(field_name=field_name)",
            "            try:",
            "                self.queryset = filter_.filter(self.queryset, data)",
            "            except (TypeError, ValidationError):",
            "                # Catch any error caused by invalid initial data passed from the user",
            "                self.queryset = self.queryset.none()",
            "        else:",
            "            self.queryset = self.queryset.none()",
            "",
            "        # Set the data URL on the APISelect widget (if not already set)",
            "        widget = bound_field.field.widget",
            "        if not widget.attrs.get(\"data-url\"):",
            "            route = lookup.get_route_for_model(self.queryset.model, \"list\", api=True)",
            "            data_url = reverse(route)",
            "            widget.attrs[\"data-url\"] = data_url",
            "",
            "        return bound_field",
            "",
            "",
            "class DynamicModelChoiceField(DynamicModelChoiceMixin, django_forms.ModelChoiceField):",
            "    \"\"\"",
            "    Override get_bound_field() to avoid pre-populating field choices with a SQL query. The field will be",
            "    rendered only with choices set via bound data. Choices are populated on-demand via the APISelect widget.",
            "    \"\"\"",
            "",
            "    def clean(self, value):",
            "        \"\"\"",
            "        When null option is enabled and \"None\" is sent as part of a form to be submitted, it is sent as the",
            "        string 'null'.  This will check for that condition and gracefully handle the conversion to a NoneType.",
            "        \"\"\"",
            "        if self.null_option is not None and value == settings.FILTERS_NULL_CHOICE_VALUE:",
            "            return None",
            "        return super().clean(value)",
            "",
            "",
            "class DynamicModelMultipleChoiceField(DynamicModelChoiceMixin, django_forms.ModelMultipleChoiceField):",
            "    \"\"\"",
            "    A multiple-choice version of DynamicModelChoiceField.",
            "    \"\"\"",
            "",
            "    filter = django_filters.ModelMultipleChoiceFilter",
            "    widget = widgets.APISelectMultiple",
            "",
            "",
            "class LaxURLField(django_forms.URLField):",
            "    \"\"\"",
            "    Modifies Django's built-in URLField to remove the requirement for fully-qualified domain names",
            "    (e.g. http://myserver/ is valid)",
            "    \"\"\"",
            "",
            "    default_validators = [validators.EnhancedURLValidator()]",
            "",
            "",
            "class JSONField(_JSONField):",
            "    \"\"\"",
            "    Custom wrapper around Django's built-in JSONField to avoid presenting \"null\" as the default text.",
            "    \"\"\"",
            "",
            "    def __init__(self, *args, **kwargs):",
            "        super().__init__(*args, **kwargs)",
            "        if not self.help_text:",
            "            self.help_text = 'Enter context data in <a href=\"https://json.org/\">JSON</a> format.'",
            "            self.widget.attrs[\"placeholder\"] = \"\"",
            "",
            "    def prepare_value(self, value):",
            "        if isinstance(value, InvalidJSONInput):",
            "            return value",
            "        if value is None:",
            "            return \"\"",
            "        return json.dumps(value, sort_keys=True, indent=4, ensure_ascii=False)",
            "",
            "    # TODO: remove this when we upgrade to Django 4",
            "    def bound_data(self, data, initial):",
            "        if data is None:",
            "            return None",
            "        return super().bound_data(data, initial)",
            "",
            "",
            "class JSONArrayFormField(django_forms.JSONField):",
            "    \"\"\"",
            "    A FormField counterpart to JSONArrayField.",
            "    Replicates ArrayFormField's base field validation: Field values are validated as JSON Arrays,",
            "    and each Array element is validated by `base_field` validators.",
            "    \"\"\"",
            "",
            "    def __init__(self, base_field, *, delimiter=\",\", **kwargs):",
            "        self.base_field = base_field",
            "        self.delimiter = delimiter",
            "        super().__init__(**kwargs)",
            "",
            "    def clean(self, value):",
            "        \"\"\"",
            "        Validate `value` and return its \"cleaned\" value as an appropriate",
            "        Python object. Raise ValidationError for any errors.",
            "        \"\"\"",
            "        value = super().clean(value)",
            "        return [self.base_field.clean(val) for val in value]",
            "",
            "    def prepare_value(self, value):",
            "        \"\"\"",
            "        Return a string of this value.",
            "        \"\"\"",
            "        if isinstance(value, list):",
            "            return self.delimiter.join(str(self.base_field.prepare_value(v)) for v in value)",
            "        return value",
            "",
            "    def to_python(self, value):",
            "        \"\"\"",
            "        Convert `value` into JSON, raising django.core.exceptions.ValidationError",
            "        if the data can't be converted. Return the converted value.",
            "        \"\"\"",
            "        if isinstance(value, list):",
            "            items = value",
            "        elif value:",
            "            try:",
            "                items = value.split(self.delimiter)",
            "            except Exception as e:",
            "                raise ValidationError(e)",
            "        else:",
            "            items = []",
            "",
            "        errors = []",
            "        values = []",
            "        for item in items:",
            "            try:",
            "                values.append(self.base_field.to_python(item))",
            "            except ValidationError as error:",
            "                errors.append(error)",
            "        if errors:",
            "            raise ValidationError(errors)",
            "        return values",
            "",
            "    def validate(self, value):",
            "        \"\"\"",
            "        Validate `value` and raise ValidationError if necessary.",
            "        \"\"\"",
            "        super().validate(value)",
            "        errors = []",
            "        for item in value:",
            "            try:",
            "                self.base_field.validate(item)",
            "            except ValidationError as error:",
            "                errors.append(error)",
            "        if errors:",
            "            raise ValidationError(errors)",
            "",
            "    def run_validators(self, value):",
            "        \"\"\"",
            "        Runs all validators against `value` and raise ValidationError if necessary.",
            "        Some validators can't be created at field initialization time.",
            "        \"\"\"",
            "        super().run_validators(value)",
            "        errors = []",
            "        for item in value:",
            "            try:",
            "                self.base_field.run_validators(item)",
            "            except ValidationError as error:",
            "                errors.append(error)",
            "        if errors:",
            "            raise ValidationError(errors)",
            "",
            "    def has_changed(self, initial, data):",
            "        \"\"\"",
            "        Return True if `data` differs from `initial`.",
            "        \"\"\"",
            "        value = self.to_python(data)",
            "        if initial in self.empty_values and value in self.empty_values:",
            "            return False",
            "        return super().has_changed(initial, data)",
            "",
            "",
            "class NumericArrayField(SimpleArrayField):",
            "    \"\"\"Basic array field that takes comma-separated or hyphenated ranges.\"\"\"",
            "",
            "    def to_python(self, value):",
            "        try:",
            "            value = \",\".join([str(n) for n in forms.parse_numeric_range(value)])",
            "        except ValueError as error:",
            "            raise ValidationError(error)",
            "        return super().to_python(value)",
            "",
            "",
            "class MultiMatchModelMultipleChoiceField(DynamicModelChoiceMixin, django_filters.fields.ModelMultipleChoiceField):",
            "    \"\"\"",
            "    Filter field to support matching on the PK *or* `to_field_name` fields (defaulting to `slug` if not specified).",
            "",
            "    Raises ValidationError if none of the fields match the requested value.",
            "    \"\"\"",
            "",
            "    filter = django_filters.ModelMultipleChoiceFilter",
            "    widget = widgets.APISelectMultiple",
            "",
            "    def __init__(self, *args, **kwargs):",
            "        self.natural_key = kwargs.setdefault(\"to_field_name\", \"slug\")",
            "        super().__init__(*args, **kwargs)",
            "",
            "    def _check_values(self, values):",
            "        \"\"\"",
            "        This method overloads the grandparent method in `django.forms.models.ModelMultipleChoiceField`,",
            "        re-using some of that method's existing logic and adding support for coupling this field with",
            "        multiple model fields.",
            "        \"\"\"",
            "        null = self.null_label is not None and values and self.null_value in values",
            "        if null:",
            "            values = [v for v in values if v != self.null_value]",
            "        # deduplicate given values to avoid creating many querysets or",
            "        # requiring the database backend deduplicate efficiently.",
            "        try:",
            "            values = frozenset(values)",
            "        except TypeError:",
            "            # list of lists isn't hashable, for example",
            "            raise ValidationError(",
            "                self.error_messages[\"invalid_list\"],",
            "                code=\"invalid_list\",",
            "            )",
            "        pk_values = set()",
            "        natural_key_values = set()",
            "        for item in values:",
            "            query = Q()",
            "            if data_utils.is_uuid(item):",
            "                pk_values.add(item)",
            "                query |= Q(pk=item)",
            "            else:",
            "                natural_key_values.add(item)",
            "                query |= Q(**{self.natural_key: item})",
            "            qs = self.queryset.filter(query)",
            "            if not qs.exists():",
            "                raise ValidationError(",
            "                    self.error_messages[\"invalid_choice\"],",
            "                    code=\"invalid_choice\",",
            "                    params={\"value\": item},",
            "                )",
            "        query = Q(pk__in=pk_values) | Q(**{f\"{self.natural_key}__in\": natural_key_values})",
            "        qs = self.queryset.filter(query)",
            "        result = list(qs)",
            "        if null:",
            "            result += [self.null_value]",
            "        return result",
            "",
            "",
            "class TagFilterField(DynamicModelMultipleChoiceField):",
            "    \"\"\"",
            "    A filter field for the tags of a model. Only the tags used by a model are displayed.",
            "",
            "    :param model: The model of the filter",
            "    \"\"\"",
            "",
            "    def __init__(self, model, *args, query_params=None, queryset=None, **kwargs):",
            "        from nautobot.extras.models import Tag",
            "",
            "        if queryset is None:",
            "            queryset = Tag.objects.get_for_model(model)",
            "        query_params = query_params or {}",
            "        query_params.update({\"content_types\": model._meta.label_lower})",
            "        super().__init__(",
            "            label=\"Tags\",",
            "            query_params=query_params,",
            "            queryset=queryset,",
            "            required=False,",
            "            to_field_name=\"name\",",
            "            *args,",
            "            **kwargs,",
            "        )"
        ],
        "afterPatchFile": [
            "import json",
            "import re",
            "",
            "from django import forms as django_forms",
            "from django.apps import apps",
            "from django.conf import settings",
            "from django.contrib.contenttypes.models import ContentType",
            "from django.contrib.postgres.forms import SimpleArrayField",
            "from django.core.exceptions import MultipleObjectsReturned, ObjectDoesNotExist, ValidationError",
            "from django.db.models import Q",
            "from django.forms.fields import BoundField, InvalidJSONInput, JSONField as _JSONField",
            "from django.templatetags.static import static",
            "from django.urls import reverse",
            "from django.utils.html import format_html",
            "import django_filters",
            "from netaddr import EUI",
            "from netaddr.core import AddrFormatError",
            "",
            "from nautobot.core import choices as core_choices, forms",
            "from nautobot.core.forms import widgets",
            "from nautobot.core.models import validators",
            "from nautobot.core.utils import data as data_utils, lookup",
            "",
            "__all__ = (",
            "    \"CommentField\",",
            "    \"CSVChoiceField\",",
            "    \"CSVContentTypeField\",",
            "    \"CSVDataField\",",
            "    \"CSVFileField\",",
            "    \"CSVModelChoiceField\",",
            "    \"CSVMultipleChoiceField\",",
            "    \"CSVMultipleContentTypeField\",",
            "    \"DynamicModelChoiceField\",",
            "    \"DynamicModelMultipleChoiceField\",",
            "    \"ExpandableIPAddressField\",",
            "    \"ExpandableNameField\",",
            "    \"JSONField\",",
            "    \"JSONArrayFormField\",",
            "    \"LaxURLField\",",
            "    \"MACAddressField\",",
            "    \"MultipleContentTypeField\",",
            "    \"MultiMatchModelMultipleChoiceField\",",
            "    \"NumericArrayField\",",
            "    \"SlugField\",",
            "    \"TagFilterField\",",
            ")",
            "",
            "",
            "class CSVDataField(django_forms.CharField):",
            "    \"\"\"",
            "    A CharField (rendered as a Textarea) which expects CSV-formatted data.",
            "",
            "    Initial value is a list of headers corresponding to the required fields for the given serializer class.",
            "",
            "    This no longer actually does any CSV parsing or validation on its own,",
            "    as that is now handled by the NautobotCSVParser class and the REST API serializers.",
            "",
            "    Args:",
            "        required_field_names (list[str]): List of field names representing required fields for this import.",
            "    \"\"\"",
            "",
            "    widget = django_forms.Textarea",
            "",
            "    def __init__(self, *args, required_field_names=\"\", **kwargs):",
            "        self.required_field_names = required_field_names",
            "        kwargs.setdefault(\"required\", False)",
            "",
            "        super().__init__(*args, **kwargs)",
            "",
            "        self.strip = False",
            "        if not self.label:",
            "            self.label = \"\"",
            "        if not self.initial:",
            "            self.initial = \",\".join(self.required_field_names) + \"\\n\"",
            "        if not self.help_text:",
            "            self.help_text = (",
            "                \"Enter the list of column headers followed by one line per record to be imported, using \"",
            "                \"commas to separate values. Multi-line data and values containing commas may be wrapped \"",
            "                \"in double quotes.\"",
            "            )",
            "",
            "",
            "class CSVFileField(django_forms.FileField):",
            "    \"\"\"",
            "    A FileField (rendered as a ClearableFileInput) which expects a file containing CSV-formatted data.",
            "",
            "    This no longer actually does any CSV parsing or validation on its own,",
            "    as that is now handled by the NautobotCSVParser class and the REST API serializers.",
            "    \"\"\"",
            "",
            "    def __init__(self, *args, **kwargs):",
            "        kwargs.setdefault(\"required\", False)",
            "",
            "        super().__init__(*args, **kwargs)",
            "",
            "        if not self.label:",
            "            self.label = \"CSV File\"",
            "        if not self.help_text:",
            "            self.help_text = (",
            "                \"Select a CSV file to upload. It should contain column headers in the first row and use commas \"",
            "                \"to separate values. Multi-line data and values containing commas may be wrapped \"",
            "                \"in double quotes.\"",
            "            )",
            "",
            "    def to_python(self, file):",
            "        \"\"\"For parity with CSVDataField, this returns the CSV text rather than an UploadedFile object.\"\"\"",
            "        if file is None:",
            "            return None",
            "",
            "        file = super().to_python(file)",
            "        return file.read().decode(\"utf-8-sig\").strip()",
            "",
            "",
            "class CSVChoiceField(django_forms.ChoiceField):",
            "    \"\"\"",
            "    Invert the provided set of choices to take the human-friendly label as input, and return the database value.",
            "",
            "    Despite the name, this is no longer used in CSV imports since 2.0, but *is* used in JSON/YAML import of DeviceTypes.",
            "    \"\"\"",
            "",
            "    STATIC_CHOICES = True",
            "",
            "    def __init__(self, *, choices=(), **kwargs):",
            "        super().__init__(choices=choices, **kwargs)",
            "        self.choices = core_choices.unpack_grouped_choices(choices)",
            "",
            "",
            "class CSVMultipleChoiceField(CSVChoiceField):",
            "    \"\"\"",
            "    A version of CSVChoiceField that supports and emits a list of choice values.",
            "",
            "    As with CSVChoiceField, the name is misleading, as this is no longer used for CSV imports, but is used for",
            "    JSON/YAML import of DeviceTypes still.",
            "    \"\"\"",
            "",
            "    def to_python(self, value):",
            "        \"\"\"Return a list of strings.\"\"\"",
            "        if value in self.empty_values:",
            "            return \"\"",
            "        return [v.strip() for v in str(value).split(\",\")]",
            "",
            "    def validate(self, value):",
            "        \"\"\"Validate that each of the input values is in self.choices.\"\"\"",
            "        for v in value:",
            "            super().validate(v)",
            "",
            "",
            "class CSVModelChoiceField(django_forms.ModelChoiceField):",
            "    \"\"\"",
            "    Provides additional validation for model choices entered as CSV data.",
            "",
            "    Note: class name is misleading; the subclass CSVContentTypeField (below) is also used in FilterSets, where it has",
            "    nothing to do with CSV data.",
            "    \"\"\"",
            "",
            "    default_error_messages = {",
            "        \"invalid_choice\": \"Object not found.\",",
            "    }",
            "",
            "    def to_python(self, value):",
            "        try:",
            "            return super().to_python(value)",
            "        except MultipleObjectsReturned:",
            "            raise ValidationError(f'\"{value}\" is not a unique value for this field; multiple objects were found')",
            "",
            "",
            "class CSVContentTypeField(CSVModelChoiceField):",
            "    \"\"\"",
            "    Reference a ContentType in the form `{app_label}.{model}`.",
            "",
            "    Note: class name is misleading; this field is also used in numerous FilterSets where it has nothing to do with CSV.",
            "    \"\"\"",
            "",
            "    STATIC_CHOICES = True",
            "",
            "    def prepare_value(self, value):",
            "        \"\"\"",
            "        Allow this field to support `{app_label}.{model}` style, null values, or PK-based lookups",
            "        depending on how the field is used.",
            "        \"\"\"",
            "        if value is None:",
            "            return \"\"",
            "",
            "        # Only pass through strings if they aren't numeric. Otherwise cast to `int`.",
            "        if isinstance(value, str):",
            "            if not value.isdigit():",
            "                return value",
            "            else:",
            "                value = int(value)",
            "",
            "        # Integers are PKs",
            "        if isinstance(value, int):",
            "            value = self.queryset.get(pk=value)",
            "",
            "        return f\"{value.app_label}.{value.model}\"",
            "",
            "    def to_python(self, value):",
            "        value = self.prepare_value(value)",
            "        try:",
            "            app_label, model = value.split(\".\")",
            "        except ValueError:",
            "            raise ValidationError('Object type must be specified as \"<app_label>.<model>\"')",
            "        try:",
            "            return self.queryset.get(app_label=app_label, model=model)",
            "        except ObjectDoesNotExist:",
            "            raise ValidationError(\"Invalid object type\")",
            "",
            "",
            "class MultipleContentTypeField(django_forms.ModelMultipleChoiceField):",
            "    \"\"\"",
            "    Field for choosing any number of `ContentType` objects.",
            "",
            "    Optionally can restrict the available ContentTypes to those supporting a particular feature only.",
            "    Optionally can pass the selection through as a list of `{app_label}.{model}` strings instead of PK values.",
            "    \"\"\"",
            "",
            "    STATIC_CHOICES = True",
            "",
            "    def __init__(self, *args, feature=None, choices_as_strings=False, **kwargs):",
            "        \"\"\"",
            "        Construct a MultipleContentTypeField.",
            "",
            "        Args:",
            "            feature (str): Feature name to use in constructing a FeatureQuery to restrict the available ContentTypes.",
            "            choices_as_strings (bool): If True, render selection as a list of `\"{app_label}.{model}\"` strings.",
            "        \"\"\"",
            "        from nautobot.extras import utils as extras_utils",
            "",
            "        if \"queryset\" not in kwargs:",
            "            if feature is not None:",
            "                kwargs[\"queryset\"] = ContentType.objects.filter(",
            "                    extras_utils.FeatureQuery(feature).get_query()",
            "                ).order_by(\"app_label\", \"model\")",
            "            else:",
            "                kwargs[\"queryset\"] = ContentType.objects.order_by(\"app_label\", \"model\")",
            "        if \"widget\" not in kwargs:",
            "            kwargs[\"widget\"] = forms.StaticSelect2Multiple()",
            "",
            "        super().__init__(*args, **kwargs)",
            "",
            "        if choices_as_strings:",
            "            self.choices = self._string_choices_from_queryset",
            "",
            "    def _string_choices_from_queryset(self):",
            "        \"\"\"Overload choices to return `{app_label}.{model}` instead of PKs.\"\"\"",
            "        return [(f\"{m.app_label}.{m.model}\", m.app_labeled_name) for m in self.queryset.all()]",
            "",
            "",
            "class MultiValueCharField(django_forms.CharField):",
            "    \"\"\"",
            "    CharField that takes multiple user character inputs and render them as tags in the form field.",
            "    Press enter to complete an input.",
            "    \"\"\"",
            "",
            "    widget = widgets.MultiValueCharInput()",
            "",
            "    def get_bound_field(self, form, field_name):",
            "        bound_field = BoundField(form, self, field_name)",
            "        value = bound_field.value()",
            "        widget = bound_field.field.widget",
            "        # Save the selected choices in the widget even after the filterform is submitted",
            "        if value is not None:",
            "            widget.choices = [(v, v) for v in value]",
            "",
            "        return bound_field",
            "",
            "    def to_python(self, value):",
            "        self.field_class = django_forms.CharField",
            "        if not value:",
            "            return []",
            "",
            "        # Make it a list if it's a string.",
            "        if isinstance(value, str):",
            "            value = [value]",
            "",
            "        return [",
            "            # Only append non-empty values (this avoids e.g. trying to cast '' as an integer)",
            "            self.field_class.to_python(self, v)",
            "            for v in value",
            "            if v",
            "        ]",
            "",
            "",
            "class CSVMultipleContentTypeField(MultipleContentTypeField):",
            "    \"\"\"",
            "    Reference a list of `ContentType` objects in the form `{app_label}.{model}'.",
            "",
            "    Note: This is unused in Nautobot core at this time, but some apps (data-validation-engine) use this for non-CSV",
            "    purposes, similar to CSVContentTypeField above.",
            "    \"\"\"",
            "",
            "    def prepare_value(self, value):",
            "        \"\"\"Parse a comma-separated string of model names into a list of PKs.\"\"\"",
            "        # \"\".split(\",\") yields [\"\"] rather than [], which we don't want!",
            "        if isinstance(value, str) and value:",
            "            value = value.split(\",\")",
            "",
            "        # For each model name, retrieve the model object and extract its",
            "        # content-type PK.",
            "        pk_list = []",
            "        if isinstance(value, (list, tuple)):",
            "            for v in value:",
            "                try:",
            "                    model = apps.get_model(v)",
            "                except (ValueError, LookupError):",
            "                    raise ValidationError(",
            "                        self.error_messages[\"invalid_choice\"],",
            "                        code=\"invalid_choice\",",
            "                        params={\"value\": v},",
            "                    )",
            "                ct = self.queryset.model.objects.get_for_model(model)",
            "                pk_list.append(ct.pk)",
            "",
            "        return super().prepare_value(pk_list)",
            "",
            "",
            "class ExpandableNameField(django_forms.CharField):",
            "    \"\"\"",
            "    A field which allows for numeric range expansion",
            "      Example: 'Gi0/[1-3]' => ['Gi0/1', 'Gi0/2', 'Gi0/3']",
            "    \"\"\"",
            "",
            "    def __init__(self, *args, **kwargs):",
            "        super().__init__(*args, **kwargs)",
            "        if not self.help_text:",
            "            self.help_text = \"\"\"",
            "                Alphanumeric ranges are supported for bulk creation. Mixed cases and types within a single range",
            "                are not supported. Examples:",
            "                <ul>",
            "                    <li><code>[ge,xe]-0/0/[0-9]</code></li>",
            "                    <li><code>e[0-3][a-d,f]</code></li>",
            "                </ul>",
            "                \"\"\"",
            "",
            "    def to_python(self, value):",
            "        if not value:",
            "            return \"\"",
            "        if re.search(forms.ALPHANUMERIC_EXPANSION_PATTERN, value):",
            "            return list(forms.expand_alphanumeric_pattern(value))",
            "        return [value]",
            "",
            "",
            "class ExpandableIPAddressField(django_forms.CharField):",
            "    \"\"\"",
            "    A field which allows for expansion of IP address ranges",
            "      Example: '192.0.2.[1-254]/24' => ['192.0.2.1/24', '192.0.2.2/24', '192.0.2.3/24' ... '192.0.2.254/24']",
            "    \"\"\"",
            "",
            "    def __init__(self, *args, **kwargs):",
            "        super().__init__(*args, **kwargs)",
            "        if not self.help_text:",
            "            self.help_text = (",
            "                \"Specify a numeric range to create multiple IPs.<br />Example: <code>192.0.2.[1,5,100-254]/24</code>\"",
            "            )",
            "",
            "    def to_python(self, value):",
            "        # Ensure that a subnet mask has been specified. This prevents IPs from defaulting to a /32 or /128.",
            "        if len(value.split(\"/\")) != 2:",
            "            raise ValidationError(\"CIDR mask (e.g. /24) is required.\")",
            "",
            "        # Hackish address version detection but it's all we have to work with",
            "        if \".\" in value and re.search(forms.IP4_EXPANSION_PATTERN, value):",
            "            return list(forms.expand_ipaddress_pattern(value, 4))",
            "        elif \":\" in value and re.search(forms.IP6_EXPANSION_PATTERN, value):",
            "            return list(forms.expand_ipaddress_pattern(value, 6))",
            "",
            "        return [value]",
            "",
            "",
            "class CommentField(django_forms.CharField):",
            "    \"\"\"",
            "    A textarea with support for Markdown rendering. Exists mostly just to add a standard help_text.",
            "    \"\"\"",
            "",
            "    widget = django_forms.Textarea",
            "    default_label = \"\"",
            "",
            "    @property",
            "    def default_helptext(self):",
            "        # TODO: Port Markdown cheat sheet to internal documentation",
            "        return format_html(",
            "            '<i class=\"mdi mdi-information-outline\"></i> '",
            "            '<a href=\"https://www.markdownguide.org/cheat-sheet/#basic-syntax\" rel=\"noopener noreferrer\">Markdown</a> '",
            "            'syntax is supported, as well as <a href=\"{}#render_markdown\">a limited subset of HTML</a>.',",
            "            static(\"docs/user-guide/platform-functionality/template-filters.html\"),",
            "        )",
            "",
            "    def __init__(self, *args, **kwargs):",
            "        required = kwargs.pop(\"required\", False)",
            "        label = kwargs.pop(\"label\", self.default_label)",
            "        help_text = kwargs.pop(\"help_text\", self.default_helptext)",
            "        super().__init__(required=required, label=label, help_text=help_text, *args, **kwargs)",
            "",
            "",
            "class MACAddressField(django_forms.Field):",
            "    widget = django_forms.CharField",
            "    default_error_messages = {",
            "        \"invalid\": \"MAC address must be in EUI-48 format\",",
            "    }",
            "",
            "    def to_python(self, value):",
            "        value = super().to_python(value)",
            "",
            "        # Validate MAC address format",
            "        try:",
            "            value = EUI(value.strip())",
            "        except AddrFormatError:",
            "            raise ValidationError(self.error_messages[\"invalid\"], code=\"invalid\")",
            "",
            "        return value",
            "",
            "",
            "class NullableDateField(django_forms.DateField):",
            "    def to_python(self, value):",
            "        if not value:",
            "            return None",
            "        elif value == \"null\":",
            "            return value",
            "        return super().to_python(value)",
            "",
            "",
            "class SlugField(django_forms.SlugField):",
            "    \"\"\"",
            "    Extend the built-in SlugField to automatically populate from a field called `name` unless otherwise specified.",
            "    \"\"\"",
            "",
            "    def __init__(self, slug_source=\"name\", *args, **kwargs):",
            "        \"\"\"",
            "        Instantiate a SlugField.",
            "",
            "        Args:",
            "            slug_source (str, tuple): Name of the field (or a list of field names) that will be used to suggest a slug.",
            "        \"\"\"",
            "        kwargs.setdefault(\"label\", \"Slug\")",
            "        kwargs.setdefault(\"help_text\", \"URL-friendly unique shorthand\")",
            "        kwargs.setdefault(\"widget\", forms.SlugWidget)",
            "        super().__init__(*args, **kwargs)",
            "        if isinstance(slug_source, (tuple, list)):",
            "            slug_source = \" \".join(slug_source)",
            "        self.widget.attrs[\"slug-source\"] = slug_source",
            "",
            "",
            "class DynamicModelChoiceMixin:",
            "    \"\"\"",
            "    :param display_field: The name of the attribute of an API response object to display in the selection list",
            "    :param query_params: A dictionary of additional key/value pairs to attach to the API request",
            "    :param initial_params: A dictionary of child field references to use for selecting a parent field's initial value",
            "    :param null_option: The string used to represent a null selection (if any)",
            "    :param disabled_indicator: The name of the field which, if populated, will disable selection of the",
            "        choice (optional)",
            "    :param depth: Nested serialization depth when making API requests (default: `0` or a flat representation)",
            "    \"\"\"",
            "",
            "    filter = django_filters.ModelChoiceFilter  # 2.0 TODO(Glenn): can we rename this? pylint: disable=redefined-builtin",
            "    widget = widgets.APISelect",
            "",
            "    def __init__(",
            "        self,",
            "        display_field=\"display\",",
            "        query_params=None,",
            "        initial_params=None,",
            "        null_option=None,",
            "        disabled_indicator=None,",
            "        depth=0,",
            "        *args,",
            "        **kwargs,",
            "    ):",
            "        self.display_field = display_field",
            "        self.query_params = query_params or {}",
            "        self.initial_params = initial_params or {}",
            "        self.null_option = null_option",
            "        self.disabled_indicator = disabled_indicator",
            "        self.depth = depth",
            "",
            "        # to_field_name is set by ModelChoiceField.__init__(), but we need to set it early for reference",
            "        # by widget_attrs()",
            "        self.to_field_name = kwargs.get(\"to_field_name\")",
            "",
            "        super().__init__(*args, **kwargs)",
            "",
            "    def widget_attrs(self, widget):",
            "        attrs = {",
            "            \"display-field\": self.display_field,",
            "        }",
            "",
            "        # Set value-field attribute if the field specifies to_field_name",
            "        if self.to_field_name:",
            "            attrs[\"value-field\"] = self.to_field_name",
            "",
            "        # Set the string used to represent a null option",
            "        if self.null_option is not None:",
            "            attrs[\"data-null-option\"] = self.null_option",
            "",
            "        # Set the disabled indicator, if any",
            "        if self.disabled_indicator is not None:",
            "            attrs[\"disabled-indicator\"] = self.disabled_indicator",
            "",
            "        # Toggle depth",
            "        attrs[\"data-depth\"] = self.depth",
            "",
            "        # Attach any static query parameters",
            "        for key, value in self.query_params.items():",
            "            widget.add_query_param(key, value)",
            "",
            "        return attrs",
            "",
            "    def prepare_value(self, value):",
            "        \"\"\"",
            "        Augment the behavior of forms.ModelChoiceField.prepare_value().",
            "",
            "        Specifically, if `value` is a PK, but we have `to_field_name` set, we need to look up the model instance",
            "        from the given PK, so that the base class will get the appropriate field value rather than just keeping the PK,",
            "        because the rendered form field needs this in order to correctly prepopulate a default selection.",
            "        \"\"\"",
            "        if self.to_field_name and data_utils.is_uuid(value):",
            "            try:",
            "                value = self.queryset.get(pk=value)",
            "            except ObjectDoesNotExist:",
            "                pass",
            "        return super().prepare_value(value)",
            "",
            "    def get_bound_field(self, form, field_name):",
            "        bound_field = BoundField(form, self, field_name)",
            "",
            "        # Set initial value based on prescribed child fields (if not already set)",
            "        if not self.initial and self.initial_params:",
            "            filter_kwargs = {}",
            "            for kwarg, child_field in self.initial_params.items():",
            "                value = form.initial.get(child_field.lstrip(\"$\"))",
            "                if value:",
            "                    filter_kwargs[kwarg] = value",
            "            if filter_kwargs:",
            "                self.initial = self.queryset.filter(**filter_kwargs).first()",
            "",
            "        # Modify the QuerySet of the field before we return it. Limit choices to any data already bound: Options",
            "        # will be populated on-demand via the APISelect widget.",
            "        data = bound_field.value()",
            "        if data:",
            "            field_name = getattr(self, \"to_field_name\") or \"pk\"",
            "            filter_ = self.filter(field_name=field_name)",
            "            try:",
            "                self.queryset = filter_.filter(self.queryset, data)",
            "            except (TypeError, ValidationError):",
            "                # Catch any error caused by invalid initial data passed from the user",
            "                self.queryset = self.queryset.none()",
            "        else:",
            "            self.queryset = self.queryset.none()",
            "",
            "        # Set the data URL on the APISelect widget (if not already set)",
            "        widget = bound_field.field.widget",
            "        if not widget.attrs.get(\"data-url\"):",
            "            route = lookup.get_route_for_model(self.queryset.model, \"list\", api=True)",
            "            data_url = reverse(route)",
            "            widget.attrs[\"data-url\"] = data_url",
            "",
            "        return bound_field",
            "",
            "",
            "class DynamicModelChoiceField(DynamicModelChoiceMixin, django_forms.ModelChoiceField):",
            "    \"\"\"",
            "    Override get_bound_field() to avoid pre-populating field choices with a SQL query. The field will be",
            "    rendered only with choices set via bound data. Choices are populated on-demand via the APISelect widget.",
            "    \"\"\"",
            "",
            "    def clean(self, value):",
            "        \"\"\"",
            "        When null option is enabled and \"None\" is sent as part of a form to be submitted, it is sent as the",
            "        string 'null'.  This will check for that condition and gracefully handle the conversion to a NoneType.",
            "        \"\"\"",
            "        if self.null_option is not None and value == settings.FILTERS_NULL_CHOICE_VALUE:",
            "            return None",
            "        return super().clean(value)",
            "",
            "",
            "class DynamicModelMultipleChoiceField(DynamicModelChoiceMixin, django_forms.ModelMultipleChoiceField):",
            "    \"\"\"",
            "    A multiple-choice version of DynamicModelChoiceField.",
            "    \"\"\"",
            "",
            "    filter = django_filters.ModelMultipleChoiceFilter",
            "    widget = widgets.APISelectMultiple",
            "",
            "",
            "class LaxURLField(django_forms.URLField):",
            "    \"\"\"",
            "    Modifies Django's built-in URLField to remove the requirement for fully-qualified domain names",
            "    (e.g. http://myserver/ is valid)",
            "    \"\"\"",
            "",
            "    default_validators = [validators.EnhancedURLValidator()]",
            "",
            "",
            "class JSONField(_JSONField):",
            "    \"\"\"",
            "    Custom wrapper around Django's built-in JSONField to avoid presenting \"null\" as the default text.",
            "    \"\"\"",
            "",
            "    def __init__(self, *args, **kwargs):",
            "        super().__init__(*args, **kwargs)",
            "        if not self.help_text:",
            "            self.help_text = 'Enter context data in <a href=\"https://json.org/\">JSON</a> format.'",
            "            self.widget.attrs[\"placeholder\"] = \"\"",
            "",
            "    def prepare_value(self, value):",
            "        if isinstance(value, InvalidJSONInput):",
            "            return value",
            "        if value is None:",
            "            return \"\"",
            "        return json.dumps(value, sort_keys=True, indent=4, ensure_ascii=False)",
            "",
            "    # TODO: remove this when we upgrade to Django 4",
            "    def bound_data(self, data, initial):",
            "        if data is None:",
            "            return None",
            "        return super().bound_data(data, initial)",
            "",
            "",
            "class JSONArrayFormField(django_forms.JSONField):",
            "    \"\"\"",
            "    A FormField counterpart to JSONArrayField.",
            "    Replicates ArrayFormField's base field validation: Field values are validated as JSON Arrays,",
            "    and each Array element is validated by `base_field` validators.",
            "    \"\"\"",
            "",
            "    def __init__(self, base_field, *, delimiter=\",\", **kwargs):",
            "        self.base_field = base_field",
            "        self.delimiter = delimiter",
            "        super().__init__(**kwargs)",
            "",
            "    def clean(self, value):",
            "        \"\"\"",
            "        Validate `value` and return its \"cleaned\" value as an appropriate",
            "        Python object. Raise ValidationError for any errors.",
            "        \"\"\"",
            "        value = super().clean(value)",
            "        return [self.base_field.clean(val) for val in value]",
            "",
            "    def prepare_value(self, value):",
            "        \"\"\"",
            "        Return a string of this value.",
            "        \"\"\"",
            "        if isinstance(value, list):",
            "            return self.delimiter.join(str(self.base_field.prepare_value(v)) for v in value)",
            "        return value",
            "",
            "    def to_python(self, value):",
            "        \"\"\"",
            "        Convert `value` into JSON, raising django.core.exceptions.ValidationError",
            "        if the data can't be converted. Return the converted value.",
            "        \"\"\"",
            "        if isinstance(value, list):",
            "            items = value",
            "        elif value:",
            "            try:",
            "                items = value.split(self.delimiter)",
            "            except Exception as e:",
            "                raise ValidationError(e)",
            "        else:",
            "            items = []",
            "",
            "        errors = []",
            "        values = []",
            "        for item in items:",
            "            try:",
            "                values.append(self.base_field.to_python(item))",
            "            except ValidationError as error:",
            "                errors.append(error)",
            "        if errors:",
            "            raise ValidationError(errors)",
            "        return values",
            "",
            "    def validate(self, value):",
            "        \"\"\"",
            "        Validate `value` and raise ValidationError if necessary.",
            "        \"\"\"",
            "        super().validate(value)",
            "        errors = []",
            "        for item in value:",
            "            try:",
            "                self.base_field.validate(item)",
            "            except ValidationError as error:",
            "                errors.append(error)",
            "        if errors:",
            "            raise ValidationError(errors)",
            "",
            "    def run_validators(self, value):",
            "        \"\"\"",
            "        Runs all validators against `value` and raise ValidationError if necessary.",
            "        Some validators can't be created at field initialization time.",
            "        \"\"\"",
            "        super().run_validators(value)",
            "        errors = []",
            "        for item in value:",
            "            try:",
            "                self.base_field.run_validators(item)",
            "            except ValidationError as error:",
            "                errors.append(error)",
            "        if errors:",
            "            raise ValidationError(errors)",
            "",
            "    def has_changed(self, initial, data):",
            "        \"\"\"",
            "        Return True if `data` differs from `initial`.",
            "        \"\"\"",
            "        value = self.to_python(data)",
            "        if initial in self.empty_values and value in self.empty_values:",
            "            return False",
            "        return super().has_changed(initial, data)",
            "",
            "",
            "class NumericArrayField(SimpleArrayField):",
            "    \"\"\"Basic array field that takes comma-separated or hyphenated ranges.\"\"\"",
            "",
            "    def to_python(self, value):",
            "        try:",
            "            value = \",\".join([str(n) for n in forms.parse_numeric_range(value)])",
            "        except ValueError as error:",
            "            raise ValidationError(error)",
            "        return super().to_python(value)",
            "",
            "",
            "class MultiMatchModelMultipleChoiceField(DynamicModelChoiceMixin, django_filters.fields.ModelMultipleChoiceField):",
            "    \"\"\"",
            "    Filter field to support matching on the PK *or* `to_field_name` fields (defaulting to `slug` if not specified).",
            "",
            "    Raises ValidationError if none of the fields match the requested value.",
            "    \"\"\"",
            "",
            "    filter = django_filters.ModelMultipleChoiceFilter",
            "    widget = widgets.APISelectMultiple",
            "",
            "    def __init__(self, *args, **kwargs):",
            "        self.natural_key = kwargs.setdefault(\"to_field_name\", \"slug\")",
            "        super().__init__(*args, **kwargs)",
            "",
            "    def _check_values(self, values):",
            "        \"\"\"",
            "        This method overloads the grandparent method in `django.forms.models.ModelMultipleChoiceField`,",
            "        re-using some of that method's existing logic and adding support for coupling this field with",
            "        multiple model fields.",
            "        \"\"\"",
            "        null = self.null_label is not None and values and self.null_value in values",
            "        if null:",
            "            values = [v for v in values if v != self.null_value]",
            "        # deduplicate given values to avoid creating many querysets or",
            "        # requiring the database backend deduplicate efficiently.",
            "        try:",
            "            values = frozenset(values)",
            "        except TypeError:",
            "            # list of lists isn't hashable, for example",
            "            raise ValidationError(",
            "                self.error_messages[\"invalid_list\"],",
            "                code=\"invalid_list\",",
            "            )",
            "        pk_values = set()",
            "        natural_key_values = set()",
            "        for item in values:",
            "            query = Q()",
            "            if data_utils.is_uuid(item):",
            "                pk_values.add(item)",
            "                query |= Q(pk=item)",
            "            else:",
            "                natural_key_values.add(item)",
            "                query |= Q(**{self.natural_key: item})",
            "            qs = self.queryset.filter(query)",
            "            if not qs.exists():",
            "                raise ValidationError(",
            "                    self.error_messages[\"invalid_choice\"],",
            "                    code=\"invalid_choice\",",
            "                    params={\"value\": item},",
            "                )",
            "        query = Q(pk__in=pk_values) | Q(**{f\"{self.natural_key}__in\": natural_key_values})",
            "        qs = self.queryset.filter(query)",
            "        result = list(qs)",
            "        if null:",
            "            result += [self.null_value]",
            "        return result",
            "",
            "",
            "class TagFilterField(DynamicModelMultipleChoiceField):",
            "    \"\"\"",
            "    A filter field for the tags of a model. Only the tags used by a model are displayed.",
            "",
            "    :param model: The model of the filter",
            "    \"\"\"",
            "",
            "    def __init__(self, model, *args, query_params=None, queryset=None, **kwargs):",
            "        from nautobot.extras.models import Tag",
            "",
            "        if queryset is None:",
            "            queryset = Tag.objects.get_for_model(model)",
            "        query_params = query_params or {}",
            "        query_params.update({\"content_types\": model._meta.label_lower})",
            "        super().__init__(",
            "            label=\"Tags\",",
            "            query_params=query_params,",
            "            queryset=queryset,",
            "            required=False,",
            "            to_field_name=\"name\",",
            "            *args,",
            "            **kwargs,",
            "        )"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "375": [
                "CommentField"
            ],
            "376": [
                "CommentField"
            ],
            "377": [
                "CommentField"
            ],
            "378": [
                "CommentField"
            ],
            "379": [
                "CommentField"
            ],
            "380": [
                "CommentField"
            ]
        },
        "addLocation": []
    },
    "nautobot/core/settings.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 682,
                "afterPatchRowNumber": 682,
                "PatchRowcode": "     ),"
            },
            "1": {
                "beforePatchRowNumber": 683,
                "afterPatchRowNumber": 683,
                "PatchRowcode": "     \"SUPPORT_MESSAGE\": ConstanceConfigItem("
            },
            "2": {
                "beforePatchRowNumber": 684,
                "afterPatchRowNumber": 684,
                "PatchRowcode": "         default=\"\","
            },
            "3": {
                "beforePatchRowNumber": 685,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        help_text=\"Help message to include on 4xx and 5xx error pages. Markdown is supported.\\n\""
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 685,
                "PatchRowcode": "+        help_text=\"Help message to include on 4xx and 5xx error pages. \""
            },
            "5": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 686,
                "PatchRowcode": "+        \"Markdown is supported, as are some HTML tags and attributes.\\n\""
            },
            "6": {
                "beforePatchRowNumber": 686,
                "afterPatchRowNumber": 687,
                "PatchRowcode": "         \"If unspecified, instructions to join Network to Code's Slack community will be provided.\","
            },
            "7": {
                "beforePatchRowNumber": 687,
                "afterPatchRowNumber": 688,
                "PatchRowcode": "     ),"
            },
            "8": {
                "beforePatchRowNumber": 688,
                "afterPatchRowNumber": 689,
                "PatchRowcode": " }"
            }
        },
        "frontPatchFile": [
            "import os",
            "import platform",
            "import re",
            "import sys",
            "",
            "from django.contrib.messages import constants as messages",
            "import django.forms",
            "from django.utils.safestring import mark_safe",
            "",
            "from nautobot import __version__",
            "from nautobot.core.settings_funcs import ConstanceConfigItem, is_truthy, parse_redis_connection",
            "",
            "#",
            "# Environment setup",
            "#",
            "",
            "# This is used for display in the UI. There are also VERSION_MAJOR and VERSION_MINOR derived from this later.",
            "VERSION = __version__",
            "",
            "# Hostname of the system. This is displayed in the web UI footers along with the",
            "# version.",
            "HOSTNAME = platform.node()",
            "",
            "# Set the base directory two levels up (i.e. the base nautobot/ directory)",
            "BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))",
            "",
            "# Set the swapable User model to the Nautobot custom User model",
            "AUTH_USER_MODEL = \"users.User\"",
            "",
            "# Set the default AutoField for 3rd party apps",
            "# N.B. Ideally this would be a `UUIDField`, but due to Django restrictions",
            "#      we can't do that yet",
            "DEFAULT_AUTO_FIELD = \"django.db.models.BigAutoField\"",
            "",
            "",
            "###############################################################",
            "# NAUTOBOT - Settings for Nautobot internals/plugins/defaults #",
            "###############################################################",
            "",
            "#",
            "# Nautobot optional settings/defaults",
            "#",
            "ALLOWED_URL_SCHEMES = (",
            "    \"file\",",
            "    \"ftp\",",
            "    \"ftps\",",
            "    \"http\",",
            "    \"https\",",
            "    \"irc\",",
            "    \"mailto\",",
            "    \"sftp\",",
            "    \"ssh\",",
            "    \"tel\",",
            "    \"telnet\",",
            "    \"tftp\",",
            "    \"vnc\",",
            "    \"xmpp\",",
            ")",
            "",
            "# Base directory wherein all created files (jobs, git repositories, file uploads, static files) will be stored)",
            "NAUTOBOT_ROOT = os.getenv(\"NAUTOBOT_ROOT\", os.path.expanduser(\"~/.nautobot\"))",
            "",
            "# Disable linking of Config Context objects via Dynamic Groups by default. This could cause performance impacts",
            "# when a large number of dynamic groups are present",
            "CONFIG_CONTEXT_DYNAMIC_GROUPS_ENABLED = is_truthy(os.getenv(\"NAUTOBOT_CONFIG_CONTEXT_DYNAMIC_GROUPS_ENABLED\", \"False\"))",
            "",
            "# Exclude potentially sensitive models from wildcard view exemption. These may still be exempted",
            "# by specifying the model individually in the EXEMPT_VIEW_PERMISSIONS configuration parameter.",
            "EXEMPT_EXCLUDE_MODELS = (",
            "    (\"auth\", \"group\"),",
            "    (\"users\", \"user\"),",
            "    (\"users\", \"objectpermission\"),",
            ")",
            "",
            "# Models to exempt from the enforcement of view permissions",
            "EXEMPT_VIEW_PERMISSIONS = []",
            "",
            "# The file path to a directory where cloned Git repositories will be located",
            "GIT_ROOT = os.getenv(\"NAUTOBOT_GIT_ROOT\", os.path.join(NAUTOBOT_ROOT, \"git\").rstrip(\"/\"))",
            "",
            "# HTTP proxies to use for outbound requests originating from Nautobot (e.g. when sending webhook requests)",
            "HTTP_PROXIES = None",
            "",
            "# Send anonymized installation metrics when post_upgrade or send_installation_metrics management commands are run",
            "INSTALLATION_METRICS_ENABLED = is_truthy(os.getenv(\"NAUTOBOT_INSTALLATION_METRICS_ENABLED\", \"True\"))",
            "",
            "# The storage backend to use for Job input files and Job output files",
            "JOB_FILE_IO_STORAGE = os.getenv(\"NAUTOBOT_JOB_FILE_IO_STORAGE\", \"db_file_storage.storage.DatabaseFileStorage\")",
            "",
            "# The file path to a directory where locally installed Jobs can be discovered",
            "JOBS_ROOT = os.getenv(\"NAUTOBOT_JOBS_ROOT\", os.path.join(NAUTOBOT_ROOT, \"jobs\").rstrip(\"/\"))",
            "",
            "# Log Nautobot deprecation warnings. Note that this setting is ignored (deprecation logs always enabled) if DEBUG = True",
            "LOG_DEPRECATION_WARNINGS = is_truthy(os.getenv(\"NAUTOBOT_LOG_DEPRECATION_WARNINGS\", \"False\"))",
            "",
            "MAINTENANCE_MODE = is_truthy(os.getenv(\"NAUTOBOT_MAINTENANCE_MODE\", \"False\"))",
            "# Metrics",
            "METRICS_ENABLED = is_truthy(os.getenv(\"NAUTOBOT_METRICS_ENABLED\", \"False\"))",
            "",
            "# Napalm",
            "NAPALM_ARGS = {}",
            "NAPALM_PASSWORD = os.getenv(\"NAUTOBOT_NAPALM_PASSWORD\", \"\")",
            "NAPALM_TIMEOUT = int(os.getenv(\"NAUTOBOT_NAPALM_TIMEOUT\", \"30\"))",
            "NAPALM_USERNAME = os.getenv(\"NAUTOBOT_NAPALM_USERNAME\", \"\")",
            "",
            "# Plugins",
            "PLUGINS = []",
            "PLUGINS_CONFIG = {}",
            "",
            "# Global 3rd-party authentication settings",
            "EXTERNAL_AUTH_DEFAULT_GROUPS = []",
            "EXTERNAL_AUTH_DEFAULT_PERMISSIONS = {}",
            "",
            "# Remote auth backend settings",
            "REMOTE_AUTH_AUTO_CREATE_USER = False",
            "REMOTE_AUTH_HEADER = \"HTTP_REMOTE_USER\"",
            "",
            "# SSO backend settings https://python-social-auth.readthedocs.io/en/latest/configuration/settings.html",
            "SOCIAL_AUTH_POSTGRES_JSONFIELD = False",
            "# Nautobot related - May be overridden if using custom social auth backend",
            "SOCIAL_AUTH_BACKEND_PREFIX = \"social_core.backends\"",
            "",
            "# Job log entry sanitization and similar",
            "SANITIZER_PATTERNS = [",
            "    # General removal of username-like and password-like tokens",
            "    (re.compile(r\"(https?://)?\\S+\\s*@\", re.IGNORECASE), r\"\\1{replacement}@\"),",
            "    (",
            "        re.compile(r\"(username|password|passwd|pwd|secret|secrets)([\\\"']?(?:\\s+is.?|:)?\\s+)\\S+[\\\"']?\", re.IGNORECASE),",
            "        r\"\\1\\2{replacement}\",",
            "    ),",
            "]",
            "",
            "# Storage",
            "STORAGE_BACKEND = None",
            "STORAGE_CONFIG = {}",
            "",
            "# Test runner that is aware of our use of \"integration\" tags and only runs",
            "# integration tests if explicitly passed in with `nautobot-server test --tag integration`.",
            "TEST_RUNNER = \"nautobot.core.tests.runner.NautobotTestRunner\"",
            "# Disable test data factories by default so as not to cause issues for plugins.",
            "# The nautobot_config.py that Nautobot core uses for its own tests will override this to True.",
            "TEST_USE_FACTORIES = is_truthy(os.getenv(\"NAUTOBOT_TEST_USE_FACTORIES\", \"False\"))",
            "# Pseudo-random number generator seed, for reproducibility of test results.",
            "TEST_FACTORY_SEED = os.getenv(\"NAUTOBOT_TEST_FACTORY_SEED\", None)",
            "",
            "#",
            "# django-slowtests",
            "#",
            "",
            "# Performance test uses `NautobotPerformanceTestRunner` to run, which is only available once you have `django-slowtests` installed in your dev environment.",
            "# `invoke performance-test` and adding `--performance-report` or `--performance-snapshot` at the end of the `invoke` command",
            "# will automatically opt to NautobotPerformanceTestRunner to run the tests.",
            "",
            "# The baseline file that the performance test is running against",
            "# TODO we need to replace the baselines in this file with more consistent results at least for CI",
            "TEST_PERFORMANCE_BASELINE_FILE = os.getenv(",
            "    \"NAUTOBOT_TEST_PERFORMANCE_BASELINE_FILE\", \"nautobot/core/tests/performance_baselines.yml\"",
            ")",
            "",
            "#",
            "# Django Prometheus",
            "#",
            "",
            "PROMETHEUS_EXPORT_MIGRATIONS = False",
            "",
            "",
            "#",
            "# Django filters",
            "#",
            "",
            "FILTERS_NULL_CHOICE_LABEL = \"None\"",
            "FILTERS_NULL_CHOICE_VALUE = \"null\"",
            "",
            "STRICT_FILTERING = is_truthy(os.getenv(\"NAUTOBOT_STRICT_FILTERING\", \"True\"))",
            "",
            "#",
            "# Django REST framework (API)",
            "#",
            "",
            "REST_FRAMEWORK_VERSION = VERSION.rsplit(\".\", 1)[0]  # Use major.minor as API version",
            "VERSION_MAJOR, VERSION_MINOR = [int(v) for v in REST_FRAMEWORK_VERSION.split(\".\")]",
            "# We support all major.minor API versions from 2.0 to the present latest version.",
            "# Similar logic exists in tasks.py, please keep them in sync!",
            "if VERSION_MAJOR != 2:",
            "    raise RuntimeError(f\"REST_FRAMEWORK_ALLOWED_VERSIONS needs to be updated to handle version {VERSION_MAJOR}\")",
            "REST_FRAMEWORK_ALLOWED_VERSIONS = [f\"{VERSION_MAJOR}.{minor}\" for minor in range(0, VERSION_MINOR + 1)]",
            "",
            "REST_FRAMEWORK = {",
            "    \"ALLOWED_VERSIONS\": REST_FRAMEWORK_ALLOWED_VERSIONS,",
            "    \"DEFAULT_AUTHENTICATION_CLASSES\": (",
            "        \"rest_framework.authentication.SessionAuthentication\",",
            "        \"nautobot.core.api.authentication.TokenAuthentication\",",
            "    ),",
            "    \"DEFAULT_FILTER_BACKENDS\": (",
            "        \"nautobot.core.api.filter_backends.NautobotFilterBackend\",",
            "        \"rest_framework.filters.OrderingFilter\",",
            "    ),",
            "    \"DEFAULT_METADATA_CLASS\": \"nautobot.core.api.metadata.NautobotMetadata\",",
            "    \"DEFAULT_PAGINATION_CLASS\": \"nautobot.core.api.pagination.OptionalLimitOffsetPagination\",",
            "    \"DEFAULT_PERMISSION_CLASSES\": (\"nautobot.core.api.authentication.TokenPermissions\",),",
            "    \"DEFAULT_RENDERER_CLASSES\": (",
            "        \"nautobot.core.api.renderers.NautobotJSONRenderer\",",
            "        \"nautobot.core.api.renderers.FormlessBrowsableAPIRenderer\",",
            "        \"nautobot.core.api.renderers.NautobotCSVRenderer\",",
            "    ),",
            "    \"DEFAULT_PARSER_CLASSES\": (",
            "        \"rest_framework.parsers.JSONParser\",",
            "        \"nautobot.core.api.parsers.NautobotCSVParser\",",
            "    ),",
            "    \"DEFAULT_SCHEMA_CLASS\": \"nautobot.core.api.schema.NautobotAutoSchema\",",
            "    # Version to use if the client doesn't request otherwise. Default to current (i.e. latest)",
            "    \"DEFAULT_VERSION\": REST_FRAMEWORK_VERSION,",
            "    \"DEFAULT_VERSIONING_CLASS\": \"nautobot.core.api.versioning.NautobotAPIVersioning\",",
            "    \"ORDERING_PARAM\": \"sort\",  # This is not meant to be changed by users, but is used internally by the API",
            "    \"PAGE_SIZE\": None,",
            "    \"SCHEMA_COERCE_METHOD_NAMES\": {",
            "        # Default mappings",
            "        \"retrieve\": \"read\",",
            "        \"destroy\": \"delete\",",
            "        # Custom operations",
            "        \"bulk_destroy\": \"bulk_delete\",",
            "    },",
            "    \"VIEW_NAME_FUNCTION\": \"nautobot.core.api.utils.get_view_name\",",
            "}",
            "",
            "",
            "#",
            "# drf_spectacular (OpenAPI/Swagger)",
            "#",
            "",
            "SPECTACULAR_SETTINGS = {",
            "    \"TITLE\": \"API Documentation\",",
            "    \"DESCRIPTION\": \"Source of truth and network automation platform\",",
            "    \"LICENSE\": {\"name\": \"Apache v2 License\"},",
            "    \"VERSION\": VERSION,",
            "    # For a semblance of backwards-compatibility with drf-yasg / OpenAPI 2.0, where \"/api\" was a common \"basePath\"",
            "    # in the schema.",
            "    # OpenAPI 3.0 removes \"basePath\" in favor of \"servers\", so we now declare \"/api\" as the server relative URL and",
            "    # trim it from all of the individual paths correspondingly.",
            "    # See also https://github.com/nautobot/nautobot-ansible/pull/135 for an example of why this is desirable.",
            "    \"SERVERS\": [{\"url\": \"/api\"}],",
            "    \"SCHEMA_PATH_PREFIX\": \"/api\",",
            "    \"SCHEMA_PATH_PREFIX_TRIM\": True,",
            "    # use sidecar - locally packaged UI files, not CDN",
            "    \"SWAGGER_UI_DIST\": \"SIDECAR\",",
            "    \"SWAGGER_UI_FAVICON_HREF\": \"SIDECAR\",",
            "    \"SWAGGER_UI_SETTINGS\": {",
            "        \"deepLinking\": True,",
            "        \"displayOperationId\": True,",
            "    },",
            "    \"REDOC_DIST\": \"SIDECAR\",",
            "    # Do not list all possible enum values in the description of filter fields and the like",
            "    # In addition to being highly verbose, it's inaccurate for filter fields like *__ic and *__re",
            "    \"ENUM_GENERATE_CHOICE_DESCRIPTION\": False,",
            "    \"ENUM_NAME_OVERRIDES\": {",
            "        # These choice enums need to be overridden because they get assigned to the `type` field and",
            "        # result in this error:",
            "        #    enum naming encountered a non-optimally resolvable collision for fields named \"type\".",
            "        \"CableTypeChoices\": \"nautobot.dcim.choices.CableTypeChoices\",",
            "        \"ConsolePortTypeChoices\": \"nautobot.dcim.choices.ConsolePortTypeChoices\",",
            "        \"CustomFieldTypeChoices\": \"nautobot.extras.choices.CustomFieldTypeChoices\",",
            "        \"InterfaceTypeChoices\": \"nautobot.dcim.choices.InterfaceTypeChoices\",",
            "        \"IPAddressTypeChoices\": \"nautobot.ipam.choices.IPAddressTypeChoices\",",
            "        \"PortTypeChoices\": \"nautobot.dcim.choices.PortTypeChoices\",",
            "        \"PowerFeedTypeChoices\": \"nautobot.dcim.choices.PowerFeedTypeChoices\",",
            "        \"PowerOutletTypeChoices\": \"nautobot.dcim.choices.PowerOutletTypeChoices\",",
            "        \"PowerPortTypeChoices\": \"nautobot.dcim.choices.PowerPortTypeChoices\",",
            "        \"PrefixTypeChoices\": \"nautobot.ipam.choices.PrefixTypeChoices\",",
            "        \"RackTypeChoices\": \"nautobot.dcim.choices.RackTypeChoices\",",
            "        \"RelationshipTypeChoices\": \"nautobot.extras.choices.RelationshipTypeChoices\",",
            "        # These choice enums need to be overridden because they get assigned to different names with the same choice set and",
            "        # result in this error:",
            "        #   encountered multiple names for the same choice set",
            "        \"JobExecutionTypeIntervalChoices\": \"nautobot.extras.choices.JobExecutionType\",",
            "        # These choice enums need to be overridden because they get assigned to the `protocol` field and",
            "        # result in this error:",
            "        #    enum naming encountered a non-optimally resolvable collision for fields named \"protocol\".",
            "        \"InterfaceRedundancyGroupProtocolChoices\": \"nautobot.dcim.choices.InterfaceRedundancyGroupProtocolChoices\",",
            "        \"ServiceProtocolChoices\": \"nautobot.ipam.choices.ServiceProtocolChoices\",",
            "    },",
            "    # Create separate schema components for PATCH requests (fields generally are not `required` on PATCH)",
            "    \"COMPONENT_SPLIT_PATCH\": True,",
            "    # Create separate schema components for request vs response where appropriate",
            "    \"COMPONENT_SPLIT_REQUEST\": True,",
            "}",
            "",
            "",
            "##############################################",
            "# DJANGO - Core settings required for Django #",
            "##############################################",
            "",
            "#",
            "# Databases",
            "#",
            "",
            "# Only PostgresSQL is supported, so database driver is hard-coded. This can",
            "# still be overloaded in custom settings.",
            "# https://docs.djangoproject.com/en/stable/ref/settings/#databases",
            "DATABASES = {",
            "    \"default\": {",
            "        \"NAME\": os.getenv(\"NAUTOBOT_DB_NAME\", \"nautobot\"),",
            "        \"USER\": os.getenv(\"NAUTOBOT_DB_USER\", \"\"),",
            "        \"PASSWORD\": os.getenv(\"NAUTOBOT_DB_PASSWORD\", \"\"),",
            "        \"HOST\": os.getenv(\"NAUTOBOT_DB_HOST\", \"localhost\"),",
            "        \"PORT\": os.getenv(\"NAUTOBOT_DB_PORT\", \"\"),",
            "        \"CONN_MAX_AGE\": int(os.getenv(\"NAUTOBOT_DB_TIMEOUT\", \"300\")),",
            "        \"ENGINE\": os.getenv(",
            "            \"NAUTOBOT_DB_ENGINE\",",
            "            \"django_prometheus.db.backends.postgresql\" if METRICS_ENABLED else \"django.db.backends.postgresql\",",
            "        ),",
            "    }",
            "}",
            "",
            "# Ensure proper Unicode handling for MySQL",
            "if DATABASES[\"default\"][\"ENGINE\"] == \"django.db.backends.mysql\":",
            "    DATABASES[\"default\"][\"OPTIONS\"] = {\"charset\": \"utf8mb4\"}",
            "",
            "# The secret key is used to encrypt session keys and salt passwords.",
            "SECRET_KEY = os.getenv(\"NAUTOBOT_SECRET_KEY\")",
            "",
            "# Default overrides",
            "ALLOWED_HOSTS = os.getenv(\"NAUTOBOT_ALLOWED_HOSTS\", \"\").split(\" \")",
            "CSRF_TRUSTED_ORIGINS = []",
            "CSRF_FAILURE_VIEW = \"nautobot.core.views.csrf_failure\"",
            "DATE_FORMAT = os.getenv(\"NAUTOBOT_DATE_FORMAT\", \"N j, Y\")",
            "DATETIME_FORMAT = os.getenv(\"NAUTOBOT_DATETIME_FORMAT\", \"N j, Y g:i a\")",
            "DEBUG = is_truthy(os.getenv(\"NAUTOBOT_DEBUG\", \"False\"))",
            "INTERNAL_IPS = (\"127.0.0.1\", \"::1\")",
            "FORCE_SCRIPT_NAME = None",
            "",
            "TESTING = \"test\" in sys.argv",
            "",
            "LOG_LEVEL = \"DEBUG\" if DEBUG else \"INFO\"",
            "",
            "if TESTING:",
            "    # Log to null handler instead of stderr during testing",
            "    LOGGING = {",
            "        \"version\": 1,",
            "        \"disable_existing_loggers\": False,",
            "        \"handlers\": {\"console\": {\"level\": \"INFO\", \"class\": \"logging.NullHandler\"}},",
            "        \"loggers\": {\"nautobot\": {\"handlers\": [\"console\"], \"level\": \"INFO\"}},",
            "    }",
            "else:",
            "    LOGGING = {",
            "        \"version\": 1,",
            "        \"disable_existing_loggers\": False,",
            "        \"formatters\": {",
            "            \"normal\": {",
            "                \"format\": \"%(asctime)s.%(msecs)03d %(levelname)-7s %(name)s :\\n  %(message)s\",",
            "                \"datefmt\": \"%H:%M:%S\",",
            "            },",
            "            \"verbose\": {",
            "                \"format\": \"%(asctime)s.%(msecs)03d %(levelname)-7s %(name)-20s %(filename)-15s %(funcName)30s() :\\n  %(message)s\",",
            "                \"datefmt\": \"%H:%M:%S\",",
            "            },",
            "        },",
            "        \"handlers\": {",
            "            \"normal_console\": {",
            "                \"level\": \"INFO\",",
            "                \"class\": \"logging.StreamHandler\",",
            "                \"formatter\": \"normal\",",
            "            },",
            "            \"verbose_console\": {",
            "                \"level\": \"DEBUG\",",
            "                \"class\": \"logging.StreamHandler\",",
            "                \"formatter\": \"verbose\",",
            "            },",
            "        },",
            "        \"loggers\": {",
            "            \"django\": {\"handlers\": [\"normal_console\"], \"level\": \"INFO\"},",
            "            \"nautobot\": {",
            "                \"handlers\": [\"verbose_console\" if DEBUG else \"normal_console\"],",
            "                \"level\": LOG_LEVEL,",
            "            },",
            "        },",
            "    }",
            "",
            "MEDIA_ROOT = os.path.join(NAUTOBOT_ROOT, \"media\").rstrip(\"/\")",
            "SESSION_EXPIRE_AT_BROWSER_CLOSE = is_truthy(os.getenv(\"NAUTOBOT_SESSION_EXPIRE_AT_BROWSER_CLOSE\", \"False\"))",
            "SESSION_COOKIE_AGE = int(os.getenv(\"NAUTOBOT_SESSION_COOKIE_AGE\", \"1209600\"))  # 2 weeks, in seconds",
            "SESSION_FILE_PATH = os.getenv(\"NAUTOBOT_SESSION_FILE_PATH\", None)",
            "SHORT_DATE_FORMAT = os.getenv(\"NAUTOBOT_SHORT_DATE_FORMAT\", \"Y-m-d\")",
            "SHORT_DATETIME_FORMAT = os.getenv(\"NAUTOBOT_SHORT_DATETIME_FORMAT\", \"Y-m-d H:i\")",
            "SHORT_TIME_FORMAT = os.getenv(\"NAUTOBOT_SHORT_TIME_FORMAT\", \"H:i:s\")",
            "TIME_FORMAT = os.getenv(\"NAUTOBOT_TIME_FORMAT\", \"g:i a\")",
            "TIME_ZONE = os.getenv(\"NAUTOBOT_TIME_ZONE\", \"UTC\")",
            "",
            "# Disable importing the WSGI module before starting the server application. This is required for",
            "# uWSGI postfork callbacks to execute as is currently required in `nautobot.core.wsgi`.",
            "WEBSERVER_WARMUP = False",
            "",
            "# Installed apps and Django plugins. Nautobot plugins will be appended here later.",
            "INSTALLED_APPS = [",
            "    \"django.contrib.auth\",",
            "    \"django.contrib.contenttypes\",",
            "    \"django.contrib.sessions\",",
            "    \"django.contrib.messages\",",
            "    \"django.contrib.staticfiles\",",
            "    \"django.contrib.humanize\",",
            "    \"corsheaders\",",
            "    \"django_filters\",",
            "    \"django_jinja\",",
            "    \"django_tables2\",",
            "    \"django_prometheus\",",
            "    \"social_django\",",
            "    \"taggit\",",
            "    \"timezone_field\",",
            "    \"nautobot.core.apps.NautobotConstanceConfig\",  # overridden form of \"constance\" AppConfig",
            "    \"nautobot.core\",",
            "    \"django.contrib.admin\",  # Must be after `nautobot.core` for template overrides",
            "    \"django_celery_beat\",  # Must be after `nautobot.core` for template overrides",
            "    \"django_celery_results\",",
            "    \"rest_framework\",  # Must be after `nautobot.core` for template overrides",
            "    \"db_file_storage\",",
            "    \"nautobot.circuits\",",
            "    \"nautobot.dcim\",",
            "    \"nautobot.ipam\",",
            "    \"nautobot.extras\",",
            "    \"nautobot.tenancy\",",
            "    \"nautobot.users\",",
            "    \"nautobot.virtualization\",",
            "    \"drf_spectacular\",",
            "    \"drf_spectacular_sidecar\",",
            "    \"graphene_django\",",
            "    \"health_check\",",
            "    \"health_check.storage\",",
            "    \"django_extensions\",",
            "    \"constance.backends.database\",",
            "    \"django_ajax_tables\",",
            "]",
            "",
            "# Middleware",
            "MIDDLEWARE = [",
            "    \"django_prometheus.middleware.PrometheusBeforeMiddleware\",",
            "    \"corsheaders.middleware.CorsMiddleware\",",
            "    \"django.contrib.sessions.middleware.SessionMiddleware\",",
            "    \"django.middleware.common.CommonMiddleware\",",
            "    \"django.middleware.csrf.CsrfViewMiddleware\",",
            "    \"django.contrib.auth.middleware.AuthenticationMiddleware\",",
            "    \"django.contrib.messages.middleware.MessageMiddleware\",",
            "    \"django.middleware.clickjacking.XFrameOptionsMiddleware\",",
            "    \"django.middleware.security.SecurityMiddleware\",",
            "    \"nautobot.core.middleware.ExceptionHandlingMiddleware\",",
            "    \"nautobot.core.middleware.RemoteUserMiddleware\",",
            "    \"nautobot.core.middleware.ExternalAuthMiddleware\",",
            "    \"nautobot.core.middleware.ObjectChangeMiddleware\",",
            "    \"django_prometheus.middleware.PrometheusAfterMiddleware\",",
            "]",
            "",
            "ROOT_URLCONF = \"nautobot.core.urls\"",
            "",
            "TEMPLATES = [",
            "    {",
            "        \"NAME\": \"django\",",
            "        \"BACKEND\": \"django.template.backends.django.DjangoTemplates\",",
            "        \"DIRS\": [],",
            "        \"APP_DIRS\": True,",
            "        \"OPTIONS\": {",
            "            \"context_processors\": [",
            "                \"django.template.context_processors.debug\",",
            "                \"django.template.context_processors.request\",",
            "                \"django.template.context_processors.media\",",
            "                \"django.contrib.auth.context_processors.auth\",",
            "                \"django.contrib.messages.context_processors.messages\",",
            "                \"social_django.context_processors.backends\",",
            "                \"social_django.context_processors.login_redirect\",",
            "                \"nautobot.core.context_processors.settings\",",
            "                \"nautobot.core.context_processors.sso_auth\",",
            "            ],",
            "        },",
            "    },",
            "    {",
            "        \"NAME\": \"jinja\",",
            "        \"BACKEND\": \"django_jinja.backend.Jinja2\",",
            "        \"DIRS\": [],",
            "        \"APP_DIRS\": False,",
            "        \"OPTIONS\": {",
            "            \"context_processors\": [",
            "                \"django.template.context_processors.debug\",",
            "                \"django.template.context_processors.request\",",
            "                \"django.template.context_processors.media\",",
            "                \"django.contrib.auth.context_processors.auth\",",
            "                \"django.contrib.messages.context_processors.messages\",",
            "                \"social_django.context_processors.backends\",",
            "                \"social_django.context_processors.login_redirect\",",
            "                \"nautobot.core.context_processors.settings\",",
            "                \"nautobot.core.context_processors.sso_auth\",",
            "            ],",
            "            \"environment\": \"jinja2.sandbox.SandboxedEnvironment\",",
            "        },",
            "    },",
            "]",
            "",
            "# Set up authentication backends",
            "AUTHENTICATION_BACKENDS = [",
            "    # Always check object permissions",
            "    \"nautobot.core.authentication.ObjectPermissionBackend\",",
            "]",
            "",
            "# Internationalization",
            "LANGUAGE_CODE = \"en-us\"",
            "USE_I18N = True",
            "USE_TZ = True",
            "",
            "# WSGI",
            "WSGI_APPLICATION = \"nautobot.core.wsgi.application\"",
            "SECURE_PROXY_SSL_HEADER = (\"HTTP_X_FORWARDED_PROTO\", \"https\")",
            "USE_X_FORWARDED_HOST = True",
            "X_FRAME_OPTIONS = \"DENY\"",
            "",
            "# Static files (CSS, JavaScript, Images)",
            "STATIC_ROOT = os.path.join(NAUTOBOT_ROOT, \"static\")",
            "STATIC_URL = \"static/\"",
            "STATICFILES_DIRS = (os.path.join(BASE_DIR, \"project-static\"),)",
            "",
            "# Media",
            "MEDIA_URL = \"media/\"",
            "",
            "# Disable default limit of 1000 fields per request. Needed for bulk deletion of objects. (Added in Django 1.10.)",
            "DATA_UPLOAD_MAX_NUMBER_FIELDS = None",
            "",
            "# Messages",
            "MESSAGE_TAGS = {",
            "    messages.ERROR: \"danger\",",
            "}",
            "",
            "# Authentication URLs",
            "# This is the URL route name for the login view.",
            "LOGIN_URL = \"login\"",
            "",
            "# This is the URL route name for the home page (index) view.",
            "LOGIN_REDIRECT_URL = \"home\"",
            "",
            "#",
            "# django-constance",
            "#",
            "",
            "CONSTANCE_BACKEND = \"constance.backends.database.DatabaseBackend\"",
            "CONSTANCE_DATABASE_PREFIX = \"constance:nautobot:\"",
            "CONSTANCE_DATABASE_CACHE_BACKEND = \"default\"",
            "CONSTANCE_IGNORE_ADMIN_VERSION_CHECK = True  # avoid potential errors in a multi-node deployment",
            "",
            "CONSTANCE_ADDITIONAL_FIELDS = {",
            "    \"per_page_defaults_field\": [",
            "        \"nautobot.core.forms.fields.JSONArrayFormField\",",
            "        {",
            "            \"widget\": \"django.forms.TextInput\",",
            "            \"base_field\": django.forms.IntegerField(min_value=1),",
            "        },",
            "    ],",
            "    \"release_check_timeout_field\": [",
            "        \"django.forms.IntegerField\",",
            "        {",
            "            \"min_value\": 3600,",
            "        },",
            "    ],",
            "    \"release_check_url_field\": [",
            "        \"django.forms.URLField\",",
            "        {",
            "            \"required\": False,",
            "        },",
            "    ],",
            "    \"optional_json_field\": [",
            "        \"django.forms.fields.JSONField\",",
            "        {",
            "            \"required\": False,",
            "        },",
            "    ],",
            "}",
            "",
            "CONSTANCE_CONFIG = {",
            "    \"BANNER_BOTTOM\": ConstanceConfigItem(",
            "        default=\"\",",
            "        help_text=\"Custom HTML to display in a banner at the bottom of all pages.\",",
            "    ),",
            "    \"BANNER_LOGIN\": ConstanceConfigItem(",
            "        default=\"\",",
            "        help_text=\"Custom HTML to display in a banner at the top of the login page.\",",
            "    ),",
            "    \"BANNER_TOP\": ConstanceConfigItem(",
            "        default=\"\",",
            "        help_text=\"Custom HTML to display in a banner at the top of all pages.\",",
            "    ),",
            "    \"CHANGELOG_RETENTION\": ConstanceConfigItem(",
            "        default=90,",
            "        help_text=\"Number of days to retain object changelog history.\\nSet this to 0 to retain changes indefinitely.\",",
            "        field_type=int,",
            "    ),",
            "    \"DEVICE_NAME_AS_NATURAL_KEY\": ConstanceConfigItem(",
            "        default=False,",
            "        help_text=\"Device names are not guaranteed globally-unique by Nautobot but in practice they often are. \"",
            "        \"Set this to True to use the device name alone as the natural key for Device objects. \"",
            "        \"Set this to False to use the sequence (name, tenant, location) as the natural key instead.\",",
            "        field_type=bool,",
            "    ),",
            "    \"DEPLOYMENT_ID\": ConstanceConfigItem(",
            "        default=\"\",",
            "        help_text=\"Randomly generated UUID used to identify this installation.\\n\"",
            "        \"Used for sending anonymous installation metrics, when settings.INSTALLATION_METRICS_ENABLED is set to True.\",",
            "        field_type=str,",
            "    ),",
            "    \"DYNAMIC_GROUPS_MEMBER_CACHE_TIMEOUT\": ConstanceConfigItem(",
            "        default=0,",
            "        help_text=\"Dynamic Group member cache timeout in seconds. This is the amount of time that a Dynamic Group's member list \"",
            "        \"will be cached in Django cache backend. Since retrieving the member list of a Dynamic Group can be a very \"",
            "        \"expensive operation, especially in reverse, this cache is used to speed up the process of retrieving the \"",
            "        \"member list. This cache is invalidated when a Dynamic Group is saved. Set to 0 to disable caching.\",",
            "        field_type=int,",
            "    ),",
            "    \"JOB_CREATE_FILE_MAX_SIZE\": ConstanceConfigItem(",
            "        default=10 << 20,",
            "        help_text=mark_safe(  # noqa: S308  # suspicious-mark-safe-usage, but this is a static string so it's safe",
            "            \"Maximum size (in bytes) of any single file generated by a <code>Job.create_file()</code> call.\"",
            "        ),",
            "        field_type=int,",
            "    ),",
            "    \"LOCATION_NAME_AS_NATURAL_KEY\": ConstanceConfigItem(",
            "        default=False,",
            "        help_text=\"Location names are not guaranteed globally-unique by Nautobot but in practice they often are. \"",
            "        \"Set this to True to use the location name alone as the natural key for Location objects. \"",
            "        \"Set this to False to use the sequence (name, parent__name, parent__parent__name, ...) \"",
            "        \"as the natural key instead.\",",
            "        field_type=bool,",
            "    ),",
            "    \"MAX_PAGE_SIZE\": ConstanceConfigItem(",
            "        default=1000,",
            "        help_text=\"Maximum number of objects that a user can list in one UI page or one API call.\\n\"",
            "        \"If set to 0, a user can retrieve an unlimited number of objects.\",",
            "        field_type=int,",
            "    ),",
            "    \"PAGINATE_COUNT\": ConstanceConfigItem(",
            "        default=50,",
            "        help_text=\"Default number of objects to display per page when listing objects in the UI and/or REST API.\",",
            "        field_type=int,",
            "    ),",
            "    \"PER_PAGE_DEFAULTS\": ConstanceConfigItem(",
            "        default=[25, 50, 100, 250, 500, 1000],",
            "        help_text=\"Pagination options to present to the user to choose amongst.\\n\"",
            "        \"For proper user experience, this list should include the PAGINATE_COUNT and MAX_PAGE_SIZE values as options.\",",
            "        # Use custom field type defined above",
            "        field_type=\"per_page_defaults_field\",",
            "    ),",
            "    \"NETWORK_DRIVERS\": ConstanceConfigItem(",
            "        default={},",
            "        help_text=mark_safe(  # noqa: S308  # suspicious-mark-safe-usage, but this is a static string so it's safe",
            "            \"Extend or override default Platform.network_driver translations provided by \"",
            "            '<a href=\"https://netutils.readthedocs.io/en/latest/user/lib_use_cases_lib_mapper/\">netutils</a>. '",
            "            \"Enter a dictionary in JSON format, for example:\\n\"",
            "            \"<pre>{\\n\"",
            "            '    \"netmiko\": {\"my_network_driver\": \"cisco_ios\"},\\n'",
            "            '    \"pyats\": {\"my_network_driver\": \"iosxe\"} \\n'",
            "            \"}</pre>\",",
            "        ),",
            "        # Use custom field type defined above",
            "        field_type=\"optional_json_field\",",
            "    ),",
            "    \"PREFER_IPV4\": ConstanceConfigItem(",
            "        default=False,",
            "        help_text=\"Whether to prefer IPv4 primary addresses over IPv6 primary addresses for devices.\",",
            "        field_type=bool,",
            "    ),",
            "    \"RACK_ELEVATION_DEFAULT_UNIT_HEIGHT\": ConstanceConfigItem(",
            "        default=22, help_text=\"Default height (in pixels) of a rack unit in a rack elevation diagram\", field_type=int",
            "    ),",
            "    \"RACK_ELEVATION_DEFAULT_UNIT_WIDTH\": ConstanceConfigItem(",
            "        default=230, help_text=\"Default width (in pixels) of a rack unit in a rack elevation diagram\", field_type=int",
            "    ),",
            "    \"RELEASE_CHECK_TIMEOUT\": ConstanceConfigItem(",
            "        default=24 * 3600,",
            "        help_text=\"Number of seconds (must be at least 3600, or one hour) to cache the result of a release check \"",
            "        \"before checking again for a new release.\",",
            "        # Use custom field type defined above",
            "        field_type=\"release_check_timeout_field\",",
            "    ),",
            "    \"RELEASE_CHECK_URL\": ConstanceConfigItem(",
            "        default=\"\",",
            "        help_text=\"URL of GitHub repository REST API endpoint to poll periodically for availability of new Nautobot releases.\\n\"",
            "        'This can be set to the official repository \"https://api.github.com/repos/nautobot/nautobot/releases\" or '",
            "        \"a custom fork.\\nSet this to an empty string to disable automatic update checks.\",",
            "        # Use custom field type defined above",
            "        field_type=\"release_check_url_field\",",
            "    ),",
            "    \"SUPPORT_MESSAGE\": ConstanceConfigItem(",
            "        default=\"\",",
            "        help_text=\"Help message to include on 4xx and 5xx error pages. Markdown is supported.\\n\"",
            "        \"If unspecified, instructions to join Network to Code's Slack community will be provided.\",",
            "    ),",
            "}",
            "",
            "CONSTANCE_CONFIG_FIELDSETS = {",
            "    \"Banners\": [\"BANNER_LOGIN\", \"BANNER_TOP\", \"BANNER_BOTTOM\"],",
            "    \"Change Logging\": [\"CHANGELOG_RETENTION\"],",
            "    \"Device Connectivity\": [\"NETWORK_DRIVERS\", \"PREFER_IPV4\"],",
            "    \"Installation Metrics\": [\"DEPLOYMENT_ID\"],",
            "    \"Natural Keys\": [\"DEVICE_NAME_AS_NATURAL_KEY\", \"LOCATION_NAME_AS_NATURAL_KEY\"],",
            "    \"Pagination\": [\"PAGINATE_COUNT\", \"MAX_PAGE_SIZE\", \"PER_PAGE_DEFAULTS\"],",
            "    \"Performance\": [\"DYNAMIC_GROUPS_MEMBER_CACHE_TIMEOUT\", \"JOB_CREATE_FILE_MAX_SIZE\"],",
            "    \"Rack Elevation Rendering\": [\"RACK_ELEVATION_DEFAULT_UNIT_HEIGHT\", \"RACK_ELEVATION_DEFAULT_UNIT_WIDTH\"],",
            "    \"Release Checking\": [\"RELEASE_CHECK_URL\", \"RELEASE_CHECK_TIMEOUT\"],",
            "    \"User Interface\": [\"SUPPORT_MESSAGE\"],",
            "}",
            "",
            "#",
            "# From django-cors-headers",
            "#",
            "",
            "# If True, all origins will be allowed. Other settings restricting allowed origins will be ignored.",
            "# Defaults to False. Setting this to True can be dangerous, as it allows any website to make",
            "# cross-origin requests to yours. Generally you'll want to restrict the list of allowed origins with",
            "# CORS_ALLOWED_ORIGINS or CORS_ALLOWED_ORIGIN_REGEXES.",
            "CORS_ALLOW_ALL_ORIGINS = is_truthy(os.getenv(\"NAUTOBOT_CORS_ALLOW_ALL_ORIGINS\", \"False\"))",
            "",
            "# A list of strings representing regexes that match Origins that are authorized to make cross-site",
            "# HTTP requests. Defaults to [].",
            "CORS_ALLOWED_ORIGIN_REGEXES = []",
            "",
            "# A list of origins that are authorized to make cross-site HTTP requests. Defaults to [].",
            "CORS_ALLOWED_ORIGINS = []",
            "",
            "#",
            "# GraphQL",
            "#",
            "",
            "GRAPHENE = {",
            "    \"SCHEMA\": \"nautobot.core.graphql.schema_init.schema\",",
            "    \"DJANGO_CHOICE_FIELD_ENUM_V3_NAMING\": True,  # any field with a name of type will break in Graphene otherwise.",
            "}",
            "GRAPHQL_CUSTOM_FIELD_PREFIX = \"cf\"",
            "GRAPHQL_RELATIONSHIP_PREFIX = \"rel\"",
            "GRAPHQL_COMPUTED_FIELD_PREFIX = \"cpf\"",
            "",
            "",
            "#",
            "# Caching",
            "#",
            "",
            "# The django-redis cache is used to establish concurrent locks using Redis.",
            "CACHES = {",
            "    \"default\": {",
            "        \"BACKEND\": os.getenv(",
            "            \"NAUTOBOT_CACHES_BACKEND\",",
            "            \"django_prometheus.cache.backends.redis.RedisCache\" if METRICS_ENABLED else \"django_redis.cache.RedisCache\",",
            "        ),",
            "        \"LOCATION\": parse_redis_connection(redis_database=1),",
            "        \"TIMEOUT\": 300,",
            "        \"OPTIONS\": {",
            "            \"CLIENT_CLASS\": \"django_redis.client.DefaultClient\",",
            "            \"PASSWORD\": \"\",",
            "        },",
            "    }",
            "}",
            "",
            "# Number of seconds to cache ContentType lookups. Set to 0 to disable caching.",
            "CONTENT_TYPE_CACHE_TIMEOUT = int(os.getenv(\"NAUTOBOT_CONTENT_TYPE_CACHE_TIMEOUT\", \"0\"))",
            "",
            "#",
            "# Celery (used for background processing)",
            "#",
            "",
            "# Celery broker URL used to tell workers where queues are located",
            "CELERY_BROKER_URL = os.getenv(\"NAUTOBOT_CELERY_BROKER_URL\", parse_redis_connection(redis_database=0))",
            "",
            "# Celery results backend URL to tell workers where to publish task results",
            "CELERY_RESULT_BACKEND = \"nautobot.core.celery.backends.NautobotDatabaseBackend\"",
            "",
            "# Enables extended task result attributes (name, args, kwargs, worker, retries, queue, delivery_info) to be written to backend.",
            "CELERY_RESULT_EXTENDED = True",
            "",
            "# A value of None or 0 means results will never expire (depending on backend specifications).",
            "CELERY_RESULT_EXPIRES = None",
            "",
            "# Instruct celery to report the started status of a job, instead of just `pending`, `finished`, or `failed`",
            "CELERY_TASK_TRACK_STARTED = True",
            "",
            "# If enabled, a `task-sent` event will be sent for every task so tasks can be tracked before they're consumed by a worker.",
            "CELERY_TASK_SEND_SENT_EVENT = True",
            "",
            "# If enabled stdout and stderr of running jobs will be redirected to the task logger.",
            "CELERY_WORKER_REDIRECT_STDOUTS = is_truthy(os.getenv(\"NAUTOBOT_CELERY_WORKER_REDIRECT_STDOUTS\", \"True\"))",
            "",
            "# The log level of log messages generated by redirected job stdout and stderr. Can be one of `DEBUG`, `INFO`, `WARNING`, `ERROR`, or `CRITICAL`.",
            "CELERY_WORKER_REDIRECT_STDOUTS_LEVEL = os.getenv(\"NAUTOBOT_CELERY_WORKER_REDIRECT_STDOUTS_LEVEL\", \"WARNING\")",
            "",
            "# Send task-related events so that tasks can be monitored using tools like flower. Sets the default value for the workers -E argument.",
            "CELERY_WORKER_SEND_TASK_EVENTS = True",
            "",
            "# Default celery queue name that will be used by workers and tasks if no queue is specified",
            "CELERY_TASK_DEFAULT_QUEUE = os.getenv(\"NAUTOBOT_CELERY_TASK_DEFAULT_QUEUE\", \"default\")",
            "",
            "# Global task time limits (seconds)",
            "# Exceeding the soft limit will result in a SoftTimeLimitExceeded exception,",
            "# while exceeding the hard limit will result in a SIGKILL.",
            "CELERY_TASK_SOFT_TIME_LIMIT = int(os.getenv(\"NAUTOBOT_CELERY_TASK_SOFT_TIME_LIMIT\", str(5 * 60)))",
            "CELERY_TASK_TIME_LIMIT = int(os.getenv(\"NAUTOBOT_CELERY_TASK_TIME_LIMIT\", str(10 * 60)))",
            "",
            "# Ports for prometheus metric HTTP server running on the celery worker.",
            "# Normally this should be set to a single port, unless you have multiple workers running on a single machine, i.e.",
            "# sharing the same available ports. In that case you need to specify a range of ports greater than or equal to the",
            "# highest amount of workers you are running on a single machine (comma-separated, like \"8080,8081,8082\"). You can then",
            "# use the `target_limit` parameter to the Prometheus `scrape_config` to ensure you are not getting duplicate metrics in",
            "# that case. Set this to an empty string to disable it.",
            "CELERY_WORKER_PROMETHEUS_PORTS = []",
            "if os.getenv(\"NAUTOBOT_CELERY_WORKER_PROMETHEUS_PORTS\"):",
            "    CELERY_WORKER_PROMETHEUS_PORTS = [",
            "        int(value) for value in os.getenv(\"NAUTOBOT_CELERY_WORKER_PROMETHEUS_PORTS\").split(\",\")",
            "    ]",
            "",
            "# These settings define the custom nautobot serialization encoding as an accepted data encoding format",
            "# and register that format for task input and result serialization",
            "CELERY_ACCEPT_CONTENT = [\"nautobot_json\"]",
            "CELERY_RESULT_ACCEPT_CONTENT = [\"nautobot_json\"]",
            "CELERY_TASK_SERIALIZER = \"nautobot_json\"",
            "CELERY_RESULT_SERIALIZER = \"nautobot_json\"",
            "",
            "CELERY_BEAT_SCHEDULER = \"nautobot.core.celery.schedulers:NautobotDatabaseScheduler\"",
            "",
            "# Sets an age out timer of redis lock. This is NOT implicitly applied to locks, must be added",
            "# to a lock creation as `timeout=settings.REDIS_LOCK_TIMEOUT`",
            "REDIS_LOCK_TIMEOUT = int(os.getenv(\"NAUTOBOT_REDIS_LOCK_TIMEOUT\", \"600\"))",
            "",
            "#",
            "# Custom branding (logo and title)",
            "#",
            "",
            "# Branding logo locations. The logo takes the place of the Nautobot logo in the top right of the nav bar.",
            "# The filepath should be relative to the `MEDIA_ROOT`.",
            "BRANDING_FILEPATHS = {",
            "    \"logo\": os.getenv(\"NAUTOBOT_BRANDING_FILEPATHS_LOGO\", None),  # Navbar logo",
            "    \"favicon\": os.getenv(\"NAUTOBOT_BRANDING_FILEPATHS_FAVICON\", None),  # Browser favicon",
            "    \"icon_16\": os.getenv(\"NAUTOBOT_BRANDING_FILEPATHS_ICON_16\", None),  # 16x16px icon",
            "    \"icon_32\": os.getenv(\"NAUTOBOT_BRANDING_FILEPATHS_ICON_32\", None),  # 32x32px icon",
            "    \"icon_180\": os.getenv(",
            "        \"NAUTOBOT_BRANDING_FILEPATHS_ICON_180\", None",
            "    ),  # 180x180px icon - used for the apple-touch-icon header",
            "    \"icon_192\": os.getenv(\"NAUTOBOT_BRANDING_FILEPATHS_ICON_192\", None),  # 192x192px icon",
            "    \"icon_mask\": os.getenv(",
            "        \"NAUTOBOT_BRANDING_FILEPATHS_ICON_MASK\", None",
            "    ),  # mono-chrome icon used for the mask-icon header",
            "    \"header_bullet\": os.getenv(",
            "        \"NAUTOBOT_BRANDING_FILEPATHS_HEADER_BULLET\", None",
            "    ),  # bullet image used for various view headers",
            "    \"nav_bullet\": os.getenv(\"NAUTOBOT_BRANDING_FILEPATHS_NAV_BULLET\", None),  # bullet image used for nav menu headers",
            "}",
            "",
            "# Title to use in place of \"Nautobot\"",
            "BRANDING_TITLE = os.getenv(\"NAUTOBOT_BRANDING_TITLE\", \"Nautobot\")",
            "",
            "# Prepended to CSV, YAML and export template filenames (i.e. `nautobot_device.yml`)",
            "BRANDING_PREPENDED_FILENAME = os.getenv(\"NAUTOBOT_BRANDING_PREPENDED_FILENAME\", \"nautobot_\")",
            "",
            "# Branding URLs (links in the bottom right of the footer)",
            "BRANDING_URLS = {",
            "    \"code\": os.getenv(\"NAUTOBOT_BRANDING_URLS_CODE\", \"https://github.com/nautobot/nautobot\"),",
            "    \"docs\": os.getenv(\"NAUTOBOT_BRANDING_URLS_DOCS\", None),",
            "    \"help\": os.getenv(\"NAUTOBOT_BRANDING_URLS_HELP\", \"https://github.com/nautobot/nautobot/wiki\"),",
            "}",
            "",
            "# Undocumented link in the bottom right of the footer which is meant to persist any custom branding changes.",
            "BRANDING_POWERED_BY_URL = \"https://docs.nautobot.com/\"",
            "",
            "#",
            "# Django extensions settings",
            "#",
            "",
            "# Dont load the 'taggit' app, since we have our own custom `Tag` and `TaggedItem` models",
            "SHELL_PLUS_DONT_LOAD = [\"taggit\"]",
            "",
            "#",
            "# UI settings",
            "#",
            "",
            "",
            "# UI_RACK_VIEW_TRUNCATE_FUNCTION",
            "def UI_RACK_VIEW_TRUNCATE_FUNCTION(device_display_name):",
            "    \"\"\"Given device display name, truncate to fit the rack elevation view.",
            "",
            "    :param device_display_name: Full display name of the device attempting to be rendered in the rack elevation.",
            "    :type device_display_name: str",
            "",
            "    :return: Truncated device name",
            "    :type: str",
            "    \"\"\"",
            "    return str(device_display_name).split(\".\")[0]",
            "",
            "",
            "# Custom JSON schema serializer field type mappingss. These will be added to",
            "# `NautobotProcessingMixin.TYPE_MAP`.",
            "# Format: `{serializer_field_class.__name__}` => `{json_schema_type}`",
            "# See: https://github.com/yoyowallet/drf-react-template-framework#settings",
            "DRF_REACT_TEMPLATE_TYPE_MAP = {",
            "    \"ContentTypeField\": {\"type\": \"string\", \"enum\": \"choices\"},",
            "    \"CustomFieldsDataField\": {\"type\": \"object\", \"widget\": \"textarea\"},",
            "    \"DateTimeField\": {\"type\": \"string\", \"format\": \"date-time\", \"widget\": \"date-time\"},",
            "    \"ImageField\": {\"type\": \"string\", \"format\": \"data-url\"},",
            "    \"IPFieldSerializer\": {\"type\": \"string\"},",
            "    \"JSONField\": {\"type\": \"string\", \"widget\": \"textarea\"},",
            "    \"MultipleChoiceJSONField\": {\"type\": \"array\", \"required\": [], \"enum\": \"choices\"},",
            "    \"ManyRelatedField\": {\"type\": \"array\", \"required\": []},",
            "    #",
            "    # Foreign Key fields",
            "    #",
            "    # enum=choices is the one that works in the UI as a related field but it",
            "    # includes ALL related objects in the schema.",
            "    # \"NautobotHyperlinkedRelatedField\": {\"type\": \"string\", \"enum\": \"choices\"},",
            "    # readOnly=True disables the fields in the UI; not what we want.",
            "    # \"NautobotHyperlinkedRelatedField\": {\"type\": \"string\", \"readOnly\": True},",
            "    # type=string results in a free text field; also not what we want. For now,",
            "    # however, this will keep things moving so the unit tests pass.",
            "    \"NautobotHyperlinkedRelatedField\": {\"type\": \"object\"},",
            "    \"PrimaryKeyRelatedField\": {\"type\": \"string\", \"enum\": \"choices\"},",
            "    \"RelationshipsDataField\": {\"type\": \"object\"},",
            "    \"SlugField\": {\"type\": \"string\"},",
            "    \"TimeZoneSerializerField\": {\"type\": \"string\"},",
            "    \"UUIDField\": {\"type\": \"string\", \"format\": \"uuid\"},",
            "}"
        ],
        "afterPatchFile": [
            "import os",
            "import platform",
            "import re",
            "import sys",
            "",
            "from django.contrib.messages import constants as messages",
            "import django.forms",
            "from django.utils.safestring import mark_safe",
            "",
            "from nautobot import __version__",
            "from nautobot.core.settings_funcs import ConstanceConfigItem, is_truthy, parse_redis_connection",
            "",
            "#",
            "# Environment setup",
            "#",
            "",
            "# This is used for display in the UI. There are also VERSION_MAJOR and VERSION_MINOR derived from this later.",
            "VERSION = __version__",
            "",
            "# Hostname of the system. This is displayed in the web UI footers along with the",
            "# version.",
            "HOSTNAME = platform.node()",
            "",
            "# Set the base directory two levels up (i.e. the base nautobot/ directory)",
            "BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))",
            "",
            "# Set the swapable User model to the Nautobot custom User model",
            "AUTH_USER_MODEL = \"users.User\"",
            "",
            "# Set the default AutoField for 3rd party apps",
            "# N.B. Ideally this would be a `UUIDField`, but due to Django restrictions",
            "#      we can't do that yet",
            "DEFAULT_AUTO_FIELD = \"django.db.models.BigAutoField\"",
            "",
            "",
            "###############################################################",
            "# NAUTOBOT - Settings for Nautobot internals/plugins/defaults #",
            "###############################################################",
            "",
            "#",
            "# Nautobot optional settings/defaults",
            "#",
            "ALLOWED_URL_SCHEMES = (",
            "    \"file\",",
            "    \"ftp\",",
            "    \"ftps\",",
            "    \"http\",",
            "    \"https\",",
            "    \"irc\",",
            "    \"mailto\",",
            "    \"sftp\",",
            "    \"ssh\",",
            "    \"tel\",",
            "    \"telnet\",",
            "    \"tftp\",",
            "    \"vnc\",",
            "    \"xmpp\",",
            ")",
            "",
            "# Base directory wherein all created files (jobs, git repositories, file uploads, static files) will be stored)",
            "NAUTOBOT_ROOT = os.getenv(\"NAUTOBOT_ROOT\", os.path.expanduser(\"~/.nautobot\"))",
            "",
            "# Disable linking of Config Context objects via Dynamic Groups by default. This could cause performance impacts",
            "# when a large number of dynamic groups are present",
            "CONFIG_CONTEXT_DYNAMIC_GROUPS_ENABLED = is_truthy(os.getenv(\"NAUTOBOT_CONFIG_CONTEXT_DYNAMIC_GROUPS_ENABLED\", \"False\"))",
            "",
            "# Exclude potentially sensitive models from wildcard view exemption. These may still be exempted",
            "# by specifying the model individually in the EXEMPT_VIEW_PERMISSIONS configuration parameter.",
            "EXEMPT_EXCLUDE_MODELS = (",
            "    (\"auth\", \"group\"),",
            "    (\"users\", \"user\"),",
            "    (\"users\", \"objectpermission\"),",
            ")",
            "",
            "# Models to exempt from the enforcement of view permissions",
            "EXEMPT_VIEW_PERMISSIONS = []",
            "",
            "# The file path to a directory where cloned Git repositories will be located",
            "GIT_ROOT = os.getenv(\"NAUTOBOT_GIT_ROOT\", os.path.join(NAUTOBOT_ROOT, \"git\").rstrip(\"/\"))",
            "",
            "# HTTP proxies to use for outbound requests originating from Nautobot (e.g. when sending webhook requests)",
            "HTTP_PROXIES = None",
            "",
            "# Send anonymized installation metrics when post_upgrade or send_installation_metrics management commands are run",
            "INSTALLATION_METRICS_ENABLED = is_truthy(os.getenv(\"NAUTOBOT_INSTALLATION_METRICS_ENABLED\", \"True\"))",
            "",
            "# The storage backend to use for Job input files and Job output files",
            "JOB_FILE_IO_STORAGE = os.getenv(\"NAUTOBOT_JOB_FILE_IO_STORAGE\", \"db_file_storage.storage.DatabaseFileStorage\")",
            "",
            "# The file path to a directory where locally installed Jobs can be discovered",
            "JOBS_ROOT = os.getenv(\"NAUTOBOT_JOBS_ROOT\", os.path.join(NAUTOBOT_ROOT, \"jobs\").rstrip(\"/\"))",
            "",
            "# Log Nautobot deprecation warnings. Note that this setting is ignored (deprecation logs always enabled) if DEBUG = True",
            "LOG_DEPRECATION_WARNINGS = is_truthy(os.getenv(\"NAUTOBOT_LOG_DEPRECATION_WARNINGS\", \"False\"))",
            "",
            "MAINTENANCE_MODE = is_truthy(os.getenv(\"NAUTOBOT_MAINTENANCE_MODE\", \"False\"))",
            "# Metrics",
            "METRICS_ENABLED = is_truthy(os.getenv(\"NAUTOBOT_METRICS_ENABLED\", \"False\"))",
            "",
            "# Napalm",
            "NAPALM_ARGS = {}",
            "NAPALM_PASSWORD = os.getenv(\"NAUTOBOT_NAPALM_PASSWORD\", \"\")",
            "NAPALM_TIMEOUT = int(os.getenv(\"NAUTOBOT_NAPALM_TIMEOUT\", \"30\"))",
            "NAPALM_USERNAME = os.getenv(\"NAUTOBOT_NAPALM_USERNAME\", \"\")",
            "",
            "# Plugins",
            "PLUGINS = []",
            "PLUGINS_CONFIG = {}",
            "",
            "# Global 3rd-party authentication settings",
            "EXTERNAL_AUTH_DEFAULT_GROUPS = []",
            "EXTERNAL_AUTH_DEFAULT_PERMISSIONS = {}",
            "",
            "# Remote auth backend settings",
            "REMOTE_AUTH_AUTO_CREATE_USER = False",
            "REMOTE_AUTH_HEADER = \"HTTP_REMOTE_USER\"",
            "",
            "# SSO backend settings https://python-social-auth.readthedocs.io/en/latest/configuration/settings.html",
            "SOCIAL_AUTH_POSTGRES_JSONFIELD = False",
            "# Nautobot related - May be overridden if using custom social auth backend",
            "SOCIAL_AUTH_BACKEND_PREFIX = \"social_core.backends\"",
            "",
            "# Job log entry sanitization and similar",
            "SANITIZER_PATTERNS = [",
            "    # General removal of username-like and password-like tokens",
            "    (re.compile(r\"(https?://)?\\S+\\s*@\", re.IGNORECASE), r\"\\1{replacement}@\"),",
            "    (",
            "        re.compile(r\"(username|password|passwd|pwd|secret|secrets)([\\\"']?(?:\\s+is.?|:)?\\s+)\\S+[\\\"']?\", re.IGNORECASE),",
            "        r\"\\1\\2{replacement}\",",
            "    ),",
            "]",
            "",
            "# Storage",
            "STORAGE_BACKEND = None",
            "STORAGE_CONFIG = {}",
            "",
            "# Test runner that is aware of our use of \"integration\" tags and only runs",
            "# integration tests if explicitly passed in with `nautobot-server test --tag integration`.",
            "TEST_RUNNER = \"nautobot.core.tests.runner.NautobotTestRunner\"",
            "# Disable test data factories by default so as not to cause issues for plugins.",
            "# The nautobot_config.py that Nautobot core uses for its own tests will override this to True.",
            "TEST_USE_FACTORIES = is_truthy(os.getenv(\"NAUTOBOT_TEST_USE_FACTORIES\", \"False\"))",
            "# Pseudo-random number generator seed, for reproducibility of test results.",
            "TEST_FACTORY_SEED = os.getenv(\"NAUTOBOT_TEST_FACTORY_SEED\", None)",
            "",
            "#",
            "# django-slowtests",
            "#",
            "",
            "# Performance test uses `NautobotPerformanceTestRunner` to run, which is only available once you have `django-slowtests` installed in your dev environment.",
            "# `invoke performance-test` and adding `--performance-report` or `--performance-snapshot` at the end of the `invoke` command",
            "# will automatically opt to NautobotPerformanceTestRunner to run the tests.",
            "",
            "# The baseline file that the performance test is running against",
            "# TODO we need to replace the baselines in this file with more consistent results at least for CI",
            "TEST_PERFORMANCE_BASELINE_FILE = os.getenv(",
            "    \"NAUTOBOT_TEST_PERFORMANCE_BASELINE_FILE\", \"nautobot/core/tests/performance_baselines.yml\"",
            ")",
            "",
            "#",
            "# Django Prometheus",
            "#",
            "",
            "PROMETHEUS_EXPORT_MIGRATIONS = False",
            "",
            "",
            "#",
            "# Django filters",
            "#",
            "",
            "FILTERS_NULL_CHOICE_LABEL = \"None\"",
            "FILTERS_NULL_CHOICE_VALUE = \"null\"",
            "",
            "STRICT_FILTERING = is_truthy(os.getenv(\"NAUTOBOT_STRICT_FILTERING\", \"True\"))",
            "",
            "#",
            "# Django REST framework (API)",
            "#",
            "",
            "REST_FRAMEWORK_VERSION = VERSION.rsplit(\".\", 1)[0]  # Use major.minor as API version",
            "VERSION_MAJOR, VERSION_MINOR = [int(v) for v in REST_FRAMEWORK_VERSION.split(\".\")]",
            "# We support all major.minor API versions from 2.0 to the present latest version.",
            "# Similar logic exists in tasks.py, please keep them in sync!",
            "if VERSION_MAJOR != 2:",
            "    raise RuntimeError(f\"REST_FRAMEWORK_ALLOWED_VERSIONS needs to be updated to handle version {VERSION_MAJOR}\")",
            "REST_FRAMEWORK_ALLOWED_VERSIONS = [f\"{VERSION_MAJOR}.{minor}\" for minor in range(0, VERSION_MINOR + 1)]",
            "",
            "REST_FRAMEWORK = {",
            "    \"ALLOWED_VERSIONS\": REST_FRAMEWORK_ALLOWED_VERSIONS,",
            "    \"DEFAULT_AUTHENTICATION_CLASSES\": (",
            "        \"rest_framework.authentication.SessionAuthentication\",",
            "        \"nautobot.core.api.authentication.TokenAuthentication\",",
            "    ),",
            "    \"DEFAULT_FILTER_BACKENDS\": (",
            "        \"nautobot.core.api.filter_backends.NautobotFilterBackend\",",
            "        \"rest_framework.filters.OrderingFilter\",",
            "    ),",
            "    \"DEFAULT_METADATA_CLASS\": \"nautobot.core.api.metadata.NautobotMetadata\",",
            "    \"DEFAULT_PAGINATION_CLASS\": \"nautobot.core.api.pagination.OptionalLimitOffsetPagination\",",
            "    \"DEFAULT_PERMISSION_CLASSES\": (\"nautobot.core.api.authentication.TokenPermissions\",),",
            "    \"DEFAULT_RENDERER_CLASSES\": (",
            "        \"nautobot.core.api.renderers.NautobotJSONRenderer\",",
            "        \"nautobot.core.api.renderers.FormlessBrowsableAPIRenderer\",",
            "        \"nautobot.core.api.renderers.NautobotCSVRenderer\",",
            "    ),",
            "    \"DEFAULT_PARSER_CLASSES\": (",
            "        \"rest_framework.parsers.JSONParser\",",
            "        \"nautobot.core.api.parsers.NautobotCSVParser\",",
            "    ),",
            "    \"DEFAULT_SCHEMA_CLASS\": \"nautobot.core.api.schema.NautobotAutoSchema\",",
            "    # Version to use if the client doesn't request otherwise. Default to current (i.e. latest)",
            "    \"DEFAULT_VERSION\": REST_FRAMEWORK_VERSION,",
            "    \"DEFAULT_VERSIONING_CLASS\": \"nautobot.core.api.versioning.NautobotAPIVersioning\",",
            "    \"ORDERING_PARAM\": \"sort\",  # This is not meant to be changed by users, but is used internally by the API",
            "    \"PAGE_SIZE\": None,",
            "    \"SCHEMA_COERCE_METHOD_NAMES\": {",
            "        # Default mappings",
            "        \"retrieve\": \"read\",",
            "        \"destroy\": \"delete\",",
            "        # Custom operations",
            "        \"bulk_destroy\": \"bulk_delete\",",
            "    },",
            "    \"VIEW_NAME_FUNCTION\": \"nautobot.core.api.utils.get_view_name\",",
            "}",
            "",
            "",
            "#",
            "# drf_spectacular (OpenAPI/Swagger)",
            "#",
            "",
            "SPECTACULAR_SETTINGS = {",
            "    \"TITLE\": \"API Documentation\",",
            "    \"DESCRIPTION\": \"Source of truth and network automation platform\",",
            "    \"LICENSE\": {\"name\": \"Apache v2 License\"},",
            "    \"VERSION\": VERSION,",
            "    # For a semblance of backwards-compatibility with drf-yasg / OpenAPI 2.0, where \"/api\" was a common \"basePath\"",
            "    # in the schema.",
            "    # OpenAPI 3.0 removes \"basePath\" in favor of \"servers\", so we now declare \"/api\" as the server relative URL and",
            "    # trim it from all of the individual paths correspondingly.",
            "    # See also https://github.com/nautobot/nautobot-ansible/pull/135 for an example of why this is desirable.",
            "    \"SERVERS\": [{\"url\": \"/api\"}],",
            "    \"SCHEMA_PATH_PREFIX\": \"/api\",",
            "    \"SCHEMA_PATH_PREFIX_TRIM\": True,",
            "    # use sidecar - locally packaged UI files, not CDN",
            "    \"SWAGGER_UI_DIST\": \"SIDECAR\",",
            "    \"SWAGGER_UI_FAVICON_HREF\": \"SIDECAR\",",
            "    \"SWAGGER_UI_SETTINGS\": {",
            "        \"deepLinking\": True,",
            "        \"displayOperationId\": True,",
            "    },",
            "    \"REDOC_DIST\": \"SIDECAR\",",
            "    # Do not list all possible enum values in the description of filter fields and the like",
            "    # In addition to being highly verbose, it's inaccurate for filter fields like *__ic and *__re",
            "    \"ENUM_GENERATE_CHOICE_DESCRIPTION\": False,",
            "    \"ENUM_NAME_OVERRIDES\": {",
            "        # These choice enums need to be overridden because they get assigned to the `type` field and",
            "        # result in this error:",
            "        #    enum naming encountered a non-optimally resolvable collision for fields named \"type\".",
            "        \"CableTypeChoices\": \"nautobot.dcim.choices.CableTypeChoices\",",
            "        \"ConsolePortTypeChoices\": \"nautobot.dcim.choices.ConsolePortTypeChoices\",",
            "        \"CustomFieldTypeChoices\": \"nautobot.extras.choices.CustomFieldTypeChoices\",",
            "        \"InterfaceTypeChoices\": \"nautobot.dcim.choices.InterfaceTypeChoices\",",
            "        \"IPAddressTypeChoices\": \"nautobot.ipam.choices.IPAddressTypeChoices\",",
            "        \"PortTypeChoices\": \"nautobot.dcim.choices.PortTypeChoices\",",
            "        \"PowerFeedTypeChoices\": \"nautobot.dcim.choices.PowerFeedTypeChoices\",",
            "        \"PowerOutletTypeChoices\": \"nautobot.dcim.choices.PowerOutletTypeChoices\",",
            "        \"PowerPortTypeChoices\": \"nautobot.dcim.choices.PowerPortTypeChoices\",",
            "        \"PrefixTypeChoices\": \"nautobot.ipam.choices.PrefixTypeChoices\",",
            "        \"RackTypeChoices\": \"nautobot.dcim.choices.RackTypeChoices\",",
            "        \"RelationshipTypeChoices\": \"nautobot.extras.choices.RelationshipTypeChoices\",",
            "        # These choice enums need to be overridden because they get assigned to different names with the same choice set and",
            "        # result in this error:",
            "        #   encountered multiple names for the same choice set",
            "        \"JobExecutionTypeIntervalChoices\": \"nautobot.extras.choices.JobExecutionType\",",
            "        # These choice enums need to be overridden because they get assigned to the `protocol` field and",
            "        # result in this error:",
            "        #    enum naming encountered a non-optimally resolvable collision for fields named \"protocol\".",
            "        \"InterfaceRedundancyGroupProtocolChoices\": \"nautobot.dcim.choices.InterfaceRedundancyGroupProtocolChoices\",",
            "        \"ServiceProtocolChoices\": \"nautobot.ipam.choices.ServiceProtocolChoices\",",
            "    },",
            "    # Create separate schema components for PATCH requests (fields generally are not `required` on PATCH)",
            "    \"COMPONENT_SPLIT_PATCH\": True,",
            "    # Create separate schema components for request vs response where appropriate",
            "    \"COMPONENT_SPLIT_REQUEST\": True,",
            "}",
            "",
            "",
            "##############################################",
            "# DJANGO - Core settings required for Django #",
            "##############################################",
            "",
            "#",
            "# Databases",
            "#",
            "",
            "# Only PostgresSQL is supported, so database driver is hard-coded. This can",
            "# still be overloaded in custom settings.",
            "# https://docs.djangoproject.com/en/stable/ref/settings/#databases",
            "DATABASES = {",
            "    \"default\": {",
            "        \"NAME\": os.getenv(\"NAUTOBOT_DB_NAME\", \"nautobot\"),",
            "        \"USER\": os.getenv(\"NAUTOBOT_DB_USER\", \"\"),",
            "        \"PASSWORD\": os.getenv(\"NAUTOBOT_DB_PASSWORD\", \"\"),",
            "        \"HOST\": os.getenv(\"NAUTOBOT_DB_HOST\", \"localhost\"),",
            "        \"PORT\": os.getenv(\"NAUTOBOT_DB_PORT\", \"\"),",
            "        \"CONN_MAX_AGE\": int(os.getenv(\"NAUTOBOT_DB_TIMEOUT\", \"300\")),",
            "        \"ENGINE\": os.getenv(",
            "            \"NAUTOBOT_DB_ENGINE\",",
            "            \"django_prometheus.db.backends.postgresql\" if METRICS_ENABLED else \"django.db.backends.postgresql\",",
            "        ),",
            "    }",
            "}",
            "",
            "# Ensure proper Unicode handling for MySQL",
            "if DATABASES[\"default\"][\"ENGINE\"] == \"django.db.backends.mysql\":",
            "    DATABASES[\"default\"][\"OPTIONS\"] = {\"charset\": \"utf8mb4\"}",
            "",
            "# The secret key is used to encrypt session keys and salt passwords.",
            "SECRET_KEY = os.getenv(\"NAUTOBOT_SECRET_KEY\")",
            "",
            "# Default overrides",
            "ALLOWED_HOSTS = os.getenv(\"NAUTOBOT_ALLOWED_HOSTS\", \"\").split(\" \")",
            "CSRF_TRUSTED_ORIGINS = []",
            "CSRF_FAILURE_VIEW = \"nautobot.core.views.csrf_failure\"",
            "DATE_FORMAT = os.getenv(\"NAUTOBOT_DATE_FORMAT\", \"N j, Y\")",
            "DATETIME_FORMAT = os.getenv(\"NAUTOBOT_DATETIME_FORMAT\", \"N j, Y g:i a\")",
            "DEBUG = is_truthy(os.getenv(\"NAUTOBOT_DEBUG\", \"False\"))",
            "INTERNAL_IPS = (\"127.0.0.1\", \"::1\")",
            "FORCE_SCRIPT_NAME = None",
            "",
            "TESTING = \"test\" in sys.argv",
            "",
            "LOG_LEVEL = \"DEBUG\" if DEBUG else \"INFO\"",
            "",
            "if TESTING:",
            "    # Log to null handler instead of stderr during testing",
            "    LOGGING = {",
            "        \"version\": 1,",
            "        \"disable_existing_loggers\": False,",
            "        \"handlers\": {\"console\": {\"level\": \"INFO\", \"class\": \"logging.NullHandler\"}},",
            "        \"loggers\": {\"nautobot\": {\"handlers\": [\"console\"], \"level\": \"INFO\"}},",
            "    }",
            "else:",
            "    LOGGING = {",
            "        \"version\": 1,",
            "        \"disable_existing_loggers\": False,",
            "        \"formatters\": {",
            "            \"normal\": {",
            "                \"format\": \"%(asctime)s.%(msecs)03d %(levelname)-7s %(name)s :\\n  %(message)s\",",
            "                \"datefmt\": \"%H:%M:%S\",",
            "            },",
            "            \"verbose\": {",
            "                \"format\": \"%(asctime)s.%(msecs)03d %(levelname)-7s %(name)-20s %(filename)-15s %(funcName)30s() :\\n  %(message)s\",",
            "                \"datefmt\": \"%H:%M:%S\",",
            "            },",
            "        },",
            "        \"handlers\": {",
            "            \"normal_console\": {",
            "                \"level\": \"INFO\",",
            "                \"class\": \"logging.StreamHandler\",",
            "                \"formatter\": \"normal\",",
            "            },",
            "            \"verbose_console\": {",
            "                \"level\": \"DEBUG\",",
            "                \"class\": \"logging.StreamHandler\",",
            "                \"formatter\": \"verbose\",",
            "            },",
            "        },",
            "        \"loggers\": {",
            "            \"django\": {\"handlers\": [\"normal_console\"], \"level\": \"INFO\"},",
            "            \"nautobot\": {",
            "                \"handlers\": [\"verbose_console\" if DEBUG else \"normal_console\"],",
            "                \"level\": LOG_LEVEL,",
            "            },",
            "        },",
            "    }",
            "",
            "MEDIA_ROOT = os.path.join(NAUTOBOT_ROOT, \"media\").rstrip(\"/\")",
            "SESSION_EXPIRE_AT_BROWSER_CLOSE = is_truthy(os.getenv(\"NAUTOBOT_SESSION_EXPIRE_AT_BROWSER_CLOSE\", \"False\"))",
            "SESSION_COOKIE_AGE = int(os.getenv(\"NAUTOBOT_SESSION_COOKIE_AGE\", \"1209600\"))  # 2 weeks, in seconds",
            "SESSION_FILE_PATH = os.getenv(\"NAUTOBOT_SESSION_FILE_PATH\", None)",
            "SHORT_DATE_FORMAT = os.getenv(\"NAUTOBOT_SHORT_DATE_FORMAT\", \"Y-m-d\")",
            "SHORT_DATETIME_FORMAT = os.getenv(\"NAUTOBOT_SHORT_DATETIME_FORMAT\", \"Y-m-d H:i\")",
            "SHORT_TIME_FORMAT = os.getenv(\"NAUTOBOT_SHORT_TIME_FORMAT\", \"H:i:s\")",
            "TIME_FORMAT = os.getenv(\"NAUTOBOT_TIME_FORMAT\", \"g:i a\")",
            "TIME_ZONE = os.getenv(\"NAUTOBOT_TIME_ZONE\", \"UTC\")",
            "",
            "# Disable importing the WSGI module before starting the server application. This is required for",
            "# uWSGI postfork callbacks to execute as is currently required in `nautobot.core.wsgi`.",
            "WEBSERVER_WARMUP = False",
            "",
            "# Installed apps and Django plugins. Nautobot plugins will be appended here later.",
            "INSTALLED_APPS = [",
            "    \"django.contrib.auth\",",
            "    \"django.contrib.contenttypes\",",
            "    \"django.contrib.sessions\",",
            "    \"django.contrib.messages\",",
            "    \"django.contrib.staticfiles\",",
            "    \"django.contrib.humanize\",",
            "    \"corsheaders\",",
            "    \"django_filters\",",
            "    \"django_jinja\",",
            "    \"django_tables2\",",
            "    \"django_prometheus\",",
            "    \"social_django\",",
            "    \"taggit\",",
            "    \"timezone_field\",",
            "    \"nautobot.core.apps.NautobotConstanceConfig\",  # overridden form of \"constance\" AppConfig",
            "    \"nautobot.core\",",
            "    \"django.contrib.admin\",  # Must be after `nautobot.core` for template overrides",
            "    \"django_celery_beat\",  # Must be after `nautobot.core` for template overrides",
            "    \"django_celery_results\",",
            "    \"rest_framework\",  # Must be after `nautobot.core` for template overrides",
            "    \"db_file_storage\",",
            "    \"nautobot.circuits\",",
            "    \"nautobot.dcim\",",
            "    \"nautobot.ipam\",",
            "    \"nautobot.extras\",",
            "    \"nautobot.tenancy\",",
            "    \"nautobot.users\",",
            "    \"nautobot.virtualization\",",
            "    \"drf_spectacular\",",
            "    \"drf_spectacular_sidecar\",",
            "    \"graphene_django\",",
            "    \"health_check\",",
            "    \"health_check.storage\",",
            "    \"django_extensions\",",
            "    \"constance.backends.database\",",
            "    \"django_ajax_tables\",",
            "]",
            "",
            "# Middleware",
            "MIDDLEWARE = [",
            "    \"django_prometheus.middleware.PrometheusBeforeMiddleware\",",
            "    \"corsheaders.middleware.CorsMiddleware\",",
            "    \"django.contrib.sessions.middleware.SessionMiddleware\",",
            "    \"django.middleware.common.CommonMiddleware\",",
            "    \"django.middleware.csrf.CsrfViewMiddleware\",",
            "    \"django.contrib.auth.middleware.AuthenticationMiddleware\",",
            "    \"django.contrib.messages.middleware.MessageMiddleware\",",
            "    \"django.middleware.clickjacking.XFrameOptionsMiddleware\",",
            "    \"django.middleware.security.SecurityMiddleware\",",
            "    \"nautobot.core.middleware.ExceptionHandlingMiddleware\",",
            "    \"nautobot.core.middleware.RemoteUserMiddleware\",",
            "    \"nautobot.core.middleware.ExternalAuthMiddleware\",",
            "    \"nautobot.core.middleware.ObjectChangeMiddleware\",",
            "    \"django_prometheus.middleware.PrometheusAfterMiddleware\",",
            "]",
            "",
            "ROOT_URLCONF = \"nautobot.core.urls\"",
            "",
            "TEMPLATES = [",
            "    {",
            "        \"NAME\": \"django\",",
            "        \"BACKEND\": \"django.template.backends.django.DjangoTemplates\",",
            "        \"DIRS\": [],",
            "        \"APP_DIRS\": True,",
            "        \"OPTIONS\": {",
            "            \"context_processors\": [",
            "                \"django.template.context_processors.debug\",",
            "                \"django.template.context_processors.request\",",
            "                \"django.template.context_processors.media\",",
            "                \"django.contrib.auth.context_processors.auth\",",
            "                \"django.contrib.messages.context_processors.messages\",",
            "                \"social_django.context_processors.backends\",",
            "                \"social_django.context_processors.login_redirect\",",
            "                \"nautobot.core.context_processors.settings\",",
            "                \"nautobot.core.context_processors.sso_auth\",",
            "            ],",
            "        },",
            "    },",
            "    {",
            "        \"NAME\": \"jinja\",",
            "        \"BACKEND\": \"django_jinja.backend.Jinja2\",",
            "        \"DIRS\": [],",
            "        \"APP_DIRS\": False,",
            "        \"OPTIONS\": {",
            "            \"context_processors\": [",
            "                \"django.template.context_processors.debug\",",
            "                \"django.template.context_processors.request\",",
            "                \"django.template.context_processors.media\",",
            "                \"django.contrib.auth.context_processors.auth\",",
            "                \"django.contrib.messages.context_processors.messages\",",
            "                \"social_django.context_processors.backends\",",
            "                \"social_django.context_processors.login_redirect\",",
            "                \"nautobot.core.context_processors.settings\",",
            "                \"nautobot.core.context_processors.sso_auth\",",
            "            ],",
            "            \"environment\": \"jinja2.sandbox.SandboxedEnvironment\",",
            "        },",
            "    },",
            "]",
            "",
            "# Set up authentication backends",
            "AUTHENTICATION_BACKENDS = [",
            "    # Always check object permissions",
            "    \"nautobot.core.authentication.ObjectPermissionBackend\",",
            "]",
            "",
            "# Internationalization",
            "LANGUAGE_CODE = \"en-us\"",
            "USE_I18N = True",
            "USE_TZ = True",
            "",
            "# WSGI",
            "WSGI_APPLICATION = \"nautobot.core.wsgi.application\"",
            "SECURE_PROXY_SSL_HEADER = (\"HTTP_X_FORWARDED_PROTO\", \"https\")",
            "USE_X_FORWARDED_HOST = True",
            "X_FRAME_OPTIONS = \"DENY\"",
            "",
            "# Static files (CSS, JavaScript, Images)",
            "STATIC_ROOT = os.path.join(NAUTOBOT_ROOT, \"static\")",
            "STATIC_URL = \"static/\"",
            "STATICFILES_DIRS = (os.path.join(BASE_DIR, \"project-static\"),)",
            "",
            "# Media",
            "MEDIA_URL = \"media/\"",
            "",
            "# Disable default limit of 1000 fields per request. Needed for bulk deletion of objects. (Added in Django 1.10.)",
            "DATA_UPLOAD_MAX_NUMBER_FIELDS = None",
            "",
            "# Messages",
            "MESSAGE_TAGS = {",
            "    messages.ERROR: \"danger\",",
            "}",
            "",
            "# Authentication URLs",
            "# This is the URL route name for the login view.",
            "LOGIN_URL = \"login\"",
            "",
            "# This is the URL route name for the home page (index) view.",
            "LOGIN_REDIRECT_URL = \"home\"",
            "",
            "#",
            "# django-constance",
            "#",
            "",
            "CONSTANCE_BACKEND = \"constance.backends.database.DatabaseBackend\"",
            "CONSTANCE_DATABASE_PREFIX = \"constance:nautobot:\"",
            "CONSTANCE_DATABASE_CACHE_BACKEND = \"default\"",
            "CONSTANCE_IGNORE_ADMIN_VERSION_CHECK = True  # avoid potential errors in a multi-node deployment",
            "",
            "CONSTANCE_ADDITIONAL_FIELDS = {",
            "    \"per_page_defaults_field\": [",
            "        \"nautobot.core.forms.fields.JSONArrayFormField\",",
            "        {",
            "            \"widget\": \"django.forms.TextInput\",",
            "            \"base_field\": django.forms.IntegerField(min_value=1),",
            "        },",
            "    ],",
            "    \"release_check_timeout_field\": [",
            "        \"django.forms.IntegerField\",",
            "        {",
            "            \"min_value\": 3600,",
            "        },",
            "    ],",
            "    \"release_check_url_field\": [",
            "        \"django.forms.URLField\",",
            "        {",
            "            \"required\": False,",
            "        },",
            "    ],",
            "    \"optional_json_field\": [",
            "        \"django.forms.fields.JSONField\",",
            "        {",
            "            \"required\": False,",
            "        },",
            "    ],",
            "}",
            "",
            "CONSTANCE_CONFIG = {",
            "    \"BANNER_BOTTOM\": ConstanceConfigItem(",
            "        default=\"\",",
            "        help_text=\"Custom HTML to display in a banner at the bottom of all pages.\",",
            "    ),",
            "    \"BANNER_LOGIN\": ConstanceConfigItem(",
            "        default=\"\",",
            "        help_text=\"Custom HTML to display in a banner at the top of the login page.\",",
            "    ),",
            "    \"BANNER_TOP\": ConstanceConfigItem(",
            "        default=\"\",",
            "        help_text=\"Custom HTML to display in a banner at the top of all pages.\",",
            "    ),",
            "    \"CHANGELOG_RETENTION\": ConstanceConfigItem(",
            "        default=90,",
            "        help_text=\"Number of days to retain object changelog history.\\nSet this to 0 to retain changes indefinitely.\",",
            "        field_type=int,",
            "    ),",
            "    \"DEVICE_NAME_AS_NATURAL_KEY\": ConstanceConfigItem(",
            "        default=False,",
            "        help_text=\"Device names are not guaranteed globally-unique by Nautobot but in practice they often are. \"",
            "        \"Set this to True to use the device name alone as the natural key for Device objects. \"",
            "        \"Set this to False to use the sequence (name, tenant, location) as the natural key instead.\",",
            "        field_type=bool,",
            "    ),",
            "    \"DEPLOYMENT_ID\": ConstanceConfigItem(",
            "        default=\"\",",
            "        help_text=\"Randomly generated UUID used to identify this installation.\\n\"",
            "        \"Used for sending anonymous installation metrics, when settings.INSTALLATION_METRICS_ENABLED is set to True.\",",
            "        field_type=str,",
            "    ),",
            "    \"DYNAMIC_GROUPS_MEMBER_CACHE_TIMEOUT\": ConstanceConfigItem(",
            "        default=0,",
            "        help_text=\"Dynamic Group member cache timeout in seconds. This is the amount of time that a Dynamic Group's member list \"",
            "        \"will be cached in Django cache backend. Since retrieving the member list of a Dynamic Group can be a very \"",
            "        \"expensive operation, especially in reverse, this cache is used to speed up the process of retrieving the \"",
            "        \"member list. This cache is invalidated when a Dynamic Group is saved. Set to 0 to disable caching.\",",
            "        field_type=int,",
            "    ),",
            "    \"JOB_CREATE_FILE_MAX_SIZE\": ConstanceConfigItem(",
            "        default=10 << 20,",
            "        help_text=mark_safe(  # noqa: S308  # suspicious-mark-safe-usage, but this is a static string so it's safe",
            "            \"Maximum size (in bytes) of any single file generated by a <code>Job.create_file()</code> call.\"",
            "        ),",
            "        field_type=int,",
            "    ),",
            "    \"LOCATION_NAME_AS_NATURAL_KEY\": ConstanceConfigItem(",
            "        default=False,",
            "        help_text=\"Location names are not guaranteed globally-unique by Nautobot but in practice they often are. \"",
            "        \"Set this to True to use the location name alone as the natural key for Location objects. \"",
            "        \"Set this to False to use the sequence (name, parent__name, parent__parent__name, ...) \"",
            "        \"as the natural key instead.\",",
            "        field_type=bool,",
            "    ),",
            "    \"MAX_PAGE_SIZE\": ConstanceConfigItem(",
            "        default=1000,",
            "        help_text=\"Maximum number of objects that a user can list in one UI page or one API call.\\n\"",
            "        \"If set to 0, a user can retrieve an unlimited number of objects.\",",
            "        field_type=int,",
            "    ),",
            "    \"PAGINATE_COUNT\": ConstanceConfigItem(",
            "        default=50,",
            "        help_text=\"Default number of objects to display per page when listing objects in the UI and/or REST API.\",",
            "        field_type=int,",
            "    ),",
            "    \"PER_PAGE_DEFAULTS\": ConstanceConfigItem(",
            "        default=[25, 50, 100, 250, 500, 1000],",
            "        help_text=\"Pagination options to present to the user to choose amongst.\\n\"",
            "        \"For proper user experience, this list should include the PAGINATE_COUNT and MAX_PAGE_SIZE values as options.\",",
            "        # Use custom field type defined above",
            "        field_type=\"per_page_defaults_field\",",
            "    ),",
            "    \"NETWORK_DRIVERS\": ConstanceConfigItem(",
            "        default={},",
            "        help_text=mark_safe(  # noqa: S308  # suspicious-mark-safe-usage, but this is a static string so it's safe",
            "            \"Extend or override default Platform.network_driver translations provided by \"",
            "            '<a href=\"https://netutils.readthedocs.io/en/latest/user/lib_use_cases_lib_mapper/\">netutils</a>. '",
            "            \"Enter a dictionary in JSON format, for example:\\n\"",
            "            \"<pre>{\\n\"",
            "            '    \"netmiko\": {\"my_network_driver\": \"cisco_ios\"},\\n'",
            "            '    \"pyats\": {\"my_network_driver\": \"iosxe\"} \\n'",
            "            \"}</pre>\",",
            "        ),",
            "        # Use custom field type defined above",
            "        field_type=\"optional_json_field\",",
            "    ),",
            "    \"PREFER_IPV4\": ConstanceConfigItem(",
            "        default=False,",
            "        help_text=\"Whether to prefer IPv4 primary addresses over IPv6 primary addresses for devices.\",",
            "        field_type=bool,",
            "    ),",
            "    \"RACK_ELEVATION_DEFAULT_UNIT_HEIGHT\": ConstanceConfigItem(",
            "        default=22, help_text=\"Default height (in pixels) of a rack unit in a rack elevation diagram\", field_type=int",
            "    ),",
            "    \"RACK_ELEVATION_DEFAULT_UNIT_WIDTH\": ConstanceConfigItem(",
            "        default=230, help_text=\"Default width (in pixels) of a rack unit in a rack elevation diagram\", field_type=int",
            "    ),",
            "    \"RELEASE_CHECK_TIMEOUT\": ConstanceConfigItem(",
            "        default=24 * 3600,",
            "        help_text=\"Number of seconds (must be at least 3600, or one hour) to cache the result of a release check \"",
            "        \"before checking again for a new release.\",",
            "        # Use custom field type defined above",
            "        field_type=\"release_check_timeout_field\",",
            "    ),",
            "    \"RELEASE_CHECK_URL\": ConstanceConfigItem(",
            "        default=\"\",",
            "        help_text=\"URL of GitHub repository REST API endpoint to poll periodically for availability of new Nautobot releases.\\n\"",
            "        'This can be set to the official repository \"https://api.github.com/repos/nautobot/nautobot/releases\" or '",
            "        \"a custom fork.\\nSet this to an empty string to disable automatic update checks.\",",
            "        # Use custom field type defined above",
            "        field_type=\"release_check_url_field\",",
            "    ),",
            "    \"SUPPORT_MESSAGE\": ConstanceConfigItem(",
            "        default=\"\",",
            "        help_text=\"Help message to include on 4xx and 5xx error pages. \"",
            "        \"Markdown is supported, as are some HTML tags and attributes.\\n\"",
            "        \"If unspecified, instructions to join Network to Code's Slack community will be provided.\",",
            "    ),",
            "}",
            "",
            "CONSTANCE_CONFIG_FIELDSETS = {",
            "    \"Banners\": [\"BANNER_LOGIN\", \"BANNER_TOP\", \"BANNER_BOTTOM\"],",
            "    \"Change Logging\": [\"CHANGELOG_RETENTION\"],",
            "    \"Device Connectivity\": [\"NETWORK_DRIVERS\", \"PREFER_IPV4\"],",
            "    \"Installation Metrics\": [\"DEPLOYMENT_ID\"],",
            "    \"Natural Keys\": [\"DEVICE_NAME_AS_NATURAL_KEY\", \"LOCATION_NAME_AS_NATURAL_KEY\"],",
            "    \"Pagination\": [\"PAGINATE_COUNT\", \"MAX_PAGE_SIZE\", \"PER_PAGE_DEFAULTS\"],",
            "    \"Performance\": [\"DYNAMIC_GROUPS_MEMBER_CACHE_TIMEOUT\", \"JOB_CREATE_FILE_MAX_SIZE\"],",
            "    \"Rack Elevation Rendering\": [\"RACK_ELEVATION_DEFAULT_UNIT_HEIGHT\", \"RACK_ELEVATION_DEFAULT_UNIT_WIDTH\"],",
            "    \"Release Checking\": [\"RELEASE_CHECK_URL\", \"RELEASE_CHECK_TIMEOUT\"],",
            "    \"User Interface\": [\"SUPPORT_MESSAGE\"],",
            "}",
            "",
            "#",
            "# From django-cors-headers",
            "#",
            "",
            "# If True, all origins will be allowed. Other settings restricting allowed origins will be ignored.",
            "# Defaults to False. Setting this to True can be dangerous, as it allows any website to make",
            "# cross-origin requests to yours. Generally you'll want to restrict the list of allowed origins with",
            "# CORS_ALLOWED_ORIGINS or CORS_ALLOWED_ORIGIN_REGEXES.",
            "CORS_ALLOW_ALL_ORIGINS = is_truthy(os.getenv(\"NAUTOBOT_CORS_ALLOW_ALL_ORIGINS\", \"False\"))",
            "",
            "# A list of strings representing regexes that match Origins that are authorized to make cross-site",
            "# HTTP requests. Defaults to [].",
            "CORS_ALLOWED_ORIGIN_REGEXES = []",
            "",
            "# A list of origins that are authorized to make cross-site HTTP requests. Defaults to [].",
            "CORS_ALLOWED_ORIGINS = []",
            "",
            "#",
            "# GraphQL",
            "#",
            "",
            "GRAPHENE = {",
            "    \"SCHEMA\": \"nautobot.core.graphql.schema_init.schema\",",
            "    \"DJANGO_CHOICE_FIELD_ENUM_V3_NAMING\": True,  # any field with a name of type will break in Graphene otherwise.",
            "}",
            "GRAPHQL_CUSTOM_FIELD_PREFIX = \"cf\"",
            "GRAPHQL_RELATIONSHIP_PREFIX = \"rel\"",
            "GRAPHQL_COMPUTED_FIELD_PREFIX = \"cpf\"",
            "",
            "",
            "#",
            "# Caching",
            "#",
            "",
            "# The django-redis cache is used to establish concurrent locks using Redis.",
            "CACHES = {",
            "    \"default\": {",
            "        \"BACKEND\": os.getenv(",
            "            \"NAUTOBOT_CACHES_BACKEND\",",
            "            \"django_prometheus.cache.backends.redis.RedisCache\" if METRICS_ENABLED else \"django_redis.cache.RedisCache\",",
            "        ),",
            "        \"LOCATION\": parse_redis_connection(redis_database=1),",
            "        \"TIMEOUT\": 300,",
            "        \"OPTIONS\": {",
            "            \"CLIENT_CLASS\": \"django_redis.client.DefaultClient\",",
            "            \"PASSWORD\": \"\",",
            "        },",
            "    }",
            "}",
            "",
            "# Number of seconds to cache ContentType lookups. Set to 0 to disable caching.",
            "CONTENT_TYPE_CACHE_TIMEOUT = int(os.getenv(\"NAUTOBOT_CONTENT_TYPE_CACHE_TIMEOUT\", \"0\"))",
            "",
            "#",
            "# Celery (used for background processing)",
            "#",
            "",
            "# Celery broker URL used to tell workers where queues are located",
            "CELERY_BROKER_URL = os.getenv(\"NAUTOBOT_CELERY_BROKER_URL\", parse_redis_connection(redis_database=0))",
            "",
            "# Celery results backend URL to tell workers where to publish task results",
            "CELERY_RESULT_BACKEND = \"nautobot.core.celery.backends.NautobotDatabaseBackend\"",
            "",
            "# Enables extended task result attributes (name, args, kwargs, worker, retries, queue, delivery_info) to be written to backend.",
            "CELERY_RESULT_EXTENDED = True",
            "",
            "# A value of None or 0 means results will never expire (depending on backend specifications).",
            "CELERY_RESULT_EXPIRES = None",
            "",
            "# Instruct celery to report the started status of a job, instead of just `pending`, `finished`, or `failed`",
            "CELERY_TASK_TRACK_STARTED = True",
            "",
            "# If enabled, a `task-sent` event will be sent for every task so tasks can be tracked before they're consumed by a worker.",
            "CELERY_TASK_SEND_SENT_EVENT = True",
            "",
            "# If enabled stdout and stderr of running jobs will be redirected to the task logger.",
            "CELERY_WORKER_REDIRECT_STDOUTS = is_truthy(os.getenv(\"NAUTOBOT_CELERY_WORKER_REDIRECT_STDOUTS\", \"True\"))",
            "",
            "# The log level of log messages generated by redirected job stdout and stderr. Can be one of `DEBUG`, `INFO`, `WARNING`, `ERROR`, or `CRITICAL`.",
            "CELERY_WORKER_REDIRECT_STDOUTS_LEVEL = os.getenv(\"NAUTOBOT_CELERY_WORKER_REDIRECT_STDOUTS_LEVEL\", \"WARNING\")",
            "",
            "# Send task-related events so that tasks can be monitored using tools like flower. Sets the default value for the workers -E argument.",
            "CELERY_WORKER_SEND_TASK_EVENTS = True",
            "",
            "# Default celery queue name that will be used by workers and tasks if no queue is specified",
            "CELERY_TASK_DEFAULT_QUEUE = os.getenv(\"NAUTOBOT_CELERY_TASK_DEFAULT_QUEUE\", \"default\")",
            "",
            "# Global task time limits (seconds)",
            "# Exceeding the soft limit will result in a SoftTimeLimitExceeded exception,",
            "# while exceeding the hard limit will result in a SIGKILL.",
            "CELERY_TASK_SOFT_TIME_LIMIT = int(os.getenv(\"NAUTOBOT_CELERY_TASK_SOFT_TIME_LIMIT\", str(5 * 60)))",
            "CELERY_TASK_TIME_LIMIT = int(os.getenv(\"NAUTOBOT_CELERY_TASK_TIME_LIMIT\", str(10 * 60)))",
            "",
            "# Ports for prometheus metric HTTP server running on the celery worker.",
            "# Normally this should be set to a single port, unless you have multiple workers running on a single machine, i.e.",
            "# sharing the same available ports. In that case you need to specify a range of ports greater than or equal to the",
            "# highest amount of workers you are running on a single machine (comma-separated, like \"8080,8081,8082\"). You can then",
            "# use the `target_limit` parameter to the Prometheus `scrape_config` to ensure you are not getting duplicate metrics in",
            "# that case. Set this to an empty string to disable it.",
            "CELERY_WORKER_PROMETHEUS_PORTS = []",
            "if os.getenv(\"NAUTOBOT_CELERY_WORKER_PROMETHEUS_PORTS\"):",
            "    CELERY_WORKER_PROMETHEUS_PORTS = [",
            "        int(value) for value in os.getenv(\"NAUTOBOT_CELERY_WORKER_PROMETHEUS_PORTS\").split(\",\")",
            "    ]",
            "",
            "# These settings define the custom nautobot serialization encoding as an accepted data encoding format",
            "# and register that format for task input and result serialization",
            "CELERY_ACCEPT_CONTENT = [\"nautobot_json\"]",
            "CELERY_RESULT_ACCEPT_CONTENT = [\"nautobot_json\"]",
            "CELERY_TASK_SERIALIZER = \"nautobot_json\"",
            "CELERY_RESULT_SERIALIZER = \"nautobot_json\"",
            "",
            "CELERY_BEAT_SCHEDULER = \"nautobot.core.celery.schedulers:NautobotDatabaseScheduler\"",
            "",
            "# Sets an age out timer of redis lock. This is NOT implicitly applied to locks, must be added",
            "# to a lock creation as `timeout=settings.REDIS_LOCK_TIMEOUT`",
            "REDIS_LOCK_TIMEOUT = int(os.getenv(\"NAUTOBOT_REDIS_LOCK_TIMEOUT\", \"600\"))",
            "",
            "#",
            "# Custom branding (logo and title)",
            "#",
            "",
            "# Branding logo locations. The logo takes the place of the Nautobot logo in the top right of the nav bar.",
            "# The filepath should be relative to the `MEDIA_ROOT`.",
            "BRANDING_FILEPATHS = {",
            "    \"logo\": os.getenv(\"NAUTOBOT_BRANDING_FILEPATHS_LOGO\", None),  # Navbar logo",
            "    \"favicon\": os.getenv(\"NAUTOBOT_BRANDING_FILEPATHS_FAVICON\", None),  # Browser favicon",
            "    \"icon_16\": os.getenv(\"NAUTOBOT_BRANDING_FILEPATHS_ICON_16\", None),  # 16x16px icon",
            "    \"icon_32\": os.getenv(\"NAUTOBOT_BRANDING_FILEPATHS_ICON_32\", None),  # 32x32px icon",
            "    \"icon_180\": os.getenv(",
            "        \"NAUTOBOT_BRANDING_FILEPATHS_ICON_180\", None",
            "    ),  # 180x180px icon - used for the apple-touch-icon header",
            "    \"icon_192\": os.getenv(\"NAUTOBOT_BRANDING_FILEPATHS_ICON_192\", None),  # 192x192px icon",
            "    \"icon_mask\": os.getenv(",
            "        \"NAUTOBOT_BRANDING_FILEPATHS_ICON_MASK\", None",
            "    ),  # mono-chrome icon used for the mask-icon header",
            "    \"header_bullet\": os.getenv(",
            "        \"NAUTOBOT_BRANDING_FILEPATHS_HEADER_BULLET\", None",
            "    ),  # bullet image used for various view headers",
            "    \"nav_bullet\": os.getenv(\"NAUTOBOT_BRANDING_FILEPATHS_NAV_BULLET\", None),  # bullet image used for nav menu headers",
            "}",
            "",
            "# Title to use in place of \"Nautobot\"",
            "BRANDING_TITLE = os.getenv(\"NAUTOBOT_BRANDING_TITLE\", \"Nautobot\")",
            "",
            "# Prepended to CSV, YAML and export template filenames (i.e. `nautobot_device.yml`)",
            "BRANDING_PREPENDED_FILENAME = os.getenv(\"NAUTOBOT_BRANDING_PREPENDED_FILENAME\", \"nautobot_\")",
            "",
            "# Branding URLs (links in the bottom right of the footer)",
            "BRANDING_URLS = {",
            "    \"code\": os.getenv(\"NAUTOBOT_BRANDING_URLS_CODE\", \"https://github.com/nautobot/nautobot\"),",
            "    \"docs\": os.getenv(\"NAUTOBOT_BRANDING_URLS_DOCS\", None),",
            "    \"help\": os.getenv(\"NAUTOBOT_BRANDING_URLS_HELP\", \"https://github.com/nautobot/nautobot/wiki\"),",
            "}",
            "",
            "# Undocumented link in the bottom right of the footer which is meant to persist any custom branding changes.",
            "BRANDING_POWERED_BY_URL = \"https://docs.nautobot.com/\"",
            "",
            "#",
            "# Django extensions settings",
            "#",
            "",
            "# Dont load the 'taggit' app, since we have our own custom `Tag` and `TaggedItem` models",
            "SHELL_PLUS_DONT_LOAD = [\"taggit\"]",
            "",
            "#",
            "# UI settings",
            "#",
            "",
            "",
            "# UI_RACK_VIEW_TRUNCATE_FUNCTION",
            "def UI_RACK_VIEW_TRUNCATE_FUNCTION(device_display_name):",
            "    \"\"\"Given device display name, truncate to fit the rack elevation view.",
            "",
            "    :param device_display_name: Full display name of the device attempting to be rendered in the rack elevation.",
            "    :type device_display_name: str",
            "",
            "    :return: Truncated device name",
            "    :type: str",
            "    \"\"\"",
            "    return str(device_display_name).split(\".\")[0]",
            "",
            "",
            "# Custom JSON schema serializer field type mappingss. These will be added to",
            "# `NautobotProcessingMixin.TYPE_MAP`.",
            "# Format: `{serializer_field_class.__name__}` => `{json_schema_type}`",
            "# See: https://github.com/yoyowallet/drf-react-template-framework#settings",
            "DRF_REACT_TEMPLATE_TYPE_MAP = {",
            "    \"ContentTypeField\": {\"type\": \"string\", \"enum\": \"choices\"},",
            "    \"CustomFieldsDataField\": {\"type\": \"object\", \"widget\": \"textarea\"},",
            "    \"DateTimeField\": {\"type\": \"string\", \"format\": \"date-time\", \"widget\": \"date-time\"},",
            "    \"ImageField\": {\"type\": \"string\", \"format\": \"data-url\"},",
            "    \"IPFieldSerializer\": {\"type\": \"string\"},",
            "    \"JSONField\": {\"type\": \"string\", \"widget\": \"textarea\"},",
            "    \"MultipleChoiceJSONField\": {\"type\": \"array\", \"required\": [], \"enum\": \"choices\"},",
            "    \"ManyRelatedField\": {\"type\": \"array\", \"required\": []},",
            "    #",
            "    # Foreign Key fields",
            "    #",
            "    # enum=choices is the one that works in the UI as a related field but it",
            "    # includes ALL related objects in the schema.",
            "    # \"NautobotHyperlinkedRelatedField\": {\"type\": \"string\", \"enum\": \"choices\"},",
            "    # readOnly=True disables the fields in the UI; not what we want.",
            "    # \"NautobotHyperlinkedRelatedField\": {\"type\": \"string\", \"readOnly\": True},",
            "    # type=string results in a free text field; also not what we want. For now,",
            "    # however, this will keep things moving so the unit tests pass.",
            "    \"NautobotHyperlinkedRelatedField\": {\"type\": \"object\"},",
            "    \"PrimaryKeyRelatedField\": {\"type\": \"string\", \"enum\": \"choices\"},",
            "    \"RelationshipsDataField\": {\"type\": \"object\"},",
            "    \"SlugField\": {\"type\": \"string\"},",
            "    \"TimeZoneSerializerField\": {\"type\": \"string\"},",
            "    \"UUIDField\": {\"type\": \"string\", \"format\": \"uuid\"},",
            "}"
        ],
        "action": [
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "685": []
        },
        "addLocation": []
    },
    "nautobot/core/templatetags/helpers.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 8,
                "afterPatchRowNumber": 8,
                "PatchRowcode": " from django.contrib.staticfiles.finders import find"
            },
            "1": {
                "beforePatchRowNumber": 9,
                "afterPatchRowNumber": 9,
                "PatchRowcode": " from django.templatetags.static import static, StaticNode"
            },
            "2": {
                "beforePatchRowNumber": 10,
                "afterPatchRowNumber": 10,
                "PatchRowcode": " from django.urls import NoReverseMatch, reverse"
            },
            "3": {
                "beforePatchRowNumber": 11,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-from django.utils.html import format_html, strip_tags"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 11,
                "PatchRowcode": "+from django.utils.html import format_html"
            },
            "5": {
                "beforePatchRowNumber": 12,
                "afterPatchRowNumber": 12,
                "PatchRowcode": " from django.utils.safestring import mark_safe"
            },
            "6": {
                "beforePatchRowNumber": 13,
                "afterPatchRowNumber": 13,
                "PatchRowcode": " from django.utils.text import slugify as django_slugify"
            },
            "7": {
                "beforePatchRowNumber": 14,
                "afterPatchRowNumber": 14,
                "PatchRowcode": " from django_jinja import library"
            },
            "8": {
                "beforePatchRowNumber": 17,
                "afterPatchRowNumber": 17,
                "PatchRowcode": " "
            },
            "9": {
                "beforePatchRowNumber": 18,
                "afterPatchRowNumber": 18,
                "PatchRowcode": " from nautobot.apps.config import get_app_settings_or_config"
            },
            "10": {
                "beforePatchRowNumber": 19,
                "afterPatchRowNumber": 19,
                "PatchRowcode": " from nautobot.core import forms"
            },
            "11": {
                "beforePatchRowNumber": 20,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-from nautobot.core.utils import color, config, data, lookup"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 20,
                "PatchRowcode": "+from nautobot.core.utils import color, config, data, logging as nautobot_logging, lookup"
            },
            "13": {
                "beforePatchRowNumber": 21,
                "afterPatchRowNumber": 21,
                "PatchRowcode": " from nautobot.core.utils.requests import add_nautobot_version_query_param_to_url"
            },
            "14": {
                "beforePatchRowNumber": 22,
                "afterPatchRowNumber": 22,
                "PatchRowcode": " "
            },
            "15": {
                "beforePatchRowNumber": 23,
                "afterPatchRowNumber": 23,
                "PatchRowcode": " # S308 is suspicious-mark-safe-usage, but these are all using static strings that we know to be safe"
            },
            "16": {
                "beforePatchRowNumber": 170,
                "afterPatchRowNumber": 170,
                "PatchRowcode": "     Example:"
            },
            "17": {
                "beforePatchRowNumber": 171,
                "afterPatchRowNumber": 171,
                "PatchRowcode": "         {{ text | render_markdown }}"
            },
            "18": {
                "beforePatchRowNumber": 172,
                "afterPatchRowNumber": 172,
                "PatchRowcode": "     \"\"\""
            },
            "19": {
                "beforePatchRowNumber": 173,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    # Strip HTML tags"
            },
            "20": {
                "beforePatchRowNumber": 174,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    value = strip_tags(value)"
            },
            "21": {
                "beforePatchRowNumber": 175,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "22": {
                "beforePatchRowNumber": 176,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    # Sanitize Markdown links"
            },
            "23": {
                "beforePatchRowNumber": 177,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    schemes = \"|\".join(settings.ALLOWED_URL_SCHEMES)"
            },
            "24": {
                "beforePatchRowNumber": 178,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    pattern = rf\"\\[(.+)\\]\\((?!({schemes})).*:(.+)\\)\""
            },
            "25": {
                "beforePatchRowNumber": 179,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    value = re.sub(pattern, \"[\\\\1](\\\\3)\", value, flags=re.IGNORECASE)"
            },
            "26": {
                "beforePatchRowNumber": 180,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "27": {
                "beforePatchRowNumber": 181,
                "afterPatchRowNumber": 173,
                "PatchRowcode": "     # Render Markdown"
            },
            "28": {
                "beforePatchRowNumber": 182,
                "afterPatchRowNumber": 174,
                "PatchRowcode": "     html = markdown(value, extensions=[\"fenced_code\", \"tables\"])"
            },
            "29": {
                "beforePatchRowNumber": 183,
                "afterPatchRowNumber": 175,
                "PatchRowcode": " "
            },
            "30": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 176,
                "PatchRowcode": "+    # Sanitize rendered HTML"
            },
            "31": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 177,
                "PatchRowcode": "+    html = nautobot_logging.clean_html(html)"
            },
            "32": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 178,
                "PatchRowcode": "+"
            },
            "33": {
                "beforePatchRowNumber": 184,
                "afterPatchRowNumber": 179,
                "PatchRowcode": "     return mark_safe(html)  # noqa: S308  # suspicious-mark-safe-usage, OK here since we sanitized the string earlier"
            },
            "34": {
                "beforePatchRowNumber": 185,
                "afterPatchRowNumber": 180,
                "PatchRowcode": " "
            },
            "35": {
                "beforePatchRowNumber": 186,
                "afterPatchRowNumber": 181,
                "PatchRowcode": " "
            }
        },
        "frontPatchFile": [
            "import datetime",
            "import json",
            "import logging",
            "import re",
            "",
            "from django import template",
            "from django.conf import settings",
            "from django.contrib.staticfiles.finders import find",
            "from django.templatetags.static import static, StaticNode",
            "from django.urls import NoReverseMatch, reverse",
            "from django.utils.html import format_html, strip_tags",
            "from django.utils.safestring import mark_safe",
            "from django.utils.text import slugify as django_slugify",
            "from django_jinja import library",
            "from markdown import markdown",
            "import yaml",
            "",
            "from nautobot.apps.config import get_app_settings_or_config",
            "from nautobot.core import forms",
            "from nautobot.core.utils import color, config, data, lookup",
            "from nautobot.core.utils.requests import add_nautobot_version_query_param_to_url",
            "",
            "# S308 is suspicious-mark-safe-usage, but these are all using static strings that we know to be safe",
            "HTML_TRUE = mark_safe('<span class=\"text-success\"><i class=\"mdi mdi-check-bold\" title=\"Yes\"></i></span>')  # noqa: S308",
            "HTML_FALSE = mark_safe('<span class=\"text-danger\"><i class=\"mdi mdi-close-thick\" title=\"No\"></i></span>')  # noqa: S308",
            "HTML_NONE = mark_safe('<span class=\"text-muted\">&mdash;</span>')  # noqa: S308",
            "",
            "DEFAULT_SUPPORT_MESSAGE = (",
            "    \"If further assistance is required, please join the `#nautobot` channel \"",
            "    \"on [Network to Code's Slack community](https://slack.networktocode.com/) and post your question.\"",
            ")",
            "",
            "register = template.Library()",
            "",
            "",
            "logger = logging.getLogger(__name__)",
            "",
            "",
            "#",
            "# Filters",
            "#",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def hyperlinked_object(value, field=\"display\"):",
            "    \"\"\"Render and link to a Django model instance, if any, or render a placeholder if not.",
            "",
            "    Uses the specified object field if available, otherwise uses the string representation of the object.",
            "    If the object defines `get_absolute_url()` this will be used to hyperlink the displayed object;",
            "    additionally if there is an `object.description` this will be used as the title of the hyperlink.",
            "",
            "    Args:",
            "        value (Union[django.db.models.Model, None]): Instance of a Django model or None.",
            "        field (Optional[str]): Name of the field to use for the display value. Defaults to \"display\".",
            "",
            "    Returns:",
            "        (str): String representation of the value (hyperlinked if it defines get_absolute_url()) or a placeholder.",
            "",
            "    Examples:",
            "        >>> hyperlinked_object(device)",
            "        '<a href=\"/dcim/devices/3faafe8c-bdd6-4317-88dc-f791e6988caa/\">Device 1</a>'",
            "        >>> hyperlinked_object(device_role)",
            "        '<a href=\"/dcim/device-roles/router/\" title=\"Devices that are routers, not switches\">Router</a>'",
            "        >>> hyperlinked_object(None)",
            "        '<span class=\"text-muted\">&mdash;</span>'",
            "        >>> hyperlinked_object(\"Hello\")",
            "        'Hello'",
            "        >>> hyperlinked_object(location)",
            "        '<a href=\"/dcim/locations/leaf/\">Root \u2192 Intermediate \u2192 Leaf</a>'",
            "        >>> hyperlinked_object(location, \"name\")",
            "        '<a href=\"/dcim/locations/leaf/\">Leaf</a>'",
            "    \"\"\"",
            "    if value is None:",
            "        return placeholder(value)",
            "    display = getattr(value, field) if hasattr(value, field) else str(value)",
            "    if hasattr(value, \"get_absolute_url\"):",
            "        if hasattr(value, \"description\") and value.description:",
            "            return format_html('<a href=\"{}\" title=\"{}\">{}</a>', value.get_absolute_url(), value.description, display)",
            "        return format_html('<a href=\"{}\">{}</a>', value.get_absolute_url(), display)",
            "    return format_html(\"{}\", display)",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def placeholder(value):",
            "    \"\"\"Render a muted placeholder if value is falsey, else render the value.",
            "",
            "    Args:",
            "        value (any): Input value, can be any variable.",
            "",
            "    Returns:",
            "        (str): Placeholder in HTML, or the string representation of the value.",
            "",
            "    Example:",
            "        >>> placeholder(\"\")",
            "        '<span class=\"text-muted\">&mdash;</span>'",
            "        >>> placeholder(\"hello\")",
            "        \"hello\"",
            "    \"\"\"",
            "    if value:",
            "        return value",
            "    return HTML_NONE",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def add_html_id(element_str, id_str):",
            "    \"\"\"Add an HTML `id=\"...\"` attribute to the given HTML element string.",
            "",
            "    Args:",
            "        element_str (str): String describing an HTML element.",
            "        id_str (str): String to add as the `id` attribute of the element_str.",
            "",
            "    Returns:",
            "        (str): HTML string with added `id`.",
            "",
            "    Example:",
            "        >>> add_html_id(\"<div></div>\", \"my-div\")",
            "        '<div id=\"my-div\"></div>'",
            "        >>> add_html_id('<a href=\"...\" title=\"...\">Hello!</a>', \"my-a\")",
            "        '<a id=\"my-a\" href=\"...\" title=\"...\">Hello!</a>'",
            "    \"\"\"",
            "    match = re.match(r\"^(.*?<\\w+) ?(.*)$\", element_str, flags=re.DOTALL)",
            "    if not match:",
            "        return element_str",
            "    return mark_safe(match.group(1) + format_html(' id=\"{}\" ', id_str) + match.group(2))  # noqa: S308  # suspicious-mark-safe-usage",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def render_boolean(value):",
            "    \"\"\"Render HTML from a computed boolean value.",
            "",
            "    Args:",
            "        value (any): Input value, can be any variable.",
            "            A truthy value (for example non-empty string / True / non-zero number) is considered True.",
            "            A falsey value other than None (for example \"\" or 0 or False) is considered False.",
            "            A value of None is considered neither True nor False.",
            "",
            "    Returns:",
            "        (str): HTML",
            "            '<span class=\"text-success\"><i class=\"mdi mdi-check-bold\" title=\"Yes\"></i></span>' if True value",
            "            - or -",
            "            '<span class=\"text-muted\">&mdash;</span>' if None value",
            "            - or -",
            "            '<span class=\"text-danger\"><i class=\"mdi mdi-close-thick\" title=\"No\"></i></span>' if False value",
            "",
            "    Examples:",
            "        >>> render_boolean(None)",
            "        '<span class=\"text-muted\">&mdash;</span>'",
            "        >>> render_boolean(True or \"arbitrary string\" or 1)",
            "        '<span class=\"text-success\"><i class=\"mdi mdi-check-bold\" title=\"Yes\"></i></span>'",
            "        >>> render_boolean(False or \"\" or 0)",
            "        '<span class=\"text-danger\"><i class=\"mdi mdi-close-thick\" title=\"No\"></i></span>'",
            "    \"\"\"",
            "    if value is None:",
            "        return HTML_NONE",
            "    if bool(value):",
            "        return HTML_TRUE",
            "    return HTML_FALSE",
            "",
            "",
            "@library.filter()",
            "@register.filter(is_safe=True)",
            "def render_markdown(value):",
            "    \"\"\"",
            "    Render text as Markdown",
            "",
            "    Example:",
            "        {{ text | render_markdown }}",
            "    \"\"\"",
            "    # Strip HTML tags",
            "    value = strip_tags(value)",
            "",
            "    # Sanitize Markdown links",
            "    schemes = \"|\".join(settings.ALLOWED_URL_SCHEMES)",
            "    pattern = rf\"\\[(.+)\\]\\((?!({schemes})).*:(.+)\\)\"",
            "    value = re.sub(pattern, \"[\\\\1](\\\\3)\", value, flags=re.IGNORECASE)",
            "",
            "    # Render Markdown",
            "    html = markdown(value, extensions=[\"fenced_code\", \"tables\"])",
            "",
            "    return mark_safe(html)  # noqa: S308  # suspicious-mark-safe-usage, OK here since we sanitized the string earlier",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def render_json(value):",
            "    \"\"\"",
            "    Render a dictionary as formatted JSON.",
            "    \"\"\"",
            "    return json.dumps(value, indent=4, sort_keys=True, ensure_ascii=False)",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def render_yaml(value):",
            "    \"\"\"",
            "    Render a dictionary as formatted YAML.",
            "    \"\"\"",
            "    return yaml.dump(json.loads(json.dumps(value, ensure_ascii=False)), allow_unicode=True)",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def meta(obj, attr):",
            "    \"\"\"",
            "    Return the specified Meta attribute of a model. This is needed because Django does not permit templates",
            "    to access attributes which begin with an underscore (e.g. _meta).",
            "",
            "    Args:",
            "        obj (models.Model): Class or Instance of a Django Model",
            "        attr (str): name of the attribute to access",
            "",
            "    Returns:",
            "        (any): return the value of the attribute",
            "    \"\"\"",
            "    return getattr(obj._meta, attr, \"\")",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def viewname(model, action):",
            "    \"\"\"",
            "    Return the view name for the given model and action. Does not perform any validation.",
            "",
            "    Args:",
            "        model (models.Model): Class or Instance of a Django Model",
            "        action (str): name of the action in the viewname",
            "",
            "    Returns:",
            "        (str): return the name of the view for the model/action provided.",
            "    Examples:",
            "        >>> viewname(Device, \"list\")",
            "        \"dcim:device_list\"",
            "    \"\"\"",
            "    return lookup.get_route_for_model(model, action)",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def validated_viewname(model, action):",
            "    \"\"\"",
            "    Return the view name for the given model and action if valid, or None if invalid.",
            "",
            "    Args:",
            "        model (models.Model): Class or Instance of a Django Model",
            "        action (str): name of the action in the viewname",
            "",
            "    Returns:",
            "        (Union[str, None]): return the name of the view for the model/action provided if valid, or None if invalid.",
            "    \"\"\"",
            "    viewname_str = lookup.get_route_for_model(model, action)",
            "",
            "    try:",
            "        # Validate and return the view name. We don't return the actual URL yet because many of the templates",
            "        # are written to pass a name to {% url %}.",
            "        reverse(viewname_str)",
            "        return viewname_str",
            "    except NoReverseMatch:",
            "        return None",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def validated_api_viewname(model, action):",
            "    \"\"\"",
            "    Return the API view name for the given model and action if valid, or None if invalid.",
            "",
            "    Args:",
            "        model (models.Model): Class or Instance of a Django Model",
            "        action (str): name of the action in the viewname",
            "",
            "    Returns:",
            "        (Union[str, None]): return the name of the API view for the model/action provided if valid, or None if invalid.",
            "    \"\"\"",
            "    viewname_str = lookup.get_route_for_model(model, action, api=True)",
            "",
            "    try:",
            "        # Validate and return the view name. We don't return the actual URL yet because many of the templates",
            "        # are written to pass a name to {% url %}.",
            "        if action == \"detail\":",
            "            # Detail views require an argument, so we'll pass a dummy value just for validation",
            "            reverse(viewname_str, args=[\"00000000-0000-0000-0000-000000000000\"])",
            "        else:",
            "            reverse(viewname_str)",
            "        return viewname_str",
            "    except NoReverseMatch:",
            "        return None",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def bettertitle(value):",
            "    \"\"\"",
            "    Alternative to the builtin title(); capitalizes words without replacing letters that are already uppercase.",
            "",
            "    Args:",
            "        value (str): string to convert to Title Case",
            "",
            "    Returns:",
            "        (str): string in Title format",
            "",
            "    Example:",
            "        >>> bettertitle(\"IP address\")",
            "        \"IP Address\"",
            "    \"\"\"",
            "    return \" \".join([w[0].upper() + w[1:] for w in value.split()])",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def humanize_speed(speed):",
            "    \"\"\"",
            "    Humanize speeds given in Kbps. Examples:",
            "",
            "        1544 => \"1.544 Mbps\"",
            "        100000 => \"100 Mbps\"",
            "        10000000 => \"10 Gbps\"",
            "    \"\"\"",
            "    if not speed:",
            "        return \"\"",
            "    if speed >= 1000000000 and speed % 1000000000 == 0:",
            "        return f\"{int(speed / 1000000000)} Tbps\"",
            "    elif speed >= 1000000 and speed % 1000000 == 0:",
            "        return f\"{int(speed / 1000000)} Gbps\"",
            "    elif speed >= 1000 and speed % 1000 == 0:",
            "        return f\"{int(speed / 1000)} Mbps\"",
            "    elif speed >= 1000:",
            "        return f\"{float(speed) / 1000} Mbps\"",
            "    else:",
            "        return f\"{speed} Kbps\"",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def tzoffset(value):",
            "    \"\"\"",
            "    Returns the hour offset of a given time zone using the current time.",
            "    \"\"\"",
            "    return datetime.datetime.now(value).strftime(\"%z\")",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def fgcolor(value):",
            "    \"\"\"",
            "    Return the ideal foreground color (block or white) given an arbitrary background color in RRGGBB format.",
            "",
            "    Args:",
            "        value (str): Color in RRGGBB format, with or without #",
            "",
            "    Returns:",
            "        (str): ideal foreground color, either black (#000000) or white (#ffffff)",
            "",
            "    Example:",
            "        >>> fgcolor(\"#999999\")",
            "        \"#ffffff\"",
            "    \"\"\"",
            "    value = value.lower().strip(\"#\")",
            "    if not re.match(\"^[0-9a-f]{6}$\", value):",
            "        return \"\"",
            "    return f\"#{color.foreground_color(value)}\"",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def divide(x, y):",
            "    \"\"\"Return x/y (rounded).",
            "",
            "    Args:",
            "        x (int or float): dividend number",
            "        y (int or float): divisor number",
            "",
            "    Returns:",
            "        (int): x/y (rounded)",
            "",
            "    Examples:",
            "        >>> divide(10, 3)",
            "        3",
            "    \"\"\"",
            "    if x is None or y is None:",
            "        return None",
            "    return round(x / y)",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def percentage(x, y):",
            "    \"\"\"Return x/y as a percentage.",
            "",
            "    Args:",
            "        x (int or float): dividend number",
            "        y (int or float): divisor number",
            "",
            "    Returns:",
            "        (int): x/y as a percentage",
            "",
            "    Examples:",
            "        >>> percentage(2, 10)",
            "        20",
            "",
            "    \"\"\"",
            "    if x is None or y is None:",
            "        return None",
            "    return round(x / y * 100)",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def get_docs_url(model):",
            "    \"\"\"Return the likely static documentation path for the specified model, if it can be found/predicted.",
            "",
            "    - Core models, as of 2.0, are usually at `docs/user-guide/core-data-model/{app_label}/{model_name}.html`.",
            "        - Models in the `extras` app are usually at `docs/user-guide/platform-functionality/{model_name}.html`.",
            "    - Apps (plugins) are generally expected to be documented at `{app_label}/docs/models/{model_name}.html`.",
            "",
            "    Any model can define a `documentation_static_path` class attribute if it needs to override the above expectations.",
            "",
            "    If a file doesn't exist at the expected static path, this will return None.",
            "",
            "    Args:",
            "        model (models.Model): Instance of a Django model",
            "",
            "    Returns:",
            "        (Union[str, None]): static URL for the documentation of the object or None if not found.",
            "",
            "    Example:",
            "        >>> get_docs_url(location_instance)",
            "        \"static/docs/models/dcim/location.html\"",
            "    \"\"\"",
            "    if hasattr(model, \"documentation_static_path\"):",
            "        path = model.documentation_static_path",
            "    elif model._meta.app_label in settings.PLUGINS:",
            "        path = f\"{model._meta.app_label}/docs/models/{model._meta.model_name}.html\"",
            "    elif model._meta.app_label == \"extras\":",
            "        path = f\"docs/user-guide/platform-functionality/{model._meta.model_name}.html\"",
            "    else:",
            "        path = f\"docs/user-guide/core-data-model/{model._meta.app_label}/{model._meta.model_name}.html\"",
            "",
            "    # Check to see if documentation exists in any of the static paths.",
            "    if find(path):",
            "        return static(path)",
            "    logger.debug(\"No documentation found for %s (expected to find it at %s)\", type(model), path)",
            "    return None",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def has_perms(user, permissions_list):",
            "    \"\"\"",
            "    Return True if the user has *all* permissions in the list.",
            "    \"\"\"",
            "    return user.has_perms(permissions_list)",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def has_one_or_more_perms(user, permissions_list):",
            "    \"\"\"",
            "    Return True if the user has *at least one* permissions in the list.",
            "    \"\"\"",
            "",
            "    for permission in permissions_list:",
            "        if user.has_perm(permission):",
            "            return True",
            "    return False",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def split(string, sep=\",\"):",
            "    \"\"\"Split a string by the given value (default: comma)",
            "",
            "    Args:",
            "        string (str): string to split into a list",
            "        sep (str default=,): separator to look for in the string",
            "",
            "    Returns:",
            "        (list[str]): List of string, if the separator wasn't found, list of 1",
            "    \"\"\"",
            "    return string.split(sep)",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def as_range(n):",
            "    \"\"\"Return a range of n items.",
            "",
            "    Args:",
            "        n (int, str): Number of element in the range",
            "",
            "    Returns:",
            "        (Union[list, Range]): range function from o to the value provided. Returns an empty list if n is not valid.",
            "",
            "    Example:",
            "        {% for i in record.ancestors.count|as_range %}",
            "            <i class=\"mdi mdi-circle-small\"></i>",
            "        {% endfor %}",
            "    \"\"\"",
            "    try:",
            "        int(n)",
            "    except (TypeError, ValueError):",
            "        return []",
            "    return range(int(n))",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def meters_to_feet(n):",
            "    \"\"\"Convert a length from meters to feet.",
            "",
            "    Args:",
            "        n (int, float, str): Number of meters to convert",
            "",
            "    Returns:",
            "        (float): Value in feet",
            "    \"\"\"",
            "    return float(n) * 3.28084",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def get_item(d, key):",
            "    \"\"\"Access a specific item/key in a dictionary",
            "",
            "    Args:",
            "        d (dict): dictionary containing the data to access",
            "        key (str): name of the item/key to access",
            "",
            "    Returns:",
            "        (any): Value of the item in the dictionary provided",
            "",
            "    Example:",
            "        >>> get_item(data, key)",
            "        \"value\"",
            "    \"\"\"",
            "    return d.get(key)",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def settings_or_config(key, app_name=None):",
            "    \"\"\"Get a value from Django settings (if specified there) or Constance configuration (otherwise).\"\"\"",
            "    if app_name:",
            "        return get_app_settings_or_config(app_name, key)",
            "    return config.get_settings_or_config(key)",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def quote_string(value):",
            "    \"\"\"Add literal quote characters around the provided value if it's a string.\"\"\"",
            "    if isinstance(value, str):",
            "        return f'\"{value}\"'",
            "    return value",
            "",
            "",
            "@library.filter()",
            "def slugify(value):",
            "    \"\"\"Return a slugified version of the value.\"\"\"",
            "    return django_slugify(value)",
            "",
            "",
            "#",
            "# Tags",
            "#",
            "",
            "",
            "@register.simple_tag()",
            "def get_attr(obj, attr, default=None):",
            "    return getattr(obj, attr, default)",
            "",
            "",
            "@register.simple_tag()",
            "def querystring(request, **kwargs):",
            "    \"\"\"",
            "    Append or update the page number in a querystring.",
            "    \"\"\"",
            "    querydict = request.GET.copy()",
            "    for k, v in kwargs.items():",
            "        if v is not None:",
            "            querydict[k] = str(v)",
            "        elif k in querydict:",
            "            querydict.pop(k)",
            "    query_string = querydict.urlencode(safe=\"/\")",
            "    if query_string:",
            "        return \"?\" + query_string",
            "    else:",
            "        return \"\"",
            "",
            "",
            "@register.inclusion_tag(\"utilities/templatetags/utilization_graph.html\")",
            "def utilization_graph(utilization_data, warning_threshold=75, danger_threshold=90):",
            "    \"\"\"Wrapper for a horizontal bar graph indicating a percentage of utilization from a tuple of data.",
            "",
            "    Takes the utilization_data that is a namedtuple with numerator and denominator field names and passes them into",
            "    the utilization_graph_raw_data to handle the generation graph data.",
            "",
            "    Args:",
            "        utilization_data (UtilizationData): Namedtuple with numerator and denominator keys",
            "        warning_threshold (int, optional): Warning Threshold Value. Defaults to 75.",
            "        danger_threshold (int, optional): Danger Threshold Value. Defaults to 90.",
            "",
            "    Returns:",
            "        (dict): Dictionary with utilization, warning threshold, danger threshold, utilization count, and total count for",
            "                display",
            "    \"\"\"",
            "    # See https://github.com/nautobot/nautobot/issues/1169",
            "    # If `get_utilization()` threw an exception, utilization_data will be an empty string",
            "    # rather than a UtilizationData instance. Avoid a potentially confusing exception in that case.",
            "    if not isinstance(utilization_data, data.UtilizationData):",
            "        return {}",
            "    return utilization_graph_raw_data(",
            "        numerator=utilization_data.numerator,",
            "        denominator=utilization_data.denominator,",
            "        warning_threshold=warning_threshold,",
            "        danger_threshold=danger_threshold,",
            "    )",
            "",
            "",
            "@register.inclusion_tag(\"utilities/templatetags/utilization_graph.html\")",
            "def utilization_graph_raw_data(numerator, denominator, warning_threshold=75, danger_threshold=90):",
            "    \"\"\"Display a horizontal bar graph indicating a percentage of utilization.",
            "",
            "    Args:",
            "        numerator (int): Numerator for creating a percentage",
            "        denominator (int): Denominator for creating a percentage",
            "        warning_threshold (int, optional): Warning Threshold Value. Defaults to 75.",
            "        danger_threshold (int, optional): Danger Threshold Value. Defaults to 90.",
            "",
            "    Returns:",
            "        (dict): Dictionary with utilization, warning threshold, danger threshold, utilization count, and total count for",
            "                display",
            "    \"\"\"",
            "    # Check for possible division by zero error",
            "    if denominator == 0:",
            "        utilization = 0",
            "    else:",
            "        utilization = int(float(numerator) / denominator * 100)",
            "",
            "    return {",
            "        \"utilization\": utilization,",
            "        \"warning_threshold\": warning_threshold,",
            "        \"danger_threshold\": danger_threshold,",
            "        \"utilization_count\": numerator,",
            "        \"total_count\": denominator,",
            "    }",
            "",
            "",
            "@register.inclusion_tag(\"utilities/templatetags/tag.html\")",
            "def tag(tag, url_name=None):  # pylint: disable=redefined-outer-name",
            "    \"\"\"",
            "    Display a tag, optionally linked to a filtered list of objects.",
            "    \"\"\"",
            "    return {",
            "        \"tag\": tag,",
            "        \"url_name\": url_name,",
            "    }",
            "",
            "",
            "@register.inclusion_tag(\"utilities/templatetags/badge.html\")",
            "def badge(value, show_empty=False):",
            "    \"\"\"",
            "    Display the specified number as a badge.",
            "    \"\"\"",
            "    return {",
            "        \"value\": value,",
            "        \"show_empty\": show_empty,",
            "    }",
            "",
            "",
            "@register.inclusion_tag(\"utilities/templatetags/table_config_form.html\")",
            "def table_config_form(table, table_name=None):",
            "    return {",
            "        \"table_name\": table_name or table.__class__.__name__,",
            "        \"table_config_form\": forms.TableConfigForm(table=table),",
            "    }",
            "",
            "",
            "@register.inclusion_tag(\"utilities/templatetags/filter_form_modal.html\")",
            "def filter_form_modal(",
            "    filter_form,",
            "    dynamic_filter_form,",
            "    model_plural_name,",
            "    filter_form_name=\"FilterForm\",",
            "    dynamic_filter_form_name=\"DynamicFilterForm\",",
            "):",
            "    return {",
            "        \"model_plural_name\": model_plural_name,",
            "        \"filter_form\": filter_form,",
            "        \"filter_form_name\": filter_form_name,",
            "        \"dynamic_filter_form\": dynamic_filter_form,",
            "        \"dynamic_filter_form_name\": dynamic_filter_form_name,",
            "    }",
            "",
            "",
            "@register.inclusion_tag(\"utilities/templatetags/modal_form_as_dialog.html\")",
            "def modal_form_as_dialog(form, editing=False, form_name=None, obj=None, obj_type=None):",
            "    \"\"\"Generate a form in a modal view.",
            "",
            "    Create an overlaying modal view which holds a Django form.",
            "",
            "    Inside of the template the template tag needs to be used with the correct inputs. A button will",
            "    also need to be create to open and close the modal. See below for an example:",
            "",
            "    ```",
            "    {% modal_form_as_dialog form editing=False form_name=\"CreateDevice\" obj=obj obj_type=\"Device\" %}",
            "    <a class=\"btn btn-primary\" data-toggle=\"modal\" data-target=\"#CreateDevice_form\" title=\"Query Form\">Create Device</a>",
            "    ```",
            "    Args:",
            "        form (django.form.Forms): Django form object.",
            "        editing (bool, optional): Is the form creating or editing an object? Defaults to False for create.",
            "        form_name ([type], optional): Name of form. Defaults to None. If None get name from class name.",
            "        obj (django.model.Object, optional): If editing an existing model object, the object needs to be passed in. Defaults to None.",
            "        obj_type (string, optional): Used in title of form to display object type. Defaults to None.",
            "",
            "    Returns:",
            "        (dict): Passed in values used to render HTML.",
            "    \"\"\"",
            "    return {",
            "        \"editing\": editing,",
            "        \"form\": form,",
            "        \"form_action_url\": form.get_action_url(),",
            "        \"form_name\": form_name or form.__class__.__name__,",
            "        \"obj\": obj,",
            "        \"obj_type\": obj_type,",
            "    }",
            "",
            "",
            "@register.simple_tag",
            "def custom_branding_or_static(branding_asset, static_asset):",
            "    \"\"\"",
            "    This tag attempts to return custom branding assets relative to the MEDIA_ROOT and MEDIA_URL, if such",
            "    branding has been configured in settings, else it returns stock branding via static.",
            "    \"\"\"",
            "    if settings.BRANDING_FILEPATHS.get(branding_asset):",
            "        url = f\"{ settings.MEDIA_URL }{ settings.BRANDING_FILEPATHS.get(branding_asset) }\"",
            "    else:",
            "        url = StaticNode.handle_simple(static_asset)",
            "    return add_nautobot_version_query_param_to_url(url)",
            "",
            "",
            "@register.simple_tag",
            "def support_message():",
            "    \"\"\"",
            "    Return the configured support message (if any) or else the default.",
            "    \"\"\"",
            "    try:",
            "        message = config.get_settings_or_config(\"SUPPORT_MESSAGE\")",
            "    except AttributeError:",
            "        message = \"\"",
            "    if not message:",
            "        message = DEFAULT_SUPPORT_MESSAGE",
            "    return render_markdown(message)",
            "",
            "",
            "@register.simple_tag",
            "def versioned_static(file_path):",
            "    \"\"\"Returns a versioned static file URL with a query parameter containing the version number.\"\"\"",
            "    url = static(file_path)",
            "    return add_nautobot_version_query_param_to_url(url)",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def hyperlinked_object_with_color(obj):",
            "    \"\"\"Render the display view of an object.\"\"\"",
            "    if obj:",
            "        content = f'<span class=\"label\" style=\"color: {fgcolor(obj.color)}; background-color: #{obj.color}\">{hyperlinked_object(obj)}</span>'",
            "        return format_html(content)",
            "    return \"\u2014\"",
            "",
            "",
            "@register.filter()",
            "def queryset_to_pks(obj):",
            "    \"\"\"Return all object UUIDs as a string separated by `,`\"\"\"",
            "    result = list(obj.values_list(\"pk\", flat=True)) if obj else []",
            "    result = [str(entry) for entry in result]",
            "    return \",\".join(result)"
        ],
        "afterPatchFile": [
            "import datetime",
            "import json",
            "import logging",
            "import re",
            "",
            "from django import template",
            "from django.conf import settings",
            "from django.contrib.staticfiles.finders import find",
            "from django.templatetags.static import static, StaticNode",
            "from django.urls import NoReverseMatch, reverse",
            "from django.utils.html import format_html",
            "from django.utils.safestring import mark_safe",
            "from django.utils.text import slugify as django_slugify",
            "from django_jinja import library",
            "from markdown import markdown",
            "import yaml",
            "",
            "from nautobot.apps.config import get_app_settings_or_config",
            "from nautobot.core import forms",
            "from nautobot.core.utils import color, config, data, logging as nautobot_logging, lookup",
            "from nautobot.core.utils.requests import add_nautobot_version_query_param_to_url",
            "",
            "# S308 is suspicious-mark-safe-usage, but these are all using static strings that we know to be safe",
            "HTML_TRUE = mark_safe('<span class=\"text-success\"><i class=\"mdi mdi-check-bold\" title=\"Yes\"></i></span>')  # noqa: S308",
            "HTML_FALSE = mark_safe('<span class=\"text-danger\"><i class=\"mdi mdi-close-thick\" title=\"No\"></i></span>')  # noqa: S308",
            "HTML_NONE = mark_safe('<span class=\"text-muted\">&mdash;</span>')  # noqa: S308",
            "",
            "DEFAULT_SUPPORT_MESSAGE = (",
            "    \"If further assistance is required, please join the `#nautobot` channel \"",
            "    \"on [Network to Code's Slack community](https://slack.networktocode.com/) and post your question.\"",
            ")",
            "",
            "register = template.Library()",
            "",
            "",
            "logger = logging.getLogger(__name__)",
            "",
            "",
            "#",
            "# Filters",
            "#",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def hyperlinked_object(value, field=\"display\"):",
            "    \"\"\"Render and link to a Django model instance, if any, or render a placeholder if not.",
            "",
            "    Uses the specified object field if available, otherwise uses the string representation of the object.",
            "    If the object defines `get_absolute_url()` this will be used to hyperlink the displayed object;",
            "    additionally if there is an `object.description` this will be used as the title of the hyperlink.",
            "",
            "    Args:",
            "        value (Union[django.db.models.Model, None]): Instance of a Django model or None.",
            "        field (Optional[str]): Name of the field to use for the display value. Defaults to \"display\".",
            "",
            "    Returns:",
            "        (str): String representation of the value (hyperlinked if it defines get_absolute_url()) or a placeholder.",
            "",
            "    Examples:",
            "        >>> hyperlinked_object(device)",
            "        '<a href=\"/dcim/devices/3faafe8c-bdd6-4317-88dc-f791e6988caa/\">Device 1</a>'",
            "        >>> hyperlinked_object(device_role)",
            "        '<a href=\"/dcim/device-roles/router/\" title=\"Devices that are routers, not switches\">Router</a>'",
            "        >>> hyperlinked_object(None)",
            "        '<span class=\"text-muted\">&mdash;</span>'",
            "        >>> hyperlinked_object(\"Hello\")",
            "        'Hello'",
            "        >>> hyperlinked_object(location)",
            "        '<a href=\"/dcim/locations/leaf/\">Root \u2192 Intermediate \u2192 Leaf</a>'",
            "        >>> hyperlinked_object(location, \"name\")",
            "        '<a href=\"/dcim/locations/leaf/\">Leaf</a>'",
            "    \"\"\"",
            "    if value is None:",
            "        return placeholder(value)",
            "    display = getattr(value, field) if hasattr(value, field) else str(value)",
            "    if hasattr(value, \"get_absolute_url\"):",
            "        if hasattr(value, \"description\") and value.description:",
            "            return format_html('<a href=\"{}\" title=\"{}\">{}</a>', value.get_absolute_url(), value.description, display)",
            "        return format_html('<a href=\"{}\">{}</a>', value.get_absolute_url(), display)",
            "    return format_html(\"{}\", display)",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def placeholder(value):",
            "    \"\"\"Render a muted placeholder if value is falsey, else render the value.",
            "",
            "    Args:",
            "        value (any): Input value, can be any variable.",
            "",
            "    Returns:",
            "        (str): Placeholder in HTML, or the string representation of the value.",
            "",
            "    Example:",
            "        >>> placeholder(\"\")",
            "        '<span class=\"text-muted\">&mdash;</span>'",
            "        >>> placeholder(\"hello\")",
            "        \"hello\"",
            "    \"\"\"",
            "    if value:",
            "        return value",
            "    return HTML_NONE",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def add_html_id(element_str, id_str):",
            "    \"\"\"Add an HTML `id=\"...\"` attribute to the given HTML element string.",
            "",
            "    Args:",
            "        element_str (str): String describing an HTML element.",
            "        id_str (str): String to add as the `id` attribute of the element_str.",
            "",
            "    Returns:",
            "        (str): HTML string with added `id`.",
            "",
            "    Example:",
            "        >>> add_html_id(\"<div></div>\", \"my-div\")",
            "        '<div id=\"my-div\"></div>'",
            "        >>> add_html_id('<a href=\"...\" title=\"...\">Hello!</a>', \"my-a\")",
            "        '<a id=\"my-a\" href=\"...\" title=\"...\">Hello!</a>'",
            "    \"\"\"",
            "    match = re.match(r\"^(.*?<\\w+) ?(.*)$\", element_str, flags=re.DOTALL)",
            "    if not match:",
            "        return element_str",
            "    return mark_safe(match.group(1) + format_html(' id=\"{}\" ', id_str) + match.group(2))  # noqa: S308  # suspicious-mark-safe-usage",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def render_boolean(value):",
            "    \"\"\"Render HTML from a computed boolean value.",
            "",
            "    Args:",
            "        value (any): Input value, can be any variable.",
            "            A truthy value (for example non-empty string / True / non-zero number) is considered True.",
            "            A falsey value other than None (for example \"\" or 0 or False) is considered False.",
            "            A value of None is considered neither True nor False.",
            "",
            "    Returns:",
            "        (str): HTML",
            "            '<span class=\"text-success\"><i class=\"mdi mdi-check-bold\" title=\"Yes\"></i></span>' if True value",
            "            - or -",
            "            '<span class=\"text-muted\">&mdash;</span>' if None value",
            "            - or -",
            "            '<span class=\"text-danger\"><i class=\"mdi mdi-close-thick\" title=\"No\"></i></span>' if False value",
            "",
            "    Examples:",
            "        >>> render_boolean(None)",
            "        '<span class=\"text-muted\">&mdash;</span>'",
            "        >>> render_boolean(True or \"arbitrary string\" or 1)",
            "        '<span class=\"text-success\"><i class=\"mdi mdi-check-bold\" title=\"Yes\"></i></span>'",
            "        >>> render_boolean(False or \"\" or 0)",
            "        '<span class=\"text-danger\"><i class=\"mdi mdi-close-thick\" title=\"No\"></i></span>'",
            "    \"\"\"",
            "    if value is None:",
            "        return HTML_NONE",
            "    if bool(value):",
            "        return HTML_TRUE",
            "    return HTML_FALSE",
            "",
            "",
            "@library.filter()",
            "@register.filter(is_safe=True)",
            "def render_markdown(value):",
            "    \"\"\"",
            "    Render text as Markdown",
            "",
            "    Example:",
            "        {{ text | render_markdown }}",
            "    \"\"\"",
            "    # Render Markdown",
            "    html = markdown(value, extensions=[\"fenced_code\", \"tables\"])",
            "",
            "    # Sanitize rendered HTML",
            "    html = nautobot_logging.clean_html(html)",
            "",
            "    return mark_safe(html)  # noqa: S308  # suspicious-mark-safe-usage, OK here since we sanitized the string earlier",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def render_json(value):",
            "    \"\"\"",
            "    Render a dictionary as formatted JSON.",
            "    \"\"\"",
            "    return json.dumps(value, indent=4, sort_keys=True, ensure_ascii=False)",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def render_yaml(value):",
            "    \"\"\"",
            "    Render a dictionary as formatted YAML.",
            "    \"\"\"",
            "    return yaml.dump(json.loads(json.dumps(value, ensure_ascii=False)), allow_unicode=True)",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def meta(obj, attr):",
            "    \"\"\"",
            "    Return the specified Meta attribute of a model. This is needed because Django does not permit templates",
            "    to access attributes which begin with an underscore (e.g. _meta).",
            "",
            "    Args:",
            "        obj (models.Model): Class or Instance of a Django Model",
            "        attr (str): name of the attribute to access",
            "",
            "    Returns:",
            "        (any): return the value of the attribute",
            "    \"\"\"",
            "    return getattr(obj._meta, attr, \"\")",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def viewname(model, action):",
            "    \"\"\"",
            "    Return the view name for the given model and action. Does not perform any validation.",
            "",
            "    Args:",
            "        model (models.Model): Class or Instance of a Django Model",
            "        action (str): name of the action in the viewname",
            "",
            "    Returns:",
            "        (str): return the name of the view for the model/action provided.",
            "    Examples:",
            "        >>> viewname(Device, \"list\")",
            "        \"dcim:device_list\"",
            "    \"\"\"",
            "    return lookup.get_route_for_model(model, action)",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def validated_viewname(model, action):",
            "    \"\"\"",
            "    Return the view name for the given model and action if valid, or None if invalid.",
            "",
            "    Args:",
            "        model (models.Model): Class or Instance of a Django Model",
            "        action (str): name of the action in the viewname",
            "",
            "    Returns:",
            "        (Union[str, None]): return the name of the view for the model/action provided if valid, or None if invalid.",
            "    \"\"\"",
            "    viewname_str = lookup.get_route_for_model(model, action)",
            "",
            "    try:",
            "        # Validate and return the view name. We don't return the actual URL yet because many of the templates",
            "        # are written to pass a name to {% url %}.",
            "        reverse(viewname_str)",
            "        return viewname_str",
            "    except NoReverseMatch:",
            "        return None",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def validated_api_viewname(model, action):",
            "    \"\"\"",
            "    Return the API view name for the given model and action if valid, or None if invalid.",
            "",
            "    Args:",
            "        model (models.Model): Class or Instance of a Django Model",
            "        action (str): name of the action in the viewname",
            "",
            "    Returns:",
            "        (Union[str, None]): return the name of the API view for the model/action provided if valid, or None if invalid.",
            "    \"\"\"",
            "    viewname_str = lookup.get_route_for_model(model, action, api=True)",
            "",
            "    try:",
            "        # Validate and return the view name. We don't return the actual URL yet because many of the templates",
            "        # are written to pass a name to {% url %}.",
            "        if action == \"detail\":",
            "            # Detail views require an argument, so we'll pass a dummy value just for validation",
            "            reverse(viewname_str, args=[\"00000000-0000-0000-0000-000000000000\"])",
            "        else:",
            "            reverse(viewname_str)",
            "        return viewname_str",
            "    except NoReverseMatch:",
            "        return None",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def bettertitle(value):",
            "    \"\"\"",
            "    Alternative to the builtin title(); capitalizes words without replacing letters that are already uppercase.",
            "",
            "    Args:",
            "        value (str): string to convert to Title Case",
            "",
            "    Returns:",
            "        (str): string in Title format",
            "",
            "    Example:",
            "        >>> bettertitle(\"IP address\")",
            "        \"IP Address\"",
            "    \"\"\"",
            "    return \" \".join([w[0].upper() + w[1:] for w in value.split()])",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def humanize_speed(speed):",
            "    \"\"\"",
            "    Humanize speeds given in Kbps. Examples:",
            "",
            "        1544 => \"1.544 Mbps\"",
            "        100000 => \"100 Mbps\"",
            "        10000000 => \"10 Gbps\"",
            "    \"\"\"",
            "    if not speed:",
            "        return \"\"",
            "    if speed >= 1000000000 and speed % 1000000000 == 0:",
            "        return f\"{int(speed / 1000000000)} Tbps\"",
            "    elif speed >= 1000000 and speed % 1000000 == 0:",
            "        return f\"{int(speed / 1000000)} Gbps\"",
            "    elif speed >= 1000 and speed % 1000 == 0:",
            "        return f\"{int(speed / 1000)} Mbps\"",
            "    elif speed >= 1000:",
            "        return f\"{float(speed) / 1000} Mbps\"",
            "    else:",
            "        return f\"{speed} Kbps\"",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def tzoffset(value):",
            "    \"\"\"",
            "    Returns the hour offset of a given time zone using the current time.",
            "    \"\"\"",
            "    return datetime.datetime.now(value).strftime(\"%z\")",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def fgcolor(value):",
            "    \"\"\"",
            "    Return the ideal foreground color (block or white) given an arbitrary background color in RRGGBB format.",
            "",
            "    Args:",
            "        value (str): Color in RRGGBB format, with or without #",
            "",
            "    Returns:",
            "        (str): ideal foreground color, either black (#000000) or white (#ffffff)",
            "",
            "    Example:",
            "        >>> fgcolor(\"#999999\")",
            "        \"#ffffff\"",
            "    \"\"\"",
            "    value = value.lower().strip(\"#\")",
            "    if not re.match(\"^[0-9a-f]{6}$\", value):",
            "        return \"\"",
            "    return f\"#{color.foreground_color(value)}\"",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def divide(x, y):",
            "    \"\"\"Return x/y (rounded).",
            "",
            "    Args:",
            "        x (int or float): dividend number",
            "        y (int or float): divisor number",
            "",
            "    Returns:",
            "        (int): x/y (rounded)",
            "",
            "    Examples:",
            "        >>> divide(10, 3)",
            "        3",
            "    \"\"\"",
            "    if x is None or y is None:",
            "        return None",
            "    return round(x / y)",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def percentage(x, y):",
            "    \"\"\"Return x/y as a percentage.",
            "",
            "    Args:",
            "        x (int or float): dividend number",
            "        y (int or float): divisor number",
            "",
            "    Returns:",
            "        (int): x/y as a percentage",
            "",
            "    Examples:",
            "        >>> percentage(2, 10)",
            "        20",
            "",
            "    \"\"\"",
            "    if x is None or y is None:",
            "        return None",
            "    return round(x / y * 100)",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def get_docs_url(model):",
            "    \"\"\"Return the likely static documentation path for the specified model, if it can be found/predicted.",
            "",
            "    - Core models, as of 2.0, are usually at `docs/user-guide/core-data-model/{app_label}/{model_name}.html`.",
            "        - Models in the `extras` app are usually at `docs/user-guide/platform-functionality/{model_name}.html`.",
            "    - Apps (plugins) are generally expected to be documented at `{app_label}/docs/models/{model_name}.html`.",
            "",
            "    Any model can define a `documentation_static_path` class attribute if it needs to override the above expectations.",
            "",
            "    If a file doesn't exist at the expected static path, this will return None.",
            "",
            "    Args:",
            "        model (models.Model): Instance of a Django model",
            "",
            "    Returns:",
            "        (Union[str, None]): static URL for the documentation of the object or None if not found.",
            "",
            "    Example:",
            "        >>> get_docs_url(location_instance)",
            "        \"static/docs/models/dcim/location.html\"",
            "    \"\"\"",
            "    if hasattr(model, \"documentation_static_path\"):",
            "        path = model.documentation_static_path",
            "    elif model._meta.app_label in settings.PLUGINS:",
            "        path = f\"{model._meta.app_label}/docs/models/{model._meta.model_name}.html\"",
            "    elif model._meta.app_label == \"extras\":",
            "        path = f\"docs/user-guide/platform-functionality/{model._meta.model_name}.html\"",
            "    else:",
            "        path = f\"docs/user-guide/core-data-model/{model._meta.app_label}/{model._meta.model_name}.html\"",
            "",
            "    # Check to see if documentation exists in any of the static paths.",
            "    if find(path):",
            "        return static(path)",
            "    logger.debug(\"No documentation found for %s (expected to find it at %s)\", type(model), path)",
            "    return None",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def has_perms(user, permissions_list):",
            "    \"\"\"",
            "    Return True if the user has *all* permissions in the list.",
            "    \"\"\"",
            "    return user.has_perms(permissions_list)",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def has_one_or_more_perms(user, permissions_list):",
            "    \"\"\"",
            "    Return True if the user has *at least one* permissions in the list.",
            "    \"\"\"",
            "",
            "    for permission in permissions_list:",
            "        if user.has_perm(permission):",
            "            return True",
            "    return False",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def split(string, sep=\",\"):",
            "    \"\"\"Split a string by the given value (default: comma)",
            "",
            "    Args:",
            "        string (str): string to split into a list",
            "        sep (str default=,): separator to look for in the string",
            "",
            "    Returns:",
            "        (list[str]): List of string, if the separator wasn't found, list of 1",
            "    \"\"\"",
            "    return string.split(sep)",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def as_range(n):",
            "    \"\"\"Return a range of n items.",
            "",
            "    Args:",
            "        n (int, str): Number of element in the range",
            "",
            "    Returns:",
            "        (Union[list, Range]): range function from o to the value provided. Returns an empty list if n is not valid.",
            "",
            "    Example:",
            "        {% for i in record.ancestors.count|as_range %}",
            "            <i class=\"mdi mdi-circle-small\"></i>",
            "        {% endfor %}",
            "    \"\"\"",
            "    try:",
            "        int(n)",
            "    except (TypeError, ValueError):",
            "        return []",
            "    return range(int(n))",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def meters_to_feet(n):",
            "    \"\"\"Convert a length from meters to feet.",
            "",
            "    Args:",
            "        n (int, float, str): Number of meters to convert",
            "",
            "    Returns:",
            "        (float): Value in feet",
            "    \"\"\"",
            "    return float(n) * 3.28084",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def get_item(d, key):",
            "    \"\"\"Access a specific item/key in a dictionary",
            "",
            "    Args:",
            "        d (dict): dictionary containing the data to access",
            "        key (str): name of the item/key to access",
            "",
            "    Returns:",
            "        (any): Value of the item in the dictionary provided",
            "",
            "    Example:",
            "        >>> get_item(data, key)",
            "        \"value\"",
            "    \"\"\"",
            "    return d.get(key)",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def settings_or_config(key, app_name=None):",
            "    \"\"\"Get a value from Django settings (if specified there) or Constance configuration (otherwise).\"\"\"",
            "    if app_name:",
            "        return get_app_settings_or_config(app_name, key)",
            "    return config.get_settings_or_config(key)",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def quote_string(value):",
            "    \"\"\"Add literal quote characters around the provided value if it's a string.\"\"\"",
            "    if isinstance(value, str):",
            "        return f'\"{value}\"'",
            "    return value",
            "",
            "",
            "@library.filter()",
            "def slugify(value):",
            "    \"\"\"Return a slugified version of the value.\"\"\"",
            "    return django_slugify(value)",
            "",
            "",
            "#",
            "# Tags",
            "#",
            "",
            "",
            "@register.simple_tag()",
            "def get_attr(obj, attr, default=None):",
            "    return getattr(obj, attr, default)",
            "",
            "",
            "@register.simple_tag()",
            "def querystring(request, **kwargs):",
            "    \"\"\"",
            "    Append or update the page number in a querystring.",
            "    \"\"\"",
            "    querydict = request.GET.copy()",
            "    for k, v in kwargs.items():",
            "        if v is not None:",
            "            querydict[k] = str(v)",
            "        elif k in querydict:",
            "            querydict.pop(k)",
            "    query_string = querydict.urlencode(safe=\"/\")",
            "    if query_string:",
            "        return \"?\" + query_string",
            "    else:",
            "        return \"\"",
            "",
            "",
            "@register.inclusion_tag(\"utilities/templatetags/utilization_graph.html\")",
            "def utilization_graph(utilization_data, warning_threshold=75, danger_threshold=90):",
            "    \"\"\"Wrapper for a horizontal bar graph indicating a percentage of utilization from a tuple of data.",
            "",
            "    Takes the utilization_data that is a namedtuple with numerator and denominator field names and passes them into",
            "    the utilization_graph_raw_data to handle the generation graph data.",
            "",
            "    Args:",
            "        utilization_data (UtilizationData): Namedtuple with numerator and denominator keys",
            "        warning_threshold (int, optional): Warning Threshold Value. Defaults to 75.",
            "        danger_threshold (int, optional): Danger Threshold Value. Defaults to 90.",
            "",
            "    Returns:",
            "        (dict): Dictionary with utilization, warning threshold, danger threshold, utilization count, and total count for",
            "                display",
            "    \"\"\"",
            "    # See https://github.com/nautobot/nautobot/issues/1169",
            "    # If `get_utilization()` threw an exception, utilization_data will be an empty string",
            "    # rather than a UtilizationData instance. Avoid a potentially confusing exception in that case.",
            "    if not isinstance(utilization_data, data.UtilizationData):",
            "        return {}",
            "    return utilization_graph_raw_data(",
            "        numerator=utilization_data.numerator,",
            "        denominator=utilization_data.denominator,",
            "        warning_threshold=warning_threshold,",
            "        danger_threshold=danger_threshold,",
            "    )",
            "",
            "",
            "@register.inclusion_tag(\"utilities/templatetags/utilization_graph.html\")",
            "def utilization_graph_raw_data(numerator, denominator, warning_threshold=75, danger_threshold=90):",
            "    \"\"\"Display a horizontal bar graph indicating a percentage of utilization.",
            "",
            "    Args:",
            "        numerator (int): Numerator for creating a percentage",
            "        denominator (int): Denominator for creating a percentage",
            "        warning_threshold (int, optional): Warning Threshold Value. Defaults to 75.",
            "        danger_threshold (int, optional): Danger Threshold Value. Defaults to 90.",
            "",
            "    Returns:",
            "        (dict): Dictionary with utilization, warning threshold, danger threshold, utilization count, and total count for",
            "                display",
            "    \"\"\"",
            "    # Check for possible division by zero error",
            "    if denominator == 0:",
            "        utilization = 0",
            "    else:",
            "        utilization = int(float(numerator) / denominator * 100)",
            "",
            "    return {",
            "        \"utilization\": utilization,",
            "        \"warning_threshold\": warning_threshold,",
            "        \"danger_threshold\": danger_threshold,",
            "        \"utilization_count\": numerator,",
            "        \"total_count\": denominator,",
            "    }",
            "",
            "",
            "@register.inclusion_tag(\"utilities/templatetags/tag.html\")",
            "def tag(tag, url_name=None):  # pylint: disable=redefined-outer-name",
            "    \"\"\"",
            "    Display a tag, optionally linked to a filtered list of objects.",
            "    \"\"\"",
            "    return {",
            "        \"tag\": tag,",
            "        \"url_name\": url_name,",
            "    }",
            "",
            "",
            "@register.inclusion_tag(\"utilities/templatetags/badge.html\")",
            "def badge(value, show_empty=False):",
            "    \"\"\"",
            "    Display the specified number as a badge.",
            "    \"\"\"",
            "    return {",
            "        \"value\": value,",
            "        \"show_empty\": show_empty,",
            "    }",
            "",
            "",
            "@register.inclusion_tag(\"utilities/templatetags/table_config_form.html\")",
            "def table_config_form(table, table_name=None):",
            "    return {",
            "        \"table_name\": table_name or table.__class__.__name__,",
            "        \"table_config_form\": forms.TableConfigForm(table=table),",
            "    }",
            "",
            "",
            "@register.inclusion_tag(\"utilities/templatetags/filter_form_modal.html\")",
            "def filter_form_modal(",
            "    filter_form,",
            "    dynamic_filter_form,",
            "    model_plural_name,",
            "    filter_form_name=\"FilterForm\",",
            "    dynamic_filter_form_name=\"DynamicFilterForm\",",
            "):",
            "    return {",
            "        \"model_plural_name\": model_plural_name,",
            "        \"filter_form\": filter_form,",
            "        \"filter_form_name\": filter_form_name,",
            "        \"dynamic_filter_form\": dynamic_filter_form,",
            "        \"dynamic_filter_form_name\": dynamic_filter_form_name,",
            "    }",
            "",
            "",
            "@register.inclusion_tag(\"utilities/templatetags/modal_form_as_dialog.html\")",
            "def modal_form_as_dialog(form, editing=False, form_name=None, obj=None, obj_type=None):",
            "    \"\"\"Generate a form in a modal view.",
            "",
            "    Create an overlaying modal view which holds a Django form.",
            "",
            "    Inside of the template the template tag needs to be used with the correct inputs. A button will",
            "    also need to be create to open and close the modal. See below for an example:",
            "",
            "    ```",
            "    {% modal_form_as_dialog form editing=False form_name=\"CreateDevice\" obj=obj obj_type=\"Device\" %}",
            "    <a class=\"btn btn-primary\" data-toggle=\"modal\" data-target=\"#CreateDevice_form\" title=\"Query Form\">Create Device</a>",
            "    ```",
            "    Args:",
            "        form (django.form.Forms): Django form object.",
            "        editing (bool, optional): Is the form creating or editing an object? Defaults to False for create.",
            "        form_name ([type], optional): Name of form. Defaults to None. If None get name from class name.",
            "        obj (django.model.Object, optional): If editing an existing model object, the object needs to be passed in. Defaults to None.",
            "        obj_type (string, optional): Used in title of form to display object type. Defaults to None.",
            "",
            "    Returns:",
            "        (dict): Passed in values used to render HTML.",
            "    \"\"\"",
            "    return {",
            "        \"editing\": editing,",
            "        \"form\": form,",
            "        \"form_action_url\": form.get_action_url(),",
            "        \"form_name\": form_name or form.__class__.__name__,",
            "        \"obj\": obj,",
            "        \"obj_type\": obj_type,",
            "    }",
            "",
            "",
            "@register.simple_tag",
            "def custom_branding_or_static(branding_asset, static_asset):",
            "    \"\"\"",
            "    This tag attempts to return custom branding assets relative to the MEDIA_ROOT and MEDIA_URL, if such",
            "    branding has been configured in settings, else it returns stock branding via static.",
            "    \"\"\"",
            "    if settings.BRANDING_FILEPATHS.get(branding_asset):",
            "        url = f\"{ settings.MEDIA_URL }{ settings.BRANDING_FILEPATHS.get(branding_asset) }\"",
            "    else:",
            "        url = StaticNode.handle_simple(static_asset)",
            "    return add_nautobot_version_query_param_to_url(url)",
            "",
            "",
            "@register.simple_tag",
            "def support_message():",
            "    \"\"\"",
            "    Return the configured support message (if any) or else the default.",
            "    \"\"\"",
            "    try:",
            "        message = config.get_settings_or_config(\"SUPPORT_MESSAGE\")",
            "    except AttributeError:",
            "        message = \"\"",
            "    if not message:",
            "        message = DEFAULT_SUPPORT_MESSAGE",
            "    return render_markdown(message)",
            "",
            "",
            "@register.simple_tag",
            "def versioned_static(file_path):",
            "    \"\"\"Returns a versioned static file URL with a query parameter containing the version number.\"\"\"",
            "    url = static(file_path)",
            "    return add_nautobot_version_query_param_to_url(url)",
            "",
            "",
            "@library.filter()",
            "@register.filter()",
            "def hyperlinked_object_with_color(obj):",
            "    \"\"\"Render the display view of an object.\"\"\"",
            "    if obj:",
            "        content = f'<span class=\"label\" style=\"color: {fgcolor(obj.color)}; background-color: #{obj.color}\">{hyperlinked_object(obj)}</span>'",
            "        return format_html(content)",
            "    return \"\u2014\"",
            "",
            "",
            "@register.filter()",
            "def queryset_to_pks(obj):",
            "    \"\"\"Return all object UUIDs as a string separated by `,`\"\"\"",
            "    result = list(obj.values_list(\"pk\", flat=True)) if obj else []",
            "    result = [str(entry) for entry in result]",
            "    return \",\".join(result)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "11": [],
            "20": [],
            "173": [
                "render_markdown"
            ],
            "174": [
                "render_markdown"
            ],
            "175": [
                "render_markdown"
            ],
            "176": [
                "render_markdown"
            ],
            "177": [
                "render_markdown"
            ],
            "178": [
                "render_markdown"
            ],
            "179": [
                "render_markdown"
            ],
            "180": [
                "render_markdown"
            ]
        },
        "addLocation": []
    },
    "nautobot/core/tests/test_templatetags_helpers.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 79,
                "afterPatchRowNumber": 79,
                "PatchRowcode": "             helpers.render_markdown(\"**bold and _italics_**\"), \"<p><strong>bold and <em>italics</em></strong></p>\""
            },
            "1": {
                "beforePatchRowNumber": 80,
                "afterPatchRowNumber": 80,
                "PatchRowcode": "         )"
            },
            "2": {
                "beforePatchRowNumber": 81,
                "afterPatchRowNumber": 81,
                "PatchRowcode": "         self.assertEqual(helpers.render_markdown(\"* list\"), \"<ul>\\n<li>list</li>\\n</ul>\")"
            },
            "3": {
                "beforePatchRowNumber": 82,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertEqual("
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 82,
                "PatchRowcode": "+        self.assertHTMLEqual("
            },
            "5": {
                "beforePatchRowNumber": 83,
                "afterPatchRowNumber": 83,
                "PatchRowcode": "             helpers.render_markdown(\"[I am a link](https://www.example.com)\"),"
            },
            "6": {
                "beforePatchRowNumber": 84,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            '<p><a href=\"https://www.example.com\">I am a link</a></p>',"
            },
            "7": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 84,
                "PatchRowcode": "+            '<p><a href=\"https://www.example.com\" rel=\"noopener noreferrer\">I am a link</a></p>',"
            },
            "8": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 85,
                "PatchRowcode": "+        )"
            },
            "9": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 86,
                "PatchRowcode": "+"
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 87,
                "PatchRowcode": "+    def test_render_markdown_security(self):"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 88,
                "PatchRowcode": "+        self.assertEqual(helpers.render_markdown('<script>alert(\"XSS\")</script>'), \"\")"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 89,
                "PatchRowcode": "+        self.assertHTMLEqual("
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 90,
                "PatchRowcode": "+            helpers.render_markdown('[link](javascript:alert(\"XSS\"))'),"
            },
            "14": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 91,
                "PatchRowcode": "+            '<p><a title=\"XSS\" rel=\"noopener noreferrer\">link</a>)</p>',  # the trailing ) seems weird to me, but..."
            },
            "15": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 92,
                "PatchRowcode": "+        )"
            },
            "16": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 93,
                "PatchRowcode": "+        self.assertHTMLEqual("
            },
            "17": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 94,
                "PatchRowcode": "+            helpers.render_markdown("
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 95,
                "PatchRowcode": "+                \"[link\\nJS]\""
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 96,
                "PatchRowcode": "+                \"(&#x6A&#x61&#x76&#x61&#x73&#x63&#x72&#x69&#x70&#x74&#x3A\"  # '(javascript:'"
            },
            "20": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 97,
                "PatchRowcode": "+                \"&#x61&#x6C&#x65&#x72&#x74&#x28&#x27&#x58&#x53&#x53&#x27&#x29)\"  # 'alert(\"XSS\"))'"
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 98,
                "PatchRowcode": "+            ),"
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 99,
                "PatchRowcode": "+            '<p><a rel=\"noopener noreferrer\">link JS</a></p>',"
            },
            "23": {
                "beforePatchRowNumber": 85,
                "afterPatchRowNumber": 100,
                "PatchRowcode": "         )"
            },
            "24": {
                "beforePatchRowNumber": 86,
                "afterPatchRowNumber": 101,
                "PatchRowcode": " "
            },
            "25": {
                "beforePatchRowNumber": 87,
                "afterPatchRowNumber": 102,
                "PatchRowcode": "     def test_render_json(self):"
            },
            "26": {
                "beforePatchRowNumber": 240,
                "afterPatchRowNumber": 255,
                "PatchRowcode": "                 self.assertHTMLEqual("
            },
            "27": {
                "beforePatchRowNumber": 241,
                "afterPatchRowNumber": 256,
                "PatchRowcode": "                     helpers.support_message(),"
            },
            "28": {
                "beforePatchRowNumber": 242,
                "afterPatchRowNumber": 257,
                "PatchRowcode": "                     \"<p>If further assistance is required, please join the <code>#nautobot</code> channel \""
            },
            "29": {
                "beforePatchRowNumber": 243,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    'on <a href=\"https://slack.networktocode.com/\">Network to Code\\'s Slack community</a> '"
            },
            "30": {
                "beforePatchRowNumber": 244,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    \"and post your question.</p>\","
            },
            "31": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 258,
                "PatchRowcode": "+                    'on <a href=\"https://slack.networktocode.com/\" rel=\"noopener noreferrer\">Network to Code\\'s '"
            },
            "32": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 259,
                "PatchRowcode": "+                    \"Slack community</a> and post your question.</p>\","
            },
            "33": {
                "beforePatchRowNumber": 245,
                "afterPatchRowNumber": 260,
                "PatchRowcode": "                 )"
            },
            "34": {
                "beforePatchRowNumber": 246,
                "afterPatchRowNumber": 261,
                "PatchRowcode": " "
            },
            "35": {
                "beforePatchRowNumber": 247,
                "afterPatchRowNumber": 262,
                "PatchRowcode": "             with override_config(SUPPORT_MESSAGE=\"Reach out to your support team for assistance.\"):"
            }
        },
        "frontPatchFile": [
            "from unittest import skipIf",
            "",
            "from constance.test import override_config",
            "from django.conf import settings",
            "from django.templatetags.static import static",
            "from django.test import override_settings, TestCase",
            "",
            "from nautobot.core.templatetags import helpers",
            "from nautobot.dcim import models",
            "from nautobot.ipam.models import VLAN",
            "",
            "from example_plugin.models import AnotherExampleModel, ExampleModel",
            "",
            "",
            "@skipIf(",
            "    \"example_plugin\" not in settings.PLUGINS,",
            "    \"example_plugin not in settings.PLUGINS\",",
            ")",
            "class NautobotTemplatetagsHelperTest(TestCase):",
            "    def test_hyperlinked_object(self):",
            "        # None gives a placeholder",
            "        self.assertEqual(helpers.hyperlinked_object(None), helpers.placeholder(None))",
            "        # An object without get_absolute_url gives a string",
            "        self.assertEqual(helpers.hyperlinked_object(\"hello\"), \"hello\")",
            "        # An object with get_absolute_url gives a hyperlink",
            "        location = models.Location.objects.first()",
            "        # Initially remove description if any",
            "        location.description = \"\"",
            "        location.save()",
            "        self.assertEqual(",
            "            helpers.hyperlinked_object(location), f'<a href=\"/dcim/locations/{location.pk}/\">{location.name}</a>'",
            "        )",
            "        # An object with get_absolute_url and a description gives a titled hyperlink",
            "        location.description = \"An important location\"",
            "        location.save()",
            "        self.assertEqual(",
            "            helpers.hyperlinked_object(location),",
            "            f'<a href=\"/dcim/locations/{location.pk}/\" title=\"An important location\">{location.name}</a>',",
            "        )",
            "        # Optionally you can request a field other than the object's display string",
            "        self.assertEqual(",
            "            helpers.hyperlinked_object(location, \"name\"),",
            "            f'<a href=\"/dcim/locations/{location.pk}/\" title=\"An important location\">{location.name}</a>',",
            "        )",
            "        # If you request a nonexistent field, it defaults to the string representation",
            "        self.assertEqual(",
            "            helpers.hyperlinked_object(location, \"foo\"),",
            "            f'<a href=\"/dcim/locations/{location.pk}/\" title=\"An important location\">{location!s}</a>',",
            "        )",
            "",
            "    def test_placeholder(self):",
            "        self.assertEqual(helpers.placeholder(None), '<span class=\"text-muted\">&mdash;</span>')",
            "        self.assertEqual(helpers.placeholder([]), '<span class=\"text-muted\">&mdash;</span>')",
            "        self.assertEqual(helpers.placeholder(\"something\"), \"something\")",
            "",
            "    def test_add_html_id(self):",
            "        # Case where what we have isn't actually a HTML element but just a bare string",
            "        self.assertEqual(helpers.add_html_id(\"hello\", \"my-id\"), \"hello\")",
            "        # Basic success case",
            "        self.assertEqual(helpers.add_html_id(\"<div></div>\", \"my-div\"), '<div id=\"my-div\" ></div>')",
            "        # Cases of more complex HTML",
            "        self.assertEqual(",
            "            helpers.add_html_id('<a href=\"...\" title=\"...\">Hello!</a>', \"my-a\"),",
            "            '<a id=\"my-a\" href=\"...\" title=\"...\">Hello!</a>',",
            "        )",
            "        self.assertEqual(",
            "            helpers.add_html_id('Hello\\n<div class=\"...\">\\nGoodbye\\n</div>', \"my-div\"),",
            "            'Hello\\n<div id=\"my-div\" class=\"...\">\\nGoodbye\\n</div>',",
            "        )",
            "",
            "    def test_render_markdown(self):",
            "        self.assertTrue(callable(helpers.render_markdown))",
            "        # Test common markdown formatting.",
            "        self.assertEqual(helpers.render_markdown(\"**bold**\"), \"<p><strong>bold</strong></p>\")",
            "        self.assertEqual(helpers.render_markdown(\"__bold__\"), \"<p><strong>bold</strong></p>\")",
            "        self.assertEqual(helpers.render_markdown(\"_italics_\"), \"<p><em>italics</em></p>\")",
            "        self.assertEqual(helpers.render_markdown(\"*italics*\"), \"<p><em>italics</em></p>\")",
            "        self.assertEqual(",
            "            helpers.render_markdown(\"**bold and _italics_**\"), \"<p><strong>bold and <em>italics</em></strong></p>\"",
            "        )",
            "        self.assertEqual(helpers.render_markdown(\"* list\"), \"<ul>\\n<li>list</li>\\n</ul>\")",
            "        self.assertEqual(",
            "            helpers.render_markdown(\"[I am a link](https://www.example.com)\"),",
            "            '<p><a href=\"https://www.example.com\">I am a link</a></p>',",
            "        )",
            "",
            "    def test_render_json(self):",
            "        self.assertEqual(",
            "            helpers.render_json({\"first\": [1, 2, 3]}), '{\\n    \"first\": [\\n        1,\\n        2,\\n        3\\n    ]\\n}'",
            "        )",
            "        self.assertEqual('\"I am UTF-8! \ud83d\ude00\"', helpers.render_json(\"I am UTF-8! \ud83d\ude00\"))",
            "",
            "    def test_render_yaml(self):",
            "        self.assertEqual(\"utf8:\\n- \ud83d\ude00\ud83d\ude00\\n- \ud83d\ude00\\n\", helpers.render_yaml({\"utf8\": [\"\ud83d\ude00\ud83d\ude00\", \"\ud83d\ude00\"]}))",
            "",
            "    def test_meta(self):",
            "        location = models.Location.objects.first()",
            "",
            "        self.assertEqual(helpers.meta(location, \"app_label\"), \"dcim\")",
            "        self.assertEqual(helpers.meta(models.Location, \"app_label\"), \"dcim\")",
            "        self.assertEqual(helpers.meta(location, \"not_present\"), \"\")",
            "",
            "        self.assertEqual(helpers.meta(ExampleModel, \"app_label\"), \"example_plugin\")",
            "",
            "    def test_viewname(self):",
            "        location = models.Location.objects.first()",
            "",
            "        self.assertEqual(helpers.viewname(location, \"edit\"), \"dcim:location_edit\")",
            "        self.assertEqual(helpers.viewname(models.Location, \"test\"), \"dcim:location_test\")",
            "",
            "        self.assertEqual(helpers.viewname(ExampleModel, \"edit\"), \"plugins:example_plugin:examplemodel_edit\")",
            "",
            "    def test_validated_viewname(self):",
            "        location = models.Location.objects.first()",
            "",
            "        self.assertEqual(helpers.validated_viewname(location, \"list\"), \"dcim:location_list\")",
            "        self.assertIsNone(helpers.validated_viewname(models.Location, \"notvalid\"))",
            "",
            "        self.assertEqual(helpers.validated_viewname(ExampleModel, \"list\"), \"plugins:example_plugin:examplemodel_list\")",
            "        self.assertIsNone(helpers.validated_viewname(ExampleModel, \"notvalid\"))",
            "",
            "    def test_validated_api_viewname(self):",
            "        location = models.Location.objects.first()",
            "",
            "        self.assertEqual(helpers.validated_api_viewname(location, \"list\"), \"dcim-api:location-list\")",
            "        self.assertIsNone(helpers.validated_api_viewname(models.Location, \"notvalid\"))",
            "",
            "        self.assertEqual(",
            "            helpers.validated_api_viewname(ExampleModel, \"list\"), \"plugins-api:example_plugin-api:examplemodel-list\"",
            "        )",
            "        self.assertIsNone(helpers.validated_api_viewname(ExampleModel, \"notvalid\"))",
            "",
            "        # Assert detail views get validated as well",
            "        self.assertEqual(helpers.validated_api_viewname(location, \"detail\"), \"dcim-api:location-detail\")",
            "",
            "    def test_bettertitle(self):",
            "        self.assertEqual(helpers.bettertitle(\"myTITle\"), \"MyTITle\")",
            "        self.assertEqual(helpers.bettertitle(\"mytitle\"), \"Mytitle\")",
            "        self.assertEqual(helpers.bettertitle(\"my title\"), \"My Title\")",
            "",
            "    def test_humanize_speed(self):",
            "        self.assertEqual(helpers.humanize_speed(1544), \"1.544 Mbps\")",
            "        self.assertEqual(helpers.humanize_speed(100000), \"100 Mbps\")",
            "        self.assertEqual(helpers.humanize_speed(10000000), \"10 Gbps\")",
            "",
            "    def test_tzoffset(self):",
            "        self.assertTrue(callable(helpers.tzoffset))",
            "        # TODO add unit tests for tzoffset",
            "",
            "    def test_fgcolor(self):",
            "        self.assertEqual(helpers.fgcolor(\"#999999\"), \"#ffffff\")",
            "        self.assertEqual(helpers.fgcolor(\"#111111\"), \"#ffffff\")",
            "        self.assertEqual(helpers.fgcolor(\"#000000\"), \"#ffffff\")",
            "        self.assertEqual(helpers.fgcolor(\"#ffffff\"), \"#000000\")",
            "",
            "    def test_divide(self):",
            "        self.assertEqual(helpers.divide(10, 3), 3)",
            "        self.assertEqual(helpers.divide(12, 4), 3)",
            "        self.assertEqual(helpers.divide(11, 3), 4)",
            "",
            "    def test_percentage(self):",
            "        self.assertEqual(helpers.percentage(2, 10), 20)",
            "        self.assertEqual(helpers.percentage(10, 3), 333)",
            "",
            "    def test_get_docs_url(self):",
            "        self.assertTrue(callable(helpers.get_docs_url))",
            "        location = models.Location.objects.first()",
            "        self.assertEqual(helpers.get_docs_url(location), static(\"docs/user-guide/core-data-model/dcim/location.html\"))",
            "        example_model = ExampleModel.objects.create(name=\"test\", number=1)",
            "        self.assertEqual(helpers.get_docs_url(example_model), static(\"example_plugin/docs/models/examplemodel.html\"))",
            "        # AnotherExampleModel does not have documentation.",
            "        another_model = AnotherExampleModel.objects.create(name=\"test\", number=1)",
            "        self.assertIsNone(helpers.get_docs_url(another_model))",
            "",
            "    def test_has_perms(self):",
            "        self.assertTrue(callable(helpers.has_perms))",
            "        # TODO add unit tests for has_perms",
            "",
            "    def test_has_one_or_more_perms(self):",
            "        self.assertTrue(callable(helpers.has_one_or_more_perms))",
            "        # TODO add more unit tests for has_one_or_more_perms",
            "",
            "    def test_split(self):",
            "        self.assertEqual(helpers.split(\"nothing\"), [\"nothing\"])",
            "        self.assertEqual(helpers.split(\"1,2,3\"), [\"1\", \"2\", \"3\"])",
            "        self.assertEqual(helpers.split(\"1,2,3\", \"|\"), [\"1,2,3\"])",
            "        self.assertEqual(helpers.split(\"1|2|3\", \"|\"), [\"1\", \"2\", \"3\"])",
            "",
            "    def test_as_range(self):",
            "        self.assertEqual(helpers.as_range(2), range(0, 2))",
            "        self.assertEqual(helpers.as_range(\"3\"), range(0, 3))",
            "        self.assertEqual(helpers.as_range(\"four\"), [])",
            "",
            "    def test_meters_to_feet(self):",
            "        self.assertEqual(helpers.meters_to_feet(11), 36.08924)",
            "        self.assertEqual(helpers.meters_to_feet(\"22\"), 72.17848)",
            "",
            "    def test_get_item(self):",
            "        data = {\"first\": \"1st\", \"second\": \"2nd\"}",
            "        self.assertEqual(helpers.get_item(data, \"first\"), \"1st\")",
            "        self.assertEqual(helpers.get_item(data, \"second\"), \"2nd\")",
            "",
            "    def test_render_boolean(self):",
            "        for value in [True, \"arbitrary string\", 1]:",
            "            self.assertEqual(",
            "                helpers.render_boolean(value),",
            "                '<span class=\"text-success\"><i class=\"mdi mdi-check-bold\" title=\"Yes\"></i></span>',",
            "            )",
            "        for value in [False, \"\", 0]:",
            "            self.assertEqual(",
            "                helpers.render_boolean(value),",
            "                '<span class=\"text-danger\"><i class=\"mdi mdi-close-thick\" title=\"No\"></i></span>',",
            "            )",
            "        self.assertEqual(helpers.render_boolean(None), '<span class=\"text-muted\">&mdash;</span>')",
            "",
            "    def test_hyperlinked_object_with_color(self):",
            "        vlan_with_role = VLAN.objects.filter(role__isnull=False).first()",
            "        role = vlan_with_role.role",
            "        color = role.color",
            "        fbcolor = helpers.fgcolor(color)",
            "        display = helpers.hyperlinked_object(role)",
            "        self.assertEqual(",
            "            helpers.hyperlinked_object_with_color(obj=role),",
            "            f'<span class=\"label\" style=\"color: {fbcolor}; background-color: #{color}\">{display}</span>',",
            "        )",
            "        # Assert when obj is None",
            "        self.assertEqual(helpers.hyperlinked_object_with_color(obj=None), \"\u2014\")",
            "",
            "    @override_settings(BANNER_TOP=\"\u00a1Hola, mundo!\")",
            "    @override_config(example_plugin__SAMPLE_VARIABLE=\"Testing\")",
            "    def test_settings_or_config(self):",
            "        self.assertEqual(helpers.settings_or_config(\"BANNER_TOP\"), \"\u00a1Hola, mundo!\")",
            "        self.assertEqual(helpers.settings_or_config(\"SAMPLE_VARIABLE\", \"example_plugin\"), \"Testing\")",
            "",
            "    def test_support_message(self):",
            "        \"\"\"Test the `support_message` tag with config and settings.\"\"\"",
            "        with override_settings():",
            "            del settings.SUPPORT_MESSAGE",
            "            with override_config():",
            "                self.assertHTMLEqual(",
            "                    helpers.support_message(),",
            "                    \"<p>If further assistance is required, please join the <code>#nautobot</code> channel \"",
            "                    'on <a href=\"https://slack.networktocode.com/\">Network to Code\\'s Slack community</a> '",
            "                    \"and post your question.</p>\",",
            "                )",
            "",
            "            with override_config(SUPPORT_MESSAGE=\"Reach out to your support team for assistance.\"):",
            "                self.assertHTMLEqual(",
            "                    helpers.support_message(),",
            "                    \"<p>Reach out to your support team for assistance.</p>\",",
            "                )",
            "",
            "        with override_settings(SUPPORT_MESSAGE=\"Settings **support** message:\\n\\n- Item 1\\n- Item 2\"):",
            "            with override_config(SUPPORT_MESSAGE=\"Config support message\"):",
            "                self.assertHTMLEqual(",
            "                    helpers.support_message(),",
            "                    \"<p>Settings <strong>support</strong> message:</p><ul><li>Item 1</li><li>Item 2</li></ul>\",",
            "                )"
        ],
        "afterPatchFile": [
            "from unittest import skipIf",
            "",
            "from constance.test import override_config",
            "from django.conf import settings",
            "from django.templatetags.static import static",
            "from django.test import override_settings, TestCase",
            "",
            "from nautobot.core.templatetags import helpers",
            "from nautobot.dcim import models",
            "from nautobot.ipam.models import VLAN",
            "",
            "from example_plugin.models import AnotherExampleModel, ExampleModel",
            "",
            "",
            "@skipIf(",
            "    \"example_plugin\" not in settings.PLUGINS,",
            "    \"example_plugin not in settings.PLUGINS\",",
            ")",
            "class NautobotTemplatetagsHelperTest(TestCase):",
            "    def test_hyperlinked_object(self):",
            "        # None gives a placeholder",
            "        self.assertEqual(helpers.hyperlinked_object(None), helpers.placeholder(None))",
            "        # An object without get_absolute_url gives a string",
            "        self.assertEqual(helpers.hyperlinked_object(\"hello\"), \"hello\")",
            "        # An object with get_absolute_url gives a hyperlink",
            "        location = models.Location.objects.first()",
            "        # Initially remove description if any",
            "        location.description = \"\"",
            "        location.save()",
            "        self.assertEqual(",
            "            helpers.hyperlinked_object(location), f'<a href=\"/dcim/locations/{location.pk}/\">{location.name}</a>'",
            "        )",
            "        # An object with get_absolute_url and a description gives a titled hyperlink",
            "        location.description = \"An important location\"",
            "        location.save()",
            "        self.assertEqual(",
            "            helpers.hyperlinked_object(location),",
            "            f'<a href=\"/dcim/locations/{location.pk}/\" title=\"An important location\">{location.name}</a>',",
            "        )",
            "        # Optionally you can request a field other than the object's display string",
            "        self.assertEqual(",
            "            helpers.hyperlinked_object(location, \"name\"),",
            "            f'<a href=\"/dcim/locations/{location.pk}/\" title=\"An important location\">{location.name}</a>',",
            "        )",
            "        # If you request a nonexistent field, it defaults to the string representation",
            "        self.assertEqual(",
            "            helpers.hyperlinked_object(location, \"foo\"),",
            "            f'<a href=\"/dcim/locations/{location.pk}/\" title=\"An important location\">{location!s}</a>',",
            "        )",
            "",
            "    def test_placeholder(self):",
            "        self.assertEqual(helpers.placeholder(None), '<span class=\"text-muted\">&mdash;</span>')",
            "        self.assertEqual(helpers.placeholder([]), '<span class=\"text-muted\">&mdash;</span>')",
            "        self.assertEqual(helpers.placeholder(\"something\"), \"something\")",
            "",
            "    def test_add_html_id(self):",
            "        # Case where what we have isn't actually a HTML element but just a bare string",
            "        self.assertEqual(helpers.add_html_id(\"hello\", \"my-id\"), \"hello\")",
            "        # Basic success case",
            "        self.assertEqual(helpers.add_html_id(\"<div></div>\", \"my-div\"), '<div id=\"my-div\" ></div>')",
            "        # Cases of more complex HTML",
            "        self.assertEqual(",
            "            helpers.add_html_id('<a href=\"...\" title=\"...\">Hello!</a>', \"my-a\"),",
            "            '<a id=\"my-a\" href=\"...\" title=\"...\">Hello!</a>',",
            "        )",
            "        self.assertEqual(",
            "            helpers.add_html_id('Hello\\n<div class=\"...\">\\nGoodbye\\n</div>', \"my-div\"),",
            "            'Hello\\n<div id=\"my-div\" class=\"...\">\\nGoodbye\\n</div>',",
            "        )",
            "",
            "    def test_render_markdown(self):",
            "        self.assertTrue(callable(helpers.render_markdown))",
            "        # Test common markdown formatting.",
            "        self.assertEqual(helpers.render_markdown(\"**bold**\"), \"<p><strong>bold</strong></p>\")",
            "        self.assertEqual(helpers.render_markdown(\"__bold__\"), \"<p><strong>bold</strong></p>\")",
            "        self.assertEqual(helpers.render_markdown(\"_italics_\"), \"<p><em>italics</em></p>\")",
            "        self.assertEqual(helpers.render_markdown(\"*italics*\"), \"<p><em>italics</em></p>\")",
            "        self.assertEqual(",
            "            helpers.render_markdown(\"**bold and _italics_**\"), \"<p><strong>bold and <em>italics</em></strong></p>\"",
            "        )",
            "        self.assertEqual(helpers.render_markdown(\"* list\"), \"<ul>\\n<li>list</li>\\n</ul>\")",
            "        self.assertHTMLEqual(",
            "            helpers.render_markdown(\"[I am a link](https://www.example.com)\"),",
            "            '<p><a href=\"https://www.example.com\" rel=\"noopener noreferrer\">I am a link</a></p>',",
            "        )",
            "",
            "    def test_render_markdown_security(self):",
            "        self.assertEqual(helpers.render_markdown('<script>alert(\"XSS\")</script>'), \"\")",
            "        self.assertHTMLEqual(",
            "            helpers.render_markdown('[link](javascript:alert(\"XSS\"))'),",
            "            '<p><a title=\"XSS\" rel=\"noopener noreferrer\">link</a>)</p>',  # the trailing ) seems weird to me, but...",
            "        )",
            "        self.assertHTMLEqual(",
            "            helpers.render_markdown(",
            "                \"[link\\nJS]\"",
            "                \"(&#x6A&#x61&#x76&#x61&#x73&#x63&#x72&#x69&#x70&#x74&#x3A\"  # '(javascript:'",
            "                \"&#x61&#x6C&#x65&#x72&#x74&#x28&#x27&#x58&#x53&#x53&#x27&#x29)\"  # 'alert(\"XSS\"))'",
            "            ),",
            "            '<p><a rel=\"noopener noreferrer\">link JS</a></p>',",
            "        )",
            "",
            "    def test_render_json(self):",
            "        self.assertEqual(",
            "            helpers.render_json({\"first\": [1, 2, 3]}), '{\\n    \"first\": [\\n        1,\\n        2,\\n        3\\n    ]\\n}'",
            "        )",
            "        self.assertEqual('\"I am UTF-8! \ud83d\ude00\"', helpers.render_json(\"I am UTF-8! \ud83d\ude00\"))",
            "",
            "    def test_render_yaml(self):",
            "        self.assertEqual(\"utf8:\\n- \ud83d\ude00\ud83d\ude00\\n- \ud83d\ude00\\n\", helpers.render_yaml({\"utf8\": [\"\ud83d\ude00\ud83d\ude00\", \"\ud83d\ude00\"]}))",
            "",
            "    def test_meta(self):",
            "        location = models.Location.objects.first()",
            "",
            "        self.assertEqual(helpers.meta(location, \"app_label\"), \"dcim\")",
            "        self.assertEqual(helpers.meta(models.Location, \"app_label\"), \"dcim\")",
            "        self.assertEqual(helpers.meta(location, \"not_present\"), \"\")",
            "",
            "        self.assertEqual(helpers.meta(ExampleModel, \"app_label\"), \"example_plugin\")",
            "",
            "    def test_viewname(self):",
            "        location = models.Location.objects.first()",
            "",
            "        self.assertEqual(helpers.viewname(location, \"edit\"), \"dcim:location_edit\")",
            "        self.assertEqual(helpers.viewname(models.Location, \"test\"), \"dcim:location_test\")",
            "",
            "        self.assertEqual(helpers.viewname(ExampleModel, \"edit\"), \"plugins:example_plugin:examplemodel_edit\")",
            "",
            "    def test_validated_viewname(self):",
            "        location = models.Location.objects.first()",
            "",
            "        self.assertEqual(helpers.validated_viewname(location, \"list\"), \"dcim:location_list\")",
            "        self.assertIsNone(helpers.validated_viewname(models.Location, \"notvalid\"))",
            "",
            "        self.assertEqual(helpers.validated_viewname(ExampleModel, \"list\"), \"plugins:example_plugin:examplemodel_list\")",
            "        self.assertIsNone(helpers.validated_viewname(ExampleModel, \"notvalid\"))",
            "",
            "    def test_validated_api_viewname(self):",
            "        location = models.Location.objects.first()",
            "",
            "        self.assertEqual(helpers.validated_api_viewname(location, \"list\"), \"dcim-api:location-list\")",
            "        self.assertIsNone(helpers.validated_api_viewname(models.Location, \"notvalid\"))",
            "",
            "        self.assertEqual(",
            "            helpers.validated_api_viewname(ExampleModel, \"list\"), \"plugins-api:example_plugin-api:examplemodel-list\"",
            "        )",
            "        self.assertIsNone(helpers.validated_api_viewname(ExampleModel, \"notvalid\"))",
            "",
            "        # Assert detail views get validated as well",
            "        self.assertEqual(helpers.validated_api_viewname(location, \"detail\"), \"dcim-api:location-detail\")",
            "",
            "    def test_bettertitle(self):",
            "        self.assertEqual(helpers.bettertitle(\"myTITle\"), \"MyTITle\")",
            "        self.assertEqual(helpers.bettertitle(\"mytitle\"), \"Mytitle\")",
            "        self.assertEqual(helpers.bettertitle(\"my title\"), \"My Title\")",
            "",
            "    def test_humanize_speed(self):",
            "        self.assertEqual(helpers.humanize_speed(1544), \"1.544 Mbps\")",
            "        self.assertEqual(helpers.humanize_speed(100000), \"100 Mbps\")",
            "        self.assertEqual(helpers.humanize_speed(10000000), \"10 Gbps\")",
            "",
            "    def test_tzoffset(self):",
            "        self.assertTrue(callable(helpers.tzoffset))",
            "        # TODO add unit tests for tzoffset",
            "",
            "    def test_fgcolor(self):",
            "        self.assertEqual(helpers.fgcolor(\"#999999\"), \"#ffffff\")",
            "        self.assertEqual(helpers.fgcolor(\"#111111\"), \"#ffffff\")",
            "        self.assertEqual(helpers.fgcolor(\"#000000\"), \"#ffffff\")",
            "        self.assertEqual(helpers.fgcolor(\"#ffffff\"), \"#000000\")",
            "",
            "    def test_divide(self):",
            "        self.assertEqual(helpers.divide(10, 3), 3)",
            "        self.assertEqual(helpers.divide(12, 4), 3)",
            "        self.assertEqual(helpers.divide(11, 3), 4)",
            "",
            "    def test_percentage(self):",
            "        self.assertEqual(helpers.percentage(2, 10), 20)",
            "        self.assertEqual(helpers.percentage(10, 3), 333)",
            "",
            "    def test_get_docs_url(self):",
            "        self.assertTrue(callable(helpers.get_docs_url))",
            "        location = models.Location.objects.first()",
            "        self.assertEqual(helpers.get_docs_url(location), static(\"docs/user-guide/core-data-model/dcim/location.html\"))",
            "        example_model = ExampleModel.objects.create(name=\"test\", number=1)",
            "        self.assertEqual(helpers.get_docs_url(example_model), static(\"example_plugin/docs/models/examplemodel.html\"))",
            "        # AnotherExampleModel does not have documentation.",
            "        another_model = AnotherExampleModel.objects.create(name=\"test\", number=1)",
            "        self.assertIsNone(helpers.get_docs_url(another_model))",
            "",
            "    def test_has_perms(self):",
            "        self.assertTrue(callable(helpers.has_perms))",
            "        # TODO add unit tests for has_perms",
            "",
            "    def test_has_one_or_more_perms(self):",
            "        self.assertTrue(callable(helpers.has_one_or_more_perms))",
            "        # TODO add more unit tests for has_one_or_more_perms",
            "",
            "    def test_split(self):",
            "        self.assertEqual(helpers.split(\"nothing\"), [\"nothing\"])",
            "        self.assertEqual(helpers.split(\"1,2,3\"), [\"1\", \"2\", \"3\"])",
            "        self.assertEqual(helpers.split(\"1,2,3\", \"|\"), [\"1,2,3\"])",
            "        self.assertEqual(helpers.split(\"1|2|3\", \"|\"), [\"1\", \"2\", \"3\"])",
            "",
            "    def test_as_range(self):",
            "        self.assertEqual(helpers.as_range(2), range(0, 2))",
            "        self.assertEqual(helpers.as_range(\"3\"), range(0, 3))",
            "        self.assertEqual(helpers.as_range(\"four\"), [])",
            "",
            "    def test_meters_to_feet(self):",
            "        self.assertEqual(helpers.meters_to_feet(11), 36.08924)",
            "        self.assertEqual(helpers.meters_to_feet(\"22\"), 72.17848)",
            "",
            "    def test_get_item(self):",
            "        data = {\"first\": \"1st\", \"second\": \"2nd\"}",
            "        self.assertEqual(helpers.get_item(data, \"first\"), \"1st\")",
            "        self.assertEqual(helpers.get_item(data, \"second\"), \"2nd\")",
            "",
            "    def test_render_boolean(self):",
            "        for value in [True, \"arbitrary string\", 1]:",
            "            self.assertEqual(",
            "                helpers.render_boolean(value),",
            "                '<span class=\"text-success\"><i class=\"mdi mdi-check-bold\" title=\"Yes\"></i></span>',",
            "            )",
            "        for value in [False, \"\", 0]:",
            "            self.assertEqual(",
            "                helpers.render_boolean(value),",
            "                '<span class=\"text-danger\"><i class=\"mdi mdi-close-thick\" title=\"No\"></i></span>',",
            "            )",
            "        self.assertEqual(helpers.render_boolean(None), '<span class=\"text-muted\">&mdash;</span>')",
            "",
            "    def test_hyperlinked_object_with_color(self):",
            "        vlan_with_role = VLAN.objects.filter(role__isnull=False).first()",
            "        role = vlan_with_role.role",
            "        color = role.color",
            "        fbcolor = helpers.fgcolor(color)",
            "        display = helpers.hyperlinked_object(role)",
            "        self.assertEqual(",
            "            helpers.hyperlinked_object_with_color(obj=role),",
            "            f'<span class=\"label\" style=\"color: {fbcolor}; background-color: #{color}\">{display}</span>',",
            "        )",
            "        # Assert when obj is None",
            "        self.assertEqual(helpers.hyperlinked_object_with_color(obj=None), \"\u2014\")",
            "",
            "    @override_settings(BANNER_TOP=\"\u00a1Hola, mundo!\")",
            "    @override_config(example_plugin__SAMPLE_VARIABLE=\"Testing\")",
            "    def test_settings_or_config(self):",
            "        self.assertEqual(helpers.settings_or_config(\"BANNER_TOP\"), \"\u00a1Hola, mundo!\")",
            "        self.assertEqual(helpers.settings_or_config(\"SAMPLE_VARIABLE\", \"example_plugin\"), \"Testing\")",
            "",
            "    def test_support_message(self):",
            "        \"\"\"Test the `support_message` tag with config and settings.\"\"\"",
            "        with override_settings():",
            "            del settings.SUPPORT_MESSAGE",
            "            with override_config():",
            "                self.assertHTMLEqual(",
            "                    helpers.support_message(),",
            "                    \"<p>If further assistance is required, please join the <code>#nautobot</code> channel \"",
            "                    'on <a href=\"https://slack.networktocode.com/\" rel=\"noopener noreferrer\">Network to Code\\'s '",
            "                    \"Slack community</a> and post your question.</p>\",",
            "                )",
            "",
            "            with override_config(SUPPORT_MESSAGE=\"Reach out to your support team for assistance.\"):",
            "                self.assertHTMLEqual(",
            "                    helpers.support_message(),",
            "                    \"<p>Reach out to your support team for assistance.</p>\",",
            "                )",
            "",
            "        with override_settings(SUPPORT_MESSAGE=\"Settings **support** message:\\n\\n- Item 1\\n- Item 2\"):",
            "            with override_config(SUPPORT_MESSAGE=\"Config support message\"):",
            "                self.assertHTMLEqual(",
            "                    helpers.support_message(),",
            "                    \"<p>Settings <strong>support</strong> message:</p><ul><li>Item 1</li><li>Item 2</li></ul>\",",
            "                )"
        ],
        "action": [
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "82": [
                "NautobotTemplatetagsHelperTest",
                "test_render_markdown"
            ],
            "84": [
                "NautobotTemplatetagsHelperTest",
                "test_render_markdown"
            ],
            "243": [
                "NautobotTemplatetagsHelperTest",
                "test_support_message"
            ],
            "244": [
                "NautobotTemplatetagsHelperTest",
                "test_support_message"
            ]
        },
        "addLocation": []
    },
    "nautobot/core/tests/test_views.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 366,
                "afterPatchRowNumber": 366,
                "PatchRowcode": "         self.assertContains(response, \"Network to Code\", status_code=404)"
            },
            "1": {
                "beforePatchRowNumber": 367,
                "afterPatchRowNumber": 367,
                "PatchRowcode": "         response_content = response.content.decode(response.charset)"
            },
            "2": {
                "beforePatchRowNumber": 368,
                "afterPatchRowNumber": 368,
                "PatchRowcode": "         self.assertInHTML("
            },
            "3": {
                "beforePatchRowNumber": 369,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            \"If further assistance is required, please join the <code>#nautobot</code> channel \""
            },
            "4": {
                "beforePatchRowNumber": 370,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            'on <a href=\"https://slack.networktocode.com/\">Network to Code\\'s Slack community</a> '"
            },
            "5": {
                "beforePatchRowNumber": 371,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            \"and post your question.\","
            },
            "6": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 369,
                "PatchRowcode": "+            \"If further assistance is required, please join the <code>#nautobot</code> channel on \""
            },
            "7": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 370,
                "PatchRowcode": "+            '<a href=\"https://slack.networktocode.com/\" rel=\"noopener noreferrer\">Network to Code\\'s '"
            },
            "8": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 371,
                "PatchRowcode": "+            \"Slack community</a> and post your question.\","
            },
            "9": {
                "beforePatchRowNumber": 372,
                "afterPatchRowNumber": 372,
                "PatchRowcode": "             response_content,"
            },
            "10": {
                "beforePatchRowNumber": 373,
                "afterPatchRowNumber": 373,
                "PatchRowcode": "         )"
            },
            "11": {
                "beforePatchRowNumber": 374,
                "afterPatchRowNumber": 374,
                "PatchRowcode": " "
            },
            "12": {
                "beforePatchRowNumber": 392,
                "afterPatchRowNumber": 392,
                "PatchRowcode": "         self.assertContains(response, \"Network to Code\", status_code=500)"
            },
            "13": {
                "beforePatchRowNumber": 393,
                "afterPatchRowNumber": 393,
                "PatchRowcode": "         response_content = response.content.decode(response.charset)"
            },
            "14": {
                "beforePatchRowNumber": 394,
                "afterPatchRowNumber": 394,
                "PatchRowcode": "         self.assertInHTML("
            },
            "15": {
                "beforePatchRowNumber": 395,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            \"If further assistance is required, please join the <code>#nautobot</code> channel \""
            },
            "16": {
                "beforePatchRowNumber": 396,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            'on <a href=\"https://slack.networktocode.com/\">Network to Code\\'s Slack community</a> '"
            },
            "17": {
                "beforePatchRowNumber": 397,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            \"and post your question.\","
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 395,
                "PatchRowcode": "+            \"If further assistance is required, please join the <code>#nautobot</code> channel on \""
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 396,
                "PatchRowcode": "+            '<a href=\"https://slack.networktocode.com/\" rel=\"noopener noreferrer\">Network to Code\\'s '"
            },
            "20": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 397,
                "PatchRowcode": "+            \"Slack community</a> and post your question.\","
            },
            "21": {
                "beforePatchRowNumber": 398,
                "afterPatchRowNumber": 398,
                "PatchRowcode": "             response_content,"
            },
            "22": {
                "beforePatchRowNumber": 399,
                "afterPatchRowNumber": 399,
                "PatchRowcode": "         )"
            },
            "23": {
                "beforePatchRowNumber": 400,
                "afterPatchRowNumber": 400,
                "PatchRowcode": " "
            },
            "24": {
                "beforePatchRowNumber": 401,
                "afterPatchRowNumber": 401,
                "PatchRowcode": "     @override_settings(DEBUG=False, SUPPORT_MESSAGE=\"Hello world!\")"
            },
            "25": {
                "beforePatchRowNumber": 402,
                "afterPatchRowNumber": 402,
                "PatchRowcode": "     @mock.patch(\"nautobot.core.views.HomeView.get\", side_effect=Exception)"
            },
            "26": {
                "beforePatchRowNumber": 403,
                "afterPatchRowNumber": 403,
                "PatchRowcode": "     def test_500_custom_support_message(self, mock_get):"
            },
            "27": {
                "beforePatchRowNumber": 404,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        \"\"\"Nautobot's custom 500 page should be used and should include a default support message.\"\"\""
            },
            "28": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 404,
                "PatchRowcode": "+        \"\"\"Nautobot's custom 500 page should be used and should include a custom support message if defined.\"\"\""
            },
            "29": {
                "beforePatchRowNumber": 405,
                "afterPatchRowNumber": 405,
                "PatchRowcode": "         url = reverse(\"home\")"
            },
            "30": {
                "beforePatchRowNumber": 406,
                "afterPatchRowNumber": 406,
                "PatchRowcode": "         with self.assertTemplateUsed(\"500.html\"):"
            },
            "31": {
                "beforePatchRowNumber": 407,
                "afterPatchRowNumber": 407,
                "PatchRowcode": "             self.client.raise_request_exception = False"
            }
        },
        "frontPatchFile": [
            "import re",
            "from unittest import mock",
            "import urllib.parse",
            "",
            "from django.contrib.contenttypes.models import ContentType",
            "from django.core.files.uploadedfile import SimpleUploadedFile",
            "from django.test import override_settings, RequestFactory",
            "from django.test.utils import override_script_prefix",
            "from django.urls import get_script_prefix, reverse",
            "from prometheus_client.parser import text_string_to_metric_families",
            "",
            "from nautobot.core.testing import TestCase",
            "from nautobot.core.utils.permissions import get_permission_for_model",
            "from nautobot.core.views.mixins import GetReturnURLMixin",
            "from nautobot.dcim.models.locations import Location",
            "from nautobot.extras.choices import CustomFieldTypeChoices",
            "from nautobot.extras.models import FileProxy",
            "from nautobot.extras.models.customfields import CustomField, CustomFieldChoice",
            "from nautobot.extras.registry import registry",
            "from nautobot.users.models import ObjectPermission",
            "",
            "",
            "class GetReturnURLMixinTestCase(TestCase):",
            "    \"\"\"Tests for the API of GetReturnURLMixin.\"\"\"",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        cls.factory = RequestFactory(SERVER_NAME=\"nautobot.example.com\")",
            "        cls.mixin = GetReturnURLMixin()",
            "",
            "    def test_get_return_url_explicit(self):",
            "        request = self.factory.get(\"/\", {\"return_url\": \"/dcim/devices/\"})",
            "        self.assertEqual(self.mixin.get_return_url(request=request, obj=None), \"/dcim/devices/\")",
            "        self.assertEqual(self.mixin.get_return_url(request=request, obj=Location.objects.first()), \"/dcim/devices/\")",
            "",
            "        request = self.factory.get(\"/\", {\"return_url\": \"/dcim/devices/?status=Active\"})",
            "        self.assertEqual(self.mixin.get_return_url(request=request, obj=None), \"/dcim/devices/?status=Active\")",
            "",
            "    def test_get_return_url_explicit_unsafe(self):",
            "        request = self.factory.get(\"/\", {\"return_url\": \"http://example.com\"})",
            "        self.assertEqual(self.mixin.get_return_url(request=request, obj=None), reverse(\"home\"))",
            "",
            "    def test_get_return_url_explicit_punycode(self):",
            "        \"\"\"",
            "        Replace the 'i' in '/dcim/' with a unicode dotless '\u0131' and make sure we're not fooled by it.",
            "        \"\"\"  # noqa: RUF002  # ambiguous-unicode-character-docstring -- fully intentional here!",
            "        request = self.factory.get(\"/\", {\"return_url\": \"/dc\u0131m/devices/\"})  # noqa: RUF001  # ambiguous-unicode-character-string -- fully intentional here!",
            "        self.assertEqual(self.mixin.get_return_url(request=request, obj=None), \"/dc%C4%B1m/devices/\")",
            "",
            "    def test_get_return_url_default_with_obj(self):",
            "        request = self.factory.get(\"/\")",
            "        location = Location.objects.first()",
            "        self.assertEqual(self.mixin.get_return_url(request=request, obj=location), location.get_absolute_url())",
            "",
            "",
            "class HomeViewTestCase(TestCase):",
            "    def test_home(self):",
            "        url = reverse(\"home\")",
            "",
            "        response = self.client.get(url)",
            "        self.assertHttpStatus(response, 200)",
            "",
            "    def test_search(self):",
            "        url = reverse(\"search\")",
            "        params = {",
            "            \"q\": \"foo\",",
            "        }",
            "",
            "        response = self.client.get(f\"{url}?{urllib.parse.urlencode(params)}\")",
            "        self.assertHttpStatus(response, 200)",
            "",
            "    def make_request(self):",
            "        url = reverse(\"home\")",
            "        response = self.client.get(url)",
            "",
            "        # Search bar in nav",
            "        nav_search_bar_pattern = re.compile(",
            "            '<nav.*<form action=\"/search/\" method=\"get\" class=\"navbar-form\" id=\"navbar_search\" role=\"search\">.*</form>.*</nav>'",
            "        )",
            "        nav_search_bar_result = nav_search_bar_pattern.search(",
            "            response.content.decode(response.charset).replace(\"\\n\", \"\")",
            "        )",
            "",
            "        # Global search bar in body/container-fluid wrapper",
            "        body_search_bar_pattern = re.compile(",
            "            '<div class=\"container-fluid wrapper\">.*<form action=\"/search/\" method=\"get\" class=\"form-inline\">.*</form>.*</div>'",
            "        )",
            "        body_search_bar_result = body_search_bar_pattern.search(",
            "            response.content.decode(response.charset).replace(\"\\n\", \"\")",
            "        )",
            "",
            "        return nav_search_bar_result, body_search_bar_result",
            "",
            "    def test_search_bar_not_visible_if_user_not_authenticated(self):",
            "        self.client.logout()",
            "",
            "        nav_search_bar_result, body_search_bar_result = self.make_request()",
            "",
            "        self.assertIsNone(nav_search_bar_result)",
            "        self.assertIsNone(body_search_bar_result)",
            "",
            "    def test_search_bar_visible_if_user_authenticated(self):",
            "        nav_search_bar_result, body_search_bar_result = self.make_request()",
            "",
            "        self.assertIsNotNone(nav_search_bar_result)",
            "        self.assertIsNotNone(body_search_bar_result)",
            "",
            "    @override_settings(VERSION=\"1.2.3\")",
            "    def test_footer_version_visible_authenticated_users_only(self):",
            "        url = reverse(\"home\")",
            "        response = self.client.get(url)",
            "        response_content = response.content.decode(response.charset).replace(\"\\n\", \"\")",
            "",
            "        footer_hostname_version_pattern = re.compile(r'<p class=\"text-muted\">\\s+\\S+\\s+\\(v1\\.2\\.3\\)\\s+</p>')",
            "        self.assertRegex(response_content, footer_hostname_version_pattern)",
            "",
            "        self.client.logout()",
            "        response = self.client.get(url)",
            "        response_content = response.content.decode(response.charset).replace(\"\\n\", \"\")",
            "        self.assertNotRegex(response_content, footer_hostname_version_pattern)",
            "",
            "",
            "@override_settings(BRANDING_TITLE=\"Nautobot\")",
            "class SearchFieldsTestCase(TestCase):",
            "    def test_search_bar_redirect_to_login(self):",
            "        self.client.logout()",
            "        response = self.client.get(reverse(\"search\") + \"?q=prefix\")",
            "        # Assert that if the user is not logged in",
            "        # SearchForm will redirect the user to the login Page",
            "        self.assertEqual(response.status_code, 302)",
            "",
            "    def test_global_and_model_search_bar(self):",
            "        self.add_permissions(\"dcim.view_location\", \"dcim.view_device\")",
            "",
            "        # Assert model search bar present in list UI",
            "        response = self.client.get(reverse(\"dcim:location_list\"))",
            "        self.assertInHTML(",
            "            '<input type=\"text\" name=\"q\" class=\"form-control\" required placeholder=\"Search Locations\" id=\"id_q\">',",
            "            response.content.decode(response.charset),",
            "        )",
            "",
            "        response = self.client.get(reverse(\"dcim:device_list\"))",
            "        self.assertInHTML(",
            "            '<input type=\"text\" name=\"q\" class=\"form-control\" required placeholder=\"Search Devices\" id=\"id_q\">',",
            "            response.content.decode(response.charset),",
            "        )",
            "",
            "        # Assert global search bar present in UI",
            "        self.assertInHTML(",
            "            '<input type=\"text\" name=\"q\" class=\"form-control\" placeholder=\"Search Nautobot\">',",
            "            response.content.decode(response.charset),",
            "        )",
            "",
            "",
            "class FilterFormsTestCase(TestCase):",
            "    def test_support_for_both_default_and_dynamic_filter_form_in_ui(self):",
            "        self.add_permissions(\"dcim.view_location\", \"circuits.view_circuit\")",
            "",
            "        filter_tabs = \"\"\"",
            "            <ul id=\"tabs\" class=\"nav nav-tabs\">",
            "                <li role=\"presentation\" class=\"active\">",
            "                    <a href=\"#default-filter\" role=\"tab\" data-toggle=\"tab\">",
            "                        Default",
            "                    </a>",
            "                </li>",
            "                <li role=\"presentation\" class=\"\">",
            "                    <a href=\"#advanced-filter\" role=\"tab\" data-toggle=\"tab\">",
            "                        Advanced",
            "                    </a>",
            "                </li>",
            "            </ul>",
            "            \"\"\"",
            "",
            "        response = self.client.get(reverse(\"dcim:location_list\"))",
            "        self.assertInHTML(",
            "            filter_tabs,",
            "            response.content.decode(response.charset),",
            "        )",
            "",
            "        response = self.client.get(reverse(\"circuits:circuit_list\"))",
            "        self.assertInHTML(",
            "            filter_tabs,",
            "            response.content.decode(response.charset),",
            "        )",
            "",
            "    def test_filtering_on_custom_select_filter_field(self):",
            "        \"\"\"Assert CustomField select and multiple select fields can be filtered using multiple entries\"\"\"",
            "        self.add_permissions(\"dcim.view_location\")",
            "",
            "        multi_select_cf = CustomField.objects.create(",
            "            type=CustomFieldTypeChoices.TYPE_MULTISELECT, label=\"Multiple Choice\"",
            "        )",
            "        select_cf = CustomField.objects.create(type=CustomFieldTypeChoices.TYPE_SELECT, label=\"choice\")",
            "        choices = [\"Foo\", \"Bar\", \"FooBar\"]",
            "        for cf in [multi_select_cf, select_cf]:",
            "            cf.content_types.set([ContentType.objects.get_for_model(Location)])",
            "            CustomFieldChoice.objects.create(custom_field=cf, value=choices[0])",
            "            CustomFieldChoice.objects.create(custom_field=cf, value=choices[1])",
            "            CustomFieldChoice.objects.create(custom_field=cf, value=choices[2])",
            "",
            "        locations = Location.objects.all()[:3]",
            "        for idx, location in enumerate(locations):",
            "            location.cf[multi_select_cf.key] = choices[:2]",
            "            location.cf[select_cf.key] = choices[idx]",
            "            location.save()",
            "",
            "        query_param = (",
            "            f\"?cf_{multi_select_cf.key}={choices[0]}&cf_{multi_select_cf.key}={choices[1]}\"",
            "            f\"&cf_{select_cf.key}={choices[0]}&cf_{select_cf.key}={choices[1]}\"",
            "        )",
            "        url = reverse(\"dcim:location_list\") + query_param",
            "        response = self.client.get(url)",
            "        response_content = response.content.decode(response.charset).replace(\"\\n\", \"\")",
            "        self.assertInHTML(locations[0].name, response_content)",
            "        self.assertInHTML(locations[1].name, response_content)",
            "",
            "",
            "class ForceScriptNameTestcase(TestCase):",
            "    \"\"\"Basic test to assert that `settings.FORCE_SCRIPT_NAME` works as intended.\"\"\"",
            "",
            "    @override_settings(",
            "        FORCE_SCRIPT_NAME=\"/nautobot/\",",
            "    )",
            "    @override_script_prefix(\"/nautobot/\")",
            "    def test_subdirectory_routes(self):",
            "        # We must call `set_script_prefix()` to set the URL resolver script prefix outside of the",
            "        # request/response cycle (e.g. in scripts/tests) to generate correct URLs when `SCRIPT_NAME`",
            "        # is not `/`.",
            "        #",
            "        # We must then call it again to reset the script pefix after we're done because",
            "        # the state is stored in the thread-local scope and will \"infect\" other tests.",
            "        prefix = get_script_prefix()",
            "        self.assertEqual(prefix, \"/nautobot/\")",
            "",
            "        # And that routes will start w/ the prefix vs. just \"/\" (the default).",
            "        routes = (\"home\", \"login\", \"search\", \"api-root\")",
            "        for route in routes:",
            "            url = reverse(route)",
            "            self.assertTrue(url.startswith(prefix))",
            "",
            "",
            "class NavRestrictedUI(TestCase):",
            "    def setUp(self):",
            "        super().setUp()",
            "",
            "        self.url = reverse(\"plugins:plugins_list\")",
            "        self.item_weight = 100  # TODO: not easy to introspect from the nav menu struct, so hard-code it here for now",
            "",
            "    def make_request(self):",
            "        response = self.client.get(reverse(\"home\"))",
            "        return response.content.decode(response.charset)",
            "",
            "    def test_installed_apps_visible_to_staff(self):",
            "        \"\"\"The \"Installed Apps\" menu item should be available to is_staff user.\"\"\"",
            "        # Make user admin",
            "        self.user.is_staff = True",
            "        self.user.save()",
            "",
            "        response_content = self.make_request()",
            "        self.assertInHTML(",
            "            f\"\"\"",
            "            <a href=\"{self.url}\"",
            "                data-item-weight=\"{self.item_weight}\">",
            "                Installed Plugins",
            "            </a>",
            "            \"\"\",",
            "            response_content,",
            "        )",
            "",
            "    def test_installed_apps_not_visible_to_non_staff_user_without_permission(self):",
            "        \"\"\"The \"Installed Apps\" menu item should be hidden from a non-staff user without permission.\"\"\"",
            "        response_content = self.make_request()",
            "",
            "        self.assertNotRegex(response_content, r\"Installed\\s+Plugins\")",
            "",
            "",
            "class LoginUI(TestCase):",
            "    def setUp(self):",
            "        super().setUp()",
            "",
            "        self.footer_elements = [",
            "            '<a href=\"#theme_modal\" data-toggle=\"modal\" data-target=\"#theme_modal\" id=\"btn-theme-modal\"><i class=\"mdi mdi-theme-light-dark text-primary\"></i>Theme</a>',",
            "            '<a href=\"/static/docs/index.html\">Docs</a>',",
            "            '<i class=\"mdi mdi-cloud-braces text-primary\"></i> <a href=\"/api/docs/\">API</a>',",
            "            '<i class=\"mdi mdi-graphql text-primary\"></i> <a href=\"/graphql/\">GraphQL</a>',",
            "            '<i class=\"mdi mdi-xml text-primary\"></i> <a href=\"https://github.com/nautobot/nautobot\">Code</a>',",
            "            '<i class=\"mdi mdi-lifebuoy text-primary\"></i> <a href=\"https://github.com/nautobot/nautobot/wiki\">Help</a>',",
            "        ]",
            "",
            "    def make_request(self):",
            "        response = self.client.get(reverse(\"login\"))",
            "        sso_login_pattern = re.compile('<a href=\".*\">Continue with SSO</a>')",
            "        return sso_login_pattern.search(response.content.decode(response.charset))",
            "",
            "    def test_sso_login_button_not_visible(self):",
            "        \"\"\"Test Continue with SSO button not visible if SSO is enabled\"\"\"",
            "        self.client.logout()",
            "",
            "        sso_login_search_result = self.make_request()",
            "        self.assertIsNone(sso_login_search_result)",
            "",
            "    @override_settings(",
            "        AUTHENTICATION_BACKENDS=[",
            "            \"social_core.backends.google.GoogleOAuth2\",",
            "            \"nautobot.core.authentication.ObjectPermissionBackend\",",
            "        ]",
            "    )",
            "    def test_sso_login_button_visible(self):",
            "        self.client.logout()",
            "        sso_login_search_result = self.make_request()",
            "        self.assertIsNotNone(sso_login_search_result)",
            "",
            "    @override_settings(BANNER_TOP=\"Hello, Banner Top\", BANNER_BOTTOM=\"Hello, Banner Bottom\")",
            "    def test_routes_redirect_back_to_login_unauthenticated(self):",
            "        \"\"\"Assert that api docs and graphql redirects to login page if user is unauthenticated.\"\"\"",
            "        self.client.logout()",
            "        headers = {\"HTTP_ACCEPT\": \"text/html\"}",
            "        urls = [reverse(\"api_docs\"), reverse(\"graphql\")]",
            "        for url in urls:",
            "            response = self.client.get(url, follow=True, **headers)",
            "            self.assertHttpStatus(response, 200)",
            "            redirect_chain = [(f\"/login/?next={url}\", 302)]",
            "            self.assertEqual(response.redirect_chain, redirect_chain)",
            "            response_content = response.content.decode(response.charset).replace(\"\\n\", \"\")",
            "            # Assert Footer items(`self.footer_elements`), Banner and Banner Top is hidden",
            "            for footer_text in self.footer_elements:",
            "                self.assertNotIn(footer_text, response_content)",
            "            # Only API Docs implements BANNERS",
            "            if url == urls[0]:",
            "                self.assertNotIn(\"Hello, Banner Top\", response_content)",
            "                self.assertNotIn(\"Hello, Banner Bottom\", response_content)",
            "",
            "",
            "class MetricsViewTestCase(TestCase):",
            "    def query_and_parse_metrics(self):",
            "        response = self.client.get(reverse(\"metrics\"))",
            "        self.assertHttpStatus(response, 200, msg=\"/metrics should return a 200 HTTP status code.\")",
            "        page_content = response.content.decode(response.charset)",
            "        return text_string_to_metric_families(page_content)",
            "",
            "    def test_metrics_extensibility(self):",
            "        \"\"\"Assert that the example metric from the example plugin shows up _exactly_ when the plugin is enabled.\"\"\"",
            "        test_metric_name = \"nautobot_example_metric_count\"",
            "        metrics_with_plugin = self.query_and_parse_metrics()",
            "        metric_names_with_plugin = {metric.name for metric in metrics_with_plugin}",
            "        self.assertIn(test_metric_name, metric_names_with_plugin)",
            "        with override_settings(PLUGINS=[]):",
            "            # Clear out the app metric registry because it is not updated when settings are changed but Nautobot is not",
            "            # restarted.",
            "            registry[\"app_metrics\"].clear()",
            "            metrics_without_plugin = self.query_and_parse_metrics()",
            "            metric_names_without_plugin = {metric.name for metric in metrics_without_plugin}",
            "            self.assertNotIn(test_metric_name, metric_names_without_plugin)",
            "        metric_names_with_plugin.remove(test_metric_name)",
            "        self.assertSetEqual(metric_names_with_plugin, metric_names_without_plugin)",
            "",
            "",
            "class ErrorPagesTestCase(TestCase):",
            "    \"\"\"Tests for 4xx and 5xx error page rendering.\"\"\"",
            "",
            "    @override_settings(DEBUG=False)",
            "    def test_404_default_support_message(self):",
            "        \"\"\"Nautobot's custom 404 page should be used and should include a default support message.\"\"\"",
            "        with self.assertTemplateUsed(\"404.html\"):",
            "            response = self.client.get(\"/foo/bar\")",
            "        self.assertContains(response, \"Network to Code\", status_code=404)",
            "        response_content = response.content.decode(response.charset)",
            "        self.assertInHTML(",
            "            \"If further assistance is required, please join the <code>#nautobot</code> channel \"",
            "            'on <a href=\"https://slack.networktocode.com/\">Network to Code\\'s Slack community</a> '",
            "            \"and post your question.\",",
            "            response_content,",
            "        )",
            "",
            "    @override_settings(DEBUG=False, SUPPORT_MESSAGE=\"Hello world!\")",
            "    def test_404_custom_support_message(self):",
            "        \"\"\"Nautobot's custom 404 page should be used and should include a custom support message if defined.\"\"\"",
            "        with self.assertTemplateUsed(\"404.html\"):",
            "            response = self.client.get(\"/foo/bar\")",
            "        self.assertNotContains(response, \"Network to Code\", status_code=404)",
            "        response_content = response.content.decode(response.charset)",
            "        self.assertInHTML(\"Hello world!\", response_content)",
            "",
            "    @override_settings(DEBUG=False)",
            "    @mock.patch(\"nautobot.core.views.HomeView.get\", side_effect=Exception)",
            "    def test_500_default_support_message(self, mock_get):",
            "        \"\"\"Nautobot's custom 500 page should be used and should include a default support message.\"\"\"",
            "        url = reverse(\"home\")",
            "        with self.assertTemplateUsed(\"500.html\"):",
            "            self.client.raise_request_exception = False",
            "            response = self.client.get(url)",
            "        self.assertContains(response, \"Network to Code\", status_code=500)",
            "        response_content = response.content.decode(response.charset)",
            "        self.assertInHTML(",
            "            \"If further assistance is required, please join the <code>#nautobot</code> channel \"",
            "            'on <a href=\"https://slack.networktocode.com/\">Network to Code\\'s Slack community</a> '",
            "            \"and post your question.\",",
            "            response_content,",
            "        )",
            "",
            "    @override_settings(DEBUG=False, SUPPORT_MESSAGE=\"Hello world!\")",
            "    @mock.patch(\"nautobot.core.views.HomeView.get\", side_effect=Exception)",
            "    def test_500_custom_support_message(self, mock_get):",
            "        \"\"\"Nautobot's custom 500 page should be used and should include a default support message.\"\"\"",
            "        url = reverse(\"home\")",
            "        with self.assertTemplateUsed(\"500.html\"):",
            "            self.client.raise_request_exception = False",
            "            response = self.client.get(url)",
            "        self.assertNotContains(response, \"Network to Code\", status_code=500)",
            "        response_content = response.content.decode(response.charset)",
            "        self.assertInHTML(\"Hello world!\", response_content)",
            "",
            "",
            "class DBFileStorageViewTestCase(TestCase):",
            "    \"\"\"Test authentication/permission enforcement for django_db_file_storage views.\"\"\"",
            "",
            "    def setUp(self):",
            "        super().setUp()",
            "        self.test_file_1 = SimpleUploadedFile(name=\"test_file_1.txt\", content=b\"I am content.\\n\")",
            "        self.file_proxy_1 = FileProxy.objects.create(name=self.test_file_1.name, file=self.test_file_1)",
            "        self.test_file_2 = SimpleUploadedFile(name=\"test_file_2.txt\", content=b\"I am content.\\n\")",
            "        self.file_proxy_2 = FileProxy.objects.create(name=self.test_file_2.name, file=self.test_file_2)",
            "        self.url = f\"{reverse('db_file_storage.download_file')}?name={self.file_proxy_1.file.name}\"",
            "",
            "    def test_get_file_anonymous(self):",
            "        self.client.logout()",
            "        response = self.client.get(self.url)",
            "        self.assertHttpStatus(response, 403)",
            "",
            "    def test_get_file_without_permission(self):",
            "        response = self.client.get(self.url)",
            "        self.assertHttpStatus(response, 403)",
            "",
            "    def test_get_object_with_permission(self):",
            "        self.add_permissions(get_permission_for_model(FileProxy, \"view\"))",
            "        response = self.client.get(self.url)",
            "        self.assertHttpStatus(response, 200)",
            "",
            "    def test_get_object_with_constrained_permission(self):",
            "        obj_perm = ObjectPermission(",
            "            name=\"Test permission\",",
            "            constraints={\"pk\": self.file_proxy_1.pk},",
            "            actions=[\"view\"],",
            "        )",
            "        obj_perm.save()",
            "        obj_perm.users.add(self.user)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(FileProxy))",
            "        response = self.client.get(self.url)",
            "        self.assertHttpStatus(response, 200)",
            "        url = f\"{reverse('db_file_storage.download_file')}?name={self.file_proxy_2.file.name}\"",
            "        response = self.client.get(url)",
            "        self.assertHttpStatus(response, 404)"
        ],
        "afterPatchFile": [
            "import re",
            "from unittest import mock",
            "import urllib.parse",
            "",
            "from django.contrib.contenttypes.models import ContentType",
            "from django.core.files.uploadedfile import SimpleUploadedFile",
            "from django.test import override_settings, RequestFactory",
            "from django.test.utils import override_script_prefix",
            "from django.urls import get_script_prefix, reverse",
            "from prometheus_client.parser import text_string_to_metric_families",
            "",
            "from nautobot.core.testing import TestCase",
            "from nautobot.core.utils.permissions import get_permission_for_model",
            "from nautobot.core.views.mixins import GetReturnURLMixin",
            "from nautobot.dcim.models.locations import Location",
            "from nautobot.extras.choices import CustomFieldTypeChoices",
            "from nautobot.extras.models import FileProxy",
            "from nautobot.extras.models.customfields import CustomField, CustomFieldChoice",
            "from nautobot.extras.registry import registry",
            "from nautobot.users.models import ObjectPermission",
            "",
            "",
            "class GetReturnURLMixinTestCase(TestCase):",
            "    \"\"\"Tests for the API of GetReturnURLMixin.\"\"\"",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        cls.factory = RequestFactory(SERVER_NAME=\"nautobot.example.com\")",
            "        cls.mixin = GetReturnURLMixin()",
            "",
            "    def test_get_return_url_explicit(self):",
            "        request = self.factory.get(\"/\", {\"return_url\": \"/dcim/devices/\"})",
            "        self.assertEqual(self.mixin.get_return_url(request=request, obj=None), \"/dcim/devices/\")",
            "        self.assertEqual(self.mixin.get_return_url(request=request, obj=Location.objects.first()), \"/dcim/devices/\")",
            "",
            "        request = self.factory.get(\"/\", {\"return_url\": \"/dcim/devices/?status=Active\"})",
            "        self.assertEqual(self.mixin.get_return_url(request=request, obj=None), \"/dcim/devices/?status=Active\")",
            "",
            "    def test_get_return_url_explicit_unsafe(self):",
            "        request = self.factory.get(\"/\", {\"return_url\": \"http://example.com\"})",
            "        self.assertEqual(self.mixin.get_return_url(request=request, obj=None), reverse(\"home\"))",
            "",
            "    def test_get_return_url_explicit_punycode(self):",
            "        \"\"\"",
            "        Replace the 'i' in '/dcim/' with a unicode dotless '\u0131' and make sure we're not fooled by it.",
            "        \"\"\"  # noqa: RUF002  # ambiguous-unicode-character-docstring -- fully intentional here!",
            "        request = self.factory.get(\"/\", {\"return_url\": \"/dc\u0131m/devices/\"})  # noqa: RUF001  # ambiguous-unicode-character-string -- fully intentional here!",
            "        self.assertEqual(self.mixin.get_return_url(request=request, obj=None), \"/dc%C4%B1m/devices/\")",
            "",
            "    def test_get_return_url_default_with_obj(self):",
            "        request = self.factory.get(\"/\")",
            "        location = Location.objects.first()",
            "        self.assertEqual(self.mixin.get_return_url(request=request, obj=location), location.get_absolute_url())",
            "",
            "",
            "class HomeViewTestCase(TestCase):",
            "    def test_home(self):",
            "        url = reverse(\"home\")",
            "",
            "        response = self.client.get(url)",
            "        self.assertHttpStatus(response, 200)",
            "",
            "    def test_search(self):",
            "        url = reverse(\"search\")",
            "        params = {",
            "            \"q\": \"foo\",",
            "        }",
            "",
            "        response = self.client.get(f\"{url}?{urllib.parse.urlencode(params)}\")",
            "        self.assertHttpStatus(response, 200)",
            "",
            "    def make_request(self):",
            "        url = reverse(\"home\")",
            "        response = self.client.get(url)",
            "",
            "        # Search bar in nav",
            "        nav_search_bar_pattern = re.compile(",
            "            '<nav.*<form action=\"/search/\" method=\"get\" class=\"navbar-form\" id=\"navbar_search\" role=\"search\">.*</form>.*</nav>'",
            "        )",
            "        nav_search_bar_result = nav_search_bar_pattern.search(",
            "            response.content.decode(response.charset).replace(\"\\n\", \"\")",
            "        )",
            "",
            "        # Global search bar in body/container-fluid wrapper",
            "        body_search_bar_pattern = re.compile(",
            "            '<div class=\"container-fluid wrapper\">.*<form action=\"/search/\" method=\"get\" class=\"form-inline\">.*</form>.*</div>'",
            "        )",
            "        body_search_bar_result = body_search_bar_pattern.search(",
            "            response.content.decode(response.charset).replace(\"\\n\", \"\")",
            "        )",
            "",
            "        return nav_search_bar_result, body_search_bar_result",
            "",
            "    def test_search_bar_not_visible_if_user_not_authenticated(self):",
            "        self.client.logout()",
            "",
            "        nav_search_bar_result, body_search_bar_result = self.make_request()",
            "",
            "        self.assertIsNone(nav_search_bar_result)",
            "        self.assertIsNone(body_search_bar_result)",
            "",
            "    def test_search_bar_visible_if_user_authenticated(self):",
            "        nav_search_bar_result, body_search_bar_result = self.make_request()",
            "",
            "        self.assertIsNotNone(nav_search_bar_result)",
            "        self.assertIsNotNone(body_search_bar_result)",
            "",
            "    @override_settings(VERSION=\"1.2.3\")",
            "    def test_footer_version_visible_authenticated_users_only(self):",
            "        url = reverse(\"home\")",
            "        response = self.client.get(url)",
            "        response_content = response.content.decode(response.charset).replace(\"\\n\", \"\")",
            "",
            "        footer_hostname_version_pattern = re.compile(r'<p class=\"text-muted\">\\s+\\S+\\s+\\(v1\\.2\\.3\\)\\s+</p>')",
            "        self.assertRegex(response_content, footer_hostname_version_pattern)",
            "",
            "        self.client.logout()",
            "        response = self.client.get(url)",
            "        response_content = response.content.decode(response.charset).replace(\"\\n\", \"\")",
            "        self.assertNotRegex(response_content, footer_hostname_version_pattern)",
            "",
            "",
            "@override_settings(BRANDING_TITLE=\"Nautobot\")",
            "class SearchFieldsTestCase(TestCase):",
            "    def test_search_bar_redirect_to_login(self):",
            "        self.client.logout()",
            "        response = self.client.get(reverse(\"search\") + \"?q=prefix\")",
            "        # Assert that if the user is not logged in",
            "        # SearchForm will redirect the user to the login Page",
            "        self.assertEqual(response.status_code, 302)",
            "",
            "    def test_global_and_model_search_bar(self):",
            "        self.add_permissions(\"dcim.view_location\", \"dcim.view_device\")",
            "",
            "        # Assert model search bar present in list UI",
            "        response = self.client.get(reverse(\"dcim:location_list\"))",
            "        self.assertInHTML(",
            "            '<input type=\"text\" name=\"q\" class=\"form-control\" required placeholder=\"Search Locations\" id=\"id_q\">',",
            "            response.content.decode(response.charset),",
            "        )",
            "",
            "        response = self.client.get(reverse(\"dcim:device_list\"))",
            "        self.assertInHTML(",
            "            '<input type=\"text\" name=\"q\" class=\"form-control\" required placeholder=\"Search Devices\" id=\"id_q\">',",
            "            response.content.decode(response.charset),",
            "        )",
            "",
            "        # Assert global search bar present in UI",
            "        self.assertInHTML(",
            "            '<input type=\"text\" name=\"q\" class=\"form-control\" placeholder=\"Search Nautobot\">',",
            "            response.content.decode(response.charset),",
            "        )",
            "",
            "",
            "class FilterFormsTestCase(TestCase):",
            "    def test_support_for_both_default_and_dynamic_filter_form_in_ui(self):",
            "        self.add_permissions(\"dcim.view_location\", \"circuits.view_circuit\")",
            "",
            "        filter_tabs = \"\"\"",
            "            <ul id=\"tabs\" class=\"nav nav-tabs\">",
            "                <li role=\"presentation\" class=\"active\">",
            "                    <a href=\"#default-filter\" role=\"tab\" data-toggle=\"tab\">",
            "                        Default",
            "                    </a>",
            "                </li>",
            "                <li role=\"presentation\" class=\"\">",
            "                    <a href=\"#advanced-filter\" role=\"tab\" data-toggle=\"tab\">",
            "                        Advanced",
            "                    </a>",
            "                </li>",
            "            </ul>",
            "            \"\"\"",
            "",
            "        response = self.client.get(reverse(\"dcim:location_list\"))",
            "        self.assertInHTML(",
            "            filter_tabs,",
            "            response.content.decode(response.charset),",
            "        )",
            "",
            "        response = self.client.get(reverse(\"circuits:circuit_list\"))",
            "        self.assertInHTML(",
            "            filter_tabs,",
            "            response.content.decode(response.charset),",
            "        )",
            "",
            "    def test_filtering_on_custom_select_filter_field(self):",
            "        \"\"\"Assert CustomField select and multiple select fields can be filtered using multiple entries\"\"\"",
            "        self.add_permissions(\"dcim.view_location\")",
            "",
            "        multi_select_cf = CustomField.objects.create(",
            "            type=CustomFieldTypeChoices.TYPE_MULTISELECT, label=\"Multiple Choice\"",
            "        )",
            "        select_cf = CustomField.objects.create(type=CustomFieldTypeChoices.TYPE_SELECT, label=\"choice\")",
            "        choices = [\"Foo\", \"Bar\", \"FooBar\"]",
            "        for cf in [multi_select_cf, select_cf]:",
            "            cf.content_types.set([ContentType.objects.get_for_model(Location)])",
            "            CustomFieldChoice.objects.create(custom_field=cf, value=choices[0])",
            "            CustomFieldChoice.objects.create(custom_field=cf, value=choices[1])",
            "            CustomFieldChoice.objects.create(custom_field=cf, value=choices[2])",
            "",
            "        locations = Location.objects.all()[:3]",
            "        for idx, location in enumerate(locations):",
            "            location.cf[multi_select_cf.key] = choices[:2]",
            "            location.cf[select_cf.key] = choices[idx]",
            "            location.save()",
            "",
            "        query_param = (",
            "            f\"?cf_{multi_select_cf.key}={choices[0]}&cf_{multi_select_cf.key}={choices[1]}\"",
            "            f\"&cf_{select_cf.key}={choices[0]}&cf_{select_cf.key}={choices[1]}\"",
            "        )",
            "        url = reverse(\"dcim:location_list\") + query_param",
            "        response = self.client.get(url)",
            "        response_content = response.content.decode(response.charset).replace(\"\\n\", \"\")",
            "        self.assertInHTML(locations[0].name, response_content)",
            "        self.assertInHTML(locations[1].name, response_content)",
            "",
            "",
            "class ForceScriptNameTestcase(TestCase):",
            "    \"\"\"Basic test to assert that `settings.FORCE_SCRIPT_NAME` works as intended.\"\"\"",
            "",
            "    @override_settings(",
            "        FORCE_SCRIPT_NAME=\"/nautobot/\",",
            "    )",
            "    @override_script_prefix(\"/nautobot/\")",
            "    def test_subdirectory_routes(self):",
            "        # We must call `set_script_prefix()` to set the URL resolver script prefix outside of the",
            "        # request/response cycle (e.g. in scripts/tests) to generate correct URLs when `SCRIPT_NAME`",
            "        # is not `/`.",
            "        #",
            "        # We must then call it again to reset the script pefix after we're done because",
            "        # the state is stored in the thread-local scope and will \"infect\" other tests.",
            "        prefix = get_script_prefix()",
            "        self.assertEqual(prefix, \"/nautobot/\")",
            "",
            "        # And that routes will start w/ the prefix vs. just \"/\" (the default).",
            "        routes = (\"home\", \"login\", \"search\", \"api-root\")",
            "        for route in routes:",
            "            url = reverse(route)",
            "            self.assertTrue(url.startswith(prefix))",
            "",
            "",
            "class NavRestrictedUI(TestCase):",
            "    def setUp(self):",
            "        super().setUp()",
            "",
            "        self.url = reverse(\"plugins:plugins_list\")",
            "        self.item_weight = 100  # TODO: not easy to introspect from the nav menu struct, so hard-code it here for now",
            "",
            "    def make_request(self):",
            "        response = self.client.get(reverse(\"home\"))",
            "        return response.content.decode(response.charset)",
            "",
            "    def test_installed_apps_visible_to_staff(self):",
            "        \"\"\"The \"Installed Apps\" menu item should be available to is_staff user.\"\"\"",
            "        # Make user admin",
            "        self.user.is_staff = True",
            "        self.user.save()",
            "",
            "        response_content = self.make_request()",
            "        self.assertInHTML(",
            "            f\"\"\"",
            "            <a href=\"{self.url}\"",
            "                data-item-weight=\"{self.item_weight}\">",
            "                Installed Plugins",
            "            </a>",
            "            \"\"\",",
            "            response_content,",
            "        )",
            "",
            "    def test_installed_apps_not_visible_to_non_staff_user_without_permission(self):",
            "        \"\"\"The \"Installed Apps\" menu item should be hidden from a non-staff user without permission.\"\"\"",
            "        response_content = self.make_request()",
            "",
            "        self.assertNotRegex(response_content, r\"Installed\\s+Plugins\")",
            "",
            "",
            "class LoginUI(TestCase):",
            "    def setUp(self):",
            "        super().setUp()",
            "",
            "        self.footer_elements = [",
            "            '<a href=\"#theme_modal\" data-toggle=\"modal\" data-target=\"#theme_modal\" id=\"btn-theme-modal\"><i class=\"mdi mdi-theme-light-dark text-primary\"></i>Theme</a>',",
            "            '<a href=\"/static/docs/index.html\">Docs</a>',",
            "            '<i class=\"mdi mdi-cloud-braces text-primary\"></i> <a href=\"/api/docs/\">API</a>',",
            "            '<i class=\"mdi mdi-graphql text-primary\"></i> <a href=\"/graphql/\">GraphQL</a>',",
            "            '<i class=\"mdi mdi-xml text-primary\"></i> <a href=\"https://github.com/nautobot/nautobot\">Code</a>',",
            "            '<i class=\"mdi mdi-lifebuoy text-primary\"></i> <a href=\"https://github.com/nautobot/nautobot/wiki\">Help</a>',",
            "        ]",
            "",
            "    def make_request(self):",
            "        response = self.client.get(reverse(\"login\"))",
            "        sso_login_pattern = re.compile('<a href=\".*\">Continue with SSO</a>')",
            "        return sso_login_pattern.search(response.content.decode(response.charset))",
            "",
            "    def test_sso_login_button_not_visible(self):",
            "        \"\"\"Test Continue with SSO button not visible if SSO is enabled\"\"\"",
            "        self.client.logout()",
            "",
            "        sso_login_search_result = self.make_request()",
            "        self.assertIsNone(sso_login_search_result)",
            "",
            "    @override_settings(",
            "        AUTHENTICATION_BACKENDS=[",
            "            \"social_core.backends.google.GoogleOAuth2\",",
            "            \"nautobot.core.authentication.ObjectPermissionBackend\",",
            "        ]",
            "    )",
            "    def test_sso_login_button_visible(self):",
            "        self.client.logout()",
            "        sso_login_search_result = self.make_request()",
            "        self.assertIsNotNone(sso_login_search_result)",
            "",
            "    @override_settings(BANNER_TOP=\"Hello, Banner Top\", BANNER_BOTTOM=\"Hello, Banner Bottom\")",
            "    def test_routes_redirect_back_to_login_unauthenticated(self):",
            "        \"\"\"Assert that api docs and graphql redirects to login page if user is unauthenticated.\"\"\"",
            "        self.client.logout()",
            "        headers = {\"HTTP_ACCEPT\": \"text/html\"}",
            "        urls = [reverse(\"api_docs\"), reverse(\"graphql\")]",
            "        for url in urls:",
            "            response = self.client.get(url, follow=True, **headers)",
            "            self.assertHttpStatus(response, 200)",
            "            redirect_chain = [(f\"/login/?next={url}\", 302)]",
            "            self.assertEqual(response.redirect_chain, redirect_chain)",
            "            response_content = response.content.decode(response.charset).replace(\"\\n\", \"\")",
            "            # Assert Footer items(`self.footer_elements`), Banner and Banner Top is hidden",
            "            for footer_text in self.footer_elements:",
            "                self.assertNotIn(footer_text, response_content)",
            "            # Only API Docs implements BANNERS",
            "            if url == urls[0]:",
            "                self.assertNotIn(\"Hello, Banner Top\", response_content)",
            "                self.assertNotIn(\"Hello, Banner Bottom\", response_content)",
            "",
            "",
            "class MetricsViewTestCase(TestCase):",
            "    def query_and_parse_metrics(self):",
            "        response = self.client.get(reverse(\"metrics\"))",
            "        self.assertHttpStatus(response, 200, msg=\"/metrics should return a 200 HTTP status code.\")",
            "        page_content = response.content.decode(response.charset)",
            "        return text_string_to_metric_families(page_content)",
            "",
            "    def test_metrics_extensibility(self):",
            "        \"\"\"Assert that the example metric from the example plugin shows up _exactly_ when the plugin is enabled.\"\"\"",
            "        test_metric_name = \"nautobot_example_metric_count\"",
            "        metrics_with_plugin = self.query_and_parse_metrics()",
            "        metric_names_with_plugin = {metric.name for metric in metrics_with_plugin}",
            "        self.assertIn(test_metric_name, metric_names_with_plugin)",
            "        with override_settings(PLUGINS=[]):",
            "            # Clear out the app metric registry because it is not updated when settings are changed but Nautobot is not",
            "            # restarted.",
            "            registry[\"app_metrics\"].clear()",
            "            metrics_without_plugin = self.query_and_parse_metrics()",
            "            metric_names_without_plugin = {metric.name for metric in metrics_without_plugin}",
            "            self.assertNotIn(test_metric_name, metric_names_without_plugin)",
            "        metric_names_with_plugin.remove(test_metric_name)",
            "        self.assertSetEqual(metric_names_with_plugin, metric_names_without_plugin)",
            "",
            "",
            "class ErrorPagesTestCase(TestCase):",
            "    \"\"\"Tests for 4xx and 5xx error page rendering.\"\"\"",
            "",
            "    @override_settings(DEBUG=False)",
            "    def test_404_default_support_message(self):",
            "        \"\"\"Nautobot's custom 404 page should be used and should include a default support message.\"\"\"",
            "        with self.assertTemplateUsed(\"404.html\"):",
            "            response = self.client.get(\"/foo/bar\")",
            "        self.assertContains(response, \"Network to Code\", status_code=404)",
            "        response_content = response.content.decode(response.charset)",
            "        self.assertInHTML(",
            "            \"If further assistance is required, please join the <code>#nautobot</code> channel on \"",
            "            '<a href=\"https://slack.networktocode.com/\" rel=\"noopener noreferrer\">Network to Code\\'s '",
            "            \"Slack community</a> and post your question.\",",
            "            response_content,",
            "        )",
            "",
            "    @override_settings(DEBUG=False, SUPPORT_MESSAGE=\"Hello world!\")",
            "    def test_404_custom_support_message(self):",
            "        \"\"\"Nautobot's custom 404 page should be used and should include a custom support message if defined.\"\"\"",
            "        with self.assertTemplateUsed(\"404.html\"):",
            "            response = self.client.get(\"/foo/bar\")",
            "        self.assertNotContains(response, \"Network to Code\", status_code=404)",
            "        response_content = response.content.decode(response.charset)",
            "        self.assertInHTML(\"Hello world!\", response_content)",
            "",
            "    @override_settings(DEBUG=False)",
            "    @mock.patch(\"nautobot.core.views.HomeView.get\", side_effect=Exception)",
            "    def test_500_default_support_message(self, mock_get):",
            "        \"\"\"Nautobot's custom 500 page should be used and should include a default support message.\"\"\"",
            "        url = reverse(\"home\")",
            "        with self.assertTemplateUsed(\"500.html\"):",
            "            self.client.raise_request_exception = False",
            "            response = self.client.get(url)",
            "        self.assertContains(response, \"Network to Code\", status_code=500)",
            "        response_content = response.content.decode(response.charset)",
            "        self.assertInHTML(",
            "            \"If further assistance is required, please join the <code>#nautobot</code> channel on \"",
            "            '<a href=\"https://slack.networktocode.com/\" rel=\"noopener noreferrer\">Network to Code\\'s '",
            "            \"Slack community</a> and post your question.\",",
            "            response_content,",
            "        )",
            "",
            "    @override_settings(DEBUG=False, SUPPORT_MESSAGE=\"Hello world!\")",
            "    @mock.patch(\"nautobot.core.views.HomeView.get\", side_effect=Exception)",
            "    def test_500_custom_support_message(self, mock_get):",
            "        \"\"\"Nautobot's custom 500 page should be used and should include a custom support message if defined.\"\"\"",
            "        url = reverse(\"home\")",
            "        with self.assertTemplateUsed(\"500.html\"):",
            "            self.client.raise_request_exception = False",
            "            response = self.client.get(url)",
            "        self.assertNotContains(response, \"Network to Code\", status_code=500)",
            "        response_content = response.content.decode(response.charset)",
            "        self.assertInHTML(\"Hello world!\", response_content)",
            "",
            "",
            "class DBFileStorageViewTestCase(TestCase):",
            "    \"\"\"Test authentication/permission enforcement for django_db_file_storage views.\"\"\"",
            "",
            "    def setUp(self):",
            "        super().setUp()",
            "        self.test_file_1 = SimpleUploadedFile(name=\"test_file_1.txt\", content=b\"I am content.\\n\")",
            "        self.file_proxy_1 = FileProxy.objects.create(name=self.test_file_1.name, file=self.test_file_1)",
            "        self.test_file_2 = SimpleUploadedFile(name=\"test_file_2.txt\", content=b\"I am content.\\n\")",
            "        self.file_proxy_2 = FileProxy.objects.create(name=self.test_file_2.name, file=self.test_file_2)",
            "        self.url = f\"{reverse('db_file_storage.download_file')}?name={self.file_proxy_1.file.name}\"",
            "",
            "    def test_get_file_anonymous(self):",
            "        self.client.logout()",
            "        response = self.client.get(self.url)",
            "        self.assertHttpStatus(response, 403)",
            "",
            "    def test_get_file_without_permission(self):",
            "        response = self.client.get(self.url)",
            "        self.assertHttpStatus(response, 403)",
            "",
            "    def test_get_object_with_permission(self):",
            "        self.add_permissions(get_permission_for_model(FileProxy, \"view\"))",
            "        response = self.client.get(self.url)",
            "        self.assertHttpStatus(response, 200)",
            "",
            "    def test_get_object_with_constrained_permission(self):",
            "        obj_perm = ObjectPermission(",
            "            name=\"Test permission\",",
            "            constraints={\"pk\": self.file_proxy_1.pk},",
            "            actions=[\"view\"],",
            "        )",
            "        obj_perm.save()",
            "        obj_perm.users.add(self.user)",
            "        obj_perm.object_types.add(ContentType.objects.get_for_model(FileProxy))",
            "        response = self.client.get(self.url)",
            "        self.assertHttpStatus(response, 200)",
            "        url = f\"{reverse('db_file_storage.download_file')}?name={self.file_proxy_2.file.name}\"",
            "        response = self.client.get(url)",
            "        self.assertHttpStatus(response, 404)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "369": [
                "ErrorPagesTestCase",
                "test_404_default_support_message"
            ],
            "370": [
                "ErrorPagesTestCase",
                "test_404_default_support_message"
            ],
            "371": [
                "ErrorPagesTestCase",
                "test_404_default_support_message"
            ],
            "395": [
                "ErrorPagesTestCase",
                "test_500_default_support_message"
            ],
            "396": [
                "ErrorPagesTestCase",
                "test_500_default_support_message"
            ],
            "397": [
                "ErrorPagesTestCase",
                "test_500_default_support_message"
            ],
            "404": [
                "ErrorPagesTestCase",
                "test_500_custom_support_message"
            ]
        },
        "addLocation": []
    },
    "nautobot/core/utils/logging.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 1,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-\"\"\"Utilities for working with log messages and similar features.\"\"\""
            },
            "1": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 1,
                "PatchRowcode": "+\"\"\"Utilities for working with log messages and similar user-authored data.\"\"\""
            },
            "2": {
                "beforePatchRowNumber": 2,
                "afterPatchRowNumber": 2,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": 3,
                "afterPatchRowNumber": 3,
                "PatchRowcode": " import logging"
            },
            "4": {
                "beforePatchRowNumber": 4,
                "afterPatchRowNumber": 4,
                "PatchRowcode": " import re"
            },
            "5": {
                "beforePatchRowNumber": 5,
                "afterPatchRowNumber": 5,
                "PatchRowcode": " "
            },
            "6": {
                "beforePatchRowNumber": 6,
                "afterPatchRowNumber": 6,
                "PatchRowcode": " from django.conf import settings"
            },
            "7": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 7,
                "PatchRowcode": "+import nh3"
            },
            "8": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 8,
                "PatchRowcode": "+"
            },
            "9": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 9,
                "PatchRowcode": "+from nautobot.core import constants"
            },
            "10": {
                "beforePatchRowNumber": 7,
                "afterPatchRowNumber": 10,
                "PatchRowcode": " "
            },
            "11": {
                "beforePatchRowNumber": 8,
                "afterPatchRowNumber": 11,
                "PatchRowcode": " logger = logging.getLogger(__name__)"
            },
            "12": {
                "beforePatchRowNumber": 9,
                "afterPatchRowNumber": 12,
                "PatchRowcode": " "
            },
            "13": {
                "beforePatchRowNumber": 47,
                "afterPatchRowNumber": 50,
                "PatchRowcode": " "
            },
            "14": {
                "beforePatchRowNumber": 48,
                "afterPatchRowNumber": 51,
                "PatchRowcode": "     logger.warning(\"No sanitizer support for %s data\", type(dirty))"
            },
            "15": {
                "beforePatchRowNumber": 49,
                "afterPatchRowNumber": 52,
                "PatchRowcode": "     return dirty"
            },
            "16": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 53,
                "PatchRowcode": "+"
            },
            "17": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 54,
                "PatchRowcode": "+"
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 55,
                "PatchRowcode": "+def clean_html(html):"
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 56,
                "PatchRowcode": "+    \"\"\"Use nh3/ammonia to strip out all HTML tags and attributes except those explicitly permitted.\"\"\""
            },
            "20": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 57,
                "PatchRowcode": "+    return nh3.clean("
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 58,
                "PatchRowcode": "+        html,"
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 59,
                "PatchRowcode": "+        tags=constants.HTML_ALLOWED_TAGS,"
            },
            "23": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 60,
                "PatchRowcode": "+        attributes=constants.HTML_ALLOWED_ATTRIBUTES,"
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 61,
                "PatchRowcode": "+        url_schemes=set(settings.ALLOWED_URL_SCHEMES),"
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 62,
                "PatchRowcode": "+    )"
            }
        },
        "frontPatchFile": [
            "\"\"\"Utilities for working with log messages and similar features.\"\"\"",
            "",
            "import logging",
            "import re",
            "",
            "from django.conf import settings",
            "",
            "logger = logging.getLogger(__name__)",
            "",
            "",
            "def sanitize(dirty, replacement=\"(redacted)\"):",
            "    \"\"\"",
            "    Make an attempt at stripping potentially-sensitive information from the given string, bytes or iterable thereof.",
            "",
            "    Obviously this will never be 100% foolproof but we can at least try.",
            "",
            "    Uses settings.SANITIZER_PATTERNS as the list of (regexp, repl) tuples to apply.",
            "    \"\"\"",
            "    # Don't allow regex match groups to be referenced in the replacement string!",
            "    if re.search(r\"\\\\\\d|\\\\g<\\d+>\", replacement):",
            "        raise RuntimeError(\"Invalid replacement string! Must not contain regex match group references.\")",
            "",
            "    if isinstance(dirty, (list, tuple)):",
            "        clean = []",
            "        for item in dirty:",
            "            if isinstance(item, (list, tuple, bytes, str)):",
            "                clean.append(sanitize(item))",
            "            else:",
            "                # Pass through anything that isn't a string or iterable of strings",
            "                clean.append(item)",
            "        if isinstance(dirty, tuple):",
            "            clean = tuple(clean)",
            "        return clean",
            "",
            "    if isinstance(dirty, bytes):",
            "        return sanitize(dirty.decode(\"utf-8\")).encode(\"utf-8\")",
            "",
            "    if isinstance(dirty, str):",
            "        clean = dirty",
            "        for sanitizer, repl in settings.SANITIZER_PATTERNS:",
            "            try:",
            "                clean = sanitizer.sub(repl.format(replacement=replacement), clean)",
            "            except re.error:",
            "                logger.error('Error in string sanitization using \"%s\"', sanitizer)",
            "",
            "        return clean",
            "",
            "    logger.warning(\"No sanitizer support for %s data\", type(dirty))",
            "    return dirty"
        ],
        "afterPatchFile": [
            "\"\"\"Utilities for working with log messages and similar user-authored data.\"\"\"",
            "",
            "import logging",
            "import re",
            "",
            "from django.conf import settings",
            "import nh3",
            "",
            "from nautobot.core import constants",
            "",
            "logger = logging.getLogger(__name__)",
            "",
            "",
            "def sanitize(dirty, replacement=\"(redacted)\"):",
            "    \"\"\"",
            "    Make an attempt at stripping potentially-sensitive information from the given string, bytes or iterable thereof.",
            "",
            "    Obviously this will never be 100% foolproof but we can at least try.",
            "",
            "    Uses settings.SANITIZER_PATTERNS as the list of (regexp, repl) tuples to apply.",
            "    \"\"\"",
            "    # Don't allow regex match groups to be referenced in the replacement string!",
            "    if re.search(r\"\\\\\\d|\\\\g<\\d+>\", replacement):",
            "        raise RuntimeError(\"Invalid replacement string! Must not contain regex match group references.\")",
            "",
            "    if isinstance(dirty, (list, tuple)):",
            "        clean = []",
            "        for item in dirty:",
            "            if isinstance(item, (list, tuple, bytes, str)):",
            "                clean.append(sanitize(item))",
            "            else:",
            "                # Pass through anything that isn't a string or iterable of strings",
            "                clean.append(item)",
            "        if isinstance(dirty, tuple):",
            "            clean = tuple(clean)",
            "        return clean",
            "",
            "    if isinstance(dirty, bytes):",
            "        return sanitize(dirty.decode(\"utf-8\")).encode(\"utf-8\")",
            "",
            "    if isinstance(dirty, str):",
            "        clean = dirty",
            "        for sanitizer, repl in settings.SANITIZER_PATTERNS:",
            "            try:",
            "                clean = sanitizer.sub(repl.format(replacement=replacement), clean)",
            "            except re.error:",
            "                logger.error('Error in string sanitization using \"%s\"', sanitizer)",
            "",
            "        return clean",
            "",
            "    logger.warning(\"No sanitizer support for %s data\", type(dirty))",
            "    return dirty",
            "",
            "",
            "def clean_html(html):",
            "    \"\"\"Use nh3/ammonia to strip out all HTML tags and attributes except those explicitly permitted.\"\"\"",
            "    return nh3.clean(",
            "        html,",
            "        tags=constants.HTML_ALLOWED_TAGS,",
            "        attributes=constants.HTML_ALLOWED_ATTRIBUTES,",
            "        url_schemes=set(settings.ALLOWED_URL_SCHEMES),",
            "    )"
        ],
        "action": [
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2"
        ],
        "dele_reviseLocation": {
            "1": []
        },
        "addLocation": []
    }
}