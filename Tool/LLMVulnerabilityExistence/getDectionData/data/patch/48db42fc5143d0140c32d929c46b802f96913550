{
    "html_sanitizer/sanitizer.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 250,
                "afterPatchRowNumber": 250,
                "PatchRowcode": "         Requires ``lxml`` and, for especially broken HTML, ``beautifulsoup4``."
            },
            "1": {
                "beforePatchRowNumber": 251,
                "afterPatchRowNumber": 251,
                "PatchRowcode": "         \"\"\""
            },
            "2": {
                "beforePatchRowNumber": 252,
                "afterPatchRowNumber": 252,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 253,
                "PatchRowcode": "+        # normalize unicode"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 254,
                "PatchRowcode": "+        if self.keep_typographic_whitespace:"
            },
            "5": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 255,
                "PatchRowcode": "+            html = unicodedata.normalize(\"NFC\", html)"
            },
            "6": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 256,
                "PatchRowcode": "+        else:"
            },
            "7": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 257,
                "PatchRowcode": "+            html = unicodedata.normalize(\"NFKC\", html)"
            },
            "8": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 258,
                "PatchRowcode": "+"
            },
            "9": {
                "beforePatchRowNumber": 253,
                "afterPatchRowNumber": 259,
                "PatchRowcode": "         html = normalize_overall_whitespace("
            },
            "10": {
                "beforePatchRowNumber": 254,
                "afterPatchRowNumber": 260,
                "PatchRowcode": "             html,"
            },
            "11": {
                "beforePatchRowNumber": 255,
                "afterPatchRowNumber": 261,
                "PatchRowcode": "             keep_typographic_whitespace=self.keep_typographic_whitespace,"
            },
            "12": {
                "beforePatchRowNumber": 420,
                "afterPatchRowNumber": 426,
                "PatchRowcode": "         # remove wrapping tag needed by XML parser"
            },
            "13": {
                "beforePatchRowNumber": 421,
                "afterPatchRowNumber": 427,
                "PatchRowcode": "         html = re.sub(r\"^<div>|</div>$\", \"\", html)"
            },
            "14": {
                "beforePatchRowNumber": 422,
                "afterPatchRowNumber": 428,
                "PatchRowcode": " "
            },
            "15": {
                "beforePatchRowNumber": 423,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        # normalize unicode"
            },
            "16": {
                "beforePatchRowNumber": 424,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        if self.keep_typographic_whitespace:"
            },
            "17": {
                "beforePatchRowNumber": 425,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            html = unicodedata.normalize(\"NFC\", html)"
            },
            "18": {
                "beforePatchRowNumber": 426,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        else:"
            },
            "19": {
                "beforePatchRowNumber": 427,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            html = unicodedata.normalize(\"NFKC\", html)"
            },
            "20": {
                "beforePatchRowNumber": 428,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "21": {
                "beforePatchRowNumber": 429,
                "afterPatchRowNumber": 429,
                "PatchRowcode": "         return html"
            }
        },
        "frontPatchFile": [
            "import re",
            "import unicodedata",
            "from collections import deque",
            "",
            "import lxml.html",
            "import lxml.html.clean",
            "",
            "",
            "__all__ = (\"Sanitizer\",)",
            "",
            "",
            "def sanitize_href(href):",
            "    \"\"\"",
            "    Verify that a given href is benign and allowed.",
            "",
            "    This is a stupid check, which probably should be much more elaborate",
            "    to be safe.",
            "    \"\"\"",
            "    if href.startswith((\"/\", \"mailto:\", \"http:\", \"https:\", \"#\", \"tel:\")):",
            "        return href",
            "    return \"#\"",
            "",
            "",
            "typographic_whitespace_names = [",
            "    \"NO-BREAK SPACE\",",
            "    \"EN QUAD\",",
            "    \"EM QUAD\",",
            "    \"EN SPACE\",",
            "    \"EM SPACE\",",
            "    \"THREE-PER-EM SPACE\",",
            "    \"FOUR-PER-EM SPACE\",",
            "    \"SIX-PER-EM SPACE\",",
            "    \"FIGURE SPACE\",",
            "    \"PUNCTUATION SPACE\",",
            "    \"THIN SPACE\",",
            "    \"HAIR SPACE\",",
            "    \"NARROW NO-BREAK SPACE\",",
            "    \"MEDIUM MATHEMATICAL SPACE\",",
            "    \"IDEOGRAPHIC SPACE\",",
            "]",
            "",
            "typographic_whitespace = \"\".join(",
            "    {unicodedata.lookup(n) for n in typographic_whitespace_names}",
            ")",
            "",
            "",
            "def normalize_overall_whitespace(",
            "    html, *, keep_typographic_whitespace=False, whitespace_re=None",
            "):",
            "    if keep_typographic_whitespace:",
            "        return html",
            "    whitespace = [",
            "        \"\\xa0\",",
            "        \"&nbsp;\",",
            "        \"&#160;\",",
            "        \"&#xa0;\",",
            "        \"\\n\",",
            "        \"&#10;\",",
            "        \"&#xa;\",",
            "        \"\\r\",",
            "        \"&#13;\",",
            "        \"&#xd;\",",
            "    ]",
            "    for ch in whitespace:",
            "        html = html.replace(ch, \" \")",
            "    if whitespace_re is None:",
            "        whitespace_re = r\"\\s+\"",
            "    html = re.sub(whitespace_re, \" \", html)",
            "    return html",
            "",
            "",
            "def bold_span_to_strong(element):",
            "    if element.tag == \"span\" and \"bold\" in element.get(\"style\", \"\"):",
            "        element.tag = \"strong\"",
            "    return element",
            "",
            "",
            "def italic_span_to_em(element):",
            "    if element.tag == \"span\" and \"italic\" in element.get(\"style\", \"\"):",
            "        element.tag = \"em\"",
            "    return element",
            "",
            "",
            "def tag_replacer(from_, to_):",
            "    def replacer(element):",
            "        if element.tag == from_:",
            "            element.tag = to_",
            "        return element",
            "",
            "    return replacer",
            "",
            "",
            "def target_blank_noopener(element):",
            "    if (",
            "        element.tag == \"a\"",
            "        and element.attrib.get(\"target\") == \"_blank\"",
            "        and \"noopener\" not in element.attrib.get(\"rel\", \"\")",
            "    ):",
            "        element.attrib[\"rel\"] = \" \".join(",
            "            part for part in (element.attrib.get(\"rel\", \"\"), \"noopener\") if part",
            "        )",
            "    return element",
            "",
            "",
            "def anchor_id_to_name(element):",
            "    if (",
            "        element.tag == \"a\"",
            "        and element.attrib.get(\"id\")",
            "        and not element.attrib.get(\"name\")",
            "    ):",
            "        element.attrib[\"name\"] = element.attrib[\"id\"]",
            "    return element",
            "",
            "",
            "def normalize_whitespace_in_text_or_tail(",
            "    element, *, whitespace_re=None, keep_typographic_whitespace=False",
            "):",
            "    if whitespace_re is None:",
            "        whitespace_re = re.compile(r\"\\s+\")",
            "    if element.text and not keep_typographic_whitespace:",
            "        while True:",
            "            text = whitespace_re.sub(\" \", element.text)",
            "            if element.text == text:",
            "                break",
            "            element.text = text",
            "",
            "    if element.tail and not keep_typographic_whitespace:",
            "        while True:",
            "            text = whitespace_re.sub(\" \", element.tail)",
            "            if element.tail == text:",
            "                break",
            "            element.tail = text",
            "",
            "    return element",
            "",
            "",
            "DEFAULT_SETTINGS = {",
            "    \"tags\": {",
            "        \"a\",",
            "        \"h1\",",
            "        \"h2\",",
            "        \"h3\",",
            "        \"strong\",",
            "        \"em\",",
            "        \"p\",",
            "        \"ul\",",
            "        \"ol\",",
            "        \"li\",",
            "        \"br\",",
            "        \"sub\",",
            "        \"sup\",",
            "        \"hr\",",
            "    },",
            "    \"attributes\": {\"a\": (\"href\", \"name\", \"target\", \"title\", \"rel\")},",
            "    \"empty\": {\"hr\", \"a\", \"br\"},",
            "    \"separate\": {\"a\", \"p\", \"li\"},",
            "    \"whitespace\": {\"br\"},",
            "    \"keep_typographic_whitespace\": False,",
            "    \"add_nofollow\": False,",
            "    \"autolink\": False,",
            "    \"sanitize_href\": sanitize_href,",
            "    \"element_preprocessors\": [",
            "        # convert span elements into em/strong if a matching style rule",
            "        # has been found. strong has precedence, strong & em at the same",
            "        # time is not supported",
            "        bold_span_to_strong,",
            "        italic_span_to_em,",
            "        tag_replacer(\"b\", \"strong\"),",
            "        tag_replacer(\"i\", \"em\"),",
            "        tag_replacer(\"form\", \"p\"),",
            "        target_blank_noopener,",
            "        anchor_id_to_name,",
            "    ],",
            "    \"element_postprocessors\": [],",
            "}",
            "",
            "",
            "def coerce_to_set(value):",
            "    if isinstance(value, set):",
            "        return value",
            "    elif isinstance(value, (tuple, list)):",
            "        return set(value)",
            "    raise TypeError(f\"Expected a set but got value {value!r} of type {type(value)}\")",
            "",
            "",
            "class Sanitizer:",
            "    def __init__(self, settings=None):",
            "        self.__dict__.update(DEFAULT_SETTINGS)",
            "        self.__dict__.update(settings or {})",
            "",
            "        # Allow iterables of any kind, not just sets.",
            "        self.tags = coerce_to_set(self.tags)",
            "        self.empty = coerce_to_set(self.empty)",
            "        self.separate = coerce_to_set(self.separate)",
            "        self.whitespace = coerce_to_set(self.whitespace)",
            "        self.attributes = {",
            "            tag: coerce_to_set(attributes)",
            "            for tag, attributes in self.attributes.items()",
            "        }",
            "",
            "        if self.keep_typographic_whitespace:",
            "            re_whitespace = r\"[^\\S%s]\" % typographic_whitespace",
            "        else:",
            "            re_whitespace = r\"\\s\"",
            "",
            "        self.only_whitespace_re = re.compile(rf\"^{re_whitespace}*$\")",
            "        self.whitespace_re = re.compile(rf\"{re_whitespace}+\")",
            "",
            "        # Validate the settings.",
            "        if not self.tags:",
            "            raise TypeError(",
            "                \"Empty list of allowed tags is not supported by the underlying\"",
            "                \" lxml cleaner. If you really do not want to pass any tags\"",
            "                \" pass a made-up tag name which will never exist in your\"",
            "                \" document.\"",
            "            )",
            "        if not self.tags.issuperset(self.empty):",
            "            raise TypeError(",
            "                f'Tags in \"empty\", but not allowed: {self.empty - self.tags!r}'",
            "            )",
            "        if not self.tags.issuperset(self.separate):",
            "            raise TypeError(",
            "                f'Tags in \"separate\", but not allowed: {self.separate - self.tags!r}'",
            "            )",
            "        if not self.tags.issuperset(self.attributes.keys()):",
            "            raise TypeError(",
            "                f'Tags in \"attributes\", but not allowed: {set(self.attributes.keys()) - self.tags!r}'",
            "            )",
            "",
            "        anchor_attributes = self.attributes.get(\"a\", ())",
            "        if \"target\" in anchor_attributes and \"rel\" not in anchor_attributes:",
            "            raise TypeError(",
            "                'Always allow \"rel\" when allowing \"target\" as anchor' \" attribute\"",
            "            )",
            "",
            "    @staticmethod",
            "    def is_mergeable(e1, e2):",
            "        \"\"\"",
            "        Decide if the adjacent elements of the same type e1 and e2 can be",
            "        merged. This can be overriden to honouring distinct classes etc.",
            "        \"\"\"",
            "        return True",
            "",
            "    def sanitize(self, html):",
            "        \"\"\"",
            "        Clean HTML code from ugly copy-pasted CSS and empty elements",
            "",
            "        Removes everything not explicitly allowed in ``self.allowed_tags``.",
            "",
            "        Requires ``lxml`` and, for especially broken HTML, ``beautifulsoup4``.",
            "        \"\"\"",
            "",
            "        html = normalize_overall_whitespace(",
            "            html,",
            "            keep_typographic_whitespace=self.keep_typographic_whitespace,",
            "            whitespace_re=self.whitespace_re,",
            "        )",
            "        html = \"<div>%s</div>\" % html",
            "        try:",
            "            doc = lxml.html.fromstring(html)",
            "            lxml.html.tostring(doc, encoding=\"utf-8\")",
            "        except Exception:  # We could and maybe should be more specific...",
            "            from lxml.html import soupparser",
            "",
            "            doc = soupparser.fromstring(html)",
            "",
            "        lxml.html.clean.Cleaner(",
            "            remove_unknown_tags=False,",
            "            # Remove style *tags* if not explicitly allowed",
            "            style=\"style\" not in self.tags,",
            "            # Do not strip out style attributes; we still need the style",
            "            # information to convert spans into em/strong tags",
            "            safe_attrs_only=False,",
            "            inline_style=False,",
            "            # Do not strip all form tags; we will filter them below",
            "            forms=False,",
            "        )(doc)",
            "",
            "        # walk the tree recursively, because we want to be able to remove",
            "        # previously emptied elements completely",
            "        backlog = deque(doc.iterdescendants())",
            "",
            "        while True:",
            "            try:",
            "                element = backlog.pop()",
            "            except IndexError:",
            "                break",
            "",
            "            for processor in self.element_preprocessors:",
            "                element = processor(element)",
            "",
            "            element = normalize_whitespace_in_text_or_tail(",
            "                element,",
            "                whitespace_re=self.whitespace_re,",
            "                keep_typographic_whitespace=self.keep_typographic_whitespace,",
            "            )",
            "",
            "            # remove empty tags if they are not explicitly allowed",
            "            if (",
            "                (not element.text or self.only_whitespace_re.match(element.text))",
            "                and element.tag not in self.empty",
            "                and not len(element)",
            "            ):",
            "                element.drop_tag()",
            "                continue",
            "",
            "            # remove tags which only contain whitespace and/or <br>s",
            "            if (",
            "                element.tag not in self.empty",
            "                and self.only_whitespace_re.match(element.text or \"\")",
            "                and {e.tag for e in element} <= self.whitespace",
            "                and all(self.only_whitespace_re.match(e.tail or \"\") for e in element)",
            "            ):",
            "                element.drop_tree()",
            "                continue",
            "",
            "            if element.tag in {\"li\", \"p\"}:",
            "                # remove p-in-li and p-in-p tags",
            "                for p in element.findall(\"p\"):",
            "                    if getattr(p, \"text\", None):",
            "                        p.text = \" \" + p.text + \" \"",
            "                    p.drop_tag()",
            "",
            "                # remove list markers, maybe copy-pasted from word or whatever",
            "                if element.text:",
            "                    element.text = re.sub(r\"^\\s*(-|\\*|&#183;)\\s+\", \"\", element.text)",
            "",
            "            elif element.tag in self.whitespace:",
            "                # Drop the next element if",
            "                # 1. it is a <br> too and 2. there is no content in-between",
            "                nx = element.getnext()",
            "                if (",
            "                    nx is not None",
            "                    and nx.tag == element.tag",
            "                    and (",
            "                        not element.tail or self.only_whitespace_re.match(element.tail)",
            "                    )",
            "                ):",
            "                    nx.drop_tag()",
            "",
            "            if not element.text:",
            "                # No text before first child and first child is a <br>: Drop it",
            "                first = list(element)[0] if list(element) else None",
            "                if first is not None and first.tag in self.whitespace:",
            "                    first.drop_tag()",
            "                    # Maybe we have more than one <br>",
            "                    backlog.append(element)",
            "                    continue",
            "",
            "            if element.tag in (self.tags - self.separate):",
            "                # Check whether we should merge adjacent elements of the same",
            "                # tag type",
            "                nx = element.getnext()",
            "                if (",
            "                    self.only_whitespace_re.match(element.tail or \"\")",
            "                    and nx is not None",
            "                    and nx.tag == element.tag",
            "                    and self.is_mergeable(element, nx)",
            "                ):",
            "                    # Yes, we should. Tail is empty, that is, no text between",
            "                    # tags of a mergeable type.",
            "                    if nx.text:",
            "                        if len(element):",
            "                            list(element)[-1].tail = \"{}{}\".format(",
            "                                list(element)[-1].tail or \"\",",
            "                                nx.text,",
            "                            )",
            "                        else:",
            "                            element.text = \"{}{}\".format(element.text or \"\", nx.text)",
            "",
            "                    for child in nx:",
            "                        element.append(child)",
            "",
            "                    # tail is merged with previous element.",
            "                    nx.drop_tree()",
            "",
            "                    # Process element again",
            "                    backlog.append(element)",
            "                    continue",
            "",
            "            for processor in self.element_postprocessors:",
            "                element = processor(element)",
            "",
            "            # remove all attributes which are not explicitly allowed",
            "            allowed = self.attributes.get(element.tag, [])",
            "            for key in element.keys():  # noqa: SIM118 (do not remove .keys())",
            "                if key not in allowed:",
            "                    del element.attrib[key]",
            "",
            "            # Clean hrefs so that they are benign",
            "            href = element.get(\"href\")",
            "            if href is not None:",
            "                element.set(\"href\", self.sanitize_href(href))",
            "",
            "            element = normalize_whitespace_in_text_or_tail(",
            "                element,",
            "                whitespace_re=self.whitespace_re,",
            "                keep_typographic_whitespace=self.keep_typographic_whitespace,",
            "            )",
            "",
            "        if self.autolink is True:",
            "            lxml.html.clean.autolink(doc)",
            "        elif isinstance(self.autolink, dict):",
            "            lxml.html.clean.autolink(doc, **self.autolink)",
            "",
            "        # Run cleaner again, but this time with even more strict settings",
            "        lxml.html.clean.Cleaner(",
            "            allow_tags=self.tags,",
            "            remove_unknown_tags=False,",
            "            safe_attrs_only=False,  # Our attributes allowlist is sufficient.",
            "            add_nofollow=self.add_nofollow,",
            "            forms=False,",
            "        )(doc)",
            "",
            "        html = lxml.html.tostring(doc, encoding=\"unicode\")",
            "",
            "        # add a space before the closing slash in empty tags",
            "        html = re.sub(r\"<([^/>]+)/>\", r\"<\\1 />\", html)",
            "",
            "        # remove wrapping tag needed by XML parser",
            "        html = re.sub(r\"^<div>|</div>$\", \"\", html)",
            "",
            "        # normalize unicode",
            "        if self.keep_typographic_whitespace:",
            "            html = unicodedata.normalize(\"NFC\", html)",
            "        else:",
            "            html = unicodedata.normalize(\"NFKC\", html)",
            "",
            "        return html"
        ],
        "afterPatchFile": [
            "import re",
            "import unicodedata",
            "from collections import deque",
            "",
            "import lxml.html",
            "import lxml.html.clean",
            "",
            "",
            "__all__ = (\"Sanitizer\",)",
            "",
            "",
            "def sanitize_href(href):",
            "    \"\"\"",
            "    Verify that a given href is benign and allowed.",
            "",
            "    This is a stupid check, which probably should be much more elaborate",
            "    to be safe.",
            "    \"\"\"",
            "    if href.startswith((\"/\", \"mailto:\", \"http:\", \"https:\", \"#\", \"tel:\")):",
            "        return href",
            "    return \"#\"",
            "",
            "",
            "typographic_whitespace_names = [",
            "    \"NO-BREAK SPACE\",",
            "    \"EN QUAD\",",
            "    \"EM QUAD\",",
            "    \"EN SPACE\",",
            "    \"EM SPACE\",",
            "    \"THREE-PER-EM SPACE\",",
            "    \"FOUR-PER-EM SPACE\",",
            "    \"SIX-PER-EM SPACE\",",
            "    \"FIGURE SPACE\",",
            "    \"PUNCTUATION SPACE\",",
            "    \"THIN SPACE\",",
            "    \"HAIR SPACE\",",
            "    \"NARROW NO-BREAK SPACE\",",
            "    \"MEDIUM MATHEMATICAL SPACE\",",
            "    \"IDEOGRAPHIC SPACE\",",
            "]",
            "",
            "typographic_whitespace = \"\".join(",
            "    {unicodedata.lookup(n) for n in typographic_whitespace_names}",
            ")",
            "",
            "",
            "def normalize_overall_whitespace(",
            "    html, *, keep_typographic_whitespace=False, whitespace_re=None",
            "):",
            "    if keep_typographic_whitespace:",
            "        return html",
            "    whitespace = [",
            "        \"\\xa0\",",
            "        \"&nbsp;\",",
            "        \"&#160;\",",
            "        \"&#xa0;\",",
            "        \"\\n\",",
            "        \"&#10;\",",
            "        \"&#xa;\",",
            "        \"\\r\",",
            "        \"&#13;\",",
            "        \"&#xd;\",",
            "    ]",
            "    for ch in whitespace:",
            "        html = html.replace(ch, \" \")",
            "    if whitespace_re is None:",
            "        whitespace_re = r\"\\s+\"",
            "    html = re.sub(whitespace_re, \" \", html)",
            "    return html",
            "",
            "",
            "def bold_span_to_strong(element):",
            "    if element.tag == \"span\" and \"bold\" in element.get(\"style\", \"\"):",
            "        element.tag = \"strong\"",
            "    return element",
            "",
            "",
            "def italic_span_to_em(element):",
            "    if element.tag == \"span\" and \"italic\" in element.get(\"style\", \"\"):",
            "        element.tag = \"em\"",
            "    return element",
            "",
            "",
            "def tag_replacer(from_, to_):",
            "    def replacer(element):",
            "        if element.tag == from_:",
            "            element.tag = to_",
            "        return element",
            "",
            "    return replacer",
            "",
            "",
            "def target_blank_noopener(element):",
            "    if (",
            "        element.tag == \"a\"",
            "        and element.attrib.get(\"target\") == \"_blank\"",
            "        and \"noopener\" not in element.attrib.get(\"rel\", \"\")",
            "    ):",
            "        element.attrib[\"rel\"] = \" \".join(",
            "            part for part in (element.attrib.get(\"rel\", \"\"), \"noopener\") if part",
            "        )",
            "    return element",
            "",
            "",
            "def anchor_id_to_name(element):",
            "    if (",
            "        element.tag == \"a\"",
            "        and element.attrib.get(\"id\")",
            "        and not element.attrib.get(\"name\")",
            "    ):",
            "        element.attrib[\"name\"] = element.attrib[\"id\"]",
            "    return element",
            "",
            "",
            "def normalize_whitespace_in_text_or_tail(",
            "    element, *, whitespace_re=None, keep_typographic_whitespace=False",
            "):",
            "    if whitespace_re is None:",
            "        whitespace_re = re.compile(r\"\\s+\")",
            "    if element.text and not keep_typographic_whitespace:",
            "        while True:",
            "            text = whitespace_re.sub(\" \", element.text)",
            "            if element.text == text:",
            "                break",
            "            element.text = text",
            "",
            "    if element.tail and not keep_typographic_whitespace:",
            "        while True:",
            "            text = whitespace_re.sub(\" \", element.tail)",
            "            if element.tail == text:",
            "                break",
            "            element.tail = text",
            "",
            "    return element",
            "",
            "",
            "DEFAULT_SETTINGS = {",
            "    \"tags\": {",
            "        \"a\",",
            "        \"h1\",",
            "        \"h2\",",
            "        \"h3\",",
            "        \"strong\",",
            "        \"em\",",
            "        \"p\",",
            "        \"ul\",",
            "        \"ol\",",
            "        \"li\",",
            "        \"br\",",
            "        \"sub\",",
            "        \"sup\",",
            "        \"hr\",",
            "    },",
            "    \"attributes\": {\"a\": (\"href\", \"name\", \"target\", \"title\", \"rel\")},",
            "    \"empty\": {\"hr\", \"a\", \"br\"},",
            "    \"separate\": {\"a\", \"p\", \"li\"},",
            "    \"whitespace\": {\"br\"},",
            "    \"keep_typographic_whitespace\": False,",
            "    \"add_nofollow\": False,",
            "    \"autolink\": False,",
            "    \"sanitize_href\": sanitize_href,",
            "    \"element_preprocessors\": [",
            "        # convert span elements into em/strong if a matching style rule",
            "        # has been found. strong has precedence, strong & em at the same",
            "        # time is not supported",
            "        bold_span_to_strong,",
            "        italic_span_to_em,",
            "        tag_replacer(\"b\", \"strong\"),",
            "        tag_replacer(\"i\", \"em\"),",
            "        tag_replacer(\"form\", \"p\"),",
            "        target_blank_noopener,",
            "        anchor_id_to_name,",
            "    ],",
            "    \"element_postprocessors\": [],",
            "}",
            "",
            "",
            "def coerce_to_set(value):",
            "    if isinstance(value, set):",
            "        return value",
            "    elif isinstance(value, (tuple, list)):",
            "        return set(value)",
            "    raise TypeError(f\"Expected a set but got value {value!r} of type {type(value)}\")",
            "",
            "",
            "class Sanitizer:",
            "    def __init__(self, settings=None):",
            "        self.__dict__.update(DEFAULT_SETTINGS)",
            "        self.__dict__.update(settings or {})",
            "",
            "        # Allow iterables of any kind, not just sets.",
            "        self.tags = coerce_to_set(self.tags)",
            "        self.empty = coerce_to_set(self.empty)",
            "        self.separate = coerce_to_set(self.separate)",
            "        self.whitespace = coerce_to_set(self.whitespace)",
            "        self.attributes = {",
            "            tag: coerce_to_set(attributes)",
            "            for tag, attributes in self.attributes.items()",
            "        }",
            "",
            "        if self.keep_typographic_whitespace:",
            "            re_whitespace = r\"[^\\S%s]\" % typographic_whitespace",
            "        else:",
            "            re_whitespace = r\"\\s\"",
            "",
            "        self.only_whitespace_re = re.compile(rf\"^{re_whitespace}*$\")",
            "        self.whitespace_re = re.compile(rf\"{re_whitespace}+\")",
            "",
            "        # Validate the settings.",
            "        if not self.tags:",
            "            raise TypeError(",
            "                \"Empty list of allowed tags is not supported by the underlying\"",
            "                \" lxml cleaner. If you really do not want to pass any tags\"",
            "                \" pass a made-up tag name which will never exist in your\"",
            "                \" document.\"",
            "            )",
            "        if not self.tags.issuperset(self.empty):",
            "            raise TypeError(",
            "                f'Tags in \"empty\", but not allowed: {self.empty - self.tags!r}'",
            "            )",
            "        if not self.tags.issuperset(self.separate):",
            "            raise TypeError(",
            "                f'Tags in \"separate\", but not allowed: {self.separate - self.tags!r}'",
            "            )",
            "        if not self.tags.issuperset(self.attributes.keys()):",
            "            raise TypeError(",
            "                f'Tags in \"attributes\", but not allowed: {set(self.attributes.keys()) - self.tags!r}'",
            "            )",
            "",
            "        anchor_attributes = self.attributes.get(\"a\", ())",
            "        if \"target\" in anchor_attributes and \"rel\" not in anchor_attributes:",
            "            raise TypeError(",
            "                'Always allow \"rel\" when allowing \"target\" as anchor' \" attribute\"",
            "            )",
            "",
            "    @staticmethod",
            "    def is_mergeable(e1, e2):",
            "        \"\"\"",
            "        Decide if the adjacent elements of the same type e1 and e2 can be",
            "        merged. This can be overriden to honouring distinct classes etc.",
            "        \"\"\"",
            "        return True",
            "",
            "    def sanitize(self, html):",
            "        \"\"\"",
            "        Clean HTML code from ugly copy-pasted CSS and empty elements",
            "",
            "        Removes everything not explicitly allowed in ``self.allowed_tags``.",
            "",
            "        Requires ``lxml`` and, for especially broken HTML, ``beautifulsoup4``.",
            "        \"\"\"",
            "",
            "        # normalize unicode",
            "        if self.keep_typographic_whitespace:",
            "            html = unicodedata.normalize(\"NFC\", html)",
            "        else:",
            "            html = unicodedata.normalize(\"NFKC\", html)",
            "",
            "        html = normalize_overall_whitespace(",
            "            html,",
            "            keep_typographic_whitespace=self.keep_typographic_whitespace,",
            "            whitespace_re=self.whitespace_re,",
            "        )",
            "        html = \"<div>%s</div>\" % html",
            "        try:",
            "            doc = lxml.html.fromstring(html)",
            "            lxml.html.tostring(doc, encoding=\"utf-8\")",
            "        except Exception:  # We could and maybe should be more specific...",
            "            from lxml.html import soupparser",
            "",
            "            doc = soupparser.fromstring(html)",
            "",
            "        lxml.html.clean.Cleaner(",
            "            remove_unknown_tags=False,",
            "            # Remove style *tags* if not explicitly allowed",
            "            style=\"style\" not in self.tags,",
            "            # Do not strip out style attributes; we still need the style",
            "            # information to convert spans into em/strong tags",
            "            safe_attrs_only=False,",
            "            inline_style=False,",
            "            # Do not strip all form tags; we will filter them below",
            "            forms=False,",
            "        )(doc)",
            "",
            "        # walk the tree recursively, because we want to be able to remove",
            "        # previously emptied elements completely",
            "        backlog = deque(doc.iterdescendants())",
            "",
            "        while True:",
            "            try:",
            "                element = backlog.pop()",
            "            except IndexError:",
            "                break",
            "",
            "            for processor in self.element_preprocessors:",
            "                element = processor(element)",
            "",
            "            element = normalize_whitespace_in_text_or_tail(",
            "                element,",
            "                whitespace_re=self.whitespace_re,",
            "                keep_typographic_whitespace=self.keep_typographic_whitespace,",
            "            )",
            "",
            "            # remove empty tags if they are not explicitly allowed",
            "            if (",
            "                (not element.text or self.only_whitespace_re.match(element.text))",
            "                and element.tag not in self.empty",
            "                and not len(element)",
            "            ):",
            "                element.drop_tag()",
            "                continue",
            "",
            "            # remove tags which only contain whitespace and/or <br>s",
            "            if (",
            "                element.tag not in self.empty",
            "                and self.only_whitespace_re.match(element.text or \"\")",
            "                and {e.tag for e in element} <= self.whitespace",
            "                and all(self.only_whitespace_re.match(e.tail or \"\") for e in element)",
            "            ):",
            "                element.drop_tree()",
            "                continue",
            "",
            "            if element.tag in {\"li\", \"p\"}:",
            "                # remove p-in-li and p-in-p tags",
            "                for p in element.findall(\"p\"):",
            "                    if getattr(p, \"text\", None):",
            "                        p.text = \" \" + p.text + \" \"",
            "                    p.drop_tag()",
            "",
            "                # remove list markers, maybe copy-pasted from word or whatever",
            "                if element.text:",
            "                    element.text = re.sub(r\"^\\s*(-|\\*|&#183;)\\s+\", \"\", element.text)",
            "",
            "            elif element.tag in self.whitespace:",
            "                # Drop the next element if",
            "                # 1. it is a <br> too and 2. there is no content in-between",
            "                nx = element.getnext()",
            "                if (",
            "                    nx is not None",
            "                    and nx.tag == element.tag",
            "                    and (",
            "                        not element.tail or self.only_whitespace_re.match(element.tail)",
            "                    )",
            "                ):",
            "                    nx.drop_tag()",
            "",
            "            if not element.text:",
            "                # No text before first child and first child is a <br>: Drop it",
            "                first = list(element)[0] if list(element) else None",
            "                if first is not None and first.tag in self.whitespace:",
            "                    first.drop_tag()",
            "                    # Maybe we have more than one <br>",
            "                    backlog.append(element)",
            "                    continue",
            "",
            "            if element.tag in (self.tags - self.separate):",
            "                # Check whether we should merge adjacent elements of the same",
            "                # tag type",
            "                nx = element.getnext()",
            "                if (",
            "                    self.only_whitespace_re.match(element.tail or \"\")",
            "                    and nx is not None",
            "                    and nx.tag == element.tag",
            "                    and self.is_mergeable(element, nx)",
            "                ):",
            "                    # Yes, we should. Tail is empty, that is, no text between",
            "                    # tags of a mergeable type.",
            "                    if nx.text:",
            "                        if len(element):",
            "                            list(element)[-1].tail = \"{}{}\".format(",
            "                                list(element)[-1].tail or \"\",",
            "                                nx.text,",
            "                            )",
            "                        else:",
            "                            element.text = \"{}{}\".format(element.text or \"\", nx.text)",
            "",
            "                    for child in nx:",
            "                        element.append(child)",
            "",
            "                    # tail is merged with previous element.",
            "                    nx.drop_tree()",
            "",
            "                    # Process element again",
            "                    backlog.append(element)",
            "                    continue",
            "",
            "            for processor in self.element_postprocessors:",
            "                element = processor(element)",
            "",
            "            # remove all attributes which are not explicitly allowed",
            "            allowed = self.attributes.get(element.tag, [])",
            "            for key in element.keys():  # noqa: SIM118 (do not remove .keys())",
            "                if key not in allowed:",
            "                    del element.attrib[key]",
            "",
            "            # Clean hrefs so that they are benign",
            "            href = element.get(\"href\")",
            "            if href is not None:",
            "                element.set(\"href\", self.sanitize_href(href))",
            "",
            "            element = normalize_whitespace_in_text_or_tail(",
            "                element,",
            "                whitespace_re=self.whitespace_re,",
            "                keep_typographic_whitespace=self.keep_typographic_whitespace,",
            "            )",
            "",
            "        if self.autolink is True:",
            "            lxml.html.clean.autolink(doc)",
            "        elif isinstance(self.autolink, dict):",
            "            lxml.html.clean.autolink(doc, **self.autolink)",
            "",
            "        # Run cleaner again, but this time with even more strict settings",
            "        lxml.html.clean.Cleaner(",
            "            allow_tags=self.tags,",
            "            remove_unknown_tags=False,",
            "            safe_attrs_only=False,  # Our attributes allowlist is sufficient.",
            "            add_nofollow=self.add_nofollow,",
            "            forms=False,",
            "        )(doc)",
            "",
            "        html = lxml.html.tostring(doc, encoding=\"unicode\")",
            "",
            "        # add a space before the closing slash in empty tags",
            "        html = re.sub(r\"<([^/>]+)/>\", r\"<\\1 />\", html)",
            "",
            "        # remove wrapping tag needed by XML parser",
            "        html = re.sub(r\"^<div>|</div>$\", \"\", html)",
            "",
            "        return html"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0"
        ],
        "dele_reviseLocation": {
            "423": [
                "Sanitizer",
                "sanitize"
            ],
            "424": [
                "Sanitizer",
                "sanitize"
            ],
            "425": [
                "Sanitizer",
                "sanitize"
            ],
            "426": [
                "Sanitizer",
                "sanitize"
            ],
            "427": [
                "Sanitizer",
                "sanitize"
            ],
            "428": [
                "Sanitizer",
                "sanitize"
            ]
        },
        "addLocation": [
            "pypdf.generic._data_structures"
        ]
    },
    "html_sanitizer/tests.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 655,
                "afterPatchRowNumber": 655,
                "PatchRowcode": "                 (\"<br hello=\\\"alert('world');\\\"/><br>\", \"<br>\"),"
            },
            "1": {
                "beforePatchRowNumber": 656,
                "afterPatchRowNumber": 656,
                "PatchRowcode": "             ]"
            },
            "2": {
                "beforePatchRowNumber": 657,
                "afterPatchRowNumber": 657,
                "PatchRowcode": "         )"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 658,
                "PatchRowcode": "+"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 659,
                "PatchRowcode": "+    def test_normalize_early(self):"
            },
            "5": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 660,
                "PatchRowcode": "+        self.run_tests("
            },
            "6": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 661,
                "PatchRowcode": "+            ["
            },
            "7": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 662,
                "PatchRowcode": "+                ("
            },
            "8": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 663,
                "PatchRowcode": "+                    \"\\uff1cimg src=x onerror=\\uff02alert(window.location)\\uff02\\uff1e\","
            },
            "9": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 664,
                "PatchRowcode": "+                    \"\","
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 665,
                "PatchRowcode": "+                ),"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 666,
                "PatchRowcode": "+            ]"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 667,
                "PatchRowcode": "+        )"
            }
        },
        "frontPatchFile": [
            "from unittest import TestCase",
            "",
            "from .sanitizer import Sanitizer",
            "",
            "",
            "default_sanitizer = Sanitizer()",
            "",
            "",
            "class SanitizerTestCase(TestCase):",
            "    def run_tests(self, entries, *, sanitizer=default_sanitizer, strip=False):",
            "        for before, after in entries:",
            "            with self.subTest(before=before, after=after):",
            "                after = before if after is None else after  # noqa: PLW2901",
            "                result = sanitizer.sanitize(before)",
            "                self.assertEqual(",
            "                    result.strip() if strip else result,",
            "                    after.strip() if strip else after,",
            "                    b\"Cleaning '%s', expected '%s' but got '%s'\"",
            "                    % (",
            "                        before.encode(\"unicode-escape\"),",
            "                        after.encode(\"unicode-escape\"),",
            "                        result.encode(\"unicode-escape\"),",
            "                    ),",
            "                )",
            "",
            "    def test_01_sanitize(self):",
            "        entries = [",
            "            (\"<p>&nbsp;</p>\", \" \"),",
            "            (\"<p>           </p>\", \" \"),",
            "            (",
            "                '<span style=\"font-weight: bold;\">Something</span><p></p>',",
            "                \"<strong>Something</strong>\",",
            "            ),",
            "            (",
            "                \"<p>abc <span>def <em>ghi</em> jkl</span> mno</p>\",",
            "                \"<p>abc def <em>ghi</em> jkl mno</p>\",",
            "            ),",
            "            (",
            "                '<span style=\"font-style: italic;\">Something</span><p></p>',",
            "                \"<em>Something</em>\",",
            "            ),",
            "            ('<h2 style=\"font-weight:bold\">bla</h2>', \"<h2>bla</h2>\"),",
            "            ('<h2 style=\"font-style:italic\">bla</h2>', \"<h2>bla</h2>\"),",
            "            (\"<p>abc<br />def</p>\", \"<p>abc<br>def</p>\"),",
            "            (\"<p><br/><br/><strong></strong>  <br/></p>\", \"\"),",
            "            (\"<p><br/><strong></strong>  <br/> abc</p>\", \"<p> abc</p>\"),",
            "            (\"<li><br>bla</li>\", \"<li>bla</li>\"),",
            "            (",
            "                \"<p><strong>just</strong> <em>testing</em></p>\",",
            "                \"<p><strong>just</strong> <em>testing</em></p>\",",
            "            ),",
            "            (",
            "                \"<p>Hallo<br>Welt<br><br>Hallo<br>Welt</p>\",",
            "                \"<p>Hallo<br>Welt<br>Hallo<br>Welt</p>\",",
            "            ),",
            "            (",
            "                \"<p><strong>Zeile 1</strong><br>Zeile 2<br>Zeile 3</p>\",",
            "                \"<p><strong>Zeile 1</strong><br>Zeile 2<br>Zeile 3</p>\",",
            "            ),",
            "            (",
            "                \"<p><strong>A</strong>, <strong>B</strong>\"",
            "                \" und <strong>C</strong></p>\",",
            "                \"<p><strong>A</strong>, <strong>B</strong>\"",
            "                \" und <strong>C</strong></p>\",",
            "            ),",
            "            (\"<p><form>Zeile 1</form></p>\", \"<p>Zeile 1</p>\"),",
            "            # Suboptimal, should be cleaned further",
            "            (\"<form><p>Zeile 2</p></form>\", \"<p> Zeile 2 </p>\"),",
            "            (\"1<p> </p>2\", \"1 2\"),",
            "            (\"1<p></p>2\", \"12\"),",
            "            (\"<p>son<strong>der</strong>bar</p>\", \"<p>son<strong>der</strong>bar</p>\"),",
            "            # Empty a tags are allowed...",
            "            (\"<a>  </a>\", \"<a> </a>\"),",
            "            # ...but breaks without any additional content are still removed",
            "            (\"<a><br />  </a>\", \"<a> </a>\"),",
            "            (\"<p>blab<br hello='world' />blub<p>\", \"<p>blab<br>blub</p>\"),",
            "        ]",
            "",
            "        self.run_tests(entries)",
            "",
            "    def test_02_a_tag(self):",
            "        entries = (",
            "            ('<a href=\"/foo\">foo</a>', None),",
            "            (",
            "                '<a href=\"/foo\" name=\"bar\" target=\"some\" title=\"baz\"'",
            "                ' cookies=\"yesplease\">foo</a>',",
            "                '<a href=\"/foo\" name=\"bar\" target=\"some\" title=\"baz\">foo</a>',",
            "            ),",
            "            ('<a href=\"http://somewhere.else\">foo</a>', None),",
            "            ('<a href=\"https://somewhere.else\">foo</a>', None),",
            "            ('<a href=\"javascript:alert()\">foo</a>', '<a href=\"#\">foo</a>'),",
            "            ('<a href=\"javascript%3Aalert()\">foo</a>', '<a href=\"#\">foo</a>'),",
            "            ('<a href=\"mailto:foo@bar.com\">foo</a>', None),",
            "            ('<a href=\"tel:1-234-567-890\">foo</a>', None),",
            "        )",
            "",
            "        self.run_tests(entries)",
            "",
            "    def test_03_merge(self):",
            "        entries = (",
            "            (\"<h2>foo</h2><h2>bar</h2>\", \"<h2>foobar</h2>\"),",
            "            (\"<h2>foo  </h2>   <h2>   bar</h2>\", \"<h2>foo bar</h2> \"),",
            "        )",
            "",
            "        self.run_tests(entries)",
            "",
            "    def test_no_space_between_same_tags(self):",
            "        entries = [",
            "            (\"<strong>Hel</strong><strong>lo</strong>\", \"<strong>Hello</strong>\")",
            "        ]",
            "        self.run_tests(entries)",
            "",
            "    def test_04_p_in_li(self):",
            "        entries = (",
            "            (\"<li><p>foo</p></li>\", \"<li> foo </li>\"),",
            "            (\"<li>&nbsp;<p>foo</p> &#160; </li>\", \"<li> foo </li>\"),",
            "            (",
            "                \"<li>foo<p>bar<strong>xx</strong>rab</p><strong>baz</strong>\"",
            "                \"a<p>b</p>c</li>\",",
            "                \"<li>foo bar <strong>xx</strong>rab<strong>baz</strong>a b\" \" c</li>\",",
            "            ),",
            "        )",
            "",
            "        self.run_tests(entries)",
            "",
            "    def test_05_p_in_p(self):",
            "        entries = (",
            "            (\"<p><p>foo</p></p>\", \"<p>foo</p>\"),",
            "            (\"<p><p><p>&nbsp;</p> </p><p><br /></p></p>\", \" \"),",
            "            # This is actually correct as the second <p> implicitely",
            "            # closes the first paragraph, and the trailing </p> is",
            "            # deleted because it has no matching opening <p>",
            "            (\"<p>foo<p>bar</p>baz</p>\", \"<p>foo</p><p>bar</p>baz\"),",
            "            (\"<p>bla <p>blub</p> blaaa</p>\", \"<p>bla </p><p>blub</p> blaaa\"),",
            "            (",
            "                \"<p>text1 <p>text2</p> tail2 <p>text3</p> tail3 </p>tail1\",",
            "                \"<p>text1 </p><p>text2</p> tail2 <p>text3</p> tail3 tail1\",",
            "            ),",
            "        )",
            "",
            "        self.run_tests(entries)",
            "",
            "    def test_06_allowlist(self):",
            "        entries = (",
            "            ('<script src=\"http://abc\">foo</script>', \"\"),",
            "            ('<script type=\"text/javascript\">foo</script>', \"\"),",
            "        )",
            "",
            "        self.run_tests(entries)",
            "",
            "    def test_07_configuration(self):",
            "        sanitizer = Sanitizer(",
            "            {\"tags\": [\"h1\", \"h2\"], \"empty\": (), \"separate\": (), \"attributes\": {}}",
            "        )",
            "",
            "        entries = (",
            "            (\"<h1>foo</h1>\", None),",
            "            (\"<h1>foo</h1><h2>bar</h2><h3>baz</h3>\", \"<h1>foo</h1><h2>bar</h2>baz\"),",
            "        )",
            "",
            "        self.run_tests(entries, sanitizer=sanitizer)",
            "",
            "    def test_08_li_with_marker(self):",
            "        entries = (",
            "            (\"<li> - foo</li>\", \"<li>foo</li>\"),",
            "            (\"<li>* foo</li>\", \"<li>foo</li>\"),",
            "            (\"<li>*foo</li>\", \"<li>*foo</li>\"),",
            "        )",
            "",
            "        self.run_tests(entries)",
            "",
            "    def test_09_empty_p_text_in_li(self):",
            "        # this results in an empty p.text",
            "        entries = (",
            "            (\"<li><p><strong>foo</strong></p></li>\", \"<li><strong>foo</strong></li>\"),",
            "            (\"<li><p><em>foo</em></p></li>\", \"<li><em>foo</em></li>\"),",
            "        )",
            "",
            "        self.run_tests(entries)",
            "",
            "    def test_10_broken_html(self):",
            "        entries = (",
            "            (\"<p><strong>bla\", \"<p><strong>bla</strong></p>\"),",
            "            (\"<p><strong>bla<>/dsiad<p/\", \"<p><strong>bla&lt;&gt;/dsiad</strong></p>\"),",
            "        )",
            "",
            "        self.run_tests(entries)",
            "",
            "    def test_11_nofollow(self):",
            "        sanitizer = Sanitizer({\"add_nofollow\": True})",
            "",
            "        entries = (",
            "            (",
            "                '<p><a href=\"http://example.com/\">example.com</a></p>',",
            "                '<p><a href=\"http://example.com/\"'",
            "                ' rel=\"nofollow\">example.com</a></p>',",
            "            ),",
            "        )",
            "",
            "        self.run_tests(entries, sanitizer=sanitizer)",
            "",
            "    def test_12_replacements(self):",
            "        entries = (",
            "            (\"<b>Bla</b>\", \"<strong>Bla</strong>\"),",
            "            (\"<i>Bla</i>\", \"<em>Bla</em>\"),",
            "        )",
            "",
            "        self.run_tests(entries)",
            "",
            "    def test_13_autolink(self):",
            "        self.run_tests([(\"<p>https://github.com/</p>\", \"<p>https://github.com/</p>\")])",
            "",
            "        sanitizer = Sanitizer({\"autolink\": True})",
            "",
            "        self.run_tests(",
            "            [",
            "                (",
            "                    \"<p>https://github.com/</p>\",",
            "                    '<p><a href=\"https://github.com/\">https://github.com/</a></p>',",
            "                ),",
            "                (",
            "                    # localhost is not autolinked by default by lxml",
            "                    \"<p>https://localhost/</p>\",",
            "                    \"<p>https://localhost/</p>\",",
            "                ),",
            "            ],",
            "            sanitizer=sanitizer,",
            "        )",
            "",
            "        sanitizer = Sanitizer({\"autolink\": True, \"add_nofollow\": True})",
            "",
            "        self.run_tests(",
            "            [",
            "                (",
            "                    \"<p>https://github.com/</p>\",",
            "                    '<p><a href=\"https://github.com/\"'",
            "                    ' rel=\"nofollow\">https://github.com/</a></p>',",
            "                )",
            "            ],",
            "            sanitizer=sanitizer,",
            "        )",
            "",
            "        sanitizer = Sanitizer({\"autolink\": {\"avoid_hosts\": []}})",
            "",
            "        self.run_tests(",
            "            [",
            "                (",
            "                    \"<p>https://github.com/</p>\",",
            "                    '<p><a href=\"https://github.com/\">https://github.com/</a></p>',",
            "                ),",
            "                (",
            "                    \"<p>https://localhost/</p>\",",
            "                    '<p><a href=\"https://localhost/\">https://localhost/</a></p>',",
            "                ),",
            "            ],",
            "            sanitizer=sanitizer,",
            "        )",
            "",
            "    def test_14_classes(self):",
            "        \"\"\"Class attributes should not be treated specially\"\"\"",
            "        sanitizer = Sanitizer(",
            "            {",
            "                \"tags\": {\"h1\", \"h2\", \"p\", \"a\", \"span\"},",
            "                \"attributes\": {",
            "                    \"a\": (\"href\", \"name\", \"target\", \"title\", \"id\", \"rel\"),",
            "                    \"h1\": (\"class\",),",
            "                    \"p\": (\"class\",),",
            "                    \"span\": (\"class\",),",
            "                },",
            "                \"empty\": set(),",
            "                \"separate\": {\"a\", \"p\"},",
            "            }",
            "        )",
            "",
            "        self.run_tests(",
            "            [",
            "                ('<p class=\"centered\">Test</p>', '<p class=\"centered\">Test</p>'),",
            "                (",
            "                    '<p class=\"centered\">Test <span class=\"bla\">span</span></p>',",
            "                    '<p class=\"centered\">Test <span class=\"bla\">span</span></p>',",
            "                ),",
            "                (",
            "                    '<p class=\"centered\">Test <span class=\"bla\">span</span>'",
            "                    '<span class=\"blub\">span</span></p>',",
            "                    '<p class=\"centered\">Test <span class=\"bla\">spanspan</span></p>',",
            "                ),",
            "                ('<h1 class=\"centered\">Test</h1>', '<h1 class=\"centered\">Test</h1>'),",
            "                ('<h2 class=\"centered\">Test</h2>', \"<h2>Test</h2>\"),",
            "            ],",
            "            sanitizer=sanitizer,",
            "        )",
            "",
            "    def test_15_classes(self):",
            "        \"\"\"Class attributes may disable merging\"\"\"",
            "        sanitizer = Sanitizer(",
            "            {",
            "                \"tags\": {\"h1\", \"h2\", \"p\", \"a\", \"span\"},",
            "                \"attributes\": {",
            "                    \"a\": (\"href\", \"name\", \"target\", \"title\", \"id\", \"rel\"),",
            "                    \"h1\": (\"class\",),",
            "                    \"p\": (\"class\",),",
            "                    \"span\": (\"class\",),",
            "                },",
            "                \"empty\": set(),",
            "                \"separate\": {\"a\", \"p\"},",
            "                \"is_mergeable\": lambda e1, e2: e1.get(\"class\") == e2.get(\"class\"),",
            "            }",
            "        )",
            "",
            "        self.run_tests(",
            "            [",
            "                (",
            "                    '<p class=\"centered\">Test <span class=\"bla\">span</span>'",
            "                    '<span class=\"blub\">span</span></p>',",
            "                    '<p class=\"centered\">Test <span class=\"bla\">span</span>'",
            "                    '<span class=\"blub\">span</span></p>',",
            "                ),",
            "                (",
            "                    '<p class=\"centered\">Test <span class=\"bla\">span</span>'",
            "                    '<span class=\"bla\">span</span></p>',",
            "                    '<p class=\"centered\">Test <span class=\"bla\">spanspan</span></p>',",
            "                ),",
            "            ],",
            "            sanitizer=sanitizer,",
            "        )",
            "",
            "    def test_16_emoji(self):",
            "        self.run_tests([(\"<p>\ud83d\ude02</p>\", \"<p>\ud83d\ude02</p>\"), (\"<p>\ud83d\udc95</p>\", \"<p>\ud83d\udc95</p>\")])",
            "",
            "    def test_target_blank(self):",
            "        self.run_tests(",
            "            [",
            "                (",
            "                    '<a href=\"#\" target=\"_blank\">test</a>',",
            "                    '<a href=\"#\" target=\"_blank\" rel=\"noopener\">test</a>',",
            "                )",
            "            ]",
            "        )",
            "",
            "    def test_remove_everything(self):",
            "        sanitizer = Sanitizer(",
            "            {\"tags\": {\"__never\"}, \"attributes\": {}, \"empty\": set(), \"separate\": set()}",
            "        )",
            "",
            "        self.run_tests(",
            "            [",
            "                (",
            "                    '<span style=\"color:#000000;font-weight:bold\">11:44:14</span>',",
            "                    \"11:44:14\",",
            "                )",
            "            ],",
            "            sanitizer=sanitizer,",
            "        )",
            "",
            "    def test_more_merging(self):",
            "        self.run_tests(",
            "            [",
            "                (\"<p><hr></p>\", \"<hr>\"),",
            "                (\"<hr><hr><hr>\", \"<hr>\"),",
            "                (",
            "                    '<a name=\"a\"></a><a name=\"b\"></a>',",
            "                    '<a name=\"a\"></a><a name=\"b\"></a>',",
            "                ),",
            "            ]",
            "        )",
            "",
            "    def test_keep_consecutive_br_tags(self):",
            "        sanitizer = Sanitizer({\"whitespace\": set(), \"separate\": {\"br\"}})",
            "        self.run_tests(",
            "            [",
            "                (\"<p>Hello<br><br>World</p>\", \"<p>Hello<br><br>World</p>\"),",
            "                (\"<p>Hello<br><br></p>\", \"<p>Hello<br><br></p>\"),",
            "                (\"<p><br><br>World</p>\", \"<p><br><br>World</p>\"),",
            "                (\"<p><br><br></p>\", \"<p><br><br></p>\"),",
            "                (\"<p><br></p><hr><br></p>\", \"<p><br></p><hr><br>\"),",
            "            ],",
            "            sanitizer=sanitizer,",
            "        )",
            "",
            "    def test_custom_allowed_attribute(self):",
            "        sanitizer = Sanitizer({\"attributes\": {\"a\": (\"href\", \"custom\")}})",
            "        self.run_tests(",
            "            [",
            "                (",
            "                    '<a href=\"http://example.com\" custom=\"1\" abc=\"2\">Test</a>',",
            "                    '<a href=\"http://example.com\" custom=\"1\">Test</a>',",
            "                )",
            "            ],",
            "            sanitizer=sanitizer,",
            "        )",
            "",
            "    def test_blob(self):",
            "        source = \"\"\"\\",
            "<p class=\"western\" style=\"margin-left: 0.39in; text-indent: -0.39in; margin-top: 0.25in; margin-bottom: 0in; line-height: 0.19in\" lang=\"de-DE\" align=\"justify\">",
            "<font style=\"font-size: 12pt\" size=\"3\"><b>1.2.\tDefinition des",
            "Spesenbegriffs</b></font></p>",
            "<p class=\"western\" style=\"margin-left: 0.39in; margin-top: 0.13in; margin-bottom: 0in; line-height: 0.19in\" lang=\"de-DE\" align=\"justify\">",
            "<font style=\"font-size: 12pt\" size=\"3\">Als Spesen im Sinne dieses",
            "Reglements gelten die Auslagen, die einem Mitarbeitenden im Interesse",
            "des Arbeitgebers angefallen sind. S\u00e4mtliche Mitarbeitende sind",
            "verpflichtet, ihre Spesen im Rahmen dieses Reglements m\u00f6glichst tief",
            "zu halten. Aufwendungen, die f\u00fcr die Arbeitsausf\u00fchrung nicht",
            "notwendig waren, werden von der Firma nicht \u00fcbernommen, sondern sind",
            "von den Mitarbeitenden selbst zu tragen.</font></p>",
            "<p class=\"western\" style=\"margin-left: 0.39in; margin-top: 0.13in; margin-bottom: 0in; line-height: 0.19in\" lang=\"de-DE\" align=\"justify\">",
            "<font style=\"font-size: 12pt\" size=\"3\">Im Wesentlichen werden den",
            "Mitarbeitenden folgende gesch\u00e4ftlich bedingten Auslagen ersetzt:</font></p>",
            "<ul><li><p class=\"western\" style=\"margin-top: 0.13in; margin-bottom: 0in; line-height: 0.19in\" lang=\"de-DE\" align=\"justify\"> <font style=\"font-size: 12pt\" size=\"3\">-\tFahrtkosten\t\t\t\t\t(nachfolgend 2.)</font></p> </li><li><p class=\"western\" style=\"margin-bottom: 0in; line-height: 0.19in\" lang=\"de-DE\" align=\"justify\"> <font style=\"font-size: 12pt\" size=\"3\">-\tVerpflegungskosten\t\t\t(nachfolgend 3.)</font></p> </li><li><p class=\"western\" style=\"margin-bottom: 0in; line-height: 0.19in\" lang=\"de-DE\" align=\"justify\"> <font style=\"font-size: 12pt\" size=\"3\">-\t\u00dcbernachtungskosten\t\t\t(nachfolgend 4.)</font></p> </li><li><p class=\"western\" style=\"margin-bottom: 0in; line-height: 0.19in\" lang=\"de-DE\" align=\"justify\"> <font style=\"font-size: 12pt\" size=\"3\">-\t\u00dcbrige Kosten\t\t\t\t(nachfolgend 5.)</font></p> </li></ul>\"\"\"",
            "",
            "        result = \"\"\"\\",
            "<p> <strong>1.2. Definition des Spesenbegriffs</strong></p> <p> Als Spesen im Sinne dieses Reglements gelten die Auslagen, die einem Mitarbeitenden im Interesse des Arbeitgebers angefallen sind. S\u00e4mtliche Mitarbeitende sind verpflichtet, ihre Spesen im Rahmen dieses Reglements m\u00f6glichst tief zu halten. Aufwendungen, die f\u00fcr die Arbeitsausf\u00fchrung nicht notwendig waren, werden von der Firma nicht \u00fcbernommen, sondern sind von den Mitarbeitenden selbst zu tragen.</p> <p> Im Wesentlichen werden den Mitarbeitenden folgende gesch\u00e4ftlich bedingten Auslagen ersetzt:</p> <ul><li> - Fahrtkosten (nachfolgend 2.) </li><li> - Verpflegungskosten (nachfolgend 3.) </li><li> - \u00dcbernachtungskosten (nachfolgend 4.) </li><li> - \u00dcbrige Kosten (nachfolgend 5.) </li></ul>\"\"\"",
            "",
            "        # XXX An exact match isn't really required. Using Django's",
            "        # assertHTMLEqual would be great but we'd have to depend on Django in",
            "        # the test suite for this (not a big problem really, because then we",
            "        # could also test html_sanitizer.django but I didn't yet *have* to do",
            "        # this)",
            "        self.run_tests([(source, result)])",
            "",
            "    def test_keep_typographic_whitespace(self):",
            "        sanitizer = Sanitizer({\"keep_typographic_whitespace\": True})",
            "",
            "        # Note some unicode normalization of typographic whitespace",
            "        self.run_tests(",
            "            [",
            "                (",
            "                    \"\\u200a\\u2001\\u202f\\u2004\\xa0\\u2007\\u2002\\u2000\"",
            "                    \"\\u2003\\u2009\\u205f\\u2005\\u2006\\u2008\\u3000\",",
            "                    \"\\u200a\\u2003\\u202f\\u2004\\xa0\\u2007\\u2002\\u2002\"",
            "                    \"\\u2003\\u2009\\u205f\\u2005\\u2006\\u2008\\u3000\",",
            "                ),",
            "                (",
            "                    \"Hello This is a paragraph. \\n\"",
            "                    \"\\tHello. This is a tabled line.\"",
            "                    \"Hello.This is beginning of the end.\\r\",",
            "                    \"Hello This is a paragraph. \\n\"",
            "                    \"\\tHello. This is a tabled line.\"",
            "                    \"Hello.This is beginning of the end.\\r\",",
            "                ),",
            "                (",
            "                    \"something    <br>somethingelse    \",",
            "                    \"something    <br>somethingelse    \",",
            "                ),",
            "            ],",
            "            sanitizer=sanitizer,",
            "        )",
            "",
            "    def test_strip_typographic_whitespace(self):",
            "        sanitizer = Sanitizer({\"keep_typographic_whitespace\": False})",
            "",
            "        self.run_tests(",
            "            [",
            "                (",
            "                    \"\\u200a\\u2001\\u202f\\u2004\\xa0\\u2007\\u2002\\u2000\"",
            "                    \"\\u2003\\u2009\\u205f\\u2005\\u2006\\u2008\\u3000\",",
            "                    \" \",",
            "                )",
            "            ],",
            "            sanitizer=sanitizer,",
            "        )",
            "",
            "    def test_anchor_names(self):",
            "        self.run_tests(",
            "            [",
            "                (",
            "                    '<a name=\"test\" id=\"test\"></a>',",
            "                    '<a name=\"test\"></a>',",
            "                ),",
            "                (",
            "                    '<a name=\"test\"></a>',",
            "                    '<a name=\"test\"></a>',",
            "                ),",
            "                (",
            "                    '<a id=\"test\"></a>',",
            "                    '<a name=\"test\"></a>',",
            "                ),",
            "            ],",
            "        )",
            "",
            "    def test_style_tag(self):",
            "        # don't allow style tag (default)",
            "        self.run_tests(",
            "            [(\"foo<style>*{color: red}</style>bar\", \"foobar\")],",
            "            sanitizer=Sanitizer(",
            "                {",
            "                    \"tags\": {\"impossible tag\"},",
            "                    \"attributes\": {},",
            "                    \"empty\": set(),",
            "                    \"separate\": set(),",
            "                }",
            "            ),",
            "        )",
            "",
            "        # allow style tag but no style attribute",
            "        self.run_tests(",
            "            [",
            "                (",
            "                    \"foo<style>*{color: red}</style>bar\",",
            "                    \"foo<style>*{color: red}</style>bar\",",
            "                ),",
            "                ('<h2 style=\"font-weight:bold\">bla</h2>', \"<h2>bla</h2>\"),",
            "            ],",
            "            sanitizer=Sanitizer(",
            "                {",
            "                    \"tags\": {\"h2\", \"style\"},",
            "                    \"attributes\": {},",
            "                    \"empty\": set(),",
            "                    \"separate\": set(),",
            "                }",
            "            ),",
            "        )",
            "",
            "        # allow style tag and style attribute",
            "        self.run_tests(",
            "            [",
            "                (",
            "                    \"foo<style>*{color: red}</style>bar\",",
            "                    \"foo<style>*{color: red}</style>bar\",",
            "                ),",
            "                (",
            "                    '<h2 style=\"font-weight:bold\">bla</h2>',",
            "                    '<h2 style=\"font-weight:bold\">bla</h2>',",
            "                ),",
            "            ],",
            "            sanitizer=Sanitizer(",
            "                {",
            "                    \"tags\": {\"h2\", \"style\"},",
            "                    \"attributes\": {\"h2\": {\"style\"}},",
            "                    \"empty\": set(),",
            "                    \"separate\": set(),",
            "                }",
            "            ),",
            "        )",
            "",
            "    def test_billion_laughs(self):",
            "        before = \"\"\"\\",
            "<?xml version=\"1.0\"?>",
            "<!DOCTYPE lolz [",
            " <!ENTITY lol \"lol\">",
            " <!ELEMENT lolz (#PCDATA)>",
            " <!ENTITY lol1 \"&lol;&lol;&lol;&lol;&lol;&lol;&lol;&lol;&lol;&lol;\">",
            " <!ENTITY lol2 \"&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;\">",
            " <!ENTITY lol3 \"&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;\">",
            " <!ENTITY lol4 \"&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;\">",
            " <!ENTITY lol5 \"&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;\">",
            " <!ENTITY lol6 \"&lol5;&lol5;&lol5;&lol5;&lol5;&lol5;&lol5;&lol5;&lol5;&lol5;\">",
            " <!ENTITY lol7 \"&lol6;&lol6;&lol6;&lol6;&lol6;&lol6;&lol6;&lol6;&lol6;&lol6;\">",
            " <!ENTITY lol8 \"&lol7;&lol7;&lol7;&lol7;&lol7;&lol7;&lol7;&lol7;&lol7;&lol7;\">",
            " <!ENTITY lol9 \"&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;\">",
            "]>",
            "<lolz>&lol9;</lolz>",
            "\"\"\"",
            "",
            "        external_entities = \"\"\"\\",
            " <?xml version=\"1.0\"?>",
            "  <!DOCTYPE foo [",
            "   <!ELEMENT foo ANY >",
            "   <!ENTITY xxe SYSTEM \"file:///dev/random\" >]><foo>&xxe;</foo>",
            "\"\"\"",
            "",
            "        self.run_tests(",
            "            [",
            "                (before, \"]&gt; &amp;lol9;\"),",
            "                (external_entities, \"]&gt;&amp;xxe;\"),",
            "            ],",
            "            strip=True,",
            "        )",
            "",
            "    def test_data_attributes(self):",
            "        sanitizer = Sanitizer(",
            "            {",
            "                \"tags\": [\"span\"],",
            "                \"empty\": (),",
            "                \"separate\": (),",
            "                \"attributes\": {\"span\": {\"data-title\"}},",
            "            }",
            "        )",
            "",
            "        entries = (",
            "            (",
            "                '<span data-title=\"Test\">Content</span>',",
            "                '<span data-title=\"Test\">Content</span>',",
            "            ),",
            "            (",
            "                '<span data-title=\"Test\" data-other=\"Stuff\">Content</span>',",
            "                '<span data-title=\"Test\">Content</span>',",
            "            ),",
            "        )",
            "",
            "        self.run_tests(entries, sanitizer=sanitizer)",
            "",
            "    def test_entities(self):",
            "        self.run_tests(",
            "            [",
            "                (\"&lsquo;\", \"\\u2018\"),",
            "            ],",
            "        )",
            "",
            "    def test_invalid_attributes(self):",
            "        with self.assertRaisesRegex(TypeError, \"Expected a set but got\"):",
            "            Sanitizer({\"attributes\": {\"p\": (\"class\")}})",
            "",
            "        with self.assertRaisesRegex(TypeError, \"Expected a set but got\"):",
            "            Sanitizer({\"tags\": \"blub\"})",
            "",
            "        with self.assertRaisesRegex(TypeError, 'Tags in \"empty\", but not allowed:'):",
            "            Sanitizer({\"tags\": {\"blub\"}})",
            "",
            "    def test_img_tag(self):",
            "        sanitizer = Sanitizer(",
            "            {",
            "                \"tags\": {\"p\", \"img\"},",
            "                \"empty\": {\"img\"},",
            "                \"separate\": (),",
            "                \"attributes\": {\"img\": {\"alt\", \"src\"}},",
            "            }",
            "        )",
            "",
            "        entries = (",
            "            (",
            "                '<p><img src=\"hello.jpg\" alt=\"hello\" class=\"hello\"></p>',",
            "                '<p><img src=\"hello.jpg\" alt=\"hello\"></p>',",
            "            ),",
            "        )",
            "",
            "        self.run_tests(entries, sanitizer=sanitizer)",
            "",
            "    def test_code_whitespace(self):",
            "        sanitizer = Sanitizer(",
            "            {",
            "                \"tags\": {\"code\"},",
            "                \"empty\": set(),",
            "                \"separate\": set(),",
            "                \"attributes\": {},",
            "                \"keep_typographic_whitespace\": True,",
            "            }",
            "        )",
            "",
            "        html = \"\"\"\\",
            "<code>",
            "git status",
            "git add",
            "git commit",
            "</code>",
            "\"\"\"",
            "",
            "        self.run_tests([(html, html)], sanitizer=sanitizer)",
            "",
            "    def test_br_attribute_sanitization(self):",
            "        \"\"\"Attributes which aren't allowlisted are removed from br tags\"\"\"",
            "        self.run_tests(",
            "            [",
            "                (\"<p><br hello=\\\"alert('world');\\\"/><br></p>\", \"\"),",
            "                ('<p hello=\"world\"></p>', \"\"),",
            "                (\"<br hello=\\\"alert('world');\\\"/><br>\", \"<br>\"),",
            "            ]",
            "        )"
        ],
        "afterPatchFile": [
            "from unittest import TestCase",
            "",
            "from .sanitizer import Sanitizer",
            "",
            "",
            "default_sanitizer = Sanitizer()",
            "",
            "",
            "class SanitizerTestCase(TestCase):",
            "    def run_tests(self, entries, *, sanitizer=default_sanitizer, strip=False):",
            "        for before, after in entries:",
            "            with self.subTest(before=before, after=after):",
            "                after = before if after is None else after  # noqa: PLW2901",
            "                result = sanitizer.sanitize(before)",
            "                self.assertEqual(",
            "                    result.strip() if strip else result,",
            "                    after.strip() if strip else after,",
            "                    b\"Cleaning '%s', expected '%s' but got '%s'\"",
            "                    % (",
            "                        before.encode(\"unicode-escape\"),",
            "                        after.encode(\"unicode-escape\"),",
            "                        result.encode(\"unicode-escape\"),",
            "                    ),",
            "                )",
            "",
            "    def test_01_sanitize(self):",
            "        entries = [",
            "            (\"<p>&nbsp;</p>\", \" \"),",
            "            (\"<p>           </p>\", \" \"),",
            "            (",
            "                '<span style=\"font-weight: bold;\">Something</span><p></p>',",
            "                \"<strong>Something</strong>\",",
            "            ),",
            "            (",
            "                \"<p>abc <span>def <em>ghi</em> jkl</span> mno</p>\",",
            "                \"<p>abc def <em>ghi</em> jkl mno</p>\",",
            "            ),",
            "            (",
            "                '<span style=\"font-style: italic;\">Something</span><p></p>',",
            "                \"<em>Something</em>\",",
            "            ),",
            "            ('<h2 style=\"font-weight:bold\">bla</h2>', \"<h2>bla</h2>\"),",
            "            ('<h2 style=\"font-style:italic\">bla</h2>', \"<h2>bla</h2>\"),",
            "            (\"<p>abc<br />def</p>\", \"<p>abc<br>def</p>\"),",
            "            (\"<p><br/><br/><strong></strong>  <br/></p>\", \"\"),",
            "            (\"<p><br/><strong></strong>  <br/> abc</p>\", \"<p> abc</p>\"),",
            "            (\"<li><br>bla</li>\", \"<li>bla</li>\"),",
            "            (",
            "                \"<p><strong>just</strong> <em>testing</em></p>\",",
            "                \"<p><strong>just</strong> <em>testing</em></p>\",",
            "            ),",
            "            (",
            "                \"<p>Hallo<br>Welt<br><br>Hallo<br>Welt</p>\",",
            "                \"<p>Hallo<br>Welt<br>Hallo<br>Welt</p>\",",
            "            ),",
            "            (",
            "                \"<p><strong>Zeile 1</strong><br>Zeile 2<br>Zeile 3</p>\",",
            "                \"<p><strong>Zeile 1</strong><br>Zeile 2<br>Zeile 3</p>\",",
            "            ),",
            "            (",
            "                \"<p><strong>A</strong>, <strong>B</strong>\"",
            "                \" und <strong>C</strong></p>\",",
            "                \"<p><strong>A</strong>, <strong>B</strong>\"",
            "                \" und <strong>C</strong></p>\",",
            "            ),",
            "            (\"<p><form>Zeile 1</form></p>\", \"<p>Zeile 1</p>\"),",
            "            # Suboptimal, should be cleaned further",
            "            (\"<form><p>Zeile 2</p></form>\", \"<p> Zeile 2 </p>\"),",
            "            (\"1<p> </p>2\", \"1 2\"),",
            "            (\"1<p></p>2\", \"12\"),",
            "            (\"<p>son<strong>der</strong>bar</p>\", \"<p>son<strong>der</strong>bar</p>\"),",
            "            # Empty a tags are allowed...",
            "            (\"<a>  </a>\", \"<a> </a>\"),",
            "            # ...but breaks without any additional content are still removed",
            "            (\"<a><br />  </a>\", \"<a> </a>\"),",
            "            (\"<p>blab<br hello='world' />blub<p>\", \"<p>blab<br>blub</p>\"),",
            "        ]",
            "",
            "        self.run_tests(entries)",
            "",
            "    def test_02_a_tag(self):",
            "        entries = (",
            "            ('<a href=\"/foo\">foo</a>', None),",
            "            (",
            "                '<a href=\"/foo\" name=\"bar\" target=\"some\" title=\"baz\"'",
            "                ' cookies=\"yesplease\">foo</a>',",
            "                '<a href=\"/foo\" name=\"bar\" target=\"some\" title=\"baz\">foo</a>',",
            "            ),",
            "            ('<a href=\"http://somewhere.else\">foo</a>', None),",
            "            ('<a href=\"https://somewhere.else\">foo</a>', None),",
            "            ('<a href=\"javascript:alert()\">foo</a>', '<a href=\"#\">foo</a>'),",
            "            ('<a href=\"javascript%3Aalert()\">foo</a>', '<a href=\"#\">foo</a>'),",
            "            ('<a href=\"mailto:foo@bar.com\">foo</a>', None),",
            "            ('<a href=\"tel:1-234-567-890\">foo</a>', None),",
            "        )",
            "",
            "        self.run_tests(entries)",
            "",
            "    def test_03_merge(self):",
            "        entries = (",
            "            (\"<h2>foo</h2><h2>bar</h2>\", \"<h2>foobar</h2>\"),",
            "            (\"<h2>foo  </h2>   <h2>   bar</h2>\", \"<h2>foo bar</h2> \"),",
            "        )",
            "",
            "        self.run_tests(entries)",
            "",
            "    def test_no_space_between_same_tags(self):",
            "        entries = [",
            "            (\"<strong>Hel</strong><strong>lo</strong>\", \"<strong>Hello</strong>\")",
            "        ]",
            "        self.run_tests(entries)",
            "",
            "    def test_04_p_in_li(self):",
            "        entries = (",
            "            (\"<li><p>foo</p></li>\", \"<li> foo </li>\"),",
            "            (\"<li>&nbsp;<p>foo</p> &#160; </li>\", \"<li> foo </li>\"),",
            "            (",
            "                \"<li>foo<p>bar<strong>xx</strong>rab</p><strong>baz</strong>\"",
            "                \"a<p>b</p>c</li>\",",
            "                \"<li>foo bar <strong>xx</strong>rab<strong>baz</strong>a b\" \" c</li>\",",
            "            ),",
            "        )",
            "",
            "        self.run_tests(entries)",
            "",
            "    def test_05_p_in_p(self):",
            "        entries = (",
            "            (\"<p><p>foo</p></p>\", \"<p>foo</p>\"),",
            "            (\"<p><p><p>&nbsp;</p> </p><p><br /></p></p>\", \" \"),",
            "            # This is actually correct as the second <p> implicitely",
            "            # closes the first paragraph, and the trailing </p> is",
            "            # deleted because it has no matching opening <p>",
            "            (\"<p>foo<p>bar</p>baz</p>\", \"<p>foo</p><p>bar</p>baz\"),",
            "            (\"<p>bla <p>blub</p> blaaa</p>\", \"<p>bla </p><p>blub</p> blaaa\"),",
            "            (",
            "                \"<p>text1 <p>text2</p> tail2 <p>text3</p> tail3 </p>tail1\",",
            "                \"<p>text1 </p><p>text2</p> tail2 <p>text3</p> tail3 tail1\",",
            "            ),",
            "        )",
            "",
            "        self.run_tests(entries)",
            "",
            "    def test_06_allowlist(self):",
            "        entries = (",
            "            ('<script src=\"http://abc\">foo</script>', \"\"),",
            "            ('<script type=\"text/javascript\">foo</script>', \"\"),",
            "        )",
            "",
            "        self.run_tests(entries)",
            "",
            "    def test_07_configuration(self):",
            "        sanitizer = Sanitizer(",
            "            {\"tags\": [\"h1\", \"h2\"], \"empty\": (), \"separate\": (), \"attributes\": {}}",
            "        )",
            "",
            "        entries = (",
            "            (\"<h1>foo</h1>\", None),",
            "            (\"<h1>foo</h1><h2>bar</h2><h3>baz</h3>\", \"<h1>foo</h1><h2>bar</h2>baz\"),",
            "        )",
            "",
            "        self.run_tests(entries, sanitizer=sanitizer)",
            "",
            "    def test_08_li_with_marker(self):",
            "        entries = (",
            "            (\"<li> - foo</li>\", \"<li>foo</li>\"),",
            "            (\"<li>* foo</li>\", \"<li>foo</li>\"),",
            "            (\"<li>*foo</li>\", \"<li>*foo</li>\"),",
            "        )",
            "",
            "        self.run_tests(entries)",
            "",
            "    def test_09_empty_p_text_in_li(self):",
            "        # this results in an empty p.text",
            "        entries = (",
            "            (\"<li><p><strong>foo</strong></p></li>\", \"<li><strong>foo</strong></li>\"),",
            "            (\"<li><p><em>foo</em></p></li>\", \"<li><em>foo</em></li>\"),",
            "        )",
            "",
            "        self.run_tests(entries)",
            "",
            "    def test_10_broken_html(self):",
            "        entries = (",
            "            (\"<p><strong>bla\", \"<p><strong>bla</strong></p>\"),",
            "            (\"<p><strong>bla<>/dsiad<p/\", \"<p><strong>bla&lt;&gt;/dsiad</strong></p>\"),",
            "        )",
            "",
            "        self.run_tests(entries)",
            "",
            "    def test_11_nofollow(self):",
            "        sanitizer = Sanitizer({\"add_nofollow\": True})",
            "",
            "        entries = (",
            "            (",
            "                '<p><a href=\"http://example.com/\">example.com</a></p>',",
            "                '<p><a href=\"http://example.com/\"'",
            "                ' rel=\"nofollow\">example.com</a></p>',",
            "            ),",
            "        )",
            "",
            "        self.run_tests(entries, sanitizer=sanitizer)",
            "",
            "    def test_12_replacements(self):",
            "        entries = (",
            "            (\"<b>Bla</b>\", \"<strong>Bla</strong>\"),",
            "            (\"<i>Bla</i>\", \"<em>Bla</em>\"),",
            "        )",
            "",
            "        self.run_tests(entries)",
            "",
            "    def test_13_autolink(self):",
            "        self.run_tests([(\"<p>https://github.com/</p>\", \"<p>https://github.com/</p>\")])",
            "",
            "        sanitizer = Sanitizer({\"autolink\": True})",
            "",
            "        self.run_tests(",
            "            [",
            "                (",
            "                    \"<p>https://github.com/</p>\",",
            "                    '<p><a href=\"https://github.com/\">https://github.com/</a></p>',",
            "                ),",
            "                (",
            "                    # localhost is not autolinked by default by lxml",
            "                    \"<p>https://localhost/</p>\",",
            "                    \"<p>https://localhost/</p>\",",
            "                ),",
            "            ],",
            "            sanitizer=sanitizer,",
            "        )",
            "",
            "        sanitizer = Sanitizer({\"autolink\": True, \"add_nofollow\": True})",
            "",
            "        self.run_tests(",
            "            [",
            "                (",
            "                    \"<p>https://github.com/</p>\",",
            "                    '<p><a href=\"https://github.com/\"'",
            "                    ' rel=\"nofollow\">https://github.com/</a></p>',",
            "                )",
            "            ],",
            "            sanitizer=sanitizer,",
            "        )",
            "",
            "        sanitizer = Sanitizer({\"autolink\": {\"avoid_hosts\": []}})",
            "",
            "        self.run_tests(",
            "            [",
            "                (",
            "                    \"<p>https://github.com/</p>\",",
            "                    '<p><a href=\"https://github.com/\">https://github.com/</a></p>',",
            "                ),",
            "                (",
            "                    \"<p>https://localhost/</p>\",",
            "                    '<p><a href=\"https://localhost/\">https://localhost/</a></p>',",
            "                ),",
            "            ],",
            "            sanitizer=sanitizer,",
            "        )",
            "",
            "    def test_14_classes(self):",
            "        \"\"\"Class attributes should not be treated specially\"\"\"",
            "        sanitizer = Sanitizer(",
            "            {",
            "                \"tags\": {\"h1\", \"h2\", \"p\", \"a\", \"span\"},",
            "                \"attributes\": {",
            "                    \"a\": (\"href\", \"name\", \"target\", \"title\", \"id\", \"rel\"),",
            "                    \"h1\": (\"class\",),",
            "                    \"p\": (\"class\",),",
            "                    \"span\": (\"class\",),",
            "                },",
            "                \"empty\": set(),",
            "                \"separate\": {\"a\", \"p\"},",
            "            }",
            "        )",
            "",
            "        self.run_tests(",
            "            [",
            "                ('<p class=\"centered\">Test</p>', '<p class=\"centered\">Test</p>'),",
            "                (",
            "                    '<p class=\"centered\">Test <span class=\"bla\">span</span></p>',",
            "                    '<p class=\"centered\">Test <span class=\"bla\">span</span></p>',",
            "                ),",
            "                (",
            "                    '<p class=\"centered\">Test <span class=\"bla\">span</span>'",
            "                    '<span class=\"blub\">span</span></p>',",
            "                    '<p class=\"centered\">Test <span class=\"bla\">spanspan</span></p>',",
            "                ),",
            "                ('<h1 class=\"centered\">Test</h1>', '<h1 class=\"centered\">Test</h1>'),",
            "                ('<h2 class=\"centered\">Test</h2>', \"<h2>Test</h2>\"),",
            "            ],",
            "            sanitizer=sanitizer,",
            "        )",
            "",
            "    def test_15_classes(self):",
            "        \"\"\"Class attributes may disable merging\"\"\"",
            "        sanitizer = Sanitizer(",
            "            {",
            "                \"tags\": {\"h1\", \"h2\", \"p\", \"a\", \"span\"},",
            "                \"attributes\": {",
            "                    \"a\": (\"href\", \"name\", \"target\", \"title\", \"id\", \"rel\"),",
            "                    \"h1\": (\"class\",),",
            "                    \"p\": (\"class\",),",
            "                    \"span\": (\"class\",),",
            "                },",
            "                \"empty\": set(),",
            "                \"separate\": {\"a\", \"p\"},",
            "                \"is_mergeable\": lambda e1, e2: e1.get(\"class\") == e2.get(\"class\"),",
            "            }",
            "        )",
            "",
            "        self.run_tests(",
            "            [",
            "                (",
            "                    '<p class=\"centered\">Test <span class=\"bla\">span</span>'",
            "                    '<span class=\"blub\">span</span></p>',",
            "                    '<p class=\"centered\">Test <span class=\"bla\">span</span>'",
            "                    '<span class=\"blub\">span</span></p>',",
            "                ),",
            "                (",
            "                    '<p class=\"centered\">Test <span class=\"bla\">span</span>'",
            "                    '<span class=\"bla\">span</span></p>',",
            "                    '<p class=\"centered\">Test <span class=\"bla\">spanspan</span></p>',",
            "                ),",
            "            ],",
            "            sanitizer=sanitizer,",
            "        )",
            "",
            "    def test_16_emoji(self):",
            "        self.run_tests([(\"<p>\ud83d\ude02</p>\", \"<p>\ud83d\ude02</p>\"), (\"<p>\ud83d\udc95</p>\", \"<p>\ud83d\udc95</p>\")])",
            "",
            "    def test_target_blank(self):",
            "        self.run_tests(",
            "            [",
            "                (",
            "                    '<a href=\"#\" target=\"_blank\">test</a>',",
            "                    '<a href=\"#\" target=\"_blank\" rel=\"noopener\">test</a>',",
            "                )",
            "            ]",
            "        )",
            "",
            "    def test_remove_everything(self):",
            "        sanitizer = Sanitizer(",
            "            {\"tags\": {\"__never\"}, \"attributes\": {}, \"empty\": set(), \"separate\": set()}",
            "        )",
            "",
            "        self.run_tests(",
            "            [",
            "                (",
            "                    '<span style=\"color:#000000;font-weight:bold\">11:44:14</span>',",
            "                    \"11:44:14\",",
            "                )",
            "            ],",
            "            sanitizer=sanitizer,",
            "        )",
            "",
            "    def test_more_merging(self):",
            "        self.run_tests(",
            "            [",
            "                (\"<p><hr></p>\", \"<hr>\"),",
            "                (\"<hr><hr><hr>\", \"<hr>\"),",
            "                (",
            "                    '<a name=\"a\"></a><a name=\"b\"></a>',",
            "                    '<a name=\"a\"></a><a name=\"b\"></a>',",
            "                ),",
            "            ]",
            "        )",
            "",
            "    def test_keep_consecutive_br_tags(self):",
            "        sanitizer = Sanitizer({\"whitespace\": set(), \"separate\": {\"br\"}})",
            "        self.run_tests(",
            "            [",
            "                (\"<p>Hello<br><br>World</p>\", \"<p>Hello<br><br>World</p>\"),",
            "                (\"<p>Hello<br><br></p>\", \"<p>Hello<br><br></p>\"),",
            "                (\"<p><br><br>World</p>\", \"<p><br><br>World</p>\"),",
            "                (\"<p><br><br></p>\", \"<p><br><br></p>\"),",
            "                (\"<p><br></p><hr><br></p>\", \"<p><br></p><hr><br>\"),",
            "            ],",
            "            sanitizer=sanitizer,",
            "        )",
            "",
            "    def test_custom_allowed_attribute(self):",
            "        sanitizer = Sanitizer({\"attributes\": {\"a\": (\"href\", \"custom\")}})",
            "        self.run_tests(",
            "            [",
            "                (",
            "                    '<a href=\"http://example.com\" custom=\"1\" abc=\"2\">Test</a>',",
            "                    '<a href=\"http://example.com\" custom=\"1\">Test</a>',",
            "                )",
            "            ],",
            "            sanitizer=sanitizer,",
            "        )",
            "",
            "    def test_blob(self):",
            "        source = \"\"\"\\",
            "<p class=\"western\" style=\"margin-left: 0.39in; text-indent: -0.39in; margin-top: 0.25in; margin-bottom: 0in; line-height: 0.19in\" lang=\"de-DE\" align=\"justify\">",
            "<font style=\"font-size: 12pt\" size=\"3\"><b>1.2.\tDefinition des",
            "Spesenbegriffs</b></font></p>",
            "<p class=\"western\" style=\"margin-left: 0.39in; margin-top: 0.13in; margin-bottom: 0in; line-height: 0.19in\" lang=\"de-DE\" align=\"justify\">",
            "<font style=\"font-size: 12pt\" size=\"3\">Als Spesen im Sinne dieses",
            "Reglements gelten die Auslagen, die einem Mitarbeitenden im Interesse",
            "des Arbeitgebers angefallen sind. S\u00e4mtliche Mitarbeitende sind",
            "verpflichtet, ihre Spesen im Rahmen dieses Reglements m\u00f6glichst tief",
            "zu halten. Aufwendungen, die f\u00fcr die Arbeitsausf\u00fchrung nicht",
            "notwendig waren, werden von der Firma nicht \u00fcbernommen, sondern sind",
            "von den Mitarbeitenden selbst zu tragen.</font></p>",
            "<p class=\"western\" style=\"margin-left: 0.39in; margin-top: 0.13in; margin-bottom: 0in; line-height: 0.19in\" lang=\"de-DE\" align=\"justify\">",
            "<font style=\"font-size: 12pt\" size=\"3\">Im Wesentlichen werden den",
            "Mitarbeitenden folgende gesch\u00e4ftlich bedingten Auslagen ersetzt:</font></p>",
            "<ul><li><p class=\"western\" style=\"margin-top: 0.13in; margin-bottom: 0in; line-height: 0.19in\" lang=\"de-DE\" align=\"justify\"> <font style=\"font-size: 12pt\" size=\"3\">-\tFahrtkosten\t\t\t\t\t(nachfolgend 2.)</font></p> </li><li><p class=\"western\" style=\"margin-bottom: 0in; line-height: 0.19in\" lang=\"de-DE\" align=\"justify\"> <font style=\"font-size: 12pt\" size=\"3\">-\tVerpflegungskosten\t\t\t(nachfolgend 3.)</font></p> </li><li><p class=\"western\" style=\"margin-bottom: 0in; line-height: 0.19in\" lang=\"de-DE\" align=\"justify\"> <font style=\"font-size: 12pt\" size=\"3\">-\t\u00dcbernachtungskosten\t\t\t(nachfolgend 4.)</font></p> </li><li><p class=\"western\" style=\"margin-bottom: 0in; line-height: 0.19in\" lang=\"de-DE\" align=\"justify\"> <font style=\"font-size: 12pt\" size=\"3\">-\t\u00dcbrige Kosten\t\t\t\t(nachfolgend 5.)</font></p> </li></ul>\"\"\"",
            "",
            "        result = \"\"\"\\",
            "<p> <strong>1.2. Definition des Spesenbegriffs</strong></p> <p> Als Spesen im Sinne dieses Reglements gelten die Auslagen, die einem Mitarbeitenden im Interesse des Arbeitgebers angefallen sind. S\u00e4mtliche Mitarbeitende sind verpflichtet, ihre Spesen im Rahmen dieses Reglements m\u00f6glichst tief zu halten. Aufwendungen, die f\u00fcr die Arbeitsausf\u00fchrung nicht notwendig waren, werden von der Firma nicht \u00fcbernommen, sondern sind von den Mitarbeitenden selbst zu tragen.</p> <p> Im Wesentlichen werden den Mitarbeitenden folgende gesch\u00e4ftlich bedingten Auslagen ersetzt:</p> <ul><li> - Fahrtkosten (nachfolgend 2.) </li><li> - Verpflegungskosten (nachfolgend 3.) </li><li> - \u00dcbernachtungskosten (nachfolgend 4.) </li><li> - \u00dcbrige Kosten (nachfolgend 5.) </li></ul>\"\"\"",
            "",
            "        # XXX An exact match isn't really required. Using Django's",
            "        # assertHTMLEqual would be great but we'd have to depend on Django in",
            "        # the test suite for this (not a big problem really, because then we",
            "        # could also test html_sanitizer.django but I didn't yet *have* to do",
            "        # this)",
            "        self.run_tests([(source, result)])",
            "",
            "    def test_keep_typographic_whitespace(self):",
            "        sanitizer = Sanitizer({\"keep_typographic_whitespace\": True})",
            "",
            "        # Note some unicode normalization of typographic whitespace",
            "        self.run_tests(",
            "            [",
            "                (",
            "                    \"\\u200a\\u2001\\u202f\\u2004\\xa0\\u2007\\u2002\\u2000\"",
            "                    \"\\u2003\\u2009\\u205f\\u2005\\u2006\\u2008\\u3000\",",
            "                    \"\\u200a\\u2003\\u202f\\u2004\\xa0\\u2007\\u2002\\u2002\"",
            "                    \"\\u2003\\u2009\\u205f\\u2005\\u2006\\u2008\\u3000\",",
            "                ),",
            "                (",
            "                    \"Hello This is a paragraph. \\n\"",
            "                    \"\\tHello. This is a tabled line.\"",
            "                    \"Hello.This is beginning of the end.\\r\",",
            "                    \"Hello This is a paragraph. \\n\"",
            "                    \"\\tHello. This is a tabled line.\"",
            "                    \"Hello.This is beginning of the end.\\r\",",
            "                ),",
            "                (",
            "                    \"something    <br>somethingelse    \",",
            "                    \"something    <br>somethingelse    \",",
            "                ),",
            "            ],",
            "            sanitizer=sanitizer,",
            "        )",
            "",
            "    def test_strip_typographic_whitespace(self):",
            "        sanitizer = Sanitizer({\"keep_typographic_whitespace\": False})",
            "",
            "        self.run_tests(",
            "            [",
            "                (",
            "                    \"\\u200a\\u2001\\u202f\\u2004\\xa0\\u2007\\u2002\\u2000\"",
            "                    \"\\u2003\\u2009\\u205f\\u2005\\u2006\\u2008\\u3000\",",
            "                    \" \",",
            "                )",
            "            ],",
            "            sanitizer=sanitizer,",
            "        )",
            "",
            "    def test_anchor_names(self):",
            "        self.run_tests(",
            "            [",
            "                (",
            "                    '<a name=\"test\" id=\"test\"></a>',",
            "                    '<a name=\"test\"></a>',",
            "                ),",
            "                (",
            "                    '<a name=\"test\"></a>',",
            "                    '<a name=\"test\"></a>',",
            "                ),",
            "                (",
            "                    '<a id=\"test\"></a>',",
            "                    '<a name=\"test\"></a>',",
            "                ),",
            "            ],",
            "        )",
            "",
            "    def test_style_tag(self):",
            "        # don't allow style tag (default)",
            "        self.run_tests(",
            "            [(\"foo<style>*{color: red}</style>bar\", \"foobar\")],",
            "            sanitizer=Sanitizer(",
            "                {",
            "                    \"tags\": {\"impossible tag\"},",
            "                    \"attributes\": {},",
            "                    \"empty\": set(),",
            "                    \"separate\": set(),",
            "                }",
            "            ),",
            "        )",
            "",
            "        # allow style tag but no style attribute",
            "        self.run_tests(",
            "            [",
            "                (",
            "                    \"foo<style>*{color: red}</style>bar\",",
            "                    \"foo<style>*{color: red}</style>bar\",",
            "                ),",
            "                ('<h2 style=\"font-weight:bold\">bla</h2>', \"<h2>bla</h2>\"),",
            "            ],",
            "            sanitizer=Sanitizer(",
            "                {",
            "                    \"tags\": {\"h2\", \"style\"},",
            "                    \"attributes\": {},",
            "                    \"empty\": set(),",
            "                    \"separate\": set(),",
            "                }",
            "            ),",
            "        )",
            "",
            "        # allow style tag and style attribute",
            "        self.run_tests(",
            "            [",
            "                (",
            "                    \"foo<style>*{color: red}</style>bar\",",
            "                    \"foo<style>*{color: red}</style>bar\",",
            "                ),",
            "                (",
            "                    '<h2 style=\"font-weight:bold\">bla</h2>',",
            "                    '<h2 style=\"font-weight:bold\">bla</h2>',",
            "                ),",
            "            ],",
            "            sanitizer=Sanitizer(",
            "                {",
            "                    \"tags\": {\"h2\", \"style\"},",
            "                    \"attributes\": {\"h2\": {\"style\"}},",
            "                    \"empty\": set(),",
            "                    \"separate\": set(),",
            "                }",
            "            ),",
            "        )",
            "",
            "    def test_billion_laughs(self):",
            "        before = \"\"\"\\",
            "<?xml version=\"1.0\"?>",
            "<!DOCTYPE lolz [",
            " <!ENTITY lol \"lol\">",
            " <!ELEMENT lolz (#PCDATA)>",
            " <!ENTITY lol1 \"&lol;&lol;&lol;&lol;&lol;&lol;&lol;&lol;&lol;&lol;\">",
            " <!ENTITY lol2 \"&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;\">",
            " <!ENTITY lol3 \"&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;\">",
            " <!ENTITY lol4 \"&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;\">",
            " <!ENTITY lol5 \"&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;\">",
            " <!ENTITY lol6 \"&lol5;&lol5;&lol5;&lol5;&lol5;&lol5;&lol5;&lol5;&lol5;&lol5;\">",
            " <!ENTITY lol7 \"&lol6;&lol6;&lol6;&lol6;&lol6;&lol6;&lol6;&lol6;&lol6;&lol6;\">",
            " <!ENTITY lol8 \"&lol7;&lol7;&lol7;&lol7;&lol7;&lol7;&lol7;&lol7;&lol7;&lol7;\">",
            " <!ENTITY lol9 \"&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;\">",
            "]>",
            "<lolz>&lol9;</lolz>",
            "\"\"\"",
            "",
            "        external_entities = \"\"\"\\",
            " <?xml version=\"1.0\"?>",
            "  <!DOCTYPE foo [",
            "   <!ELEMENT foo ANY >",
            "   <!ENTITY xxe SYSTEM \"file:///dev/random\" >]><foo>&xxe;</foo>",
            "\"\"\"",
            "",
            "        self.run_tests(",
            "            [",
            "                (before, \"]&gt; &amp;lol9;\"),",
            "                (external_entities, \"]&gt;&amp;xxe;\"),",
            "            ],",
            "            strip=True,",
            "        )",
            "",
            "    def test_data_attributes(self):",
            "        sanitizer = Sanitizer(",
            "            {",
            "                \"tags\": [\"span\"],",
            "                \"empty\": (),",
            "                \"separate\": (),",
            "                \"attributes\": {\"span\": {\"data-title\"}},",
            "            }",
            "        )",
            "",
            "        entries = (",
            "            (",
            "                '<span data-title=\"Test\">Content</span>',",
            "                '<span data-title=\"Test\">Content</span>',",
            "            ),",
            "            (",
            "                '<span data-title=\"Test\" data-other=\"Stuff\">Content</span>',",
            "                '<span data-title=\"Test\">Content</span>',",
            "            ),",
            "        )",
            "",
            "        self.run_tests(entries, sanitizer=sanitizer)",
            "",
            "    def test_entities(self):",
            "        self.run_tests(",
            "            [",
            "                (\"&lsquo;\", \"\\u2018\"),",
            "            ],",
            "        )",
            "",
            "    def test_invalid_attributes(self):",
            "        with self.assertRaisesRegex(TypeError, \"Expected a set but got\"):",
            "            Sanitizer({\"attributes\": {\"p\": (\"class\")}})",
            "",
            "        with self.assertRaisesRegex(TypeError, \"Expected a set but got\"):",
            "            Sanitizer({\"tags\": \"blub\"})",
            "",
            "        with self.assertRaisesRegex(TypeError, 'Tags in \"empty\", but not allowed:'):",
            "            Sanitizer({\"tags\": {\"blub\"}})",
            "",
            "    def test_img_tag(self):",
            "        sanitizer = Sanitizer(",
            "            {",
            "                \"tags\": {\"p\", \"img\"},",
            "                \"empty\": {\"img\"},",
            "                \"separate\": (),",
            "                \"attributes\": {\"img\": {\"alt\", \"src\"}},",
            "            }",
            "        )",
            "",
            "        entries = (",
            "            (",
            "                '<p><img src=\"hello.jpg\" alt=\"hello\" class=\"hello\"></p>',",
            "                '<p><img src=\"hello.jpg\" alt=\"hello\"></p>',",
            "            ),",
            "        )",
            "",
            "        self.run_tests(entries, sanitizer=sanitizer)",
            "",
            "    def test_code_whitespace(self):",
            "        sanitizer = Sanitizer(",
            "            {",
            "                \"tags\": {\"code\"},",
            "                \"empty\": set(),",
            "                \"separate\": set(),",
            "                \"attributes\": {},",
            "                \"keep_typographic_whitespace\": True,",
            "            }",
            "        )",
            "",
            "        html = \"\"\"\\",
            "<code>",
            "git status",
            "git add",
            "git commit",
            "</code>",
            "\"\"\"",
            "",
            "        self.run_tests([(html, html)], sanitizer=sanitizer)",
            "",
            "    def test_br_attribute_sanitization(self):",
            "        \"\"\"Attributes which aren't allowlisted are removed from br tags\"\"\"",
            "        self.run_tests(",
            "            [",
            "                (\"<p><br hello=\\\"alert('world');\\\"/><br></p>\", \"\"),",
            "                ('<p hello=\"world\"></p>', \"\"),",
            "                (\"<br hello=\\\"alert('world');\\\"/><br>\", \"<br>\"),",
            "            ]",
            "        )",
            "",
            "    def test_normalize_early(self):",
            "        self.run_tests(",
            "            [",
            "                (",
            "                    \"\\uff1cimg src=x onerror=\\uff02alert(window.location)\\uff02\\uff1e\",",
            "                    \"\",",
            "                ),",
            "            ]",
            "        )"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1"
        ],
        "dele_reviseLocation": {},
        "addLocation": [
            "html_sanitizer.tests.SanitizerTestCase.self",
            "pypdf.generic._data_structures",
            "html_sanitizer.tests.SanitizerTestCase.run_tests.entries"
        ]
    }
}