{
    "rdiffweb/controller/dispatch.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 30,
                "afterPatchRowNumber": 30,
                "PatchRowcode": " from rdiffweb.core.rdw_helpers import unquote_url"
            },
            "1": {
                "beforePatchRowNumber": 31,
                "afterPatchRowNumber": 31,
                "PatchRowcode": " "
            },
            "2": {
                "beforePatchRowNumber": 32,
                "afterPatchRowNumber": 32,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": 33,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-def empty():"
            },
            "4": {
                "beforePatchRowNumber": 34,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    @cherrypy.expose"
            },
            "5": {
                "beforePatchRowNumber": 35,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    def handler():"
            },
            "6": {
                "beforePatchRowNumber": 36,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        return None"
            },
            "7": {
                "beforePatchRowNumber": 37,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "8": {
                "beforePatchRowNumber": 38,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    return handler"
            },
            "9": {
                "beforePatchRowNumber": 39,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "10": {
                "beforePatchRowNumber": 40,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "11": {
                "beforePatchRowNumber": 41,
                "afterPatchRowNumber": 33,
                "PatchRowcode": " def poppath(*args, **kwargs):"
            },
            "12": {
                "beforePatchRowNumber": 42,
                "afterPatchRowNumber": 34,
                "PatchRowcode": "     \"\"\""
            },
            "13": {
                "beforePatchRowNumber": 43,
                "afterPatchRowNumber": 35,
                "PatchRowcode": "     A decorator for _cp_dispatch"
            },
            "14": {
                "beforePatchRowNumber": 122,
                "afterPatchRowNumber": 114,
                "PatchRowcode": "     @cherrypy.expose"
            },
            "15": {
                "beforePatchRowNumber": 123,
                "afterPatchRowNumber": 115,
                "PatchRowcode": "     @cherrypy.tools.auth_form(on=False)"
            },
            "16": {
                "beforePatchRowNumber": 124,
                "afterPatchRowNumber": 116,
                "PatchRowcode": "     @cherrypy.tools.sessions(on=False)"
            },
            "17": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 117,
                "PatchRowcode": "+    @cherrypy.tools.secure_headers(on=False)"
            },
            "18": {
                "beforePatchRowNumber": 125,
                "afterPatchRowNumber": 118,
                "PatchRowcode": "     def handler(*args, **kwargs):"
            },
            "19": {
                "beforePatchRowNumber": 126,
                "afterPatchRowNumber": 119,
                "PatchRowcode": "         if cherrypy.request.method not in ('GET', 'HEAD'):"
            },
            "20": {
                "beforePatchRowNumber": 127,
                "afterPatchRowNumber": 120,
                "PatchRowcode": "             return None"
            }
        },
        "frontPatchFile": [
            "# -*- coding: utf-8 -*-",
            "# rdiffweb, A web interface to rdiff-backup repositories",
            "# Copyright (C) 2012-2021 rdiffweb contributors",
            "#",
            "# This program is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This program is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with this program.  If not, see <http://www.gnu.org/licenses/>.",
            "",
            "\"\"\"",
            "Default page handler",
            "",
            "@author: Patrik Dufresne <patrik@ikus-soft.com>",
            "\"\"\"",
            "",
            "",
            "import os",
            "",
            "import cherrypy",
            "from cherrypy.lib.static import mimetypes, serve_file",
            "",
            "from rdiffweb.core.rdw_helpers import unquote_url",
            "",
            "",
            "def empty():",
            "    @cherrypy.expose",
            "    def handler():",
            "        return None",
            "",
            "    return handler",
            "",
            "",
            "def poppath(*args, **kwargs):",
            "    \"\"\"",
            "    A decorator for _cp_dispatch",
            "    (cherrypy.dispatch.Dispatcher.dispatch_method_name).",
            "",
            "    Used to merge the segment of URI into a single parameter denoting the",
            "    repository path.",
            "    \"\"\"",
            "",
            "    # Since keyword arg comes after *args, we have to process it ourselves",
            "    # for lower versions of python.",
            "",
            "    handler = None",
            "    handler_call = False",
            "    for k, v in kwargs.items():",
            "        if k == 'handler':",
            "            handler = v",
            "        else:",
            "            raise TypeError(\"cherrypy.popargs() got an unexpected keyword argument '{0}'\".format(k))",
            "",
            "    import inspect",
            "",
            "    if handler is not None and (hasattr(handler, '__call__') or inspect.isclass(handler)):",
            "        handler_call = True",
            "",
            "    def decorated(cls_or_self=None, vpath=None):",
            "        if inspect.isclass(cls_or_self):",
            "            # cherrypy.poppath is a class decorator",
            "            cls = cls_or_self",
            "            setattr(cls, cherrypy.dispatch.Dispatcher.dispatch_method_name, decorated)",
            "            return cls",
            "",
            "        # We're in the actual function",
            "        self = cls_or_self",
            "        parms = {}",
            "        for arg in args:",
            "            if not vpath:",
            "                break",
            "            parms[arg] = unquote_url(vpath.pop(0))",
            "",
            "        # Build repo path.",
            "        path = []",
            "        while len(vpath) > 0:",
            "            path.append(unquote_url(vpath.pop(0)))",
            "        parms['path'] = b\"/\".join(path)",
            "",
            "        if handler is not None:",
            "            if handler_call:",
            "                return handler(**parms)",
            "            else:",
            "                cherrypy.request.params.update(parms)  # @UndefinedVariable",
            "                return handler",
            "",
            "        cherrypy.request.params.update(parms)  # @UndefinedVariable",
            "",
            "        # If we are the ultimate handler, then to prevent our _cp_dispatch",
            "        # from being called again, we will resolve remaining elements through",
            "        # getattr() directly.",
            "        if vpath:",
            "            return getattr(self, vpath.pop(0), None)",
            "        else:",
            "            return self",
            "",
            "    return decorated",
            "",
            "",
            "def static(path):",
            "    \"\"\"",
            "    Create a page handler to serve static files. Disable authentication.",
            "    \"\"\"",
            "    assert isinstance(path, str)",
            "    assert os.path.exists(path), \"%r doesn't exists\" % path",
            "    content_type = None",
            "    if os.path.isfile(path):",
            "        # Set content-type based on filename extension",
            "        ext = \"\"",
            "        i = path.rfind('.')",
            "        if i != -1:",
            "            ext = path[i:].lower()",
            "        content_type = mimetypes.types_map.get(ext, None)  # @UndefinedVariable",
            "",
            "    @cherrypy.expose",
            "    @cherrypy.tools.auth_form(on=False)",
            "    @cherrypy.tools.sessions(on=False)",
            "    def handler(*args, **kwargs):",
            "        if cherrypy.request.method not in ('GET', 'HEAD'):",
            "            return None",
            "        filename = os.path.join(path, *args)",
            "        assert filename.startswith(path)",
            "        if not os.path.isfile(filename):",
            "            return None",
            "        return serve_file(filename, content_type)",
            "",
            "    return handler"
        ],
        "afterPatchFile": [
            "# -*- coding: utf-8 -*-",
            "# rdiffweb, A web interface to rdiff-backup repositories",
            "# Copyright (C) 2012-2021 rdiffweb contributors",
            "#",
            "# This program is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This program is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with this program.  If not, see <http://www.gnu.org/licenses/>.",
            "",
            "\"\"\"",
            "Default page handler",
            "",
            "@author: Patrik Dufresne <patrik@ikus-soft.com>",
            "\"\"\"",
            "",
            "",
            "import os",
            "",
            "import cherrypy",
            "from cherrypy.lib.static import mimetypes, serve_file",
            "",
            "from rdiffweb.core.rdw_helpers import unquote_url",
            "",
            "",
            "def poppath(*args, **kwargs):",
            "    \"\"\"",
            "    A decorator for _cp_dispatch",
            "    (cherrypy.dispatch.Dispatcher.dispatch_method_name).",
            "",
            "    Used to merge the segment of URI into a single parameter denoting the",
            "    repository path.",
            "    \"\"\"",
            "",
            "    # Since keyword arg comes after *args, we have to process it ourselves",
            "    # for lower versions of python.",
            "",
            "    handler = None",
            "    handler_call = False",
            "    for k, v in kwargs.items():",
            "        if k == 'handler':",
            "            handler = v",
            "        else:",
            "            raise TypeError(\"cherrypy.popargs() got an unexpected keyword argument '{0}'\".format(k))",
            "",
            "    import inspect",
            "",
            "    if handler is not None and (hasattr(handler, '__call__') or inspect.isclass(handler)):",
            "        handler_call = True",
            "",
            "    def decorated(cls_or_self=None, vpath=None):",
            "        if inspect.isclass(cls_or_self):",
            "            # cherrypy.poppath is a class decorator",
            "            cls = cls_or_self",
            "            setattr(cls, cherrypy.dispatch.Dispatcher.dispatch_method_name, decorated)",
            "            return cls",
            "",
            "        # We're in the actual function",
            "        self = cls_or_self",
            "        parms = {}",
            "        for arg in args:",
            "            if not vpath:",
            "                break",
            "            parms[arg] = unquote_url(vpath.pop(0))",
            "",
            "        # Build repo path.",
            "        path = []",
            "        while len(vpath) > 0:",
            "            path.append(unquote_url(vpath.pop(0)))",
            "        parms['path'] = b\"/\".join(path)",
            "",
            "        if handler is not None:",
            "            if handler_call:",
            "                return handler(**parms)",
            "            else:",
            "                cherrypy.request.params.update(parms)  # @UndefinedVariable",
            "                return handler",
            "",
            "        cherrypy.request.params.update(parms)  # @UndefinedVariable",
            "",
            "        # If we are the ultimate handler, then to prevent our _cp_dispatch",
            "        # from being called again, we will resolve remaining elements through",
            "        # getattr() directly.",
            "        if vpath:",
            "            return getattr(self, vpath.pop(0), None)",
            "        else:",
            "            return self",
            "",
            "    return decorated",
            "",
            "",
            "def static(path):",
            "    \"\"\"",
            "    Create a page handler to serve static files. Disable authentication.",
            "    \"\"\"",
            "    assert isinstance(path, str)",
            "    assert os.path.exists(path), \"%r doesn't exists\" % path",
            "    content_type = None",
            "    if os.path.isfile(path):",
            "        # Set content-type based on filename extension",
            "        ext = \"\"",
            "        i = path.rfind('.')",
            "        if i != -1:",
            "            ext = path[i:].lower()",
            "        content_type = mimetypes.types_map.get(ext, None)  # @UndefinedVariable",
            "",
            "    @cherrypy.expose",
            "    @cherrypy.tools.auth_form(on=False)",
            "    @cherrypy.tools.sessions(on=False)",
            "    @cherrypy.tools.secure_headers(on=False)",
            "    def handler(*args, **kwargs):",
            "        if cherrypy.request.method not in ('GET', 'HEAD'):",
            "            return None",
            "        filename = os.path.join(path, *args)",
            "        assert filename.startswith(path)",
            "        if not os.path.isfile(filename):",
            "            return None",
            "        return serve_file(filename, content_type)",
            "",
            "    return handler"
        ],
        "action": [
            "0",
            "0",
            "0",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "33": [
                "empty"
            ],
            "34": [
                "empty"
            ],
            "35": [
                "empty",
                "handler"
            ],
            "36": [
                "empty",
                "handler"
            ],
            "37": [
                "empty"
            ],
            "38": [
                "empty"
            ],
            "39": [],
            "40": []
        },
        "addLocation": []
    },
    "rdiffweb/controller/tests/test_secure_headers.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 115,
                "afterPatchRowNumber": 115,
                "PatchRowcode": "         # Then the request is accepted with 200 OK"
            },
            "1": {
                "beforePatchRowNumber": 116,
                "afterPatchRowNumber": 116,
                "PatchRowcode": "         self.assertStatus(200)"
            },
            "2": {
                "beforePatchRowNumber": 117,
                "afterPatchRowNumber": 117,
                "PatchRowcode": "         self.assertHeaderItemValue('X-Frame-Options', 'DENY')"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 118,
                "PatchRowcode": "+"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 119,
                "PatchRowcode": "+    def test_no_cache(self):"
            },
            "5": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 120,
                "PatchRowcode": "+        # Given a POST request made to rdiffweb"
            },
            "6": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 121,
                "PatchRowcode": "+        # When the request is made without an origin"
            },
            "7": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 122,
                "PatchRowcode": "+        self.getPage('/')"
            },
            "8": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 123,
                "PatchRowcode": "+        # Then the request is accepted with 200 OK"
            },
            "9": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 124,
                "PatchRowcode": "+        self.assertStatus(200)"
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 125,
                "PatchRowcode": "+        self.assertHeaderItemValue('Cache-control', 'no-cache')"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 126,
                "PatchRowcode": "+        self.assertHeaderItemValue('Cache-control', 'no-store')"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 127,
                "PatchRowcode": "+        self.assertHeaderItemValue('Cache-control', 'must-revalidate')"
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 128,
                "PatchRowcode": "+        self.assertHeaderItemValue('Cache-control', 'max-age=0')"
            },
            "14": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 129,
                "PatchRowcode": "+        self.assertHeaderItemValue('Pragma', 'no-cache')"
            },
            "15": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 130,
                "PatchRowcode": "+        self.assertHeaderItemValue('Expires', '0')"
            },
            "16": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 131,
                "PatchRowcode": "+"
            },
            "17": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 132,
                "PatchRowcode": "+    def test_no_cache_with_static(self):"
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 133,
                "PatchRowcode": "+        # Given a POST request made to rdiffweb"
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 134,
                "PatchRowcode": "+        # When the request is made without an origin"
            },
            "20": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 135,
                "PatchRowcode": "+        self.getPage('/static/default.css')"
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 136,
                "PatchRowcode": "+        # Then the request is accepted with 200 OK"
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 137,
                "PatchRowcode": "+        self.assertStatus(200)"
            },
            "23": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 138,
                "PatchRowcode": "+        self.assertNoHeader('Cache-control')"
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 139,
                "PatchRowcode": "+        self.assertNoHeader('Pragma')"
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 140,
                "PatchRowcode": "+        self.assertNoHeader('Expires')"
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 141,
                "PatchRowcode": "+"
            },
            "27": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 142,
                "PatchRowcode": "+    def test_referrer_policy(self):"
            },
            "28": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 143,
                "PatchRowcode": "+        # Given a POST request made to rdiffweb"
            },
            "29": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 144,
                "PatchRowcode": "+        # When the request is made without an origin"
            },
            "30": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 145,
                "PatchRowcode": "+        self.getPage('/')"
            },
            "31": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 146,
                "PatchRowcode": "+        # Then the request is accepted with 200 OK"
            },
            "32": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 147,
                "PatchRowcode": "+        self.assertStatus(200)"
            },
            "33": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 148,
                "PatchRowcode": "+        self.assertHeaderItemValue('Referrer-Policy', 'same-origin')"
            },
            "34": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 149,
                "PatchRowcode": "+"
            },
            "35": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 150,
                "PatchRowcode": "+    def test_nosniff(self):"
            },
            "36": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 151,
                "PatchRowcode": "+        # Given a POST request made to rdiffweb"
            },
            "37": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 152,
                "PatchRowcode": "+        # When the request is made without an origin"
            },
            "38": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 153,
                "PatchRowcode": "+        self.getPage('/')"
            },
            "39": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 154,
                "PatchRowcode": "+        # Then the request is accepted with 200 OK"
            },
            "40": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 155,
                "PatchRowcode": "+        self.assertStatus(200)"
            },
            "41": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 156,
                "PatchRowcode": "+        self.assertHeaderItemValue('X-Content-Type-Options', 'nosniff')"
            },
            "42": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 157,
                "PatchRowcode": "+"
            },
            "43": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 158,
                "PatchRowcode": "+    def test_xss_protection(self):"
            },
            "44": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 159,
                "PatchRowcode": "+        # Given a POST request made to rdiffweb"
            },
            "45": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 160,
                "PatchRowcode": "+        # When the request is made without an origin"
            },
            "46": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 161,
                "PatchRowcode": "+        self.getPage('/')"
            },
            "47": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 162,
                "PatchRowcode": "+        # Then the request is accepted with 200 OK"
            },
            "48": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 163,
                "PatchRowcode": "+        self.assertStatus(200)"
            },
            "49": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 164,
                "PatchRowcode": "+        self.assertHeaderItemValue('X-XSS-Protection', '1; mode=block')"
            },
            "50": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 165,
                "PatchRowcode": "+"
            },
            "51": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 166,
                "PatchRowcode": "+    def test_content_security_policy(self):"
            },
            "52": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 167,
                "PatchRowcode": "+        # Given a POST request made to rdiffweb"
            },
            "53": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 168,
                "PatchRowcode": "+        # When the request is made without an origin"
            },
            "54": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 169,
                "PatchRowcode": "+        self.getPage('/')"
            },
            "55": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 170,
                "PatchRowcode": "+        # Then the request is accepted with 200 OK"
            },
            "56": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 171,
                "PatchRowcode": "+        self.assertStatus(200)"
            },
            "57": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 172,
                "PatchRowcode": "+        self.assertHeaderItemValue("
            },
            "58": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 173,
                "PatchRowcode": "+            'Content-Security-Policy',"
            },
            "59": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 174,
                "PatchRowcode": "+            \"default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'\","
            },
            "60": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 175,
                "PatchRowcode": "+        )"
            },
            "61": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 176,
                "PatchRowcode": "+"
            },
            "62": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 177,
                "PatchRowcode": "+    def test_strict_transport_security(self):"
            },
            "63": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 178,
                "PatchRowcode": "+        # Given a POST request made to rdiffweb"
            },
            "64": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 179,
                "PatchRowcode": "+        # When the request is made without an origin"
            },
            "65": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 180,
                "PatchRowcode": "+        self.getPage('/', headers=[('X-Forwarded-Proto', 'https')])"
            },
            "66": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 181,
                "PatchRowcode": "+        # Then the request is accepted with 200 OK"
            },
            "67": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 182,
                "PatchRowcode": "+        self.assertStatus(200)"
            },
            "68": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 183,
                "PatchRowcode": "+        self.assertHeaderItemValue('Strict-Transport-Security', 'max-age=31536000; includeSubDomains')"
            }
        },
        "frontPatchFile": [
            "# -*- coding: utf-8 -*-",
            "# rdiffweb, A web interface to rdiff-backup repositories",
            "# Copyright (C) 2012-2021 rdiffweb contributors",
            "#",
            "# This program is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This program is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with this program.  If not, see <http://www.gnu.org/licenses/>.",
            "\"\"\"",
            "Created on Oct 20, 2021",
            "",
            "@author: Patrik Dufresne",
            "\"\"\"",
            "from parameterized import parameterized",
            "",
            "import rdiffweb.test",
            "",
            "",
            "class SecureHeadersTest(rdiffweb.test.WebCase):",
            "",
            "    login = True",
            "",
            "    def test_cookie_samesite_lax(self):",
            "        # Given a request made to rdiffweb",
            "        # When receiving the response",
            "        self.getPage('/')",
            "        # Then the header contains Set-Cookie with SameSite=Lax",
            "        cookie = self.assertHeader('Set-Cookie')",
            "        self.assertIn('SameSite=Lax', cookie)",
            "",
            "    def test_cookie_samesite_lax_without_session(self):",
            "        # Given not a client sending no cookie",
            "        self.cookies = None",
            "        # When a query is made to a static path (without session)",
            "        self.getPage('/static/blue.css')",
            "        # Then Set-Cookie is not defined.",
            "        self.assertNoHeader('Set-Cookie')",
            "",
            "    def test_cookie_with_https(self):",
            "        # Given an https request made to rdiffweb",
            "        self.getPage('/', headers=[('X-Forwarded-Proto', 'https')])",
            "        # When receiving the response",
            "        self.assertStatus(200)",
            "        # Then the header contains Set-Cookie with Secure",
            "        cookie = self.assertHeader('Set-Cookie')",
            "        self.assertIn('Secure', cookie)",
            "",
            "    @parameterized.expand(",
            "        [",
            "            ('/invalid', 404),",
            "            ('/browse/invalid', 404),",
            "            ('/login', 301),",
            "            ('/logout', 303),",
            "        ]",
            "    )",
            "    def test_cookie_with_https_http_error(self, url, expected_error_code):",
            "        # Given an https request made to rdiffweb",
            "        self.getPage(url, headers=[('X-Forwarded-Proto', 'https')])",
            "        # When receiving the response",
            "        self.assertStatus(expected_error_code)",
            "        # Then the header contains Set-Cookie with Secure",
            "        cookie = self.assertHeader('Set-Cookie')",
            "        self.assertIn('Secure', cookie)",
            "",
            "    def test_cookie_with_http(self):",
            "        # Given an https request made to rdiffweb",
            "        self.getPage('/')",
            "        # When receiving the response",
            "        # Then the header contains Set-Cookie with Secure",
            "        cookie = self.assertHeader('Set-Cookie')",
            "        self.assertNotIn('Secure', cookie)",
            "",
            "    def test_get_with_wrong_origin(self):",
            "        # Given a GET request made to rdiffweb",
            "        # When the request is made using a different origin",
            "        self.getPage('/', headers=[('Origin', 'http://www.examples.com')])",
            "        # Then the response status it 200 OK.",
            "        self.assertStatus(200)",
            "",
            "    def test_post_with_wrong_origin(self):",
            "        # Given a POST request made to rdiffweb",
            "        # When the request is made using a different origin",
            "        self.getPage('/', headers=[('Origin', 'http://www.examples.com')], method='POST')",
            "        # Then the request is refused with 403 Forbiden",
            "        self.assertStatus(403)",
            "        self.assertInBody('Unexpected Origin header')",
            "",
            "    def test_post_with_valid_origin(self):",
            "        # Given a POST request made to rdiffweb",
            "        # When the request is made using a different origin",
            "        base = 'http://%s:%s' % (self.HOST, self.PORT)",
            "        self.getPage('/', headers=[('Origin', base)], method='POST')",
            "        # Then the request is accepted with 200 OK",
            "        self.assertStatus(200)",
            "",
            "    def test_post_without_origin(self):",
            "        # Given a POST request made to rdiffweb",
            "        # When the request is made without an origin",
            "        self.getPage('/', method='POST')",
            "        # Then the request is accepted with 200 OK",
            "        self.assertStatus(200)",
            "",
            "    def test_clickjacking_defense(self):",
            "        # Given a POST request made to rdiffweb",
            "        # When the request is made without an origin",
            "        self.getPage('/')",
            "        # Then the request is accepted with 200 OK",
            "        self.assertStatus(200)",
            "        self.assertHeaderItemValue('X-Frame-Options', 'DENY')"
        ],
        "afterPatchFile": [
            "# -*- coding: utf-8 -*-",
            "# rdiffweb, A web interface to rdiff-backup repositories",
            "# Copyright (C) 2012-2021 rdiffweb contributors",
            "#",
            "# This program is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This program is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with this program.  If not, see <http://www.gnu.org/licenses/>.",
            "\"\"\"",
            "Created on Oct 20, 2021",
            "",
            "@author: Patrik Dufresne",
            "\"\"\"",
            "from parameterized import parameterized",
            "",
            "import rdiffweb.test",
            "",
            "",
            "class SecureHeadersTest(rdiffweb.test.WebCase):",
            "",
            "    login = True",
            "",
            "    def test_cookie_samesite_lax(self):",
            "        # Given a request made to rdiffweb",
            "        # When receiving the response",
            "        self.getPage('/')",
            "        # Then the header contains Set-Cookie with SameSite=Lax",
            "        cookie = self.assertHeader('Set-Cookie')",
            "        self.assertIn('SameSite=Lax', cookie)",
            "",
            "    def test_cookie_samesite_lax_without_session(self):",
            "        # Given not a client sending no cookie",
            "        self.cookies = None",
            "        # When a query is made to a static path (without session)",
            "        self.getPage('/static/blue.css')",
            "        # Then Set-Cookie is not defined.",
            "        self.assertNoHeader('Set-Cookie')",
            "",
            "    def test_cookie_with_https(self):",
            "        # Given an https request made to rdiffweb",
            "        self.getPage('/', headers=[('X-Forwarded-Proto', 'https')])",
            "        # When receiving the response",
            "        self.assertStatus(200)",
            "        # Then the header contains Set-Cookie with Secure",
            "        cookie = self.assertHeader('Set-Cookie')",
            "        self.assertIn('Secure', cookie)",
            "",
            "    @parameterized.expand(",
            "        [",
            "            ('/invalid', 404),",
            "            ('/browse/invalid', 404),",
            "            ('/login', 301),",
            "            ('/logout', 303),",
            "        ]",
            "    )",
            "    def test_cookie_with_https_http_error(self, url, expected_error_code):",
            "        # Given an https request made to rdiffweb",
            "        self.getPage(url, headers=[('X-Forwarded-Proto', 'https')])",
            "        # When receiving the response",
            "        self.assertStatus(expected_error_code)",
            "        # Then the header contains Set-Cookie with Secure",
            "        cookie = self.assertHeader('Set-Cookie')",
            "        self.assertIn('Secure', cookie)",
            "",
            "    def test_cookie_with_http(self):",
            "        # Given an https request made to rdiffweb",
            "        self.getPage('/')",
            "        # When receiving the response",
            "        # Then the header contains Set-Cookie with Secure",
            "        cookie = self.assertHeader('Set-Cookie')",
            "        self.assertNotIn('Secure', cookie)",
            "",
            "    def test_get_with_wrong_origin(self):",
            "        # Given a GET request made to rdiffweb",
            "        # When the request is made using a different origin",
            "        self.getPage('/', headers=[('Origin', 'http://www.examples.com')])",
            "        # Then the response status it 200 OK.",
            "        self.assertStatus(200)",
            "",
            "    def test_post_with_wrong_origin(self):",
            "        # Given a POST request made to rdiffweb",
            "        # When the request is made using a different origin",
            "        self.getPage('/', headers=[('Origin', 'http://www.examples.com')], method='POST')",
            "        # Then the request is refused with 403 Forbiden",
            "        self.assertStatus(403)",
            "        self.assertInBody('Unexpected Origin header')",
            "",
            "    def test_post_with_valid_origin(self):",
            "        # Given a POST request made to rdiffweb",
            "        # When the request is made using a different origin",
            "        base = 'http://%s:%s' % (self.HOST, self.PORT)",
            "        self.getPage('/', headers=[('Origin', base)], method='POST')",
            "        # Then the request is accepted with 200 OK",
            "        self.assertStatus(200)",
            "",
            "    def test_post_without_origin(self):",
            "        # Given a POST request made to rdiffweb",
            "        # When the request is made without an origin",
            "        self.getPage('/', method='POST')",
            "        # Then the request is accepted with 200 OK",
            "        self.assertStatus(200)",
            "",
            "    def test_clickjacking_defense(self):",
            "        # Given a POST request made to rdiffweb",
            "        # When the request is made without an origin",
            "        self.getPage('/')",
            "        # Then the request is accepted with 200 OK",
            "        self.assertStatus(200)",
            "        self.assertHeaderItemValue('X-Frame-Options', 'DENY')",
            "",
            "    def test_no_cache(self):",
            "        # Given a POST request made to rdiffweb",
            "        # When the request is made without an origin",
            "        self.getPage('/')",
            "        # Then the request is accepted with 200 OK",
            "        self.assertStatus(200)",
            "        self.assertHeaderItemValue('Cache-control', 'no-cache')",
            "        self.assertHeaderItemValue('Cache-control', 'no-store')",
            "        self.assertHeaderItemValue('Cache-control', 'must-revalidate')",
            "        self.assertHeaderItemValue('Cache-control', 'max-age=0')",
            "        self.assertHeaderItemValue('Pragma', 'no-cache')",
            "        self.assertHeaderItemValue('Expires', '0')",
            "",
            "    def test_no_cache_with_static(self):",
            "        # Given a POST request made to rdiffweb",
            "        # When the request is made without an origin",
            "        self.getPage('/static/default.css')",
            "        # Then the request is accepted with 200 OK",
            "        self.assertStatus(200)",
            "        self.assertNoHeader('Cache-control')",
            "        self.assertNoHeader('Pragma')",
            "        self.assertNoHeader('Expires')",
            "",
            "    def test_referrer_policy(self):",
            "        # Given a POST request made to rdiffweb",
            "        # When the request is made without an origin",
            "        self.getPage('/')",
            "        # Then the request is accepted with 200 OK",
            "        self.assertStatus(200)",
            "        self.assertHeaderItemValue('Referrer-Policy', 'same-origin')",
            "",
            "    def test_nosniff(self):",
            "        # Given a POST request made to rdiffweb",
            "        # When the request is made without an origin",
            "        self.getPage('/')",
            "        # Then the request is accepted with 200 OK",
            "        self.assertStatus(200)",
            "        self.assertHeaderItemValue('X-Content-Type-Options', 'nosniff')",
            "",
            "    def test_xss_protection(self):",
            "        # Given a POST request made to rdiffweb",
            "        # When the request is made without an origin",
            "        self.getPage('/')",
            "        # Then the request is accepted with 200 OK",
            "        self.assertStatus(200)",
            "        self.assertHeaderItemValue('X-XSS-Protection', '1; mode=block')",
            "",
            "    def test_content_security_policy(self):",
            "        # Given a POST request made to rdiffweb",
            "        # When the request is made without an origin",
            "        self.getPage('/')",
            "        # Then the request is accepted with 200 OK",
            "        self.assertStatus(200)",
            "        self.assertHeaderItemValue(",
            "            'Content-Security-Policy',",
            "            \"default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'\",",
            "        )",
            "",
            "    def test_strict_transport_security(self):",
            "        # Given a POST request made to rdiffweb",
            "        # When the request is made without an origin",
            "        self.getPage('/', headers=[('X-Forwarded-Proto', 'https')])",
            "        # Then the request is accepted with 200 OK",
            "        self.assertStatus(200)",
            "        self.assertHeaderItemValue('Strict-Transport-Security', 'max-age=31536000; includeSubDomains')"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1"
        ],
        "dele_reviseLocation": {},
        "addLocation": [
            "yt_dlp.YoutubeDL",
            "rdiffweb.controller.tests.test_secure_headers.SecureHeadersTest.self"
        ]
    },
    "rdiffweb/tools/secure_headers.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 31,
                "afterPatchRowNumber": 31,
                "PatchRowcode": "     http.cookies.Morsel._reserved['samesite'] = 'SameSite'"
            },
            "1": {
                "beforePatchRowNumber": 32,
                "afterPatchRowNumber": 32,
                "PatchRowcode": " "
            },
            "2": {
                "beforePatchRowNumber": 33,
                "afterPatchRowNumber": 33,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": 34,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-def set_headers():"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 34,
                "PatchRowcode": "+def set_headers("
            },
            "5": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 35,
                "PatchRowcode": "+    xfo='DENY',"
            },
            "6": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 36,
                "PatchRowcode": "+    no_cache=True,"
            },
            "7": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 37,
                "PatchRowcode": "+    referrer='same-origin',"
            },
            "8": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 38,
                "PatchRowcode": "+    nosniff=True,"
            },
            "9": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 39,
                "PatchRowcode": "+    xxp='1; mode=block',"
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 40,
                "PatchRowcode": "+    csp=\"default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'\","
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 41,
                "PatchRowcode": "+):"
            },
            "12": {
                "beforePatchRowNumber": 35,
                "afterPatchRowNumber": 42,
                "PatchRowcode": "     \"\"\""
            },
            "13": {
                "beforePatchRowNumber": 36,
                "afterPatchRowNumber": 43,
                "PatchRowcode": "     This tool provide CSRF mitigation."
            },
            "14": {
                "beforePatchRowNumber": 37,
                "afterPatchRowNumber": 44,
                "PatchRowcode": " "
            },
            "15": {
                "beforePatchRowNumber": 38,
                "afterPatchRowNumber": 45,
                "PatchRowcode": "     * Define X-Frame-Options = DENY"
            },
            "16": {
                "beforePatchRowNumber": 39,
                "afterPatchRowNumber": 46,
                "PatchRowcode": "     * Define Cookies SameSite=Lax"
            },
            "17": {
                "beforePatchRowNumber": 40,
                "afterPatchRowNumber": 47,
                "PatchRowcode": "     * Define Cookies Secure when https is detected"
            },
            "18": {
                "beforePatchRowNumber": 41,
                "afterPatchRowNumber": 48,
                "PatchRowcode": "     * Validate `Origin` and `Referer` on POST, PUT, PATCH, DELETE"
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 49,
                "PatchRowcode": "+    * Define Cache-Control by default"
            },
            "20": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 50,
                "PatchRowcode": "+    * Define Referrer-Policy to 'same-origin'"
            },
            "21": {
                "beforePatchRowNumber": 42,
                "afterPatchRowNumber": 51,
                "PatchRowcode": " "
            },
            "22": {
                "beforePatchRowNumber": 43,
                "afterPatchRowNumber": 52,
                "PatchRowcode": "     Ref.:"
            },
            "23": {
                "beforePatchRowNumber": 44,
                "afterPatchRowNumber": 53,
                "PatchRowcode": "     https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html"
            },
            "24": {
                "beforePatchRowNumber": 45,
                "afterPatchRowNumber": 54,
                "PatchRowcode": "     https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking_Defense_Cheat_Sheet.html"
            },
            "25": {
                "beforePatchRowNumber": 46,
                "afterPatchRowNumber": 55,
                "PatchRowcode": "     \"\"\""
            },
            "26": {
                "beforePatchRowNumber": 47,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    if cherrypy.request.method in ['POST', 'PUT', 'PATCH', 'DELETE']:"
            },
            "27": {
                "beforePatchRowNumber": 48,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        # Check if Origin matches our target."
            },
            "28": {
                "beforePatchRowNumber": 49,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        origin = cherrypy.request.headers.get('Origin', None)"
            },
            "29": {
                "beforePatchRowNumber": 50,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        if origin and not origin.startswith(cherrypy.request.base):"
            },
            "30": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 56,
                "PatchRowcode": "+    request = cherrypy.request"
            },
            "31": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 57,
                "PatchRowcode": "+    response = cherrypy.serving.response"
            },
            "32": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 58,
                "PatchRowcode": "+"
            },
            "33": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 59,
                "PatchRowcode": "+    # Check if Origin matches our target."
            },
            "34": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 60,
                "PatchRowcode": "+    if request.method in ['POST', 'PUT', 'PATCH', 'DELETE']:"
            },
            "35": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 61,
                "PatchRowcode": "+        origin = request.headers.get('Origin', None)"
            },
            "36": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 62,
                "PatchRowcode": "+        if origin and not origin.startswith(request.base):"
            },
            "37": {
                "beforePatchRowNumber": 51,
                "afterPatchRowNumber": 63,
                "PatchRowcode": "             raise cherrypy.HTTPError(403, 'Unexpected Origin header')"
            },
            "38": {
                "beforePatchRowNumber": 52,
                "afterPatchRowNumber": 64,
                "PatchRowcode": " "
            },
            "39": {
                "beforePatchRowNumber": 53,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    response = cherrypy.serving.response"
            },
            "40": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 65,
                "PatchRowcode": "+    # Check if https is enabled"
            },
            "41": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 66,
                "PatchRowcode": "+    https = request.base.startswith('https')"
            },
            "42": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 67,
                "PatchRowcode": "+"
            },
            "43": {
                "beforePatchRowNumber": 54,
                "afterPatchRowNumber": 68,
                "PatchRowcode": "     # Define X-Frame-Options to avoid Clickjacking"
            },
            "44": {
                "beforePatchRowNumber": 55,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    response.headers['X-Frame-Options'] = 'DENY'"
            },
            "45": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 69,
                "PatchRowcode": "+    if xfo:"
            },
            "46": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 70,
                "PatchRowcode": "+        response.headers['X-Frame-Options'] = xfo"
            },
            "47": {
                "beforePatchRowNumber": 56,
                "afterPatchRowNumber": 71,
                "PatchRowcode": " "
            },
            "48": {
                "beforePatchRowNumber": 57,
                "afterPatchRowNumber": 72,
                "PatchRowcode": "     # Enforce security on cookies"
            },
            "49": {
                "beforePatchRowNumber": 58,
                "afterPatchRowNumber": 73,
                "PatchRowcode": "     cookie = response.cookie.get('session_id', None)"
            },
            "50": {
                "beforePatchRowNumber": 61,
                "afterPatchRowNumber": 76,
                "PatchRowcode": "         # https://github.com/cherrypy/cherrypy/issues/1767"
            },
            "51": {
                "beforePatchRowNumber": 62,
                "afterPatchRowNumber": 77,
                "PatchRowcode": "         # Force SameSite to Lax"
            },
            "52": {
                "beforePatchRowNumber": 63,
                "afterPatchRowNumber": 78,
                "PatchRowcode": "         cookie['samesite'] = 'Lax'"
            },
            "53": {
                "beforePatchRowNumber": 64,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        # Check if https is enabled"
            },
            "54": {
                "beforePatchRowNumber": 65,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        https = cherrypy.request.base.startswith('https')"
            },
            "55": {
                "beforePatchRowNumber": 66,
                "afterPatchRowNumber": 79,
                "PatchRowcode": "         if https:"
            },
            "56": {
                "beforePatchRowNumber": 67,
                "afterPatchRowNumber": 80,
                "PatchRowcode": "             cookie['secure'] = 1"
            },
            "57": {
                "beforePatchRowNumber": 68,
                "afterPatchRowNumber": 81,
                "PatchRowcode": " "
            },
            "58": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 82,
                "PatchRowcode": "+    # Add Cache-Control to avoid storing sensible information in Browser cache."
            },
            "59": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 83,
                "PatchRowcode": "+    if no_cache:"
            },
            "60": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 84,
                "PatchRowcode": "+        response.headers['Cache-control'] = 'no-cache, no-store, must-revalidate, max-age=0'"
            },
            "61": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 85,
                "PatchRowcode": "+        response.headers['Pragma'] = 'no-cache'"
            },
            "62": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 86,
                "PatchRowcode": "+        response.headers['Expires'] = '0'"
            },
            "63": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 87,
                "PatchRowcode": "+"
            },
            "64": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 88,
                "PatchRowcode": "+    # Add Referrer-Policy"
            },
            "65": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 89,
                "PatchRowcode": "+    if referrer:"
            },
            "66": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 90,
                "PatchRowcode": "+        response.headers['Referrer-Policy'] = referrer"
            },
            "67": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 91,
                "PatchRowcode": "+"
            },
            "68": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 92,
                "PatchRowcode": "+    # Add X-Content-Type-Options to avoid browser to \"sniff\" to content-type"
            },
            "69": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 93,
                "PatchRowcode": "+    if nosniff:"
            },
            "70": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 94,
                "PatchRowcode": "+        response.headers['X-Content-Type-Options'] = 'nosniff'"
            },
            "71": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 95,
                "PatchRowcode": "+"
            },
            "72": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 96,
                "PatchRowcode": "+    # Add X-XSS-Protection to enabled XSS protection"
            },
            "73": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 97,
                "PatchRowcode": "+    if xxp:"
            },
            "74": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 98,
                "PatchRowcode": "+        response.headers['X-XSS-Protection'] = xxp"
            },
            "75": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 99,
                "PatchRowcode": "+"
            },
            "76": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 100,
                "PatchRowcode": "+    # Add Content-Security-Policy"
            },
            "77": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 101,
                "PatchRowcode": "+    if csp:"
            },
            "78": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 102,
                "PatchRowcode": "+        response.headers['Content-Security-Policy'] = csp"
            },
            "79": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 103,
                "PatchRowcode": "+"
            },
            "80": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 104,
                "PatchRowcode": "+    # Add Strict-Transport-Security to force https use."
            },
            "81": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 105,
                "PatchRowcode": "+    if https:"
            },
            "82": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 106,
                "PatchRowcode": "+        response.headers['Strict-Transport-Security'] = \"max-age=31536000; includeSubDomains\""
            },
            "83": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 107,
                "PatchRowcode": "+"
            },
            "84": {
                "beforePatchRowNumber": 69,
                "afterPatchRowNumber": 108,
                "PatchRowcode": " "
            },
            "85": {
                "beforePatchRowNumber": 70,
                "afterPatchRowNumber": 109,
                "PatchRowcode": " cherrypy.tools.secure_headers = cherrypy.Tool('before_request_body', set_headers, priority=71)"
            }
        },
        "frontPatchFile": [
            "# -*- coding: utf-8 -*-",
            "# rdiffweb, A web interface to rdiff-backup repositories",
            "# Copyright (C) 2012-2021 rdiffweb contributors",
            "#",
            "# This program is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This program is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with this program.  If not, see <http://www.gnu.org/licenses/>.",
            "",
            "import http.cookies",
            "import logging",
            "",
            "import cherrypy",
            "",
            "# Define the logger",
            "logger = logging.getLogger(__name__)",
            "",
            "#",
            "# Patch Morsel prior to 3.8",
            "# Allow SameSite attribute to be define on the cookie.",
            "#",
            "if not http.cookies.Morsel().isReservedKey(\"samesite\"):",
            "    http.cookies.Morsel._reserved['samesite'] = 'SameSite'",
            "",
            "",
            "def set_headers():",
            "    \"\"\"",
            "    This tool provide CSRF mitigation.",
            "",
            "    * Define X-Frame-Options = DENY",
            "    * Define Cookies SameSite=Lax",
            "    * Define Cookies Secure when https is detected",
            "    * Validate `Origin` and `Referer` on POST, PUT, PATCH, DELETE",
            "",
            "    Ref.:",
            "    https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html",
            "    https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking_Defense_Cheat_Sheet.html",
            "    \"\"\"",
            "    if cherrypy.request.method in ['POST', 'PUT', 'PATCH', 'DELETE']:",
            "        # Check if Origin matches our target.",
            "        origin = cherrypy.request.headers.get('Origin', None)",
            "        if origin and not origin.startswith(cherrypy.request.base):",
            "            raise cherrypy.HTTPError(403, 'Unexpected Origin header')",
            "",
            "    response = cherrypy.serving.response",
            "    # Define X-Frame-Options to avoid Clickjacking",
            "    response.headers['X-Frame-Options'] = 'DENY'",
            "",
            "    # Enforce security on cookies",
            "    cookie = response.cookie.get('session_id', None)",
            "    if cookie:",
            "        # Awaiting bug fix in cherrypy",
            "        # https://github.com/cherrypy/cherrypy/issues/1767",
            "        # Force SameSite to Lax",
            "        cookie['samesite'] = 'Lax'",
            "        # Check if https is enabled",
            "        https = cherrypy.request.base.startswith('https')",
            "        if https:",
            "            cookie['secure'] = 1",
            "",
            "",
            "cherrypy.tools.secure_headers = cherrypy.Tool('before_request_body', set_headers, priority=71)"
        ],
        "afterPatchFile": [
            "# -*- coding: utf-8 -*-",
            "# rdiffweb, A web interface to rdiff-backup repositories",
            "# Copyright (C) 2012-2021 rdiffweb contributors",
            "#",
            "# This program is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This program is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with this program.  If not, see <http://www.gnu.org/licenses/>.",
            "",
            "import http.cookies",
            "import logging",
            "",
            "import cherrypy",
            "",
            "# Define the logger",
            "logger = logging.getLogger(__name__)",
            "",
            "#",
            "# Patch Morsel prior to 3.8",
            "# Allow SameSite attribute to be define on the cookie.",
            "#",
            "if not http.cookies.Morsel().isReservedKey(\"samesite\"):",
            "    http.cookies.Morsel._reserved['samesite'] = 'SameSite'",
            "",
            "",
            "def set_headers(",
            "    xfo='DENY',",
            "    no_cache=True,",
            "    referrer='same-origin',",
            "    nosniff=True,",
            "    xxp='1; mode=block',",
            "    csp=\"default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'\",",
            "):",
            "    \"\"\"",
            "    This tool provide CSRF mitigation.",
            "",
            "    * Define X-Frame-Options = DENY",
            "    * Define Cookies SameSite=Lax",
            "    * Define Cookies Secure when https is detected",
            "    * Validate `Origin` and `Referer` on POST, PUT, PATCH, DELETE",
            "    * Define Cache-Control by default",
            "    * Define Referrer-Policy to 'same-origin'",
            "",
            "    Ref.:",
            "    https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html",
            "    https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking_Defense_Cheat_Sheet.html",
            "    \"\"\"",
            "    request = cherrypy.request",
            "    response = cherrypy.serving.response",
            "",
            "    # Check if Origin matches our target.",
            "    if request.method in ['POST', 'PUT', 'PATCH', 'DELETE']:",
            "        origin = request.headers.get('Origin', None)",
            "        if origin and not origin.startswith(request.base):",
            "            raise cherrypy.HTTPError(403, 'Unexpected Origin header')",
            "",
            "    # Check if https is enabled",
            "    https = request.base.startswith('https')",
            "",
            "    # Define X-Frame-Options to avoid Clickjacking",
            "    if xfo:",
            "        response.headers['X-Frame-Options'] = xfo",
            "",
            "    # Enforce security on cookies",
            "    cookie = response.cookie.get('session_id', None)",
            "    if cookie:",
            "        # Awaiting bug fix in cherrypy",
            "        # https://github.com/cherrypy/cherrypy/issues/1767",
            "        # Force SameSite to Lax",
            "        cookie['samesite'] = 'Lax'",
            "        if https:",
            "            cookie['secure'] = 1",
            "",
            "    # Add Cache-Control to avoid storing sensible information in Browser cache.",
            "    if no_cache:",
            "        response.headers['Cache-control'] = 'no-cache, no-store, must-revalidate, max-age=0'",
            "        response.headers['Pragma'] = 'no-cache'",
            "        response.headers['Expires'] = '0'",
            "",
            "    # Add Referrer-Policy",
            "    if referrer:",
            "        response.headers['Referrer-Policy'] = referrer",
            "",
            "    # Add X-Content-Type-Options to avoid browser to \"sniff\" to content-type",
            "    if nosniff:",
            "        response.headers['X-Content-Type-Options'] = 'nosniff'",
            "",
            "    # Add X-XSS-Protection to enabled XSS protection",
            "    if xxp:",
            "        response.headers['X-XSS-Protection'] = xxp",
            "",
            "    # Add Content-Security-Policy",
            "    if csp:",
            "        response.headers['Content-Security-Policy'] = csp",
            "",
            "    # Add Strict-Transport-Security to force https use.",
            "    if https:",
            "        response.headers['Strict-Transport-Security'] = \"max-age=31536000; includeSubDomains\"",
            "",
            "",
            "cherrypy.tools.secure_headers = cherrypy.Tool('before_request_body', set_headers, priority=71)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "0",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "34": [
                "set_headers"
            ],
            "47": [
                "set_headers"
            ],
            "48": [
                "set_headers"
            ],
            "49": [
                "set_headers"
            ],
            "50": [
                "set_headers"
            ],
            "53": [
                "set_headers"
            ],
            "55": [
                "set_headers"
            ],
            "64": [
                "set_headers"
            ],
            "65": [
                "set_headers"
            ]
        },
        "addLocation": []
    }
}