{
    "django/contrib/sessions/middleware.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 36,
                "afterPatchRowNumber": 36,
                "PatchRowcode": "             else:"
            },
            "1": {
                "beforePatchRowNumber": 37,
                "afterPatchRowNumber": 37,
                "PatchRowcode": "                 if accessed:"
            },
            "2": {
                "beforePatchRowNumber": 38,
                "afterPatchRowNumber": 38,
                "PatchRowcode": "                     patch_vary_headers(response, ('Cookie',))"
            },
            "3": {
                "beforePatchRowNumber": 39,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                if modified or settings.SESSION_SAVE_EVERY_REQUEST:"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 39,
                "PatchRowcode": "+                if (modified or settings.SESSION_SAVE_EVERY_REQUEST) and not empty:"
            },
            "5": {
                "beforePatchRowNumber": 40,
                "afterPatchRowNumber": 40,
                "PatchRowcode": "                     if request.session.get_expire_at_browser_close():"
            },
            "6": {
                "beforePatchRowNumber": 41,
                "afterPatchRowNumber": 41,
                "PatchRowcode": "                         max_age = None"
            },
            "7": {
                "beforePatchRowNumber": 42,
                "afterPatchRowNumber": 42,
                "PatchRowcode": "                         expires = None"
            }
        },
        "frontPatchFile": [
            "import time",
            "from importlib import import_module",
            "",
            "from django.conf import settings",
            "from django.utils.cache import patch_vary_headers",
            "from django.utils.http import cookie_date",
            "",
            "",
            "class SessionMiddleware(object):",
            "    def __init__(self):",
            "        engine = import_module(settings.SESSION_ENGINE)",
            "        self.SessionStore = engine.SessionStore",
            "",
            "    def process_request(self, request):",
            "        session_key = request.COOKIES.get(settings.SESSION_COOKIE_NAME)",
            "        request.session = self.SessionStore(session_key)",
            "",
            "    def process_response(self, request, response):",
            "        \"\"\"",
            "        If request.session was modified, or if the configuration is to save the",
            "        session every time, save the changes and set a session cookie or delete",
            "        the session cookie if the session has been emptied.",
            "        \"\"\"",
            "        try:",
            "            accessed = request.session.accessed",
            "            modified = request.session.modified",
            "            empty = request.session.is_empty()",
            "        except AttributeError:",
            "            pass",
            "        else:",
            "            # First check if we need to delete this cookie.",
            "            # The session should be deleted only if the session is entirely empty",
            "            if settings.SESSION_COOKIE_NAME in request.COOKIES and empty:",
            "                response.delete_cookie(settings.SESSION_COOKIE_NAME,",
            "                    domain=settings.SESSION_COOKIE_DOMAIN)",
            "            else:",
            "                if accessed:",
            "                    patch_vary_headers(response, ('Cookie',))",
            "                if modified or settings.SESSION_SAVE_EVERY_REQUEST:",
            "                    if request.session.get_expire_at_browser_close():",
            "                        max_age = None",
            "                        expires = None",
            "                    else:",
            "                        max_age = request.session.get_expiry_age()",
            "                        expires_time = time.time() + max_age",
            "                        expires = cookie_date(expires_time)",
            "                    # Save the session data and refresh the client cookie.",
            "                    # Skip session save for 500 responses, refs #3881.",
            "                    if response.status_code != 500:",
            "                        request.session.save()",
            "                        response.set_cookie(settings.SESSION_COOKIE_NAME,",
            "                                request.session.session_key, max_age=max_age,",
            "                                expires=expires, domain=settings.SESSION_COOKIE_DOMAIN,",
            "                                path=settings.SESSION_COOKIE_PATH,",
            "                                secure=settings.SESSION_COOKIE_SECURE or None,",
            "                                httponly=settings.SESSION_COOKIE_HTTPONLY or None)",
            "        return response"
        ],
        "afterPatchFile": [
            "import time",
            "from importlib import import_module",
            "",
            "from django.conf import settings",
            "from django.utils.cache import patch_vary_headers",
            "from django.utils.http import cookie_date",
            "",
            "",
            "class SessionMiddleware(object):",
            "    def __init__(self):",
            "        engine = import_module(settings.SESSION_ENGINE)",
            "        self.SessionStore = engine.SessionStore",
            "",
            "    def process_request(self, request):",
            "        session_key = request.COOKIES.get(settings.SESSION_COOKIE_NAME)",
            "        request.session = self.SessionStore(session_key)",
            "",
            "    def process_response(self, request, response):",
            "        \"\"\"",
            "        If request.session was modified, or if the configuration is to save the",
            "        session every time, save the changes and set a session cookie or delete",
            "        the session cookie if the session has been emptied.",
            "        \"\"\"",
            "        try:",
            "            accessed = request.session.accessed",
            "            modified = request.session.modified",
            "            empty = request.session.is_empty()",
            "        except AttributeError:",
            "            pass",
            "        else:",
            "            # First check if we need to delete this cookie.",
            "            # The session should be deleted only if the session is entirely empty",
            "            if settings.SESSION_COOKIE_NAME in request.COOKIES and empty:",
            "                response.delete_cookie(settings.SESSION_COOKIE_NAME,",
            "                    domain=settings.SESSION_COOKIE_DOMAIN)",
            "            else:",
            "                if accessed:",
            "                    patch_vary_headers(response, ('Cookie',))",
            "                if (modified or settings.SESSION_SAVE_EVERY_REQUEST) and not empty:",
            "                    if request.session.get_expire_at_browser_close():",
            "                        max_age = None",
            "                        expires = None",
            "                    else:",
            "                        max_age = request.session.get_expiry_age()",
            "                        expires_time = time.time() + max_age",
            "                        expires = cookie_date(expires_time)",
            "                    # Save the session data and refresh the client cookie.",
            "                    # Skip session save for 500 responses, refs #3881.",
            "                    if response.status_code != 500:",
            "                        request.session.save()",
            "                        response.set_cookie(settings.SESSION_COOKIE_NAME,",
            "                                request.session.session_key, max_age=max_age,",
            "                                expires=expires, domain=settings.SESSION_COOKIE_DOMAIN,",
            "                                path=settings.SESSION_COOKIE_PATH,",
            "                                secure=settings.SESSION_COOKIE_SECURE or None,",
            "                                httponly=settings.SESSION_COOKIE_HTTPONLY or None)",
            "        return response"
        ],
        "action": [
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "39": [
                "SessionMiddleware",
                "process_response"
            ]
        },
        "addLocation": []
    }
}