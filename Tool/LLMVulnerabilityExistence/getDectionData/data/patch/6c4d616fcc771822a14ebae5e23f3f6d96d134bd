{
    "setup.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 49,
                "afterPatchRowNumber": 49,
                "PatchRowcode": "         'five.grok',"
            },
            "1": {
                "beforePatchRowNumber": 50,
                "afterPatchRowNumber": 50,
                "PatchRowcode": "         'collective.documentviewer',"
            },
            "2": {
                "beforePatchRowNumber": 51,
                "afterPatchRowNumber": 51,
                "PatchRowcode": "         'dexterity.localrolesfield',"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 52,
                "PatchRowcode": "+        'future',"
            },
            "4": {
                "beforePatchRowNumber": 52,
                "afterPatchRowNumber": 53,
                "PatchRowcode": "         'plone.api',"
            },
            "5": {
                "beforePatchRowNumber": 53,
                "afterPatchRowNumber": 54,
                "PatchRowcode": "         'plone.app.dexterity',"
            },
            "6": {
                "beforePatchRowNumber": 54,
                "afterPatchRowNumber": 55,
                "PatchRowcode": "         'plone.directives.form',"
            },
            "7": {
                "beforePatchRowNumber": 59,
                "afterPatchRowNumber": 60,
                "PatchRowcode": "         'plone.formwidget.contenttree',"
            },
            "8": {
                "beforePatchRowNumber": 60,
                "afterPatchRowNumber": 61,
                "PatchRowcode": "         'plone.principalsource',"
            },
            "9": {
                "beforePatchRowNumber": 61,
                "afterPatchRowNumber": 62,
                "PatchRowcode": "         'collective.z3cform.chosen',"
            },
            "10": {
                "beforePatchRowNumber": 62,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        'z3c.table',"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 63,
                "PatchRowcode": "+        'z3c.table>=2.2',"
            },
            "12": {
                "beforePatchRowNumber": 63,
                "afterPatchRowNumber": 64,
                "PatchRowcode": "     ],"
            },
            "13": {
                "beforePatchRowNumber": 64,
                "afterPatchRowNumber": 65,
                "PatchRowcode": "     extras_require={"
            },
            "14": {
                "beforePatchRowNumber": 65,
                "afterPatchRowNumber": 66,
                "PatchRowcode": "         'test': ['plone.app.testing',"
            }
        },
        "frontPatchFile": [
            "#! -*- coding: utf8 -*-",
            "from setuptools import setup, find_packages",
            "",
            "version = '1.7.dev0'",
            "",
            "long_description = (",
            "    open('README.rst').read()",
            "    + '\\n' +",
            "    'Contributors\\n'",
            "    '============\\n'",
            "    + '\\n' +",
            "    open('CONTRIBUTORS.rst').read()",
            "    + '\\n' +",
            "    open('CHANGES.rst').read()",
            "    + '\\n')",
            "",
            "setup(",
            "    name='collective.dms.basecontent',",
            "    version=version,",
            "    description=\"Base content types for document management system\",",
            "    long_description=long_description,",
            "    # Get more strings from",
            "    # http://pypi.python.org/pypi?%3Aaction=list_classifiers",
            "    classifiers=[",
            "        \"Development Status :: 5 - Production/Stable\",",
            "        \"Environment :: Web Environment\",",
            "        \"Framework :: Plone\",",
            "        \"Framework :: Plone :: 4.2\",",
            "        \"Framework :: Plone :: 4.3\",",
            "        \"License :: OSI Approved :: GNU General Public License v2 (GPLv2)\",",
            "        \"Operating System :: OS Independent\",",
            "        \"Programming Language :: Python\",",
            "        \"Programming Language :: Python :: 2.7\",",
            "        \"Topic :: Software Development :: Libraries :: Python Modules\",",
            "    ],",
            "    keywords='document management system dms viewer',",
            "    author='Ecreall, Entrouvert, IMIO',",
            "    author_email='cedricmessiant@ecreall.com',",
            "    url='https://github.com/collective/collective.dms.basecontent',",
            "    download_url='https://pypi.org/project/collective.dms.basecontent',",
            "    license='gpl',",
            "    packages=find_packages('src'),",
            "    package_dir={'': 'src'},",
            "    namespace_packages=['collective', 'collective.dms'],",
            "    include_package_data=True,",
            "    zip_safe=False,",
            "    install_requires=[",
            "        'setuptools',",
            "        'five.grok',",
            "        'collective.documentviewer',",
            "        'dexterity.localrolesfield',",
            "        'plone.api',",
            "        'plone.app.dexterity',",
            "        'plone.directives.form',",
            "        'plone.namedfile',",
            "        'z3c.blobfile',",
            "        'plone.app.contenttypes',",
            "        'plone.app.relationfield',",
            "        'plone.formwidget.contenttree',",
            "        'plone.principalsource',",
            "        'collective.z3cform.chosen',",
            "        'z3c.table',",
            "    ],",
            "    extras_require={",
            "        'test': ['plone.app.testing',",
            "                 'ecreall.helpers.testing',",
            "                 'plone.app.vocabularies'",
            "                 ],",
            "    },",
            "    entry_points=\"\"\"",
            "    # -*- Entry points: -*-",
            "    [z3c.autoinclude.plugin]",
            "    target = plone",
            "    \"\"\",",
            ")"
        ],
        "afterPatchFile": [
            "#! -*- coding: utf8 -*-",
            "from setuptools import setup, find_packages",
            "",
            "version = '1.7.dev0'",
            "",
            "long_description = (",
            "    open('README.rst').read()",
            "    + '\\n' +",
            "    'Contributors\\n'",
            "    '============\\n'",
            "    + '\\n' +",
            "    open('CONTRIBUTORS.rst').read()",
            "    + '\\n' +",
            "    open('CHANGES.rst').read()",
            "    + '\\n')",
            "",
            "setup(",
            "    name='collective.dms.basecontent',",
            "    version=version,",
            "    description=\"Base content types for document management system\",",
            "    long_description=long_description,",
            "    # Get more strings from",
            "    # http://pypi.python.org/pypi?%3Aaction=list_classifiers",
            "    classifiers=[",
            "        \"Development Status :: 5 - Production/Stable\",",
            "        \"Environment :: Web Environment\",",
            "        \"Framework :: Plone\",",
            "        \"Framework :: Plone :: 4.2\",",
            "        \"Framework :: Plone :: 4.3\",",
            "        \"License :: OSI Approved :: GNU General Public License v2 (GPLv2)\",",
            "        \"Operating System :: OS Independent\",",
            "        \"Programming Language :: Python\",",
            "        \"Programming Language :: Python :: 2.7\",",
            "        \"Topic :: Software Development :: Libraries :: Python Modules\",",
            "    ],",
            "    keywords='document management system dms viewer',",
            "    author='Ecreall, Entrouvert, IMIO',",
            "    author_email='cedricmessiant@ecreall.com',",
            "    url='https://github.com/collective/collective.dms.basecontent',",
            "    download_url='https://pypi.org/project/collective.dms.basecontent',",
            "    license='gpl',",
            "    packages=find_packages('src'),",
            "    package_dir={'': 'src'},",
            "    namespace_packages=['collective', 'collective.dms'],",
            "    include_package_data=True,",
            "    zip_safe=False,",
            "    install_requires=[",
            "        'setuptools',",
            "        'five.grok',",
            "        'collective.documentviewer',",
            "        'dexterity.localrolesfield',",
            "        'future',",
            "        'plone.api',",
            "        'plone.app.dexterity',",
            "        'plone.directives.form',",
            "        'plone.namedfile',",
            "        'z3c.blobfile',",
            "        'plone.app.contenttypes',",
            "        'plone.app.relationfield',",
            "        'plone.formwidget.contenttree',",
            "        'plone.principalsource',",
            "        'collective.z3cform.chosen',",
            "        'z3c.table>=2.2',",
            "    ],",
            "    extras_require={",
            "        'test': ['plone.app.testing',",
            "                 'ecreall.helpers.testing',",
            "                 'plone.app.vocabularies'",
            "                 ],",
            "    },",
            "    entry_points=\"\"\"",
            "    # -*- Entry points: -*-",
            "    [z3c.autoinclude.plugin]",
            "    target = plone",
            "    \"\"\",",
            ")"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "62": []
        },
        "addLocation": []
    },
    "src/collective/dms/basecontent/browser/column.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 1,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-import os.path"
            },
            "1": {
                "beforePatchRowNumber": 2,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-import Missing"
            },
            "2": {
                "beforePatchRowNumber": 3,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-from Acquisition import aq_base"
            },
            "3": {
                "beforePatchRowNumber": 4,
                "afterPatchRowNumber": 1,
                "PatchRowcode": " from AccessControl import getSecurityManager"
            },
            "4": {
                "beforePatchRowNumber": 5,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-from Products.CMFCore.utils import getToolByName"
            },
            "5": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 2,
                "PatchRowcode": "+from Acquisition import aq_base"
            },
            "6": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 3,
                "PatchRowcode": "+from collective.dms.basecontent import _"
            },
            "7": {
                "beforePatchRowNumber": 6,
                "afterPatchRowNumber": 4,
                "PatchRowcode": " from five import grok"
            },
            "8": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 5,
                "PatchRowcode": "+from html import escape"
            },
            "9": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 6,
                "PatchRowcode": "+from Products.CMFCore.utils import getToolByName"
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 7,
                "PatchRowcode": "+from Products.CMFCore.WorkflowCore import WorkflowException"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 8,
                "PatchRowcode": "+from Products.CMFPlone.utils import safe_unicode"
            },
            "12": {
                "beforePatchRowNumber": 7,
                "afterPatchRowNumber": 9,
                "PatchRowcode": " from z3c.table import interfaces"
            },
            "13": {
                "beforePatchRowNumber": 8,
                "afterPatchRowNumber": 10,
                "PatchRowcode": " from zope.component import getMultiAdapter"
            },
            "14": {
                "beforePatchRowNumber": 9,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-from zope.i18nmessageid import MessageFactory"
            },
            "15": {
                "beforePatchRowNumber": 10,
                "afterPatchRowNumber": 11,
                "PatchRowcode": " from zope.i18n import translate"
            },
            "16": {
                "beforePatchRowNumber": 11,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-import z3c.table.table"
            },
            "17": {
                "beforePatchRowNumber": 12,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-import z3c.table.column"
            },
            "18": {
                "beforePatchRowNumber": 13,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-from Products.CMFCore.WorkflowCore import WorkflowException"
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 12,
                "PatchRowcode": "+from zope.i18nmessageid import MessageFactory"
            },
            "20": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 13,
                "PatchRowcode": "+"
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 14,
                "PatchRowcode": "+import Missing"
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 15,
                "PatchRowcode": "+import os.path"
            },
            "23": {
                "beforePatchRowNumber": 14,
                "afterPatchRowNumber": 16,
                "PatchRowcode": " import plone.api"
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 17,
                "PatchRowcode": "+import z3c.table.column"
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 18,
                "PatchRowcode": "+import z3c.table.table"
            },
            "26": {
                "beforePatchRowNumber": 15,
                "afterPatchRowNumber": 19,
                "PatchRowcode": " "
            },
            "27": {
                "beforePatchRowNumber": 16,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-from collective.dms.basecontent import _"
            },
            "28": {
                "beforePatchRowNumber": 17,
                "afterPatchRowNumber": 20,
                "PatchRowcode": " "
            },
            "29": {
                "beforePatchRowNumber": 18,
                "afterPatchRowNumber": 21,
                "PatchRowcode": " PMF = MessageFactory('plone')"
            },
            "30": {
                "beforePatchRowNumber": 19,
                "afterPatchRowNumber": 22,
                "PatchRowcode": " "
            },
            "31": {
                "beforePatchRowNumber": 74,
                "afterPatchRowNumber": 77,
                "PatchRowcode": "         for principal_id in value:"
            },
            "32": {
                "beforePatchRowNumber": 75,
                "afterPatchRowNumber": 78,
                "PatchRowcode": "             user = mtool.getMemberById(principal_id)"
            },
            "33": {
                "beforePatchRowNumber": 76,
                "afterPatchRowNumber": 79,
                "PatchRowcode": "             if user is not None:"
            },
            "34": {
                "beforePatchRowNumber": 77,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                principals.append(user.getProperty('fullname', None) or user.getId())"
            },
            "35": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 80,
                "PatchRowcode": "+                principals.append(escape(user.getProperty('fullname', None)) or user.getId())"
            },
            "36": {
                "beforePatchRowNumber": 78,
                "afterPatchRowNumber": 81,
                "PatchRowcode": "             else:"
            },
            "37": {
                "beforePatchRowNumber": 79,
                "afterPatchRowNumber": 82,
                "PatchRowcode": "                 group = gtool.getGroupById(principal_id)"
            },
            "38": {
                "beforePatchRowNumber": 80,
                "afterPatchRowNumber": 83,
                "PatchRowcode": "                 if group is not None:"
            },
            "39": {
                "beforePatchRowNumber": 81,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    principals.append(group.getProperty('title', None) or group.getId())"
            },
            "40": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 84,
                "PatchRowcode": "+                    principals.append(escape(group.getProperty('title', None)) or group.getId())"
            },
            "41": {
                "beforePatchRowNumber": 82,
                "afterPatchRowNumber": 85,
                "PatchRowcode": " "
            },
            "42": {
                "beforePatchRowNumber": 83,
                "afterPatchRowNumber": 86,
                "PatchRowcode": "         return ', '.join(principals).decode('utf-8')"
            },
            "43": {
                "beforePatchRowNumber": 84,
                "afterPatchRowNumber": 87,
                "PatchRowcode": " "
            },
            "44": {
                "beforePatchRowNumber": 92,
                "afterPatchRowNumber": 95,
                "PatchRowcode": "             return '%s/%s' % (item.getURL(), self.linkName)"
            },
            "45": {
                "beforePatchRowNumber": 93,
                "afterPatchRowNumber": 96,
                "PatchRowcode": "         return item.getURL()"
            },
            "46": {
                "beforePatchRowNumber": 94,
                "afterPatchRowNumber": 97,
                "PatchRowcode": " "
            },
            "47": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 98,
                "PatchRowcode": "+    def renderCell(self, item):"
            },
            "48": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 99,
                "PatchRowcode": "+        # setup a tag"
            },
            "49": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 100,
                "PatchRowcode": "+        return '<a href=\"%s\"%s%s%s>%s</a>' % ("
            },
            "50": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 101,
                "PatchRowcode": "+            self.getLinkURL(item),  # originally escaped"
            },
            "51": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 102,
                "PatchRowcode": "+            self.getLinkTarget(item),"
            },
            "52": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 103,
                "PatchRowcode": "+            self.getLinkCSS(item),"
            },
            "53": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 104,
                "PatchRowcode": "+            self.getLinkTitle(item),"
            },
            "54": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 105,
                "PatchRowcode": "+            self.getLinkContent(item),  # originally escaped"
            },
            "55": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 106,
                "PatchRowcode": "+        )"
            },
            "56": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 107,
                "PatchRowcode": "+"
            },
            "57": {
                "beforePatchRowNumber": 95,
                "afterPatchRowNumber": 108,
                "PatchRowcode": " "
            },
            "58": {
                "beforePatchRowNumber": 96,
                "afterPatchRowNumber": 109,
                "PatchRowcode": " class TitleColumn(LinkColumn):"
            },
            "59": {
                "beforePatchRowNumber": 97,
                "afterPatchRowNumber": 110,
                "PatchRowcode": "     grok.baseclass()"
            },
            "60": {
                "beforePatchRowNumber": 100,
                "afterPatchRowNumber": 113,
                "PatchRowcode": " "
            },
            "61": {
                "beforePatchRowNumber": 101,
                "afterPatchRowNumber": 114,
                "PatchRowcode": "     def getLinkContent(self, item):"
            },
            "62": {
                "beforePatchRowNumber": 102,
                "afterPatchRowNumber": 115,
                "PatchRowcode": "         title = get_value(item, 'Title')"
            },
            "63": {
                "beforePatchRowNumber": 103,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        if isinstance(title, unicode):"
            },
            "64": {
                "beforePatchRowNumber": 104,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            return title"
            },
            "65": {
                "beforePatchRowNumber": 105,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        else:"
            },
            "66": {
                "beforePatchRowNumber": 106,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            return unicode(title, 'utf-8', 'ignore')"
            },
            "67": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 116,
                "PatchRowcode": "+        return escape(safe_unicode(title))"
            },
            "68": {
                "beforePatchRowNumber": 107,
                "afterPatchRowNumber": 117,
                "PatchRowcode": " "
            },
            "69": {
                "beforePatchRowNumber": 108,
                "afterPatchRowNumber": 118,
                "PatchRowcode": " "
            },
            "70": {
                "beforePatchRowNumber": 109,
                "afterPatchRowNumber": 119,
                "PatchRowcode": " class IconColumn(LinkColumn):"
            },
            "71": {
                "beforePatchRowNumber": 110,
                "afterPatchRowNumber": 120,
                "PatchRowcode": "     grok.baseclass()"
            },
            "72": {
                "beforePatchRowNumber": 111,
                "afterPatchRowNumber": 121,
                "PatchRowcode": " "
            },
            "73": {
                "beforePatchRowNumber": 112,
                "afterPatchRowNumber": 122,
                "PatchRowcode": "     def getLinkContent(self, item):"
            },
            "74": {
                "beforePatchRowNumber": 113,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        content = super(IconColumn, self).getLinkContent(item)"
            },
            "75": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 123,
                "PatchRowcode": "+        content = super(IconColumn, self).getLinkContent(item)  # escaped"
            },
            "76": {
                "beforePatchRowNumber": 114,
                "afterPatchRowNumber": 124,
                "PatchRowcode": "         return u\"\"\"<img title=\"%s\" src=\"%s\" />\"\"\" % ("
            },
            "77": {
                "beforePatchRowNumber": 115,
                "afterPatchRowNumber": 125,
                "PatchRowcode": "             content,"
            },
            "78": {
                "beforePatchRowNumber": 116,
                "afterPatchRowNumber": 126,
                "PatchRowcode": "             '%s/%s' % (self.table.portal_url, self.iconName))"
            }
        },
        "frontPatchFile": [
            "import os.path",
            "import Missing",
            "from Acquisition import aq_base",
            "from AccessControl import getSecurityManager",
            "from Products.CMFCore.utils import getToolByName",
            "from five import grok",
            "from z3c.table import interfaces",
            "from zope.component import getMultiAdapter",
            "from zope.i18nmessageid import MessageFactory",
            "from zope.i18n import translate",
            "import z3c.table.table",
            "import z3c.table.column",
            "from Products.CMFCore.WorkflowCore import WorkflowException",
            "import plone.api",
            "",
            "from collective.dms.basecontent import _",
            "",
            "PMF = MessageFactory('plone')",
            "",
            "grok.templatedir('templates')",
            "",
            "",
            "class Column(z3c.table.column.Column, grok.MultiAdapter):",
            "    grok.baseclass()",
            "    grok.provides(interfaces.IColumn)",
            "",
            "",
            "def get_value(item, attribute, default=None):",
            "    try:",
            "        value = getattr(aq_base(item), attribute)",
            "        if value is Missing.Value:",
            "            return default",
            "    except AttributeError:",
            "        obj = item.getObject()",
            "        value = getattr(obj, attribute, default)",
            "",
            "    if callable(value):",
            "        value = value()",
            "",
            "    return value",
            "",
            "",
            "class DateColumn(Column):",
            "    grok.baseclass()",
            "    attribute = NotImplemented",
            "",
            "    def renderCell(self, item):",
            "        value = get_value(item, self.attribute)",
            "        return self.table.format_date(value)",
            "",
            "",
            "class DateTimeColumn(Column):",
            "    grok.baseclass()",
            "    attribute = NotImplemented",
            "",
            "    def renderCell(self, item):",
            "        value = get_value(item, self.attribute)",
            "        return self.table.format_date(value, long_format=True)",
            "",
            "",
            "class PrincipalColumn(Column):",
            "    grok.baseclass()",
            "    attribute = NotImplemented",
            "",
            "    def renderCell(self, item):",
            "        value = get_value(item, self.attribute, default=())",
            "",
            "        if not isinstance(value, (list, tuple)):",
            "            value = (value,)",
            "",
            "        gtool = getToolByName(plone.api.portal.get(), 'portal_groups')",
            "        mtool = getToolByName(plone.api.portal.get(), 'portal_membership')",
            "        principals = []",
            "        for principal_id in value:",
            "            user = mtool.getMemberById(principal_id)",
            "            if user is not None:",
            "                principals.append(user.getProperty('fullname', None) or user.getId())",
            "            else:",
            "                group = gtool.getGroupById(principal_id)",
            "                if group is not None:",
            "                    principals.append(group.getProperty('title', None) or group.getId())",
            "",
            "        return ', '.join(principals).decode('utf-8')",
            "",
            "",
            "class LinkColumn(z3c.table.column.LinkColumn, Column):",
            "    grok.baseclass()",
            "",
            "    def getLinkURL(self, item):",
            "        \"\"\"Setup link url.\"\"\"",
            "        if self.linkName is not None:",
            "            return '%s/%s' % (item.getURL(), self.linkName)",
            "        return item.getURL()",
            "",
            "",
            "class TitleColumn(LinkColumn):",
            "    grok.baseclass()",
            "    header = PMF(\"Title\")",
            "    weight = 10",
            "",
            "    def getLinkContent(self, item):",
            "        title = get_value(item, 'Title')",
            "        if isinstance(title, unicode):",
            "            return title",
            "        else:",
            "            return unicode(title, 'utf-8', 'ignore')",
            "",
            "",
            "class IconColumn(LinkColumn):",
            "    grok.baseclass()",
            "",
            "    def getLinkContent(self, item):",
            "        content = super(IconColumn, self).getLinkContent(item)",
            "        return u\"\"\"<img title=\"%s\" src=\"%s\" />\"\"\" % (",
            "            content,",
            "            '%s/%s' % (self.table.portal_url, self.iconName))",
            "",
            "",
            "class DeleteColumn(IconColumn):",
            "    grok.baseclass()",
            "    header = u\"\"",
            "    weight = 9",
            "    linkName = \"delete_confirmation\"",
            "    linkContent = PMF('Delete')",
            "    linkCSS = 'edm-delete-popup'",
            "    iconName = \"delete_icon.png\"",
            "    linkContent = PMF(u\"Delete\")",
            "",
            "    def actionAvailable(self, item):",
            "        obj = item.getObject()",
            "        sm = getSecurityManager()",
            "        return sm.checkPermission('Delete objects', obj)",
            "",
            "    def renderCell(self, item):",
            "        if not self.actionAvailable(item):",
            "            return u\"\"",
            "",
            "        return super(DeleteColumn, self).renderCell(item)",
            "",
            "",
            "class DownloadColumn(IconColumn):",
            "    grok.baseclass()",
            "    header = u\"\"",
            "    weight = 1",
            "    linkName = \"@@download\"",
            "    iconName = \"download_icon.png\"",
            "    linkContent = _(u\"Download file\")",
            "",
            "",
            "class ExternalEditColumn(IconColumn):",
            "    grok.baseclass()",
            "    header = u\"\"",
            "    weight = 3",
            "    linkName = \"@@external_edit\"",
            "    iconName = \"extedit_icon.png\"",
            "    linkContent = PMF(u\"Edit with external application\")",
            "",
            "    def actionAvailable(self, item):",
            "        obj = item.getObject()",
            "        sm = getSecurityManager()",
            "        if not sm.checkPermission('Modify portal content', obj):",
            "            return False",
            "",
            "        if obj.file is None:",
            "            return False",
            "",
            "        ext = os.path.splitext(obj.file.filename)[-1].lower()",
            "        if ext in (u'.pdf', u'.jpg', '.jpeg'):",
            "            return False",
            "",
            "        view = getMultiAdapter((obj, self.request), name='externalEditorEnabled')",
            "        if not view.available():",
            "            return False",
            "",
            "        return True",
            "",
            "    def renderCell(self, item):",
            "        if not self.actionAvailable(item):",
            "            return u\"\"",
            "",
            "        return super(ExternalEditColumn, self).renderCell(item)",
            "",
            "",
            "class EditColumn(IconColumn):",
            "    grok.baseclass()",
            "    header = u\"\"",
            "    weight = 2",
            "    linkName = \"edit\"",
            "    iconName = \"++resource++fade_edit.png\"",
            "    linkContent = PMF(u\"Edit\")",
            "    linkCSS = 'overlay-form-reload'",
            "",
            "    def actionAvailable(self, item):",
            "        obj = item.getObject()",
            "        sm = getSecurityManager()",
            "        return sm.checkPermission('Modify portal content', obj)",
            "",
            "    def renderCell(self, item):",
            "        if not self.actionAvailable(item):",
            "            return u\"\"",
            "",
            "        return super(EditColumn, self).renderCell(item)",
            "",
            "",
            "class StateColumn(Column):",
            "    grok.baseclass()",
            "    header = PMF(u\"State\")",
            "    weight = 50",
            "",
            "    def renderCell(self, item):",
            "        try:",
            "            wtool = self.table.wtool",
            "            portal_type = get_value(item, 'portal_type')",
            "            review_state = get_value(item, 'review_state')",
            "            if not review_state:",
            "                return u\"\"",
            "            state_title = wtool.getTitleForStateOnType(review_state,",
            "                                                       portal_type)",
            "            return translate(PMF(state_title), context=self.request)",
            "        except WorkflowException:",
            "            return u\"\"",
            "",
            "",
            "class LabelColumn(Column):",
            "    grok.baseclass()",
            "    attribute = NotImplemented",
            "",
            "    def renderCell(self, item):",
            "        value = get_value(item, self.attribute)",
            "        if value is None:",
            "            value = ''",
            "        return value"
        ],
        "afterPatchFile": [
            "from AccessControl import getSecurityManager",
            "from Acquisition import aq_base",
            "from collective.dms.basecontent import _",
            "from five import grok",
            "from html import escape",
            "from Products.CMFCore.utils import getToolByName",
            "from Products.CMFCore.WorkflowCore import WorkflowException",
            "from Products.CMFPlone.utils import safe_unicode",
            "from z3c.table import interfaces",
            "from zope.component import getMultiAdapter",
            "from zope.i18n import translate",
            "from zope.i18nmessageid import MessageFactory",
            "",
            "import Missing",
            "import os.path",
            "import plone.api",
            "import z3c.table.column",
            "import z3c.table.table",
            "",
            "",
            "PMF = MessageFactory('plone')",
            "",
            "grok.templatedir('templates')",
            "",
            "",
            "class Column(z3c.table.column.Column, grok.MultiAdapter):",
            "    grok.baseclass()",
            "    grok.provides(interfaces.IColumn)",
            "",
            "",
            "def get_value(item, attribute, default=None):",
            "    try:",
            "        value = getattr(aq_base(item), attribute)",
            "        if value is Missing.Value:",
            "            return default",
            "    except AttributeError:",
            "        obj = item.getObject()",
            "        value = getattr(obj, attribute, default)",
            "",
            "    if callable(value):",
            "        value = value()",
            "",
            "    return value",
            "",
            "",
            "class DateColumn(Column):",
            "    grok.baseclass()",
            "    attribute = NotImplemented",
            "",
            "    def renderCell(self, item):",
            "        value = get_value(item, self.attribute)",
            "        return self.table.format_date(value)",
            "",
            "",
            "class DateTimeColumn(Column):",
            "    grok.baseclass()",
            "    attribute = NotImplemented",
            "",
            "    def renderCell(self, item):",
            "        value = get_value(item, self.attribute)",
            "        return self.table.format_date(value, long_format=True)",
            "",
            "",
            "class PrincipalColumn(Column):",
            "    grok.baseclass()",
            "    attribute = NotImplemented",
            "",
            "    def renderCell(self, item):",
            "        value = get_value(item, self.attribute, default=())",
            "",
            "        if not isinstance(value, (list, tuple)):",
            "            value = (value,)",
            "",
            "        gtool = getToolByName(plone.api.portal.get(), 'portal_groups')",
            "        mtool = getToolByName(plone.api.portal.get(), 'portal_membership')",
            "        principals = []",
            "        for principal_id in value:",
            "            user = mtool.getMemberById(principal_id)",
            "            if user is not None:",
            "                principals.append(escape(user.getProperty('fullname', None)) or user.getId())",
            "            else:",
            "                group = gtool.getGroupById(principal_id)",
            "                if group is not None:",
            "                    principals.append(escape(group.getProperty('title', None)) or group.getId())",
            "",
            "        return ', '.join(principals).decode('utf-8')",
            "",
            "",
            "class LinkColumn(z3c.table.column.LinkColumn, Column):",
            "    grok.baseclass()",
            "",
            "    def getLinkURL(self, item):",
            "        \"\"\"Setup link url.\"\"\"",
            "        if self.linkName is not None:",
            "            return '%s/%s' % (item.getURL(), self.linkName)",
            "        return item.getURL()",
            "",
            "    def renderCell(self, item):",
            "        # setup a tag",
            "        return '<a href=\"%s\"%s%s%s>%s</a>' % (",
            "            self.getLinkURL(item),  # originally escaped",
            "            self.getLinkTarget(item),",
            "            self.getLinkCSS(item),",
            "            self.getLinkTitle(item),",
            "            self.getLinkContent(item),  # originally escaped",
            "        )",
            "",
            "",
            "class TitleColumn(LinkColumn):",
            "    grok.baseclass()",
            "    header = PMF(\"Title\")",
            "    weight = 10",
            "",
            "    def getLinkContent(self, item):",
            "        title = get_value(item, 'Title')",
            "        return escape(safe_unicode(title))",
            "",
            "",
            "class IconColumn(LinkColumn):",
            "    grok.baseclass()",
            "",
            "    def getLinkContent(self, item):",
            "        content = super(IconColumn, self).getLinkContent(item)  # escaped",
            "        return u\"\"\"<img title=\"%s\" src=\"%s\" />\"\"\" % (",
            "            content,",
            "            '%s/%s' % (self.table.portal_url, self.iconName))",
            "",
            "",
            "class DeleteColumn(IconColumn):",
            "    grok.baseclass()",
            "    header = u\"\"",
            "    weight = 9",
            "    linkName = \"delete_confirmation\"",
            "    linkContent = PMF('Delete')",
            "    linkCSS = 'edm-delete-popup'",
            "    iconName = \"delete_icon.png\"",
            "    linkContent = PMF(u\"Delete\")",
            "",
            "    def actionAvailable(self, item):",
            "        obj = item.getObject()",
            "        sm = getSecurityManager()",
            "        return sm.checkPermission('Delete objects', obj)",
            "",
            "    def renderCell(self, item):",
            "        if not self.actionAvailable(item):",
            "            return u\"\"",
            "",
            "        return super(DeleteColumn, self).renderCell(item)",
            "",
            "",
            "class DownloadColumn(IconColumn):",
            "    grok.baseclass()",
            "    header = u\"\"",
            "    weight = 1",
            "    linkName = \"@@download\"",
            "    iconName = \"download_icon.png\"",
            "    linkContent = _(u\"Download file\")",
            "",
            "",
            "class ExternalEditColumn(IconColumn):",
            "    grok.baseclass()",
            "    header = u\"\"",
            "    weight = 3",
            "    linkName = \"@@external_edit\"",
            "    iconName = \"extedit_icon.png\"",
            "    linkContent = PMF(u\"Edit with external application\")",
            "",
            "    def actionAvailable(self, item):",
            "        obj = item.getObject()",
            "        sm = getSecurityManager()",
            "        if not sm.checkPermission('Modify portal content', obj):",
            "            return False",
            "",
            "        if obj.file is None:",
            "            return False",
            "",
            "        ext = os.path.splitext(obj.file.filename)[-1].lower()",
            "        if ext in (u'.pdf', u'.jpg', '.jpeg'):",
            "            return False",
            "",
            "        view = getMultiAdapter((obj, self.request), name='externalEditorEnabled')",
            "        if not view.available():",
            "            return False",
            "",
            "        return True",
            "",
            "    def renderCell(self, item):",
            "        if not self.actionAvailable(item):",
            "            return u\"\"",
            "",
            "        return super(ExternalEditColumn, self).renderCell(item)",
            "",
            "",
            "class EditColumn(IconColumn):",
            "    grok.baseclass()",
            "    header = u\"\"",
            "    weight = 2",
            "    linkName = \"edit\"",
            "    iconName = \"++resource++fade_edit.png\"",
            "    linkContent = PMF(u\"Edit\")",
            "    linkCSS = 'overlay-form-reload'",
            "",
            "    def actionAvailable(self, item):",
            "        obj = item.getObject()",
            "        sm = getSecurityManager()",
            "        return sm.checkPermission('Modify portal content', obj)",
            "",
            "    def renderCell(self, item):",
            "        if not self.actionAvailable(item):",
            "            return u\"\"",
            "",
            "        return super(EditColumn, self).renderCell(item)",
            "",
            "",
            "class StateColumn(Column):",
            "    grok.baseclass()",
            "    header = PMF(u\"State\")",
            "    weight = 50",
            "",
            "    def renderCell(self, item):",
            "        try:",
            "            wtool = self.table.wtool",
            "            portal_type = get_value(item, 'portal_type')",
            "            review_state = get_value(item, 'review_state')",
            "            if not review_state:",
            "                return u\"\"",
            "            state_title = wtool.getTitleForStateOnType(review_state,",
            "                                                       portal_type)",
            "            return translate(PMF(state_title), context=self.request)",
            "        except WorkflowException:",
            "            return u\"\"",
            "",
            "",
            "class LabelColumn(Column):",
            "    grok.baseclass()",
            "    attribute = NotImplemented",
            "",
            "    def renderCell(self, item):",
            "        value = get_value(item, self.attribute)",
            "        if value is None:",
            "            value = ''",
            "        return value"
        ],
        "action": [
            "1",
            "1",
            "1",
            "0",
            "2",
            "2",
            "2",
            "0",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "2",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "2",
            "2",
            "0",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "1": [],
            "2": [],
            "3": [],
            "5": [],
            "9": [],
            "11": [],
            "12": [],
            "13": [],
            "16": [],
            "77": [
                "PrincipalColumn",
                "renderCell"
            ],
            "81": [
                "PrincipalColumn",
                "renderCell"
            ],
            "103": [
                "TitleColumn",
                "getLinkContent"
            ],
            "104": [
                "TitleColumn",
                "getLinkContent"
            ],
            "105": [
                "TitleColumn",
                "getLinkContent"
            ],
            "106": [
                "TitleColumn",
                "getLinkContent"
            ],
            "113": [
                "IconColumn",
                "getLinkContent"
            ]
        },
        "addLocation": []
    }
}