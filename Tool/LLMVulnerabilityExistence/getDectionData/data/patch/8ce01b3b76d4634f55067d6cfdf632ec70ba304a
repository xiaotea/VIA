{
    "scrapy/downloadermiddlewares/redirect.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 4,
                "afterPatchRowNumber": 4,
                "PatchRowcode": " from w3lib.url import safe_url_string"
            },
            "1": {
                "beforePatchRowNumber": 5,
                "afterPatchRowNumber": 5,
                "PatchRowcode": " "
            },
            "2": {
                "beforePatchRowNumber": 6,
                "afterPatchRowNumber": 6,
                "PatchRowcode": " from scrapy.http import HtmlResponse"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 7,
                "PatchRowcode": "+from scrapy.utils.httpobj import urlparse_cached"
            },
            "4": {
                "beforePatchRowNumber": 7,
                "afterPatchRowNumber": 8,
                "PatchRowcode": " from scrapy.utils.response import get_meta_refresh"
            },
            "5": {
                "beforePatchRowNumber": 8,
                "afterPatchRowNumber": 9,
                "PatchRowcode": " from scrapy.exceptions import IgnoreRequest, NotConfigured"
            },
            "6": {
                "beforePatchRowNumber": 9,
                "afterPatchRowNumber": 10,
                "PatchRowcode": " "
            },
            "7": {
                "beforePatchRowNumber": 10,
                "afterPatchRowNumber": 11,
                "PatchRowcode": " "
            },
            "8": {
                "beforePatchRowNumber": 11,
                "afterPatchRowNumber": 12,
                "PatchRowcode": " logger = logging.getLogger(__name__)"
            },
            "9": {
                "beforePatchRowNumber": 12,
                "afterPatchRowNumber": 13,
                "PatchRowcode": " "
            },
            "10": {
                "beforePatchRowNumber": 13,
                "afterPatchRowNumber": 14,
                "PatchRowcode": " "
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 15,
                "PatchRowcode": "+def _build_redirect_request(source_request, *, url, method=None, body=None):"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 16,
                "PatchRowcode": "+    redirect_request = source_request.replace("
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 17,
                "PatchRowcode": "+        url=url,"
            },
            "14": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 18,
                "PatchRowcode": "+        method=method,"
            },
            "15": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 19,
                "PatchRowcode": "+        body=body,"
            },
            "16": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 20,
                "PatchRowcode": "+        cookies=None,"
            },
            "17": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 21,
                "PatchRowcode": "+    )"
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 22,
                "PatchRowcode": "+    if 'Cookie' in redirect_request.headers:"
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 23,
                "PatchRowcode": "+        source_request_netloc = urlparse_cached(source_request).netloc"
            },
            "20": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 24,
                "PatchRowcode": "+        redirect_request_netloc = urlparse_cached(redirect_request).netloc"
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 25,
                "PatchRowcode": "+        if source_request_netloc != redirect_request_netloc:"
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 26,
                "PatchRowcode": "+            del redirect_request.headers['Cookie']"
            },
            "23": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 27,
                "PatchRowcode": "+    return redirect_request"
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 28,
                "PatchRowcode": "+"
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 29,
                "PatchRowcode": "+"
            },
            "26": {
                "beforePatchRowNumber": 14,
                "afterPatchRowNumber": 30,
                "PatchRowcode": " class BaseRedirectMiddleware:"
            },
            "27": {
                "beforePatchRowNumber": 15,
                "afterPatchRowNumber": 31,
                "PatchRowcode": " "
            },
            "28": {
                "beforePatchRowNumber": 16,
                "afterPatchRowNumber": 32,
                "PatchRowcode": "     enabled_setting = 'REDIRECT_ENABLED'"
            },
            "29": {
                "beforePatchRowNumber": 47,
                "afterPatchRowNumber": 63,
                "PatchRowcode": "             raise IgnoreRequest(\"max redirections reached\")"
            },
            "30": {
                "beforePatchRowNumber": 48,
                "afterPatchRowNumber": 64,
                "PatchRowcode": " "
            },
            "31": {
                "beforePatchRowNumber": 49,
                "afterPatchRowNumber": 65,
                "PatchRowcode": "     def _redirect_request_using_get(self, request, redirect_url):"
            },
            "32": {
                "beforePatchRowNumber": 50,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        redirected = request.replace(url=redirect_url, method='GET', body='')"
            },
            "33": {
                "beforePatchRowNumber": 51,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        redirected.headers.pop('Content-Type', None)"
            },
            "34": {
                "beforePatchRowNumber": 52,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        redirected.headers.pop('Content-Length', None)"
            },
            "35": {
                "beforePatchRowNumber": 53,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        return redirected"
            },
            "36": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 66,
                "PatchRowcode": "+        redirect_request = _build_redirect_request("
            },
            "37": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 67,
                "PatchRowcode": "+            request,"
            },
            "38": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 68,
                "PatchRowcode": "+            url=redirect_url,"
            },
            "39": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 69,
                "PatchRowcode": "+            method='GET',"
            },
            "40": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 70,
                "PatchRowcode": "+            body='',"
            },
            "41": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 71,
                "PatchRowcode": "+        )"
            },
            "42": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 72,
                "PatchRowcode": "+        redirect_request.headers.pop('Content-Type', None)"
            },
            "43": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 73,
                "PatchRowcode": "+        redirect_request.headers.pop('Content-Length', None)"
            },
            "44": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 74,
                "PatchRowcode": "+        return redirect_request"
            },
            "45": {
                "beforePatchRowNumber": 54,
                "afterPatchRowNumber": 75,
                "PatchRowcode": " "
            },
            "46": {
                "beforePatchRowNumber": 55,
                "afterPatchRowNumber": 76,
                "PatchRowcode": " "
            },
            "47": {
                "beforePatchRowNumber": 56,
                "afterPatchRowNumber": 77,
                "PatchRowcode": " class RedirectMiddleware(BaseRedirectMiddleware):"
            },
            "48": {
                "beforePatchRowNumber": 80,
                "afterPatchRowNumber": 101,
                "PatchRowcode": "         redirected_url = urljoin(request.url, location)"
            },
            "49": {
                "beforePatchRowNumber": 81,
                "afterPatchRowNumber": 102,
                "PatchRowcode": " "
            },
            "50": {
                "beforePatchRowNumber": 82,
                "afterPatchRowNumber": 103,
                "PatchRowcode": "         if response.status in (301, 307, 308) or request.method == 'HEAD':"
            },
            "51": {
                "beforePatchRowNumber": 83,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            redirected = request.replace(url=redirected_url)"
            },
            "52": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 104,
                "PatchRowcode": "+            redirected = _build_redirect_request(request, url=redirected_url)"
            },
            "53": {
                "beforePatchRowNumber": 84,
                "afterPatchRowNumber": 105,
                "PatchRowcode": "             return self._redirect(redirected, request, spider, response.status)"
            },
            "54": {
                "beforePatchRowNumber": 85,
                "afterPatchRowNumber": 106,
                "PatchRowcode": " "
            },
            "55": {
                "beforePatchRowNumber": 86,
                "afterPatchRowNumber": 107,
                "PatchRowcode": "         redirected = self._redirect_request_using_get(request, redirected_url)"
            }
        },
        "frontPatchFile": [
            "import logging",
            "from urllib.parse import urljoin, urlparse",
            "",
            "from w3lib.url import safe_url_string",
            "",
            "from scrapy.http import HtmlResponse",
            "from scrapy.utils.response import get_meta_refresh",
            "from scrapy.exceptions import IgnoreRequest, NotConfigured",
            "",
            "",
            "logger = logging.getLogger(__name__)",
            "",
            "",
            "class BaseRedirectMiddleware:",
            "",
            "    enabled_setting = 'REDIRECT_ENABLED'",
            "",
            "    def __init__(self, settings):",
            "        if not settings.getbool(self.enabled_setting):",
            "            raise NotConfigured",
            "",
            "        self.max_redirect_times = settings.getint('REDIRECT_MAX_TIMES')",
            "        self.priority_adjust = settings.getint('REDIRECT_PRIORITY_ADJUST')",
            "",
            "    @classmethod",
            "    def from_crawler(cls, crawler):",
            "        return cls(crawler.settings)",
            "",
            "    def _redirect(self, redirected, request, spider, reason):",
            "        ttl = request.meta.setdefault('redirect_ttl', self.max_redirect_times)",
            "        redirects = request.meta.get('redirect_times', 0) + 1",
            "",
            "        if ttl and redirects <= self.max_redirect_times:",
            "            redirected.meta['redirect_times'] = redirects",
            "            redirected.meta['redirect_ttl'] = ttl - 1",
            "            redirected.meta['redirect_urls'] = request.meta.get('redirect_urls', []) + [request.url]",
            "            redirected.meta['redirect_reasons'] = request.meta.get('redirect_reasons', []) + [reason]",
            "            redirected.dont_filter = request.dont_filter",
            "            redirected.priority = request.priority + self.priority_adjust",
            "            logger.debug(\"Redirecting (%(reason)s) to %(redirected)s from %(request)s\",",
            "                         {'reason': reason, 'redirected': redirected, 'request': request},",
            "                         extra={'spider': spider})",
            "            return redirected",
            "        else:",
            "            logger.debug(\"Discarding %(request)s: max redirections reached\",",
            "                         {'request': request}, extra={'spider': spider})",
            "            raise IgnoreRequest(\"max redirections reached\")",
            "",
            "    def _redirect_request_using_get(self, request, redirect_url):",
            "        redirected = request.replace(url=redirect_url, method='GET', body='')",
            "        redirected.headers.pop('Content-Type', None)",
            "        redirected.headers.pop('Content-Length', None)",
            "        return redirected",
            "",
            "",
            "class RedirectMiddleware(BaseRedirectMiddleware):",
            "    \"\"\"",
            "    Handle redirection of requests based on response status",
            "    and meta-refresh html tag.",
            "    \"\"\"",
            "",
            "    def process_response(self, request, response, spider):",
            "        if (",
            "            request.meta.get('dont_redirect', False)",
            "            or response.status in getattr(spider, 'handle_httpstatus_list', [])",
            "            or response.status in request.meta.get('handle_httpstatus_list', [])",
            "            or request.meta.get('handle_httpstatus_all', False)",
            "        ):",
            "            return response",
            "",
            "        allowed_status = (301, 302, 303, 307, 308)",
            "        if 'Location' not in response.headers or response.status not in allowed_status:",
            "            return response",
            "",
            "        location = safe_url_string(response.headers['Location'])",
            "        if response.headers['Location'].startswith(b'//'):",
            "            request_scheme = urlparse(request.url).scheme",
            "            location = request_scheme + '://' + location.lstrip('/')",
            "",
            "        redirected_url = urljoin(request.url, location)",
            "",
            "        if response.status in (301, 307, 308) or request.method == 'HEAD':",
            "            redirected = request.replace(url=redirected_url)",
            "            return self._redirect(redirected, request, spider, response.status)",
            "",
            "        redirected = self._redirect_request_using_get(request, redirected_url)",
            "        return self._redirect(redirected, request, spider, response.status)",
            "",
            "",
            "class MetaRefreshMiddleware(BaseRedirectMiddleware):",
            "",
            "    enabled_setting = 'METAREFRESH_ENABLED'",
            "",
            "    def __init__(self, settings):",
            "        super().__init__(settings)",
            "        self._ignore_tags = settings.getlist('METAREFRESH_IGNORE_TAGS')",
            "        self._maxdelay = settings.getint('METAREFRESH_MAXDELAY')",
            "",
            "    def process_response(self, request, response, spider):",
            "        if (",
            "            request.meta.get('dont_redirect', False)",
            "            or request.method == 'HEAD'",
            "            or not isinstance(response, HtmlResponse)",
            "        ):",
            "            return response",
            "",
            "        interval, url = get_meta_refresh(response,",
            "                                         ignore_tags=self._ignore_tags)",
            "        if url and interval < self._maxdelay:",
            "            redirected = self._redirect_request_using_get(request, url)",
            "            return self._redirect(redirected, request, spider, 'meta refresh')",
            "",
            "        return response"
        ],
        "afterPatchFile": [
            "import logging",
            "from urllib.parse import urljoin, urlparse",
            "",
            "from w3lib.url import safe_url_string",
            "",
            "from scrapy.http import HtmlResponse",
            "from scrapy.utils.httpobj import urlparse_cached",
            "from scrapy.utils.response import get_meta_refresh",
            "from scrapy.exceptions import IgnoreRequest, NotConfigured",
            "",
            "",
            "logger = logging.getLogger(__name__)",
            "",
            "",
            "def _build_redirect_request(source_request, *, url, method=None, body=None):",
            "    redirect_request = source_request.replace(",
            "        url=url,",
            "        method=method,",
            "        body=body,",
            "        cookies=None,",
            "    )",
            "    if 'Cookie' in redirect_request.headers:",
            "        source_request_netloc = urlparse_cached(source_request).netloc",
            "        redirect_request_netloc = urlparse_cached(redirect_request).netloc",
            "        if source_request_netloc != redirect_request_netloc:",
            "            del redirect_request.headers['Cookie']",
            "    return redirect_request",
            "",
            "",
            "class BaseRedirectMiddleware:",
            "",
            "    enabled_setting = 'REDIRECT_ENABLED'",
            "",
            "    def __init__(self, settings):",
            "        if not settings.getbool(self.enabled_setting):",
            "            raise NotConfigured",
            "",
            "        self.max_redirect_times = settings.getint('REDIRECT_MAX_TIMES')",
            "        self.priority_adjust = settings.getint('REDIRECT_PRIORITY_ADJUST')",
            "",
            "    @classmethod",
            "    def from_crawler(cls, crawler):",
            "        return cls(crawler.settings)",
            "",
            "    def _redirect(self, redirected, request, spider, reason):",
            "        ttl = request.meta.setdefault('redirect_ttl', self.max_redirect_times)",
            "        redirects = request.meta.get('redirect_times', 0) + 1",
            "",
            "        if ttl and redirects <= self.max_redirect_times:",
            "            redirected.meta['redirect_times'] = redirects",
            "            redirected.meta['redirect_ttl'] = ttl - 1",
            "            redirected.meta['redirect_urls'] = request.meta.get('redirect_urls', []) + [request.url]",
            "            redirected.meta['redirect_reasons'] = request.meta.get('redirect_reasons', []) + [reason]",
            "            redirected.dont_filter = request.dont_filter",
            "            redirected.priority = request.priority + self.priority_adjust",
            "            logger.debug(\"Redirecting (%(reason)s) to %(redirected)s from %(request)s\",",
            "                         {'reason': reason, 'redirected': redirected, 'request': request},",
            "                         extra={'spider': spider})",
            "            return redirected",
            "        else:",
            "            logger.debug(\"Discarding %(request)s: max redirections reached\",",
            "                         {'request': request}, extra={'spider': spider})",
            "            raise IgnoreRequest(\"max redirections reached\")",
            "",
            "    def _redirect_request_using_get(self, request, redirect_url):",
            "        redirect_request = _build_redirect_request(",
            "            request,",
            "            url=redirect_url,",
            "            method='GET',",
            "            body='',",
            "        )",
            "        redirect_request.headers.pop('Content-Type', None)",
            "        redirect_request.headers.pop('Content-Length', None)",
            "        return redirect_request",
            "",
            "",
            "class RedirectMiddleware(BaseRedirectMiddleware):",
            "    \"\"\"",
            "    Handle redirection of requests based on response status",
            "    and meta-refresh html tag.",
            "    \"\"\"",
            "",
            "    def process_response(self, request, response, spider):",
            "        if (",
            "            request.meta.get('dont_redirect', False)",
            "            or response.status in getattr(spider, 'handle_httpstatus_list', [])",
            "            or response.status in request.meta.get('handle_httpstatus_list', [])",
            "            or request.meta.get('handle_httpstatus_all', False)",
            "        ):",
            "            return response",
            "",
            "        allowed_status = (301, 302, 303, 307, 308)",
            "        if 'Location' not in response.headers or response.status not in allowed_status:",
            "            return response",
            "",
            "        location = safe_url_string(response.headers['Location'])",
            "        if response.headers['Location'].startswith(b'//'):",
            "            request_scheme = urlparse(request.url).scheme",
            "            location = request_scheme + '://' + location.lstrip('/')",
            "",
            "        redirected_url = urljoin(request.url, location)",
            "",
            "        if response.status in (301, 307, 308) or request.method == 'HEAD':",
            "            redirected = _build_redirect_request(request, url=redirected_url)",
            "            return self._redirect(redirected, request, spider, response.status)",
            "",
            "        redirected = self._redirect_request_using_get(request, redirected_url)",
            "        return self._redirect(redirected, request, spider, response.status)",
            "",
            "",
            "class MetaRefreshMiddleware(BaseRedirectMiddleware):",
            "",
            "    enabled_setting = 'METAREFRESH_ENABLED'",
            "",
            "    def __init__(self, settings):",
            "        super().__init__(settings)",
            "        self._ignore_tags = settings.getlist('METAREFRESH_IGNORE_TAGS')",
            "        self._maxdelay = settings.getint('METAREFRESH_MAXDELAY')",
            "",
            "    def process_response(self, request, response, spider):",
            "        if (",
            "            request.meta.get('dont_redirect', False)",
            "            or request.method == 'HEAD'",
            "            or not isinstance(response, HtmlResponse)",
            "        ):",
            "            return response",
            "",
            "        interval, url = get_meta_refresh(response,",
            "                                         ignore_tags=self._ignore_tags)",
            "        if url and interval < self._maxdelay:",
            "            redirected = self._redirect_request_using_get(request, url)",
            "            return self._redirect(redirected, request, spider, 'meta refresh')",
            "",
            "        return response"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "50": [
                "BaseRedirectMiddleware",
                "_redirect_request_using_get"
            ],
            "51": [
                "BaseRedirectMiddleware",
                "_redirect_request_using_get"
            ],
            "52": [
                "BaseRedirectMiddleware",
                "_redirect_request_using_get"
            ],
            "53": [
                "BaseRedirectMiddleware",
                "_redirect_request_using_get"
            ],
            "83": [
                "RedirectMiddleware",
                "process_response"
            ]
        },
        "addLocation": [
            "scrapy.downloadermiddlewares.redirect.RedirectMiddleware.process_response",
            "applications.admin.controllers.default.git_pull",
            "scrapy.downloadermiddlewares.redirect.BaseRedirectMiddleware._redirect_request_using_get"
        ]
    }
}