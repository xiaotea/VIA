{
    "rdiffweb/controller/dispatch.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 22,
                "afterPatchRowNumber": 22,
                "PatchRowcode": " \"\"\""
            },
            "1": {
                "beforePatchRowNumber": 23,
                "afterPatchRowNumber": 23,
                "PatchRowcode": " "
            },
            "2": {
                "beforePatchRowNumber": 24,
                "afterPatchRowNumber": 24,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": 25,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-import os"
            },
            "4": {
                "beforePatchRowNumber": 26,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "5": {
                "beforePatchRowNumber": 27,
                "afterPatchRowNumber": 25,
                "PatchRowcode": " import cherrypy"
            },
            "6": {
                "beforePatchRowNumber": 28,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-from cherrypy.lib.static import mimetypes, serve_file"
            },
            "7": {
                "beforePatchRowNumber": 29,
                "afterPatchRowNumber": 26,
                "PatchRowcode": " "
            },
            "8": {
                "beforePatchRowNumber": 30,
                "afterPatchRowNumber": 27,
                "PatchRowcode": " from rdiffweb.core.rdw_helpers import unquote_url"
            },
            "9": {
                "beforePatchRowNumber": 31,
                "afterPatchRowNumber": 28,
                "PatchRowcode": " "
            },
            "10": {
                "beforePatchRowNumber": 96,
                "afterPatchRowNumber": 93,
                "PatchRowcode": "     return decorated"
            },
            "11": {
                "beforePatchRowNumber": 97,
                "afterPatchRowNumber": 94,
                "PatchRowcode": " "
            },
            "12": {
                "beforePatchRowNumber": 98,
                "afterPatchRowNumber": 95,
                "PatchRowcode": " "
            },
            "13": {
                "beforePatchRowNumber": 99,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-def static(path):"
            },
            "14": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 96,
                "PatchRowcode": "+def staticdir(path):"
            },
            "15": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 97,
                "PatchRowcode": "+    \"\"\""
            },
            "16": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 98,
                "PatchRowcode": "+    Create a page handler to serve static directory."
            },
            "17": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 99,
                "PatchRowcode": "+    \"\"\""
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 100,
                "PatchRowcode": "+"
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 101,
                "PatchRowcode": "+    @cherrypy.expose"
            },
            "20": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 102,
                "PatchRowcode": "+    @cherrypy.tools.auth_form(on=False)"
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 103,
                "PatchRowcode": "+    @cherrypy.tools.sessions(on=False)"
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 104,
                "PatchRowcode": "+    @cherrypy.tools.secure_headers(on=False)"
            },
            "23": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 105,
                "PatchRowcode": "+    @cherrypy.tools.staticdir(section=\"\", dir=path)"
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 106,
                "PatchRowcode": "+    def handler(*args, **kwargs):"
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 107,
                "PatchRowcode": "+        return None"
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 108,
                "PatchRowcode": "+"
            },
            "27": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 109,
                "PatchRowcode": "+    return handler"
            },
            "28": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 110,
                "PatchRowcode": "+"
            },
            "29": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 111,
                "PatchRowcode": "+"
            },
            "30": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 112,
                "PatchRowcode": "+def staticfile(path):"
            },
            "31": {
                "beforePatchRowNumber": 100,
                "afterPatchRowNumber": 113,
                "PatchRowcode": "     \"\"\""
            },
            "32": {
                "beforePatchRowNumber": 101,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    Create a page handler to serve static files. Disable authentication."
            },
            "33": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 114,
                "PatchRowcode": "+    Create a page handler to serve static file."
            },
            "34": {
                "beforePatchRowNumber": 102,
                "afterPatchRowNumber": 115,
                "PatchRowcode": "     \"\"\""
            },
            "35": {
                "beforePatchRowNumber": 103,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    assert isinstance(path, str)"
            },
            "36": {
                "beforePatchRowNumber": 104,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    assert os.path.exists(path), \"%r doesn't exists\" % path"
            },
            "37": {
                "beforePatchRowNumber": 105,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    content_type = None"
            },
            "38": {
                "beforePatchRowNumber": 106,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    if os.path.isfile(path):"
            },
            "39": {
                "beforePatchRowNumber": 107,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        # Set content-type based on filename extension"
            },
            "40": {
                "beforePatchRowNumber": 108,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        ext = \"\""
            },
            "41": {
                "beforePatchRowNumber": 109,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        i = path.rfind('.')"
            },
            "42": {
                "beforePatchRowNumber": 110,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        if i != -1:"
            },
            "43": {
                "beforePatchRowNumber": 111,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            ext = path[i:].lower()"
            },
            "44": {
                "beforePatchRowNumber": 112,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        content_type = mimetypes.types_map.get(ext, None)  # @UndefinedVariable"
            },
            "45": {
                "beforePatchRowNumber": 113,
                "afterPatchRowNumber": 116,
                "PatchRowcode": " "
            },
            "46": {
                "beforePatchRowNumber": 114,
                "afterPatchRowNumber": 117,
                "PatchRowcode": "     @cherrypy.expose"
            },
            "47": {
                "beforePatchRowNumber": 115,
                "afterPatchRowNumber": 118,
                "PatchRowcode": "     @cherrypy.tools.auth_form(on=False)"
            },
            "48": {
                "beforePatchRowNumber": 116,
                "afterPatchRowNumber": 119,
                "PatchRowcode": "     @cherrypy.tools.sessions(on=False)"
            },
            "49": {
                "beforePatchRowNumber": 117,
                "afterPatchRowNumber": 120,
                "PatchRowcode": "     @cherrypy.tools.secure_headers(on=False)"
            },
            "50": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 121,
                "PatchRowcode": "+    @cherrypy.tools.staticfile(filename=path)"
            },
            "51": {
                "beforePatchRowNumber": 118,
                "afterPatchRowNumber": 122,
                "PatchRowcode": "     def handler(*args, **kwargs):"
            },
            "52": {
                "beforePatchRowNumber": 119,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        if cherrypy.request.method not in ('GET', 'HEAD'):"
            },
            "53": {
                "beforePatchRowNumber": 120,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            return None"
            },
            "54": {
                "beforePatchRowNumber": 121,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        filename = os.path.join(path, *args)"
            },
            "55": {
                "beforePatchRowNumber": 122,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        assert filename.startswith(path)"
            },
            "56": {
                "beforePatchRowNumber": 123,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        if not os.path.isfile(filename):"
            },
            "57": {
                "beforePatchRowNumber": 124,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            return None"
            },
            "58": {
                "beforePatchRowNumber": 125,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        return serve_file(filename, content_type)"
            },
            "59": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 123,
                "PatchRowcode": "+        return None"
            },
            "60": {
                "beforePatchRowNumber": 126,
                "afterPatchRowNumber": 124,
                "PatchRowcode": " "
            },
            "61": {
                "beforePatchRowNumber": 127,
                "afterPatchRowNumber": 125,
                "PatchRowcode": "     return handler"
            }
        },
        "frontPatchFile": [
            "# -*- coding: utf-8 -*-",
            "# rdiffweb, A web interface to rdiff-backup repositories",
            "# Copyright (C) 2012-2021 rdiffweb contributors",
            "#",
            "# This program is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This program is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with this program.  If not, see <http://www.gnu.org/licenses/>.",
            "",
            "\"\"\"",
            "Default page handler",
            "",
            "@author: Patrik Dufresne <patrik@ikus-soft.com>",
            "\"\"\"",
            "",
            "",
            "import os",
            "",
            "import cherrypy",
            "from cherrypy.lib.static import mimetypes, serve_file",
            "",
            "from rdiffweb.core.rdw_helpers import unquote_url",
            "",
            "",
            "def poppath(*args, **kwargs):",
            "    \"\"\"",
            "    A decorator for _cp_dispatch",
            "    (cherrypy.dispatch.Dispatcher.dispatch_method_name).",
            "",
            "    Used to merge the segment of URI into a single parameter denoting the",
            "    repository path.",
            "    \"\"\"",
            "",
            "    # Since keyword arg comes after *args, we have to process it ourselves",
            "    # for lower versions of python.",
            "",
            "    handler = None",
            "    handler_call = False",
            "    for k, v in kwargs.items():",
            "        if k == 'handler':",
            "            handler = v",
            "        else:",
            "            raise TypeError(\"cherrypy.popargs() got an unexpected keyword argument '{0}'\".format(k))",
            "",
            "    import inspect",
            "",
            "    if handler is not None and (hasattr(handler, '__call__') or inspect.isclass(handler)):",
            "        handler_call = True",
            "",
            "    def decorated(cls_or_self=None, vpath=None):",
            "        if inspect.isclass(cls_or_self):",
            "            # cherrypy.poppath is a class decorator",
            "            cls = cls_or_self",
            "            setattr(cls, cherrypy.dispatch.Dispatcher.dispatch_method_name, decorated)",
            "            return cls",
            "",
            "        # We're in the actual function",
            "        self = cls_or_self",
            "        parms = {}",
            "        for arg in args:",
            "            if not vpath:",
            "                break",
            "            parms[arg] = unquote_url(vpath.pop(0))",
            "",
            "        # Build repo path.",
            "        path = []",
            "        while len(vpath) > 0:",
            "            path.append(unquote_url(vpath.pop(0)))",
            "        parms['path'] = b\"/\".join(path)",
            "",
            "        if handler is not None:",
            "            if handler_call:",
            "                return handler(**parms)",
            "            else:",
            "                cherrypy.request.params.update(parms)  # @UndefinedVariable",
            "                return handler",
            "",
            "        cherrypy.request.params.update(parms)  # @UndefinedVariable",
            "",
            "        # If we are the ultimate handler, then to prevent our _cp_dispatch",
            "        # from being called again, we will resolve remaining elements through",
            "        # getattr() directly.",
            "        if vpath:",
            "            return getattr(self, vpath.pop(0), None)",
            "        else:",
            "            return self",
            "",
            "    return decorated",
            "",
            "",
            "def static(path):",
            "    \"\"\"",
            "    Create a page handler to serve static files. Disable authentication.",
            "    \"\"\"",
            "    assert isinstance(path, str)",
            "    assert os.path.exists(path), \"%r doesn't exists\" % path",
            "    content_type = None",
            "    if os.path.isfile(path):",
            "        # Set content-type based on filename extension",
            "        ext = \"\"",
            "        i = path.rfind('.')",
            "        if i != -1:",
            "            ext = path[i:].lower()",
            "        content_type = mimetypes.types_map.get(ext, None)  # @UndefinedVariable",
            "",
            "    @cherrypy.expose",
            "    @cherrypy.tools.auth_form(on=False)",
            "    @cherrypy.tools.sessions(on=False)",
            "    @cherrypy.tools.secure_headers(on=False)",
            "    def handler(*args, **kwargs):",
            "        if cherrypy.request.method not in ('GET', 'HEAD'):",
            "            return None",
            "        filename = os.path.join(path, *args)",
            "        assert filename.startswith(path)",
            "        if not os.path.isfile(filename):",
            "            return None",
            "        return serve_file(filename, content_type)",
            "",
            "    return handler"
        ],
        "afterPatchFile": [
            "# -*- coding: utf-8 -*-",
            "# rdiffweb, A web interface to rdiff-backup repositories",
            "# Copyright (C) 2012-2021 rdiffweb contributors",
            "#",
            "# This program is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This program is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with this program.  If not, see <http://www.gnu.org/licenses/>.",
            "",
            "\"\"\"",
            "Default page handler",
            "",
            "@author: Patrik Dufresne <patrik@ikus-soft.com>",
            "\"\"\"",
            "",
            "",
            "import cherrypy",
            "",
            "from rdiffweb.core.rdw_helpers import unquote_url",
            "",
            "",
            "def poppath(*args, **kwargs):",
            "    \"\"\"",
            "    A decorator for _cp_dispatch",
            "    (cherrypy.dispatch.Dispatcher.dispatch_method_name).",
            "",
            "    Used to merge the segment of URI into a single parameter denoting the",
            "    repository path.",
            "    \"\"\"",
            "",
            "    # Since keyword arg comes after *args, we have to process it ourselves",
            "    # for lower versions of python.",
            "",
            "    handler = None",
            "    handler_call = False",
            "    for k, v in kwargs.items():",
            "        if k == 'handler':",
            "            handler = v",
            "        else:",
            "            raise TypeError(\"cherrypy.popargs() got an unexpected keyword argument '{0}'\".format(k))",
            "",
            "    import inspect",
            "",
            "    if handler is not None and (hasattr(handler, '__call__') or inspect.isclass(handler)):",
            "        handler_call = True",
            "",
            "    def decorated(cls_or_self=None, vpath=None):",
            "        if inspect.isclass(cls_or_self):",
            "            # cherrypy.poppath is a class decorator",
            "            cls = cls_or_self",
            "            setattr(cls, cherrypy.dispatch.Dispatcher.dispatch_method_name, decorated)",
            "            return cls",
            "",
            "        # We're in the actual function",
            "        self = cls_or_self",
            "        parms = {}",
            "        for arg in args:",
            "            if not vpath:",
            "                break",
            "            parms[arg] = unquote_url(vpath.pop(0))",
            "",
            "        # Build repo path.",
            "        path = []",
            "        while len(vpath) > 0:",
            "            path.append(unquote_url(vpath.pop(0)))",
            "        parms['path'] = b\"/\".join(path)",
            "",
            "        if handler is not None:",
            "            if handler_call:",
            "                return handler(**parms)",
            "            else:",
            "                cherrypy.request.params.update(parms)  # @UndefinedVariable",
            "                return handler",
            "",
            "        cherrypy.request.params.update(parms)  # @UndefinedVariable",
            "",
            "        # If we are the ultimate handler, then to prevent our _cp_dispatch",
            "        # from being called again, we will resolve remaining elements through",
            "        # getattr() directly.",
            "        if vpath:",
            "            return getattr(self, vpath.pop(0), None)",
            "        else:",
            "            return self",
            "",
            "    return decorated",
            "",
            "",
            "def staticdir(path):",
            "    \"\"\"",
            "    Create a page handler to serve static directory.",
            "    \"\"\"",
            "",
            "    @cherrypy.expose",
            "    @cherrypy.tools.auth_form(on=False)",
            "    @cherrypy.tools.sessions(on=False)",
            "    @cherrypy.tools.secure_headers(on=False)",
            "    @cherrypy.tools.staticdir(section=\"\", dir=path)",
            "    def handler(*args, **kwargs):",
            "        return None",
            "",
            "    return handler",
            "",
            "",
            "def staticfile(path):",
            "    \"\"\"",
            "    Create a page handler to serve static file.",
            "    \"\"\"",
            "",
            "    @cherrypy.expose",
            "    @cherrypy.tools.auth_form(on=False)",
            "    @cherrypy.tools.sessions(on=False)",
            "    @cherrypy.tools.secure_headers(on=False)",
            "    @cherrypy.tools.staticfile(filename=path)",
            "    def handler(*args, **kwargs):",
            "        return None",
            "",
            "    return handler"
        ],
        "action": [
            "0",
            "0",
            "0",
            "1",
            "1",
            "0",
            "1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "2",
            "2",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "25": [],
            "26": [],
            "28": [],
            "99": [
                "static"
            ],
            "101": [
                "static"
            ],
            "103": [
                "static"
            ],
            "104": [
                "static"
            ],
            "105": [
                "static"
            ],
            "106": [
                "static"
            ],
            "107": [
                "static"
            ],
            "108": [
                "static"
            ],
            "109": [
                "static"
            ],
            "110": [
                "static"
            ],
            "111": [
                "static"
            ],
            "112": [
                "static"
            ],
            "119": [
                "static",
                "handler"
            ],
            "120": [
                "static",
                "handler"
            ],
            "121": [
                "static",
                "handler"
            ],
            "122": [
                "static",
                "handler"
            ],
            "123": [
                "static",
                "handler"
            ],
            "124": [
                "static",
                "handler"
            ],
            "125": [
                "static",
                "handler"
            ]
        },
        "addLocation": []
    },
    "rdiffweb/controller/tests/test_controller.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 20,
                "afterPatchRowNumber": 20,
                "PatchRowcode": " @author: Patrik Dufresne"
            },
            "1": {
                "beforePatchRowNumber": 21,
                "afterPatchRowNumber": 21,
                "PatchRowcode": " \"\"\""
            },
            "2": {
                "beforePatchRowNumber": 22,
                "afterPatchRowNumber": 22,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 23,
                "PatchRowcode": "+from parameterized import parameterized"
            },
            "4": {
                "beforePatchRowNumber": 23,
                "afterPatchRowNumber": 24,
                "PatchRowcode": " "
            },
            "5": {
                "beforePatchRowNumber": 24,
                "afterPatchRowNumber": 25,
                "PatchRowcode": " import rdiffweb.test"
            },
            "6": {
                "beforePatchRowNumber": 25,
                "afterPatchRowNumber": 26,
                "PatchRowcode": " "
            },
            "7": {
                "beforePatchRowNumber": 46,
                "afterPatchRowNumber": 47,
                "PatchRowcode": "         self.assertStatus('200 OK')"
            },
            "8": {
                "beforePatchRowNumber": 47,
                "afterPatchRowNumber": 48,
                "PatchRowcode": "         self.assertInBody('/static/default.css')"
            },
            "9": {
                "beforePatchRowNumber": 48,
                "afterPatchRowNumber": 49,
                "PatchRowcode": " "
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 50,
                "PatchRowcode": "+    @parameterized.expand("
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 51,
                "PatchRowcode": "+        ["
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 52,
                "PatchRowcode": "+            '/favicon.ico',"
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 53,
                "PatchRowcode": "+            '/static/default.css',"
            },
            "14": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 54,
                "PatchRowcode": "+            '/static/js/rdiffweb.js',"
            },
            "15": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 55,
                "PatchRowcode": "+            '/static/orange.css',"
            },
            "16": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 56,
                "PatchRowcode": "+        ]"
            },
            "17": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 57,
                "PatchRowcode": "+    )"
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 58,
                "PatchRowcode": "+    def test_static_files(self, path):"
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 59,
                "PatchRowcode": "+        \"\"\""
            },
            "20": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 60,
                "PatchRowcode": "+        Check if the theme is properly configure."
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 61,
                "PatchRowcode": "+        \"\"\""
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 62,
                "PatchRowcode": "+        self.getPage('/logout')"
            },
            "23": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 63,
                "PatchRowcode": "+        self.getPage(path)"
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 64,
                "PatchRowcode": "+        self.assertStatus(200)"
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 65,
                "PatchRowcode": "+"
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 66,
                "PatchRowcode": "+    def test_path_traversal(self):"
            },
            "27": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 67,
                "PatchRowcode": "+        self.getPage('/static//../../test.txt')"
            },
            "28": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 68,
                "PatchRowcode": "+        self.assertStatus(403)"
            },
            "29": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 69,
                "PatchRowcode": "+"
            },
            "30": {
                "beforePatchRowNumber": 49,
                "afterPatchRowNumber": 70,
                "PatchRowcode": " "
            },
            "31": {
                "beforePatchRowNumber": 50,
                "afterPatchRowNumber": 71,
                "PatchRowcode": " class ControllerOrangeThemeTest(rdiffweb.test.WebCase):"
            },
            "32": {
                "beforePatchRowNumber": 51,
                "afterPatchRowNumber": 72,
                "PatchRowcode": " "
            },
            "33": {
                "beforePatchRowNumber": 52,
                "afterPatchRowNumber": 73,
                "PatchRowcode": "     login = True"
            },
            "34": {
                "beforePatchRowNumber": 53,
                "afterPatchRowNumber": 74,
                "PatchRowcode": " "
            },
            "35": {
                "beforePatchRowNumber": 54,
                "afterPatchRowNumber": 75,
                "PatchRowcode": "     default_config = {'DefaultTheme': 'orange'}"
            },
            "36": {
                "beforePatchRowNumber": 55,
                "afterPatchRowNumber": 76,
                "PatchRowcode": " "
            },
            "37": {
                "beforePatchRowNumber": 56,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    def test_theme(self):"
            },
            "38": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 77,
                "PatchRowcode": "+    from parameterized import parameterized"
            },
            "39": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 78,
                "PatchRowcode": "+"
            },
            "40": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 79,
                "PatchRowcode": "+    def test_static(self):"
            },
            "41": {
                "beforePatchRowNumber": 57,
                "afterPatchRowNumber": 80,
                "PatchRowcode": "         \"\"\""
            },
            "42": {
                "beforePatchRowNumber": 58,
                "afterPatchRowNumber": 81,
                "PatchRowcode": "         Check if the theme is properly configure."
            },
            "43": {
                "beforePatchRowNumber": 59,
                "afterPatchRowNumber": 82,
                "PatchRowcode": "         \"\"\""
            }
        },
        "frontPatchFile": [
            "# -*- coding: utf-8 -*-",
            "# rdiffweb, A web interface to rdiff-backup repositories",
            "# Copyright (C) 2012-2021 rdiffweb contributors",
            "#",
            "# This program is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This program is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with this program.  If not, see <http://www.gnu.org/licenses/>.",
            "\"\"\"",
            "Created on Mar 13, 2019",
            "",
            "@author: Patrik Dufresne",
            "\"\"\"",
            "",
            "",
            "import rdiffweb.test",
            "",
            "",
            "class ControllerTest(rdiffweb.test.WebCase):",
            "",
            "    login = True",
            "",
            "    default_config = {'HeaderName': 'MyTest'}",
            "",
            "    def test_headername(self):",
            "        \"\"\"",
            "        Check if the headername is used in the page.",
            "        \"\"\"",
            "        self.getPage(\"/\")",
            "        self.assertStatus('200 OK')",
            "        self.assertInBody('MyTest')",
            "",
            "    def test_theme(self):",
            "        \"\"\"",
            "        Check if the theme is properly configure.",
            "        \"\"\"",
            "        self.getPage(\"/\")",
            "        self.assertStatus('200 OK')",
            "        self.assertInBody('/static/default.css')",
            "",
            "",
            "class ControllerOrangeThemeTest(rdiffweb.test.WebCase):",
            "",
            "    login = True",
            "",
            "    default_config = {'DefaultTheme': 'orange'}",
            "",
            "    def test_theme(self):",
            "        \"\"\"",
            "        Check if the theme is properly configure.",
            "        \"\"\"",
            "        self.getPage(\"/\")",
            "        self.assertStatus('200 OK')",
            "        self.assertInBody('/static/orange.css')",
            "",
            "",
            "class ControllerBlueThemeTest(rdiffweb.test.WebCase):",
            "",
            "    login = True",
            "",
            "    default_config = {'DefaultTheme': 'blue'}",
            "",
            "    def test_theme(self):",
            "        \"\"\"",
            "        Check if the theme is properly configure.",
            "        \"\"\"",
            "        self.getPage(\"/\")",
            "        self.assertInBody('/static/blue.css')"
        ],
        "afterPatchFile": [
            "# -*- coding: utf-8 -*-",
            "# rdiffweb, A web interface to rdiff-backup repositories",
            "# Copyright (C) 2012-2021 rdiffweb contributors",
            "#",
            "# This program is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This program is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with this program.  If not, see <http://www.gnu.org/licenses/>.",
            "\"\"\"",
            "Created on Mar 13, 2019",
            "",
            "@author: Patrik Dufresne",
            "\"\"\"",
            "",
            "from parameterized import parameterized",
            "",
            "import rdiffweb.test",
            "",
            "",
            "class ControllerTest(rdiffweb.test.WebCase):",
            "",
            "    login = True",
            "",
            "    default_config = {'HeaderName': 'MyTest'}",
            "",
            "    def test_headername(self):",
            "        \"\"\"",
            "        Check if the headername is used in the page.",
            "        \"\"\"",
            "        self.getPage(\"/\")",
            "        self.assertStatus('200 OK')",
            "        self.assertInBody('MyTest')",
            "",
            "    def test_theme(self):",
            "        \"\"\"",
            "        Check if the theme is properly configure.",
            "        \"\"\"",
            "        self.getPage(\"/\")",
            "        self.assertStatus('200 OK')",
            "        self.assertInBody('/static/default.css')",
            "",
            "    @parameterized.expand(",
            "        [",
            "            '/favicon.ico',",
            "            '/static/default.css',",
            "            '/static/js/rdiffweb.js',",
            "            '/static/orange.css',",
            "        ]",
            "    )",
            "    def test_static_files(self, path):",
            "        \"\"\"",
            "        Check if the theme is properly configure.",
            "        \"\"\"",
            "        self.getPage('/logout')",
            "        self.getPage(path)",
            "        self.assertStatus(200)",
            "",
            "    def test_path_traversal(self):",
            "        self.getPage('/static//../../test.txt')",
            "        self.assertStatus(403)",
            "",
            "",
            "class ControllerOrangeThemeTest(rdiffweb.test.WebCase):",
            "",
            "    login = True",
            "",
            "    default_config = {'DefaultTheme': 'orange'}",
            "",
            "    from parameterized import parameterized",
            "",
            "    def test_static(self):",
            "        \"\"\"",
            "        Check if the theme is properly configure.",
            "        \"\"\"",
            "        self.getPage(\"/\")",
            "        self.assertStatus('200 OK')",
            "        self.assertInBody('/static/orange.css')",
            "",
            "",
            "class ControllerBlueThemeTest(rdiffweb.test.WebCase):",
            "",
            "    login = True",
            "",
            "    default_config = {'DefaultTheme': 'blue'}",
            "",
            "    def test_theme(self):",
            "        \"\"\"",
            "        Check if the theme is properly configure.",
            "        \"\"\"",
            "        self.getPage(\"/\")",
            "        self.assertInBody('/static/blue.css')"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "56": [
                "ControllerOrangeThemeTest",
                "test_theme"
            ]
        },
        "addLocation": [
            "PyPDF2._reader",
            "rdiffweb.controller.tests.test_controller.ControllerTest.default_config",
            "rdiffweb.controller.tests.test_controller.ControllerTest.self"
        ]
    },
    "rdiffweb/rdw_app.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 42,
                "afterPatchRowNumber": 42,
                "PatchRowcode": " import rdiffweb.tools.secure_headers"
            },
            "1": {
                "beforePatchRowNumber": 43,
                "afterPatchRowNumber": 43,
                "PatchRowcode": " from rdiffweb.controller import Controller"
            },
            "2": {
                "beforePatchRowNumber": 44,
                "afterPatchRowNumber": 44,
                "PatchRowcode": " from rdiffweb.controller.api import ApiPage"
            },
            "3": {
                "beforePatchRowNumber": 45,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-from rdiffweb.controller.dispatch import static  # noqa"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 45,
                "PatchRowcode": "+from rdiffweb.controller.dispatch import staticdir, staticfile"
            },
            "5": {
                "beforePatchRowNumber": 46,
                "afterPatchRowNumber": 46,
                "PatchRowcode": " from rdiffweb.controller.page_admin import AdminPage"
            },
            "6": {
                "beforePatchRowNumber": 47,
                "afterPatchRowNumber": 47,
                "PatchRowcode": " from rdiffweb.controller.page_browse import BrowsePage"
            },
            "7": {
                "beforePatchRowNumber": 48,
                "afterPatchRowNumber": 48,
                "PatchRowcode": " from rdiffweb.controller.page_delete import DeletePage"
            },
            "8": {
                "beforePatchRowNumber": 97,
                "afterPatchRowNumber": 97,
                "PatchRowcode": " "
            },
            "9": {
                "beforePatchRowNumber": 98,
                "afterPatchRowNumber": 98,
                "PatchRowcode": "         # Register static dir."
            },
            "10": {
                "beforePatchRowNumber": 99,
                "afterPatchRowNumber": 99,
                "PatchRowcode": "         static_dir = pkg_resources.resource_filename('rdiffweb', 'static')  # @UndefinedVariable"
            },
            "11": {
                "beforePatchRowNumber": 100,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.static = static(static_dir)"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 100,
                "PatchRowcode": "+        self.static = staticdir(static_dir)"
            },
            "13": {
                "beforePatchRowNumber": 101,
                "afterPatchRowNumber": 101,
                "PatchRowcode": " "
            },
            "14": {
                "beforePatchRowNumber": 102,
                "afterPatchRowNumber": 102,
                "PatchRowcode": "         # Register robots.txt"
            },
            "15": {
                "beforePatchRowNumber": 103,
                "afterPatchRowNumber": 103,
                "PatchRowcode": "         robots_txt = pkg_resources.resource_filename('rdiffweb', 'static/robots.txt')  # @UndefinedVariable"
            },
            "16": {
                "beforePatchRowNumber": 104,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.robots_txt = static(robots_txt)"
            },
            "17": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 104,
                "PatchRowcode": "+        self.robots_txt = staticfile(robots_txt)"
            },
            "18": {
                "beforePatchRowNumber": 105,
                "afterPatchRowNumber": 105,
                "PatchRowcode": " "
            },
            "19": {
                "beforePatchRowNumber": 106,
                "afterPatchRowNumber": 106,
                "PatchRowcode": " "
            },
            "20": {
                "beforePatchRowNumber": 107,
                "afterPatchRowNumber": 107,
                "PatchRowcode": " class RdiffwebApp(Application):"
            },
            "21": {
                "beforePatchRowNumber": 208,
                "afterPatchRowNumber": 208,
                "PatchRowcode": "         Application.__init__(self, root=Root(), config=config)"
            },
            "22": {
                "beforePatchRowNumber": 209,
                "afterPatchRowNumber": 209,
                "PatchRowcode": " "
            },
            "23": {
                "beforePatchRowNumber": 210,
                "afterPatchRowNumber": 210,
                "PatchRowcode": "         # Register favicon.ico"
            },
            "24": {
                "beforePatchRowNumber": 211,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.root.favicon_ico = static(self._favicon)"
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 211,
                "PatchRowcode": "+        self.root.favicon_ico = staticfile(self._favicon)"
            },
            "26": {
                "beforePatchRowNumber": 212,
                "afterPatchRowNumber": 212,
                "PatchRowcode": " "
            },
            "27": {
                "beforePatchRowNumber": 213,
                "afterPatchRowNumber": 213,
                "PatchRowcode": "         # Register header_logo"
            },
            "28": {
                "beforePatchRowNumber": 214,
                "afterPatchRowNumber": 214,
                "PatchRowcode": "         if self._header_logo:"
            },
            "29": {
                "beforePatchRowNumber": 215,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            self.root.header_logo = static(self._header_logo)"
            },
            "30": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 215,
                "PatchRowcode": "+            self.root.header_logo = staticfile(self._header_logo)"
            },
            "31": {
                "beforePatchRowNumber": 216,
                "afterPatchRowNumber": 216,
                "PatchRowcode": " "
            },
            "32": {
                "beforePatchRowNumber": 217,
                "afterPatchRowNumber": 217,
                "PatchRowcode": "         # Define TEMP env"
            },
            "33": {
                "beforePatchRowNumber": 218,
                "afterPatchRowNumber": 218,
                "PatchRowcode": "         if self._tempdir:"
            }
        },
        "frontPatchFile": [
            "# -*- coding: utf-8 -*-",
            "# rdiffweb, A web interface to rdiff-backup repositories",
            "# Copyright (C) 2012-2021 rdiffweb contributors",
            "#",
            "# This program is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This program is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with this program.  If not, see <http://www.gnu.org/licenses/>.",
            "",
            "import logging",
            "import os",
            "",
            "import cherrypy",
            "import cherrypy.lib.sessions",
            "import pkg_resources",
            "from cherrypy import Application",
            "",
            "import rdiffweb",
            "import rdiffweb.controller.filter_authorization",
            "import rdiffweb.core.notification",
            "import rdiffweb.core.quota",
            "import rdiffweb.core.remove_older",
            "import rdiffweb.plugins.ldap",
            "import rdiffweb.plugins.scheduler",
            "import rdiffweb.plugins.smtp",
            "import rdiffweb.tools.auth_basic",
            "import rdiffweb.tools.auth_form",
            "import rdiffweb.tools.currentuser",
            "import rdiffweb.tools.errors",
            "import rdiffweb.tools.i18n",
            "import rdiffweb.tools.proxy",
            "import rdiffweb.tools.ratelimit",
            "import rdiffweb.tools.real_ip",
            "import rdiffweb.tools.secure_headers",
            "from rdiffweb.controller import Controller",
            "from rdiffweb.controller.api import ApiPage",
            "from rdiffweb.controller.dispatch import static  # noqa",
            "from rdiffweb.controller.page_admin import AdminPage",
            "from rdiffweb.controller.page_browse import BrowsePage",
            "from rdiffweb.controller.page_delete import DeletePage",
            "from rdiffweb.controller.page_graphs import GraphsPage",
            "from rdiffweb.controller.page_history import HistoryPage",
            "from rdiffweb.controller.page_locations import LocationsPage",
            "from rdiffweb.controller.page_login import LoginPage, LogoutPage",
            "from rdiffweb.controller.page_logs import LogsPage",
            "from rdiffweb.controller.page_prefs import PreferencesPage",
            "from rdiffweb.controller.page_restore import RestorePage",
            "from rdiffweb.controller.page_settings import SettingsPage",
            "from rdiffweb.controller.page_status import StatusPage",
            "from rdiffweb.core import rdw_templating",
            "from rdiffweb.core.config import Option, parse_args",
            "from rdiffweb.core.store import Store",
            "",
            "# Define the logger",
            "logger = logging.getLogger(__name__)",
            "",
            "# Define cherrypy development environment",
            "cherrypy.config.environments['development'] = {",
            "    'engine.autoreload.on': True,",
            "    'checker.on': False,",
            "    'tools.log_headers.on': True,",
            "    'request.show_tracebacks': True,",
            "    'request.show_mismatched_params': True,",
            "    'log.screen': False,",
            "}",
            "",
            "",
            "@cherrypy.tools.proxy(remote=None)",
            "@cherrypy.tools.secure_headers()",
            "@cherrypy.tools.real_ip()",
            "class Root(LocationsPage):",
            "    def __init__(self):",
            "        self.login = LoginPage()",
            "        self.logout = LogoutPage()",
            "        self.browse = BrowsePage()",
            "        self.delete = DeletePage()",
            "        self.restore = RestorePage()",
            "        self.history = HistoryPage()",
            "        self.status = StatusPage()",
            "        self.admin = AdminPage()",
            "        self.prefs = PreferencesPage()",
            "        self.settings = SettingsPage()",
            "        self.api = ApiPage()",
            "        # Keep this for backward compatibility.",
            "        self.api.set_encoding = self.settings",
            "        self.api.remove_older = self.settings",
            "        self.graphs = GraphsPage()",
            "        self.logs = LogsPage()",
            "",
            "        # Register static dir.",
            "        static_dir = pkg_resources.resource_filename('rdiffweb', 'static')  # @UndefinedVariable",
            "        self.static = static(static_dir)",
            "",
            "        # Register robots.txt",
            "        robots_txt = pkg_resources.resource_filename('rdiffweb', 'static/robots.txt')  # @UndefinedVariable",
            "        self.robots_txt = static(robots_txt)",
            "",
            "",
            "class RdiffwebApp(Application):",
            "    \"\"\"This class represent the application context.\"\"\"",
            "",
            "    _favicon = Option('favicon')",
            "",
            "    _header_logo = Option('header_logo')",
            "",
            "    _tempdir = Option('tempdir')",
            "",
            "    _session_dir = Option('session_dir')",
            "",
            "    @classmethod",
            "    def parse_args(cls, args=None, config_file_contents=None):",
            "        return parse_args(args, config_file_contents)",
            "",
            "    def __init__(self, cfg):",
            "        self.cfg = cfg",
            "        cherrypy.config.update(",
            "            {",
            "                'environment': 'development' if cfg.debug else cfg.environment,",
            "                # Configure LDAP plugin",
            "                'ldap.uri': cfg.ldap_uri,",
            "                'ldap.base_dn': cfg.ldap_base_dn,",
            "                'ldap.bind_dn': cfg.ldap_bind_dn,",
            "                'ldap.bind_password': cfg.ldap_bind_password,",
            "                'ldap.scope': cfg.ldap_scope,",
            "                'ldap.tls': cfg.ldap_tls,",
            "                'ldap.username_attribute': cfg.ldap_username_attribute,",
            "                'ldap.required_group': cfg.ldap_required_group,",
            "                'ldap.group_attribute': cfg.ldap_group_attribute,",
            "                'ldap.group_attribute_is_dn': cfg.ldap_group_attribute_is_dn,",
            "                'ldap.version': cfg.ldap_version,",
            "                'ldap.network_timeout': cfg.ldap_network_timeout,",
            "                'ldap.timeout': cfg.ldap_timeout,",
            "                'ldap.encoding': cfg.ldap_encoding,",
            "                # Configure SMTP plugin",
            "                'smtp.server': cfg.email_host,",
            "                'smtp.username': cfg.email_username,",
            "                'smtp.password': cfg.email_password,",
            "                'smtp.email_from': cfg.email_sender",
            "                and '%s <%s>'",
            "                % (",
            "                    cfg.header_name,",
            "                    cfg.email_sender,",
            "                ),",
            "                'smtp.encryption': cfg.email_encryption,",
            "                # Configure remove_older plugin",
            "                'remove_older.execution_time': self.cfg.remove_older_time,",
            "                # Configure notification plugin",
            "                'notification.execution_time': self.cfg.email_notification_time,",
            "                'notification.send_changed': self.cfg.email_send_changed_notification,",
            "                # Configure quota plugin",
            "                'quota.set_quota_cmd': self.cfg.quota_set_cmd,",
            "                'quota.get_quota_cmd': self.cfg.quota_get_cmd,",
            "                'quota.get_usage_cmd': self.cfg.quota_used_cmd,",
            "            }",
            "        )",
            "",
            "        # Initialise the template engine.",
            "        self.templates = rdw_templating.TemplateManager()",
            "",
            "        # Pick the right implementation for storage",
            "        session_storage_class = cherrypy.lib.sessions.RamSession",
            "        rate_limit_storage_class = rdiffweb.tools.ratelimit.RamRateLimit",
            "        if self._session_dir:",
            "            session_storage_class = cherrypy.lib.sessions.FileSession",
            "            rate_limit_storage_class = rdiffweb.tools.ratelimit.FileRateLimit",
            "",
            "        config = {",
            "            '/': {",
            "                # To work around the new behaviour in CherryPy >= 5.5.0, force usage of",
            "                # ISO-8859-1 encoding for URL. This avoid any conversion of the",
            "                # URL into UTF-8.",
            "                'request.uri_encoding': 'ISO-8859-1',",
            "                'tools.auth_basic.realm': 'rdiffweb',",
            "                'tools.auth_basic.checkpassword': self._checkpassword,",
            "                'tools.auth_form.on': True,",
            "                'tools.currentuser.on': True,",
            "                'tools.currentuser.userobj': lambda username: self.store.get_user(username),",
            "                'tools.i18n.on': True,",
            "                'tools.i18n.default': 'en_US',",
            "                'tools.i18n.mo_dir': pkg_resources.resource_filename('rdiffweb', 'locales'),  # @UndefinedVariable",
            "                'tools.i18n.domain': 'messages',",
            "                'tools.encode.on': True,",
            "                'tools.encode.encoding': 'utf-8',",
            "                'tools.gzip.on': True,",
            "                'error_page.default': self.error_page,",
            "                'tools.sessions.on': True,",
            "                'tools.sessions.debug': cfg.debug,",
            "                'tools.sessions.storage_class': session_storage_class,",
            "                'tools.sessions.storage_path': self._session_dir,",
            "                'tools.sessions.httponly': True,",
            "                'tools.ratelimit.debug': cfg.debug,",
            "                'tools.ratelimit.delay': 60,",
            "                'tools.ratelimit.anonymous_limit': cfg.rate_limit,",
            "                'tools.ratelimit.storage_class': rate_limit_storage_class,",
            "                'tools.ratelimit.storage_path': self._session_dir,",
            "            },",
            "        }",
            "",
            "        # Initialize the application",
            "        Application.__init__(self, root=Root(), config=config)",
            "",
            "        # Register favicon.ico",
            "        self.root.favicon_ico = static(self._favicon)",
            "",
            "        # Register header_logo",
            "        if self._header_logo:",
            "            self.root.header_logo = static(self._header_logo)",
            "",
            "        # Define TEMP env",
            "        if self._tempdir:",
            "            os.environ[\"TMPDIR\"] = self._tempdir",
            "",
            "        # create user manager",
            "        self.store = Store(self)",
            "        self.store.create_admin_user()",
            "",
            "    @property",
            "    def currentuser(self):",
            "        \"\"\"",
            "        Proxy property to get current user from cherrypy request object.",
            "        Return a UserObject when logged in or None.",
            "        \"\"\"",
            "        return getattr(cherrypy.serving.request, 'currentuser', None)",
            "",
            "    def _checkpassword(self, realm, username, password):",
            "        \"\"\"",
            "        Check basic authentication.",
            "        \"\"\"",
            "        return self.store.login(username, password) is not None",
            "",
            "    def error_page(self, **kwargs):",
            "        \"\"\"",
            "        Default error page shown to the user when an unexpected error occur.",
            "        \"\"\"",
            "        # Log exception.",
            "        logger.error(",
            "            'error page: %s %s\\n%s' % (kwargs.get('status', ''), kwargs.get('message', ''), kwargs.get('traceback', ''))",
            "        )",
            "",
            "        # Replace message by generic one for 404. Default implementation leak path info.",
            "        if kwargs.get('status', '') == '404 Not Found':",
            "            kwargs['message'] = 'Nothing matches the given URI'",
            "",
            "        # Check expected response type.",
            "        mtype = cherrypy.tools.accept.callable(['text/html', 'text/plain'])  # @UndefinedVariable",
            "        if mtype == 'text/plain':",
            "            return kwargs.get('message')",
            "",
            "        # Try to build a nice error page.",
            "        try:",
            "            page = Controller()",
            "            return page._compile_template('error_page_default.html', **kwargs)",
            "        except Exception:",
            "            # If failing, send the raw error message.",
            "            return kwargs.get('message')",
            "",
            "    @property",
            "    def version(self):",
            "        \"\"\"",
            "        Get the current running version (using package info).",
            "        \"\"\"",
            "        return rdiffweb.__version__"
        ],
        "afterPatchFile": [
            "# -*- coding: utf-8 -*-",
            "# rdiffweb, A web interface to rdiff-backup repositories",
            "# Copyright (C) 2012-2021 rdiffweb contributors",
            "#",
            "# This program is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This program is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with this program.  If not, see <http://www.gnu.org/licenses/>.",
            "",
            "import logging",
            "import os",
            "",
            "import cherrypy",
            "import cherrypy.lib.sessions",
            "import pkg_resources",
            "from cherrypy import Application",
            "",
            "import rdiffweb",
            "import rdiffweb.controller.filter_authorization",
            "import rdiffweb.core.notification",
            "import rdiffweb.core.quota",
            "import rdiffweb.core.remove_older",
            "import rdiffweb.plugins.ldap",
            "import rdiffweb.plugins.scheduler",
            "import rdiffweb.plugins.smtp",
            "import rdiffweb.tools.auth_basic",
            "import rdiffweb.tools.auth_form",
            "import rdiffweb.tools.currentuser",
            "import rdiffweb.tools.errors",
            "import rdiffweb.tools.i18n",
            "import rdiffweb.tools.proxy",
            "import rdiffweb.tools.ratelimit",
            "import rdiffweb.tools.real_ip",
            "import rdiffweb.tools.secure_headers",
            "from rdiffweb.controller import Controller",
            "from rdiffweb.controller.api import ApiPage",
            "from rdiffweb.controller.dispatch import staticdir, staticfile",
            "from rdiffweb.controller.page_admin import AdminPage",
            "from rdiffweb.controller.page_browse import BrowsePage",
            "from rdiffweb.controller.page_delete import DeletePage",
            "from rdiffweb.controller.page_graphs import GraphsPage",
            "from rdiffweb.controller.page_history import HistoryPage",
            "from rdiffweb.controller.page_locations import LocationsPage",
            "from rdiffweb.controller.page_login import LoginPage, LogoutPage",
            "from rdiffweb.controller.page_logs import LogsPage",
            "from rdiffweb.controller.page_prefs import PreferencesPage",
            "from rdiffweb.controller.page_restore import RestorePage",
            "from rdiffweb.controller.page_settings import SettingsPage",
            "from rdiffweb.controller.page_status import StatusPage",
            "from rdiffweb.core import rdw_templating",
            "from rdiffweb.core.config import Option, parse_args",
            "from rdiffweb.core.store import Store",
            "",
            "# Define the logger",
            "logger = logging.getLogger(__name__)",
            "",
            "# Define cherrypy development environment",
            "cherrypy.config.environments['development'] = {",
            "    'engine.autoreload.on': True,",
            "    'checker.on': False,",
            "    'tools.log_headers.on': True,",
            "    'request.show_tracebacks': True,",
            "    'request.show_mismatched_params': True,",
            "    'log.screen': False,",
            "}",
            "",
            "",
            "@cherrypy.tools.proxy(remote=None)",
            "@cherrypy.tools.secure_headers()",
            "@cherrypy.tools.real_ip()",
            "class Root(LocationsPage):",
            "    def __init__(self):",
            "        self.login = LoginPage()",
            "        self.logout = LogoutPage()",
            "        self.browse = BrowsePage()",
            "        self.delete = DeletePage()",
            "        self.restore = RestorePage()",
            "        self.history = HistoryPage()",
            "        self.status = StatusPage()",
            "        self.admin = AdminPage()",
            "        self.prefs = PreferencesPage()",
            "        self.settings = SettingsPage()",
            "        self.api = ApiPage()",
            "        # Keep this for backward compatibility.",
            "        self.api.set_encoding = self.settings",
            "        self.api.remove_older = self.settings",
            "        self.graphs = GraphsPage()",
            "        self.logs = LogsPage()",
            "",
            "        # Register static dir.",
            "        static_dir = pkg_resources.resource_filename('rdiffweb', 'static')  # @UndefinedVariable",
            "        self.static = staticdir(static_dir)",
            "",
            "        # Register robots.txt",
            "        robots_txt = pkg_resources.resource_filename('rdiffweb', 'static/robots.txt')  # @UndefinedVariable",
            "        self.robots_txt = staticfile(robots_txt)",
            "",
            "",
            "class RdiffwebApp(Application):",
            "    \"\"\"This class represent the application context.\"\"\"",
            "",
            "    _favicon = Option('favicon')",
            "",
            "    _header_logo = Option('header_logo')",
            "",
            "    _tempdir = Option('tempdir')",
            "",
            "    _session_dir = Option('session_dir')",
            "",
            "    @classmethod",
            "    def parse_args(cls, args=None, config_file_contents=None):",
            "        return parse_args(args, config_file_contents)",
            "",
            "    def __init__(self, cfg):",
            "        self.cfg = cfg",
            "        cherrypy.config.update(",
            "            {",
            "                'environment': 'development' if cfg.debug else cfg.environment,",
            "                # Configure LDAP plugin",
            "                'ldap.uri': cfg.ldap_uri,",
            "                'ldap.base_dn': cfg.ldap_base_dn,",
            "                'ldap.bind_dn': cfg.ldap_bind_dn,",
            "                'ldap.bind_password': cfg.ldap_bind_password,",
            "                'ldap.scope': cfg.ldap_scope,",
            "                'ldap.tls': cfg.ldap_tls,",
            "                'ldap.username_attribute': cfg.ldap_username_attribute,",
            "                'ldap.required_group': cfg.ldap_required_group,",
            "                'ldap.group_attribute': cfg.ldap_group_attribute,",
            "                'ldap.group_attribute_is_dn': cfg.ldap_group_attribute_is_dn,",
            "                'ldap.version': cfg.ldap_version,",
            "                'ldap.network_timeout': cfg.ldap_network_timeout,",
            "                'ldap.timeout': cfg.ldap_timeout,",
            "                'ldap.encoding': cfg.ldap_encoding,",
            "                # Configure SMTP plugin",
            "                'smtp.server': cfg.email_host,",
            "                'smtp.username': cfg.email_username,",
            "                'smtp.password': cfg.email_password,",
            "                'smtp.email_from': cfg.email_sender",
            "                and '%s <%s>'",
            "                % (",
            "                    cfg.header_name,",
            "                    cfg.email_sender,",
            "                ),",
            "                'smtp.encryption': cfg.email_encryption,",
            "                # Configure remove_older plugin",
            "                'remove_older.execution_time': self.cfg.remove_older_time,",
            "                # Configure notification plugin",
            "                'notification.execution_time': self.cfg.email_notification_time,",
            "                'notification.send_changed': self.cfg.email_send_changed_notification,",
            "                # Configure quota plugin",
            "                'quota.set_quota_cmd': self.cfg.quota_set_cmd,",
            "                'quota.get_quota_cmd': self.cfg.quota_get_cmd,",
            "                'quota.get_usage_cmd': self.cfg.quota_used_cmd,",
            "            }",
            "        )",
            "",
            "        # Initialise the template engine.",
            "        self.templates = rdw_templating.TemplateManager()",
            "",
            "        # Pick the right implementation for storage",
            "        session_storage_class = cherrypy.lib.sessions.RamSession",
            "        rate_limit_storage_class = rdiffweb.tools.ratelimit.RamRateLimit",
            "        if self._session_dir:",
            "            session_storage_class = cherrypy.lib.sessions.FileSession",
            "            rate_limit_storage_class = rdiffweb.tools.ratelimit.FileRateLimit",
            "",
            "        config = {",
            "            '/': {",
            "                # To work around the new behaviour in CherryPy >= 5.5.0, force usage of",
            "                # ISO-8859-1 encoding for URL. This avoid any conversion of the",
            "                # URL into UTF-8.",
            "                'request.uri_encoding': 'ISO-8859-1',",
            "                'tools.auth_basic.realm': 'rdiffweb',",
            "                'tools.auth_basic.checkpassword': self._checkpassword,",
            "                'tools.auth_form.on': True,",
            "                'tools.currentuser.on': True,",
            "                'tools.currentuser.userobj': lambda username: self.store.get_user(username),",
            "                'tools.i18n.on': True,",
            "                'tools.i18n.default': 'en_US',",
            "                'tools.i18n.mo_dir': pkg_resources.resource_filename('rdiffweb', 'locales'),  # @UndefinedVariable",
            "                'tools.i18n.domain': 'messages',",
            "                'tools.encode.on': True,",
            "                'tools.encode.encoding': 'utf-8',",
            "                'tools.gzip.on': True,",
            "                'error_page.default': self.error_page,",
            "                'tools.sessions.on': True,",
            "                'tools.sessions.debug': cfg.debug,",
            "                'tools.sessions.storage_class': session_storage_class,",
            "                'tools.sessions.storage_path': self._session_dir,",
            "                'tools.sessions.httponly': True,",
            "                'tools.ratelimit.debug': cfg.debug,",
            "                'tools.ratelimit.delay': 60,",
            "                'tools.ratelimit.anonymous_limit': cfg.rate_limit,",
            "                'tools.ratelimit.storage_class': rate_limit_storage_class,",
            "                'tools.ratelimit.storage_path': self._session_dir,",
            "            },",
            "        }",
            "",
            "        # Initialize the application",
            "        Application.__init__(self, root=Root(), config=config)",
            "",
            "        # Register favicon.ico",
            "        self.root.favicon_ico = staticfile(self._favicon)",
            "",
            "        # Register header_logo",
            "        if self._header_logo:",
            "            self.root.header_logo = staticfile(self._header_logo)",
            "",
            "        # Define TEMP env",
            "        if self._tempdir:",
            "            os.environ[\"TMPDIR\"] = self._tempdir",
            "",
            "        # create user manager",
            "        self.store = Store(self)",
            "        self.store.create_admin_user()",
            "",
            "    @property",
            "    def currentuser(self):",
            "        \"\"\"",
            "        Proxy property to get current user from cherrypy request object.",
            "        Return a UserObject when logged in or None.",
            "        \"\"\"",
            "        return getattr(cherrypy.serving.request, 'currentuser', None)",
            "",
            "    def _checkpassword(self, realm, username, password):",
            "        \"\"\"",
            "        Check basic authentication.",
            "        \"\"\"",
            "        return self.store.login(username, password) is not None",
            "",
            "    def error_page(self, **kwargs):",
            "        \"\"\"",
            "        Default error page shown to the user when an unexpected error occur.",
            "        \"\"\"",
            "        # Log exception.",
            "        logger.error(",
            "            'error page: %s %s\\n%s' % (kwargs.get('status', ''), kwargs.get('message', ''), kwargs.get('traceback', ''))",
            "        )",
            "",
            "        # Replace message by generic one for 404. Default implementation leak path info.",
            "        if kwargs.get('status', '') == '404 Not Found':",
            "            kwargs['message'] = 'Nothing matches the given URI'",
            "",
            "        # Check expected response type.",
            "        mtype = cherrypy.tools.accept.callable(['text/html', 'text/plain'])  # @UndefinedVariable",
            "        if mtype == 'text/plain':",
            "            return kwargs.get('message')",
            "",
            "        # Try to build a nice error page.",
            "        try:",
            "            page = Controller()",
            "            return page._compile_template('error_page_default.html', **kwargs)",
            "        except Exception:",
            "            # If failing, send the raw error message.",
            "            return kwargs.get('message')",
            "",
            "    @property",
            "    def version(self):",
            "        \"\"\"",
            "        Get the current running version (using package info).",
            "        \"\"\"",
            "        return rdiffweb.__version__"
        ],
        "action": [
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "45": [],
            "100": [
                "Root",
                "__init__"
            ],
            "104": [
                "Root",
                "__init__"
            ],
            "211": [
                "RdiffwebApp",
                "__init__"
            ],
            "215": [
                "RdiffwebApp",
                "__init__"
            ]
        },
        "addLocation": []
    }
}