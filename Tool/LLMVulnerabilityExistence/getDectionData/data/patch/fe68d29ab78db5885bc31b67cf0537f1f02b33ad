{
    "djangocms_attributes_field/__init__.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 1,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-__version__ = '3.0.0'"
            },
            "1": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 1,
                "PatchRowcode": "+__version__ = '4.0.0'"
            }
        },
        "frontPatchFile": [
            "__version__ = '3.0.0'"
        ],
        "afterPatchFile": [
            "__version__ = '4.0.0'"
        ],
        "action": [
            "2",
            "2"
        ],
        "dele_reviseLocation": {
            "1": [
                "__version__"
            ]
        },
        "addLocation": []
    },
    "djangocms_attributes_field/fields.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 14,
                "afterPatchRowNumber": 14,
                "PatchRowcode": " regex_key_validator = RegexValidator(regex=r'^[a-z][-a-z0-9_:]*\\Z',"
            },
            "1": {
                "beforePatchRowNumber": 15,
                "afterPatchRowNumber": 15,
                "PatchRowcode": "                                      flags=re.IGNORECASE, code='invalid')"
            },
            "2": {
                "beforePatchRowNumber": 16,
                "afterPatchRowNumber": 16,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 17,
                "PatchRowcode": "+default_excluded_keys = ["
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 18,
                "PatchRowcode": "+    \"src\", \"href\", \"data\", \"action\", \"on*\","
            },
            "5": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 19,
                "PatchRowcode": "+]"
            },
            "6": {
                "beforePatchRowNumber": 17,
                "afterPatchRowNumber": 20,
                "PatchRowcode": " "
            },
            "7": {
                "beforePatchRowNumber": 18,
                "afterPatchRowNumber": 21,
                "PatchRowcode": " class AttributesFormField(forms.CharField):"
            },
            "8": {
                "beforePatchRowNumber": 19,
                "afterPatchRowNumber": 22,
                "PatchRowcode": "     empty_values = [None, '']"
            },
            "9": {
                "beforePatchRowNumber": 20,
                "afterPatchRowNumber": 23,
                "PatchRowcode": " "
            },
            "10": {
                "beforePatchRowNumber": 21,
                "afterPatchRowNumber": 24,
                "PatchRowcode": "     def __init__(self, *args, **kwargs):"
            },
            "11": {
                "beforePatchRowNumber": 22,
                "afterPatchRowNumber": 25,
                "PatchRowcode": "         kwargs.setdefault('widget', AttributesWidget)"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 26,
                "PatchRowcode": "+        self.excluded_keys = kwargs.pop('excluded_keys', []) + default_excluded_keys"
            },
            "13": {
                "beforePatchRowNumber": 23,
                "afterPatchRowNumber": 27,
                "PatchRowcode": "         super().__init__(*args, **kwargs)"
            },
            "14": {
                "beforePatchRowNumber": 24,
                "afterPatchRowNumber": 28,
                "PatchRowcode": " "
            },
            "15": {
                "beforePatchRowNumber": 25,
                "afterPatchRowNumber": 29,
                "PatchRowcode": "     def to_python(self, value):"
            },
            "16": {
                "beforePatchRowNumber": 37,
                "afterPatchRowNumber": 41,
                "PatchRowcode": "         # This is required in older django versions."
            },
            "17": {
                "beforePatchRowNumber": 38,
                "afterPatchRowNumber": 42,
                "PatchRowcode": "         if value in self.empty_values and self.required:"
            },
            "18": {
                "beforePatchRowNumber": 39,
                "afterPatchRowNumber": 43,
                "PatchRowcode": "             raise forms.ValidationError(self.error_messages['required'], code='required')"
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 44,
                "PatchRowcode": "+        if isinstance(value, dict):"
            },
            "20": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 45,
                "PatchRowcode": "+            for key, val in value.items():"
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 46,
                "PatchRowcode": "+                self.validate_key(key)"
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 47,
                "PatchRowcode": "+                self.validate_value(key, val)"
            },
            "23": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 48,
                "PatchRowcode": "+"
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 49,
                "PatchRowcode": "+    def validate_key(self, key):"
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 50,
                "PatchRowcode": "+        \"\"\""
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 51,
                "PatchRowcode": "+        A key must start with a letter, but can otherwise contain letters,"
            },
            "27": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 52,
                "PatchRowcode": "+        numbers, dashes, colons or underscores. It must not also be part of"
            },
            "28": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 53,
                "PatchRowcode": "+        `excluded_keys` as configured in the field."
            },
            "29": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 54,
                "PatchRowcode": "+"
            },
            "30": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 55,
                "PatchRowcode": "+        :param key: (str) The key to validate"
            },
            "31": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 56,
                "PatchRowcode": "+        \"\"\""
            },
            "32": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 57,
                "PatchRowcode": "+        # Verify the key is not one of `excluded_keys`."
            },
            "33": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 58,
                "PatchRowcode": "+        for excluded_key in self.excluded_keys:"
            },
            "34": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 59,
                "PatchRowcode": "+            if key.lower() == excluded_key or excluded_key.endswith(\"*\") and key.lower().startswith(excluded_key[:-1]):"
            },
            "35": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 60,
                "PatchRowcode": "+                raise ValidationError("
            },
            "36": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 61,
                "PatchRowcode": "+                    _('\"{key}\" is excluded by configuration and cannot be used as '"
            },
            "37": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 62,
                "PatchRowcode": "+                      'a key.').format(key=key))"
            },
            "38": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 63,
                "PatchRowcode": "+        # Also check that it fits our permitted syntax"
            },
            "39": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 64,
                "PatchRowcode": "+        try:"
            },
            "40": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 65,
                "PatchRowcode": "+            regex_key_validator(key)"
            },
            "41": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 66,
                "PatchRowcode": "+        except ValidationError:"
            },
            "42": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 67,
                "PatchRowcode": "+            # Seems silly to catch one then raise another ValidationError, but"
            },
            "43": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 68,
                "PatchRowcode": "+            # the RegExValidator doesn't use placeholders in its error message."
            },
            "44": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 69,
                "PatchRowcode": "+            raise ValidationError("
            },
            "45": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 70,
                "PatchRowcode": "+                _('\"{key}\" is not a valid key. Keys must start with at least '"
            },
            "46": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 71,
                "PatchRowcode": "+                  'one letter and consist only of the letters, numbers, '"
            },
            "47": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 72,
                "PatchRowcode": "+                  'underscores or hyphens.').format(key=key))"
            },
            "48": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 73,
                "PatchRowcode": "+"
            },
            "49": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 74,
                "PatchRowcode": "+    def validate_value(self, key, value):"
            },
            "50": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 75,
                "PatchRowcode": "+        \"\"\""
            },
            "51": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 76,
                "PatchRowcode": "+        A value can be anything that can be JSON-ified."
            },
            "52": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 77,
                "PatchRowcode": "+"
            },
            "53": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 78,
                "PatchRowcode": "+        :param key: (str) The key of the value"
            },
            "54": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 79,
                "PatchRowcode": "+        :param value: (str) The value to validate"
            },
            "55": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 80,
                "PatchRowcode": "+        \"\"\""
            },
            "56": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 81,
                "PatchRowcode": "+        try:"
            },
            "57": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 82,
                "PatchRowcode": "+            json.dumps(value)"
            },
            "58": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 83,
                "PatchRowcode": "+        except (TypeError, ValueError):"
            },
            "59": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 84,
                "PatchRowcode": "+            raise ValidationError("
            },
            "60": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 85,
                "PatchRowcode": "+                _('The value for the key \"{key}\" is invalid. Please enter a '"
            },
            "61": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 86,
                "PatchRowcode": "+                  'value that can be represented in JSON.').format(key=key))"
            },
            "62": {
                "beforePatchRowNumber": 40,
                "afterPatchRowNumber": 87,
                "PatchRowcode": " "
            },
            "63": {
                "beforePatchRowNumber": 41,
                "afterPatchRowNumber": 88,
                "PatchRowcode": " "
            },
            "64": {
                "beforePatchRowNumber": 42,
                "afterPatchRowNumber": 89,
                "PatchRowcode": " class AttributesField(models.Field):"
            },
            "65": {
                "beforePatchRowNumber": 64,
                "afterPatchRowNumber": 111,
                "PatchRowcode": "             kwargs['default'] = kwargs.get('default', dict)"
            },
            "66": {
                "beforePatchRowNumber": 65,
                "afterPatchRowNumber": 112,
                "PatchRowcode": "         excluded_keys = kwargs.pop('excluded_keys', [])"
            },
            "67": {
                "beforePatchRowNumber": 66,
                "afterPatchRowNumber": 113,
                "PatchRowcode": "         # Note we accept uppercase letters in the param, but the comparison"
            },
            "68": {
                "beforePatchRowNumber": 67,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        # is not case sensitive. So, we coerce the input to lowercase here."
            },
            "69": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 114,
                "PatchRowcode": "+        # is not case-sensitive. So, we coerce the input to lowercase here."
            },
            "70": {
                "beforePatchRowNumber": 68,
                "afterPatchRowNumber": 115,
                "PatchRowcode": "         self.excluded_keys = [key.lower() for key in excluded_keys]"
            },
            "71": {
                "beforePatchRowNumber": 69,
                "afterPatchRowNumber": 116,
                "PatchRowcode": "         super().__init__(*args, **kwargs)"
            },
            "72": {
                "beforePatchRowNumber": 70,
                "afterPatchRowNumber": 117,
                "PatchRowcode": "         self.validate(self.get_default(), None)"
            },
            "73": {
                "beforePatchRowNumber": 75,
                "afterPatchRowNumber": 122,
                "PatchRowcode": "             'widget': AttributesWidget"
            },
            "74": {
                "beforePatchRowNumber": 76,
                "afterPatchRowNumber": 123,
                "PatchRowcode": "         }"
            },
            "75": {
                "beforePatchRowNumber": 77,
                "afterPatchRowNumber": 124,
                "PatchRowcode": "         defaults.update(**kwargs)"
            },
            "76": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 125,
                "PatchRowcode": "+        defaults[\"excluded_keys\"] = self.excluded_keys"
            },
            "77": {
                "beforePatchRowNumber": 78,
                "afterPatchRowNumber": 126,
                "PatchRowcode": "         return super().formfield(**defaults)"
            },
            "78": {
                "beforePatchRowNumber": 79,
                "afterPatchRowNumber": 127,
                "PatchRowcode": " "
            },
            "79": {
                "beforePatchRowNumber": 80,
                "afterPatchRowNumber": 128,
                "PatchRowcode": "     def from_db_value(self, value,"
            },
            "80": {
                "beforePatchRowNumber": 134,
                "afterPatchRowNumber": 182,
                "PatchRowcode": "         except ValueError:"
            },
            "81": {
                "beforePatchRowNumber": 135,
                "afterPatchRowNumber": 183,
                "PatchRowcode": "             raise ValidationError(self.error_messages['invalid'] % value)"
            },
            "82": {
                "beforePatchRowNumber": 136,
                "afterPatchRowNumber": 184,
                "PatchRowcode": " "
            },
            "83": {
                "beforePatchRowNumber": 137,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        for key, val in value.items():"
            },
            "84": {
                "beforePatchRowNumber": 138,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            self.validate_key(key)"
            },
            "85": {
                "beforePatchRowNumber": 139,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            self.validate_value(key, val)"
            },
            "86": {
                "beforePatchRowNumber": 140,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "87": {
                "beforePatchRowNumber": 141,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    def validate_key(self, key):"
            },
            "88": {
                "beforePatchRowNumber": 142,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        \"\"\""
            },
            "89": {
                "beforePatchRowNumber": 143,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        A key must start with a letter, but can otherwise contain letters,"
            },
            "90": {
                "beforePatchRowNumber": 144,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        numbers, dashes, colons or underscores. It must not also be part of"
            },
            "91": {
                "beforePatchRowNumber": 145,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        `excluded_keys` as configured in the field."
            },
            "92": {
                "beforePatchRowNumber": 146,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "93": {
                "beforePatchRowNumber": 147,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        :param key: (str) The key to validate"
            },
            "94": {
                "beforePatchRowNumber": 148,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        \"\"\""
            },
            "95": {
                "beforePatchRowNumber": 149,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        # Verify the key is not one of `excluded_keys`."
            },
            "96": {
                "beforePatchRowNumber": 150,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        if key.lower() in self.excluded_keys:"
            },
            "97": {
                "beforePatchRowNumber": 151,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            raise ValidationError("
            },
            "98": {
                "beforePatchRowNumber": 152,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                _('\"{key}\" is excluded by configuration and cannot be used as '"
            },
            "99": {
                "beforePatchRowNumber": 153,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                  'a key.').format(key=key))"
            },
            "100": {
                "beforePatchRowNumber": 154,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        # Also check that it fits our permitted syntax"
            },
            "101": {
                "beforePatchRowNumber": 155,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        try:"
            },
            "102": {
                "beforePatchRowNumber": 156,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            regex_key_validator(key)"
            },
            "103": {
                "beforePatchRowNumber": 157,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        except ValidationError:"
            },
            "104": {
                "beforePatchRowNumber": 158,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            # Seems silly to catch one then raise another ValidationError, but"
            },
            "105": {
                "beforePatchRowNumber": 159,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            # the RegExValidator doesn't use placeholders in its error message."
            },
            "106": {
                "beforePatchRowNumber": 160,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            raise ValidationError("
            },
            "107": {
                "beforePatchRowNumber": 161,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                _('\"{key}\" is not a valid key. Keys must start with at least '"
            },
            "108": {
                "beforePatchRowNumber": 162,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                  'one letter and consist only of the letters, numbers, '"
            },
            "109": {
                "beforePatchRowNumber": 163,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                  'underscores or hyphens.').format(key=key))"
            },
            "110": {
                "beforePatchRowNumber": 164,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "111": {
                "beforePatchRowNumber": 165,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    def validate_value(self, key, value):"
            },
            "112": {
                "beforePatchRowNumber": 166,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        \"\"\""
            },
            "113": {
                "beforePatchRowNumber": 167,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        A value can be anything that can be JSON-ified."
            },
            "114": {
                "beforePatchRowNumber": 168,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "115": {
                "beforePatchRowNumber": 169,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        :param key: (str) The key of the value"
            },
            "116": {
                "beforePatchRowNumber": 170,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        :param value: (str) The value to validate"
            },
            "117": {
                "beforePatchRowNumber": 171,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        \"\"\""
            },
            "118": {
                "beforePatchRowNumber": 172,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        try:"
            },
            "119": {
                "beforePatchRowNumber": 173,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            json.dumps(value)"
            },
            "120": {
                "beforePatchRowNumber": 174,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        except (TypeError, ValueError):"
            },
            "121": {
                "beforePatchRowNumber": 175,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            raise ValidationError("
            },
            "122": {
                "beforePatchRowNumber": 176,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                _('The value for the key \"{key}\" is invalid. Please enter a '"
            },
            "123": {
                "beforePatchRowNumber": 177,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                  'value that can be represented in JSON.').format(key=key))"
            },
            "124": {
                "beforePatchRowNumber": 178,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "125": {
                "beforePatchRowNumber": 179,
                "afterPatchRowNumber": 185,
                "PatchRowcode": "     def value_to_string(self, obj):"
            },
            "126": {
                "beforePatchRowNumber": 180,
                "afterPatchRowNumber": 186,
                "PatchRowcode": "         return self.value_from_object(obj)"
            },
            "127": {
                "beforePatchRowNumber": 181,
                "afterPatchRowNumber": 187,
                "PatchRowcode": " "
            }
        },
        "frontPatchFile": [
            "import json",
            "import re",
            "from functools import partial",
            "",
            "from django import forms",
            "from django.core.exceptions import ImproperlyConfigured, ValidationError",
            "from django.core.validators import RegexValidator",
            "from django.db import models",
            "from django.utils.html import conditional_escape, mark_safe",
            "from django.utils.translation import gettext_lazy as _",
            "",
            "from .widgets import AttributesWidget",
            "",
            "regex_key_validator = RegexValidator(regex=r'^[a-z][-a-z0-9_:]*\\Z',",
            "                                     flags=re.IGNORECASE, code='invalid')",
            "",
            "",
            "class AttributesFormField(forms.CharField):",
            "    empty_values = [None, '']",
            "",
            "    def __init__(self, *args, **kwargs):",
            "        kwargs.setdefault('widget', AttributesWidget)",
            "        super().__init__(*args, **kwargs)",
            "",
            "    def to_python(self, value):",
            "        if isinstance(value, str) and value:",
            "            try:",
            "                return json.loads(value)",
            "            except ValueError as exc:",
            "                raise forms.ValidationError(",
            "                    'JSON decode error: {}'.format(str(exc.args[0]))",
            "                )",
            "        else:",
            "            return value",
            "",
            "    def validate(self, value):",
            "        # This is required in older django versions.",
            "        if value in self.empty_values and self.required:",
            "            raise forms.ValidationError(self.error_messages['required'], code='required')",
            "",
            "",
            "class AttributesField(models.Field):",
            "    \"\"\"",
            "    This is an opinionated sub-class of JSONField. Here's a summary of the",
            "    primary differences:",
            "",
            "        * Instead of storing any arbitrary JSON, we stick to a flat list of",
            "          key/value pairs;",
            "        * Keys must start with a letter and only contain letters, numbers,",
            "          underscores and hyphens;",
            "        * We accept a field parameter `excluded_keys` which contains a list",
            "          of keys we do not accept and enforce this;",
            "        * Validation checks for both key format and excluded_keys are done",
            "          in a case-insensitive manner;",
            "        * The default widget is AttributesWidget from this package.",
            "    \"\"\"",
            "    default_error_messages = {",
            "        'invalid': _(\"'%s' is not a valid JSON string.\")",
            "    }",
            "    description = \"JSON object\"",
            "",
            "    def __init__(self, *args, **kwargs):",
            "        if not kwargs.get('null', False):",
            "            kwargs['default'] = kwargs.get('default', dict)",
            "        excluded_keys = kwargs.pop('excluded_keys', [])",
            "        # Note we accept uppercase letters in the param, but the comparison",
            "        # is not case sensitive. So, we coerce the input to lowercase here.",
            "        self.excluded_keys = [key.lower() for key in excluded_keys]",
            "        super().__init__(*args, **kwargs)",
            "        self.validate(self.get_default(), None)",
            "",
            "    def formfield(self, **kwargs):",
            "        defaults = {",
            "            'form_class': AttributesFormField,",
            "            'widget': AttributesWidget",
            "        }",
            "        defaults.update(**kwargs)",
            "        return super().formfield(**defaults)",
            "",
            "    def from_db_value(self, value,",
            "                      expression=None, connection=None, context=None):",
            "        \"\"\"",
            "        This is a temporary workaround for #7 taken from",
            "        https://bitbucket.org/schinckel/django-jsonfield/pull-requests/32/make-from_db_value-compatible-with/diff",
            "        See there for full discussion",
            "        \"\"\"",
            "        if value is None:",
            "            return None",
            "        elif isinstance(value, str):",
            "            return json.loads(value)",
            "        else:",
            "            return value",
            "",
            "    def get_db_prep_value(self, value, connection=None, prepared=None):",
            "        return self.get_prep_value(value)",
            "",
            "    def get_prep_value(self, value):",
            "        if value is None:",
            "            if not self.null and self.blank:",
            "                return \"\"",
            "            return None",
            "        return json.dumps(value)",
            "",
            "    def get_default(self):",
            "        if self.has_default():",
            "            default = self.default",
            "            if callable(default):",
            "                default = default()",
            "            if isinstance(default, str):",
            "                return json.loads(default)",
            "            return json.loads(json.dumps(default))",
            "        return super().get_default()",
            "",
            "    def get_internal_type(self):",
            "        return 'TextField'",
            "",
            "    def contribute_to_class(self, cls, name, **kwargs):",
            "        \"\"\"",
            "        Adds a @property: \u00abname\u00bb_str that returns a string representation of",
            "        the attributes ready for inclusion on an HTML element.",
            "        \"\"\"",
            "        super().contribute_to_class(cls, name, **kwargs)",
            "        # Make sure we're not going to clobber something that already exists.",
            "        property_name = f'{name}_str'",
            "        if not hasattr(cls, property_name):",
            "            str_property = partial(self.to_str, field_name=name)",
            "            setattr(cls, property_name, property(str_property))",
            "",
            "    def validate(self, value, model_instance):",
            "        if not self.null and value is None:",
            "            raise ValidationError(self.error_messages['null'])",
            "        try:",
            "            self.get_prep_value(value)",
            "        except ValueError:",
            "            raise ValidationError(self.error_messages['invalid'] % value)",
            "",
            "        for key, val in value.items():",
            "            self.validate_key(key)",
            "            self.validate_value(key, val)",
            "",
            "    def validate_key(self, key):",
            "        \"\"\"",
            "        A key must start with a letter, but can otherwise contain letters,",
            "        numbers, dashes, colons or underscores. It must not also be part of",
            "        `excluded_keys` as configured in the field.",
            "",
            "        :param key: (str) The key to validate",
            "        \"\"\"",
            "        # Verify the key is not one of `excluded_keys`.",
            "        if key.lower() in self.excluded_keys:",
            "            raise ValidationError(",
            "                _('\"{key}\" is excluded by configuration and cannot be used as '",
            "                  'a key.').format(key=key))",
            "        # Also check that it fits our permitted syntax",
            "        try:",
            "            regex_key_validator(key)",
            "        except ValidationError:",
            "            # Seems silly to catch one then raise another ValidationError, but",
            "            # the RegExValidator doesn't use placeholders in its error message.",
            "            raise ValidationError(",
            "                _('\"{key}\" is not a valid key. Keys must start with at least '",
            "                  'one letter and consist only of the letters, numbers, '",
            "                  'underscores or hyphens.').format(key=key))",
            "",
            "    def validate_value(self, key, value):",
            "        \"\"\"",
            "        A value can be anything that can be JSON-ified.",
            "",
            "        :param key: (str) The key of the value",
            "        :param value: (str) The value to validate",
            "        \"\"\"",
            "        try:",
            "            json.dumps(value)",
            "        except (TypeError, ValueError):",
            "            raise ValidationError(",
            "                _('The value for the key \"{key}\" is invalid. Please enter a '",
            "                  'value that can be represented in JSON.').format(key=key))",
            "",
            "    def value_to_string(self, obj):",
            "        return self.value_from_object(obj)",
            "",
            "    @classmethod",
            "    def to_str(cls, obj, field_name):",
            "        \"\"\"",
            "        Emits stored attributes as a String suitable for for adding to an",
            "        HTML element and performs an outbound filter of excluded_keys.",
            "        \"\"\"",
            "        # We are explicitly ignoring keys in `excluded_keys` here. The field",
            "        # itself prevents *new* keys from being created that are configured in the",
            "        # field parameter `excluded_keys`. This utility uses the same",
            "        # configuration to prevent any keys in `excluded_keys` from *existing*",
            "        # objects from being emitted.",
            "",
            "        if not hasattr(obj, field_name):",
            "            raise ImproperlyConfigured(",
            "                _('\"{field_name}\" is not a field of {obj|r}').format(",
            "                    obj=obj, field_name=field_name))",
            "",
            "        opts = obj._meta",
            "        field = opts.get_field(field_name)",
            "",
            "        if not isinstance(field, cls):",
            "            raise TypeError(",
            "                _('\"{field_name}\" is not an AttributesField').format(",
            "                    field_name=field_name))",
            "",
            "        excluded_keys = field.excluded_keys",
            "        value = getattr(obj, field_name)",
            "        try:",
            "            value_items = value.items()",
            "        except AttributeError:",
            "            value_items = [value]",
            "",
            "        attrs = []",
            "        for key, val in value_items:",
            "            if key.lower() not in excluded_keys:",
            "                if val:",
            "                    attrs.append(f'{key}=\"{conditional_escape(val)}\"')",
            "                else:",
            "                    attrs.append(f'{key}')",
            "        return mark_safe(\" \".join(attrs))"
        ],
        "afterPatchFile": [
            "import json",
            "import re",
            "from functools import partial",
            "",
            "from django import forms",
            "from django.core.exceptions import ImproperlyConfigured, ValidationError",
            "from django.core.validators import RegexValidator",
            "from django.db import models",
            "from django.utils.html import conditional_escape, mark_safe",
            "from django.utils.translation import gettext_lazy as _",
            "",
            "from .widgets import AttributesWidget",
            "",
            "regex_key_validator = RegexValidator(regex=r'^[a-z][-a-z0-9_:]*\\Z',",
            "                                     flags=re.IGNORECASE, code='invalid')",
            "",
            "default_excluded_keys = [",
            "    \"src\", \"href\", \"data\", \"action\", \"on*\",",
            "]",
            "",
            "class AttributesFormField(forms.CharField):",
            "    empty_values = [None, '']",
            "",
            "    def __init__(self, *args, **kwargs):",
            "        kwargs.setdefault('widget', AttributesWidget)",
            "        self.excluded_keys = kwargs.pop('excluded_keys', []) + default_excluded_keys",
            "        super().__init__(*args, **kwargs)",
            "",
            "    def to_python(self, value):",
            "        if isinstance(value, str) and value:",
            "            try:",
            "                return json.loads(value)",
            "            except ValueError as exc:",
            "                raise forms.ValidationError(",
            "                    'JSON decode error: {}'.format(str(exc.args[0]))",
            "                )",
            "        else:",
            "            return value",
            "",
            "    def validate(self, value):",
            "        # This is required in older django versions.",
            "        if value in self.empty_values and self.required:",
            "            raise forms.ValidationError(self.error_messages['required'], code='required')",
            "        if isinstance(value, dict):",
            "            for key, val in value.items():",
            "                self.validate_key(key)",
            "                self.validate_value(key, val)",
            "",
            "    def validate_key(self, key):",
            "        \"\"\"",
            "        A key must start with a letter, but can otherwise contain letters,",
            "        numbers, dashes, colons or underscores. It must not also be part of",
            "        `excluded_keys` as configured in the field.",
            "",
            "        :param key: (str) The key to validate",
            "        \"\"\"",
            "        # Verify the key is not one of `excluded_keys`.",
            "        for excluded_key in self.excluded_keys:",
            "            if key.lower() == excluded_key or excluded_key.endswith(\"*\") and key.lower().startswith(excluded_key[:-1]):",
            "                raise ValidationError(",
            "                    _('\"{key}\" is excluded by configuration and cannot be used as '",
            "                      'a key.').format(key=key))",
            "        # Also check that it fits our permitted syntax",
            "        try:",
            "            regex_key_validator(key)",
            "        except ValidationError:",
            "            # Seems silly to catch one then raise another ValidationError, but",
            "            # the RegExValidator doesn't use placeholders in its error message.",
            "            raise ValidationError(",
            "                _('\"{key}\" is not a valid key. Keys must start with at least '",
            "                  'one letter and consist only of the letters, numbers, '",
            "                  'underscores or hyphens.').format(key=key))",
            "",
            "    def validate_value(self, key, value):",
            "        \"\"\"",
            "        A value can be anything that can be JSON-ified.",
            "",
            "        :param key: (str) The key of the value",
            "        :param value: (str) The value to validate",
            "        \"\"\"",
            "        try:",
            "            json.dumps(value)",
            "        except (TypeError, ValueError):",
            "            raise ValidationError(",
            "                _('The value for the key \"{key}\" is invalid. Please enter a '",
            "                  'value that can be represented in JSON.').format(key=key))",
            "",
            "",
            "class AttributesField(models.Field):",
            "    \"\"\"",
            "    This is an opinionated sub-class of JSONField. Here's a summary of the",
            "    primary differences:",
            "",
            "        * Instead of storing any arbitrary JSON, we stick to a flat list of",
            "          key/value pairs;",
            "        * Keys must start with a letter and only contain letters, numbers,",
            "          underscores and hyphens;",
            "        * We accept a field parameter `excluded_keys` which contains a list",
            "          of keys we do not accept and enforce this;",
            "        * Validation checks for both key format and excluded_keys are done",
            "          in a case-insensitive manner;",
            "        * The default widget is AttributesWidget from this package.",
            "    \"\"\"",
            "    default_error_messages = {",
            "        'invalid': _(\"'%s' is not a valid JSON string.\")",
            "    }",
            "    description = \"JSON object\"",
            "",
            "    def __init__(self, *args, **kwargs):",
            "        if not kwargs.get('null', False):",
            "            kwargs['default'] = kwargs.get('default', dict)",
            "        excluded_keys = kwargs.pop('excluded_keys', [])",
            "        # Note we accept uppercase letters in the param, but the comparison",
            "        # is not case-sensitive. So, we coerce the input to lowercase here.",
            "        self.excluded_keys = [key.lower() for key in excluded_keys]",
            "        super().__init__(*args, **kwargs)",
            "        self.validate(self.get_default(), None)",
            "",
            "    def formfield(self, **kwargs):",
            "        defaults = {",
            "            'form_class': AttributesFormField,",
            "            'widget': AttributesWidget",
            "        }",
            "        defaults.update(**kwargs)",
            "        defaults[\"excluded_keys\"] = self.excluded_keys",
            "        return super().formfield(**defaults)",
            "",
            "    def from_db_value(self, value,",
            "                      expression=None, connection=None, context=None):",
            "        \"\"\"",
            "        This is a temporary workaround for #7 taken from",
            "        https://bitbucket.org/schinckel/django-jsonfield/pull-requests/32/make-from_db_value-compatible-with/diff",
            "        See there for full discussion",
            "        \"\"\"",
            "        if value is None:",
            "            return None",
            "        elif isinstance(value, str):",
            "            return json.loads(value)",
            "        else:",
            "            return value",
            "",
            "    def get_db_prep_value(self, value, connection=None, prepared=None):",
            "        return self.get_prep_value(value)",
            "",
            "    def get_prep_value(self, value):",
            "        if value is None:",
            "            if not self.null and self.blank:",
            "                return \"\"",
            "            return None",
            "        return json.dumps(value)",
            "",
            "    def get_default(self):",
            "        if self.has_default():",
            "            default = self.default",
            "            if callable(default):",
            "                default = default()",
            "            if isinstance(default, str):",
            "                return json.loads(default)",
            "            return json.loads(json.dumps(default))",
            "        return super().get_default()",
            "",
            "    def get_internal_type(self):",
            "        return 'TextField'",
            "",
            "    def contribute_to_class(self, cls, name, **kwargs):",
            "        \"\"\"",
            "        Adds a @property: \u00abname\u00bb_str that returns a string representation of",
            "        the attributes ready for inclusion on an HTML element.",
            "        \"\"\"",
            "        super().contribute_to_class(cls, name, **kwargs)",
            "        # Make sure we're not going to clobber something that already exists.",
            "        property_name = f'{name}_str'",
            "        if not hasattr(cls, property_name):",
            "            str_property = partial(self.to_str, field_name=name)",
            "            setattr(cls, property_name, property(str_property))",
            "",
            "    def validate(self, value, model_instance):",
            "        if not self.null and value is None:",
            "            raise ValidationError(self.error_messages['null'])",
            "        try:",
            "            self.get_prep_value(value)",
            "        except ValueError:",
            "            raise ValidationError(self.error_messages['invalid'] % value)",
            "",
            "    def value_to_string(self, obj):",
            "        return self.value_from_object(obj)",
            "",
            "    @classmethod",
            "    def to_str(cls, obj, field_name):",
            "        \"\"\"",
            "        Emits stored attributes as a String suitable for for adding to an",
            "        HTML element and performs an outbound filter of excluded_keys.",
            "        \"\"\"",
            "        # We are explicitly ignoring keys in `excluded_keys` here. The field",
            "        # itself prevents *new* keys from being created that are configured in the",
            "        # field parameter `excluded_keys`. This utility uses the same",
            "        # configuration to prevent any keys in `excluded_keys` from *existing*",
            "        # objects from being emitted.",
            "",
            "        if not hasattr(obj, field_name):",
            "            raise ImproperlyConfigured(",
            "                _('\"{field_name}\" is not a field of {obj|r}').format(",
            "                    obj=obj, field_name=field_name))",
            "",
            "        opts = obj._meta",
            "        field = opts.get_field(field_name)",
            "",
            "        if not isinstance(field, cls):",
            "            raise TypeError(",
            "                _('\"{field_name}\" is not an AttributesField').format(",
            "                    field_name=field_name))",
            "",
            "        excluded_keys = field.excluded_keys",
            "        value = getattr(obj, field_name)",
            "        try:",
            "            value_items = value.items()",
            "        except AttributeError:",
            "            value_items = [value]",
            "",
            "        attrs = []",
            "        for key, val in value_items:",
            "            if key.lower() not in excluded_keys:",
            "                if val:",
            "                    attrs.append(f'{key}=\"{conditional_escape(val)}\"')",
            "                else:",
            "                    attrs.append(f'{key}')",
            "        return mark_safe(\" \".join(attrs))"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "67": [
                "AttributesField",
                "__init__"
            ],
            "137": [
                "AttributesField",
                "validate"
            ],
            "138": [
                "AttributesField",
                "validate"
            ],
            "139": [
                "AttributesField",
                "validate"
            ],
            "140": [
                "AttributesField"
            ],
            "141": [
                "AttributesField",
                "validate_key"
            ],
            "142": [
                "AttributesField",
                "validate_key"
            ],
            "143": [
                "AttributesField",
                "validate_key"
            ],
            "144": [
                "AttributesField",
                "validate_key"
            ],
            "145": [
                "AttributesField",
                "validate_key"
            ],
            "146": [
                "AttributesField",
                "validate_key"
            ],
            "147": [
                "AttributesField",
                "validate_key"
            ],
            "148": [
                "AttributesField",
                "validate_key"
            ],
            "149": [
                "AttributesField",
                "validate_key"
            ],
            "150": [
                "AttributesField",
                "validate_key"
            ],
            "151": [
                "AttributesField",
                "validate_key"
            ],
            "152": [
                "AttributesField",
                "validate_key"
            ],
            "153": [
                "AttributesField",
                "validate_key"
            ],
            "154": [
                "AttributesField",
                "validate_key"
            ],
            "155": [
                "AttributesField",
                "validate_key"
            ],
            "156": [
                "AttributesField",
                "validate_key"
            ],
            "157": [
                "AttributesField",
                "validate_key"
            ],
            "158": [
                "AttributesField",
                "validate_key"
            ],
            "159": [
                "AttributesField",
                "validate_key"
            ],
            "160": [
                "AttributesField",
                "validate_key"
            ],
            "161": [
                "AttributesField",
                "validate_key"
            ],
            "162": [
                "AttributesField",
                "validate_key"
            ],
            "163": [
                "AttributesField",
                "validate_key"
            ],
            "164": [
                "AttributesField"
            ],
            "165": [
                "AttributesField",
                "validate_value"
            ],
            "166": [
                "AttributesField",
                "validate_value"
            ],
            "167": [
                "AttributesField",
                "validate_value"
            ],
            "168": [
                "AttributesField",
                "validate_value"
            ],
            "169": [
                "AttributesField",
                "validate_value"
            ],
            "170": [
                "AttributesField",
                "validate_value"
            ],
            "171": [
                "AttributesField",
                "validate_value"
            ],
            "172": [
                "AttributesField",
                "validate_value"
            ],
            "173": [
                "AttributesField",
                "validate_value"
            ],
            "174": [
                "AttributesField",
                "validate_value"
            ],
            "175": [
                "AttributesField",
                "validate_value"
            ],
            "176": [
                "AttributesField",
                "validate_value"
            ],
            "177": [
                "AttributesField",
                "validate_value"
            ],
            "178": [
                "AttributesField"
            ]
        },
        "addLocation": [
            "djangocms_attributes_field.fields.AttributesFormField"
        ]
    }
}