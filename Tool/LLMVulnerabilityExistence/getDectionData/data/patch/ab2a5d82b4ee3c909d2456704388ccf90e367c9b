{
    "wagtail/admin/tests/viewsets/test_model_viewset.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 1474,
                "afterPatchRowNumber": 1474,
                "PatchRowcode": "         modal_workflow_script = soup.select_one(f'script[src=\"{modal_workflow_js}\"]')"
            },
            "1": {
                "beforePatchRowNumber": 1475,
                "afterPatchRowNumber": 1475,
                "PatchRowcode": "         self.assertIsNotNone(modal_workflow_script)"
            },
            "2": {
                "beforePatchRowNumber": 1476,
                "afterPatchRowNumber": 1476,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": 1477,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    def test_field_permissions(self):"
            },
            "4": {
                "beforePatchRowNumber": 1478,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user.is_superuser = False"
            },
            "5": {
                "beforePatchRowNumber": 1479,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user.save()"
            },
            "6": {
                "beforePatchRowNumber": 1480,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user.user_permissions.add("
            },
            "7": {
                "beforePatchRowNumber": 1481,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            Permission.objects.get("
            },
            "8": {
                "beforePatchRowNumber": 1482,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                content_type__app_label=\"wagtailadmin\", codename=\"access_admin\""
            },
            "9": {
                "beforePatchRowNumber": 1483,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            ),"
            },
            "10": {
                "beforePatchRowNumber": 1484,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            Permission.objects.get("
            },
            "11": {
                "beforePatchRowNumber": 1485,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                content_type__app_label=self.object._meta.app_label,"
            },
            "12": {
                "beforePatchRowNumber": 1486,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                codename=get_permission_codename(\"change\", self.object._meta),"
            },
            "13": {
                "beforePatchRowNumber": 1487,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            ),"
            },
            "14": {
                "beforePatchRowNumber": 1488,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        )"
            },
            "15": {
                "beforePatchRowNumber": 1489,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "16": {
                "beforePatchRowNumber": 1490,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        response = self.client.get(self.url)"
            },
            "17": {
                "beforePatchRowNumber": 1491,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertEqual(response.status_code, 200)"
            },
            "18": {
                "beforePatchRowNumber": 1492,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertEqual(list(response.context[\"form\"].fields), [\"name\"])"
            },
            "19": {
                "beforePatchRowNumber": 1493,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "20": {
                "beforePatchRowNumber": 1494,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user.user_permissions.add("
            },
            "21": {
                "beforePatchRowNumber": 1495,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            Permission.objects.get("
            },
            "22": {
                "beforePatchRowNumber": 1496,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                codename=\"can_set_release_date\","
            },
            "23": {
                "beforePatchRowNumber": 1497,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            )"
            },
            "24": {
                "beforePatchRowNumber": 1498,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        )"
            },
            "25": {
                "beforePatchRowNumber": 1499,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "26": {
                "beforePatchRowNumber": 1500,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        response = self.client.get(self.url)"
            },
            "27": {
                "beforePatchRowNumber": 1501,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertEqual(response.status_code, 200)"
            },
            "28": {
                "beforePatchRowNumber": 1502,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertEqual("
            },
            "29": {
                "beforePatchRowNumber": 1503,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            list(response.context[\"form\"].fields), [\"name\", \"release_date\"]"
            },
            "30": {
                "beforePatchRowNumber": 1504,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        )"
            },
            "31": {
                "beforePatchRowNumber": 1505,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "32": {
                "beforePatchRowNumber": 1506,
                "afterPatchRowNumber": 1477,
                "PatchRowcode": " "
            },
            "33": {
                "beforePatchRowNumber": 1507,
                "afterPatchRowNumber": 1478,
                "PatchRowcode": " class TestDefaultMessages(WagtailTestUtils, TestCase):"
            },
            "34": {
                "beforePatchRowNumber": 1508,
                "afterPatchRowNumber": 1479,
                "PatchRowcode": "     def setUp(self):"
            }
        },
        "frontPatchFile": [
            "import datetime",
            "from io import BytesIO",
            "",
            "from django.conf import settings",
            "from django.contrib.admin.utils import quote",
            "from django.contrib.auth import get_permission_codename",
            "from django.contrib.auth.models import Permission",
            "from django.contrib.contenttypes.models import ContentType",
            "from django.test import RequestFactory, TestCase",
            "from django.urls import NoReverseMatch, reverse",
            "from django.utils.formats import date_format, localize",
            "from django.utils.html import escape",
            "from django.utils.timezone import make_aware",
            "from openpyxl import load_workbook",
            "",
            "from wagtail.admin.admin_url_finder import AdminURLFinder",
            "from wagtail.admin.staticfiles import versioned_static",
            "from wagtail.log_actions import log",
            "from wagtail.models import ModelLogEntry",
            "from wagtail.test.testapp.models import (",
            "    FeatureCompleteToy,",
            "    JSONStreamModel,",
            "    SearchTestModel,",
            "    VariousOnDeleteModel,",
            ")",
            "from wagtail.test.testapp.views import FCToyAlt1ViewSet",
            "from wagtail.test.utils.template_tests import AdminTemplateTestUtils",
            "from wagtail.test.utils.wagtail_tests import WagtailTestUtils",
            "from wagtail.utils.deprecation import RemovedInWagtail70Warning",
            "",
            "",
            "class TestModelViewSetGroup(WagtailTestUtils, TestCase):",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    def test_menu_items(self):",
            "        response = self.client.get(reverse(\"wagtailadmin_home\"))",
            "        self.assertEqual(response.status_code, 200)",
            "        # Menu label falls back to the title-cased app label",
            "        self.assertContains(",
            "            response,",
            "            '\"name\": \"tests\", \"label\": \"Tests\", \"icon_name\": \"folder-open-inverse\"',",
            "        )",
            "        # Title-cased from verbose_name_plural",
            "        self.assertContains(response, \"Json Stream Models\")",
            "        self.assertContains(response, reverse(\"streammodel:index\"))",
            "        self.assertEqual(reverse(\"streammodel:index\"), \"/admin/streammodel/\")",
            "        # Set on class",
            "        self.assertContains(response, \"JSON MinMaxCount StreamModel\")",
            "        self.assertContains(response, reverse(\"minmaxcount_streammodel:index\"))",
            "        self.assertEqual(",
            "            reverse(\"minmaxcount_streammodel:index\"),",
            "            \"/admin/minmaxcount-streammodel/\",",
            "        )",
            "        # Set on instance",
            "        self.assertContains(response, \"JSON BlockCounts StreamModel\")",
            "        self.assertContains(response, reverse(\"blockcounts_streammodel:index\"))",
            "        self.assertEqual(",
            "            reverse(\"blockcounts_streammodel:index\"),",
            "            \"/admin/blockcounts/streammodel/\",",
            "        )",
            "",
            "",
            "class TestTemplateConfiguration(WagtailTestUtils, TestCase):",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        cls.default = JSONStreamModel.objects.create(",
            "            body='[{\"type\": \"text\", \"value\": \"foo\"}]',",
            "        )",
            "        cls.custom = FeatureCompleteToy.objects.create(name=\"Test Toy\")",
            "",
            "    def get_default_url(self, view_name, args=()):",
            "        return reverse(f\"streammodel:{view_name}\", args=args)",
            "",
            "    def get_custom_url(self, view_name, args=()):",
            "        return reverse(f\"feature_complete_toy:{view_name}\", args=args)",
            "",
            "    def test_default_templates(self):",
            "        pk = quote(self.default.pk)",
            "        cases = {",
            "            \"index\": (",
            "                [],",
            "                \"wagtailadmin/generic/index.html\",",
            "            ),",
            "            \"index_results\": (",
            "                [],",
            "                \"wagtailadmin/generic/listing_results.html\",",
            "            ),",
            "            \"add\": (",
            "                [],",
            "                \"wagtailadmin/generic/create.html\",",
            "            ),",
            "            \"edit\": (",
            "                [pk],",
            "                \"wagtailadmin/generic/edit.html\",",
            "            ),",
            "            \"delete\": (",
            "                [pk],",
            "                \"wagtailadmin/generic/confirm_delete.html\",",
            "            ),",
            "        }",
            "        for view_name, (args, template_name) in cases.items():",
            "            with self.subTest(view_name=view_name):",
            "                response = self.client.get(self.get_default_url(view_name, args=args))",
            "                self.assertTemplateUsed(response, template_name)",
            "",
            "    def test_custom_template_lookups(self):",
            "        pk = quote(self.custom.pk)",
            "        cases = {",
            "            \"override with index_template_name\": (",
            "                \"index\",",
            "                [],",
            "                \"tests/fctoy_index.html\",",
            "            ),",
            "            \"with app label and model name\": (",
            "                \"add\",",
            "                [],",
            "                \"customprefix/tests/featurecompletetoy/create.html\",",
            "            ),",
            "            \"with app label\": (",
            "                \"edit\",",
            "                [pk],",
            "                \"customprefix/tests/edit.html\",",
            "            ),",
            "            \"without app label and model name\": (",
            "                \"delete\",",
            "                [pk],",
            "                \"customprefix/confirm_delete.html\",",
            "            ),",
            "        }",
            "        for case, (view_name, args, template_name) in cases.items():",
            "            with self.subTest(case=case):",
            "                response = self.client.get(self.get_custom_url(view_name, args=args))",
            "                self.assertTemplateUsed(response, template_name)",
            "                self.assertContains(",
            "                    response, \"<p>Some extra custom content</p>\", html=True",
            "                )",
            "",
            "    def test_wagtail_admin_template_mixin_variables_with_legacy_header(self):",
            "        pk = quote(self.custom.pk)",
            "        cases = {",
            "            \"delete\": ([pk], \"Delete\", str(self.custom)),",
            "        }",
            "        for view_name, (args, title, subtitle) in cases.items():",
            "            with self.subTest(view_name=view_name):",
            "                response = self.client.get(self.get_custom_url(view_name, args=args))",
            "                soup = self.get_soup(response.content)",
            "                h1 = soup.select_one(\"h1\")",
            "                self.assertIsNotNone(h1)",
            "                self.assertEqual(",
            "                    \"\".join(h1.find_all(string=True, recursive=False)).strip(), title",
            "                )",
            "                subtitle_el = h1.select_one(\"span\")",
            "                if subtitle:",
            "                    self.assertIsNotNone(subtitle_el)",
            "                    self.assertEqual(subtitle_el.string, subtitle)",
            "                else:",
            "                    self.assertIsNone(subtitle_el)",
            "                icon = h1.select_one(\"svg use[href='#icon-media']\")",
            "                self.assertIsNotNone(icon)",
            "",
            "    def test_wagtail_admin_template_mixin_variables(self):",
            "        pk = quote(self.custom.pk)",
            "        cases = {",
            "            \"index\": ([], \"Feature complete toys\", None),",
            "            \"add\": ([], \"New\", \"Feature complete toy\"),",
            "            \"edit\": ([pk], \"Editing\", str(self.custom)),",
            "        }",
            "        for view_name, (args, title, subtitle) in cases.items():",
            "            with self.subTest(view_name=view_name):",
            "                response = self.client.get(self.get_custom_url(view_name, args=args))",
            "                soup = self.get_soup(response.content)",
            "                h1 = soup.select_one(\"h1\")",
            "                expected_h1 = title",
            "                if subtitle:",
            "                    expected_h1 = f\"{title}: {subtitle}\"",
            "                self.assertIsNotNone(h1)",
            "                self.assertEqual(h1.get_text(strip=True), expected_h1)",
            "                icon = h1.select_one(\"svg use[href='#icon-media']\")",
            "                # Icon is no longer rendered in the h1 with the slim header in place",
            "                self.assertIsNone(icon)",
            "",
            "",
            "class TestCustomColumns(WagtailTestUtils, TestCase):",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        FeatureCompleteToy.objects.create(name=\"Racecar\")",
            "        FeatureCompleteToy.objects.create(name=\"level\")",
            "        FeatureCompleteToy.objects.create(name=\"Lotso\")",
            "",
            "    def test_list_display(self):",
            "        index_url = reverse(\"feature_complete_toy:index\")",
            "        response = self.client.get(index_url)",
            "        # \"name\" column",
            "        self.assertContains(response, \"Racecar\")",
            "        self.assertContains(response, \"level\")",
            "        self.assertContains(response, \"Lotso\")",
            "        # BooleanColumn(\"is_cool\")",
            "        soup = self.get_soup(response.content)",
            "",
            "        help = soup.select_one(\"td:has(svg.icon-help)\")",
            "        self.assertIsNotNone(help)",
            "        self.assertEqual(help.text.strip(), \"None\")",
            "",
            "        success = soup.select_one(\"td:has(svg.icon-success.w-text-positive-100)\")",
            "        self.assertIsNotNone(success)",
            "        self.assertEqual(success.text.strip(), \"True\")",
            "",
            "        error = soup.select_one(\"td:has(svg.icon-error.w-text-critical-100)\")",
            "        self.assertIsNotNone(error)",
            "        self.assertEqual(error.text.strip(), \"False\")",
            "",
            "        updated_at = soup.select(\"th a\")[-1]",
            "        self.assertEqual(updated_at.text.strip(), \"Updated\")",
            "        self.assertEqual(updated_at[\"href\"], f\"{index_url}?ordering=_updated_at\")",
            "",
            "",
            "class TestListFilter(WagtailTestUtils, TestCase):",
            "    cases = {",
            "        \"list\": (\"feature_complete_toy\", \"release_date\", \"Release date\"),",
            "        \"dict\": (\"fctoy_alt1\", \"name__icontains\", \"Name contains\"),",
            "        \"filterset_class\": (",
            "            \"fctoy-alt2\",",
            "            \"release_date__year__lte\",",
            "            \"Release date year is less than or equal to\",",
            "        ),",
            "    }",
            "",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    def get(self, url_namespace, params=None):",
            "        return self.client.get(reverse(f\"{url_namespace}:index\"), params)",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        FeatureCompleteToy.objects.create(",
            "            name=\"Buzz Lightyear\",",
            "            release_date=datetime.date(1995, 11, 19),",
            "        )",
            "        FeatureCompleteToy.objects.create(",
            "            name=\"Forky\",",
            "            release_date=datetime.date(2019, 6, 11),",
            "        )",
            "",
            "    def test_unfiltered_no_results(self):",
            "        FeatureCompleteToy.objects.all().delete()",
            "        for case, (url_namespace, lookup, label_text) in self.cases.items():",
            "            with self.subTest(case=case):",
            "                response = self.get(url_namespace)",
            "                self.assertContains(",
            "                    response,",
            "                    \"There are no feature complete toys to display\",",
            "                )",
            "                self.assertNotContains(",
            "                    response,",
            "                    \"No feature complete toys match your query\",",
            "                )",
            "                self.assertNotContains(response, \"Buzz Lightyear\")",
            "                self.assertNotContains(response, \"Forky\")",
            "",
            "                soup = self.get_soup(response.content)",
            "                label = soup.select_one(f\"label#id_{lookup}-label\")",
            "                self.assertIsNotNone(label)",
            "                self.assertEqual(label.string.strip(), label_text)",
            "                input = soup.select_one(f\"input#id_{lookup}\")",
            "                self.assertIsNotNone(input)",
            "",
            "    def test_unfiltered_with_results(self):",
            "        for case, (url_namespace, lookup, label_text) in self.cases.items():",
            "            with self.subTest(case=case):",
            "                response = self.get(url_namespace)",
            "                self.assertContains(response, \"Buzz Lightyear\")",
            "                self.assertContains(response, \"Forky\")",
            "                self.assertNotContains(response, \"There are 2 matches\")",
            "                self.assertNotContains(",
            "                    response,",
            "                    \"There are no feature complete toys to display\",",
            "                )",
            "                self.assertNotContains(",
            "                    response,",
            "                    \"No feature complete toys match your query\",",
            "                )",
            "",
            "                soup = self.get_soup(response.content)",
            "                label = soup.select_one(f\"label#id_{lookup}-label\")",
            "                self.assertIsNotNone(label)",
            "                self.assertEqual(label.string.strip(), label_text)",
            "                input = soup.select_one(f\"input#id_{lookup}\")",
            "                self.assertIsNotNone(input)",
            "",
            "    def test_empty_filter_with_results(self):",
            "        for case, (url_namespace, lookup, label_text) in self.cases.items():",
            "            with self.subTest(case=case):",
            "                response = self.get(url_namespace, {lookup: \"\"})",
            "                self.assertContains(response, \"Buzz Lightyear\")",
            "                self.assertContains(response, \"Forky\")",
            "                self.assertNotContains(response, \"There are 2 matches\")",
            "                self.assertNotContains(",
            "                    response,",
            "                    \"No feature complete toys match your query\",",
            "                )",
            "",
            "                soup = self.get_soup(response.content)",
            "                label = soup.select_one(f\"label#id_{lookup}-label\")",
            "                self.assertIsNotNone(label)",
            "                self.assertEqual(label.string.strip(), label_text)",
            "                input = soup.select_one(f\"input#id_{lookup}\")",
            "                self.assertIsNotNone(input)",
            "                self.assertFalse(input.attrs.get(\"value\"))",
            "",
            "    def test_filtered_no_results(self):",
            "        lookup_values = {",
            "            \"release_date\": \"1999-09-09\",",
            "            \"name__icontains\": \"Woody\",",
            "            \"release_date__year__lte\": \"1990\",",
            "        }",
            "        for case, (url_namespace, lookup, label_text) in self.cases.items():",
            "            with self.subTest(case=case):",
            "                value = lookup_values[lookup]",
            "                response = self.get(url_namespace, {lookup: value})",
            "                self.assertContains(",
            "                    response,",
            "                    \"No feature complete toys match your query\",",
            "                )",
            "                self.assertNotContains(response, \"Buzz Lightyear\")",
            "                self.assertNotContains(response, \"Forky\")",
            "                self.assertNotContains(response, \"There are 2 matches\")",
            "",
            "                soup = self.get_soup(response.content)",
            "                label = soup.select_one(f\"label#id_{lookup}-label\")",
            "                self.assertIsNotNone(label)",
            "                self.assertEqual(label.string.strip(), label_text)",
            "                input = soup.select_one(f\"input#id_{lookup}\")",
            "                self.assertIsNotNone(input)",
            "                self.assertEqual(input.attrs.get(\"value\"), value)",
            "",
            "                # Should render the active filters even when there are no results",
            "                active_filters = soup.select_one(\".w-active-filters\")",
            "                self.assertIsNotNone(active_filters)",
            "                clear = active_filters.select_one(\".w-pill__remove\")",
            "                self.assertIsNotNone(clear)",
            "                url, params = clear.attrs.get(\"data-w-swap-src-value\").split(\"?\", 1)",
            "                self.assertEqual(url, reverse(f\"{url_namespace}:index_results\"))",
            "                self.assertNotIn(f\"{lookup}={value}\", params)",
            "",
            "    def test_filtered_with_results(self):",
            "        lookup_values = {",
            "            \"release_date\": \"1995-11-19\",",
            "            \"name__icontains\": \"Ightyear\",",
            "            \"release_date__year__lte\": \"2017\",",
            "        }",
            "        for case, (url_namespace, lookup, label_text) in self.cases.items():",
            "            with self.subTest(case=case):",
            "                value = lookup_values[lookup]",
            "                response = self.get(url_namespace, {lookup: value})",
            "                self.assertContains(response, \"Buzz Lightyear\")",
            "                self.assertContains(response, \"There is 1 match\")",
            "                self.assertNotContains(response, \"Forky\")",
            "                self.assertNotContains(",
            "                    response,",
            "                    \"No feature complete toys match your query\",",
            "                )",
            "",
            "                soup = self.get_soup(response.content)",
            "                label = soup.select_one(f\"label#id_{lookup}-label\")",
            "                self.assertIsNotNone(label)",
            "                self.assertEqual(label.string.strip(), label_text)",
            "                input = soup.select_one(f\"input#id_{lookup}\")",
            "                self.assertIsNotNone(input)",
            "                self.assertEqual(input.attrs.get(\"value\"), value)",
            "",
            "                # Should render the active filters",
            "                active_filters = soup.select_one(\".w-active-filters\")",
            "                self.assertIsNotNone(active_filters)",
            "                clear = active_filters.select_one(\".w-pill__remove\")",
            "                self.assertIsNotNone(clear)",
            "                url, params = clear.attrs.get(\"data-w-swap-src-value\").split(\"?\", 1)",
            "                self.assertEqual(url, reverse(f\"{url_namespace}:index_results\"))",
            "                self.assertNotIn(f\"{lookup}={value}\", params)",
            "",
            "",
            "class TestSearchIndexView(WagtailTestUtils, TestCase):",
            "    url_name = \"index\"",
            "    cases = {",
            "        # With the default search backend",
            "        \"default\": (\"feature_complete_toy\", \"release_date\"),",
            "        # With Django ORM",
            "        None: (\"fctoy-alt2\", \"release_date__year__lte\"),",
            "    }",
            "",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        FeatureCompleteToy.objects.create(",
            "            name=\"Buzz Lightyear\",",
            "            release_date=datetime.date(1995, 11, 19),",
            "        )",
            "        FeatureCompleteToy.objects.create(",
            "            name=\"Forky\",",
            "            release_date=datetime.date(2019, 6, 11),",
            "        )",
            "",
            "    def assertInputRendered(self, response, search_q):",
            "        soup = self.get_soup(response.content)",
            "        input = soup.select_one(\"input#id_q\")",
            "        self.assertIsNotNone(input)",
            "        self.assertEqual(input.attrs.get(\"value\"), search_q)",
            "",
            "    def get(self, url_namespace, params=None):",
            "        return self.client.get(reverse(f\"{url_namespace}:{self.url_name}\"), params)",
            "",
            "    def test_search_disabled(self):",
            "        response = self.get(\"fctoy_alt1\", {\"q\": \"ork\"})",
            "        self.assertContains(response, \"Forky\")",
            "        self.assertContains(response, \"Buzz Lightyear\")",
            "        self.assertNotContains(response, \"There are 2 matches\")",
            "        soup = self.get_soup(response.content)",
            "        input = soup.select_one(\"input#id_q\")",
            "        self.assertIsNone(input)",
            "",
            "    def test_search_no_results(self):",
            "        for backend, (url_namespace, _) in self.cases.items():",
            "            with self.subTest(backend=backend):",
            "                response = self.get(url_namespace, {\"q\": \"Woody\"})",
            "                self.assertContains(",
            "                    response,",
            "                    \"No feature complete toys match your query\",",
            "                )",
            "                self.assertNotContains(response, \"Buzz Lightyear\")",
            "                self.assertNotContains(response, \"Forky\")",
            "                self.assertInputRendered(response, \"Woody\")",
            "",
            "    def test_search_with_results(self):",
            "        for backend, (url_namespace, _) in self.cases.items():",
            "            with self.subTest(backend=backend):",
            "                response = self.get(url_namespace, {\"q\": \"ork\"})",
            "                self.assertContains(response, \"Forky\")",
            "                self.assertNotContains(response, \"Buzz Lightyear\")",
            "                self.assertContains(response, \"There is 1 match\")",
            "                self.assertInputRendered(response, \"ork\")",
            "",
            "    def test_filtered_searched_no_results(self):",
            "        lookup_values = {",
            "            \"release_date\": \"2019-06-11\",",
            "            \"release_date__year__lte\": \"2023\",",
            "        }",
            "        for backend, (url_namespace, lookup) in self.cases.items():",
            "            with self.subTest(backend=backend):",
            "                value = lookup_values[lookup]",
            "                response = self.get(url_namespace, {\"q\": \"Woody\", lookup: value})",
            "                self.assertContains(",
            "                    response,",
            "                    \"No feature complete toys match your query\",",
            "                )",
            "                self.assertNotContains(response, \"Buzz Lightyear\")",
            "                self.assertNotContains(response, \"Forky\")",
            "                self.assertInputRendered(response, \"Woody\")",
            "",
            "    def test_filtered_searched_with_results(self):",
            "        lookup_values = {",
            "            \"release_date\": \"2019-06-11\",",
            "            \"release_date__year__lte\": \"2023\",",
            "        }",
            "        for backend, (url_namespace, lookup) in self.cases.items():",
            "            with self.subTest(backend=backend):",
            "                value = lookup_values[lookup]",
            "                response = self.get(url_namespace, {\"q\": \"ork\", lookup: value})",
            "                self.assertContains(response, \"Forky\")",
            "                self.assertNotContains(response, \"Buzz Lightyear\")",
            "                self.assertContains(response, \"There is 1 match\")",
            "                self.assertInputRendered(response, \"ork\")",
            "",
            "",
            "class TestSearchIndexResultsView(TestSearchIndexView):",
            "    url_name = \"index_results\"",
            "",
            "    def assertInputRendered(self, response, search_q):",
            "        # index_results view doesn't render the search input",
            "        pass",
            "",
            "",
            "class TestSearchFields(WagtailTestUtils, TestCase):",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        objects = [",
            "            SearchTestModel(title=\"Hello World\", body=\"This one is classic\"),",
            "            SearchTestModel(title=\"Hello Anime\", body=\"We love anime (opinions vary)\"),",
            "            SearchTestModel(title=\"Food\", body=\"I like food, do you?\"),",
            "        ]",
            "        SearchTestModel.objects.bulk_create(objects)",
            "",
            "    def setUp(self):",
            "        self.login()",
            "",
            "    def get(self, q):",
            "        return self.client.get(reverse(\"searchtest:index\"), {\"q\": q})",
            "",
            "    def test_single_result_with_body(self):",
            "        response = self.get(\"IkE\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertNotContains(response, \"Hello World\")",
            "        self.assertNotContains(response, \"Hello Anime\")",
            "        self.assertContains(response, \"Food\")",
            "",
            "    def test_multiple_results_with_title(self):",
            "        response = self.get(\"ELlo\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertContains(response, \"Hello World\")",
            "        self.assertContains(response, \"Hello Anime\")",
            "        self.assertNotContains(response, \"Food\")",
            "",
            "    def test_no_results(self):",
            "        response = self.get(\"Abra Kadabra\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertNotContains(response, \"Hello World\")",
            "        self.assertNotContains(response, \"Hello Anime\")",
            "        self.assertNotContains(response, \"Food\")",
            "",
            "",
            "class TestListExport(WagtailTestUtils, TestCase):",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        FeatureCompleteToy.objects.create(",
            "            name=\"Racecar\",",
            "            release_date=datetime.date(1995, 11, 19),",
            "        )",
            "        FeatureCompleteToy.objects.create(",
            "            name=\"LEVEL\",",
            "            release_date=datetime.date(2010, 6, 18),",
            "        )",
            "        FeatureCompleteToy.objects.create(",
            "            name=\"Catso\",",
            "            release_date=datetime.date(2010, 6, 18),",
            "        )",
            "",
            "    def test_export_disabled(self):",
            "        index_url = reverse(\"fctoy_alt1:index\")",
            "        response = self.client.get(index_url)",
            "        soup = self.get_soup(response.content)",
            "",
            "        csv_link = soup.select_one(f\"a[href='{index_url}?export=csv']\")",
            "        self.assertIsNone(csv_link)",
            "        xlsx_link = soup.select_one(f\"a[href='{index_url}?export=xlsx']\")",
            "        self.assertIsNone(xlsx_link)",
            "",
            "    def test_get_not_export_shows_export_buttons(self):",
            "        index_url = reverse(\"feature_complete_toy:index\")",
            "        response = self.client.get(index_url)",
            "        soup = self.get_soup(response.content)",
            "",
            "        csv_link = soup.select_one(f\"a[href='{index_url}?export=csv']\")",
            "        self.assertIsNotNone(csv_link)",
            "        self.assertEqual(csv_link.text.strip(), \"Download CSV\")",
            "        xlsx_link = soup.select_one(f\"a[href='{index_url}?export=xlsx']\")",
            "        self.assertIsNotNone(xlsx_link)",
            "        self.assertEqual(xlsx_link.text.strip(), \"Download XLSX\")",
            "",
            "    def test_get_filtered_shows_export_buttons_with_filters(self):",
            "        index_url = reverse(\"feature_complete_toy:index\")",
            "        response = self.client.get(index_url, {\"release_date\": \"2010-06-18\"})",
            "        soup = self.get_soup(response.content)",
            "",
            "        csv_link = soup.select_one(",
            "            f\"a[href='{index_url}?release_date=2010-06-18&export=csv']\"",
            "        )",
            "        self.assertIsNotNone(csv_link)",
            "        self.assertEqual(csv_link.text.strip(), \"Download CSV\")",
            "        xlsx_link = soup.select_one(",
            "            f\"a[href='{index_url}?release_date=2010-06-18&export=xlsx']\"",
            "        )",
            "        self.assertIsNotNone(xlsx_link)",
            "        self.assertEqual(xlsx_link.text.strip(), \"Download XLSX\")",
            "",
            "    def test_csv_export(self):",
            "        index_url = reverse(\"feature_complete_toy:index\")",
            "        response = self.client.get(index_url, {\"export\": \"csv\"})",
            "",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertEqual(",
            "            response.get(\"Content-Disposition\"),",
            "            'attachment; filename=\"feature-complete-toys.csv\"',",
            "        )",
            "",
            "        data_lines = response.getvalue().decode().strip().split(\"\\r\\n\")",
            "        self.assertEqual(data_lines[0], \"Name,Launch date,Is cool\")",
            "        self.assertEqual(data_lines[1], \"Catso,2010-06-18,False\")",
            "        self.assertEqual(data_lines[2], \"LEVEL,2010-06-18,True\")",
            "        self.assertEqual(data_lines[3], \"Racecar,1995-11-19,\")",
            "        self.assertEqual(len(data_lines), 4)",
            "",
            "    def test_csv_export_filtered(self):",
            "        index_url = reverse(\"feature_complete_toy:index\")",
            "        response = self.client.get(",
            "            index_url,",
            "            {\"release_date\": \"2010-06-18\", \"export\": \"csv\"},",
            "        )",
            "",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertEqual(",
            "            response.get(\"Content-Disposition\"),",
            "            'attachment; filename=\"feature-complete-toys.csv\"',",
            "        )",
            "",
            "        data_lines = response.getvalue().decode().strip().split(\"\\r\\n\")",
            "        self.assertEqual(data_lines[0], \"Name,Launch date,Is cool\")",
            "        self.assertEqual(data_lines[1], \"Catso,2010-06-18,False\")",
            "        self.assertEqual(data_lines[2], \"LEVEL,2010-06-18,True\")",
            "        self.assertEqual(len(data_lines), 3)",
            "",
            "    def test_xlsx_export(self):",
            "        index_url = reverse(\"feature_complete_toy:index\")",
            "        response = self.client.get(index_url, {\"export\": \"xlsx\"})",
            "",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertEqual(",
            "            response.get(\"Content-Disposition\"),",
            "            'attachment; filename=\"feature-complete-toys.xlsx\"',",
            "        )",
            "",
            "        workbook_data = response.getvalue()",
            "        worksheet = load_workbook(filename=BytesIO(workbook_data)).active",
            "        cell_array = [[cell.value for cell in row] for row in worksheet.rows]",
            "        self.assertEqual(cell_array[0], [\"Name\", \"Launch date\", \"Is cool\"])",
            "        self.assertEqual(cell_array[1], [\"Catso\", datetime.date(2010, 6, 18), False])",
            "        self.assertEqual(cell_array[2], [\"LEVEL\", datetime.date(2010, 6, 18), True])",
            "        self.assertEqual(cell_array[3], [\"Racecar\", datetime.date(1995, 11, 19), None])",
            "        self.assertEqual(len(cell_array), 4)",
            "",
            "    def test_xlsx_export_filtered(self):",
            "        index_url = reverse(\"feature_complete_toy:index\")",
            "        response = self.client.get(",
            "            index_url,",
            "            {\"release_date\": \"2010-06-18\", \"export\": \"xlsx\"},",
            "        )",
            "",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertEqual(",
            "            response.get(\"Content-Disposition\"),",
            "            'attachment; filename=\"feature-complete-toys.xlsx\"',",
            "        )",
            "",
            "        workbook_data = response.getvalue()",
            "        worksheet = load_workbook(filename=BytesIO(workbook_data)).active",
            "        cell_array = [[cell.value for cell in row] for row in worksheet.rows]",
            "        self.assertEqual(cell_array[0], [\"Name\", \"Launch date\", \"Is cool\"])",
            "        self.assertEqual(cell_array[1], [\"Catso\", datetime.date(2010, 6, 18), False])",
            "        self.assertEqual(cell_array[2], [\"LEVEL\", datetime.date(2010, 6, 18), True])",
            "        self.assertEqual(len(cell_array), 3)",
            "",
            "",
            "class TestPagination(WagtailTestUtils, TestCase):",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        objects = [FeatureCompleteToy(name=f\"Frisbee {i}\") for i in range(32)]",
            "        FeatureCompleteToy.objects.bulk_create(objects)",
            "",
            "    def test_default_list_pagination(self):",
            "        list_url = reverse(\"fctoy_alt1:index\")",
            "        response = self.client.get(list_url)",
            "",
            "        # Default is 20 per page",
            "        self.assertEqual(FeatureCompleteToy.objects.all().count(), 32)",
            "        self.assertContains(response, \"Page 1 of 2\")",
            "        self.assertContains(response, \"Next\")",
            "        self.assertContains(response, list_url + \"?p=2\")",
            "",
            "    def test_custom_list_pagination(self):",
            "        list_url = reverse(\"feature_complete_toy:index\")",
            "        response = self.client.get(list_url)",
            "",
            "        # Custom is set to display 5 per page",
            "        self.assertEqual(FeatureCompleteToy.objects.all().count(), 32)",
            "        self.assertContains(response, \"Page 1 of 7\")",
            "        self.assertContains(response, \"Next\")",
            "        self.assertContains(response, list_url + \"?p=2\")",
            "",
            "",
            "class TestOrdering(WagtailTestUtils, TestCase):",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        objects = [",
            "            FeatureCompleteToy(name=\"CCCCCCCCCC\", strid=\"1\"),",
            "            FeatureCompleteToy(name=\"AAAAAAAAAA\", strid=\"2\"),",
            "            FeatureCompleteToy(name=\"DDDDDDDDDD\", strid=\"3\"),",
            "            FeatureCompleteToy(name=\"BBBBBBBBBB\", strid=\"4\"),",
            "        ]",
            "        FeatureCompleteToy.objects.bulk_create(objects)",
            "",
            "    def test_default_order(self):",
            "        response = self.client.get(reverse(\"fctoy_alt1:index\"))",
            "        # Without ordering on the model, should be ordered descending by pk",
            "        self.assertFalse(FeatureCompleteToy._meta.ordering)",
            "        self.assertEqual(",
            "            [obj.name for obj in response.context[\"object_list\"]],",
            "            [",
            "                \"BBBBBBBBBB\",",
            "                \"DDDDDDDDDD\",",
            "                \"AAAAAAAAAA\",",
            "                \"CCCCCCCCCC\",",
            "            ],",
            "        )",
            "",
            "    def test_custom_order_from_query_args(self):",
            "        response = self.client.get(reverse(\"fctoy-alt3:index\") + \"?ordering=-name\")",
            "        self.assertFalse(FeatureCompleteToy._meta.ordering)",
            "        self.assertEqual(",
            "            [obj.name for obj in response.context[\"object_list\"]],",
            "            [",
            "                \"DDDDDDDDDD\",",
            "                \"CCCCCCCCCC\",",
            "                \"BBBBBBBBBB\",",
            "                \"AAAAAAAAAA\",",
            "            ],",
            "        )",
            "",
            "    def test_custom_order_from_view(self):",
            "        response = self.client.get(reverse(\"feature_complete_toy:index\"))",
            "        # Should respect the view's ordering",
            "        self.assertFalse(FeatureCompleteToy._meta.ordering)",
            "        self.assertEqual(",
            "            [obj.name for obj in response.context[\"object_list\"]],",
            "            [",
            "                \"AAAAAAAAAA\",",
            "                \"BBBBBBBBBB\",",
            "                \"CCCCCCCCCC\",",
            "                \"DDDDDDDDDD\",",
            "            ],",
            "        )",
            "",
            "    def test_custom_order_from_from_viewset(self):",
            "        response = self.client.get(reverse(\"fctoy-alt3:index\"))",
            "        # The view has an ordering but it is overwritten by the viewset",
            "        self.assertFalse(FeatureCompleteToy._meta.ordering)",
            "        self.assertEqual(",
            "            [obj.name for obj in response.context[\"object_list\"]],",
            "            [",
            "                \"CCCCCCCCCC\",",
            "                \"AAAAAAAAAA\",",
            "                \"DDDDDDDDDD\",",
            "                \"BBBBBBBBBB\",",
            "            ],",
            "        )",
            "",
            "",
            "class TestBreadcrumbs(AdminTemplateTestUtils, WagtailTestUtils, TestCase):",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        cls.object = FeatureCompleteToy.objects.create(name=\"Test Toy\")",
            "",
            "    def test_index_view(self):",
            "        response = self.client.get(reverse(\"feature_complete_toy:index\"))",
            "        items = [",
            "            {",
            "                \"url\": \"\",",
            "                \"label\": \"Feature complete toys\",",
            "            }",
            "        ]",
            "        self.assertBreadcrumbsItemsRendered(items, response.content)",
            "",
            "    def test_add_view(self):",
            "        response = self.client.get(reverse(\"feature_complete_toy:add\"))",
            "        items = [",
            "            {",
            "                \"url\": reverse(\"feature_complete_toy:index\"),",
            "                \"label\": \"Feature complete toys\",",
            "            },",
            "            {",
            "                \"url\": \"\",",
            "                \"label\": \"New: Feature complete toy\",",
            "            },",
            "        ]",
            "        self.assertBreadcrumbsItemsRendered(items, response.content)",
            "",
            "    def test_edit_view(self):",
            "        edit_url = reverse(\"feature_complete_toy:edit\", args=(quote(self.object.pk),))",
            "        response = self.client.get(edit_url)",
            "        items = [",
            "            {",
            "                \"url\": reverse(\"feature_complete_toy:index\"),",
            "                \"label\": \"Feature complete toys\",",
            "            },",
            "            {",
            "                \"url\": \"\",",
            "                \"label\": str(self.object),",
            "            },",
            "        ]",
            "        self.assertBreadcrumbsItemsRendered(items, response.content)",
            "",
            "    def test_delete_view(self):",
            "        delete_url = reverse(",
            "            \"feature_complete_toy:delete\",",
            "            args=(quote(self.object.pk),),",
            "        )",
            "        response = self.client.get(delete_url)",
            "        self.assertBreadcrumbsNotRendered(response.content)",
            "",
            "    def test_history_view(self):",
            "        history_url = reverse(",
            "            \"feature_complete_toy:history\",",
            "            args=(quote(self.object.pk),),",
            "        )",
            "        response = self.client.get(history_url)",
            "        items = [",
            "            {",
            "                \"url\": reverse(\"feature_complete_toy:index\"),",
            "                \"label\": \"Feature complete toys\",",
            "            },",
            "            {",
            "                \"url\": reverse(",
            "                    \"feature_complete_toy:edit\", args=(quote(self.object.pk),)",
            "                ),",
            "                \"label\": str(self.object),",
            "            },",
            "            {",
            "                \"url\": \"\",",
            "                \"label\": \"History\",",
            "                \"sublabel\": str(self.object),",
            "            },",
            "        ]",
            "        self.assertBreadcrumbsItemsRendered(items, response.content)",
            "",
            "    def test_history_view_pagination(self):",
            "        for i in range(25):",
            "            log(instance=self.object, action=\"wagtail.edit\", user=self.user)",
            "",
            "        history_url = reverse(",
            "            \"feature_complete_toy:history\",",
            "            args=(quote(self.object.pk),),",
            "        )",
            "        response = self.client.get(history_url)",
            "        self.assertContains(response, \"Page 1 of 2\")",
            "        self.assertContains(response, f'<a href=\"{history_url}?p=2\">')",
            "",
            "    def test_usage_view(self):",
            "        usage_url = reverse(",
            "            \"feature_complete_toy:usage\",",
            "            args=(quote(self.object.pk),),",
            "        )",
            "        response = self.client.get(usage_url)",
            "        items = [",
            "            {",
            "                \"url\": reverse(\"feature_complete_toy:index\"),",
            "                \"label\": \"Feature complete toys\",",
            "            },",
            "            {",
            "                \"url\": reverse(",
            "                    \"feature_complete_toy:edit\", args=(quote(self.object.pk),)",
            "                ),",
            "                \"label\": str(self.object),",
            "            },",
            "            {",
            "                \"url\": \"\",",
            "                \"label\": \"Usage\",",
            "                \"sublabel\": str(self.object),",
            "            },",
            "        ]",
            "        self.assertBreadcrumbsItemsRendered(items, response.content)",
            "",
            "    def test_usage_view_pagination(self):",
            "        for i in range(25):",
            "            VariousOnDeleteModel.objects.create(",
            "                text=f\"Toybox {i}\", cascading_toy=self.object",
            "            )",
            "",
            "        usage_url = reverse(",
            "            \"feature_complete_toy:usage\",",
            "            args=(quote(self.object.pk),),",
            "        )",
            "        response = self.client.get(usage_url)",
            "        self.assertContains(response, \"Page 1 of 2\")",
            "        self.assertContains(response, f'<a href=\"{usage_url}?p=2\">')",
            "",
            "    def test_inspect_view(self):",
            "        inspect_url = reverse(",
            "            \"feature_complete_toy:inspect\",",
            "            args=(quote(self.object.pk),),",
            "        )",
            "        response = self.client.get(inspect_url)",
            "        items = [",
            "            {",
            "                \"url\": reverse(\"feature_complete_toy:index\"),",
            "                \"label\": \"Feature complete toys\",",
            "            },",
            "            {",
            "                \"url\": reverse(",
            "                    \"feature_complete_toy:edit\", args=(quote(self.object.pk),)",
            "                ),",
            "                \"label\": str(self.object),",
            "            },",
            "            {",
            "                \"url\": \"\",",
            "                \"label\": \"Inspect\",",
            "                \"sublabel\": str(self.object),",
            "            },",
            "        ]",
            "        self.assertBreadcrumbsItemsRendered(items, response.content)",
            "",
            "",
            "class TestLegacyPatterns(WagtailTestUtils, TestCase):",
            "    # RemovedInWagtail70Warning: legacy integer pk-based URLs will be removed",
            "",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        cls.object = JSONStreamModel.objects.create(",
            "            body='[{\"type\": \"text\", \"value\": \"foo\"}]',",
            "        )",
            "",
            "    def test_legacy_edit(self):",
            "        edit_url = reverse(\"streammodel:edit\", args=(quote(self.object.pk),))",
            "        legacy_edit_url = \"/admin/streammodel/1/\"",
            "        with self.assertWarnsRegex(",
            "            RemovedInWagtail70Warning,",
            "            \"`/<pk>/` edit view URL pattern has been deprecated in favour of /edit/<pk>/.\",",
            "        ):",
            "            response = self.client.get(legacy_edit_url)",
            "        self.assertEqual(edit_url, \"/admin/streammodel/edit/1/\")",
            "        self.assertRedirects(response, edit_url, 301)",
            "",
            "    def test_legacy_delete(self):",
            "        delete_url = reverse(\"streammodel:delete\", args=(quote(self.object.pk),))",
            "        legacy_delete_url = \"/admin/streammodel/1/delete/\"",
            "        with self.assertWarnsRegex(",
            "            RemovedInWagtail70Warning,",
            "            \"`/<pk>/delete/` delete view URL pattern has been deprecated in favour of /delete/<pk>/.\",",
            "        ):",
            "            response = self.client.get(legacy_delete_url)",
            "        self.assertEqual(delete_url, \"/admin/streammodel/delete/1/\")",
            "        self.assertRedirects(response, delete_url, 301)",
            "",
            "",
            "class TestHistoryView(WagtailTestUtils, TestCase):",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        cls.user = cls.create_test_user()",
            "        cls.object = FeatureCompleteToy.objects.create(name=\"Buzz\")",
            "        cls.url = reverse(",
            "            \"feature_complete_toy:history\",",
            "            args=(quote(cls.object.pk),),",
            "        )",
            "",
            "        content_type = ContentType.objects.get_for_model(FeatureCompleteToy)",
            "        cls.timestamp_1 = datetime.datetime(2021, 9, 30, 10, 1, 0)",
            "        cls.timestamp_2 = datetime.datetime(2022, 5, 10, 12, 34, 0)",
            "        if settings.USE_TZ:",
            "            cls.timestamp_1 = make_aware(cls.timestamp_1)",
            "            cls.timestamp_2 = make_aware(cls.timestamp_2)",
            "        ModelLogEntry.objects.create(",
            "            content_type=content_type,",
            "            label=\"Test Buzz\",",
            "            action=\"wagtail.create\",",
            "            user=cls.user,",
            "            timestamp=cls.timestamp_1,",
            "            object_id=cls.object.pk,",
            "        )",
            "        ModelLogEntry.objects.create(",
            "            content_type=content_type,",
            "            label=\"Test Buzz Updated\",",
            "            action=\"wagtail.edit\",",
            "            user=cls.user,",
            "            timestamp=cls.timestamp_2,",
            "            object_id=cls.object.pk,",
            "        )",
            "",
            "    def setUp(self):",
            "        self.login(self.user)",
            "",
            "    def test_simple(self):",
            "        expected = (",
            "            (\"Edited\", str(self.user), date_format(self.timestamp_2, \"c\")),",
            "            (\"Created\", str(self.user), date_format(self.timestamp_1, \"c\")),",
            "        )",
            "        response = self.client.get(self.url)",
            "        soup = self.get_soup(response.content)",
            "        rows = soup.select(\"tbody tr\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertEqual(len(rows), 2)",
            "",
            "        rendered_rows = []",
            "        for row in rows:",
            "            cells = []",
            "            tds = row.select(\"td\")",
            "            self.assertEqual(len(tds), 3)",
            "            cells.append(tds[0].text.strip())",
            "            cells.append(tds[1].text.strip())",
            "            cells.append(tds[2].select_one(\"time\").attrs.get(\"datetime\"))",
            "            rendered_rows.append(cells)",
            "",
            "        for rendered_row, expected_row in zip(rendered_rows, expected):",
            "            self.assertSequenceEqual(rendered_row, expected_row)",
            "",
            "    def test_filters(self):",
            "        response = self.client.get(self.url, {\"action\": \"wagtail.edit\"})",
            "        soup = self.get_soup(response.content)",
            "        rows = soup.select(\"tbody tr\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertEqual(len(rows), 1)",
            "        self.assertEqual(rows[0].select_one(\"td\").text.strip(), \"Edited\")",
            "",
            "        response = self.client.get(self.url, {\"action\": \"wagtail.create\"})",
            "        soup = self.get_soup(response.content)",
            "        rows = soup.select(\"tbody tr\")",
            "        heading = soup.select_one('h2[role=\"alert\"]')",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertEqual(heading.string.strip(), \"There is 1 match\")",
            "        self.assertEqual(len(rows), 1)",
            "        self.assertEqual(rows[0].select_one(\"td\").text.strip(), \"Created\")",
            "",
            "    def test_filtered_no_results(self):",
            "        response = self.client.get(self.url, {\"timestamp_before\": \"2020-01-01\"})",
            "        soup = self.get_soup(response.content)",
            "        results = soup.select_one(\"#listing-results\")",
            "        table = soup.select_one(\"table\")",
            "        p = results.select_one(\"p\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertIsNotNone(results)",
            "        self.assertIsNone(table)",
            "        self.assertIsNotNone(p)",
            "        self.assertEqual(p.text.strip(), \"No log entries match your query.\")",
            "",
            "    def test_empty(self):",
            "        ModelLogEntry.objects.all().delete()",
            "        response = self.client.get(self.url)",
            "        soup = self.get_soup(response.content)",
            "        results = soup.select_one(\"#listing-results\")",
            "        table = soup.select_one(\"table\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertIsNotNone(results)",
            "        self.assertEqual(results.text.strip(), \"There are no log entries to display.\")",
            "        self.assertIsNone(table)",
            "",
            "    def test_edit_view_links_to_history_view(self):",
            "        edit_url = reverse(\"feature_complete_toy:edit\", args=(quote(self.object.pk),))",
            "        response = self.client.get(edit_url)",
            "        soup = self.get_soup(response.content)",
            "        header = soup.select_one(\".w-slim-header\")",
            "        history_link = header.find(\"a\", attrs={\"href\": self.url})",
            "        self.assertIsNotNone(history_link)",
            "",
            "",
            "class TestUsageView(WagtailTestUtils, TestCase):",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        cls.user = cls.create_test_user()",
            "        cls.object = FeatureCompleteToy.objects.create(name=\"Buzz\")",
            "        cls.url = reverse(",
            "            \"feature_complete_toy:usage\",",
            "            args=(quote(cls.object.pk),),",
            "        )",
            "        cls.tbx = VariousOnDeleteModel.objects.create(",
            "            text=\"Toybox\", cascading_toy=cls.object",
            "        )",
            "",
            "    def setUp(self):",
            "        self.user = self.login(self.user)",
            "",
            "    def test_simple(self):",
            "        response = self.client.get(self.url)",
            "        self.assertEqual(response.status_code, 200)",
            "",
            "        soup = self.get_soup(response.content)",
            "        h1 = soup.select_one(\"h1\")",
            "        self.assertEqual(h1.text.strip(), f\"Usage: {self.object}\")",
            "",
            "        tds = soup.select(\"tbody tr td\")",
            "        self.assertEqual(len(tds), 3)",
            "        self.assertEqual(tds[0].text.strip(), str(self.tbx))",
            "        self.assertEqual(tds[1].text.strip(), \"Various on delete model\")",
            "        self.assertEqual(tds[2].text.strip(), \"Cascading toy\")",
            "",
            "        tbx_edit_url = AdminURLFinder(self.user).get_edit_url(self.tbx)",
            "",
            "        # Link to referrer's edit view",
            "        link = tds[0].select_one(\"a\")",
            "        self.assertIsNotNone(link)",
            "        self.assertEqual(link.attrs.get(\"href\"), tbx_edit_url)",
            "",
            "        # Link to referrer's edit view with parameters for the specific field",
            "        link = tds[2].select_one(\"a\")",
            "        self.assertIsNotNone(link)",
            "        self.assertIn(tbx_edit_url, link.attrs.get(\"href\"))",
            "",
            "    def test_usage_without_permission(self):",
            "        self.user.is_superuser = False",
            "        self.user.save()",
            "        admin_permission = Permission.objects.get(",
            "            content_type__app_label=\"wagtailadmin\", codename=\"access_admin\"",
            "        )",
            "        self.user.user_permissions.add(admin_permission)",
            "",
            "        response = self.client.get(self.url)",
            "        self.assertEqual(response.status_code, 302)",
            "        self.assertRedirects(response, reverse(\"wagtailadmin_home\"))",
            "",
            "    def test_usage_without_permission_on_referrer(self):",
            "        self.user.is_superuser = False",
            "        self.user.save()",
            "        admin_permission = Permission.objects.get(",
            "            content_type__app_label=\"wagtailadmin\", codename=\"access_admin\"",
            "        )",
            "        toy_edit_permission = Permission.objects.get(",
            "            content_type__app_label=\"tests\", codename=\"change_featurecompletetoy\"",
            "        )",
            "        self.user.user_permissions.add(admin_permission, toy_edit_permission)",
            "",
            "        response = self.client.get(self.url)",
            "        self.assertEqual(response.status_code, 200)",
            "",
            "        soup = self.get_soup(response.content)",
            "        h1 = soup.select_one(\"h1\")",
            "        self.assertEqual(h1.text.strip(), f\"Usage: {self.object}\")",
            "",
            "        tds = soup.select(\"tbody tr td\")",
            "        self.assertEqual(len(tds), 3)",
            "        self.assertEqual(tds[0].text.strip(), \"(Private various on delete model)\")",
            "        self.assertEqual(tds[1].text.strip(), \"Various on delete model\")",
            "        self.assertEqual(tds[2].text.strip(), \"Cascading toy\")",
            "",
            "        # Not link to referrer's edit view",
            "        link = tds[0].select_one(\"a\")",
            "        self.assertIsNone(link)",
            "",
            "        # Not link to referrer's edit view",
            "        link = tds[2].select_one(\"a\")",
            "        self.assertIsNone(link)",
            "",
            "    def test_usage_with_describe_on_delete(self):",
            "        response = self.client.get(self.url + \"?describe_on_delete=1\")",
            "        self.assertEqual(response.status_code, 200)",
            "",
            "        soup = self.get_soup(response.content)",
            "        h1 = soup.select_one(\"h1\")",
            "        self.assertEqual(h1.text.strip(), f\"Usage: {self.object}\")",
            "",
            "        tds = soup.select(\"tbody tr td\")",
            "        self.assertEqual(len(tds), 3)",
            "        self.assertEqual(tds[0].text.strip(), str(self.tbx))",
            "        self.assertEqual(tds[1].text.strip(), \"Various on delete model\")",
            "        self.assertEqual(",
            "            tds[2].text.strip(),",
            "            \"Cascading toy: the various on delete model will also be deleted\",",
            "        )",
            "",
            "        tbx_edit_url = AdminURLFinder(self.user).get_edit_url(self.tbx)",
            "",
            "        # Link to referrer's edit view",
            "        link = tds[0].select_one(\"a\")",
            "        self.assertIsNotNone(link)",
            "        self.assertEqual(link.attrs.get(\"href\"), tbx_edit_url)",
            "",
            "        # Link to referrer's edit view with parameters for the specific field",
            "        link = tds[2].select_one(\"a\")",
            "        self.assertIsNotNone(link)",
            "        self.assertIn(tbx_edit_url, link.attrs.get(\"href\"))",
            "",
            "    def test_empty(self):",
            "        self.tbx.delete()",
            "        response = self.client.get(self.url)",
            "        soup = self.get_soup(response.content)",
            "        results = soup.select_one(\"#listing-results\")",
            "        table = soup.select_one(\"table\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertIsNotNone(results)",
            "        self.assertEqual(results.text.strip(), \"There are no results.\")",
            "        self.assertIsNone(table)",
            "",
            "    def test_edit_view_links_to_usage_view(self):",
            "        edit_url = reverse(\"feature_complete_toy:edit\", args=(quote(self.object.pk),))",
            "        response = self.client.get(edit_url)",
            "        soup = self.get_soup(response.content)",
            "        side_panel = soup.select_one(\"[data-side-panel='status']\")",
            "        usage_link = side_panel.find(\"a\", attrs={\"href\": self.url})",
            "        self.assertIsNotNone(usage_link)",
            "",
            "    def test_delete_view_links_to_usage_view(self):",
            "        edit_url = reverse(\"feature_complete_toy:delete\", args=(quote(self.object.pk),))",
            "        response = self.client.get(edit_url)",
            "        soup = self.get_soup(response.content)",
            "        usage_link = soup.find(\"a\", attrs={\"href\": self.url + \"?describe_on_delete=1\"})",
            "        self.assertIsNotNone(usage_link)",
            "",
            "",
            "class TestInspectView(WagtailTestUtils, TestCase):",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        cls.object = FeatureCompleteToy.objects.create(name=\"Test Toy\")",
            "        cls.url = reverse(\"feature_complete_toy:inspect\", args=(quote(cls.object.pk),))",
            "        cls.edit_url = reverse(",
            "            \"feature_complete_toy:edit\", args=(quote(cls.object.pk),)",
            "        )",
            "        cls.delete_url = reverse(",
            "            \"feature_complete_toy:delete\", args=(quote(cls.object.pk),)",
            "        )",
            "",
            "    def test_simple(self):",
            "        response = self.client.get(self.url)",
            "        expected_fields = [\"Strid\", \"Release date\"]",
            "        expected_values = [",
            "            # The pk may contain whitespace at the start/end, it's hard to",
            "            # distinguish from the whitespace in the HTML so just strip it",
            "            self.object.pk.strip(),",
            "            localize(self.object.release_date),",
            "        ]",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertTemplateUsed(response, \"wagtailadmin/generic/inspect.html\")",
            "        soup = self.get_soup(response.content)",
            "        fields = [dt.text.strip() for dt in soup.select(\"dt\")]",
            "        values = [dd.text.strip() for dd in soup.select(\"dd\")]",
            "        self.assertEqual(fields, expected_fields)",
            "        self.assertEqual(values, expected_values)",
            "        # One in the breadcrumb, one at the bottom",
            "        self.assertEqual(len(soup.find_all(\"a\", attrs={\"href\": self.edit_url})), 2)",
            "        self.assertEqual(len(soup.find_all(\"a\", attrs={\"href\": self.delete_url})), 1)",
            "",
            "    def test_inspect_view_fields(self):",
            "        # The alt1 viewset has a custom inspect_view_fields and inspect_view_fields_exclude",
            "        response = self.client.get(",
            "            reverse(\"fctoy_alt1:inspect\", args=(quote(self.object.pk),))",
            "        )",
            "        expected_fields = [\"Name\"]",
            "        expected_values = [\"Test Toy\"]",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertTemplateUsed(response, \"wagtailadmin/generic/inspect.html\")",
            "        soup = self.get_soup(response.content)",
            "        fields = [dt.text.strip() for dt in soup.select(\"dt\")]",
            "        values = [dd.text.strip() for dd in soup.select(\"dd\")]",
            "        self.assertEqual(fields, expected_fields)",
            "        self.assertEqual(values, expected_values)",
            "",
            "    def test_disabled(self):",
            "        # An alternate viewset for the same model without inspect_view_enabled = True",
            "        with self.assertRaises(NoReverseMatch):",
            "            reverse(\"fctoy-alt2:inspect\", args=(quote(self.object.pk),))",
            "",
            "    def test_without_permission(self):",
            "        self.user.is_superuser = False",
            "        self.user.save()",
            "        admin_permission = Permission.objects.get(",
            "            content_type__app_label=\"wagtailadmin\", codename=\"access_admin\"",
            "        )",
            "        self.user.user_permissions.add(admin_permission)",
            "",
            "        response = self.client.get(self.url)",
            "        self.assertEqual(response.status_code, 302)",
            "        self.assertRedirects(response, reverse(\"wagtailadmin_home\"))",
            "",
            "    def test_only_add_permission(self):",
            "        self.user.is_superuser = False",
            "        self.user.user_permissions.add(",
            "            Permission.objects.get(",
            "                content_type__app_label=\"wagtailadmin\", codename=\"access_admin\"",
            "            ),",
            "            Permission.objects.get(",
            "                content_type__app_label=self.object._meta.app_label,",
            "                codename=get_permission_codename(\"add\", self.object._meta),",
            "            ),",
            "        )",
            "        self.user.save()",
            "",
            "        response = self.client.get(self.url)",
            "        expected_fields = [\"Strid\", \"Release date\"]",
            "        expected_values = [",
            "            # The pk may contain whitespace at the start/end, it's hard to",
            "            # distinguish from the whitespace in the HTML so just strip it",
            "            self.object.pk.strip(),",
            "            localize(self.object.release_date),",
            "        ]",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertTemplateUsed(response, \"wagtailadmin/generic/inspect.html\")",
            "        soup = self.get_soup(response.content)",
            "        fields = [dt.text.strip() for dt in soup.select(\"dt\")]",
            "        values = [dd.text.strip() for dd in soup.select(\"dd\")]",
            "        self.assertEqual(fields, expected_fields)",
            "        self.assertEqual(values, expected_values)",
            "        self.assertEqual(len(soup.find_all(\"a\", attrs={\"href\": self.edit_url})), 0)",
            "        self.assertEqual(len(soup.find_all(\"a\", attrs={\"href\": self.delete_url})), 0)",
            "",
            "",
            "class TestListingButtons(WagtailTestUtils, TestCase):",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        cls.object = FeatureCompleteToy.objects.create(name=\"Test Toy\")",
            "",
            "    def test_simple(self):",
            "        response = self.client.get(reverse(\"feature_complete_toy:index\"))",
            "",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertTemplateUsed(response, \"wagtailadmin/shared/buttons.html\")",
            "",
            "        soup = self.get_soup(response.content)",
            "        actions = soup.select_one(\"tbody tr td ul.actions\")",
            "        more_dropdown = actions.select_one(\"li [data-controller='w-dropdown']\")",
            "        self.assertIsNotNone(more_dropdown)",
            "        more_button = more_dropdown.select_one(\"button\")",
            "        self.assertEqual(",
            "            more_button.attrs.get(\"aria-label\").strip(),",
            "            f\"More options for '{self.object}'\",",
            "        )",
            "",
            "        expected_buttons = [",
            "            (",
            "                \"Edit\",",
            "                f\"Edit '{self.object}'\",",
            "                reverse(\"feature_complete_toy:edit\", args=[quote(self.object.pk)]),",
            "            ),",
            "            (",
            "                \"Copy\",",
            "                f\"Copy '{self.object}'\",",
            "                reverse(\"feature_complete_toy:copy\", args=[quote(self.object.pk)]),",
            "            ),",
            "            (",
            "                \"Inspect\",",
            "                f\"Inspect '{self.object}'\",",
            "                reverse(\"feature_complete_toy:inspect\", args=[quote(self.object.pk)]),",
            "            ),",
            "            (",
            "                \"Delete\",",
            "                f\"Delete '{self.object}'\",",
            "                reverse(\"feature_complete_toy:delete\", args=[quote(self.object.pk)]),",
            "            ),",
            "        ]",
            "",
            "        rendered_buttons = more_dropdown.select(\"a\")",
            "        self.assertEqual(len(rendered_buttons), len(expected_buttons))",
            "",
            "        for rendered_button, (label, aria_label, url) in zip(",
            "            rendered_buttons, expected_buttons",
            "        ):",
            "            self.assertEqual(rendered_button.text.strip(), label)",
            "            self.assertEqual(rendered_button.attrs.get(\"aria-label\"), aria_label)",
            "            self.assertEqual(rendered_button.attrs.get(\"href\"), url)",
            "",
            "    def test_copy_disabled(self):",
            "        response = self.client.get(reverse(\"fctoy_alt1:index\"))",
            "",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertTemplateUsed(response, \"wagtailadmin/shared/buttons.html\")",
            "",
            "        soup = self.get_soup(response.content)",
            "        actions = soup.select_one(\"tbody tr td ul.actions\")",
            "        more_dropdown = actions.select_one(\"li [data-controller='w-dropdown']\")",
            "        self.assertIsNotNone(more_dropdown)",
            "        more_button = more_dropdown.select_one(\"button\")",
            "        self.assertEqual(",
            "            more_button.attrs.get(\"aria-label\").strip(),",
            "            f\"More options for '{self.object}'\",",
            "        )",
            "",
            "        expected_buttons = [",
            "            (",
            "                \"Edit\",",
            "                f\"Edit '{self.object}'\",",
            "                reverse(\"fctoy_alt1:edit\", args=[quote(self.object.pk)]),",
            "            ),",
            "            (",
            "                \"Inspect\",",
            "                f\"Inspect '{self.object}'\",",
            "                reverse(\"fctoy_alt1:inspect\", args=[quote(self.object.pk)]),",
            "            ),",
            "            (",
            "                \"Delete\",",
            "                f\"Delete '{self.object}'\",",
            "                reverse(\"fctoy_alt1:delete\", args=[quote(self.object.pk)]),",
            "            ),",
            "        ]",
            "",
            "        rendered_buttons = more_dropdown.select(\"a\")",
            "        self.assertEqual(len(rendered_buttons), len(expected_buttons))",
            "",
            "        for rendered_button, (label, aria_label, url) in zip(",
            "            rendered_buttons, expected_buttons",
            "        ):",
            "            self.assertEqual(rendered_button.text.strip(), label)",
            "            self.assertEqual(rendered_button.attrs.get(\"aria-label\"), aria_label)",
            "            self.assertEqual(rendered_button.attrs.get(\"href\"), url)",
            "",
            "",
            "class TestCopyView(WagtailTestUtils, TestCase):",
            "    def setUp(self):",
            "        self.user = self.login()",
            "        self.url = reverse(\"feature_complete_toy:copy\", args=[quote(self.object.pk)])",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        cls.object = FeatureCompleteToy.objects.create(name=\"Test Toy\")",
            "",
            "    def test_without_permission(self):",
            "        self.user.is_superuser = False",
            "        self.user.save()",
            "        admin_permission = Permission.objects.get(",
            "            content_type__app_label=\"wagtailadmin\", codename=\"access_admin\"",
            "        )",
            "        self.user.user_permissions.add(admin_permission)",
            "",
            "        response = self.client.get(self.url)",
            "        self.assertEqual(response.status_code, 302)",
            "        self.assertRedirects(response, reverse(\"wagtailadmin_home\"))",
            "",
            "    def test_form_is_prefilled(self):",
            "        request = RequestFactory().get(self.url)",
            "        request.user = self.user",
            "        view = FCToyAlt1ViewSet().copy_view_class()",
            "        view.setup(request)",
            "        view.model = self.object.__class__",
            "        view.kwargs = {\"pk\": self.object.pk}",
            "",
            "        self.assertEqual(view.get_form_kwargs()[\"instance\"], self.object)",
            "",
            "",
            "class TestEditHandler(WagtailTestUtils, TestCase):",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        cls.object = FeatureCompleteToy.objects.create(name=\"Test Toy\")",
            "        cls.url = reverse(\"feature_complete_toy:edit\", args=(quote(cls.object.pk),))",
            "",
            "    def test_edit_form_rendered_with_panels(self):",
            "        response = self.client.get(self.url)",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertTemplateUsed(response, \"wagtailadmin/shared/panel.html\")",
            "        # Many features from the Panels API are powered by client-side JS in",
            "        # _editor_js.html. We need to make sure that this template is included",
            "        # in the response for now.",
            "        self.assertTemplateUsed(response, \"wagtailadmin/pages/_editor_js.html\", count=1)",
            "",
            "        soup = self.get_soup(response.content)",
            "",
            "        # Minimap should be rendered",
            "        minimap_container = soup.select_one(\"[data-minimap-container]\")",
            "        self.assertIsNotNone(minimap_container)",
            "",
            "        # Form should be rendered using panels",
            "        panels = soup.select(\"[data-panel]\")",
            "        self.assertEqual(len(panels), 2)",
            "        headings = [\"Name\", \"Release date\"]",
            "        for expected_heading, panel in zip(headings, panels):",
            "            rendered_heading = panel.select_one(\"[data-panel-heading-text]\")",
            "            self.assertIsNotNone(rendered_heading)",
            "            self.assertEqual(rendered_heading.text.strip(), expected_heading)",
            "",
            "        # Ensure modal-workflow.js is included, as it's needed by choosers",
            "        modal_workflow_js = versioned_static(\"wagtailadmin/js/modal-workflow.js\")",
            "        modal_workflow_script = soup.select_one(f'script[src=\"{modal_workflow_js}\"]')",
            "        self.assertIsNotNone(modal_workflow_script)",
            "",
            "    def test_field_permissions(self):",
            "        self.user.is_superuser = False",
            "        self.user.save()",
            "        self.user.user_permissions.add(",
            "            Permission.objects.get(",
            "                content_type__app_label=\"wagtailadmin\", codename=\"access_admin\"",
            "            ),",
            "            Permission.objects.get(",
            "                content_type__app_label=self.object._meta.app_label,",
            "                codename=get_permission_codename(\"change\", self.object._meta),",
            "            ),",
            "        )",
            "",
            "        response = self.client.get(self.url)",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertEqual(list(response.context[\"form\"].fields), [\"name\"])",
            "",
            "        self.user.user_permissions.add(",
            "            Permission.objects.get(",
            "                codename=\"can_set_release_date\",",
            "            )",
            "        )",
            "",
            "        response = self.client.get(self.url)",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertEqual(",
            "            list(response.context[\"form\"].fields), [\"name\", \"release_date\"]",
            "        )",
            "",
            "",
            "class TestDefaultMessages(WagtailTestUtils, TestCase):",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        cls.object = FeatureCompleteToy.objects.create(name=\"Test Toy\")",
            "        cls.create_url = reverse(\"feature_complete_toy:add\")",
            "        cls.edit_url = reverse(",
            "            \"feature_complete_toy:edit\", args=(quote(cls.object.pk),)",
            "        )",
            "        cls.delete_url = reverse(",
            "            \"feature_complete_toy:delete\", args=(quote(cls.object.pk),)",
            "        )",
            "",
            "    def test_create_error(self):",
            "        response = self.client.post(",
            "            self.create_url,",
            "            data={\"name\": \"\", \"release_date\": \"2024-01-11\"},",
            "        )",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertContains(",
            "            response,",
            "            escape(\"The feature complete toy could not be created due to errors.\"),",
            "        )",
            "",
            "    def test_create_success(self):",
            "        response = self.client.post(",
            "            self.create_url,",
            "            data={\"name\": \"Pink Flamingo\", \"release_date\": \"2024-01-11\"},",
            "            follow=True,",
            "        )",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertContains(",
            "            response,",
            "            escape(\"Feature complete toy 'Pink Flamingo (2024-01-11)' created.\"),",
            "        )",
            "",
            "    def test_edit_error(self):",
            "        response = self.client.post(",
            "            self.edit_url, data={\"name\": \"\", \"release_date\": \"2024-01-11\"}",
            "        )",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertContains(",
            "            response,",
            "            escape(\"The feature complete toy could not be saved due to errors.\"),",
            "        )",
            "",
            "    def test_edit_success(self):",
            "        response = self.client.post(",
            "            self.edit_url,",
            "            data={\"name\": \"rubberduck\", \"release_date\": \"2024-02-01\"},",
            "            follow=True,",
            "        )",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertContains(",
            "            response,",
            "            escape(\"Feature complete toy 'rubberduck (2024-02-01)' updated.\"),",
            "        )",
            "",
            "    def test_delete_success(self):",
            "        response = self.client.post(self.delete_url, follow=True)",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertContains(",
            "            response,",
            "            escape(f\"Feature complete toy '{self.object}' deleted.\"),",
            "        )"
        ],
        "afterPatchFile": [
            "import datetime",
            "from io import BytesIO",
            "",
            "from django.conf import settings",
            "from django.contrib.admin.utils import quote",
            "from django.contrib.auth import get_permission_codename",
            "from django.contrib.auth.models import Permission",
            "from django.contrib.contenttypes.models import ContentType",
            "from django.test import RequestFactory, TestCase",
            "from django.urls import NoReverseMatch, reverse",
            "from django.utils.formats import date_format, localize",
            "from django.utils.html import escape",
            "from django.utils.timezone import make_aware",
            "from openpyxl import load_workbook",
            "",
            "from wagtail.admin.admin_url_finder import AdminURLFinder",
            "from wagtail.admin.staticfiles import versioned_static",
            "from wagtail.log_actions import log",
            "from wagtail.models import ModelLogEntry",
            "from wagtail.test.testapp.models import (",
            "    FeatureCompleteToy,",
            "    JSONStreamModel,",
            "    SearchTestModel,",
            "    VariousOnDeleteModel,",
            ")",
            "from wagtail.test.testapp.views import FCToyAlt1ViewSet",
            "from wagtail.test.utils.template_tests import AdminTemplateTestUtils",
            "from wagtail.test.utils.wagtail_tests import WagtailTestUtils",
            "from wagtail.utils.deprecation import RemovedInWagtail70Warning",
            "",
            "",
            "class TestModelViewSetGroup(WagtailTestUtils, TestCase):",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    def test_menu_items(self):",
            "        response = self.client.get(reverse(\"wagtailadmin_home\"))",
            "        self.assertEqual(response.status_code, 200)",
            "        # Menu label falls back to the title-cased app label",
            "        self.assertContains(",
            "            response,",
            "            '\"name\": \"tests\", \"label\": \"Tests\", \"icon_name\": \"folder-open-inverse\"',",
            "        )",
            "        # Title-cased from verbose_name_plural",
            "        self.assertContains(response, \"Json Stream Models\")",
            "        self.assertContains(response, reverse(\"streammodel:index\"))",
            "        self.assertEqual(reverse(\"streammodel:index\"), \"/admin/streammodel/\")",
            "        # Set on class",
            "        self.assertContains(response, \"JSON MinMaxCount StreamModel\")",
            "        self.assertContains(response, reverse(\"minmaxcount_streammodel:index\"))",
            "        self.assertEqual(",
            "            reverse(\"minmaxcount_streammodel:index\"),",
            "            \"/admin/minmaxcount-streammodel/\",",
            "        )",
            "        # Set on instance",
            "        self.assertContains(response, \"JSON BlockCounts StreamModel\")",
            "        self.assertContains(response, reverse(\"blockcounts_streammodel:index\"))",
            "        self.assertEqual(",
            "            reverse(\"blockcounts_streammodel:index\"),",
            "            \"/admin/blockcounts/streammodel/\",",
            "        )",
            "",
            "",
            "class TestTemplateConfiguration(WagtailTestUtils, TestCase):",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        cls.default = JSONStreamModel.objects.create(",
            "            body='[{\"type\": \"text\", \"value\": \"foo\"}]',",
            "        )",
            "        cls.custom = FeatureCompleteToy.objects.create(name=\"Test Toy\")",
            "",
            "    def get_default_url(self, view_name, args=()):",
            "        return reverse(f\"streammodel:{view_name}\", args=args)",
            "",
            "    def get_custom_url(self, view_name, args=()):",
            "        return reverse(f\"feature_complete_toy:{view_name}\", args=args)",
            "",
            "    def test_default_templates(self):",
            "        pk = quote(self.default.pk)",
            "        cases = {",
            "            \"index\": (",
            "                [],",
            "                \"wagtailadmin/generic/index.html\",",
            "            ),",
            "            \"index_results\": (",
            "                [],",
            "                \"wagtailadmin/generic/listing_results.html\",",
            "            ),",
            "            \"add\": (",
            "                [],",
            "                \"wagtailadmin/generic/create.html\",",
            "            ),",
            "            \"edit\": (",
            "                [pk],",
            "                \"wagtailadmin/generic/edit.html\",",
            "            ),",
            "            \"delete\": (",
            "                [pk],",
            "                \"wagtailadmin/generic/confirm_delete.html\",",
            "            ),",
            "        }",
            "        for view_name, (args, template_name) in cases.items():",
            "            with self.subTest(view_name=view_name):",
            "                response = self.client.get(self.get_default_url(view_name, args=args))",
            "                self.assertTemplateUsed(response, template_name)",
            "",
            "    def test_custom_template_lookups(self):",
            "        pk = quote(self.custom.pk)",
            "        cases = {",
            "            \"override with index_template_name\": (",
            "                \"index\",",
            "                [],",
            "                \"tests/fctoy_index.html\",",
            "            ),",
            "            \"with app label and model name\": (",
            "                \"add\",",
            "                [],",
            "                \"customprefix/tests/featurecompletetoy/create.html\",",
            "            ),",
            "            \"with app label\": (",
            "                \"edit\",",
            "                [pk],",
            "                \"customprefix/tests/edit.html\",",
            "            ),",
            "            \"without app label and model name\": (",
            "                \"delete\",",
            "                [pk],",
            "                \"customprefix/confirm_delete.html\",",
            "            ),",
            "        }",
            "        for case, (view_name, args, template_name) in cases.items():",
            "            with self.subTest(case=case):",
            "                response = self.client.get(self.get_custom_url(view_name, args=args))",
            "                self.assertTemplateUsed(response, template_name)",
            "                self.assertContains(",
            "                    response, \"<p>Some extra custom content</p>\", html=True",
            "                )",
            "",
            "    def test_wagtail_admin_template_mixin_variables_with_legacy_header(self):",
            "        pk = quote(self.custom.pk)",
            "        cases = {",
            "            \"delete\": ([pk], \"Delete\", str(self.custom)),",
            "        }",
            "        for view_name, (args, title, subtitle) in cases.items():",
            "            with self.subTest(view_name=view_name):",
            "                response = self.client.get(self.get_custom_url(view_name, args=args))",
            "                soup = self.get_soup(response.content)",
            "                h1 = soup.select_one(\"h1\")",
            "                self.assertIsNotNone(h1)",
            "                self.assertEqual(",
            "                    \"\".join(h1.find_all(string=True, recursive=False)).strip(), title",
            "                )",
            "                subtitle_el = h1.select_one(\"span\")",
            "                if subtitle:",
            "                    self.assertIsNotNone(subtitle_el)",
            "                    self.assertEqual(subtitle_el.string, subtitle)",
            "                else:",
            "                    self.assertIsNone(subtitle_el)",
            "                icon = h1.select_one(\"svg use[href='#icon-media']\")",
            "                self.assertIsNotNone(icon)",
            "",
            "    def test_wagtail_admin_template_mixin_variables(self):",
            "        pk = quote(self.custom.pk)",
            "        cases = {",
            "            \"index\": ([], \"Feature complete toys\", None),",
            "            \"add\": ([], \"New\", \"Feature complete toy\"),",
            "            \"edit\": ([pk], \"Editing\", str(self.custom)),",
            "        }",
            "        for view_name, (args, title, subtitle) in cases.items():",
            "            with self.subTest(view_name=view_name):",
            "                response = self.client.get(self.get_custom_url(view_name, args=args))",
            "                soup = self.get_soup(response.content)",
            "                h1 = soup.select_one(\"h1\")",
            "                expected_h1 = title",
            "                if subtitle:",
            "                    expected_h1 = f\"{title}: {subtitle}\"",
            "                self.assertIsNotNone(h1)",
            "                self.assertEqual(h1.get_text(strip=True), expected_h1)",
            "                icon = h1.select_one(\"svg use[href='#icon-media']\")",
            "                # Icon is no longer rendered in the h1 with the slim header in place",
            "                self.assertIsNone(icon)",
            "",
            "",
            "class TestCustomColumns(WagtailTestUtils, TestCase):",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        FeatureCompleteToy.objects.create(name=\"Racecar\")",
            "        FeatureCompleteToy.objects.create(name=\"level\")",
            "        FeatureCompleteToy.objects.create(name=\"Lotso\")",
            "",
            "    def test_list_display(self):",
            "        index_url = reverse(\"feature_complete_toy:index\")",
            "        response = self.client.get(index_url)",
            "        # \"name\" column",
            "        self.assertContains(response, \"Racecar\")",
            "        self.assertContains(response, \"level\")",
            "        self.assertContains(response, \"Lotso\")",
            "        # BooleanColumn(\"is_cool\")",
            "        soup = self.get_soup(response.content)",
            "",
            "        help = soup.select_one(\"td:has(svg.icon-help)\")",
            "        self.assertIsNotNone(help)",
            "        self.assertEqual(help.text.strip(), \"None\")",
            "",
            "        success = soup.select_one(\"td:has(svg.icon-success.w-text-positive-100)\")",
            "        self.assertIsNotNone(success)",
            "        self.assertEqual(success.text.strip(), \"True\")",
            "",
            "        error = soup.select_one(\"td:has(svg.icon-error.w-text-critical-100)\")",
            "        self.assertIsNotNone(error)",
            "        self.assertEqual(error.text.strip(), \"False\")",
            "",
            "        updated_at = soup.select(\"th a\")[-1]",
            "        self.assertEqual(updated_at.text.strip(), \"Updated\")",
            "        self.assertEqual(updated_at[\"href\"], f\"{index_url}?ordering=_updated_at\")",
            "",
            "",
            "class TestListFilter(WagtailTestUtils, TestCase):",
            "    cases = {",
            "        \"list\": (\"feature_complete_toy\", \"release_date\", \"Release date\"),",
            "        \"dict\": (\"fctoy_alt1\", \"name__icontains\", \"Name contains\"),",
            "        \"filterset_class\": (",
            "            \"fctoy-alt2\",",
            "            \"release_date__year__lte\",",
            "            \"Release date year is less than or equal to\",",
            "        ),",
            "    }",
            "",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    def get(self, url_namespace, params=None):",
            "        return self.client.get(reverse(f\"{url_namespace}:index\"), params)",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        FeatureCompleteToy.objects.create(",
            "            name=\"Buzz Lightyear\",",
            "            release_date=datetime.date(1995, 11, 19),",
            "        )",
            "        FeatureCompleteToy.objects.create(",
            "            name=\"Forky\",",
            "            release_date=datetime.date(2019, 6, 11),",
            "        )",
            "",
            "    def test_unfiltered_no_results(self):",
            "        FeatureCompleteToy.objects.all().delete()",
            "        for case, (url_namespace, lookup, label_text) in self.cases.items():",
            "            with self.subTest(case=case):",
            "                response = self.get(url_namespace)",
            "                self.assertContains(",
            "                    response,",
            "                    \"There are no feature complete toys to display\",",
            "                )",
            "                self.assertNotContains(",
            "                    response,",
            "                    \"No feature complete toys match your query\",",
            "                )",
            "                self.assertNotContains(response, \"Buzz Lightyear\")",
            "                self.assertNotContains(response, \"Forky\")",
            "",
            "                soup = self.get_soup(response.content)",
            "                label = soup.select_one(f\"label#id_{lookup}-label\")",
            "                self.assertIsNotNone(label)",
            "                self.assertEqual(label.string.strip(), label_text)",
            "                input = soup.select_one(f\"input#id_{lookup}\")",
            "                self.assertIsNotNone(input)",
            "",
            "    def test_unfiltered_with_results(self):",
            "        for case, (url_namespace, lookup, label_text) in self.cases.items():",
            "            with self.subTest(case=case):",
            "                response = self.get(url_namespace)",
            "                self.assertContains(response, \"Buzz Lightyear\")",
            "                self.assertContains(response, \"Forky\")",
            "                self.assertNotContains(response, \"There are 2 matches\")",
            "                self.assertNotContains(",
            "                    response,",
            "                    \"There are no feature complete toys to display\",",
            "                )",
            "                self.assertNotContains(",
            "                    response,",
            "                    \"No feature complete toys match your query\",",
            "                )",
            "",
            "                soup = self.get_soup(response.content)",
            "                label = soup.select_one(f\"label#id_{lookup}-label\")",
            "                self.assertIsNotNone(label)",
            "                self.assertEqual(label.string.strip(), label_text)",
            "                input = soup.select_one(f\"input#id_{lookup}\")",
            "                self.assertIsNotNone(input)",
            "",
            "    def test_empty_filter_with_results(self):",
            "        for case, (url_namespace, lookup, label_text) in self.cases.items():",
            "            with self.subTest(case=case):",
            "                response = self.get(url_namespace, {lookup: \"\"})",
            "                self.assertContains(response, \"Buzz Lightyear\")",
            "                self.assertContains(response, \"Forky\")",
            "                self.assertNotContains(response, \"There are 2 matches\")",
            "                self.assertNotContains(",
            "                    response,",
            "                    \"No feature complete toys match your query\",",
            "                )",
            "",
            "                soup = self.get_soup(response.content)",
            "                label = soup.select_one(f\"label#id_{lookup}-label\")",
            "                self.assertIsNotNone(label)",
            "                self.assertEqual(label.string.strip(), label_text)",
            "                input = soup.select_one(f\"input#id_{lookup}\")",
            "                self.assertIsNotNone(input)",
            "                self.assertFalse(input.attrs.get(\"value\"))",
            "",
            "    def test_filtered_no_results(self):",
            "        lookup_values = {",
            "            \"release_date\": \"1999-09-09\",",
            "            \"name__icontains\": \"Woody\",",
            "            \"release_date__year__lte\": \"1990\",",
            "        }",
            "        for case, (url_namespace, lookup, label_text) in self.cases.items():",
            "            with self.subTest(case=case):",
            "                value = lookup_values[lookup]",
            "                response = self.get(url_namespace, {lookup: value})",
            "                self.assertContains(",
            "                    response,",
            "                    \"No feature complete toys match your query\",",
            "                )",
            "                self.assertNotContains(response, \"Buzz Lightyear\")",
            "                self.assertNotContains(response, \"Forky\")",
            "                self.assertNotContains(response, \"There are 2 matches\")",
            "",
            "                soup = self.get_soup(response.content)",
            "                label = soup.select_one(f\"label#id_{lookup}-label\")",
            "                self.assertIsNotNone(label)",
            "                self.assertEqual(label.string.strip(), label_text)",
            "                input = soup.select_one(f\"input#id_{lookup}\")",
            "                self.assertIsNotNone(input)",
            "                self.assertEqual(input.attrs.get(\"value\"), value)",
            "",
            "                # Should render the active filters even when there are no results",
            "                active_filters = soup.select_one(\".w-active-filters\")",
            "                self.assertIsNotNone(active_filters)",
            "                clear = active_filters.select_one(\".w-pill__remove\")",
            "                self.assertIsNotNone(clear)",
            "                url, params = clear.attrs.get(\"data-w-swap-src-value\").split(\"?\", 1)",
            "                self.assertEqual(url, reverse(f\"{url_namespace}:index_results\"))",
            "                self.assertNotIn(f\"{lookup}={value}\", params)",
            "",
            "    def test_filtered_with_results(self):",
            "        lookup_values = {",
            "            \"release_date\": \"1995-11-19\",",
            "            \"name__icontains\": \"Ightyear\",",
            "            \"release_date__year__lte\": \"2017\",",
            "        }",
            "        for case, (url_namespace, lookup, label_text) in self.cases.items():",
            "            with self.subTest(case=case):",
            "                value = lookup_values[lookup]",
            "                response = self.get(url_namespace, {lookup: value})",
            "                self.assertContains(response, \"Buzz Lightyear\")",
            "                self.assertContains(response, \"There is 1 match\")",
            "                self.assertNotContains(response, \"Forky\")",
            "                self.assertNotContains(",
            "                    response,",
            "                    \"No feature complete toys match your query\",",
            "                )",
            "",
            "                soup = self.get_soup(response.content)",
            "                label = soup.select_one(f\"label#id_{lookup}-label\")",
            "                self.assertIsNotNone(label)",
            "                self.assertEqual(label.string.strip(), label_text)",
            "                input = soup.select_one(f\"input#id_{lookup}\")",
            "                self.assertIsNotNone(input)",
            "                self.assertEqual(input.attrs.get(\"value\"), value)",
            "",
            "                # Should render the active filters",
            "                active_filters = soup.select_one(\".w-active-filters\")",
            "                self.assertIsNotNone(active_filters)",
            "                clear = active_filters.select_one(\".w-pill__remove\")",
            "                self.assertIsNotNone(clear)",
            "                url, params = clear.attrs.get(\"data-w-swap-src-value\").split(\"?\", 1)",
            "                self.assertEqual(url, reverse(f\"{url_namespace}:index_results\"))",
            "                self.assertNotIn(f\"{lookup}={value}\", params)",
            "",
            "",
            "class TestSearchIndexView(WagtailTestUtils, TestCase):",
            "    url_name = \"index\"",
            "    cases = {",
            "        # With the default search backend",
            "        \"default\": (\"feature_complete_toy\", \"release_date\"),",
            "        # With Django ORM",
            "        None: (\"fctoy-alt2\", \"release_date__year__lte\"),",
            "    }",
            "",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        FeatureCompleteToy.objects.create(",
            "            name=\"Buzz Lightyear\",",
            "            release_date=datetime.date(1995, 11, 19),",
            "        )",
            "        FeatureCompleteToy.objects.create(",
            "            name=\"Forky\",",
            "            release_date=datetime.date(2019, 6, 11),",
            "        )",
            "",
            "    def assertInputRendered(self, response, search_q):",
            "        soup = self.get_soup(response.content)",
            "        input = soup.select_one(\"input#id_q\")",
            "        self.assertIsNotNone(input)",
            "        self.assertEqual(input.attrs.get(\"value\"), search_q)",
            "",
            "    def get(self, url_namespace, params=None):",
            "        return self.client.get(reverse(f\"{url_namespace}:{self.url_name}\"), params)",
            "",
            "    def test_search_disabled(self):",
            "        response = self.get(\"fctoy_alt1\", {\"q\": \"ork\"})",
            "        self.assertContains(response, \"Forky\")",
            "        self.assertContains(response, \"Buzz Lightyear\")",
            "        self.assertNotContains(response, \"There are 2 matches\")",
            "        soup = self.get_soup(response.content)",
            "        input = soup.select_one(\"input#id_q\")",
            "        self.assertIsNone(input)",
            "",
            "    def test_search_no_results(self):",
            "        for backend, (url_namespace, _) in self.cases.items():",
            "            with self.subTest(backend=backend):",
            "                response = self.get(url_namespace, {\"q\": \"Woody\"})",
            "                self.assertContains(",
            "                    response,",
            "                    \"No feature complete toys match your query\",",
            "                )",
            "                self.assertNotContains(response, \"Buzz Lightyear\")",
            "                self.assertNotContains(response, \"Forky\")",
            "                self.assertInputRendered(response, \"Woody\")",
            "",
            "    def test_search_with_results(self):",
            "        for backend, (url_namespace, _) in self.cases.items():",
            "            with self.subTest(backend=backend):",
            "                response = self.get(url_namespace, {\"q\": \"ork\"})",
            "                self.assertContains(response, \"Forky\")",
            "                self.assertNotContains(response, \"Buzz Lightyear\")",
            "                self.assertContains(response, \"There is 1 match\")",
            "                self.assertInputRendered(response, \"ork\")",
            "",
            "    def test_filtered_searched_no_results(self):",
            "        lookup_values = {",
            "            \"release_date\": \"2019-06-11\",",
            "            \"release_date__year__lte\": \"2023\",",
            "        }",
            "        for backend, (url_namespace, lookup) in self.cases.items():",
            "            with self.subTest(backend=backend):",
            "                value = lookup_values[lookup]",
            "                response = self.get(url_namespace, {\"q\": \"Woody\", lookup: value})",
            "                self.assertContains(",
            "                    response,",
            "                    \"No feature complete toys match your query\",",
            "                )",
            "                self.assertNotContains(response, \"Buzz Lightyear\")",
            "                self.assertNotContains(response, \"Forky\")",
            "                self.assertInputRendered(response, \"Woody\")",
            "",
            "    def test_filtered_searched_with_results(self):",
            "        lookup_values = {",
            "            \"release_date\": \"2019-06-11\",",
            "            \"release_date__year__lte\": \"2023\",",
            "        }",
            "        for backend, (url_namespace, lookup) in self.cases.items():",
            "            with self.subTest(backend=backend):",
            "                value = lookup_values[lookup]",
            "                response = self.get(url_namespace, {\"q\": \"ork\", lookup: value})",
            "                self.assertContains(response, \"Forky\")",
            "                self.assertNotContains(response, \"Buzz Lightyear\")",
            "                self.assertContains(response, \"There is 1 match\")",
            "                self.assertInputRendered(response, \"ork\")",
            "",
            "",
            "class TestSearchIndexResultsView(TestSearchIndexView):",
            "    url_name = \"index_results\"",
            "",
            "    def assertInputRendered(self, response, search_q):",
            "        # index_results view doesn't render the search input",
            "        pass",
            "",
            "",
            "class TestSearchFields(WagtailTestUtils, TestCase):",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        objects = [",
            "            SearchTestModel(title=\"Hello World\", body=\"This one is classic\"),",
            "            SearchTestModel(title=\"Hello Anime\", body=\"We love anime (opinions vary)\"),",
            "            SearchTestModel(title=\"Food\", body=\"I like food, do you?\"),",
            "        ]",
            "        SearchTestModel.objects.bulk_create(objects)",
            "",
            "    def setUp(self):",
            "        self.login()",
            "",
            "    def get(self, q):",
            "        return self.client.get(reverse(\"searchtest:index\"), {\"q\": q})",
            "",
            "    def test_single_result_with_body(self):",
            "        response = self.get(\"IkE\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertNotContains(response, \"Hello World\")",
            "        self.assertNotContains(response, \"Hello Anime\")",
            "        self.assertContains(response, \"Food\")",
            "",
            "    def test_multiple_results_with_title(self):",
            "        response = self.get(\"ELlo\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertContains(response, \"Hello World\")",
            "        self.assertContains(response, \"Hello Anime\")",
            "        self.assertNotContains(response, \"Food\")",
            "",
            "    def test_no_results(self):",
            "        response = self.get(\"Abra Kadabra\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertNotContains(response, \"Hello World\")",
            "        self.assertNotContains(response, \"Hello Anime\")",
            "        self.assertNotContains(response, \"Food\")",
            "",
            "",
            "class TestListExport(WagtailTestUtils, TestCase):",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        FeatureCompleteToy.objects.create(",
            "            name=\"Racecar\",",
            "            release_date=datetime.date(1995, 11, 19),",
            "        )",
            "        FeatureCompleteToy.objects.create(",
            "            name=\"LEVEL\",",
            "            release_date=datetime.date(2010, 6, 18),",
            "        )",
            "        FeatureCompleteToy.objects.create(",
            "            name=\"Catso\",",
            "            release_date=datetime.date(2010, 6, 18),",
            "        )",
            "",
            "    def test_export_disabled(self):",
            "        index_url = reverse(\"fctoy_alt1:index\")",
            "        response = self.client.get(index_url)",
            "        soup = self.get_soup(response.content)",
            "",
            "        csv_link = soup.select_one(f\"a[href='{index_url}?export=csv']\")",
            "        self.assertIsNone(csv_link)",
            "        xlsx_link = soup.select_one(f\"a[href='{index_url}?export=xlsx']\")",
            "        self.assertIsNone(xlsx_link)",
            "",
            "    def test_get_not_export_shows_export_buttons(self):",
            "        index_url = reverse(\"feature_complete_toy:index\")",
            "        response = self.client.get(index_url)",
            "        soup = self.get_soup(response.content)",
            "",
            "        csv_link = soup.select_one(f\"a[href='{index_url}?export=csv']\")",
            "        self.assertIsNotNone(csv_link)",
            "        self.assertEqual(csv_link.text.strip(), \"Download CSV\")",
            "        xlsx_link = soup.select_one(f\"a[href='{index_url}?export=xlsx']\")",
            "        self.assertIsNotNone(xlsx_link)",
            "        self.assertEqual(xlsx_link.text.strip(), \"Download XLSX\")",
            "",
            "    def test_get_filtered_shows_export_buttons_with_filters(self):",
            "        index_url = reverse(\"feature_complete_toy:index\")",
            "        response = self.client.get(index_url, {\"release_date\": \"2010-06-18\"})",
            "        soup = self.get_soup(response.content)",
            "",
            "        csv_link = soup.select_one(",
            "            f\"a[href='{index_url}?release_date=2010-06-18&export=csv']\"",
            "        )",
            "        self.assertIsNotNone(csv_link)",
            "        self.assertEqual(csv_link.text.strip(), \"Download CSV\")",
            "        xlsx_link = soup.select_one(",
            "            f\"a[href='{index_url}?release_date=2010-06-18&export=xlsx']\"",
            "        )",
            "        self.assertIsNotNone(xlsx_link)",
            "        self.assertEqual(xlsx_link.text.strip(), \"Download XLSX\")",
            "",
            "    def test_csv_export(self):",
            "        index_url = reverse(\"feature_complete_toy:index\")",
            "        response = self.client.get(index_url, {\"export\": \"csv\"})",
            "",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertEqual(",
            "            response.get(\"Content-Disposition\"),",
            "            'attachment; filename=\"feature-complete-toys.csv\"',",
            "        )",
            "",
            "        data_lines = response.getvalue().decode().strip().split(\"\\r\\n\")",
            "        self.assertEqual(data_lines[0], \"Name,Launch date,Is cool\")",
            "        self.assertEqual(data_lines[1], \"Catso,2010-06-18,False\")",
            "        self.assertEqual(data_lines[2], \"LEVEL,2010-06-18,True\")",
            "        self.assertEqual(data_lines[3], \"Racecar,1995-11-19,\")",
            "        self.assertEqual(len(data_lines), 4)",
            "",
            "    def test_csv_export_filtered(self):",
            "        index_url = reverse(\"feature_complete_toy:index\")",
            "        response = self.client.get(",
            "            index_url,",
            "            {\"release_date\": \"2010-06-18\", \"export\": \"csv\"},",
            "        )",
            "",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertEqual(",
            "            response.get(\"Content-Disposition\"),",
            "            'attachment; filename=\"feature-complete-toys.csv\"',",
            "        )",
            "",
            "        data_lines = response.getvalue().decode().strip().split(\"\\r\\n\")",
            "        self.assertEqual(data_lines[0], \"Name,Launch date,Is cool\")",
            "        self.assertEqual(data_lines[1], \"Catso,2010-06-18,False\")",
            "        self.assertEqual(data_lines[2], \"LEVEL,2010-06-18,True\")",
            "        self.assertEqual(len(data_lines), 3)",
            "",
            "    def test_xlsx_export(self):",
            "        index_url = reverse(\"feature_complete_toy:index\")",
            "        response = self.client.get(index_url, {\"export\": \"xlsx\"})",
            "",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertEqual(",
            "            response.get(\"Content-Disposition\"),",
            "            'attachment; filename=\"feature-complete-toys.xlsx\"',",
            "        )",
            "",
            "        workbook_data = response.getvalue()",
            "        worksheet = load_workbook(filename=BytesIO(workbook_data)).active",
            "        cell_array = [[cell.value for cell in row] for row in worksheet.rows]",
            "        self.assertEqual(cell_array[0], [\"Name\", \"Launch date\", \"Is cool\"])",
            "        self.assertEqual(cell_array[1], [\"Catso\", datetime.date(2010, 6, 18), False])",
            "        self.assertEqual(cell_array[2], [\"LEVEL\", datetime.date(2010, 6, 18), True])",
            "        self.assertEqual(cell_array[3], [\"Racecar\", datetime.date(1995, 11, 19), None])",
            "        self.assertEqual(len(cell_array), 4)",
            "",
            "    def test_xlsx_export_filtered(self):",
            "        index_url = reverse(\"feature_complete_toy:index\")",
            "        response = self.client.get(",
            "            index_url,",
            "            {\"release_date\": \"2010-06-18\", \"export\": \"xlsx\"},",
            "        )",
            "",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertEqual(",
            "            response.get(\"Content-Disposition\"),",
            "            'attachment; filename=\"feature-complete-toys.xlsx\"',",
            "        )",
            "",
            "        workbook_data = response.getvalue()",
            "        worksheet = load_workbook(filename=BytesIO(workbook_data)).active",
            "        cell_array = [[cell.value for cell in row] for row in worksheet.rows]",
            "        self.assertEqual(cell_array[0], [\"Name\", \"Launch date\", \"Is cool\"])",
            "        self.assertEqual(cell_array[1], [\"Catso\", datetime.date(2010, 6, 18), False])",
            "        self.assertEqual(cell_array[2], [\"LEVEL\", datetime.date(2010, 6, 18), True])",
            "        self.assertEqual(len(cell_array), 3)",
            "",
            "",
            "class TestPagination(WagtailTestUtils, TestCase):",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        objects = [FeatureCompleteToy(name=f\"Frisbee {i}\") for i in range(32)]",
            "        FeatureCompleteToy.objects.bulk_create(objects)",
            "",
            "    def test_default_list_pagination(self):",
            "        list_url = reverse(\"fctoy_alt1:index\")",
            "        response = self.client.get(list_url)",
            "",
            "        # Default is 20 per page",
            "        self.assertEqual(FeatureCompleteToy.objects.all().count(), 32)",
            "        self.assertContains(response, \"Page 1 of 2\")",
            "        self.assertContains(response, \"Next\")",
            "        self.assertContains(response, list_url + \"?p=2\")",
            "",
            "    def test_custom_list_pagination(self):",
            "        list_url = reverse(\"feature_complete_toy:index\")",
            "        response = self.client.get(list_url)",
            "",
            "        # Custom is set to display 5 per page",
            "        self.assertEqual(FeatureCompleteToy.objects.all().count(), 32)",
            "        self.assertContains(response, \"Page 1 of 7\")",
            "        self.assertContains(response, \"Next\")",
            "        self.assertContains(response, list_url + \"?p=2\")",
            "",
            "",
            "class TestOrdering(WagtailTestUtils, TestCase):",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        objects = [",
            "            FeatureCompleteToy(name=\"CCCCCCCCCC\", strid=\"1\"),",
            "            FeatureCompleteToy(name=\"AAAAAAAAAA\", strid=\"2\"),",
            "            FeatureCompleteToy(name=\"DDDDDDDDDD\", strid=\"3\"),",
            "            FeatureCompleteToy(name=\"BBBBBBBBBB\", strid=\"4\"),",
            "        ]",
            "        FeatureCompleteToy.objects.bulk_create(objects)",
            "",
            "    def test_default_order(self):",
            "        response = self.client.get(reverse(\"fctoy_alt1:index\"))",
            "        # Without ordering on the model, should be ordered descending by pk",
            "        self.assertFalse(FeatureCompleteToy._meta.ordering)",
            "        self.assertEqual(",
            "            [obj.name for obj in response.context[\"object_list\"]],",
            "            [",
            "                \"BBBBBBBBBB\",",
            "                \"DDDDDDDDDD\",",
            "                \"AAAAAAAAAA\",",
            "                \"CCCCCCCCCC\",",
            "            ],",
            "        )",
            "",
            "    def test_custom_order_from_query_args(self):",
            "        response = self.client.get(reverse(\"fctoy-alt3:index\") + \"?ordering=-name\")",
            "        self.assertFalse(FeatureCompleteToy._meta.ordering)",
            "        self.assertEqual(",
            "            [obj.name for obj in response.context[\"object_list\"]],",
            "            [",
            "                \"DDDDDDDDDD\",",
            "                \"CCCCCCCCCC\",",
            "                \"BBBBBBBBBB\",",
            "                \"AAAAAAAAAA\",",
            "            ],",
            "        )",
            "",
            "    def test_custom_order_from_view(self):",
            "        response = self.client.get(reverse(\"feature_complete_toy:index\"))",
            "        # Should respect the view's ordering",
            "        self.assertFalse(FeatureCompleteToy._meta.ordering)",
            "        self.assertEqual(",
            "            [obj.name for obj in response.context[\"object_list\"]],",
            "            [",
            "                \"AAAAAAAAAA\",",
            "                \"BBBBBBBBBB\",",
            "                \"CCCCCCCCCC\",",
            "                \"DDDDDDDDDD\",",
            "            ],",
            "        )",
            "",
            "    def test_custom_order_from_from_viewset(self):",
            "        response = self.client.get(reverse(\"fctoy-alt3:index\"))",
            "        # The view has an ordering but it is overwritten by the viewset",
            "        self.assertFalse(FeatureCompleteToy._meta.ordering)",
            "        self.assertEqual(",
            "            [obj.name for obj in response.context[\"object_list\"]],",
            "            [",
            "                \"CCCCCCCCCC\",",
            "                \"AAAAAAAAAA\",",
            "                \"DDDDDDDDDD\",",
            "                \"BBBBBBBBBB\",",
            "            ],",
            "        )",
            "",
            "",
            "class TestBreadcrumbs(AdminTemplateTestUtils, WagtailTestUtils, TestCase):",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        cls.object = FeatureCompleteToy.objects.create(name=\"Test Toy\")",
            "",
            "    def test_index_view(self):",
            "        response = self.client.get(reverse(\"feature_complete_toy:index\"))",
            "        items = [",
            "            {",
            "                \"url\": \"\",",
            "                \"label\": \"Feature complete toys\",",
            "            }",
            "        ]",
            "        self.assertBreadcrumbsItemsRendered(items, response.content)",
            "",
            "    def test_add_view(self):",
            "        response = self.client.get(reverse(\"feature_complete_toy:add\"))",
            "        items = [",
            "            {",
            "                \"url\": reverse(\"feature_complete_toy:index\"),",
            "                \"label\": \"Feature complete toys\",",
            "            },",
            "            {",
            "                \"url\": \"\",",
            "                \"label\": \"New: Feature complete toy\",",
            "            },",
            "        ]",
            "        self.assertBreadcrumbsItemsRendered(items, response.content)",
            "",
            "    def test_edit_view(self):",
            "        edit_url = reverse(\"feature_complete_toy:edit\", args=(quote(self.object.pk),))",
            "        response = self.client.get(edit_url)",
            "        items = [",
            "            {",
            "                \"url\": reverse(\"feature_complete_toy:index\"),",
            "                \"label\": \"Feature complete toys\",",
            "            },",
            "            {",
            "                \"url\": \"\",",
            "                \"label\": str(self.object),",
            "            },",
            "        ]",
            "        self.assertBreadcrumbsItemsRendered(items, response.content)",
            "",
            "    def test_delete_view(self):",
            "        delete_url = reverse(",
            "            \"feature_complete_toy:delete\",",
            "            args=(quote(self.object.pk),),",
            "        )",
            "        response = self.client.get(delete_url)",
            "        self.assertBreadcrumbsNotRendered(response.content)",
            "",
            "    def test_history_view(self):",
            "        history_url = reverse(",
            "            \"feature_complete_toy:history\",",
            "            args=(quote(self.object.pk),),",
            "        )",
            "        response = self.client.get(history_url)",
            "        items = [",
            "            {",
            "                \"url\": reverse(\"feature_complete_toy:index\"),",
            "                \"label\": \"Feature complete toys\",",
            "            },",
            "            {",
            "                \"url\": reverse(",
            "                    \"feature_complete_toy:edit\", args=(quote(self.object.pk),)",
            "                ),",
            "                \"label\": str(self.object),",
            "            },",
            "            {",
            "                \"url\": \"\",",
            "                \"label\": \"History\",",
            "                \"sublabel\": str(self.object),",
            "            },",
            "        ]",
            "        self.assertBreadcrumbsItemsRendered(items, response.content)",
            "",
            "    def test_history_view_pagination(self):",
            "        for i in range(25):",
            "            log(instance=self.object, action=\"wagtail.edit\", user=self.user)",
            "",
            "        history_url = reverse(",
            "            \"feature_complete_toy:history\",",
            "            args=(quote(self.object.pk),),",
            "        )",
            "        response = self.client.get(history_url)",
            "        self.assertContains(response, \"Page 1 of 2\")",
            "        self.assertContains(response, f'<a href=\"{history_url}?p=2\">')",
            "",
            "    def test_usage_view(self):",
            "        usage_url = reverse(",
            "            \"feature_complete_toy:usage\",",
            "            args=(quote(self.object.pk),),",
            "        )",
            "        response = self.client.get(usage_url)",
            "        items = [",
            "            {",
            "                \"url\": reverse(\"feature_complete_toy:index\"),",
            "                \"label\": \"Feature complete toys\",",
            "            },",
            "            {",
            "                \"url\": reverse(",
            "                    \"feature_complete_toy:edit\", args=(quote(self.object.pk),)",
            "                ),",
            "                \"label\": str(self.object),",
            "            },",
            "            {",
            "                \"url\": \"\",",
            "                \"label\": \"Usage\",",
            "                \"sublabel\": str(self.object),",
            "            },",
            "        ]",
            "        self.assertBreadcrumbsItemsRendered(items, response.content)",
            "",
            "    def test_usage_view_pagination(self):",
            "        for i in range(25):",
            "            VariousOnDeleteModel.objects.create(",
            "                text=f\"Toybox {i}\", cascading_toy=self.object",
            "            )",
            "",
            "        usage_url = reverse(",
            "            \"feature_complete_toy:usage\",",
            "            args=(quote(self.object.pk),),",
            "        )",
            "        response = self.client.get(usage_url)",
            "        self.assertContains(response, \"Page 1 of 2\")",
            "        self.assertContains(response, f'<a href=\"{usage_url}?p=2\">')",
            "",
            "    def test_inspect_view(self):",
            "        inspect_url = reverse(",
            "            \"feature_complete_toy:inspect\",",
            "            args=(quote(self.object.pk),),",
            "        )",
            "        response = self.client.get(inspect_url)",
            "        items = [",
            "            {",
            "                \"url\": reverse(\"feature_complete_toy:index\"),",
            "                \"label\": \"Feature complete toys\",",
            "            },",
            "            {",
            "                \"url\": reverse(",
            "                    \"feature_complete_toy:edit\", args=(quote(self.object.pk),)",
            "                ),",
            "                \"label\": str(self.object),",
            "            },",
            "            {",
            "                \"url\": \"\",",
            "                \"label\": \"Inspect\",",
            "                \"sublabel\": str(self.object),",
            "            },",
            "        ]",
            "        self.assertBreadcrumbsItemsRendered(items, response.content)",
            "",
            "",
            "class TestLegacyPatterns(WagtailTestUtils, TestCase):",
            "    # RemovedInWagtail70Warning: legacy integer pk-based URLs will be removed",
            "",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        cls.object = JSONStreamModel.objects.create(",
            "            body='[{\"type\": \"text\", \"value\": \"foo\"}]',",
            "        )",
            "",
            "    def test_legacy_edit(self):",
            "        edit_url = reverse(\"streammodel:edit\", args=(quote(self.object.pk),))",
            "        legacy_edit_url = \"/admin/streammodel/1/\"",
            "        with self.assertWarnsRegex(",
            "            RemovedInWagtail70Warning,",
            "            \"`/<pk>/` edit view URL pattern has been deprecated in favour of /edit/<pk>/.\",",
            "        ):",
            "            response = self.client.get(legacy_edit_url)",
            "        self.assertEqual(edit_url, \"/admin/streammodel/edit/1/\")",
            "        self.assertRedirects(response, edit_url, 301)",
            "",
            "    def test_legacy_delete(self):",
            "        delete_url = reverse(\"streammodel:delete\", args=(quote(self.object.pk),))",
            "        legacy_delete_url = \"/admin/streammodel/1/delete/\"",
            "        with self.assertWarnsRegex(",
            "            RemovedInWagtail70Warning,",
            "            \"`/<pk>/delete/` delete view URL pattern has been deprecated in favour of /delete/<pk>/.\",",
            "        ):",
            "            response = self.client.get(legacy_delete_url)",
            "        self.assertEqual(delete_url, \"/admin/streammodel/delete/1/\")",
            "        self.assertRedirects(response, delete_url, 301)",
            "",
            "",
            "class TestHistoryView(WagtailTestUtils, TestCase):",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        cls.user = cls.create_test_user()",
            "        cls.object = FeatureCompleteToy.objects.create(name=\"Buzz\")",
            "        cls.url = reverse(",
            "            \"feature_complete_toy:history\",",
            "            args=(quote(cls.object.pk),),",
            "        )",
            "",
            "        content_type = ContentType.objects.get_for_model(FeatureCompleteToy)",
            "        cls.timestamp_1 = datetime.datetime(2021, 9, 30, 10, 1, 0)",
            "        cls.timestamp_2 = datetime.datetime(2022, 5, 10, 12, 34, 0)",
            "        if settings.USE_TZ:",
            "            cls.timestamp_1 = make_aware(cls.timestamp_1)",
            "            cls.timestamp_2 = make_aware(cls.timestamp_2)",
            "        ModelLogEntry.objects.create(",
            "            content_type=content_type,",
            "            label=\"Test Buzz\",",
            "            action=\"wagtail.create\",",
            "            user=cls.user,",
            "            timestamp=cls.timestamp_1,",
            "            object_id=cls.object.pk,",
            "        )",
            "        ModelLogEntry.objects.create(",
            "            content_type=content_type,",
            "            label=\"Test Buzz Updated\",",
            "            action=\"wagtail.edit\",",
            "            user=cls.user,",
            "            timestamp=cls.timestamp_2,",
            "            object_id=cls.object.pk,",
            "        )",
            "",
            "    def setUp(self):",
            "        self.login(self.user)",
            "",
            "    def test_simple(self):",
            "        expected = (",
            "            (\"Edited\", str(self.user), date_format(self.timestamp_2, \"c\")),",
            "            (\"Created\", str(self.user), date_format(self.timestamp_1, \"c\")),",
            "        )",
            "        response = self.client.get(self.url)",
            "        soup = self.get_soup(response.content)",
            "        rows = soup.select(\"tbody tr\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertEqual(len(rows), 2)",
            "",
            "        rendered_rows = []",
            "        for row in rows:",
            "            cells = []",
            "            tds = row.select(\"td\")",
            "            self.assertEqual(len(tds), 3)",
            "            cells.append(tds[0].text.strip())",
            "            cells.append(tds[1].text.strip())",
            "            cells.append(tds[2].select_one(\"time\").attrs.get(\"datetime\"))",
            "            rendered_rows.append(cells)",
            "",
            "        for rendered_row, expected_row in zip(rendered_rows, expected):",
            "            self.assertSequenceEqual(rendered_row, expected_row)",
            "",
            "    def test_filters(self):",
            "        response = self.client.get(self.url, {\"action\": \"wagtail.edit\"})",
            "        soup = self.get_soup(response.content)",
            "        rows = soup.select(\"tbody tr\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertEqual(len(rows), 1)",
            "        self.assertEqual(rows[0].select_one(\"td\").text.strip(), \"Edited\")",
            "",
            "        response = self.client.get(self.url, {\"action\": \"wagtail.create\"})",
            "        soup = self.get_soup(response.content)",
            "        rows = soup.select(\"tbody tr\")",
            "        heading = soup.select_one('h2[role=\"alert\"]')",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertEqual(heading.string.strip(), \"There is 1 match\")",
            "        self.assertEqual(len(rows), 1)",
            "        self.assertEqual(rows[0].select_one(\"td\").text.strip(), \"Created\")",
            "",
            "    def test_filtered_no_results(self):",
            "        response = self.client.get(self.url, {\"timestamp_before\": \"2020-01-01\"})",
            "        soup = self.get_soup(response.content)",
            "        results = soup.select_one(\"#listing-results\")",
            "        table = soup.select_one(\"table\")",
            "        p = results.select_one(\"p\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertIsNotNone(results)",
            "        self.assertIsNone(table)",
            "        self.assertIsNotNone(p)",
            "        self.assertEqual(p.text.strip(), \"No log entries match your query.\")",
            "",
            "    def test_empty(self):",
            "        ModelLogEntry.objects.all().delete()",
            "        response = self.client.get(self.url)",
            "        soup = self.get_soup(response.content)",
            "        results = soup.select_one(\"#listing-results\")",
            "        table = soup.select_one(\"table\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertIsNotNone(results)",
            "        self.assertEqual(results.text.strip(), \"There are no log entries to display.\")",
            "        self.assertIsNone(table)",
            "",
            "    def test_edit_view_links_to_history_view(self):",
            "        edit_url = reverse(\"feature_complete_toy:edit\", args=(quote(self.object.pk),))",
            "        response = self.client.get(edit_url)",
            "        soup = self.get_soup(response.content)",
            "        header = soup.select_one(\".w-slim-header\")",
            "        history_link = header.find(\"a\", attrs={\"href\": self.url})",
            "        self.assertIsNotNone(history_link)",
            "",
            "",
            "class TestUsageView(WagtailTestUtils, TestCase):",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        cls.user = cls.create_test_user()",
            "        cls.object = FeatureCompleteToy.objects.create(name=\"Buzz\")",
            "        cls.url = reverse(",
            "            \"feature_complete_toy:usage\",",
            "            args=(quote(cls.object.pk),),",
            "        )",
            "        cls.tbx = VariousOnDeleteModel.objects.create(",
            "            text=\"Toybox\", cascading_toy=cls.object",
            "        )",
            "",
            "    def setUp(self):",
            "        self.user = self.login(self.user)",
            "",
            "    def test_simple(self):",
            "        response = self.client.get(self.url)",
            "        self.assertEqual(response.status_code, 200)",
            "",
            "        soup = self.get_soup(response.content)",
            "        h1 = soup.select_one(\"h1\")",
            "        self.assertEqual(h1.text.strip(), f\"Usage: {self.object}\")",
            "",
            "        tds = soup.select(\"tbody tr td\")",
            "        self.assertEqual(len(tds), 3)",
            "        self.assertEqual(tds[0].text.strip(), str(self.tbx))",
            "        self.assertEqual(tds[1].text.strip(), \"Various on delete model\")",
            "        self.assertEqual(tds[2].text.strip(), \"Cascading toy\")",
            "",
            "        tbx_edit_url = AdminURLFinder(self.user).get_edit_url(self.tbx)",
            "",
            "        # Link to referrer's edit view",
            "        link = tds[0].select_one(\"a\")",
            "        self.assertIsNotNone(link)",
            "        self.assertEqual(link.attrs.get(\"href\"), tbx_edit_url)",
            "",
            "        # Link to referrer's edit view with parameters for the specific field",
            "        link = tds[2].select_one(\"a\")",
            "        self.assertIsNotNone(link)",
            "        self.assertIn(tbx_edit_url, link.attrs.get(\"href\"))",
            "",
            "    def test_usage_without_permission(self):",
            "        self.user.is_superuser = False",
            "        self.user.save()",
            "        admin_permission = Permission.objects.get(",
            "            content_type__app_label=\"wagtailadmin\", codename=\"access_admin\"",
            "        )",
            "        self.user.user_permissions.add(admin_permission)",
            "",
            "        response = self.client.get(self.url)",
            "        self.assertEqual(response.status_code, 302)",
            "        self.assertRedirects(response, reverse(\"wagtailadmin_home\"))",
            "",
            "    def test_usage_without_permission_on_referrer(self):",
            "        self.user.is_superuser = False",
            "        self.user.save()",
            "        admin_permission = Permission.objects.get(",
            "            content_type__app_label=\"wagtailadmin\", codename=\"access_admin\"",
            "        )",
            "        toy_edit_permission = Permission.objects.get(",
            "            content_type__app_label=\"tests\", codename=\"change_featurecompletetoy\"",
            "        )",
            "        self.user.user_permissions.add(admin_permission, toy_edit_permission)",
            "",
            "        response = self.client.get(self.url)",
            "        self.assertEqual(response.status_code, 200)",
            "",
            "        soup = self.get_soup(response.content)",
            "        h1 = soup.select_one(\"h1\")",
            "        self.assertEqual(h1.text.strip(), f\"Usage: {self.object}\")",
            "",
            "        tds = soup.select(\"tbody tr td\")",
            "        self.assertEqual(len(tds), 3)",
            "        self.assertEqual(tds[0].text.strip(), \"(Private various on delete model)\")",
            "        self.assertEqual(tds[1].text.strip(), \"Various on delete model\")",
            "        self.assertEqual(tds[2].text.strip(), \"Cascading toy\")",
            "",
            "        # Not link to referrer's edit view",
            "        link = tds[0].select_one(\"a\")",
            "        self.assertIsNone(link)",
            "",
            "        # Not link to referrer's edit view",
            "        link = tds[2].select_one(\"a\")",
            "        self.assertIsNone(link)",
            "",
            "    def test_usage_with_describe_on_delete(self):",
            "        response = self.client.get(self.url + \"?describe_on_delete=1\")",
            "        self.assertEqual(response.status_code, 200)",
            "",
            "        soup = self.get_soup(response.content)",
            "        h1 = soup.select_one(\"h1\")",
            "        self.assertEqual(h1.text.strip(), f\"Usage: {self.object}\")",
            "",
            "        tds = soup.select(\"tbody tr td\")",
            "        self.assertEqual(len(tds), 3)",
            "        self.assertEqual(tds[0].text.strip(), str(self.tbx))",
            "        self.assertEqual(tds[1].text.strip(), \"Various on delete model\")",
            "        self.assertEqual(",
            "            tds[2].text.strip(),",
            "            \"Cascading toy: the various on delete model will also be deleted\",",
            "        )",
            "",
            "        tbx_edit_url = AdminURLFinder(self.user).get_edit_url(self.tbx)",
            "",
            "        # Link to referrer's edit view",
            "        link = tds[0].select_one(\"a\")",
            "        self.assertIsNotNone(link)",
            "        self.assertEqual(link.attrs.get(\"href\"), tbx_edit_url)",
            "",
            "        # Link to referrer's edit view with parameters for the specific field",
            "        link = tds[2].select_one(\"a\")",
            "        self.assertIsNotNone(link)",
            "        self.assertIn(tbx_edit_url, link.attrs.get(\"href\"))",
            "",
            "    def test_empty(self):",
            "        self.tbx.delete()",
            "        response = self.client.get(self.url)",
            "        soup = self.get_soup(response.content)",
            "        results = soup.select_one(\"#listing-results\")",
            "        table = soup.select_one(\"table\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertIsNotNone(results)",
            "        self.assertEqual(results.text.strip(), \"There are no results.\")",
            "        self.assertIsNone(table)",
            "",
            "    def test_edit_view_links_to_usage_view(self):",
            "        edit_url = reverse(\"feature_complete_toy:edit\", args=(quote(self.object.pk),))",
            "        response = self.client.get(edit_url)",
            "        soup = self.get_soup(response.content)",
            "        side_panel = soup.select_one(\"[data-side-panel='status']\")",
            "        usage_link = side_panel.find(\"a\", attrs={\"href\": self.url})",
            "        self.assertIsNotNone(usage_link)",
            "",
            "    def test_delete_view_links_to_usage_view(self):",
            "        edit_url = reverse(\"feature_complete_toy:delete\", args=(quote(self.object.pk),))",
            "        response = self.client.get(edit_url)",
            "        soup = self.get_soup(response.content)",
            "        usage_link = soup.find(\"a\", attrs={\"href\": self.url + \"?describe_on_delete=1\"})",
            "        self.assertIsNotNone(usage_link)",
            "",
            "",
            "class TestInspectView(WagtailTestUtils, TestCase):",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        cls.object = FeatureCompleteToy.objects.create(name=\"Test Toy\")",
            "        cls.url = reverse(\"feature_complete_toy:inspect\", args=(quote(cls.object.pk),))",
            "        cls.edit_url = reverse(",
            "            \"feature_complete_toy:edit\", args=(quote(cls.object.pk),)",
            "        )",
            "        cls.delete_url = reverse(",
            "            \"feature_complete_toy:delete\", args=(quote(cls.object.pk),)",
            "        )",
            "",
            "    def test_simple(self):",
            "        response = self.client.get(self.url)",
            "        expected_fields = [\"Strid\", \"Release date\"]",
            "        expected_values = [",
            "            # The pk may contain whitespace at the start/end, it's hard to",
            "            # distinguish from the whitespace in the HTML so just strip it",
            "            self.object.pk.strip(),",
            "            localize(self.object.release_date),",
            "        ]",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertTemplateUsed(response, \"wagtailadmin/generic/inspect.html\")",
            "        soup = self.get_soup(response.content)",
            "        fields = [dt.text.strip() for dt in soup.select(\"dt\")]",
            "        values = [dd.text.strip() for dd in soup.select(\"dd\")]",
            "        self.assertEqual(fields, expected_fields)",
            "        self.assertEqual(values, expected_values)",
            "        # One in the breadcrumb, one at the bottom",
            "        self.assertEqual(len(soup.find_all(\"a\", attrs={\"href\": self.edit_url})), 2)",
            "        self.assertEqual(len(soup.find_all(\"a\", attrs={\"href\": self.delete_url})), 1)",
            "",
            "    def test_inspect_view_fields(self):",
            "        # The alt1 viewset has a custom inspect_view_fields and inspect_view_fields_exclude",
            "        response = self.client.get(",
            "            reverse(\"fctoy_alt1:inspect\", args=(quote(self.object.pk),))",
            "        )",
            "        expected_fields = [\"Name\"]",
            "        expected_values = [\"Test Toy\"]",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertTemplateUsed(response, \"wagtailadmin/generic/inspect.html\")",
            "        soup = self.get_soup(response.content)",
            "        fields = [dt.text.strip() for dt in soup.select(\"dt\")]",
            "        values = [dd.text.strip() for dd in soup.select(\"dd\")]",
            "        self.assertEqual(fields, expected_fields)",
            "        self.assertEqual(values, expected_values)",
            "",
            "    def test_disabled(self):",
            "        # An alternate viewset for the same model without inspect_view_enabled = True",
            "        with self.assertRaises(NoReverseMatch):",
            "            reverse(\"fctoy-alt2:inspect\", args=(quote(self.object.pk),))",
            "",
            "    def test_without_permission(self):",
            "        self.user.is_superuser = False",
            "        self.user.save()",
            "        admin_permission = Permission.objects.get(",
            "            content_type__app_label=\"wagtailadmin\", codename=\"access_admin\"",
            "        )",
            "        self.user.user_permissions.add(admin_permission)",
            "",
            "        response = self.client.get(self.url)",
            "        self.assertEqual(response.status_code, 302)",
            "        self.assertRedirects(response, reverse(\"wagtailadmin_home\"))",
            "",
            "    def test_only_add_permission(self):",
            "        self.user.is_superuser = False",
            "        self.user.user_permissions.add(",
            "            Permission.objects.get(",
            "                content_type__app_label=\"wagtailadmin\", codename=\"access_admin\"",
            "            ),",
            "            Permission.objects.get(",
            "                content_type__app_label=self.object._meta.app_label,",
            "                codename=get_permission_codename(\"add\", self.object._meta),",
            "            ),",
            "        )",
            "        self.user.save()",
            "",
            "        response = self.client.get(self.url)",
            "        expected_fields = [\"Strid\", \"Release date\"]",
            "        expected_values = [",
            "            # The pk may contain whitespace at the start/end, it's hard to",
            "            # distinguish from the whitespace in the HTML so just strip it",
            "            self.object.pk.strip(),",
            "            localize(self.object.release_date),",
            "        ]",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertTemplateUsed(response, \"wagtailadmin/generic/inspect.html\")",
            "        soup = self.get_soup(response.content)",
            "        fields = [dt.text.strip() for dt in soup.select(\"dt\")]",
            "        values = [dd.text.strip() for dd in soup.select(\"dd\")]",
            "        self.assertEqual(fields, expected_fields)",
            "        self.assertEqual(values, expected_values)",
            "        self.assertEqual(len(soup.find_all(\"a\", attrs={\"href\": self.edit_url})), 0)",
            "        self.assertEqual(len(soup.find_all(\"a\", attrs={\"href\": self.delete_url})), 0)",
            "",
            "",
            "class TestListingButtons(WagtailTestUtils, TestCase):",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        cls.object = FeatureCompleteToy.objects.create(name=\"Test Toy\")",
            "",
            "    def test_simple(self):",
            "        response = self.client.get(reverse(\"feature_complete_toy:index\"))",
            "",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertTemplateUsed(response, \"wagtailadmin/shared/buttons.html\")",
            "",
            "        soup = self.get_soup(response.content)",
            "        actions = soup.select_one(\"tbody tr td ul.actions\")",
            "        more_dropdown = actions.select_one(\"li [data-controller='w-dropdown']\")",
            "        self.assertIsNotNone(more_dropdown)",
            "        more_button = more_dropdown.select_one(\"button\")",
            "        self.assertEqual(",
            "            more_button.attrs.get(\"aria-label\").strip(),",
            "            f\"More options for '{self.object}'\",",
            "        )",
            "",
            "        expected_buttons = [",
            "            (",
            "                \"Edit\",",
            "                f\"Edit '{self.object}'\",",
            "                reverse(\"feature_complete_toy:edit\", args=[quote(self.object.pk)]),",
            "            ),",
            "            (",
            "                \"Copy\",",
            "                f\"Copy '{self.object}'\",",
            "                reverse(\"feature_complete_toy:copy\", args=[quote(self.object.pk)]),",
            "            ),",
            "            (",
            "                \"Inspect\",",
            "                f\"Inspect '{self.object}'\",",
            "                reverse(\"feature_complete_toy:inspect\", args=[quote(self.object.pk)]),",
            "            ),",
            "            (",
            "                \"Delete\",",
            "                f\"Delete '{self.object}'\",",
            "                reverse(\"feature_complete_toy:delete\", args=[quote(self.object.pk)]),",
            "            ),",
            "        ]",
            "",
            "        rendered_buttons = more_dropdown.select(\"a\")",
            "        self.assertEqual(len(rendered_buttons), len(expected_buttons))",
            "",
            "        for rendered_button, (label, aria_label, url) in zip(",
            "            rendered_buttons, expected_buttons",
            "        ):",
            "            self.assertEqual(rendered_button.text.strip(), label)",
            "            self.assertEqual(rendered_button.attrs.get(\"aria-label\"), aria_label)",
            "            self.assertEqual(rendered_button.attrs.get(\"href\"), url)",
            "",
            "    def test_copy_disabled(self):",
            "        response = self.client.get(reverse(\"fctoy_alt1:index\"))",
            "",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertTemplateUsed(response, \"wagtailadmin/shared/buttons.html\")",
            "",
            "        soup = self.get_soup(response.content)",
            "        actions = soup.select_one(\"tbody tr td ul.actions\")",
            "        more_dropdown = actions.select_one(\"li [data-controller='w-dropdown']\")",
            "        self.assertIsNotNone(more_dropdown)",
            "        more_button = more_dropdown.select_one(\"button\")",
            "        self.assertEqual(",
            "            more_button.attrs.get(\"aria-label\").strip(),",
            "            f\"More options for '{self.object}'\",",
            "        )",
            "",
            "        expected_buttons = [",
            "            (",
            "                \"Edit\",",
            "                f\"Edit '{self.object}'\",",
            "                reverse(\"fctoy_alt1:edit\", args=[quote(self.object.pk)]),",
            "            ),",
            "            (",
            "                \"Inspect\",",
            "                f\"Inspect '{self.object}'\",",
            "                reverse(\"fctoy_alt1:inspect\", args=[quote(self.object.pk)]),",
            "            ),",
            "            (",
            "                \"Delete\",",
            "                f\"Delete '{self.object}'\",",
            "                reverse(\"fctoy_alt1:delete\", args=[quote(self.object.pk)]),",
            "            ),",
            "        ]",
            "",
            "        rendered_buttons = more_dropdown.select(\"a\")",
            "        self.assertEqual(len(rendered_buttons), len(expected_buttons))",
            "",
            "        for rendered_button, (label, aria_label, url) in zip(",
            "            rendered_buttons, expected_buttons",
            "        ):",
            "            self.assertEqual(rendered_button.text.strip(), label)",
            "            self.assertEqual(rendered_button.attrs.get(\"aria-label\"), aria_label)",
            "            self.assertEqual(rendered_button.attrs.get(\"href\"), url)",
            "",
            "",
            "class TestCopyView(WagtailTestUtils, TestCase):",
            "    def setUp(self):",
            "        self.user = self.login()",
            "        self.url = reverse(\"feature_complete_toy:copy\", args=[quote(self.object.pk)])",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        cls.object = FeatureCompleteToy.objects.create(name=\"Test Toy\")",
            "",
            "    def test_without_permission(self):",
            "        self.user.is_superuser = False",
            "        self.user.save()",
            "        admin_permission = Permission.objects.get(",
            "            content_type__app_label=\"wagtailadmin\", codename=\"access_admin\"",
            "        )",
            "        self.user.user_permissions.add(admin_permission)",
            "",
            "        response = self.client.get(self.url)",
            "        self.assertEqual(response.status_code, 302)",
            "        self.assertRedirects(response, reverse(\"wagtailadmin_home\"))",
            "",
            "    def test_form_is_prefilled(self):",
            "        request = RequestFactory().get(self.url)",
            "        request.user = self.user",
            "        view = FCToyAlt1ViewSet().copy_view_class()",
            "        view.setup(request)",
            "        view.model = self.object.__class__",
            "        view.kwargs = {\"pk\": self.object.pk}",
            "",
            "        self.assertEqual(view.get_form_kwargs()[\"instance\"], self.object)",
            "",
            "",
            "class TestEditHandler(WagtailTestUtils, TestCase):",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        cls.object = FeatureCompleteToy.objects.create(name=\"Test Toy\")",
            "        cls.url = reverse(\"feature_complete_toy:edit\", args=(quote(cls.object.pk),))",
            "",
            "    def test_edit_form_rendered_with_panels(self):",
            "        response = self.client.get(self.url)",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertTemplateUsed(response, \"wagtailadmin/shared/panel.html\")",
            "        # Many features from the Panels API are powered by client-side JS in",
            "        # _editor_js.html. We need to make sure that this template is included",
            "        # in the response for now.",
            "        self.assertTemplateUsed(response, \"wagtailadmin/pages/_editor_js.html\", count=1)",
            "",
            "        soup = self.get_soup(response.content)",
            "",
            "        # Minimap should be rendered",
            "        minimap_container = soup.select_one(\"[data-minimap-container]\")",
            "        self.assertIsNotNone(minimap_container)",
            "",
            "        # Form should be rendered using panels",
            "        panels = soup.select(\"[data-panel]\")",
            "        self.assertEqual(len(panels), 2)",
            "        headings = [\"Name\", \"Release date\"]",
            "        for expected_heading, panel in zip(headings, panels):",
            "            rendered_heading = panel.select_one(\"[data-panel-heading-text]\")",
            "            self.assertIsNotNone(rendered_heading)",
            "            self.assertEqual(rendered_heading.text.strip(), expected_heading)",
            "",
            "        # Ensure modal-workflow.js is included, as it's needed by choosers",
            "        modal_workflow_js = versioned_static(\"wagtailadmin/js/modal-workflow.js\")",
            "        modal_workflow_script = soup.select_one(f'script[src=\"{modal_workflow_js}\"]')",
            "        self.assertIsNotNone(modal_workflow_script)",
            "",
            "",
            "class TestDefaultMessages(WagtailTestUtils, TestCase):",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    @classmethod",
            "    def setUpTestData(cls):",
            "        cls.object = FeatureCompleteToy.objects.create(name=\"Test Toy\")",
            "        cls.create_url = reverse(\"feature_complete_toy:add\")",
            "        cls.edit_url = reverse(",
            "            \"feature_complete_toy:edit\", args=(quote(cls.object.pk),)",
            "        )",
            "        cls.delete_url = reverse(",
            "            \"feature_complete_toy:delete\", args=(quote(cls.object.pk),)",
            "        )",
            "",
            "    def test_create_error(self):",
            "        response = self.client.post(",
            "            self.create_url,",
            "            data={\"name\": \"\", \"release_date\": \"2024-01-11\"},",
            "        )",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertContains(",
            "            response,",
            "            escape(\"The feature complete toy could not be created due to errors.\"),",
            "        )",
            "",
            "    def test_create_success(self):",
            "        response = self.client.post(",
            "            self.create_url,",
            "            data={\"name\": \"Pink Flamingo\", \"release_date\": \"2024-01-11\"},",
            "            follow=True,",
            "        )",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertContains(",
            "            response,",
            "            escape(\"Feature complete toy 'Pink Flamingo (2024-01-11)' created.\"),",
            "        )",
            "",
            "    def test_edit_error(self):",
            "        response = self.client.post(",
            "            self.edit_url, data={\"name\": \"\", \"release_date\": \"2024-01-11\"}",
            "        )",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertContains(",
            "            response,",
            "            escape(\"The feature complete toy could not be saved due to errors.\"),",
            "        )",
            "",
            "    def test_edit_success(self):",
            "        response = self.client.post(",
            "            self.edit_url,",
            "            data={\"name\": \"rubberduck\", \"release_date\": \"2024-02-01\"},",
            "            follow=True,",
            "        )",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertContains(",
            "            response,",
            "            escape(\"Feature complete toy 'rubberduck (2024-02-01)' updated.\"),",
            "        )",
            "",
            "    def test_delete_success(self):",
            "        response = self.client.post(self.delete_url, follow=True)",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertContains(",
            "            response,",
            "            escape(f\"Feature complete toy '{self.object}' deleted.\"),",
            "        )"
        ],
        "action": [
            "0",
            "0",
            "0",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "1477": [
                "TestEditHandler",
                "test_field_permissions"
            ],
            "1478": [
                "TestEditHandler",
                "test_field_permissions"
            ],
            "1479": [
                "TestEditHandler",
                "test_field_permissions"
            ],
            "1480": [
                "TestEditHandler",
                "test_field_permissions"
            ],
            "1481": [
                "TestEditHandler",
                "test_field_permissions"
            ],
            "1482": [
                "TestEditHandler",
                "test_field_permissions"
            ],
            "1483": [
                "TestEditHandler",
                "test_field_permissions"
            ],
            "1484": [
                "TestEditHandler",
                "test_field_permissions"
            ],
            "1485": [
                "TestEditHandler",
                "test_field_permissions"
            ],
            "1486": [
                "TestEditHandler",
                "test_field_permissions"
            ],
            "1487": [
                "TestEditHandler",
                "test_field_permissions"
            ],
            "1488": [
                "TestEditHandler",
                "test_field_permissions"
            ],
            "1489": [
                "TestEditHandler",
                "test_field_permissions"
            ],
            "1490": [
                "TestEditHandler",
                "test_field_permissions"
            ],
            "1491": [
                "TestEditHandler",
                "test_field_permissions"
            ],
            "1492": [
                "TestEditHandler",
                "test_field_permissions"
            ],
            "1493": [
                "TestEditHandler",
                "test_field_permissions"
            ],
            "1494": [
                "TestEditHandler",
                "test_field_permissions"
            ],
            "1495": [
                "TestEditHandler",
                "test_field_permissions"
            ],
            "1496": [
                "TestEditHandler",
                "test_field_permissions"
            ],
            "1497": [
                "TestEditHandler",
                "test_field_permissions"
            ],
            "1498": [
                "TestEditHandler",
                "test_field_permissions"
            ],
            "1499": [
                "TestEditHandler",
                "test_field_permissions"
            ],
            "1500": [
                "TestEditHandler",
                "test_field_permissions"
            ],
            "1501": [
                "TestEditHandler",
                "test_field_permissions"
            ],
            "1502": [
                "TestEditHandler",
                "test_field_permissions"
            ],
            "1503": [
                "TestEditHandler",
                "test_field_permissions"
            ],
            "1504": [
                "TestEditHandler",
                "test_field_permissions"
            ],
            "1505": []
        },
        "addLocation": []
    },
    "wagtail/admin/views/generic/models.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 27,
                "afterPatchRowNumber": 27,
                "PatchRowcode": " from wagtail.actions.unpublish import UnpublishAction"
            },
            "1": {
                "beforePatchRowNumber": 28,
                "afterPatchRowNumber": 28,
                "PatchRowcode": " from wagtail.admin import messages"
            },
            "2": {
                "beforePatchRowNumber": 29,
                "afterPatchRowNumber": 29,
                "PatchRowcode": " from wagtail.admin.filters import WagtailFilterSet"
            },
            "3": {
                "beforePatchRowNumber": 30,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-from wagtail.admin.forms.models import WagtailAdminModelForm"
            },
            "4": {
                "beforePatchRowNumber": 31,
                "afterPatchRowNumber": 30,
                "PatchRowcode": " from wagtail.admin.forms.search import SearchForm"
            },
            "5": {
                "beforePatchRowNumber": 32,
                "afterPatchRowNumber": 31,
                "PatchRowcode": " from wagtail.admin.panels import get_edit_handler"
            },
            "6": {
                "beforePatchRowNumber": 33,
                "afterPatchRowNumber": 32,
                "PatchRowcode": " from wagtail.admin.ui.components import Component, MediaContainer"
            },
            "7": {
                "beforePatchRowNumber": 617,
                "afterPatchRowNumber": 616,
                "PatchRowcode": "             for locale in Locale.objects.all().exclude(id=self.locale.id)"
            },
            "8": {
                "beforePatchRowNumber": 618,
                "afterPatchRowNumber": 617,
                "PatchRowcode": "         ]"
            },
            "9": {
                "beforePatchRowNumber": 619,
                "afterPatchRowNumber": 618,
                "PatchRowcode": " "
            },
            "10": {
                "beforePatchRowNumber": 620,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    def get_initial_form_instance(self):"
            },
            "11": {
                "beforePatchRowNumber": 621,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        if self.locale:"
            },
            "12": {
                "beforePatchRowNumber": 622,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            instance = self.model()"
            },
            "13": {
                "beforePatchRowNumber": 623,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            instance.locale = self.locale"
            },
            "14": {
                "beforePatchRowNumber": 624,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            return instance"
            },
            "15": {
                "beforePatchRowNumber": 625,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "16": {
                "beforePatchRowNumber": 626,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    def get_form_kwargs(self):"
            },
            "17": {
                "beforePatchRowNumber": 627,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        if instance := self.get_initial_form_instance():"
            },
            "18": {
                "beforePatchRowNumber": 628,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            # super().get_form_kwargs() will use self.object as the instance kwarg"
            },
            "19": {
                "beforePatchRowNumber": 629,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            self.object = instance"
            },
            "20": {
                "beforePatchRowNumber": 630,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        kwargs = super().get_form_kwargs()"
            },
            "21": {
                "beforePatchRowNumber": 631,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "22": {
                "beforePatchRowNumber": 632,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        form_class = self.get_form_class()"
            },
            "23": {
                "beforePatchRowNumber": 633,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        # Add for_user support for PermissionedForm"
            },
            "24": {
                "beforePatchRowNumber": 634,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        if issubclass(form_class, WagtailAdminModelForm):"
            },
            "25": {
                "beforePatchRowNumber": 635,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            kwargs[\"for_user\"] = self.request.user"
            },
            "26": {
                "beforePatchRowNumber": 636,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        return kwargs"
            },
            "27": {
                "beforePatchRowNumber": 637,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "28": {
                "beforePatchRowNumber": 638,
                "afterPatchRowNumber": 619,
                "PatchRowcode": "     def save_instance(self):"
            },
            "29": {
                "beforePatchRowNumber": 639,
                "afterPatchRowNumber": 620,
                "PatchRowcode": "         \"\"\""
            },
            "30": {
                "beforePatchRowNumber": 640,
                "afterPatchRowNumber": 621,
                "PatchRowcode": "         Called after the form is successfully validated - saves the object to the db"
            },
            "31": {
                "beforePatchRowNumber": 805,
                "afterPatchRowNumber": 786,
                "PatchRowcode": "             for translation in self.object.get_translations().select_related(\"locale\")"
            },
            "32": {
                "beforePatchRowNumber": 806,
                "afterPatchRowNumber": 787,
                "PatchRowcode": "         ]"
            },
            "33": {
                "beforePatchRowNumber": 807,
                "afterPatchRowNumber": 788,
                "PatchRowcode": " "
            },
            "34": {
                "beforePatchRowNumber": 808,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    def get_form_kwargs(self):"
            },
            "35": {
                "beforePatchRowNumber": 809,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        kwargs = super().get_form_kwargs()"
            },
            "36": {
                "beforePatchRowNumber": 810,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        form_class = self.get_form_class()"
            },
            "37": {
                "beforePatchRowNumber": 811,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        if issubclass(form_class, WagtailAdminModelForm):"
            },
            "38": {
                "beforePatchRowNumber": 812,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            kwargs[\"for_user\"] = self.request.user"
            },
            "39": {
                "beforePatchRowNumber": 813,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        return kwargs"
            },
            "40": {
                "beforePatchRowNumber": 814,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "41": {
                "beforePatchRowNumber": 815,
                "afterPatchRowNumber": 789,
                "PatchRowcode": "     def save_instance(self):"
            },
            "42": {
                "beforePatchRowNumber": 816,
                "afterPatchRowNumber": 790,
                "PatchRowcode": "         \"\"\""
            },
            "43": {
                "beforePatchRowNumber": 817,
                "afterPatchRowNumber": 791,
                "PatchRowcode": "         Called after the form is successfully validated - saves the object to the db."
            }
        },
        "frontPatchFile": [
            "import warnings",
            "",
            "from django.contrib.admin.utils import label_for_field, quote, unquote",
            "from django.contrib.contenttypes.models import ContentType",
            "from django.core.exceptions import (",
            "    FieldDoesNotExist,",
            "    ImproperlyConfigured,",
            "    PermissionDenied,",
            ")",
            "from django.db import models, transaction",
            "from django.db.models import Q",
            "from django.db.models.functions import Cast",
            "from django.http import Http404, HttpResponseRedirect",
            "from django.shortcuts import get_object_or_404, redirect",
            "from django.urls import reverse",
            "from django.utils.functional import cached_property",
            "from django.utils.text import capfirst",
            "from django.utils.translation import gettext as _",
            "from django.utils.translation import gettext_lazy",
            "from django.views.generic import TemplateView",
            "from django.views.generic.edit import (",
            "    BaseCreateView,",
            "    BaseDeleteView,",
            "    BaseUpdateView,",
            ")",
            "",
            "from wagtail.actions.unpublish import UnpublishAction",
            "from wagtail.admin import messages",
            "from wagtail.admin.filters import WagtailFilterSet",
            "from wagtail.admin.forms.models import WagtailAdminModelForm",
            "from wagtail.admin.forms.search import SearchForm",
            "from wagtail.admin.panels import get_edit_handler",
            "from wagtail.admin.ui.components import Component, MediaContainer",
            "from wagtail.admin.ui.fields import display_class_registry",
            "from wagtail.admin.ui.side_panels import StatusSidePanel",
            "from wagtail.admin.ui.tables import (",
            "    ButtonsColumnMixin,",
            "    Column,",
            "    TitleColumn,",
            "    UpdatedAtColumn,",
            ")",
            "from wagtail.admin.utils import get_latest_str, get_valid_next_url_from_request",
            "from wagtail.admin.views.mixins import SpreadsheetExportMixin",
            "from wagtail.admin.widgets.button import (",
            "    Button,",
            "    ButtonWithDropdown,",
            "    HeaderButton,",
            "    ListingButton,",
            ")",
            "from wagtail.log_actions import log",
            "from wagtail.log_actions import registry as log_registry",
            "from wagtail.models import DraftStateMixin, Locale, ReferenceIndex",
            "from wagtail.models.audit_log import ModelLogEntry",
            "from wagtail.search.backends import get_search_backend",
            "from wagtail.search.index import class_is_indexed",
            "",
            "from .base import BaseListingView, WagtailAdminTemplateMixin",
            "from .mixins import BeforeAfterHookMixin, HookResponseMixin, LocaleMixin, PanelMixin",
            "from .permissions import PermissionCheckedMixin",
            "",
            "",
            "class IndexView(",
            "    SpreadsheetExportMixin,",
            "    LocaleMixin,",
            "    PermissionCheckedMixin,",
            "    BaseListingView,",
            "):",
            "    model = None",
            "    template_name = \"wagtailadmin/generic/index.html\"",
            "    results_template_name = \"wagtailadmin/generic/index_results.html\"",
            "    add_url_name = None",
            "    edit_url_name = None",
            "    copy_url_name = None",
            "    inspect_url_name = None",
            "    delete_url_name = None",
            "    any_permission_required = [\"add\", \"change\", \"delete\"]",
            "    search_fields = None",
            "    search_backend_name = \"default\"",
            "    is_searchable = None",
            "    search_kwarg = \"q\"",
            "    columns = None  # If not explicitly specified, will be derived from list_display",
            "    list_display = [\"__str__\", UpdatedAtColumn()]",
            "    list_filter = None",
            "    show_other_searches = False",
            "",
            "    def setup(self, request, *args, **kwargs):",
            "        super().setup(request, *args, **kwargs)",
            "",
            "        if not self.filterset_class:",
            "            # Allow filterset_class to be dynamically constructed from list_filter",
            "            self.filterset_class = self.get_filterset_class()",
            "",
            "        self.setup_search()",
            "",
            "    def setup_search(self):",
            "        self.is_searchable = self.get_is_searchable()",
            "        self.search_url = self.get_search_url()",
            "        self.search_form = self.get_search_form()",
            "        self.is_searching = False",
            "        self.search_query = None",
            "",
            "        if self.search_form and self.search_form.is_valid():",
            "            self.search_query = self.search_form.cleaned_data[self.search_kwarg]",
            "            self.is_searching = bool(self.search_query)",
            "",
            "    def get_is_searchable(self):",
            "        if self.model is None:",
            "            return False",
            "        if self.is_searchable is None:",
            "            return class_is_indexed(self.model) or self.search_fields",
            "        return self.is_searchable",
            "",
            "    def get_search_url(self):",
            "        if not self.is_searchable:",
            "            return None",
            "        return self.index_url_name",
            "",
            "    def get_search_form(self):",
            "        if self.model is None or not self.is_searchable:",
            "            return None",
            "",
            "        if self.is_searchable and self.search_kwarg in self.request.GET:",
            "            return SearchForm(self.request.GET)",
            "",
            "        return SearchForm()",
            "",
            "    def get_filterset_class(self):",
            "        # Allow filterset_class to be dynamically constructed from list_filter.",
            "",
            "        # If the model is translatable, ensure a ``WagtailFilterSet`` subclass",
            "        # is returned anyway (even if list_filter is undefined), so the locale",
            "        # filter is always included.",
            "        if not self.model or (not self.list_filter and not self.locale):",
            "            return None",
            "",
            "        class Meta:",
            "            model = self.model",
            "            fields = self.list_filter or []",
            "",
            "        return type(",
            "            f\"{self.model.__name__}FilterSet\",",
            "            (WagtailFilterSet,),",
            "            {\"Meta\": Meta},",
            "        )",
            "",
            "    def _annotate_queryset_updated_at(self, queryset):",
            "        # Annotate the objects' updated_at, use _ prefix to avoid name collision",
            "        # with an existing database field.",
            "        # By default, use the latest log entry's timestamp, but subclasses may",
            "        # override this to e.g. use the latest revision's timestamp instead.",
            "",
            "        log_model = log_registry.get_log_model_for_model(queryset.model)",
            "",
            "        # If the log model is not a subclass of ModelLogEntry, we don't know how",
            "        # to query the logs for the object, so skip the annotation.",
            "        if not log_model or not issubclass(log_model, ModelLogEntry):",
            "            return queryset",
            "",
            "        latest_log = (",
            "            log_model.objects.filter(",
            "                content_type=ContentType.objects.get_for_model(",
            "                    queryset.model, for_concrete_model=False",
            "                ),",
            "                object_id=Cast(models.OuterRef(\"pk\"), models.CharField()),",
            "            )",
            "            .order_by(\"-timestamp\", \"-pk\")",
            "            .values(\"timestamp\")[:1]",
            "        )",
            "        return queryset.annotate(_updated_at=models.Subquery(latest_log))",
            "",
            "    def order_queryset(self, queryset):",
            "        has_updated_at_column = any(",
            "            getattr(column, \"accessor\", None) == \"_updated_at\"",
            "            for column in self.columns",
            "        )",
            "        if has_updated_at_column:",
            "            queryset = self._annotate_queryset_updated_at(queryset)",
            "",
            "        # Explicitly handle null values for the updated at column to ensure consistency",
            "        # across database backends and match the behaviour in page explorer",
            "        if self.ordering == \"_updated_at\":",
            "            return queryset.order_by(models.F(\"_updated_at\").asc(nulls_first=True))",
            "        elif self.ordering == \"-_updated_at\":",
            "            return queryset.order_by(models.F(\"_updated_at\").desc(nulls_last=True))",
            "        else:",
            "            queryset = super().order_queryset(queryset)",
            "",
            "            # Preserve the model-level ordering if specified, but fall back on",
            "            # updated_at and PK if not (to ensure pagination is consistent)",
            "            if not queryset.ordered:",
            "                if has_updated_at_column:",
            "                    queryset = queryset.order_by(",
            "                        models.F(\"_updated_at\").desc(nulls_last=True), \"-pk\"",
            "                    )",
            "                else:",
            "                    queryset = queryset.order_by(\"-pk\")",
            "",
            "            return queryset",
            "",
            "    def get_queryset(self):",
            "        queryset = super().get_queryset()",
            "        queryset = self.search_queryset(queryset)",
            "        return queryset",
            "",
            "    def search_queryset(self, queryset):",
            "        if not self.is_searching:",
            "            return queryset",
            "",
            "        if class_is_indexed(queryset.model) and self.search_backend_name:",
            "            search_backend = get_search_backend(self.search_backend_name)",
            "            if queryset.model.get_autocomplete_search_fields():",
            "                return search_backend.autocomplete(",
            "                    self.search_query,",
            "                    queryset,",
            "                    fields=self.search_fields,",
            "                    order_by_relevance=(not self.is_explicitly_ordered),",
            "                )",
            "            else:",
            "                # fall back on non-autocompleting search",
            "                warnings.warn(",
            "                    f\"{queryset.model} is defined as Indexable but does not specify \"",
            "                    \"any AutocompleteFields. Searches within the admin will only \"",
            "                    \"respond to complete words.\",",
            "                    category=RuntimeWarning,",
            "                )",
            "                return search_backend.search(",
            "                    self.search_query,",
            "                    queryset,",
            "                    fields=self.search_fields,",
            "                    order_by_relevance=(not self.is_explicitly_ordered),",
            "                )",
            "        query = Q()",
            "        for field in self.search_fields or []:",
            "            query |= Q(**{field + \"__icontains\": self.search_query})",
            "        return queryset.filter(query)",
            "",
            "    def _get_title_column(self, field_name, column_class=TitleColumn, **kwargs):",
            "        if not issubclass(column_class, ButtonsColumnMixin):",
            "",
            "            def get_buttons(column, instance, *args, **kwargs):",
            "                return self.get_list_buttons(instance)",
            "",
            "            column_class = type(",
            "                column_class.__name__,",
            "                (ButtonsColumnMixin, column_class),",
            "                {\"get_buttons\": get_buttons},",
            "            )",
            "        if not self.model:",
            "            return column_class(",
            "                \"name\",",
            "                label=gettext_lazy(\"Name\"),",
            "                accessor=str,",
            "                get_url=self.get_edit_url,",
            "            )",
            "        return self._get_custom_column(",
            "            field_name, column_class, get_url=self.get_edit_url, **kwargs",
            "        )",
            "",
            "    def _get_custom_column(self, field_name, column_class=Column, **kwargs):",
            "        label, attr = label_for_field(field_name, self.model, return_attr=True)",
            "        sort_key = getattr(attr, \"admin_order_field\", None)",
            "",
            "        # attr is None if the field is an actual database field,",
            "        # so it's possible to sort by it",
            "        if attr is None:",
            "            sort_key = field_name",
            "",
            "        return column_class(",
            "            field_name,",
            "            label=capfirst(label),",
            "            sort_key=sort_key,",
            "            **kwargs,",
            "        )",
            "",
            "    @cached_property",
            "    def columns(self):",
            "        columns = []",
            "        for i, field in enumerate(self.list_display):",
            "            if isinstance(field, Column):",
            "                column = field",
            "            elif i == 0:",
            "                column = self._get_title_column(field)",
            "            else:",
            "                column = self._get_custom_column(field)",
            "            columns.append(column)",
            "",
            "        return columns",
            "",
            "    def get_edit_url(self, instance):",
            "        if self.edit_url_name:",
            "            return reverse(self.edit_url_name, args=(quote(instance.pk),))",
            "",
            "    def get_copy_url(self, instance):",
            "        if self.copy_url_name:",
            "            return reverse(self.copy_url_name, args=(quote(instance.pk),))",
            "",
            "    def get_inspect_url(self, instance):",
            "        if self.inspect_url_name:",
            "            return reverse(self.inspect_url_name, args=(quote(instance.pk),))",
            "",
            "    def get_delete_url(self, instance):",
            "        if self.delete_url_name:",
            "            return reverse(self.delete_url_name, args=(quote(instance.pk),))",
            "",
            "    def get_add_url(self):",
            "        if self.permission_policy and not self.permission_policy.user_has_permission(",
            "            self.request.user, \"add\"",
            "        ):",
            "            return None",
            "        if self.add_url_name:",
            "            return self._set_locale_query_param(reverse(self.add_url_name))",
            "",
            "    @cached_property",
            "    def add_url(self):",
            "        return self.get_add_url()",
            "",
            "    def get_page_title(self):",
            "        if not self.page_title and self.model:",
            "            return capfirst(self.model._meta.verbose_name_plural)",
            "        return self.page_title",
            "",
            "    def get_breadcrumbs_items(self):",
            "        if not self.model:",
            "            return self.breadcrumbs_items",
            "        return self.breadcrumbs_items + [",
            "            {\"url\": \"\", \"label\": capfirst(self.model._meta.verbose_name_plural)},",
            "        ]",
            "",
            "    @cached_property",
            "    def header_buttons(self):",
            "        buttons = []",
            "        if self.add_url:",
            "            buttons.append(",
            "                HeaderButton(",
            "                    self.add_item_label,",
            "                    url=self.add_url,",
            "                    icon_name=\"plus\",",
            "                )",
            "            )",
            "        return buttons",
            "",
            "    @cached_property",
            "    def header_more_buttons(self):",
            "        buttons = []",
            "        if self.list_export:",
            "            buttons.append(",
            "                Button(",
            "                    _(\"Download XLSX\"),",
            "                    url=self.xlsx_export_url,",
            "                    icon_name=\"download\",",
            "                    priority=90,",
            "                )",
            "            )",
            "            buttons.append(",
            "                Button(",
            "                    _(\"Download CSV\"),",
            "                    url=self.csv_export_url,",
            "                    icon_name=\"download\",",
            "                    priority=100,",
            "                )",
            "            )",
            "",
            "        return buttons",
            "",
            "    def get_list_more_buttons(self, instance):",
            "        buttons = []",
            "        edit_url = self.get_edit_url(instance)",
            "        can_edit = (",
            "            not self.permission_policy",
            "            or self.permission_policy.user_has_permission(self.request.user, \"change\")",
            "        )",
            "        if edit_url and can_edit:",
            "            buttons.append(",
            "                ListingButton(",
            "                    _(\"Edit\"),",
            "                    url=self.get_edit_url(instance),",
            "                    icon_name=\"edit\",",
            "                    attrs={",
            "                        \"aria-label\": _(\"Edit '%(title)s'\") % {\"title\": str(instance)}",
            "                    },",
            "                    priority=10,",
            "                )",
            "            )",
            "        copy_url = self.get_copy_url(instance)",
            "        can_copy = self.permission_policy.user_has_permission(self.request.user, \"add\")",
            "        if copy_url and can_copy:",
            "            buttons.append(",
            "                ListingButton(",
            "                    _(\"Copy\"),",
            "                    url=copy_url,",
            "                    icon_name=\"copy\",",
            "                    attrs={",
            "                        \"aria-label\": _(\"Copy '%(title)s'\") % {\"title\": str(instance)}",
            "                    },",
            "                    priority=20,",
            "                )",
            "            )",
            "        inspect_url = self.get_inspect_url(instance)",
            "        if inspect_url:",
            "            buttons.append(",
            "                ListingButton(",
            "                    _(\"Inspect\"),",
            "                    url=inspect_url,",
            "                    icon_name=\"info-circle\",",
            "                    attrs={",
            "                        \"aria-label\": _(\"Inspect '%(title)s'\")",
            "                        % {\"title\": str(instance)}",
            "                    },",
            "                    priority=20,",
            "                )",
            "            )",
            "        delete_url = self.get_delete_url(instance)",
            "        can_delete = (",
            "            not self.permission_policy",
            "            or self.permission_policy.user_has_permission(self.request.user, \"delete\")",
            "        )",
            "        if delete_url and can_delete:",
            "            buttons.append(",
            "                ListingButton(",
            "                    _(\"Delete\"),",
            "                    url=delete_url,",
            "                    icon_name=\"bin\",",
            "                    attrs={",
            "                        \"aria-label\": _(\"Delete '%(title)s'\") % {\"title\": str(instance)}",
            "                    },",
            "                    priority=30,",
            "                )",
            "            )",
            "        return buttons",
            "",
            "    def get_list_buttons(self, instance):",
            "        buttons = self.get_list_more_buttons(instance)",
            "        return [",
            "            ButtonWithDropdown(",
            "                buttons=buttons,",
            "                icon_name=\"dots-horizontal\",",
            "                attrs={",
            "                    \"aria-label\": _(\"More options for '%(title)s'\")",
            "                    % {\"title\": str(instance)},",
            "                },",
            "            )",
            "        ]",
            "",
            "    @cached_property",
            "    def add_item_label(self):",
            "        if self.model:",
            "            return capfirst(",
            "                _(\"Add %(model_name)s\") % {\"model_name\": self.model._meta.verbose_name}",
            "            )",
            "        return _(\"Add\")",
            "",
            "    def get_context_data(self, *args, **kwargs):",
            "        context = super().get_context_data(*args, **kwargs)",
            "",
            "        context[\"can_add\"] = (",
            "            self.permission_policy is None",
            "            or self.permission_policy.user_has_permission(self.request.user, \"add\")",
            "        )",
            "        if context[\"can_add\"]:",
            "            context[\"add_url\"] = context[\"header_action_url\"] = self.add_url",
            "            context[\"header_action_label\"] = self.add_item_label",
            "",
            "        context[\"is_searchable\"] = self.is_searchable",
            "        context[\"search_url\"] = self.get_search_url()",
            "        context[\"search_form\"] = self.search_form",
            "        context[\"is_searching\"] = self.is_searching",
            "        context[\"query_string\"] = self.search_query",
            "        context[\"model_opts\"] = self.model and self.model._meta",
            "        return context",
            "",
            "    def render_to_response(self, context, **response_kwargs):",
            "        if self.is_export:",
            "            return self.as_spreadsheet(",
            "                context[\"object_list\"], self.request.GET.get(\"export\")",
            "            )",
            "        return super().render_to_response(context, **response_kwargs)",
            "",
            "",
            "class CreateView(",
            "    LocaleMixin,",
            "    PanelMixin,",
            "    PermissionCheckedMixin,",
            "    BeforeAfterHookMixin,",
            "    WagtailAdminTemplateMixin,",
            "    BaseCreateView,",
            "):",
            "    model = None",
            "    form_class = None",
            "    index_url_name = None",
            "    add_url_name = None",
            "    edit_url_name = None",
            "    template_name = \"wagtailadmin/generic/create.html\"",
            "    page_title = gettext_lazy(\"New\")",
            "    permission_required = \"add\"",
            "    success_message = gettext_lazy(\"%(model_name)s '%(object)s' created.\")",
            "    error_message = gettext_lazy(",
            "        \"The %(model_name)s could not be created due to errors.\"",
            "    )",
            "    submit_button_label = gettext_lazy(\"Create\")",
            "    actions = [\"create\"]",
            "",
            "    def setup(self, request, *args, **kwargs):",
            "        super().setup(request, *args, **kwargs)",
            "        self.action = self.get_action(request)",
            "",
            "    def get_action(self, request):",
            "        for action in self.get_available_actions():",
            "            if request.POST.get(f\"action-{action}\"):",
            "                return action",
            "        return \"create\"",
            "",
            "    def get_available_actions(self):",
            "        return self.actions",
            "",
            "    def get_page_subtitle(self):",
            "        if not self.page_subtitle and self.model:",
            "            return capfirst(self.model._meta.verbose_name)",
            "        return self.page_subtitle",
            "",
            "    def get_breadcrumbs_items(self):",
            "        if not self.model:",
            "            return self.breadcrumbs_items",
            "        items = []",
            "        if self.index_url_name:",
            "            items.append(",
            "                {",
            "                    \"url\": reverse(self.index_url_name),",
            "                    \"label\": capfirst(self.model._meta.verbose_name_plural),",
            "                }",
            "            )",
            "        items.append(",
            "            {",
            "                \"url\": \"\",",
            "                \"label\": _(\"New: %(model_name)s\")",
            "                % {\"model_name\": capfirst(self.model._meta.verbose_name)},",
            "            }",
            "        )",
            "        return self.breadcrumbs_items + items",
            "",
            "    def get_add_url(self):",
            "        if not self.add_url_name:",
            "            raise ImproperlyConfigured(",
            "                \"Subclasses of wagtail.admin.views.generic.models.CreateView must provide an \"",
            "                \"add_url_name attribute or a get_add_url method\"",
            "            )",
            "        return self._set_locale_query_param(reverse(self.add_url_name))",
            "",
            "    @cached_property",
            "    def add_url(self):",
            "        return self.get_add_url()",
            "",
            "    def get_edit_url(self):",
            "        if not self.edit_url_name:",
            "            raise ImproperlyConfigured(",
            "                \"Subclasses of wagtail.admin.views.generic.models.CreateView must provide an \"",
            "                \"edit_url_name attribute or a get_edit_url method\"",
            "            )",
            "        return reverse(self.edit_url_name, args=(quote(self.object.pk),))",
            "",
            "    def get_success_url(self):",
            "        if not self.index_url_name:",
            "            raise ImproperlyConfigured(",
            "                \"Subclasses of wagtail.admin.views.generic.models.CreateView must provide an \"",
            "                \"index_url_name attribute or a get_success_url method\"",
            "            )",
            "        return self._set_locale_query_param(reverse(self.index_url_name))",
            "",
            "    def get_success_message(self, instance):",
            "        if self.success_message is None:",
            "            return None",
            "        return capfirst(",
            "            self.success_message",
            "            % {",
            "                \"object\": instance,",
            "                \"model_name\": self.model and self.model._meta.verbose_name,",
            "            }",
            "        )",
            "",
            "    def get_success_buttons(self):",
            "        return [messages.button(self.get_edit_url(), _(\"Edit\"))]",
            "",
            "    def get_error_message(self):",
            "        if self.error_message is None:",
            "            return None",
            "        return capfirst(",
            "            self.error_message",
            "            % {\"model_name\": self.model and self.model._meta.verbose_name}",
            "        )",
            "",
            "    def get_context_data(self, **kwargs):",
            "        context = super().get_context_data(**kwargs)",
            "        self.form = context.get(\"form\")",
            "        side_panels = self.get_side_panels()",
            "        context[\"action_url\"] = self.add_url",
            "        context[\"submit_button_label\"] = self.submit_button_label",
            "        context[\"side_panels\"] = side_panels",
            "        context[\"media\"] += side_panels.media",
            "        return context",
            "",
            "    def get_side_panels(self):",
            "        side_panels = [",
            "            StatusSidePanel(",
            "                self.form.instance,",
            "                self.request,",
            "                locale=self.locale,",
            "                translations=self.translations,",
            "            )",
            "        ]",
            "        return MediaContainer(side_panels)",
            "",
            "    def get_translations(self):",
            "        return [",
            "            {",
            "                \"locale\": locale,",
            "                \"url\": self._set_locale_query_param(self.add_url, locale),",
            "            }",
            "            for locale in Locale.objects.all().exclude(id=self.locale.id)",
            "        ]",
            "",
            "    def get_initial_form_instance(self):",
            "        if self.locale:",
            "            instance = self.model()",
            "            instance.locale = self.locale",
            "            return instance",
            "",
            "    def get_form_kwargs(self):",
            "        if instance := self.get_initial_form_instance():",
            "            # super().get_form_kwargs() will use self.object as the instance kwarg",
            "            self.object = instance",
            "        kwargs = super().get_form_kwargs()",
            "",
            "        form_class = self.get_form_class()",
            "        # Add for_user support for PermissionedForm",
            "        if issubclass(form_class, WagtailAdminModelForm):",
            "            kwargs[\"for_user\"] = self.request.user",
            "        return kwargs",
            "",
            "    def save_instance(self):",
            "        \"\"\"",
            "        Called after the form is successfully validated - saves the object to the db",
            "        and returns the new object. Override this to implement custom save logic.",
            "        \"\"\"",
            "        instance = self.form.save()",
            "        log(instance=instance, action=\"wagtail.create\", content_changed=True)",
            "        return instance",
            "",
            "    def save_action(self):",
            "        success_message = self.get_success_message(self.object)",
            "        success_buttons = self.get_success_buttons()",
            "        if success_message is not None:",
            "            messages.success(",
            "                self.request,",
            "                success_message,",
            "                buttons=success_buttons,",
            "            )",
            "        return redirect(self.get_success_url())",
            "",
            "    def form_valid(self, form):",
            "        self.form = form",
            "        with transaction.atomic():",
            "            self.object = self.save_instance()",
            "",
            "        response = self.save_action()",
            "",
            "        hook_response = self.run_after_hook()",
            "        if hook_response is not None:",
            "            return hook_response",
            "",
            "        return response",
            "",
            "    def form_invalid(self, form):",
            "        self.form = form",
            "        error_message = self.get_error_message()",
            "        if error_message is not None:",
            "            messages.validation_error(self.request, error_message, form)",
            "        return super().form_invalid(form)",
            "",
            "",
            "class CopyView(CreateView):",
            "    def get_object(self, queryset=None):",
            "        return get_object_or_404(self.model, pk=self.kwargs[\"pk\"])",
            "",
            "    def get_form_kwargs(self):",
            "        return {**super().get_form_kwargs(), \"instance\": self.get_object()}",
            "",
            "",
            "class EditView(",
            "    LocaleMixin,",
            "    PanelMixin,",
            "    PermissionCheckedMixin,",
            "    BeforeAfterHookMixin,",
            "    WagtailAdminTemplateMixin,",
            "    BaseUpdateView,",
            "):",
            "    model = None",
            "    form_class = None",
            "    index_url_name = None",
            "    edit_url_name = None",
            "    delete_url_name = None",
            "    history_url_name = None",
            "    usage_url_name = None",
            "    page_title = gettext_lazy(\"Editing\")",
            "    context_object_name = None",
            "    template_name = \"wagtailadmin/generic/edit.html\"",
            "    permission_required = \"change\"",
            "    delete_item_label = gettext_lazy(\"Delete\")",
            "    success_message = gettext_lazy(\"%(model_name)s '%(object)s' updated.\")",
            "    error_message = gettext_lazy(\"The %(model_name)s could not be saved due to errors.\")",
            "    submit_button_label = gettext_lazy(\"Save\")",
            "    actions = [\"edit\"]",
            "",
            "    def setup(self, request, *args, **kwargs):",
            "        super().setup(request, *args, **kwargs)",
            "        self.action = self.get_action(request)",
            "",
            "    def get_action(self, request):",
            "        for action in self.get_available_actions():",
            "            if request.POST.get(f\"action-{action}\"):",
            "                return action",
            "        return \"edit\"",
            "",
            "    def get_available_actions(self):",
            "        return self.actions",
            "",
            "    def get_object(self, queryset=None):",
            "        if \"pk\" not in self.kwargs:",
            "            self.kwargs[\"pk\"] = self.args[0]",
            "        self.kwargs[\"pk\"] = unquote(str(self.kwargs[\"pk\"]))",
            "        return super().get_object(queryset)",
            "",
            "    def get_page_subtitle(self):",
            "        return str(self.object)",
            "",
            "    def get_breadcrumbs_items(self):",
            "        if not self.model:",
            "            return self.breadcrumbs_items",
            "        items = []",
            "        if self.index_url_name:",
            "            items.append(",
            "                {",
            "                    \"url\": reverse(self.index_url_name),",
            "                    \"label\": capfirst(self.model._meta.verbose_name_plural),",
            "                }",
            "            )",
            "        items.append({\"url\": \"\", \"label\": get_latest_str(self.object)})",
            "        return self.breadcrumbs_items + items",
            "",
            "    def get_side_panels(self):",
            "        side_panels = []",
            "        usage_url = self.get_usage_url()",
            "        history_url = self.get_history_url()",
            "        if usage_url or history_url:",
            "            side_panels.append(",
            "                StatusSidePanel(",
            "                    self.object,",
            "                    self.request,",
            "                    locale=self.locale,",
            "                    translations=self.translations,",
            "                    usage_url=usage_url,",
            "                    history_url=history_url,",
            "                    last_updated_info=self.get_last_updated_info(),",
            "                )",
            "            )",
            "        return MediaContainer(side_panels)",
            "",
            "    def get_last_updated_info(self):",
            "        return log_registry.get_logs_for_instance(self.object).first()",
            "",
            "    def get_edit_url(self):",
            "        if not self.edit_url_name:",
            "            raise ImproperlyConfigured(",
            "                \"Subclasses of wagtail.admin.views.generic.models.EditView must provide an \"",
            "                \"edit_url_name attribute or a get_edit_url method\"",
            "            )",
            "        return reverse(self.edit_url_name, args=(quote(self.object.pk),))",
            "",
            "    def get_delete_url(self):",
            "        if self.delete_url_name:",
            "            return reverse(self.delete_url_name, args=(quote(self.object.pk),))",
            "",
            "    def get_history_url(self):",
            "        if self.history_url_name:",
            "            return reverse(self.history_url_name, args=(quote(self.object.pk),))",
            "",
            "    def get_usage_url(self):",
            "        if self.usage_url_name:",
            "            return reverse(self.usage_url_name, args=[quote(self.object.pk)])",
            "",
            "    def get_success_url(self):",
            "        if not self.index_url_name:",
            "            raise ImproperlyConfigured(",
            "                \"Subclasses of wagtail.admin.views.generic.models.EditView must provide an \"",
            "                \"index_url_name attribute or a get_success_url method\"",
            "            )",
            "        return reverse(self.index_url_name)",
            "",
            "    def get_translations(self):",
            "        if not self.edit_url_name:",
            "            return []",
            "        return [",
            "            {",
            "                \"locale\": translation.locale,",
            "                \"url\": reverse(self.edit_url_name, args=[quote(translation.pk)]),",
            "            }",
            "            for translation in self.object.get_translations().select_related(\"locale\")",
            "        ]",
            "",
            "    def get_form_kwargs(self):",
            "        kwargs = super().get_form_kwargs()",
            "        form_class = self.get_form_class()",
            "        if issubclass(form_class, WagtailAdminModelForm):",
            "            kwargs[\"for_user\"] = self.request.user",
            "        return kwargs",
            "",
            "    def save_instance(self):",
            "        \"\"\"",
            "        Called after the form is successfully validated - saves the object to the db.",
            "        Override this to implement custom save logic.",
            "        \"\"\"",
            "        instance = self.form.save()",
            "",
            "        self.has_content_changes = self.form.has_changed()",
            "",
            "        log(",
            "            instance=instance,",
            "            action=\"wagtail.edit\",",
            "            content_changed=self.has_content_changes,",
            "        )",
            "",
            "        return instance",
            "",
            "    def save_action(self):",
            "        success_message = self.get_success_message()",
            "        success_buttons = self.get_success_buttons()",
            "        if success_message is not None:",
            "            messages.success(",
            "                self.request,",
            "                success_message,",
            "                buttons=success_buttons,",
            "            )",
            "        return redirect(self.get_success_url())",
            "",
            "    def get_success_message(self):",
            "        if self.success_message is None:",
            "            return None",
            "        return capfirst(",
            "            self.success_message",
            "            % {",
            "                \"object\": self.object,",
            "                \"model_name\": self.model and self.model._meta.verbose_name,",
            "            }",
            "        )",
            "",
            "    def get_success_buttons(self):",
            "        return [",
            "            messages.button(",
            "                reverse(self.edit_url_name, args=(quote(self.object.pk),)), _(\"Edit\")",
            "            )",
            "        ]",
            "",
            "    def get_error_message(self):",
            "        if self.error_message is None:",
            "            return None",
            "        return capfirst(",
            "            self.error_message",
            "            % {\"model_name\": self.model and self.model._meta.verbose_name}",
            "        )",
            "",
            "    def form_valid(self, form):",
            "        self.form = form",
            "        with transaction.atomic():",
            "            self.object = self.save_instance()",
            "",
            "        response = self.save_action()",
            "",
            "        hook_response = self.run_after_hook()",
            "        if hook_response is not None:",
            "            return hook_response",
            "",
            "        return response",
            "",
            "    def form_invalid(self, form):",
            "        self.form = form",
            "        error_message = self.get_error_message()",
            "        if error_message is not None:",
            "            messages.validation_error(self.request, error_message, form)",
            "        return super().form_invalid(form)",
            "",
            "    def get_context_data(self, **kwargs):",
            "        context = super().get_context_data(**kwargs)",
            "        self.form = context.get(\"form\")",
            "        side_panels = self.get_side_panels()",
            "        context[\"action_url\"] = self.get_edit_url()",
            "        context[\"history_url\"] = self.get_history_url()",
            "        context[\"side_panels\"] = side_panels",
            "        context[\"media\"] += side_panels.media",
            "        context[\"submit_button_label\"] = self.submit_button_label",
            "        context[\"can_delete\"] = (",
            "            self.permission_policy is None",
            "            or self.permission_policy.user_has_permission(self.request.user, \"delete\")",
            "        )",
            "        if context[\"can_delete\"]:",
            "            context[\"delete_url\"] = self.get_delete_url()",
            "            context[\"delete_item_label\"] = self.delete_item_label",
            "        return context",
            "",
            "",
            "class DeleteView(",
            "    LocaleMixin,",
            "    PanelMixin,",
            "    PermissionCheckedMixin,",
            "    BeforeAfterHookMixin,",
            "    WagtailAdminTemplateMixin,",
            "    BaseDeleteView,",
            "):",
            "    model = None",
            "    index_url_name = None",
            "    edit_url_name = None",
            "    delete_url_name = None",
            "    usage_url_name = None",
            "    template_name = \"wagtailadmin/generic/confirm_delete.html\"",
            "    context_object_name = None",
            "    permission_required = \"delete\"",
            "    page_title = gettext_lazy(\"Delete\")",
            "    success_message = gettext_lazy(\"%(model_name)s '%(object)s' deleted.\")",
            "",
            "    def setup(self, request, *args, **kwargs):",
            "        super().setup(request, *args, **kwargs)",
            "        self.object = self.get_object()",
            "        # Get this here instead of the template so that we do not iterate through",
            "        # the usage and potentially trigger a database query for each item",
            "        self.usage_url = self.get_usage_url()",
            "        self.usage = self.get_usage()",
            "",
            "    def get_object(self, queryset=None):",
            "        # If the object has already been loaded, return it to avoid another query",
            "        if getattr(self, \"object\", None):",
            "            return self.object",
            "        if self.pk_url_kwarg not in self.kwargs:",
            "            self.kwargs[self.pk_url_kwarg] = self.args[0]",
            "        self.kwargs[self.pk_url_kwarg] = unquote(str(self.kwargs[self.pk_url_kwarg]))",
            "        return super().get_object(queryset)",
            "",
            "    def get_usage(self):",
            "        if not self.usage_url:",
            "            return None",
            "        return ReferenceIndex.get_grouped_references_to(self.object)",
            "",
            "    def get_success_url(self):",
            "        next_url = get_valid_next_url_from_request(self.request)",
            "        if next_url:",
            "            return next_url",
            "        if not self.index_url_name:",
            "            raise ImproperlyConfigured(",
            "                \"Subclasses of wagtail.admin.views.generic.models.DeleteView must provide an \"",
            "                \"index_url_name attribute or a get_success_url method\"",
            "            )",
            "        return reverse(self.index_url_name)",
            "",
            "    def get_page_subtitle(self):",
            "        return str(self.object)",
            "",
            "    def get_breadcrumbs_items(self):",
            "        return []",
            "",
            "    def get_delete_url(self):",
            "        if not self.delete_url_name:",
            "            raise ImproperlyConfigured(",
            "                \"Subclasses of wagtail.admin.views.generic.models.DeleteView must provide a \"",
            "                \"delete_url_name attribute or a get_delete_url method\"",
            "            )",
            "        return reverse(self.delete_url_name, args=(quote(self.object.pk),))",
            "",
            "    def get_usage_url(self):",
            "        # Usage URL is optional, allow it to be unset",
            "        if self.usage_url_name:",
            "            return (",
            "                reverse(self.usage_url_name, args=(quote(self.object.pk),))",
            "                + \"?describe_on_delete=1\"",
            "            )",
            "",
            "    @property",
            "    def confirmation_message(self):",
            "        return _(\"Are you sure you want to delete this %(model_name)s?\") % {",
            "            \"model_name\": self.object._meta.verbose_name",
            "        }",
            "",
            "    def get_success_message(self):",
            "        if self.success_message is None:",
            "            return None",
            "        return capfirst(",
            "            self.success_message",
            "            % {",
            "                \"model_name\": capfirst(self.object._meta.verbose_name),",
            "                \"object\": self.object,",
            "            }",
            "        )",
            "",
            "    def delete_action(self):",
            "        with transaction.atomic():",
            "            log(instance=self.object, action=\"wagtail.delete\")",
            "            self.object.delete()",
            "",
            "    def form_valid(self, form):",
            "        if self.usage and self.usage.is_protected:",
            "            raise PermissionDenied",
            "        success_url = self.get_success_url()",
            "        self.delete_action()",
            "        messages.success(self.request, self.get_success_message())",
            "        hook_response = self.run_after_hook()",
            "        if hook_response is not None:",
            "            return hook_response",
            "        return HttpResponseRedirect(success_url)",
            "",
            "    def get_context_data(self, **kwargs):",
            "        context = super().get_context_data(**kwargs)",
            "        context[\"model_opts\"] = self.object._meta",
            "        context[\"next\"] = self.get_success_url()",
            "        if self.usage_url:",
            "            context[\"usage_url\"] = self.usage_url",
            "            context[\"usage_count\"] = self.usage.count()",
            "            context[\"is_protected\"] = self.usage.is_protected",
            "        return context",
            "",
            "",
            "class InspectView(PermissionCheckedMixin, WagtailAdminTemplateMixin, TemplateView):",
            "    any_permission_required = [\"add\", \"change\", \"delete\"]",
            "    template_name = \"wagtailadmin/generic/inspect.html\"",
            "    page_title = gettext_lazy(\"Inspecting\")",
            "    model = None",
            "    index_url_name = None",
            "    edit_url_name = None",
            "    delete_url_name = None",
            "    fields = []",
            "    fields_exclude = []",
            "    pk_url_kwarg = \"pk\"",
            "",
            "    def setup(self, request, *args, **kwargs):",
            "        super().setup(request, *args, **kwargs)",
            "        self.pk = self.kwargs[self.pk_url_kwarg]",
            "        self.fields = self.get_fields()",
            "        self.object = self.get_object()",
            "",
            "    def get_object(self, queryset=None):",
            "        return get_object_or_404(self.model, pk=unquote(str(self.pk)))",
            "",
            "    def get_page_subtitle(self):",
            "        return get_latest_str(self.object)",
            "",
            "    def get_breadcrumbs_items(self):",
            "        items = []",
            "        if self.index_url_name:",
            "            items.append(",
            "                {",
            "                    \"url\": reverse(self.index_url_name),",
            "                    \"label\": capfirst(self.model._meta.verbose_name_plural),",
            "                }",
            "            )",
            "        edit_url = self.get_edit_url()",
            "        object_str = self.get_page_subtitle()",
            "        if edit_url:",
            "            items.append({\"url\": edit_url, \"label\": object_str})",
            "        items.append(",
            "            {",
            "                \"url\": \"\",",
            "                \"label\": _(\"Inspect\"),",
            "                \"sublabel\": object_str,",
            "            }",
            "        )",
            "        return self.breadcrumbs_items + items",
            "",
            "    def get_fields(self):",
            "        fields = self.fields or [",
            "            f.name",
            "            for f in self.model._meta.get_fields()",
            "            if f.concrete",
            "            and (not f.is_relation or (not f.auto_created and f.related_model))",
            "        ]",
            "",
            "        fields = [f for f in fields if f not in self.fields_exclude]",
            "        return fields",
            "",
            "    def get_field_label(self, field_name, field):",
            "        return capfirst(label_for_field(field_name, model=self.model))",
            "",
            "    def get_field_display_value(self, field_name, field):",
            "        # First we check for a 'get_fieldname_display' property/method on",
            "        # the model, and return the value of that, if present.",
            "        value_func = getattr(self.object, \"get_%s_display\" % field_name, None)",
            "        if value_func is not None:",
            "            if callable(value_func):",
            "                return value_func()",
            "            return value_func",
            "",
            "        # Now let's get the attribute value from the instance itself and see if",
            "        # we can render something useful. Raises AttributeError appropriately.",
            "        value = getattr(self.object, field_name)",
            "",
            "        if isinstance(value, models.Manager):",
            "            value = value.all()",
            "",
            "        if isinstance(value, models.QuerySet):",
            "            return \", \".join(str(obj) for obj in value) or \"-\"",
            "",
            "        display_class = display_class_registry.get(field)",
            "",
            "        if display_class:",
            "            return display_class(value)",
            "",
            "        return value",
            "",
            "    def get_context_for_field(self, field_name):",
            "        try:",
            "            field = self.model._meta.get_field(field_name)",
            "        except FieldDoesNotExist:",
            "            field = None",
            "        context = {",
            "            \"label\": self.get_field_label(field_name, field),",
            "            \"value\": self.get_field_display_value(field_name, field),",
            "            \"component\": None,",
            "        }",
            "        if isinstance(context[\"value\"], Component):",
            "            context[\"component\"] = context[\"value\"]",
            "        return context",
            "",
            "    def get_fields_context(self):",
            "        return [self.get_context_for_field(field_name) for field_name in self.fields]",
            "",
            "    def get_edit_url(self):",
            "        if not self.edit_url_name or (",
            "            self.permission_policy",
            "            and not self.permission_policy.user_has_permission(",
            "                self.request.user, \"change\"",
            "            )",
            "        ):",
            "            return None",
            "        return reverse(self.edit_url_name, args=(quote(self.object.pk),))",
            "",
            "    def get_delete_url(self):",
            "        if not self.delete_url_name or (",
            "            self.permission_policy",
            "            and not self.permission_policy.user_has_permission(",
            "                self.request.user, \"delete\"",
            "            )",
            "        ):",
            "            return None",
            "        return reverse(self.delete_url_name, args=(quote(self.object.pk),))",
            "",
            "    def get_context_data(self, **kwargs):",
            "        context = super().get_context_data(**kwargs)",
            "        context[\"object\"] = self.object",
            "        context[\"fields\"] = self.get_fields_context()",
            "        context[\"edit_url\"] = self.get_edit_url()",
            "        context[\"delete_url\"] = self.get_delete_url()",
            "        return context",
            "",
            "",
            "class RevisionsCompareView(WagtailAdminTemplateMixin, TemplateView):",
            "    edit_handler = None",
            "    edit_url_name = None",
            "    history_url_name = None",
            "    edit_label = gettext_lazy(\"Edit\")",
            "    history_label = gettext_lazy(\"History\")",
            "    template_name = \"wagtailadmin/generic/revisions/compare.html\"",
            "    model = None",
            "",
            "    def setup(self, request, pk, revision_id_a, revision_id_b, *args, **kwargs):",
            "        super().setup(request, *args, **kwargs)",
            "        self.pk = pk",
            "        self.revision_id_a = revision_id_a",
            "        self.revision_id_b = revision_id_b",
            "        self.object = self.get_object()",
            "",
            "    def get_object(self, queryset=None):",
            "        return get_object_or_404(self.model, pk=unquote(str(self.pk)))",
            "",
            "    def get_edit_handler(self):",
            "        if self.edit_handler:",
            "            return self.edit_handler",
            "        return get_edit_handler(self.model)",
            "",
            "    def get_page_subtitle(self):",
            "        return str(self.object)",
            "",
            "    def get_history_url(self):",
            "        if self.history_url_name:",
            "            return reverse(self.history_url_name, args=(quote(self.object.pk),))",
            "",
            "    def get_edit_url(self):",
            "        if self.edit_url_name:",
            "            return reverse(self.edit_url_name, args=(quote(self.object.pk),))",
            "",
            "    def _get_revision_and_heading(self, revision_id):",
            "        if revision_id == \"live\":",
            "            revision = self.object",
            "            revision_heading = _(\"Live\")",
            "            return revision, revision_heading",
            "",
            "        if revision_id == \"earliest\":",
            "            revision = self.object.revisions.order_by(\"created_at\", \"id\").first()",
            "            revision_heading = _(\"Earliest\")",
            "        elif revision_id == \"latest\":",
            "            revision = self.object.revisions.order_by(\"created_at\", \"id\").last()",
            "            revision_heading = _(\"Latest\")",
            "        else:",
            "            revision = get_object_or_404(self.object.revisions, id=revision_id)",
            "            if revision:",
            "                revision_heading = str(revision.created_at)",
            "",
            "        if not revision:",
            "            raise Http404",
            "",
            "        revision = revision.as_object()",
            "",
            "        return revision, revision_heading",
            "",
            "    def _get_comparison(self, revision_a, revision_b):",
            "        comparison = (",
            "            self.get_edit_handler()",
            "            .get_bound_panel(instance=self.object, request=self.request, form=None)",
            "            .get_comparison()",
            "        )",
            "",
            "        result = []",
            "        for comp in comparison:",
            "            diff = comp(revision_a, revision_b)",
            "            if diff.has_changed():",
            "                result += [diff]",
            "",
            "        return result",
            "",
            "    def get_context_data(self, **kwargs):",
            "        context = super().get_context_data(**kwargs)",
            "",
            "        revision_a, revision_a_heading = self._get_revision_and_heading(",
            "            self.revision_id_a",
            "        )",
            "        revision_b, revision_b_heading = self._get_revision_and_heading(",
            "            self.revision_id_b",
            "        )",
            "        comparison = self._get_comparison(revision_a, revision_b)",
            "",
            "        context.update(",
            "            {",
            "                \"object\": self.object,",
            "                \"history_label\": self.history_label,",
            "                \"edit_label\": self.edit_label,",
            "                \"history_url\": self.get_history_url(),",
            "                \"edit_url\": self.get_edit_url(),",
            "                \"revision_a\": revision_a,",
            "                \"revision_a_heading\": revision_a_heading,",
            "                \"revision_b\": revision_b,",
            "                \"revision_b_heading\": revision_b_heading,",
            "                \"comparison\": comparison,",
            "            }",
            "        )",
            "",
            "        return context",
            "",
            "",
            "class UnpublishView(HookResponseMixin, WagtailAdminTemplateMixin, TemplateView):",
            "    model = None",
            "    index_url_name = None",
            "    edit_url_name = None",
            "    unpublish_url_name = None",
            "    usage_url_name = None",
            "    success_message = gettext_lazy(\"'%(object)s' unpublished.\")",
            "    template_name = \"wagtailadmin/generic/confirm_unpublish.html\"",
            "",
            "    def setup(self, request, pk, *args, **kwargs):",
            "        super().setup(request, *args, **kwargs)",
            "        self.pk = pk",
            "        self.object = self.get_object()",
            "",
            "    def dispatch(self, request, *args, **kwargs):",
            "        self.objects_to_unpublish = self.get_objects_to_unpublish()",
            "        return super().dispatch(request, *args, **kwargs)",
            "",
            "    def get_object(self, queryset=None):",
            "        if not self.model or not issubclass(self.model, DraftStateMixin):",
            "            raise Http404",
            "        return get_object_or_404(self.model, pk=unquote(str(self.pk)))",
            "",
            "    def get_usage(self):",
            "        return ReferenceIndex.get_grouped_references_to(self.object)",
            "",
            "    def get_objects_to_unpublish(self):",
            "        # Hook to allow child classes to have more objects to unpublish (e.g. page descendants)",
            "        return [self.object]",
            "",
            "    def get_object_display_title(self):",
            "        return str(self.object)",
            "",
            "    def get_success_message(self):",
            "        if self.success_message is None:",
            "            return None",
            "        return self.success_message % {\"object\": str(self.object)}",
            "",
            "    def get_success_buttons(self):",
            "        if self.edit_url_name:",
            "            return [",
            "                messages.button(",
            "                    reverse(self.edit_url_name, args=(quote(self.object.pk),)),",
            "                    _(\"Edit\"),",
            "                )",
            "            ]",
            "",
            "    def get_next_url(self):",
            "        if not self.index_url_name:",
            "            raise ImproperlyConfigured(",
            "                \"Subclasses of wagtail.admin.views.generic.models.UnpublishView \"",
            "                \"must provide an index_url_name attribute or a get_next_url method\"",
            "            )",
            "        return reverse(self.index_url_name)",
            "",
            "    def get_unpublish_url(self):",
            "        if not self.unpublish_url_name:",
            "            raise ImproperlyConfigured(",
            "                \"Subclasses of wagtail.admin.views.generic.models.UnpublishView \"",
            "                \"must provide an unpublish_url_name attribute or a get_unpublish_url method\"",
            "            )",
            "        return reverse(self.unpublish_url_name, args=(quote(self.object.pk),))",
            "",
            "    def get_usage_url(self):",
            "        # Usage URL is optional, allow it to be unset",
            "        if self.usage_url_name:",
            "            return reverse(self.usage_url_name, args=(quote(self.object.pk),))",
            "",
            "    def unpublish(self):",
            "        hook_response = self.run_hook(\"before_unpublish\", self.request, self.object)",
            "        if hook_response is not None:",
            "            return hook_response",
            "",
            "        for object in self.objects_to_unpublish:",
            "            action = UnpublishAction(object, user=self.request.user)",
            "            action.execute(skip_permission_checks=True)",
            "",
            "        hook_response = self.run_hook(\"after_unpublish\", self.request, self.object)",
            "        if hook_response is not None:",
            "            return hook_response",
            "",
            "    def post(self, request, *args, **kwargs):",
            "        hook_response = self.unpublish()",
            "        if hook_response:",
            "            return hook_response",
            "",
            "        success_message = self.get_success_message()",
            "        success_buttons = self.get_success_buttons()",
            "        if success_message is not None:",
            "            messages.success(request, success_message, buttons=success_buttons)",
            "",
            "        return redirect(self.get_next_url())",
            "",
            "    def get_context_data(self, **kwargs):",
            "        context = super().get_context_data(**kwargs)",
            "        context[\"model_opts\"] = self.object._meta",
            "        context[\"object\"] = self.object",
            "        context[\"object_display_title\"] = self.get_object_display_title()",
            "        context[\"unpublish_url\"] = self.get_unpublish_url()",
            "        context[\"next_url\"] = self.get_next_url()",
            "        context[\"usage_url\"] = self.get_usage_url()",
            "        if context[\"usage_url\"]:",
            "            usage = self.get_usage()",
            "            context[\"usage_count\"] = usage.count()",
            "        return context",
            "",
            "",
            "class RevisionsUnscheduleView(WagtailAdminTemplateMixin, TemplateView):",
            "    model = None",
            "    edit_url_name = None",
            "    history_url_name = None",
            "    revisions_unschedule_url_name = None",
            "    success_message = gettext_lazy(",
            "        'Version %(revision_id)s of \"%(object)s\" unscheduled.'",
            "    )",
            "    template_name = \"wagtailadmin/shared/revisions/confirm_unschedule.html\"",
            "",
            "    def setup(self, request, pk, revision_id, *args, **kwargs):",
            "        super().setup(request, *args, **kwargs)",
            "        self.pk = pk",
            "        self.revision_id = revision_id",
            "        self.object = self.get_object()",
            "        self.revision = self.get_revision()",
            "",
            "    def get_object(self, queryset=None):",
            "        if not self.model or not issubclass(self.model, DraftStateMixin):",
            "            raise Http404",
            "        return get_object_or_404(self.model, pk=unquote(str(self.pk)))",
            "",
            "    def get_revision(self):",
            "        return get_object_or_404(self.object.revisions, id=self.revision_id)",
            "",
            "    def get_revisions_unschedule_url(self):",
            "        return reverse(",
            "            self.revisions_unschedule_url_name,",
            "            args=(quote(self.object.pk), self.revision.id),",
            "        )",
            "",
            "    def get_object_display_title(self):",
            "        return str(self.object)",
            "",
            "    def get_success_message(self):",
            "        if self.success_message is None:",
            "            return None",
            "        return self.success_message % {",
            "            \"revision_id\": self.revision.id,",
            "            \"object\": self.get_object_display_title(),",
            "        }",
            "",
            "    def get_success_buttons(self):",
            "        return [",
            "            messages.button(",
            "                reverse(self.edit_url_name, args=(quote(self.object.pk),)), _(\"Edit\")",
            "            )",
            "        ]",
            "",
            "    def get_next_url(self):",
            "        next_url = get_valid_next_url_from_request(self.request)",
            "        if next_url:",
            "            return next_url",
            "",
            "        if not self.history_url_name:",
            "            raise ImproperlyConfigured(",
            "                \"Subclasses of wagtail.admin.views.generic.models.RevisionsUnscheduleView \"",
            "                \" must provide a history_url_name attribute or a get_next_url method\"",
            "            )",
            "        return reverse(self.history_url_name, args=(quote(self.object.pk),))",
            "",
            "    def get_page_subtitle(self):",
            "        return _('revision %(revision_id)s of \"%(object)s\"') % {",
            "            \"revision_id\": self.revision.id,",
            "            \"object\": self.get_object_display_title(),",
            "        }",
            "",
            "    def get_context_data(self, **kwargs):",
            "        context = super().get_context_data(**kwargs)",
            "        context.update(",
            "            {",
            "                \"object\": self.object,",
            "                \"revision\": self.revision,",
            "                \"subtitle\": self.get_page_subtitle(),",
            "                \"object_display_title\": self.get_object_display_title(),",
            "                \"revisions_unschedule_url\": self.get_revisions_unschedule_url(),",
            "                \"next_url\": self.get_next_url(),",
            "            }",
            "        )",
            "        return context",
            "",
            "    def post(self, request, *args, **kwargs):",
            "        self.revision.approved_go_live_at = None",
            "        self.revision.save(user=request.user, update_fields=[\"approved_go_live_at\"])",
            "",
            "        success_message = self.get_success_message()",
            "        success_buttons = self.get_success_buttons()",
            "        if success_message:",
            "            messages.success(",
            "                request,",
            "                success_message,",
            "                buttons=success_buttons,",
            "            )",
            "",
            "        return redirect(self.get_next_url())"
        ],
        "afterPatchFile": [
            "import warnings",
            "",
            "from django.contrib.admin.utils import label_for_field, quote, unquote",
            "from django.contrib.contenttypes.models import ContentType",
            "from django.core.exceptions import (",
            "    FieldDoesNotExist,",
            "    ImproperlyConfigured,",
            "    PermissionDenied,",
            ")",
            "from django.db import models, transaction",
            "from django.db.models import Q",
            "from django.db.models.functions import Cast",
            "from django.http import Http404, HttpResponseRedirect",
            "from django.shortcuts import get_object_or_404, redirect",
            "from django.urls import reverse",
            "from django.utils.functional import cached_property",
            "from django.utils.text import capfirst",
            "from django.utils.translation import gettext as _",
            "from django.utils.translation import gettext_lazy",
            "from django.views.generic import TemplateView",
            "from django.views.generic.edit import (",
            "    BaseCreateView,",
            "    BaseDeleteView,",
            "    BaseUpdateView,",
            ")",
            "",
            "from wagtail.actions.unpublish import UnpublishAction",
            "from wagtail.admin import messages",
            "from wagtail.admin.filters import WagtailFilterSet",
            "from wagtail.admin.forms.search import SearchForm",
            "from wagtail.admin.panels import get_edit_handler",
            "from wagtail.admin.ui.components import Component, MediaContainer",
            "from wagtail.admin.ui.fields import display_class_registry",
            "from wagtail.admin.ui.side_panels import StatusSidePanel",
            "from wagtail.admin.ui.tables import (",
            "    ButtonsColumnMixin,",
            "    Column,",
            "    TitleColumn,",
            "    UpdatedAtColumn,",
            ")",
            "from wagtail.admin.utils import get_latest_str, get_valid_next_url_from_request",
            "from wagtail.admin.views.mixins import SpreadsheetExportMixin",
            "from wagtail.admin.widgets.button import (",
            "    Button,",
            "    ButtonWithDropdown,",
            "    HeaderButton,",
            "    ListingButton,",
            ")",
            "from wagtail.log_actions import log",
            "from wagtail.log_actions import registry as log_registry",
            "from wagtail.models import DraftStateMixin, Locale, ReferenceIndex",
            "from wagtail.models.audit_log import ModelLogEntry",
            "from wagtail.search.backends import get_search_backend",
            "from wagtail.search.index import class_is_indexed",
            "",
            "from .base import BaseListingView, WagtailAdminTemplateMixin",
            "from .mixins import BeforeAfterHookMixin, HookResponseMixin, LocaleMixin, PanelMixin",
            "from .permissions import PermissionCheckedMixin",
            "",
            "",
            "class IndexView(",
            "    SpreadsheetExportMixin,",
            "    LocaleMixin,",
            "    PermissionCheckedMixin,",
            "    BaseListingView,",
            "):",
            "    model = None",
            "    template_name = \"wagtailadmin/generic/index.html\"",
            "    results_template_name = \"wagtailadmin/generic/index_results.html\"",
            "    add_url_name = None",
            "    edit_url_name = None",
            "    copy_url_name = None",
            "    inspect_url_name = None",
            "    delete_url_name = None",
            "    any_permission_required = [\"add\", \"change\", \"delete\"]",
            "    search_fields = None",
            "    search_backend_name = \"default\"",
            "    is_searchable = None",
            "    search_kwarg = \"q\"",
            "    columns = None  # If not explicitly specified, will be derived from list_display",
            "    list_display = [\"__str__\", UpdatedAtColumn()]",
            "    list_filter = None",
            "    show_other_searches = False",
            "",
            "    def setup(self, request, *args, **kwargs):",
            "        super().setup(request, *args, **kwargs)",
            "",
            "        if not self.filterset_class:",
            "            # Allow filterset_class to be dynamically constructed from list_filter",
            "            self.filterset_class = self.get_filterset_class()",
            "",
            "        self.setup_search()",
            "",
            "    def setup_search(self):",
            "        self.is_searchable = self.get_is_searchable()",
            "        self.search_url = self.get_search_url()",
            "        self.search_form = self.get_search_form()",
            "        self.is_searching = False",
            "        self.search_query = None",
            "",
            "        if self.search_form and self.search_form.is_valid():",
            "            self.search_query = self.search_form.cleaned_data[self.search_kwarg]",
            "            self.is_searching = bool(self.search_query)",
            "",
            "    def get_is_searchable(self):",
            "        if self.model is None:",
            "            return False",
            "        if self.is_searchable is None:",
            "            return class_is_indexed(self.model) or self.search_fields",
            "        return self.is_searchable",
            "",
            "    def get_search_url(self):",
            "        if not self.is_searchable:",
            "            return None",
            "        return self.index_url_name",
            "",
            "    def get_search_form(self):",
            "        if self.model is None or not self.is_searchable:",
            "            return None",
            "",
            "        if self.is_searchable and self.search_kwarg in self.request.GET:",
            "            return SearchForm(self.request.GET)",
            "",
            "        return SearchForm()",
            "",
            "    def get_filterset_class(self):",
            "        # Allow filterset_class to be dynamically constructed from list_filter.",
            "",
            "        # If the model is translatable, ensure a ``WagtailFilterSet`` subclass",
            "        # is returned anyway (even if list_filter is undefined), so the locale",
            "        # filter is always included.",
            "        if not self.model or (not self.list_filter and not self.locale):",
            "            return None",
            "",
            "        class Meta:",
            "            model = self.model",
            "            fields = self.list_filter or []",
            "",
            "        return type(",
            "            f\"{self.model.__name__}FilterSet\",",
            "            (WagtailFilterSet,),",
            "            {\"Meta\": Meta},",
            "        )",
            "",
            "    def _annotate_queryset_updated_at(self, queryset):",
            "        # Annotate the objects' updated_at, use _ prefix to avoid name collision",
            "        # with an existing database field.",
            "        # By default, use the latest log entry's timestamp, but subclasses may",
            "        # override this to e.g. use the latest revision's timestamp instead.",
            "",
            "        log_model = log_registry.get_log_model_for_model(queryset.model)",
            "",
            "        # If the log model is not a subclass of ModelLogEntry, we don't know how",
            "        # to query the logs for the object, so skip the annotation.",
            "        if not log_model or not issubclass(log_model, ModelLogEntry):",
            "            return queryset",
            "",
            "        latest_log = (",
            "            log_model.objects.filter(",
            "                content_type=ContentType.objects.get_for_model(",
            "                    queryset.model, for_concrete_model=False",
            "                ),",
            "                object_id=Cast(models.OuterRef(\"pk\"), models.CharField()),",
            "            )",
            "            .order_by(\"-timestamp\", \"-pk\")",
            "            .values(\"timestamp\")[:1]",
            "        )",
            "        return queryset.annotate(_updated_at=models.Subquery(latest_log))",
            "",
            "    def order_queryset(self, queryset):",
            "        has_updated_at_column = any(",
            "            getattr(column, \"accessor\", None) == \"_updated_at\"",
            "            for column in self.columns",
            "        )",
            "        if has_updated_at_column:",
            "            queryset = self._annotate_queryset_updated_at(queryset)",
            "",
            "        # Explicitly handle null values for the updated at column to ensure consistency",
            "        # across database backends and match the behaviour in page explorer",
            "        if self.ordering == \"_updated_at\":",
            "            return queryset.order_by(models.F(\"_updated_at\").asc(nulls_first=True))",
            "        elif self.ordering == \"-_updated_at\":",
            "            return queryset.order_by(models.F(\"_updated_at\").desc(nulls_last=True))",
            "        else:",
            "            queryset = super().order_queryset(queryset)",
            "",
            "            # Preserve the model-level ordering if specified, but fall back on",
            "            # updated_at and PK if not (to ensure pagination is consistent)",
            "            if not queryset.ordered:",
            "                if has_updated_at_column:",
            "                    queryset = queryset.order_by(",
            "                        models.F(\"_updated_at\").desc(nulls_last=True), \"-pk\"",
            "                    )",
            "                else:",
            "                    queryset = queryset.order_by(\"-pk\")",
            "",
            "            return queryset",
            "",
            "    def get_queryset(self):",
            "        queryset = super().get_queryset()",
            "        queryset = self.search_queryset(queryset)",
            "        return queryset",
            "",
            "    def search_queryset(self, queryset):",
            "        if not self.is_searching:",
            "            return queryset",
            "",
            "        if class_is_indexed(queryset.model) and self.search_backend_name:",
            "            search_backend = get_search_backend(self.search_backend_name)",
            "            if queryset.model.get_autocomplete_search_fields():",
            "                return search_backend.autocomplete(",
            "                    self.search_query,",
            "                    queryset,",
            "                    fields=self.search_fields,",
            "                    order_by_relevance=(not self.is_explicitly_ordered),",
            "                )",
            "            else:",
            "                # fall back on non-autocompleting search",
            "                warnings.warn(",
            "                    f\"{queryset.model} is defined as Indexable but does not specify \"",
            "                    \"any AutocompleteFields. Searches within the admin will only \"",
            "                    \"respond to complete words.\",",
            "                    category=RuntimeWarning,",
            "                )",
            "                return search_backend.search(",
            "                    self.search_query,",
            "                    queryset,",
            "                    fields=self.search_fields,",
            "                    order_by_relevance=(not self.is_explicitly_ordered),",
            "                )",
            "        query = Q()",
            "        for field in self.search_fields or []:",
            "            query |= Q(**{field + \"__icontains\": self.search_query})",
            "        return queryset.filter(query)",
            "",
            "    def _get_title_column(self, field_name, column_class=TitleColumn, **kwargs):",
            "        if not issubclass(column_class, ButtonsColumnMixin):",
            "",
            "            def get_buttons(column, instance, *args, **kwargs):",
            "                return self.get_list_buttons(instance)",
            "",
            "            column_class = type(",
            "                column_class.__name__,",
            "                (ButtonsColumnMixin, column_class),",
            "                {\"get_buttons\": get_buttons},",
            "            )",
            "        if not self.model:",
            "            return column_class(",
            "                \"name\",",
            "                label=gettext_lazy(\"Name\"),",
            "                accessor=str,",
            "                get_url=self.get_edit_url,",
            "            )",
            "        return self._get_custom_column(",
            "            field_name, column_class, get_url=self.get_edit_url, **kwargs",
            "        )",
            "",
            "    def _get_custom_column(self, field_name, column_class=Column, **kwargs):",
            "        label, attr = label_for_field(field_name, self.model, return_attr=True)",
            "        sort_key = getattr(attr, \"admin_order_field\", None)",
            "",
            "        # attr is None if the field is an actual database field,",
            "        # so it's possible to sort by it",
            "        if attr is None:",
            "            sort_key = field_name",
            "",
            "        return column_class(",
            "            field_name,",
            "            label=capfirst(label),",
            "            sort_key=sort_key,",
            "            **kwargs,",
            "        )",
            "",
            "    @cached_property",
            "    def columns(self):",
            "        columns = []",
            "        for i, field in enumerate(self.list_display):",
            "            if isinstance(field, Column):",
            "                column = field",
            "            elif i == 0:",
            "                column = self._get_title_column(field)",
            "            else:",
            "                column = self._get_custom_column(field)",
            "            columns.append(column)",
            "",
            "        return columns",
            "",
            "    def get_edit_url(self, instance):",
            "        if self.edit_url_name:",
            "            return reverse(self.edit_url_name, args=(quote(instance.pk),))",
            "",
            "    def get_copy_url(self, instance):",
            "        if self.copy_url_name:",
            "            return reverse(self.copy_url_name, args=(quote(instance.pk),))",
            "",
            "    def get_inspect_url(self, instance):",
            "        if self.inspect_url_name:",
            "            return reverse(self.inspect_url_name, args=(quote(instance.pk),))",
            "",
            "    def get_delete_url(self, instance):",
            "        if self.delete_url_name:",
            "            return reverse(self.delete_url_name, args=(quote(instance.pk),))",
            "",
            "    def get_add_url(self):",
            "        if self.permission_policy and not self.permission_policy.user_has_permission(",
            "            self.request.user, \"add\"",
            "        ):",
            "            return None",
            "        if self.add_url_name:",
            "            return self._set_locale_query_param(reverse(self.add_url_name))",
            "",
            "    @cached_property",
            "    def add_url(self):",
            "        return self.get_add_url()",
            "",
            "    def get_page_title(self):",
            "        if not self.page_title and self.model:",
            "            return capfirst(self.model._meta.verbose_name_plural)",
            "        return self.page_title",
            "",
            "    def get_breadcrumbs_items(self):",
            "        if not self.model:",
            "            return self.breadcrumbs_items",
            "        return self.breadcrumbs_items + [",
            "            {\"url\": \"\", \"label\": capfirst(self.model._meta.verbose_name_plural)},",
            "        ]",
            "",
            "    @cached_property",
            "    def header_buttons(self):",
            "        buttons = []",
            "        if self.add_url:",
            "            buttons.append(",
            "                HeaderButton(",
            "                    self.add_item_label,",
            "                    url=self.add_url,",
            "                    icon_name=\"plus\",",
            "                )",
            "            )",
            "        return buttons",
            "",
            "    @cached_property",
            "    def header_more_buttons(self):",
            "        buttons = []",
            "        if self.list_export:",
            "            buttons.append(",
            "                Button(",
            "                    _(\"Download XLSX\"),",
            "                    url=self.xlsx_export_url,",
            "                    icon_name=\"download\",",
            "                    priority=90,",
            "                )",
            "            )",
            "            buttons.append(",
            "                Button(",
            "                    _(\"Download CSV\"),",
            "                    url=self.csv_export_url,",
            "                    icon_name=\"download\",",
            "                    priority=100,",
            "                )",
            "            )",
            "",
            "        return buttons",
            "",
            "    def get_list_more_buttons(self, instance):",
            "        buttons = []",
            "        edit_url = self.get_edit_url(instance)",
            "        can_edit = (",
            "            not self.permission_policy",
            "            or self.permission_policy.user_has_permission(self.request.user, \"change\")",
            "        )",
            "        if edit_url and can_edit:",
            "            buttons.append(",
            "                ListingButton(",
            "                    _(\"Edit\"),",
            "                    url=self.get_edit_url(instance),",
            "                    icon_name=\"edit\",",
            "                    attrs={",
            "                        \"aria-label\": _(\"Edit '%(title)s'\") % {\"title\": str(instance)}",
            "                    },",
            "                    priority=10,",
            "                )",
            "            )",
            "        copy_url = self.get_copy_url(instance)",
            "        can_copy = self.permission_policy.user_has_permission(self.request.user, \"add\")",
            "        if copy_url and can_copy:",
            "            buttons.append(",
            "                ListingButton(",
            "                    _(\"Copy\"),",
            "                    url=copy_url,",
            "                    icon_name=\"copy\",",
            "                    attrs={",
            "                        \"aria-label\": _(\"Copy '%(title)s'\") % {\"title\": str(instance)}",
            "                    },",
            "                    priority=20,",
            "                )",
            "            )",
            "        inspect_url = self.get_inspect_url(instance)",
            "        if inspect_url:",
            "            buttons.append(",
            "                ListingButton(",
            "                    _(\"Inspect\"),",
            "                    url=inspect_url,",
            "                    icon_name=\"info-circle\",",
            "                    attrs={",
            "                        \"aria-label\": _(\"Inspect '%(title)s'\")",
            "                        % {\"title\": str(instance)}",
            "                    },",
            "                    priority=20,",
            "                )",
            "            )",
            "        delete_url = self.get_delete_url(instance)",
            "        can_delete = (",
            "            not self.permission_policy",
            "            or self.permission_policy.user_has_permission(self.request.user, \"delete\")",
            "        )",
            "        if delete_url and can_delete:",
            "            buttons.append(",
            "                ListingButton(",
            "                    _(\"Delete\"),",
            "                    url=delete_url,",
            "                    icon_name=\"bin\",",
            "                    attrs={",
            "                        \"aria-label\": _(\"Delete '%(title)s'\") % {\"title\": str(instance)}",
            "                    },",
            "                    priority=30,",
            "                )",
            "            )",
            "        return buttons",
            "",
            "    def get_list_buttons(self, instance):",
            "        buttons = self.get_list_more_buttons(instance)",
            "        return [",
            "            ButtonWithDropdown(",
            "                buttons=buttons,",
            "                icon_name=\"dots-horizontal\",",
            "                attrs={",
            "                    \"aria-label\": _(\"More options for '%(title)s'\")",
            "                    % {\"title\": str(instance)},",
            "                },",
            "            )",
            "        ]",
            "",
            "    @cached_property",
            "    def add_item_label(self):",
            "        if self.model:",
            "            return capfirst(",
            "                _(\"Add %(model_name)s\") % {\"model_name\": self.model._meta.verbose_name}",
            "            )",
            "        return _(\"Add\")",
            "",
            "    def get_context_data(self, *args, **kwargs):",
            "        context = super().get_context_data(*args, **kwargs)",
            "",
            "        context[\"can_add\"] = (",
            "            self.permission_policy is None",
            "            or self.permission_policy.user_has_permission(self.request.user, \"add\")",
            "        )",
            "        if context[\"can_add\"]:",
            "            context[\"add_url\"] = context[\"header_action_url\"] = self.add_url",
            "            context[\"header_action_label\"] = self.add_item_label",
            "",
            "        context[\"is_searchable\"] = self.is_searchable",
            "        context[\"search_url\"] = self.get_search_url()",
            "        context[\"search_form\"] = self.search_form",
            "        context[\"is_searching\"] = self.is_searching",
            "        context[\"query_string\"] = self.search_query",
            "        context[\"model_opts\"] = self.model and self.model._meta",
            "        return context",
            "",
            "    def render_to_response(self, context, **response_kwargs):",
            "        if self.is_export:",
            "            return self.as_spreadsheet(",
            "                context[\"object_list\"], self.request.GET.get(\"export\")",
            "            )",
            "        return super().render_to_response(context, **response_kwargs)",
            "",
            "",
            "class CreateView(",
            "    LocaleMixin,",
            "    PanelMixin,",
            "    PermissionCheckedMixin,",
            "    BeforeAfterHookMixin,",
            "    WagtailAdminTemplateMixin,",
            "    BaseCreateView,",
            "):",
            "    model = None",
            "    form_class = None",
            "    index_url_name = None",
            "    add_url_name = None",
            "    edit_url_name = None",
            "    template_name = \"wagtailadmin/generic/create.html\"",
            "    page_title = gettext_lazy(\"New\")",
            "    permission_required = \"add\"",
            "    success_message = gettext_lazy(\"%(model_name)s '%(object)s' created.\")",
            "    error_message = gettext_lazy(",
            "        \"The %(model_name)s could not be created due to errors.\"",
            "    )",
            "    submit_button_label = gettext_lazy(\"Create\")",
            "    actions = [\"create\"]",
            "",
            "    def setup(self, request, *args, **kwargs):",
            "        super().setup(request, *args, **kwargs)",
            "        self.action = self.get_action(request)",
            "",
            "    def get_action(self, request):",
            "        for action in self.get_available_actions():",
            "            if request.POST.get(f\"action-{action}\"):",
            "                return action",
            "        return \"create\"",
            "",
            "    def get_available_actions(self):",
            "        return self.actions",
            "",
            "    def get_page_subtitle(self):",
            "        if not self.page_subtitle and self.model:",
            "            return capfirst(self.model._meta.verbose_name)",
            "        return self.page_subtitle",
            "",
            "    def get_breadcrumbs_items(self):",
            "        if not self.model:",
            "            return self.breadcrumbs_items",
            "        items = []",
            "        if self.index_url_name:",
            "            items.append(",
            "                {",
            "                    \"url\": reverse(self.index_url_name),",
            "                    \"label\": capfirst(self.model._meta.verbose_name_plural),",
            "                }",
            "            )",
            "        items.append(",
            "            {",
            "                \"url\": \"\",",
            "                \"label\": _(\"New: %(model_name)s\")",
            "                % {\"model_name\": capfirst(self.model._meta.verbose_name)},",
            "            }",
            "        )",
            "        return self.breadcrumbs_items + items",
            "",
            "    def get_add_url(self):",
            "        if not self.add_url_name:",
            "            raise ImproperlyConfigured(",
            "                \"Subclasses of wagtail.admin.views.generic.models.CreateView must provide an \"",
            "                \"add_url_name attribute or a get_add_url method\"",
            "            )",
            "        return self._set_locale_query_param(reverse(self.add_url_name))",
            "",
            "    @cached_property",
            "    def add_url(self):",
            "        return self.get_add_url()",
            "",
            "    def get_edit_url(self):",
            "        if not self.edit_url_name:",
            "            raise ImproperlyConfigured(",
            "                \"Subclasses of wagtail.admin.views.generic.models.CreateView must provide an \"",
            "                \"edit_url_name attribute or a get_edit_url method\"",
            "            )",
            "        return reverse(self.edit_url_name, args=(quote(self.object.pk),))",
            "",
            "    def get_success_url(self):",
            "        if not self.index_url_name:",
            "            raise ImproperlyConfigured(",
            "                \"Subclasses of wagtail.admin.views.generic.models.CreateView must provide an \"",
            "                \"index_url_name attribute or a get_success_url method\"",
            "            )",
            "        return self._set_locale_query_param(reverse(self.index_url_name))",
            "",
            "    def get_success_message(self, instance):",
            "        if self.success_message is None:",
            "            return None",
            "        return capfirst(",
            "            self.success_message",
            "            % {",
            "                \"object\": instance,",
            "                \"model_name\": self.model and self.model._meta.verbose_name,",
            "            }",
            "        )",
            "",
            "    def get_success_buttons(self):",
            "        return [messages.button(self.get_edit_url(), _(\"Edit\"))]",
            "",
            "    def get_error_message(self):",
            "        if self.error_message is None:",
            "            return None",
            "        return capfirst(",
            "            self.error_message",
            "            % {\"model_name\": self.model and self.model._meta.verbose_name}",
            "        )",
            "",
            "    def get_context_data(self, **kwargs):",
            "        context = super().get_context_data(**kwargs)",
            "        self.form = context.get(\"form\")",
            "        side_panels = self.get_side_panels()",
            "        context[\"action_url\"] = self.add_url",
            "        context[\"submit_button_label\"] = self.submit_button_label",
            "        context[\"side_panels\"] = side_panels",
            "        context[\"media\"] += side_panels.media",
            "        return context",
            "",
            "    def get_side_panels(self):",
            "        side_panels = [",
            "            StatusSidePanel(",
            "                self.form.instance,",
            "                self.request,",
            "                locale=self.locale,",
            "                translations=self.translations,",
            "            )",
            "        ]",
            "        return MediaContainer(side_panels)",
            "",
            "    def get_translations(self):",
            "        return [",
            "            {",
            "                \"locale\": locale,",
            "                \"url\": self._set_locale_query_param(self.add_url, locale),",
            "            }",
            "            for locale in Locale.objects.all().exclude(id=self.locale.id)",
            "        ]",
            "",
            "    def save_instance(self):",
            "        \"\"\"",
            "        Called after the form is successfully validated - saves the object to the db",
            "        and returns the new object. Override this to implement custom save logic.",
            "        \"\"\"",
            "        instance = self.form.save()",
            "        log(instance=instance, action=\"wagtail.create\", content_changed=True)",
            "        return instance",
            "",
            "    def save_action(self):",
            "        success_message = self.get_success_message(self.object)",
            "        success_buttons = self.get_success_buttons()",
            "        if success_message is not None:",
            "            messages.success(",
            "                self.request,",
            "                success_message,",
            "                buttons=success_buttons,",
            "            )",
            "        return redirect(self.get_success_url())",
            "",
            "    def form_valid(self, form):",
            "        self.form = form",
            "        with transaction.atomic():",
            "            self.object = self.save_instance()",
            "",
            "        response = self.save_action()",
            "",
            "        hook_response = self.run_after_hook()",
            "        if hook_response is not None:",
            "            return hook_response",
            "",
            "        return response",
            "",
            "    def form_invalid(self, form):",
            "        self.form = form",
            "        error_message = self.get_error_message()",
            "        if error_message is not None:",
            "            messages.validation_error(self.request, error_message, form)",
            "        return super().form_invalid(form)",
            "",
            "",
            "class CopyView(CreateView):",
            "    def get_object(self, queryset=None):",
            "        return get_object_or_404(self.model, pk=self.kwargs[\"pk\"])",
            "",
            "    def get_form_kwargs(self):",
            "        return {**super().get_form_kwargs(), \"instance\": self.get_object()}",
            "",
            "",
            "class EditView(",
            "    LocaleMixin,",
            "    PanelMixin,",
            "    PermissionCheckedMixin,",
            "    BeforeAfterHookMixin,",
            "    WagtailAdminTemplateMixin,",
            "    BaseUpdateView,",
            "):",
            "    model = None",
            "    form_class = None",
            "    index_url_name = None",
            "    edit_url_name = None",
            "    delete_url_name = None",
            "    history_url_name = None",
            "    usage_url_name = None",
            "    page_title = gettext_lazy(\"Editing\")",
            "    context_object_name = None",
            "    template_name = \"wagtailadmin/generic/edit.html\"",
            "    permission_required = \"change\"",
            "    delete_item_label = gettext_lazy(\"Delete\")",
            "    success_message = gettext_lazy(\"%(model_name)s '%(object)s' updated.\")",
            "    error_message = gettext_lazy(\"The %(model_name)s could not be saved due to errors.\")",
            "    submit_button_label = gettext_lazy(\"Save\")",
            "    actions = [\"edit\"]",
            "",
            "    def setup(self, request, *args, **kwargs):",
            "        super().setup(request, *args, **kwargs)",
            "        self.action = self.get_action(request)",
            "",
            "    def get_action(self, request):",
            "        for action in self.get_available_actions():",
            "            if request.POST.get(f\"action-{action}\"):",
            "                return action",
            "        return \"edit\"",
            "",
            "    def get_available_actions(self):",
            "        return self.actions",
            "",
            "    def get_object(self, queryset=None):",
            "        if \"pk\" not in self.kwargs:",
            "            self.kwargs[\"pk\"] = self.args[0]",
            "        self.kwargs[\"pk\"] = unquote(str(self.kwargs[\"pk\"]))",
            "        return super().get_object(queryset)",
            "",
            "    def get_page_subtitle(self):",
            "        return str(self.object)",
            "",
            "    def get_breadcrumbs_items(self):",
            "        if not self.model:",
            "            return self.breadcrumbs_items",
            "        items = []",
            "        if self.index_url_name:",
            "            items.append(",
            "                {",
            "                    \"url\": reverse(self.index_url_name),",
            "                    \"label\": capfirst(self.model._meta.verbose_name_plural),",
            "                }",
            "            )",
            "        items.append({\"url\": \"\", \"label\": get_latest_str(self.object)})",
            "        return self.breadcrumbs_items + items",
            "",
            "    def get_side_panels(self):",
            "        side_panels = []",
            "        usage_url = self.get_usage_url()",
            "        history_url = self.get_history_url()",
            "        if usage_url or history_url:",
            "            side_panels.append(",
            "                StatusSidePanel(",
            "                    self.object,",
            "                    self.request,",
            "                    locale=self.locale,",
            "                    translations=self.translations,",
            "                    usage_url=usage_url,",
            "                    history_url=history_url,",
            "                    last_updated_info=self.get_last_updated_info(),",
            "                )",
            "            )",
            "        return MediaContainer(side_panels)",
            "",
            "    def get_last_updated_info(self):",
            "        return log_registry.get_logs_for_instance(self.object).first()",
            "",
            "    def get_edit_url(self):",
            "        if not self.edit_url_name:",
            "            raise ImproperlyConfigured(",
            "                \"Subclasses of wagtail.admin.views.generic.models.EditView must provide an \"",
            "                \"edit_url_name attribute or a get_edit_url method\"",
            "            )",
            "        return reverse(self.edit_url_name, args=(quote(self.object.pk),))",
            "",
            "    def get_delete_url(self):",
            "        if self.delete_url_name:",
            "            return reverse(self.delete_url_name, args=(quote(self.object.pk),))",
            "",
            "    def get_history_url(self):",
            "        if self.history_url_name:",
            "            return reverse(self.history_url_name, args=(quote(self.object.pk),))",
            "",
            "    def get_usage_url(self):",
            "        if self.usage_url_name:",
            "            return reverse(self.usage_url_name, args=[quote(self.object.pk)])",
            "",
            "    def get_success_url(self):",
            "        if not self.index_url_name:",
            "            raise ImproperlyConfigured(",
            "                \"Subclasses of wagtail.admin.views.generic.models.EditView must provide an \"",
            "                \"index_url_name attribute or a get_success_url method\"",
            "            )",
            "        return reverse(self.index_url_name)",
            "",
            "    def get_translations(self):",
            "        if not self.edit_url_name:",
            "            return []",
            "        return [",
            "            {",
            "                \"locale\": translation.locale,",
            "                \"url\": reverse(self.edit_url_name, args=[quote(translation.pk)]),",
            "            }",
            "            for translation in self.object.get_translations().select_related(\"locale\")",
            "        ]",
            "",
            "    def save_instance(self):",
            "        \"\"\"",
            "        Called after the form is successfully validated - saves the object to the db.",
            "        Override this to implement custom save logic.",
            "        \"\"\"",
            "        instance = self.form.save()",
            "",
            "        self.has_content_changes = self.form.has_changed()",
            "",
            "        log(",
            "            instance=instance,",
            "            action=\"wagtail.edit\",",
            "            content_changed=self.has_content_changes,",
            "        )",
            "",
            "        return instance",
            "",
            "    def save_action(self):",
            "        success_message = self.get_success_message()",
            "        success_buttons = self.get_success_buttons()",
            "        if success_message is not None:",
            "            messages.success(",
            "                self.request,",
            "                success_message,",
            "                buttons=success_buttons,",
            "            )",
            "        return redirect(self.get_success_url())",
            "",
            "    def get_success_message(self):",
            "        if self.success_message is None:",
            "            return None",
            "        return capfirst(",
            "            self.success_message",
            "            % {",
            "                \"object\": self.object,",
            "                \"model_name\": self.model and self.model._meta.verbose_name,",
            "            }",
            "        )",
            "",
            "    def get_success_buttons(self):",
            "        return [",
            "            messages.button(",
            "                reverse(self.edit_url_name, args=(quote(self.object.pk),)), _(\"Edit\")",
            "            )",
            "        ]",
            "",
            "    def get_error_message(self):",
            "        if self.error_message is None:",
            "            return None",
            "        return capfirst(",
            "            self.error_message",
            "            % {\"model_name\": self.model and self.model._meta.verbose_name}",
            "        )",
            "",
            "    def form_valid(self, form):",
            "        self.form = form",
            "        with transaction.atomic():",
            "            self.object = self.save_instance()",
            "",
            "        response = self.save_action()",
            "",
            "        hook_response = self.run_after_hook()",
            "        if hook_response is not None:",
            "            return hook_response",
            "",
            "        return response",
            "",
            "    def form_invalid(self, form):",
            "        self.form = form",
            "        error_message = self.get_error_message()",
            "        if error_message is not None:",
            "            messages.validation_error(self.request, error_message, form)",
            "        return super().form_invalid(form)",
            "",
            "    def get_context_data(self, **kwargs):",
            "        context = super().get_context_data(**kwargs)",
            "        self.form = context.get(\"form\")",
            "        side_panels = self.get_side_panels()",
            "        context[\"action_url\"] = self.get_edit_url()",
            "        context[\"history_url\"] = self.get_history_url()",
            "        context[\"side_panels\"] = side_panels",
            "        context[\"media\"] += side_panels.media",
            "        context[\"submit_button_label\"] = self.submit_button_label",
            "        context[\"can_delete\"] = (",
            "            self.permission_policy is None",
            "            or self.permission_policy.user_has_permission(self.request.user, \"delete\")",
            "        )",
            "        if context[\"can_delete\"]:",
            "            context[\"delete_url\"] = self.get_delete_url()",
            "            context[\"delete_item_label\"] = self.delete_item_label",
            "        return context",
            "",
            "",
            "class DeleteView(",
            "    LocaleMixin,",
            "    PanelMixin,",
            "    PermissionCheckedMixin,",
            "    BeforeAfterHookMixin,",
            "    WagtailAdminTemplateMixin,",
            "    BaseDeleteView,",
            "):",
            "    model = None",
            "    index_url_name = None",
            "    edit_url_name = None",
            "    delete_url_name = None",
            "    usage_url_name = None",
            "    template_name = \"wagtailadmin/generic/confirm_delete.html\"",
            "    context_object_name = None",
            "    permission_required = \"delete\"",
            "    page_title = gettext_lazy(\"Delete\")",
            "    success_message = gettext_lazy(\"%(model_name)s '%(object)s' deleted.\")",
            "",
            "    def setup(self, request, *args, **kwargs):",
            "        super().setup(request, *args, **kwargs)",
            "        self.object = self.get_object()",
            "        # Get this here instead of the template so that we do not iterate through",
            "        # the usage and potentially trigger a database query for each item",
            "        self.usage_url = self.get_usage_url()",
            "        self.usage = self.get_usage()",
            "",
            "    def get_object(self, queryset=None):",
            "        # If the object has already been loaded, return it to avoid another query",
            "        if getattr(self, \"object\", None):",
            "            return self.object",
            "        if self.pk_url_kwarg not in self.kwargs:",
            "            self.kwargs[self.pk_url_kwarg] = self.args[0]",
            "        self.kwargs[self.pk_url_kwarg] = unquote(str(self.kwargs[self.pk_url_kwarg]))",
            "        return super().get_object(queryset)",
            "",
            "    def get_usage(self):",
            "        if not self.usage_url:",
            "            return None",
            "        return ReferenceIndex.get_grouped_references_to(self.object)",
            "",
            "    def get_success_url(self):",
            "        next_url = get_valid_next_url_from_request(self.request)",
            "        if next_url:",
            "            return next_url",
            "        if not self.index_url_name:",
            "            raise ImproperlyConfigured(",
            "                \"Subclasses of wagtail.admin.views.generic.models.DeleteView must provide an \"",
            "                \"index_url_name attribute or a get_success_url method\"",
            "            )",
            "        return reverse(self.index_url_name)",
            "",
            "    def get_page_subtitle(self):",
            "        return str(self.object)",
            "",
            "    def get_breadcrumbs_items(self):",
            "        return []",
            "",
            "    def get_delete_url(self):",
            "        if not self.delete_url_name:",
            "            raise ImproperlyConfigured(",
            "                \"Subclasses of wagtail.admin.views.generic.models.DeleteView must provide a \"",
            "                \"delete_url_name attribute or a get_delete_url method\"",
            "            )",
            "        return reverse(self.delete_url_name, args=(quote(self.object.pk),))",
            "",
            "    def get_usage_url(self):",
            "        # Usage URL is optional, allow it to be unset",
            "        if self.usage_url_name:",
            "            return (",
            "                reverse(self.usage_url_name, args=(quote(self.object.pk),))",
            "                + \"?describe_on_delete=1\"",
            "            )",
            "",
            "    @property",
            "    def confirmation_message(self):",
            "        return _(\"Are you sure you want to delete this %(model_name)s?\") % {",
            "            \"model_name\": self.object._meta.verbose_name",
            "        }",
            "",
            "    def get_success_message(self):",
            "        if self.success_message is None:",
            "            return None",
            "        return capfirst(",
            "            self.success_message",
            "            % {",
            "                \"model_name\": capfirst(self.object._meta.verbose_name),",
            "                \"object\": self.object,",
            "            }",
            "        )",
            "",
            "    def delete_action(self):",
            "        with transaction.atomic():",
            "            log(instance=self.object, action=\"wagtail.delete\")",
            "            self.object.delete()",
            "",
            "    def form_valid(self, form):",
            "        if self.usage and self.usage.is_protected:",
            "            raise PermissionDenied",
            "        success_url = self.get_success_url()",
            "        self.delete_action()",
            "        messages.success(self.request, self.get_success_message())",
            "        hook_response = self.run_after_hook()",
            "        if hook_response is not None:",
            "            return hook_response",
            "        return HttpResponseRedirect(success_url)",
            "",
            "    def get_context_data(self, **kwargs):",
            "        context = super().get_context_data(**kwargs)",
            "        context[\"model_opts\"] = self.object._meta",
            "        context[\"next\"] = self.get_success_url()",
            "        if self.usage_url:",
            "            context[\"usage_url\"] = self.usage_url",
            "            context[\"usage_count\"] = self.usage.count()",
            "            context[\"is_protected\"] = self.usage.is_protected",
            "        return context",
            "",
            "",
            "class InspectView(PermissionCheckedMixin, WagtailAdminTemplateMixin, TemplateView):",
            "    any_permission_required = [\"add\", \"change\", \"delete\"]",
            "    template_name = \"wagtailadmin/generic/inspect.html\"",
            "    page_title = gettext_lazy(\"Inspecting\")",
            "    model = None",
            "    index_url_name = None",
            "    edit_url_name = None",
            "    delete_url_name = None",
            "    fields = []",
            "    fields_exclude = []",
            "    pk_url_kwarg = \"pk\"",
            "",
            "    def setup(self, request, *args, **kwargs):",
            "        super().setup(request, *args, **kwargs)",
            "        self.pk = self.kwargs[self.pk_url_kwarg]",
            "        self.fields = self.get_fields()",
            "        self.object = self.get_object()",
            "",
            "    def get_object(self, queryset=None):",
            "        return get_object_or_404(self.model, pk=unquote(str(self.pk)))",
            "",
            "    def get_page_subtitle(self):",
            "        return get_latest_str(self.object)",
            "",
            "    def get_breadcrumbs_items(self):",
            "        items = []",
            "        if self.index_url_name:",
            "            items.append(",
            "                {",
            "                    \"url\": reverse(self.index_url_name),",
            "                    \"label\": capfirst(self.model._meta.verbose_name_plural),",
            "                }",
            "            )",
            "        edit_url = self.get_edit_url()",
            "        object_str = self.get_page_subtitle()",
            "        if edit_url:",
            "            items.append({\"url\": edit_url, \"label\": object_str})",
            "        items.append(",
            "            {",
            "                \"url\": \"\",",
            "                \"label\": _(\"Inspect\"),",
            "                \"sublabel\": object_str,",
            "            }",
            "        )",
            "        return self.breadcrumbs_items + items",
            "",
            "    def get_fields(self):",
            "        fields = self.fields or [",
            "            f.name",
            "            for f in self.model._meta.get_fields()",
            "            if f.concrete",
            "            and (not f.is_relation or (not f.auto_created and f.related_model))",
            "        ]",
            "",
            "        fields = [f for f in fields if f not in self.fields_exclude]",
            "        return fields",
            "",
            "    def get_field_label(self, field_name, field):",
            "        return capfirst(label_for_field(field_name, model=self.model))",
            "",
            "    def get_field_display_value(self, field_name, field):",
            "        # First we check for a 'get_fieldname_display' property/method on",
            "        # the model, and return the value of that, if present.",
            "        value_func = getattr(self.object, \"get_%s_display\" % field_name, None)",
            "        if value_func is not None:",
            "            if callable(value_func):",
            "                return value_func()",
            "            return value_func",
            "",
            "        # Now let's get the attribute value from the instance itself and see if",
            "        # we can render something useful. Raises AttributeError appropriately.",
            "        value = getattr(self.object, field_name)",
            "",
            "        if isinstance(value, models.Manager):",
            "            value = value.all()",
            "",
            "        if isinstance(value, models.QuerySet):",
            "            return \", \".join(str(obj) for obj in value) or \"-\"",
            "",
            "        display_class = display_class_registry.get(field)",
            "",
            "        if display_class:",
            "            return display_class(value)",
            "",
            "        return value",
            "",
            "    def get_context_for_field(self, field_name):",
            "        try:",
            "            field = self.model._meta.get_field(field_name)",
            "        except FieldDoesNotExist:",
            "            field = None",
            "        context = {",
            "            \"label\": self.get_field_label(field_name, field),",
            "            \"value\": self.get_field_display_value(field_name, field),",
            "            \"component\": None,",
            "        }",
            "        if isinstance(context[\"value\"], Component):",
            "            context[\"component\"] = context[\"value\"]",
            "        return context",
            "",
            "    def get_fields_context(self):",
            "        return [self.get_context_for_field(field_name) for field_name in self.fields]",
            "",
            "    def get_edit_url(self):",
            "        if not self.edit_url_name or (",
            "            self.permission_policy",
            "            and not self.permission_policy.user_has_permission(",
            "                self.request.user, \"change\"",
            "            )",
            "        ):",
            "            return None",
            "        return reverse(self.edit_url_name, args=(quote(self.object.pk),))",
            "",
            "    def get_delete_url(self):",
            "        if not self.delete_url_name or (",
            "            self.permission_policy",
            "            and not self.permission_policy.user_has_permission(",
            "                self.request.user, \"delete\"",
            "            )",
            "        ):",
            "            return None",
            "        return reverse(self.delete_url_name, args=(quote(self.object.pk),))",
            "",
            "    def get_context_data(self, **kwargs):",
            "        context = super().get_context_data(**kwargs)",
            "        context[\"object\"] = self.object",
            "        context[\"fields\"] = self.get_fields_context()",
            "        context[\"edit_url\"] = self.get_edit_url()",
            "        context[\"delete_url\"] = self.get_delete_url()",
            "        return context",
            "",
            "",
            "class RevisionsCompareView(WagtailAdminTemplateMixin, TemplateView):",
            "    edit_handler = None",
            "    edit_url_name = None",
            "    history_url_name = None",
            "    edit_label = gettext_lazy(\"Edit\")",
            "    history_label = gettext_lazy(\"History\")",
            "    template_name = \"wagtailadmin/generic/revisions/compare.html\"",
            "    model = None",
            "",
            "    def setup(self, request, pk, revision_id_a, revision_id_b, *args, **kwargs):",
            "        super().setup(request, *args, **kwargs)",
            "        self.pk = pk",
            "        self.revision_id_a = revision_id_a",
            "        self.revision_id_b = revision_id_b",
            "        self.object = self.get_object()",
            "",
            "    def get_object(self, queryset=None):",
            "        return get_object_or_404(self.model, pk=unquote(str(self.pk)))",
            "",
            "    def get_edit_handler(self):",
            "        if self.edit_handler:",
            "            return self.edit_handler",
            "        return get_edit_handler(self.model)",
            "",
            "    def get_page_subtitle(self):",
            "        return str(self.object)",
            "",
            "    def get_history_url(self):",
            "        if self.history_url_name:",
            "            return reverse(self.history_url_name, args=(quote(self.object.pk),))",
            "",
            "    def get_edit_url(self):",
            "        if self.edit_url_name:",
            "            return reverse(self.edit_url_name, args=(quote(self.object.pk),))",
            "",
            "    def _get_revision_and_heading(self, revision_id):",
            "        if revision_id == \"live\":",
            "            revision = self.object",
            "            revision_heading = _(\"Live\")",
            "            return revision, revision_heading",
            "",
            "        if revision_id == \"earliest\":",
            "            revision = self.object.revisions.order_by(\"created_at\", \"id\").first()",
            "            revision_heading = _(\"Earliest\")",
            "        elif revision_id == \"latest\":",
            "            revision = self.object.revisions.order_by(\"created_at\", \"id\").last()",
            "            revision_heading = _(\"Latest\")",
            "        else:",
            "            revision = get_object_or_404(self.object.revisions, id=revision_id)",
            "            if revision:",
            "                revision_heading = str(revision.created_at)",
            "",
            "        if not revision:",
            "            raise Http404",
            "",
            "        revision = revision.as_object()",
            "",
            "        return revision, revision_heading",
            "",
            "    def _get_comparison(self, revision_a, revision_b):",
            "        comparison = (",
            "            self.get_edit_handler()",
            "            .get_bound_panel(instance=self.object, request=self.request, form=None)",
            "            .get_comparison()",
            "        )",
            "",
            "        result = []",
            "        for comp in comparison:",
            "            diff = comp(revision_a, revision_b)",
            "            if diff.has_changed():",
            "                result += [diff]",
            "",
            "        return result",
            "",
            "    def get_context_data(self, **kwargs):",
            "        context = super().get_context_data(**kwargs)",
            "",
            "        revision_a, revision_a_heading = self._get_revision_and_heading(",
            "            self.revision_id_a",
            "        )",
            "        revision_b, revision_b_heading = self._get_revision_and_heading(",
            "            self.revision_id_b",
            "        )",
            "        comparison = self._get_comparison(revision_a, revision_b)",
            "",
            "        context.update(",
            "            {",
            "                \"object\": self.object,",
            "                \"history_label\": self.history_label,",
            "                \"edit_label\": self.edit_label,",
            "                \"history_url\": self.get_history_url(),",
            "                \"edit_url\": self.get_edit_url(),",
            "                \"revision_a\": revision_a,",
            "                \"revision_a_heading\": revision_a_heading,",
            "                \"revision_b\": revision_b,",
            "                \"revision_b_heading\": revision_b_heading,",
            "                \"comparison\": comparison,",
            "            }",
            "        )",
            "",
            "        return context",
            "",
            "",
            "class UnpublishView(HookResponseMixin, WagtailAdminTemplateMixin, TemplateView):",
            "    model = None",
            "    index_url_name = None",
            "    edit_url_name = None",
            "    unpublish_url_name = None",
            "    usage_url_name = None",
            "    success_message = gettext_lazy(\"'%(object)s' unpublished.\")",
            "    template_name = \"wagtailadmin/generic/confirm_unpublish.html\"",
            "",
            "    def setup(self, request, pk, *args, **kwargs):",
            "        super().setup(request, *args, **kwargs)",
            "        self.pk = pk",
            "        self.object = self.get_object()",
            "",
            "    def dispatch(self, request, *args, **kwargs):",
            "        self.objects_to_unpublish = self.get_objects_to_unpublish()",
            "        return super().dispatch(request, *args, **kwargs)",
            "",
            "    def get_object(self, queryset=None):",
            "        if not self.model or not issubclass(self.model, DraftStateMixin):",
            "            raise Http404",
            "        return get_object_or_404(self.model, pk=unquote(str(self.pk)))",
            "",
            "    def get_usage(self):",
            "        return ReferenceIndex.get_grouped_references_to(self.object)",
            "",
            "    def get_objects_to_unpublish(self):",
            "        # Hook to allow child classes to have more objects to unpublish (e.g. page descendants)",
            "        return [self.object]",
            "",
            "    def get_object_display_title(self):",
            "        return str(self.object)",
            "",
            "    def get_success_message(self):",
            "        if self.success_message is None:",
            "            return None",
            "        return self.success_message % {\"object\": str(self.object)}",
            "",
            "    def get_success_buttons(self):",
            "        if self.edit_url_name:",
            "            return [",
            "                messages.button(",
            "                    reverse(self.edit_url_name, args=(quote(self.object.pk),)),",
            "                    _(\"Edit\"),",
            "                )",
            "            ]",
            "",
            "    def get_next_url(self):",
            "        if not self.index_url_name:",
            "            raise ImproperlyConfigured(",
            "                \"Subclasses of wagtail.admin.views.generic.models.UnpublishView \"",
            "                \"must provide an index_url_name attribute or a get_next_url method\"",
            "            )",
            "        return reverse(self.index_url_name)",
            "",
            "    def get_unpublish_url(self):",
            "        if not self.unpublish_url_name:",
            "            raise ImproperlyConfigured(",
            "                \"Subclasses of wagtail.admin.views.generic.models.UnpublishView \"",
            "                \"must provide an unpublish_url_name attribute or a get_unpublish_url method\"",
            "            )",
            "        return reverse(self.unpublish_url_name, args=(quote(self.object.pk),))",
            "",
            "    def get_usage_url(self):",
            "        # Usage URL is optional, allow it to be unset",
            "        if self.usage_url_name:",
            "            return reverse(self.usage_url_name, args=(quote(self.object.pk),))",
            "",
            "    def unpublish(self):",
            "        hook_response = self.run_hook(\"before_unpublish\", self.request, self.object)",
            "        if hook_response is not None:",
            "            return hook_response",
            "",
            "        for object in self.objects_to_unpublish:",
            "            action = UnpublishAction(object, user=self.request.user)",
            "            action.execute(skip_permission_checks=True)",
            "",
            "        hook_response = self.run_hook(\"after_unpublish\", self.request, self.object)",
            "        if hook_response is not None:",
            "            return hook_response",
            "",
            "    def post(self, request, *args, **kwargs):",
            "        hook_response = self.unpublish()",
            "        if hook_response:",
            "            return hook_response",
            "",
            "        success_message = self.get_success_message()",
            "        success_buttons = self.get_success_buttons()",
            "        if success_message is not None:",
            "            messages.success(request, success_message, buttons=success_buttons)",
            "",
            "        return redirect(self.get_next_url())",
            "",
            "    def get_context_data(self, **kwargs):",
            "        context = super().get_context_data(**kwargs)",
            "        context[\"model_opts\"] = self.object._meta",
            "        context[\"object\"] = self.object",
            "        context[\"object_display_title\"] = self.get_object_display_title()",
            "        context[\"unpublish_url\"] = self.get_unpublish_url()",
            "        context[\"next_url\"] = self.get_next_url()",
            "        context[\"usage_url\"] = self.get_usage_url()",
            "        if context[\"usage_url\"]:",
            "            usage = self.get_usage()",
            "            context[\"usage_count\"] = usage.count()",
            "        return context",
            "",
            "",
            "class RevisionsUnscheduleView(WagtailAdminTemplateMixin, TemplateView):",
            "    model = None",
            "    edit_url_name = None",
            "    history_url_name = None",
            "    revisions_unschedule_url_name = None",
            "    success_message = gettext_lazy(",
            "        'Version %(revision_id)s of \"%(object)s\" unscheduled.'",
            "    )",
            "    template_name = \"wagtailadmin/shared/revisions/confirm_unschedule.html\"",
            "",
            "    def setup(self, request, pk, revision_id, *args, **kwargs):",
            "        super().setup(request, *args, **kwargs)",
            "        self.pk = pk",
            "        self.revision_id = revision_id",
            "        self.object = self.get_object()",
            "        self.revision = self.get_revision()",
            "",
            "    def get_object(self, queryset=None):",
            "        if not self.model or not issubclass(self.model, DraftStateMixin):",
            "            raise Http404",
            "        return get_object_or_404(self.model, pk=unquote(str(self.pk)))",
            "",
            "    def get_revision(self):",
            "        return get_object_or_404(self.object.revisions, id=self.revision_id)",
            "",
            "    def get_revisions_unschedule_url(self):",
            "        return reverse(",
            "            self.revisions_unschedule_url_name,",
            "            args=(quote(self.object.pk), self.revision.id),",
            "        )",
            "",
            "    def get_object_display_title(self):",
            "        return str(self.object)",
            "",
            "    def get_success_message(self):",
            "        if self.success_message is None:",
            "            return None",
            "        return self.success_message % {",
            "            \"revision_id\": self.revision.id,",
            "            \"object\": self.get_object_display_title(),",
            "        }",
            "",
            "    def get_success_buttons(self):",
            "        return [",
            "            messages.button(",
            "                reverse(self.edit_url_name, args=(quote(self.object.pk),)), _(\"Edit\")",
            "            )",
            "        ]",
            "",
            "    def get_next_url(self):",
            "        next_url = get_valid_next_url_from_request(self.request)",
            "        if next_url:",
            "            return next_url",
            "",
            "        if not self.history_url_name:",
            "            raise ImproperlyConfigured(",
            "                \"Subclasses of wagtail.admin.views.generic.models.RevisionsUnscheduleView \"",
            "                \" must provide a history_url_name attribute or a get_next_url method\"",
            "            )",
            "        return reverse(self.history_url_name, args=(quote(self.object.pk),))",
            "",
            "    def get_page_subtitle(self):",
            "        return _('revision %(revision_id)s of \"%(object)s\"') % {",
            "            \"revision_id\": self.revision.id,",
            "            \"object\": self.get_object_display_title(),",
            "        }",
            "",
            "    def get_context_data(self, **kwargs):",
            "        context = super().get_context_data(**kwargs)",
            "        context.update(",
            "            {",
            "                \"object\": self.object,",
            "                \"revision\": self.revision,",
            "                \"subtitle\": self.get_page_subtitle(),",
            "                \"object_display_title\": self.get_object_display_title(),",
            "                \"revisions_unschedule_url\": self.get_revisions_unschedule_url(),",
            "                \"next_url\": self.get_next_url(),",
            "            }",
            "        )",
            "        return context",
            "",
            "    def post(self, request, *args, **kwargs):",
            "        self.revision.approved_go_live_at = None",
            "        self.revision.save(user=request.user, update_fields=[\"approved_go_live_at\"])",
            "",
            "        success_message = self.get_success_message()",
            "        success_buttons = self.get_success_buttons()",
            "        if success_message:",
            "            messages.success(",
            "                request,",
            "                success_message,",
            "                buttons=success_buttons,",
            "            )",
            "",
            "        return redirect(self.get_next_url())"
        ],
        "action": [
            "0",
            "0",
            "0",
            "1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "30": [],
            "620": [
                "CreateView",
                "get_initial_form_instance"
            ],
            "621": [
                "CreateView",
                "get_initial_form_instance"
            ],
            "622": [
                "CreateView",
                "get_initial_form_instance"
            ],
            "623": [
                "CreateView",
                "get_initial_form_instance"
            ],
            "624": [
                "CreateView",
                "get_initial_form_instance"
            ],
            "625": [
                "CreateView"
            ],
            "626": [
                "CreateView",
                "get_form_kwargs"
            ],
            "627": [
                "CreateView",
                "get_form_kwargs"
            ],
            "628": [
                "CreateView",
                "get_form_kwargs"
            ],
            "629": [
                "CreateView",
                "get_form_kwargs"
            ],
            "630": [
                "CreateView",
                "get_form_kwargs"
            ],
            "631": [
                "CreateView",
                "get_form_kwargs"
            ],
            "632": [
                "CreateView",
                "get_form_kwargs"
            ],
            "633": [
                "CreateView",
                "get_form_kwargs"
            ],
            "634": [
                "CreateView",
                "get_form_kwargs"
            ],
            "635": [
                "CreateView",
                "get_form_kwargs"
            ],
            "636": [
                "CreateView",
                "get_form_kwargs"
            ],
            "637": [
                "CreateView"
            ],
            "808": [
                "EditView",
                "get_form_kwargs"
            ],
            "809": [
                "EditView",
                "get_form_kwargs"
            ],
            "810": [
                "EditView",
                "get_form_kwargs"
            ],
            "811": [
                "EditView",
                "get_form_kwargs"
            ],
            "812": [
                "EditView",
                "get_form_kwargs"
            ],
            "813": [
                "EditView",
                "get_form_kwargs"
            ],
            "814": [
                "EditView"
            ]
        },
        "addLocation": []
    },
    "wagtail/contrib/settings/tests/generic/test_admin.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 14,
                "afterPatchRowNumber": 14,
                "PatchRowcode": "     PanelGenericSettings,"
            },
            "1": {
                "beforePatchRowNumber": 15,
                "afterPatchRowNumber": 15,
                "PatchRowcode": "     TabbedGenericSettings,"
            },
            "2": {
                "beforePatchRowNumber": 16,
                "afterPatchRowNumber": 16,
                "PatchRowcode": "     TestGenericSetting,"
            },
            "3": {
                "beforePatchRowNumber": 17,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    TestPermissionedGenericSetting,"
            },
            "4": {
                "beforePatchRowNumber": 18,
                "afterPatchRowNumber": 17,
                "PatchRowcode": " )"
            },
            "5": {
                "beforePatchRowNumber": 19,
                "afterPatchRowNumber": 18,
                "PatchRowcode": " from wagtail.test.utils import WagtailTestUtils"
            },
            "6": {
                "beforePatchRowNumber": 20,
                "afterPatchRowNumber": 19,
                "PatchRowcode": " "
            },
            "7": {
                "beforePatchRowNumber": 77,
                "afterPatchRowNumber": 76,
                "PatchRowcode": " class TestGenericSettingCreateView(BaseTestGenericSettingView):"
            },
            "8": {
                "beforePatchRowNumber": 78,
                "afterPatchRowNumber": 77,
                "PatchRowcode": "     def setUp(self):"
            },
            "9": {
                "beforePatchRowNumber": 79,
                "afterPatchRowNumber": 78,
                "PatchRowcode": "         self.user = self.login()"
            },
            "10": {
                "beforePatchRowNumber": 80,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user.user_permissions.add("
            },
            "11": {
                "beforePatchRowNumber": 81,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            Permission.objects.get("
            },
            "12": {
                "beforePatchRowNumber": 82,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                content_type__app_label=\"wagtailadmin\", codename=\"access_admin\""
            },
            "13": {
                "beforePatchRowNumber": 83,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            )"
            },
            "14": {
                "beforePatchRowNumber": 84,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        )"
            },
            "15": {
                "beforePatchRowNumber": 85,
                "afterPatchRowNumber": 79,
                "PatchRowcode": " "
            },
            "16": {
                "beforePatchRowNumber": 86,
                "afterPatchRowNumber": 80,
                "PatchRowcode": "     def test_get_edit(self):"
            },
            "17": {
                "beforePatchRowNumber": 87,
                "afterPatchRowNumber": 81,
                "PatchRowcode": "         response = self.get()"
            },
            "18": {
                "beforePatchRowNumber": 113,
                "afterPatchRowNumber": 107,
                "PatchRowcode": "         # Ensure the form supports file uploads"
            },
            "19": {
                "beforePatchRowNumber": 114,
                "afterPatchRowNumber": 108,
                "PatchRowcode": "         self.assertContains(response, 'enctype=\"multipart/form-data\"')"
            },
            "20": {
                "beforePatchRowNumber": 115,
                "afterPatchRowNumber": 109,
                "PatchRowcode": " "
            },
            "21": {
                "beforePatchRowNumber": 116,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    def test_create_restricted_field_without_permission(self):"
            },
            "22": {
                "beforePatchRowNumber": 117,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user.is_superuser = False"
            },
            "23": {
                "beforePatchRowNumber": 118,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user.save()"
            },
            "24": {
                "beforePatchRowNumber": 119,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "25": {
                "beforePatchRowNumber": 120,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertFalse(TestPermissionedGenericSetting.objects.exists())"
            },
            "26": {
                "beforePatchRowNumber": 121,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        response = self.post("
            },
            "27": {
                "beforePatchRowNumber": 122,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            post_data={\"sensitive_email\": \"test@example.com\", \"title\": \"test\"},"
            },
            "28": {
                "beforePatchRowNumber": 123,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            setting=TestPermissionedGenericSetting,"
            },
            "29": {
                "beforePatchRowNumber": 124,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        )"
            },
            "30": {
                "beforePatchRowNumber": 125,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertEqual(response.status_code, 302)"
            },
            "31": {
                "beforePatchRowNumber": 126,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "32": {
                "beforePatchRowNumber": 127,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        settings = TestPermissionedGenericSetting.objects.get()"
            },
            "33": {
                "beforePatchRowNumber": 128,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertEqual(settings.title, \"test\")"
            },
            "34": {
                "beforePatchRowNumber": 129,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertEqual(settings.sensitive_email, \"\")"
            },
            "35": {
                "beforePatchRowNumber": 130,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "36": {
                "beforePatchRowNumber": 131,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    def test_create_restricted_field(self):"
            },
            "37": {
                "beforePatchRowNumber": 132,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user.is_superuser = False"
            },
            "38": {
                "beforePatchRowNumber": 133,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user.save()"
            },
            "39": {
                "beforePatchRowNumber": 134,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user.user_permissions.add("
            },
            "40": {
                "beforePatchRowNumber": 135,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            Permission.objects.get(codename=\"can_edit_sensitive_email_generic_setting\")"
            },
            "41": {
                "beforePatchRowNumber": 136,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        )"
            },
            "42": {
                "beforePatchRowNumber": 137,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertFalse(TestPermissionedGenericSetting.objects.exists())"
            },
            "43": {
                "beforePatchRowNumber": 138,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        response = self.post("
            },
            "44": {
                "beforePatchRowNumber": 139,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            post_data={\"sensitive_email\": \"test@example.com\", \"title\": \"test\"},"
            },
            "45": {
                "beforePatchRowNumber": 140,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            setting=TestPermissionedGenericSetting,"
            },
            "46": {
                "beforePatchRowNumber": 141,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        )"
            },
            "47": {
                "beforePatchRowNumber": 142,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertEqual(response.status_code, 302)"
            },
            "48": {
                "beforePatchRowNumber": 143,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "49": {
                "beforePatchRowNumber": 144,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        settings = TestPermissionedGenericSetting.objects.get()"
            },
            "50": {
                "beforePatchRowNumber": 145,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertEqual(settings.title, \"test\")"
            },
            "51": {
                "beforePatchRowNumber": 146,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertEqual(settings.sensitive_email, \"test@example.com\")"
            },
            "52": {
                "beforePatchRowNumber": 147,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "53": {
                "beforePatchRowNumber": 148,
                "afterPatchRowNumber": 110,
                "PatchRowcode": " "
            },
            "54": {
                "beforePatchRowNumber": 149,
                "afterPatchRowNumber": 111,
                "PatchRowcode": " class TestGenericSettingEditView(BaseTestGenericSettingView):"
            },
            "55": {
                "beforePatchRowNumber": 150,
                "afterPatchRowNumber": 112,
                "PatchRowcode": "     def setUp(self):"
            },
            "56": {
                "beforePatchRowNumber": 151,
                "afterPatchRowNumber": 113,
                "PatchRowcode": "         self.test_setting = TestGenericSetting()"
            },
            "57": {
                "beforePatchRowNumber": 152,
                "afterPatchRowNumber": 114,
                "PatchRowcode": "         self.test_setting.title = \"Setting title\""
            },
            "58": {
                "beforePatchRowNumber": 153,
                "afterPatchRowNumber": 115,
                "PatchRowcode": "         self.test_setting.save()"
            },
            "59": {
                "beforePatchRowNumber": 154,
                "afterPatchRowNumber": 116,
                "PatchRowcode": " "
            },
            "60": {
                "beforePatchRowNumber": 155,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user = self.login()"
            },
            "61": {
                "beforePatchRowNumber": 156,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user.user_permissions.add("
            },
            "62": {
                "beforePatchRowNumber": 157,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            Permission.objects.get("
            },
            "63": {
                "beforePatchRowNumber": 158,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                content_type__app_label=\"wagtailadmin\", codename=\"access_admin\""
            },
            "64": {
                "beforePatchRowNumber": 159,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            )"
            },
            "65": {
                "beforePatchRowNumber": 160,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        )"
            },
            "66": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 117,
                "PatchRowcode": "+        self.login()"
            },
            "67": {
                "beforePatchRowNumber": 161,
                "afterPatchRowNumber": 118,
                "PatchRowcode": " "
            },
            "68": {
                "beforePatchRowNumber": 162,
                "afterPatchRowNumber": 119,
                "PatchRowcode": "     def test_get_edit(self):"
            },
            "69": {
                "beforePatchRowNumber": 163,
                "afterPatchRowNumber": 120,
                "PatchRowcode": "         response = self.get()"
            },
            "70": {
                "beforePatchRowNumber": 196,
                "afterPatchRowNumber": 153,
                "PatchRowcode": "             expected_url=f\"{url}{TestGenericSetting.objects.first().pk}/\","
            },
            "71": {
                "beforePatchRowNumber": 197,
                "afterPatchRowNumber": 154,
                "PatchRowcode": "         )"
            },
            "72": {
                "beforePatchRowNumber": 198,
                "afterPatchRowNumber": 155,
                "PatchRowcode": " "
            },
            "73": {
                "beforePatchRowNumber": 199,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    def test_edit_restricted_field(self):"
            },
            "74": {
                "beforePatchRowNumber": 200,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        test_setting = TestPermissionedGenericSetting()"
            },
            "75": {
                "beforePatchRowNumber": 201,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        test_setting.sensitive_email = \"test@example.com\""
            },
            "76": {
                "beforePatchRowNumber": 202,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        test_setting.save()"
            },
            "77": {
                "beforePatchRowNumber": 203,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user.is_superuser = False"
            },
            "78": {
                "beforePatchRowNumber": 204,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user.save()"
            },
            "79": {
                "beforePatchRowNumber": 205,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "80": {
                "beforePatchRowNumber": 206,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user.user_permissions.add("
            },
            "81": {
                "beforePatchRowNumber": 207,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            Permission.objects.get(codename=\"can_edit_sensitive_email_generic_setting\")"
            },
            "82": {
                "beforePatchRowNumber": 208,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        )"
            },
            "83": {
                "beforePatchRowNumber": 209,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "84": {
                "beforePatchRowNumber": 210,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        response = self.get(setting=TestPermissionedGenericSetting)"
            },
            "85": {
                "beforePatchRowNumber": 211,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertEqual(response.status_code, 200)"
            },
            "86": {
                "beforePatchRowNumber": 212,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertIn(\"sensitive_email\", list(response.context[\"form\"].fields))"
            },
            "87": {
                "beforePatchRowNumber": 213,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "88": {
                "beforePatchRowNumber": 214,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        response = self.post("
            },
            "89": {
                "beforePatchRowNumber": 215,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            setting=TestPermissionedGenericSetting,"
            },
            "90": {
                "beforePatchRowNumber": 216,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            post_data={\"sensitive_email\": \"test-updated@example.com\", \"title\": \"title\"},"
            },
            "91": {
                "beforePatchRowNumber": 217,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        )"
            },
            "92": {
                "beforePatchRowNumber": 218,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertEqual(response.status_code, 302)"
            },
            "93": {
                "beforePatchRowNumber": 219,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "94": {
                "beforePatchRowNumber": 220,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        test_setting.refresh_from_db()"
            },
            "95": {
                "beforePatchRowNumber": 221,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertEqual(test_setting.sensitive_email, \"test-updated@example.com\")"
            },
            "96": {
                "beforePatchRowNumber": 222,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "97": {
                "beforePatchRowNumber": 223,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    def test_edit_restricted_field_without_permission(self):"
            },
            "98": {
                "beforePatchRowNumber": 224,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        test_setting = TestPermissionedGenericSetting()"
            },
            "99": {
                "beforePatchRowNumber": 225,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        test_setting.sensitive_email = \"test@example.com\""
            },
            "100": {
                "beforePatchRowNumber": 226,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        test_setting.save()"
            },
            "101": {
                "beforePatchRowNumber": 227,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user.is_superuser = False"
            },
            "102": {
                "beforePatchRowNumber": 228,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user.save()"
            },
            "103": {
                "beforePatchRowNumber": 229,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "104": {
                "beforePatchRowNumber": 230,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        response = self.get(setting=TestPermissionedGenericSetting)"
            },
            "105": {
                "beforePatchRowNumber": 231,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertEqual(response.status_code, 200)"
            },
            "106": {
                "beforePatchRowNumber": 232,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertNotIn(\"sensitive_email\", list(response.context[\"form\"].fields))"
            },
            "107": {
                "beforePatchRowNumber": 233,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "108": {
                "beforePatchRowNumber": 234,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        response = self.post("
            },
            "109": {
                "beforePatchRowNumber": 235,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            setting=TestPermissionedGenericSetting,"
            },
            "110": {
                "beforePatchRowNumber": 236,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            post_data={\"sensitive_email\": \"test-updated@example.com\", \"title\": \"title\"},"
            },
            "111": {
                "beforePatchRowNumber": 237,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        )"
            },
            "112": {
                "beforePatchRowNumber": 238,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertEqual(response.status_code, 302)"
            },
            "113": {
                "beforePatchRowNumber": 239,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "114": {
                "beforePatchRowNumber": 240,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        test_setting.refresh_from_db()"
            },
            "115": {
                "beforePatchRowNumber": 241,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertEqual(test_setting.sensitive_email, \"test@example.com\")"
            },
            "116": {
                "beforePatchRowNumber": 242,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "117": {
                "beforePatchRowNumber": 243,
                "afterPatchRowNumber": 156,
                "PatchRowcode": " "
            },
            "118": {
                "beforePatchRowNumber": 244,
                "afterPatchRowNumber": 157,
                "PatchRowcode": " class TestAdminPermission(WagtailTestUtils, TestCase):"
            },
            "119": {
                "beforePatchRowNumber": 245,
                "afterPatchRowNumber": 158,
                "PatchRowcode": "     def test_registered_permission(self):"
            }
        },
        "frontPatchFile": [
            "from django.contrib.auth.models import Permission",
            "from django.test import TestCase",
            "from django.urls import reverse",
            "from django.utils.text import capfirst",
            "",
            "from wagtail import hooks",
            "from wagtail.admin.admin_url_finder import AdminURLFinder",
            "from wagtail.admin.panels import FieldPanel, ObjectList, TabbedInterface",
            "from wagtail.contrib.settings.registry import SettingMenuItem",
            "from wagtail.contrib.settings.views import get_setting_edit_handler",
            "from wagtail.test.testapp.models import (",
            "    FileGenericSetting,",
            "    IconGenericSetting,",
            "    PanelGenericSettings,",
            "    TabbedGenericSettings,",
            "    TestGenericSetting,",
            "    TestPermissionedGenericSetting,",
            ")",
            "from wagtail.test.utils import WagtailTestUtils",
            "",
            "",
            "class TestGenericSettingMenu(WagtailTestUtils, TestCase):",
            "    def login_only_admin(self):",
            "        \"\"\"Log in with a user that only has permission to access the admin\"\"\"",
            "        user = self.create_user(username=\"test\", password=\"password\")",
            "        user.user_permissions.add(",
            "            Permission.objects.get_by_natural_key(",
            "                codename=\"access_admin\", app_label=\"wagtailadmin\", model=\"admin\"",
            "            )",
            "        )",
            "        self.login(username=\"test\", password=\"password\")",
            "        return user",
            "",
            "    def test_menu_item_in_admin(self):",
            "        self.login()",
            "        response = self.client.get(reverse(\"wagtailadmin_home\"))",
            "",
            "        self.assertContains(response, capfirst(TestGenericSetting._meta.verbose_name))",
            "        self.assertContains(",
            "            response,",
            "            reverse(\"wagtailsettings:edit\", args=(\"tests\", \"testgenericsetting\")),",
            "        )",
            "",
            "    def test_menu_item_no_permissions(self):",
            "        self.login_only_admin()",
            "        response = self.client.get(reverse(\"wagtailadmin_home\"))",
            "",
            "        self.assertNotContains(response, TestGenericSetting._meta.verbose_name)",
            "        self.assertNotContains(",
            "            response,",
            "            reverse(\"wagtailsettings:edit\", args=(\"tests\", \"testgenericsetting\")),",
            "        )",
            "",
            "    def test_menu_item_icon(self):",
            "        menu_item = SettingMenuItem(",
            "            IconGenericSetting, icon=\"tag\", classname=\"test-class\"",
            "        )",
            "        self.assertEqual(menu_item.icon_name, \"tag\")",
            "        self.assertEqual(menu_item.classname, \"test-class\")",
            "",
            "",
            "class BaseTestGenericSettingView(WagtailTestUtils, TestCase):",
            "    def get(self, params={}, setting=TestGenericSetting):",
            "        url = self.edit_url(setting=setting)",
            "        return self.client.get(url, params)",
            "",
            "    def post(self, post_data={}, setting=TestGenericSetting):",
            "        url = self.edit_url(setting=setting)",
            "        return self.client.post(url, post_data)",
            "",
            "    def edit_url(self, setting):",
            "        pk = setting._get_or_create().pk",
            "        args = [setting._meta.app_label, setting._meta.model_name, pk]",
            "        return reverse(\"wagtailsettings:edit\", args=args)",
            "",
            "",
            "class TestGenericSettingCreateView(BaseTestGenericSettingView):",
            "    def setUp(self):",
            "        self.user = self.login()",
            "        self.user.user_permissions.add(",
            "            Permission.objects.get(",
            "                content_type__app_label=\"wagtailadmin\", codename=\"access_admin\"",
            "            )",
            "        )",
            "",
            "    def test_get_edit(self):",
            "        response = self.get()",
            "        self.assertEqual(response.status_code, 200)",
            "",
            "    def test_edit_invalid(self):",
            "        response = self.post(post_data={\"foo\": \"bar\"})",
            "        self.assertContains(response, \"The setting could not be saved due to errors.\")",
            "        self.assertContains(response, \"This field is required\", count=2)",
            "",
            "    def test_edit(self):",
            "        response = self.post(",
            "            post_data={",
            "                \"title\": \"Edited setting title\",",
            "                \"email\": \"edited.email@example.com\",",
            "            }",
            "        )",
            "        self.assertEqual(response.status_code, 302)",
            "",
            "        setting = TestGenericSetting.objects.first()",
            "        self.assertEqual(setting.title, \"Edited setting title\")",
            "",
            "        url_finder = AdminURLFinder(self.user)",
            "        expected_url = \"/admin/settings/tests/testgenericsetting/%d/\" % setting.pk",
            "        self.assertEqual(url_finder.get_edit_url(setting), expected_url)",
            "",
            "    def test_file_upload_multipart(self):",
            "        response = self.get(setting=FileGenericSetting)",
            "        # Ensure the form supports file uploads",
            "        self.assertContains(response, 'enctype=\"multipart/form-data\"')",
            "",
            "    def test_create_restricted_field_without_permission(self):",
            "        self.user.is_superuser = False",
            "        self.user.save()",
            "",
            "        self.assertFalse(TestPermissionedGenericSetting.objects.exists())",
            "        response = self.post(",
            "            post_data={\"sensitive_email\": \"test@example.com\", \"title\": \"test\"},",
            "            setting=TestPermissionedGenericSetting,",
            "        )",
            "        self.assertEqual(response.status_code, 302)",
            "",
            "        settings = TestPermissionedGenericSetting.objects.get()",
            "        self.assertEqual(settings.title, \"test\")",
            "        self.assertEqual(settings.sensitive_email, \"\")",
            "",
            "    def test_create_restricted_field(self):",
            "        self.user.is_superuser = False",
            "        self.user.save()",
            "        self.user.user_permissions.add(",
            "            Permission.objects.get(codename=\"can_edit_sensitive_email_generic_setting\")",
            "        )",
            "        self.assertFalse(TestPermissionedGenericSetting.objects.exists())",
            "        response = self.post(",
            "            post_data={\"sensitive_email\": \"test@example.com\", \"title\": \"test\"},",
            "            setting=TestPermissionedGenericSetting,",
            "        )",
            "        self.assertEqual(response.status_code, 302)",
            "",
            "        settings = TestPermissionedGenericSetting.objects.get()",
            "        self.assertEqual(settings.title, \"test\")",
            "        self.assertEqual(settings.sensitive_email, \"test@example.com\")",
            "",
            "",
            "class TestGenericSettingEditView(BaseTestGenericSettingView):",
            "    def setUp(self):",
            "        self.test_setting = TestGenericSetting()",
            "        self.test_setting.title = \"Setting title\"",
            "        self.test_setting.save()",
            "",
            "        self.user = self.login()",
            "        self.user.user_permissions.add(",
            "            Permission.objects.get(",
            "                content_type__app_label=\"wagtailadmin\", codename=\"access_admin\"",
            "            )",
            "        )",
            "",
            "    def test_get_edit(self):",
            "        response = self.get()",
            "        self.assertEqual(response.status_code, 200)",
            "",
            "    def test_non_existent_model(self):",
            "        response = self.client.get(",
            "            reverse(\"wagtailsettings:edit\", args=[\"test\", \"foo\", 1])",
            "        )",
            "        self.assertEqual(response.status_code, 404)",
            "",
            "    def test_edit_invalid(self):",
            "        response = self.post(post_data={\"foo\": \"bar\"})",
            "        self.assertContains(response, \"The setting could not be saved due to errors.\")",
            "        self.assertContains(response, \"This field is required\", count=2)",
            "",
            "    def test_edit(self):",
            "        response = self.post(",
            "            post_data={",
            "                \"title\": \"Edited setting title\",",
            "                \"email\": \"different.email@example.com\",",
            "            }",
            "        )",
            "        self.assertEqual(response.status_code, 302)",
            "",
            "        setting = TestGenericSetting.objects.first()",
            "        self.assertEqual(setting.title, \"Edited setting title\")",
            "",
            "    def test_for_request(self):",
            "        url = reverse(\"wagtailsettings:edit\", args=(\"tests\", \"testgenericsetting\"))",
            "",
            "        response = self.client.get(url)",
            "        self.assertRedirects(",
            "            response,",
            "            status_code=302,",
            "            expected_url=f\"{url}{TestGenericSetting.objects.first().pk}/\",",
            "        )",
            "",
            "    def test_edit_restricted_field(self):",
            "        test_setting = TestPermissionedGenericSetting()",
            "        test_setting.sensitive_email = \"test@example.com\"",
            "        test_setting.save()",
            "        self.user.is_superuser = False",
            "        self.user.save()",
            "",
            "        self.user.user_permissions.add(",
            "            Permission.objects.get(codename=\"can_edit_sensitive_email_generic_setting\")",
            "        )",
            "",
            "        response = self.get(setting=TestPermissionedGenericSetting)",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertIn(\"sensitive_email\", list(response.context[\"form\"].fields))",
            "",
            "        response = self.post(",
            "            setting=TestPermissionedGenericSetting,",
            "            post_data={\"sensitive_email\": \"test-updated@example.com\", \"title\": \"title\"},",
            "        )",
            "        self.assertEqual(response.status_code, 302)",
            "",
            "        test_setting.refresh_from_db()",
            "        self.assertEqual(test_setting.sensitive_email, \"test-updated@example.com\")",
            "",
            "    def test_edit_restricted_field_without_permission(self):",
            "        test_setting = TestPermissionedGenericSetting()",
            "        test_setting.sensitive_email = \"test@example.com\"",
            "        test_setting.save()",
            "        self.user.is_superuser = False",
            "        self.user.save()",
            "",
            "        response = self.get(setting=TestPermissionedGenericSetting)",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertNotIn(\"sensitive_email\", list(response.context[\"form\"].fields))",
            "",
            "        response = self.post(",
            "            setting=TestPermissionedGenericSetting,",
            "            post_data={\"sensitive_email\": \"test-updated@example.com\", \"title\": \"title\"},",
            "        )",
            "        self.assertEqual(response.status_code, 302)",
            "",
            "        test_setting.refresh_from_db()",
            "        self.assertEqual(test_setting.sensitive_email, \"test@example.com\")",
            "",
            "",
            "class TestAdminPermission(WagtailTestUtils, TestCase):",
            "    def test_registered_permission(self):",
            "        permission = Permission.objects.get_by_natural_key(",
            "            app_label=\"tests\",",
            "            model=\"testgenericsetting\",",
            "            codename=\"change_testgenericsetting\",",
            "        )",
            "        for fn in hooks.get_hooks(\"register_permissions\"):",
            "            if permission in fn():",
            "                break",
            "        else:",
            "            self.fail(\"Change permission for tests.TestGenericSetting not registered\")",
            "",
            "",
            "class TestEditHandlers(TestCase):",
            "    def setUp(self):",
            "        get_setting_edit_handler.cache_clear()",
            "",
            "    def test_default_model_introspection(self):",
            "        handler = get_setting_edit_handler(TestGenericSetting)",
            "        self.assertIsInstance(handler, ObjectList)",
            "        self.assertEqual(len(handler.children), 2)",
            "        first = handler.children[0]",
            "        self.assertIsInstance(first, FieldPanel)",
            "        self.assertEqual(first.field_name, \"title\")",
            "        second = handler.children[1]",
            "        self.assertIsInstance(second, FieldPanel)",
            "        self.assertEqual(second.field_name, \"email\")",
            "",
            "    def test_with_custom_panels(self):",
            "        handler = get_setting_edit_handler(PanelGenericSettings)",
            "        self.assertIsInstance(handler, ObjectList)",
            "        self.assertEqual(len(handler.children), 1)",
            "        first = handler.children[0]",
            "        self.assertIsInstance(first, FieldPanel)",
            "        self.assertEqual(first.field_name, \"title\")",
            "",
            "    def test_with_custom_edit_handler(self):",
            "        handler = get_setting_edit_handler(TabbedGenericSettings)",
            "        self.assertIsInstance(handler, TabbedInterface)",
            "        self.assertEqual(len(handler.children), 2)"
        ],
        "afterPatchFile": [
            "from django.contrib.auth.models import Permission",
            "from django.test import TestCase",
            "from django.urls import reverse",
            "from django.utils.text import capfirst",
            "",
            "from wagtail import hooks",
            "from wagtail.admin.admin_url_finder import AdminURLFinder",
            "from wagtail.admin.panels import FieldPanel, ObjectList, TabbedInterface",
            "from wagtail.contrib.settings.registry import SettingMenuItem",
            "from wagtail.contrib.settings.views import get_setting_edit_handler",
            "from wagtail.test.testapp.models import (",
            "    FileGenericSetting,",
            "    IconGenericSetting,",
            "    PanelGenericSettings,",
            "    TabbedGenericSettings,",
            "    TestGenericSetting,",
            ")",
            "from wagtail.test.utils import WagtailTestUtils",
            "",
            "",
            "class TestGenericSettingMenu(WagtailTestUtils, TestCase):",
            "    def login_only_admin(self):",
            "        \"\"\"Log in with a user that only has permission to access the admin\"\"\"",
            "        user = self.create_user(username=\"test\", password=\"password\")",
            "        user.user_permissions.add(",
            "            Permission.objects.get_by_natural_key(",
            "                codename=\"access_admin\", app_label=\"wagtailadmin\", model=\"admin\"",
            "            )",
            "        )",
            "        self.login(username=\"test\", password=\"password\")",
            "        return user",
            "",
            "    def test_menu_item_in_admin(self):",
            "        self.login()",
            "        response = self.client.get(reverse(\"wagtailadmin_home\"))",
            "",
            "        self.assertContains(response, capfirst(TestGenericSetting._meta.verbose_name))",
            "        self.assertContains(",
            "            response,",
            "            reverse(\"wagtailsettings:edit\", args=(\"tests\", \"testgenericsetting\")),",
            "        )",
            "",
            "    def test_menu_item_no_permissions(self):",
            "        self.login_only_admin()",
            "        response = self.client.get(reverse(\"wagtailadmin_home\"))",
            "",
            "        self.assertNotContains(response, TestGenericSetting._meta.verbose_name)",
            "        self.assertNotContains(",
            "            response,",
            "            reverse(\"wagtailsettings:edit\", args=(\"tests\", \"testgenericsetting\")),",
            "        )",
            "",
            "    def test_menu_item_icon(self):",
            "        menu_item = SettingMenuItem(",
            "            IconGenericSetting, icon=\"tag\", classname=\"test-class\"",
            "        )",
            "        self.assertEqual(menu_item.icon_name, \"tag\")",
            "        self.assertEqual(menu_item.classname, \"test-class\")",
            "",
            "",
            "class BaseTestGenericSettingView(WagtailTestUtils, TestCase):",
            "    def get(self, params={}, setting=TestGenericSetting):",
            "        url = self.edit_url(setting=setting)",
            "        return self.client.get(url, params)",
            "",
            "    def post(self, post_data={}, setting=TestGenericSetting):",
            "        url = self.edit_url(setting=setting)",
            "        return self.client.post(url, post_data)",
            "",
            "    def edit_url(self, setting):",
            "        pk = setting._get_or_create().pk",
            "        args = [setting._meta.app_label, setting._meta.model_name, pk]",
            "        return reverse(\"wagtailsettings:edit\", args=args)",
            "",
            "",
            "class TestGenericSettingCreateView(BaseTestGenericSettingView):",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    def test_get_edit(self):",
            "        response = self.get()",
            "        self.assertEqual(response.status_code, 200)",
            "",
            "    def test_edit_invalid(self):",
            "        response = self.post(post_data={\"foo\": \"bar\"})",
            "        self.assertContains(response, \"The setting could not be saved due to errors.\")",
            "        self.assertContains(response, \"This field is required\", count=2)",
            "",
            "    def test_edit(self):",
            "        response = self.post(",
            "            post_data={",
            "                \"title\": \"Edited setting title\",",
            "                \"email\": \"edited.email@example.com\",",
            "            }",
            "        )",
            "        self.assertEqual(response.status_code, 302)",
            "",
            "        setting = TestGenericSetting.objects.first()",
            "        self.assertEqual(setting.title, \"Edited setting title\")",
            "",
            "        url_finder = AdminURLFinder(self.user)",
            "        expected_url = \"/admin/settings/tests/testgenericsetting/%d/\" % setting.pk",
            "        self.assertEqual(url_finder.get_edit_url(setting), expected_url)",
            "",
            "    def test_file_upload_multipart(self):",
            "        response = self.get(setting=FileGenericSetting)",
            "        # Ensure the form supports file uploads",
            "        self.assertContains(response, 'enctype=\"multipart/form-data\"')",
            "",
            "",
            "class TestGenericSettingEditView(BaseTestGenericSettingView):",
            "    def setUp(self):",
            "        self.test_setting = TestGenericSetting()",
            "        self.test_setting.title = \"Setting title\"",
            "        self.test_setting.save()",
            "",
            "        self.login()",
            "",
            "    def test_get_edit(self):",
            "        response = self.get()",
            "        self.assertEqual(response.status_code, 200)",
            "",
            "    def test_non_existent_model(self):",
            "        response = self.client.get(",
            "            reverse(\"wagtailsettings:edit\", args=[\"test\", \"foo\", 1])",
            "        )",
            "        self.assertEqual(response.status_code, 404)",
            "",
            "    def test_edit_invalid(self):",
            "        response = self.post(post_data={\"foo\": \"bar\"})",
            "        self.assertContains(response, \"The setting could not be saved due to errors.\")",
            "        self.assertContains(response, \"This field is required\", count=2)",
            "",
            "    def test_edit(self):",
            "        response = self.post(",
            "            post_data={",
            "                \"title\": \"Edited setting title\",",
            "                \"email\": \"different.email@example.com\",",
            "            }",
            "        )",
            "        self.assertEqual(response.status_code, 302)",
            "",
            "        setting = TestGenericSetting.objects.first()",
            "        self.assertEqual(setting.title, \"Edited setting title\")",
            "",
            "    def test_for_request(self):",
            "        url = reverse(\"wagtailsettings:edit\", args=(\"tests\", \"testgenericsetting\"))",
            "",
            "        response = self.client.get(url)",
            "        self.assertRedirects(",
            "            response,",
            "            status_code=302,",
            "            expected_url=f\"{url}{TestGenericSetting.objects.first().pk}/\",",
            "        )",
            "",
            "",
            "class TestAdminPermission(WagtailTestUtils, TestCase):",
            "    def test_registered_permission(self):",
            "        permission = Permission.objects.get_by_natural_key(",
            "            app_label=\"tests\",",
            "            model=\"testgenericsetting\",",
            "            codename=\"change_testgenericsetting\",",
            "        )",
            "        for fn in hooks.get_hooks(\"register_permissions\"):",
            "            if permission in fn():",
            "                break",
            "        else:",
            "            self.fail(\"Change permission for tests.TestGenericSetting not registered\")",
            "",
            "",
            "class TestEditHandlers(TestCase):",
            "    def setUp(self):",
            "        get_setting_edit_handler.cache_clear()",
            "",
            "    def test_default_model_introspection(self):",
            "        handler = get_setting_edit_handler(TestGenericSetting)",
            "        self.assertIsInstance(handler, ObjectList)",
            "        self.assertEqual(len(handler.children), 2)",
            "        first = handler.children[0]",
            "        self.assertIsInstance(first, FieldPanel)",
            "        self.assertEqual(first.field_name, \"title\")",
            "        second = handler.children[1]",
            "        self.assertIsInstance(second, FieldPanel)",
            "        self.assertEqual(second.field_name, \"email\")",
            "",
            "    def test_with_custom_panels(self):",
            "        handler = get_setting_edit_handler(PanelGenericSettings)",
            "        self.assertIsInstance(handler, ObjectList)",
            "        self.assertEqual(len(handler.children), 1)",
            "        first = handler.children[0]",
            "        self.assertIsInstance(first, FieldPanel)",
            "        self.assertEqual(first.field_name, \"title\")",
            "",
            "    def test_with_custom_edit_handler(self):",
            "        handler = get_setting_edit_handler(TabbedGenericSettings)",
            "        self.assertIsInstance(handler, TabbedInterface)",
            "        self.assertEqual(len(handler.children), 2)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "1",
            "1",
            "1",
            "1",
            "1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "17": [],
            "80": [
                "TestGenericSettingCreateView",
                "setUp"
            ],
            "81": [
                "TestGenericSettingCreateView",
                "setUp"
            ],
            "82": [
                "TestGenericSettingCreateView",
                "setUp"
            ],
            "83": [
                "TestGenericSettingCreateView",
                "setUp"
            ],
            "84": [
                "TestGenericSettingCreateView",
                "setUp"
            ],
            "116": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field_without_permission"
            ],
            "117": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field_without_permission"
            ],
            "118": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field_without_permission"
            ],
            "119": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field_without_permission"
            ],
            "120": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field_without_permission"
            ],
            "121": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field_without_permission"
            ],
            "122": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field_without_permission"
            ],
            "123": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field_without_permission"
            ],
            "124": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field_without_permission"
            ],
            "125": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field_without_permission"
            ],
            "126": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field_without_permission"
            ],
            "127": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field_without_permission"
            ],
            "128": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field_without_permission"
            ],
            "129": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field_without_permission"
            ],
            "130": [
                "TestGenericSettingCreateView"
            ],
            "131": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field"
            ],
            "132": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field"
            ],
            "133": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field"
            ],
            "134": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field"
            ],
            "135": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field"
            ],
            "136": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field"
            ],
            "137": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field"
            ],
            "138": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field"
            ],
            "139": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field"
            ],
            "140": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field"
            ],
            "141": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field"
            ],
            "142": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field"
            ],
            "143": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field"
            ],
            "144": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field"
            ],
            "145": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field"
            ],
            "146": [
                "TestGenericSettingCreateView",
                "test_create_restricted_field"
            ],
            "147": [],
            "155": [
                "TestGenericSettingEditView",
                "setUp"
            ],
            "156": [
                "TestGenericSettingEditView",
                "setUp"
            ],
            "157": [
                "TestGenericSettingEditView",
                "setUp"
            ],
            "158": [
                "TestGenericSettingEditView",
                "setUp"
            ],
            "159": [
                "TestGenericSettingEditView",
                "setUp"
            ],
            "160": [
                "TestGenericSettingEditView",
                "setUp"
            ],
            "199": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field"
            ],
            "200": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field"
            ],
            "201": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field"
            ],
            "202": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field"
            ],
            "203": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field"
            ],
            "204": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field"
            ],
            "205": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field"
            ],
            "206": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field"
            ],
            "207": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field"
            ],
            "208": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field"
            ],
            "209": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field"
            ],
            "210": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field"
            ],
            "211": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field"
            ],
            "212": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field"
            ],
            "213": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field"
            ],
            "214": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field"
            ],
            "215": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field"
            ],
            "216": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field"
            ],
            "217": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field"
            ],
            "218": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field"
            ],
            "219": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field"
            ],
            "220": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field"
            ],
            "221": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field"
            ],
            "222": [
                "TestGenericSettingEditView"
            ],
            "223": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "224": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "225": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "226": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "227": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "228": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "229": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "230": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "231": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "232": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "233": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "234": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "235": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "236": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "237": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "238": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "239": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "240": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "241": [
                "TestGenericSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "242": []
        },
        "addLocation": []
    },
    "wagtail/contrib/settings/tests/site_specific/test_admin.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 14,
                "afterPatchRowNumber": 14,
                "PatchRowcode": "     IconSiteSetting,"
            },
            "1": {
                "beforePatchRowNumber": 15,
                "afterPatchRowNumber": 15,
                "PatchRowcode": "     PanelSiteSettings,"
            },
            "2": {
                "beforePatchRowNumber": 16,
                "afterPatchRowNumber": 16,
                "PatchRowcode": "     TabbedSiteSettings,"
            },
            "3": {
                "beforePatchRowNumber": 17,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    TestPermissionedSiteSetting,"
            },
            "4": {
                "beforePatchRowNumber": 18,
                "afterPatchRowNumber": 17,
                "PatchRowcode": "     TestSiteSetting,"
            },
            "5": {
                "beforePatchRowNumber": 19,
                "afterPatchRowNumber": 18,
                "PatchRowcode": " )"
            },
            "6": {
                "beforePatchRowNumber": 20,
                "afterPatchRowNumber": 19,
                "PatchRowcode": " from wagtail.test.utils import WagtailTestUtils"
            },
            "7": {
                "beforePatchRowNumber": 73,
                "afterPatchRowNumber": 72,
                "PatchRowcode": " class TestSiteSettingCreateView(BaseTestSiteSettingView):"
            },
            "8": {
                "beforePatchRowNumber": 74,
                "afterPatchRowNumber": 73,
                "PatchRowcode": "     def setUp(self):"
            },
            "9": {
                "beforePatchRowNumber": 75,
                "afterPatchRowNumber": 74,
                "PatchRowcode": "         self.user = self.login()"
            },
            "10": {
                "beforePatchRowNumber": 76,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user.user_permissions.add("
            },
            "11": {
                "beforePatchRowNumber": 77,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            Permission.objects.get("
            },
            "12": {
                "beforePatchRowNumber": 78,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                content_type__app_label=\"wagtailadmin\", codename=\"access_admin\""
            },
            "13": {
                "beforePatchRowNumber": 79,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            )"
            },
            "14": {
                "beforePatchRowNumber": 80,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        )"
            },
            "15": {
                "beforePatchRowNumber": 81,
                "afterPatchRowNumber": 75,
                "PatchRowcode": " "
            },
            "16": {
                "beforePatchRowNumber": 82,
                "afterPatchRowNumber": 76,
                "PatchRowcode": "     def test_get_edit(self):"
            },
            "17": {
                "beforePatchRowNumber": 83,
                "afterPatchRowNumber": 77,
                "PatchRowcode": "         response = self.get()"
            },
            "18": {
                "beforePatchRowNumber": 109,
                "afterPatchRowNumber": 103,
                "PatchRowcode": "         # Ensure the form supports file uploads"
            },
            "19": {
                "beforePatchRowNumber": 110,
                "afterPatchRowNumber": 104,
                "PatchRowcode": "         self.assertContains(response, 'enctype=\"multipart/form-data\"')"
            },
            "20": {
                "beforePatchRowNumber": 111,
                "afterPatchRowNumber": 105,
                "PatchRowcode": " "
            },
            "21": {
                "beforePatchRowNumber": 112,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    def test_create_restricted_field_without_permission(self):"
            },
            "22": {
                "beforePatchRowNumber": 113,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user.is_superuser = False"
            },
            "23": {
                "beforePatchRowNumber": 114,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user.save()"
            },
            "24": {
                "beforePatchRowNumber": 115,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "25": {
                "beforePatchRowNumber": 116,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertFalse(TestPermissionedSiteSetting.objects.exists())"
            },
            "26": {
                "beforePatchRowNumber": 117,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        response = self.post("
            },
            "27": {
                "beforePatchRowNumber": 118,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            post_data={\"sensitive_email\": \"test@example.com\", \"title\": \"test\"},"
            },
            "28": {
                "beforePatchRowNumber": 119,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            setting=TestPermissionedSiteSetting,"
            },
            "29": {
                "beforePatchRowNumber": 120,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        )"
            },
            "30": {
                "beforePatchRowNumber": 121,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertEqual(response.status_code, 302)"
            },
            "31": {
                "beforePatchRowNumber": 122,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "32": {
                "beforePatchRowNumber": 123,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        settings = TestPermissionedSiteSetting.objects.get()"
            },
            "33": {
                "beforePatchRowNumber": 124,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertEqual(settings.title, \"test\")"
            },
            "34": {
                "beforePatchRowNumber": 125,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertEqual(settings.sensitive_email, \"\")"
            },
            "35": {
                "beforePatchRowNumber": 126,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "36": {
                "beforePatchRowNumber": 127,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    def test_create_restricted_field(self):"
            },
            "37": {
                "beforePatchRowNumber": 128,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user.is_superuser = False"
            },
            "38": {
                "beforePatchRowNumber": 129,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user.save()"
            },
            "39": {
                "beforePatchRowNumber": 130,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user.user_permissions.add("
            },
            "40": {
                "beforePatchRowNumber": 131,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            Permission.objects.get(codename=\"can_edit_sensitive_email_site_setting\")"
            },
            "41": {
                "beforePatchRowNumber": 132,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        )"
            },
            "42": {
                "beforePatchRowNumber": 133,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertFalse(TestPermissionedSiteSetting.objects.exists())"
            },
            "43": {
                "beforePatchRowNumber": 134,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        response = self.post("
            },
            "44": {
                "beforePatchRowNumber": 135,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            post_data={\"sensitive_email\": \"test@example.com\", \"title\": \"test\"},"
            },
            "45": {
                "beforePatchRowNumber": 136,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            setting=TestPermissionedSiteSetting,"
            },
            "46": {
                "beforePatchRowNumber": 137,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        )"
            },
            "47": {
                "beforePatchRowNumber": 138,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertEqual(response.status_code, 302)"
            },
            "48": {
                "beforePatchRowNumber": 139,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "49": {
                "beforePatchRowNumber": 140,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        settings = TestPermissionedSiteSetting.objects.get()"
            },
            "50": {
                "beforePatchRowNumber": 141,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertEqual(settings.title, \"test\")"
            },
            "51": {
                "beforePatchRowNumber": 142,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertEqual(settings.sensitive_email, \"test@example.com\")"
            },
            "52": {
                "beforePatchRowNumber": 143,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "53": {
                "beforePatchRowNumber": 144,
                "afterPatchRowNumber": 106,
                "PatchRowcode": " "
            },
            "54": {
                "beforePatchRowNumber": 145,
                "afterPatchRowNumber": 107,
                "PatchRowcode": " class TestSiteSettingEditView(BaseTestSiteSettingView):"
            },
            "55": {
                "beforePatchRowNumber": 146,
                "afterPatchRowNumber": 108,
                "PatchRowcode": "     def setUp(self):"
            },
            "56": {
                "beforePatchRowNumber": 147,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.default_site = Site.objects.get(is_default_site=True)"
            },
            "57": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 109,
                "PatchRowcode": "+        default_site = Site.objects.get(is_default_site=True)"
            },
            "58": {
                "beforePatchRowNumber": 148,
                "afterPatchRowNumber": 110,
                "PatchRowcode": " "
            },
            "59": {
                "beforePatchRowNumber": 149,
                "afterPatchRowNumber": 111,
                "PatchRowcode": "         self.test_setting = TestSiteSetting()"
            },
            "60": {
                "beforePatchRowNumber": 150,
                "afterPatchRowNumber": 112,
                "PatchRowcode": "         self.test_setting.title = \"Site title\""
            },
            "61": {
                "beforePatchRowNumber": 151,
                "afterPatchRowNumber": 113,
                "PatchRowcode": "         self.test_setting.email = \"initial@example.com\""
            },
            "62": {
                "beforePatchRowNumber": 152,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.test_setting.site = self.default_site"
            },
            "63": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 114,
                "PatchRowcode": "+        self.test_setting.site = default_site"
            },
            "64": {
                "beforePatchRowNumber": 153,
                "afterPatchRowNumber": 115,
                "PatchRowcode": "         self.test_setting.save()"
            },
            "65": {
                "beforePatchRowNumber": 154,
                "afterPatchRowNumber": 116,
                "PatchRowcode": " "
            },
            "66": {
                "beforePatchRowNumber": 155,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user = self.login()"
            },
            "67": {
                "beforePatchRowNumber": 156,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user.user_permissions.add("
            },
            "68": {
                "beforePatchRowNumber": 157,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            Permission.objects.get("
            },
            "69": {
                "beforePatchRowNumber": 158,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                content_type__app_label=\"wagtailadmin\", codename=\"access_admin\""
            },
            "70": {
                "beforePatchRowNumber": 159,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            )"
            },
            "71": {
                "beforePatchRowNumber": 160,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        )"
            },
            "72": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 117,
                "PatchRowcode": "+        self.login()"
            },
            "73": {
                "beforePatchRowNumber": 161,
                "afterPatchRowNumber": 118,
                "PatchRowcode": " "
            },
            "74": {
                "beforePatchRowNumber": 162,
                "afterPatchRowNumber": 119,
                "PatchRowcode": "     def test_get_edit(self):"
            },
            "75": {
                "beforePatchRowNumber": 163,
                "afterPatchRowNumber": 120,
                "PatchRowcode": "         response = self.get()"
            },
            "76": {
                "beforePatchRowNumber": 201,
                "afterPatchRowNumber": 158,
                "PatchRowcode": "         response = self.client.get(url)"
            },
            "77": {
                "beforePatchRowNumber": 202,
                "afterPatchRowNumber": 159,
                "PatchRowcode": "         self.assertRedirects(response, status_code=302, expected_url=\"/admin/\")"
            },
            "78": {
                "beforePatchRowNumber": 203,
                "afterPatchRowNumber": 160,
                "PatchRowcode": " "
            },
            "79": {
                "beforePatchRowNumber": 204,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    def test_edit_restricted_field(self):"
            },
            "80": {
                "beforePatchRowNumber": 205,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        test_setting = TestPermissionedSiteSetting()"
            },
            "81": {
                "beforePatchRowNumber": 206,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        test_setting.sensitive_email = \"test@example.com\""
            },
            "82": {
                "beforePatchRowNumber": 207,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        test_setting.site = self.default_site"
            },
            "83": {
                "beforePatchRowNumber": 208,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        test_setting.save()"
            },
            "84": {
                "beforePatchRowNumber": 209,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user.is_superuser = False"
            },
            "85": {
                "beforePatchRowNumber": 210,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user.save()"
            },
            "86": {
                "beforePatchRowNumber": 211,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "87": {
                "beforePatchRowNumber": 212,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user.user_permissions.add("
            },
            "88": {
                "beforePatchRowNumber": 213,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            Permission.objects.get(codename=\"can_edit_sensitive_email_site_setting\")"
            },
            "89": {
                "beforePatchRowNumber": 214,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        )"
            },
            "90": {
                "beforePatchRowNumber": 215,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "91": {
                "beforePatchRowNumber": 216,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        response = self.get(setting=TestPermissionedSiteSetting)"
            },
            "92": {
                "beforePatchRowNumber": 217,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertEqual(response.status_code, 200)"
            },
            "93": {
                "beforePatchRowNumber": 218,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertIn(\"sensitive_email\", list(response.context[\"form\"].fields))"
            },
            "94": {
                "beforePatchRowNumber": 219,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "95": {
                "beforePatchRowNumber": 220,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        response = self.post("
            },
            "96": {
                "beforePatchRowNumber": 221,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            setting=TestPermissionedSiteSetting,"
            },
            "97": {
                "beforePatchRowNumber": 222,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            post_data={\"sensitive_email\": \"test-updated@example.com\", \"title\": \"title\"},"
            },
            "98": {
                "beforePatchRowNumber": 223,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        )"
            },
            "99": {
                "beforePatchRowNumber": 224,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertEqual(response.status_code, 302)"
            },
            "100": {
                "beforePatchRowNumber": 225,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "101": {
                "beforePatchRowNumber": 226,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        test_setting.refresh_from_db()"
            },
            "102": {
                "beforePatchRowNumber": 227,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertEqual(test_setting.sensitive_email, \"test-updated@example.com\")"
            },
            "103": {
                "beforePatchRowNumber": 228,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "104": {
                "beforePatchRowNumber": 229,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    def test_edit_restricted_field_without_permission(self):"
            },
            "105": {
                "beforePatchRowNumber": 230,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        test_setting = TestPermissionedSiteSetting()"
            },
            "106": {
                "beforePatchRowNumber": 231,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        test_setting.sensitive_email = \"test@example.com\""
            },
            "107": {
                "beforePatchRowNumber": 232,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        test_setting.site = self.default_site"
            },
            "108": {
                "beforePatchRowNumber": 233,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        test_setting.save()"
            },
            "109": {
                "beforePatchRowNumber": 234,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user.is_superuser = False"
            },
            "110": {
                "beforePatchRowNumber": 235,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.user.save()"
            },
            "111": {
                "beforePatchRowNumber": 236,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "112": {
                "beforePatchRowNumber": 237,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        response = self.get(setting=TestPermissionedSiteSetting)"
            },
            "113": {
                "beforePatchRowNumber": 238,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertEqual(response.status_code, 200)"
            },
            "114": {
                "beforePatchRowNumber": 239,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertNotIn(\"sensitive_email\", list(response.context[\"form\"].fields))"
            },
            "115": {
                "beforePatchRowNumber": 240,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "116": {
                "beforePatchRowNumber": 241,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        response = self.post("
            },
            "117": {
                "beforePatchRowNumber": 242,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            setting=TestPermissionedSiteSetting,"
            },
            "118": {
                "beforePatchRowNumber": 243,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            post_data={\"sensitive_email\": \"test-updated@example.com\", \"title\": \"title\"},"
            },
            "119": {
                "beforePatchRowNumber": 244,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        )"
            },
            "120": {
                "beforePatchRowNumber": 245,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertEqual(response.status_code, 302)"
            },
            "121": {
                "beforePatchRowNumber": 246,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "122": {
                "beforePatchRowNumber": 247,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        test_setting.refresh_from_db()"
            },
            "123": {
                "beforePatchRowNumber": 248,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertEqual(test_setting.sensitive_email, \"test@example.com\")"
            },
            "124": {
                "beforePatchRowNumber": 249,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "125": {
                "beforePatchRowNumber": 250,
                "afterPatchRowNumber": 161,
                "PatchRowcode": " "
            },
            "126": {
                "beforePatchRowNumber": 251,
                "afterPatchRowNumber": 162,
                "PatchRowcode": " @override_settings("
            },
            "127": {
                "beforePatchRowNumber": 252,
                "afterPatchRowNumber": 163,
                "PatchRowcode": "     ALLOWED_HOSTS=[\"testserver\", \"example.com\", \"noneoftheabove.example.com\"]"
            }
        },
        "frontPatchFile": [
            "from django.contrib.auth.models import Permission",
            "from django.test import TestCase, override_settings",
            "from django.urls import reverse",
            "from django.utils.text import capfirst",
            "",
            "from wagtail import hooks",
            "from wagtail.admin.admin_url_finder import AdminURLFinder",
            "from wagtail.admin.panels import FieldPanel, ObjectList, TabbedInterface",
            "from wagtail.contrib.settings.registry import SettingMenuItem",
            "from wagtail.contrib.settings.views import get_setting_edit_handler",
            "from wagtail.models import Page, Site",
            "from wagtail.test.testapp.models import (",
            "    FileSiteSetting,",
            "    IconSiteSetting,",
            "    PanelSiteSettings,",
            "    TabbedSiteSettings,",
            "    TestPermissionedSiteSetting,",
            "    TestSiteSetting,",
            ")",
            "from wagtail.test.utils import WagtailTestUtils",
            "",
            "",
            "class TestSiteSettingMenu(WagtailTestUtils, TestCase):",
            "    def login_only_admin(self):",
            "        \"\"\"Log in with a user that only has permission to access the admin\"\"\"",
            "        user = self.create_user(username=\"test\", password=\"password\")",
            "        user.user_permissions.add(",
            "            Permission.objects.get_by_natural_key(",
            "                codename=\"access_admin\", app_label=\"wagtailadmin\", model=\"admin\"",
            "            )",
            "        )",
            "        self.login(username=\"test\", password=\"password\")",
            "        return user",
            "",
            "    def test_menu_item_in_admin(self):",
            "        self.login()",
            "        response = self.client.get(reverse(\"wagtailadmin_home\"))",
            "",
            "        self.assertContains(response, capfirst(TestSiteSetting._meta.verbose_name))",
            "        self.assertContains(",
            "            response, reverse(\"wagtailsettings:edit\", args=(\"tests\", \"testsitesetting\"))",
            "        )",
            "",
            "    def test_menu_item_no_permissions(self):",
            "        self.login_only_admin()",
            "        response = self.client.get(reverse(\"wagtailadmin_home\"))",
            "",
            "        self.assertNotContains(response, TestSiteSetting._meta.verbose_name)",
            "        self.assertNotContains(",
            "            response, reverse(\"wagtailsettings:edit\", args=(\"tests\", \"testsitesetting\"))",
            "        )",
            "",
            "    def test_menu_item_icon(self):",
            "        menu_item = SettingMenuItem(IconSiteSetting, icon=\"tag\", classname=\"test-class\")",
            "        self.assertEqual(menu_item.icon_name, \"tag\")",
            "        self.assertEqual(menu_item.classname, \"test-class\")",
            "",
            "",
            "class BaseTestSiteSettingView(WagtailTestUtils, TestCase):",
            "    def get(self, site_pk=1, params={}, setting=TestSiteSetting):",
            "        url = self.edit_url(setting=setting, site_pk=site_pk)",
            "        return self.client.get(url, params)",
            "",
            "    def post(self, site_pk=1, post_data={}, setting=TestSiteSetting):",
            "        url = self.edit_url(setting=setting, site_pk=site_pk)",
            "        return self.client.post(url, post_data)",
            "",
            "    def edit_url(self, setting, site_pk=1):",
            "        args = [setting._meta.app_label, setting._meta.model_name, site_pk]",
            "        return reverse(\"wagtailsettings:edit\", args=args)",
            "",
            "",
            "class TestSiteSettingCreateView(BaseTestSiteSettingView):",
            "    def setUp(self):",
            "        self.user = self.login()",
            "        self.user.user_permissions.add(",
            "            Permission.objects.get(",
            "                content_type__app_label=\"wagtailadmin\", codename=\"access_admin\"",
            "            )",
            "        )",
            "",
            "    def test_get_edit(self):",
            "        response = self.get()",
            "        self.assertEqual(response.status_code, 200)",
            "",
            "    def test_edit_invalid(self):",
            "        response = self.post(post_data={\"foo\": \"bar\"})",
            "        self.assertContains(response, \"The setting could not be saved due to errors.\")",
            "        self.assertContains(response, \"error-message\", count=2)",
            "        self.assertContains(response, \"This field is required\", count=2)",
            "",
            "    def test_edit(self):",
            "        response = self.post(",
            "            post_data={\"title\": \"Edited site title\", \"email\": \"test@example.com\"}",
            "        )",
            "        self.assertEqual(response.status_code, 302)",
            "",
            "        default_site = Site.objects.get(is_default_site=True)",
            "        setting = TestSiteSetting.objects.get(site=default_site)",
            "        self.assertEqual(setting.title, \"Edited site title\")",
            "        self.assertEqual(setting.email, \"test@example.com\")",
            "",
            "        url_finder = AdminURLFinder(self.user)",
            "        expected_url = \"/admin/settings/tests/testsitesetting/%d/\" % default_site.pk",
            "        self.assertEqual(url_finder.get_edit_url(setting), expected_url)",
            "",
            "    def test_file_upload_multipart(self):",
            "        response = self.get(setting=FileSiteSetting)",
            "        # Ensure the form supports file uploads",
            "        self.assertContains(response, 'enctype=\"multipart/form-data\"')",
            "",
            "    def test_create_restricted_field_without_permission(self):",
            "        self.user.is_superuser = False",
            "        self.user.save()",
            "",
            "        self.assertFalse(TestPermissionedSiteSetting.objects.exists())",
            "        response = self.post(",
            "            post_data={\"sensitive_email\": \"test@example.com\", \"title\": \"test\"},",
            "            setting=TestPermissionedSiteSetting,",
            "        )",
            "        self.assertEqual(response.status_code, 302)",
            "",
            "        settings = TestPermissionedSiteSetting.objects.get()",
            "        self.assertEqual(settings.title, \"test\")",
            "        self.assertEqual(settings.sensitive_email, \"\")",
            "",
            "    def test_create_restricted_field(self):",
            "        self.user.is_superuser = False",
            "        self.user.save()",
            "        self.user.user_permissions.add(",
            "            Permission.objects.get(codename=\"can_edit_sensitive_email_site_setting\")",
            "        )",
            "        self.assertFalse(TestPermissionedSiteSetting.objects.exists())",
            "        response = self.post(",
            "            post_data={\"sensitive_email\": \"test@example.com\", \"title\": \"test\"},",
            "            setting=TestPermissionedSiteSetting,",
            "        )",
            "        self.assertEqual(response.status_code, 302)",
            "",
            "        settings = TestPermissionedSiteSetting.objects.get()",
            "        self.assertEqual(settings.title, \"test\")",
            "        self.assertEqual(settings.sensitive_email, \"test@example.com\")",
            "",
            "",
            "class TestSiteSettingEditView(BaseTestSiteSettingView):",
            "    def setUp(self):",
            "        self.default_site = Site.objects.get(is_default_site=True)",
            "",
            "        self.test_setting = TestSiteSetting()",
            "        self.test_setting.title = \"Site title\"",
            "        self.test_setting.email = \"initial@example.com\"",
            "        self.test_setting.site = self.default_site",
            "        self.test_setting.save()",
            "",
            "        self.user = self.login()",
            "        self.user.user_permissions.add(",
            "            Permission.objects.get(",
            "                content_type__app_label=\"wagtailadmin\", codename=\"access_admin\"",
            "            )",
            "        )",
            "",
            "    def test_get_edit(self):",
            "        response = self.get()",
            "        self.assertEqual(response.status_code, 200)",
            "",
            "    def test_non_existant_model(self):",
            "        response = self.client.get(",
            "            reverse(\"wagtailsettings:edit\", args=[\"test\", \"foo\", 1])",
            "        )",
            "        self.assertEqual(response.status_code, 404)",
            "",
            "    def test_edit_invalid(self):",
            "        response = self.post(post_data={\"foo\": \"bar\"})",
            "        self.assertContains(response, \"The setting could not be saved due to errors.\")",
            "        self.assertContains(response, \"error-message\", count=2)",
            "        self.assertContains(response, \"This field is required\", count=2)",
            "",
            "    def test_edit(self):",
            "        response = self.post(",
            "            post_data={\"title\": \"Edited site title\", \"email\": \"test@example.com\"}",
            "        )",
            "        self.assertEqual(response.status_code, 302)",
            "",
            "        default_site = Site.objects.get(is_default_site=True)",
            "        setting = TestSiteSetting.objects.get(site=default_site)",
            "        self.assertEqual(setting.title, \"Edited site title\")",
            "        self.assertEqual(setting.email, \"test@example.com\")",
            "",
            "    def test_get_redirect_to_relevant_instance(self):",
            "        url = reverse(\"wagtailsettings:edit\", args=(\"tests\", \"testsitesetting\"))",
            "        default_site = Site.objects.get(is_default_site=True)",
            "",
            "        response = self.client.get(url)",
            "        self.assertRedirects(",
            "            response, status_code=302, expected_url=f\"{url}{default_site.pk}/\"",
            "        )",
            "",
            "    def test_get_redirect_to_relevant_instance_invalid(self):",
            "        Site.objects.all().delete()",
            "        url = reverse(\"wagtailsettings:edit\", args=(\"tests\", \"testsitesetting\"))",
            "        response = self.client.get(url)",
            "        self.assertRedirects(response, status_code=302, expected_url=\"/admin/\")",
            "",
            "    def test_edit_restricted_field(self):",
            "        test_setting = TestPermissionedSiteSetting()",
            "        test_setting.sensitive_email = \"test@example.com\"",
            "        test_setting.site = self.default_site",
            "        test_setting.save()",
            "        self.user.is_superuser = False",
            "        self.user.save()",
            "",
            "        self.user.user_permissions.add(",
            "            Permission.objects.get(codename=\"can_edit_sensitive_email_site_setting\")",
            "        )",
            "",
            "        response = self.get(setting=TestPermissionedSiteSetting)",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertIn(\"sensitive_email\", list(response.context[\"form\"].fields))",
            "",
            "        response = self.post(",
            "            setting=TestPermissionedSiteSetting,",
            "            post_data={\"sensitive_email\": \"test-updated@example.com\", \"title\": \"title\"},",
            "        )",
            "        self.assertEqual(response.status_code, 302)",
            "",
            "        test_setting.refresh_from_db()",
            "        self.assertEqual(test_setting.sensitive_email, \"test-updated@example.com\")",
            "",
            "    def test_edit_restricted_field_without_permission(self):",
            "        test_setting = TestPermissionedSiteSetting()",
            "        test_setting.sensitive_email = \"test@example.com\"",
            "        test_setting.site = self.default_site",
            "        test_setting.save()",
            "        self.user.is_superuser = False",
            "        self.user.save()",
            "",
            "        response = self.get(setting=TestPermissionedSiteSetting)",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertNotIn(\"sensitive_email\", list(response.context[\"form\"].fields))",
            "",
            "        response = self.post(",
            "            setting=TestPermissionedSiteSetting,",
            "            post_data={\"sensitive_email\": \"test-updated@example.com\", \"title\": \"title\"},",
            "        )",
            "        self.assertEqual(response.status_code, 302)",
            "",
            "        test_setting.refresh_from_db()",
            "        self.assertEqual(test_setting.sensitive_email, \"test@example.com\")",
            "",
            "",
            "@override_settings(",
            "    ALLOWED_HOSTS=[\"testserver\", \"example.com\", \"noneoftheabove.example.com\"]",
            ")",
            "class TestMultiSite(BaseTestSiteSettingView):",
            "    def setUp(self):",
            "        self.default_site = Site.objects.get(is_default_site=True)",
            "        self.other_site = Site.objects.create(",
            "            hostname=\"example.com\", root_page=Page.objects.get(pk=2)",
            "        )",
            "        self.login()",
            "",
            "    def test_redirect_to_default(self):",
            "        \"\"\"",
            "        Should redirect to the setting for the default site.",
            "        \"\"\"",
            "        start_url = reverse(\"wagtailsettings:edit\", args=[\"tests\", \"testsitesetting\"])",
            "        dest_url = reverse(",
            "            \"wagtailsettings:edit\",",
            "            args=[\"tests\", \"testsitesetting\", self.default_site.pk],",
            "        )",
            "        response = self.client.get(start_url, follow=True)",
            "        self.assertRedirects(",
            "            response, dest_url, status_code=302, fetch_redirect_response=False",
            "        )",
            "",
            "    def test_redirect_to_current(self):",
            "        \"\"\"",
            "        Should redirect to the setting for the current site taken from the URL,",
            "        by default",
            "        \"\"\"",
            "        start_url = reverse(\"wagtailsettings:edit\", args=[\"tests\", \"testsitesetting\"])",
            "        dest_url = reverse(",
            "            \"wagtailsettings:edit\",",
            "            args=[\"tests\", \"testsitesetting\", self.other_site.pk],",
            "        )",
            "        response = self.client.get(",
            "            start_url, follow=True, HTTP_HOST=self.other_site.hostname",
            "        )",
            "        self.assertRedirects(",
            "            response, dest_url, status_code=302, fetch_redirect_response=False",
            "        )",
            "",
            "    def test_with_no_current_site(self):",
            "        \"\"\"",
            "        Redirection should not break if the current request does not correspond to a site",
            "        \"\"\"",
            "        self.default_site.is_default_site = False",
            "        self.default_site.save()",
            "",
            "        start_url = reverse(\"wagtailsettings:edit\", args=[\"tests\", \"testsitesetting\"])",
            "        response = self.client.get(",
            "            start_url, follow=True, HTTP_HOST=\"noneoftheabove.example.com\"",
            "        )",
            "        self.assertEqual(302, response.redirect_chain[0][1])",
            "",
            "    def test_switcher(self):",
            "        \"\"\"Check that the switcher form exists in the page\"\"\"",
            "        response = self.get()",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertContains(response, 'id=\"settings-site-switch\"')",
            "",
            "    def test_unknown_site(self):",
            "        \"\"\"Check that unknown sites throw a 404\"\"\"",
            "        response = self.get(site_pk=3)",
            "        self.assertEqual(response.status_code, 404)",
            "",
            "    def test_edit(self):",
            "        \"\"\"",
            "        Check that editing settings in multi-site mode edits the correct",
            "        setting, and leaves the other ones alone",
            "        \"\"\"",
            "        TestSiteSetting.objects.create(",
            "            title=\"default\", email=\"default@example.com\", site=self.default_site",
            "        )",
            "        TestSiteSetting.objects.create(",
            "            title=\"other\", email=\"other@example.com\", site=self.other_site",
            "        )",
            "        response = self.post(",
            "            site_pk=self.other_site.pk,",
            "            post_data={\"title\": \"other-new\", \"email\": \"other-other@example.com\"},",
            "        )",
            "        self.assertEqual(response.status_code, 302)",
            "",
            "        # Check that the correct setting was updated",
            "        other_setting = TestSiteSetting.for_site(self.other_site)",
            "        self.assertEqual(other_setting.title, \"other-new\")",
            "        self.assertEqual(other_setting.email, \"other-other@example.com\")",
            "",
            "        # Check that the other setting was not updated",
            "        default_setting = TestSiteSetting.for_site(self.default_site)",
            "        self.assertEqual(default_setting.title, \"default\")",
            "        self.assertEqual(default_setting.email, \"default@example.com\")",
            "",
            "",
            "class TestAdminPermission(WagtailTestUtils, TestCase):",
            "    def test_registered_permission(self):",
            "        permission = Permission.objects.get_by_natural_key(",
            "            app_label=\"tests\",",
            "            model=\"testsitesetting\",",
            "            codename=\"change_testsitesetting\",",
            "        )",
            "        for fn in hooks.get_hooks(\"register_permissions\"):",
            "            if permission in fn():",
            "                break",
            "        else:",
            "            self.fail(\"Change permission for tests.TestSiteSetting not registered\")",
            "",
            "",
            "class TestEditHandlers(TestCase):",
            "    def setUp(self):",
            "        get_setting_edit_handler.cache_clear()",
            "",
            "    def test_default_model_introspection(self):",
            "        handler = get_setting_edit_handler(TestSiteSetting)",
            "        self.assertIsInstance(handler, ObjectList)",
            "        self.assertEqual(len(handler.children), 2)",
            "        first = handler.children[0]",
            "        self.assertIsInstance(first, FieldPanel)",
            "        self.assertEqual(first.field_name, \"title\")",
            "        second = handler.children[1]",
            "        self.assertIsInstance(second, FieldPanel)",
            "        self.assertEqual(second.field_name, \"email\")",
            "",
            "    def test_with_custom_panels(self):",
            "        handler = get_setting_edit_handler(PanelSiteSettings)",
            "        self.assertIsInstance(handler, ObjectList)",
            "        self.assertEqual(len(handler.children), 1)",
            "        first = handler.children[0]",
            "        self.assertIsInstance(first, FieldPanel)",
            "        self.assertEqual(first.field_name, \"title\")",
            "",
            "    def test_with_custom_edit_handler(self):",
            "        handler = get_setting_edit_handler(TabbedSiteSettings)",
            "        self.assertIsInstance(handler, TabbedInterface)",
            "        self.assertEqual(len(handler.children), 2)"
        ],
        "afterPatchFile": [
            "from django.contrib.auth.models import Permission",
            "from django.test import TestCase, override_settings",
            "from django.urls import reverse",
            "from django.utils.text import capfirst",
            "",
            "from wagtail import hooks",
            "from wagtail.admin.admin_url_finder import AdminURLFinder",
            "from wagtail.admin.panels import FieldPanel, ObjectList, TabbedInterface",
            "from wagtail.contrib.settings.registry import SettingMenuItem",
            "from wagtail.contrib.settings.views import get_setting_edit_handler",
            "from wagtail.models import Page, Site",
            "from wagtail.test.testapp.models import (",
            "    FileSiteSetting,",
            "    IconSiteSetting,",
            "    PanelSiteSettings,",
            "    TabbedSiteSettings,",
            "    TestSiteSetting,",
            ")",
            "from wagtail.test.utils import WagtailTestUtils",
            "",
            "",
            "class TestSiteSettingMenu(WagtailTestUtils, TestCase):",
            "    def login_only_admin(self):",
            "        \"\"\"Log in with a user that only has permission to access the admin\"\"\"",
            "        user = self.create_user(username=\"test\", password=\"password\")",
            "        user.user_permissions.add(",
            "            Permission.objects.get_by_natural_key(",
            "                codename=\"access_admin\", app_label=\"wagtailadmin\", model=\"admin\"",
            "            )",
            "        )",
            "        self.login(username=\"test\", password=\"password\")",
            "        return user",
            "",
            "    def test_menu_item_in_admin(self):",
            "        self.login()",
            "        response = self.client.get(reverse(\"wagtailadmin_home\"))",
            "",
            "        self.assertContains(response, capfirst(TestSiteSetting._meta.verbose_name))",
            "        self.assertContains(",
            "            response, reverse(\"wagtailsettings:edit\", args=(\"tests\", \"testsitesetting\"))",
            "        )",
            "",
            "    def test_menu_item_no_permissions(self):",
            "        self.login_only_admin()",
            "        response = self.client.get(reverse(\"wagtailadmin_home\"))",
            "",
            "        self.assertNotContains(response, TestSiteSetting._meta.verbose_name)",
            "        self.assertNotContains(",
            "            response, reverse(\"wagtailsettings:edit\", args=(\"tests\", \"testsitesetting\"))",
            "        )",
            "",
            "    def test_menu_item_icon(self):",
            "        menu_item = SettingMenuItem(IconSiteSetting, icon=\"tag\", classname=\"test-class\")",
            "        self.assertEqual(menu_item.icon_name, \"tag\")",
            "        self.assertEqual(menu_item.classname, \"test-class\")",
            "",
            "",
            "class BaseTestSiteSettingView(WagtailTestUtils, TestCase):",
            "    def get(self, site_pk=1, params={}, setting=TestSiteSetting):",
            "        url = self.edit_url(setting=setting, site_pk=site_pk)",
            "        return self.client.get(url, params)",
            "",
            "    def post(self, site_pk=1, post_data={}, setting=TestSiteSetting):",
            "        url = self.edit_url(setting=setting, site_pk=site_pk)",
            "        return self.client.post(url, post_data)",
            "",
            "    def edit_url(self, setting, site_pk=1):",
            "        args = [setting._meta.app_label, setting._meta.model_name, site_pk]",
            "        return reverse(\"wagtailsettings:edit\", args=args)",
            "",
            "",
            "class TestSiteSettingCreateView(BaseTestSiteSettingView):",
            "    def setUp(self):",
            "        self.user = self.login()",
            "",
            "    def test_get_edit(self):",
            "        response = self.get()",
            "        self.assertEqual(response.status_code, 200)",
            "",
            "    def test_edit_invalid(self):",
            "        response = self.post(post_data={\"foo\": \"bar\"})",
            "        self.assertContains(response, \"The setting could not be saved due to errors.\")",
            "        self.assertContains(response, \"error-message\", count=2)",
            "        self.assertContains(response, \"This field is required\", count=2)",
            "",
            "    def test_edit(self):",
            "        response = self.post(",
            "            post_data={\"title\": \"Edited site title\", \"email\": \"test@example.com\"}",
            "        )",
            "        self.assertEqual(response.status_code, 302)",
            "",
            "        default_site = Site.objects.get(is_default_site=True)",
            "        setting = TestSiteSetting.objects.get(site=default_site)",
            "        self.assertEqual(setting.title, \"Edited site title\")",
            "        self.assertEqual(setting.email, \"test@example.com\")",
            "",
            "        url_finder = AdminURLFinder(self.user)",
            "        expected_url = \"/admin/settings/tests/testsitesetting/%d/\" % default_site.pk",
            "        self.assertEqual(url_finder.get_edit_url(setting), expected_url)",
            "",
            "    def test_file_upload_multipart(self):",
            "        response = self.get(setting=FileSiteSetting)",
            "        # Ensure the form supports file uploads",
            "        self.assertContains(response, 'enctype=\"multipart/form-data\"')",
            "",
            "",
            "class TestSiteSettingEditView(BaseTestSiteSettingView):",
            "    def setUp(self):",
            "        default_site = Site.objects.get(is_default_site=True)",
            "",
            "        self.test_setting = TestSiteSetting()",
            "        self.test_setting.title = \"Site title\"",
            "        self.test_setting.email = \"initial@example.com\"",
            "        self.test_setting.site = default_site",
            "        self.test_setting.save()",
            "",
            "        self.login()",
            "",
            "    def test_get_edit(self):",
            "        response = self.get()",
            "        self.assertEqual(response.status_code, 200)",
            "",
            "    def test_non_existant_model(self):",
            "        response = self.client.get(",
            "            reverse(\"wagtailsettings:edit\", args=[\"test\", \"foo\", 1])",
            "        )",
            "        self.assertEqual(response.status_code, 404)",
            "",
            "    def test_edit_invalid(self):",
            "        response = self.post(post_data={\"foo\": \"bar\"})",
            "        self.assertContains(response, \"The setting could not be saved due to errors.\")",
            "        self.assertContains(response, \"error-message\", count=2)",
            "        self.assertContains(response, \"This field is required\", count=2)",
            "",
            "    def test_edit(self):",
            "        response = self.post(",
            "            post_data={\"title\": \"Edited site title\", \"email\": \"test@example.com\"}",
            "        )",
            "        self.assertEqual(response.status_code, 302)",
            "",
            "        default_site = Site.objects.get(is_default_site=True)",
            "        setting = TestSiteSetting.objects.get(site=default_site)",
            "        self.assertEqual(setting.title, \"Edited site title\")",
            "        self.assertEqual(setting.email, \"test@example.com\")",
            "",
            "    def test_get_redirect_to_relevant_instance(self):",
            "        url = reverse(\"wagtailsettings:edit\", args=(\"tests\", \"testsitesetting\"))",
            "        default_site = Site.objects.get(is_default_site=True)",
            "",
            "        response = self.client.get(url)",
            "        self.assertRedirects(",
            "            response, status_code=302, expected_url=f\"{url}{default_site.pk}/\"",
            "        )",
            "",
            "    def test_get_redirect_to_relevant_instance_invalid(self):",
            "        Site.objects.all().delete()",
            "        url = reverse(\"wagtailsettings:edit\", args=(\"tests\", \"testsitesetting\"))",
            "        response = self.client.get(url)",
            "        self.assertRedirects(response, status_code=302, expected_url=\"/admin/\")",
            "",
            "",
            "@override_settings(",
            "    ALLOWED_HOSTS=[\"testserver\", \"example.com\", \"noneoftheabove.example.com\"]",
            ")",
            "class TestMultiSite(BaseTestSiteSettingView):",
            "    def setUp(self):",
            "        self.default_site = Site.objects.get(is_default_site=True)",
            "        self.other_site = Site.objects.create(",
            "            hostname=\"example.com\", root_page=Page.objects.get(pk=2)",
            "        )",
            "        self.login()",
            "",
            "    def test_redirect_to_default(self):",
            "        \"\"\"",
            "        Should redirect to the setting for the default site.",
            "        \"\"\"",
            "        start_url = reverse(\"wagtailsettings:edit\", args=[\"tests\", \"testsitesetting\"])",
            "        dest_url = reverse(",
            "            \"wagtailsettings:edit\",",
            "            args=[\"tests\", \"testsitesetting\", self.default_site.pk],",
            "        )",
            "        response = self.client.get(start_url, follow=True)",
            "        self.assertRedirects(",
            "            response, dest_url, status_code=302, fetch_redirect_response=False",
            "        )",
            "",
            "    def test_redirect_to_current(self):",
            "        \"\"\"",
            "        Should redirect to the setting for the current site taken from the URL,",
            "        by default",
            "        \"\"\"",
            "        start_url = reverse(\"wagtailsettings:edit\", args=[\"tests\", \"testsitesetting\"])",
            "        dest_url = reverse(",
            "            \"wagtailsettings:edit\",",
            "            args=[\"tests\", \"testsitesetting\", self.other_site.pk],",
            "        )",
            "        response = self.client.get(",
            "            start_url, follow=True, HTTP_HOST=self.other_site.hostname",
            "        )",
            "        self.assertRedirects(",
            "            response, dest_url, status_code=302, fetch_redirect_response=False",
            "        )",
            "",
            "    def test_with_no_current_site(self):",
            "        \"\"\"",
            "        Redirection should not break if the current request does not correspond to a site",
            "        \"\"\"",
            "        self.default_site.is_default_site = False",
            "        self.default_site.save()",
            "",
            "        start_url = reverse(\"wagtailsettings:edit\", args=[\"tests\", \"testsitesetting\"])",
            "        response = self.client.get(",
            "            start_url, follow=True, HTTP_HOST=\"noneoftheabove.example.com\"",
            "        )",
            "        self.assertEqual(302, response.redirect_chain[0][1])",
            "",
            "    def test_switcher(self):",
            "        \"\"\"Check that the switcher form exists in the page\"\"\"",
            "        response = self.get()",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertContains(response, 'id=\"settings-site-switch\"')",
            "",
            "    def test_unknown_site(self):",
            "        \"\"\"Check that unknown sites throw a 404\"\"\"",
            "        response = self.get(site_pk=3)",
            "        self.assertEqual(response.status_code, 404)",
            "",
            "    def test_edit(self):",
            "        \"\"\"",
            "        Check that editing settings in multi-site mode edits the correct",
            "        setting, and leaves the other ones alone",
            "        \"\"\"",
            "        TestSiteSetting.objects.create(",
            "            title=\"default\", email=\"default@example.com\", site=self.default_site",
            "        )",
            "        TestSiteSetting.objects.create(",
            "            title=\"other\", email=\"other@example.com\", site=self.other_site",
            "        )",
            "        response = self.post(",
            "            site_pk=self.other_site.pk,",
            "            post_data={\"title\": \"other-new\", \"email\": \"other-other@example.com\"},",
            "        )",
            "        self.assertEqual(response.status_code, 302)",
            "",
            "        # Check that the correct setting was updated",
            "        other_setting = TestSiteSetting.for_site(self.other_site)",
            "        self.assertEqual(other_setting.title, \"other-new\")",
            "        self.assertEqual(other_setting.email, \"other-other@example.com\")",
            "",
            "        # Check that the other setting was not updated",
            "        default_setting = TestSiteSetting.for_site(self.default_site)",
            "        self.assertEqual(default_setting.title, \"default\")",
            "        self.assertEqual(default_setting.email, \"default@example.com\")",
            "",
            "",
            "class TestAdminPermission(WagtailTestUtils, TestCase):",
            "    def test_registered_permission(self):",
            "        permission = Permission.objects.get_by_natural_key(",
            "            app_label=\"tests\",",
            "            model=\"testsitesetting\",",
            "            codename=\"change_testsitesetting\",",
            "        )",
            "        for fn in hooks.get_hooks(\"register_permissions\"):",
            "            if permission in fn():",
            "                break",
            "        else:",
            "            self.fail(\"Change permission for tests.TestSiteSetting not registered\")",
            "",
            "",
            "class TestEditHandlers(TestCase):",
            "    def setUp(self):",
            "        get_setting_edit_handler.cache_clear()",
            "",
            "    def test_default_model_introspection(self):",
            "        handler = get_setting_edit_handler(TestSiteSetting)",
            "        self.assertIsInstance(handler, ObjectList)",
            "        self.assertEqual(len(handler.children), 2)",
            "        first = handler.children[0]",
            "        self.assertIsInstance(first, FieldPanel)",
            "        self.assertEqual(first.field_name, \"title\")",
            "        second = handler.children[1]",
            "        self.assertIsInstance(second, FieldPanel)",
            "        self.assertEqual(second.field_name, \"email\")",
            "",
            "    def test_with_custom_panels(self):",
            "        handler = get_setting_edit_handler(PanelSiteSettings)",
            "        self.assertIsInstance(handler, ObjectList)",
            "        self.assertEqual(len(handler.children), 1)",
            "        first = handler.children[0]",
            "        self.assertIsInstance(first, FieldPanel)",
            "        self.assertEqual(first.field_name, \"title\")",
            "",
            "    def test_with_custom_edit_handler(self):",
            "        handler = get_setting_edit_handler(TabbedSiteSettings)",
            "        self.assertIsInstance(handler, TabbedInterface)",
            "        self.assertEqual(len(handler.children), 2)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "1",
            "1",
            "1",
            "1",
            "1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "1",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "17": [],
            "76": [
                "TestSiteSettingCreateView",
                "setUp"
            ],
            "77": [
                "TestSiteSettingCreateView",
                "setUp"
            ],
            "78": [
                "TestSiteSettingCreateView",
                "setUp"
            ],
            "79": [
                "TestSiteSettingCreateView",
                "setUp"
            ],
            "80": [
                "TestSiteSettingCreateView",
                "setUp"
            ],
            "112": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field_without_permission"
            ],
            "113": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field_without_permission"
            ],
            "114": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field_without_permission"
            ],
            "115": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field_without_permission"
            ],
            "116": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field_without_permission"
            ],
            "117": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field_without_permission"
            ],
            "118": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field_without_permission"
            ],
            "119": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field_without_permission"
            ],
            "120": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field_without_permission"
            ],
            "121": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field_without_permission"
            ],
            "122": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field_without_permission"
            ],
            "123": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field_without_permission"
            ],
            "124": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field_without_permission"
            ],
            "125": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field_without_permission"
            ],
            "126": [
                "TestSiteSettingCreateView"
            ],
            "127": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field"
            ],
            "128": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field"
            ],
            "129": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field"
            ],
            "130": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field"
            ],
            "131": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field"
            ],
            "132": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field"
            ],
            "133": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field"
            ],
            "134": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field"
            ],
            "135": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field"
            ],
            "136": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field"
            ],
            "137": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field"
            ],
            "138": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field"
            ],
            "139": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field"
            ],
            "140": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field"
            ],
            "141": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field"
            ],
            "142": [
                "TestSiteSettingCreateView",
                "test_create_restricted_field"
            ],
            "143": [],
            "147": [
                "TestSiteSettingEditView",
                "setUp"
            ],
            "152": [
                "TestSiteSettingEditView",
                "setUp"
            ],
            "155": [
                "TestSiteSettingEditView",
                "setUp"
            ],
            "156": [
                "TestSiteSettingEditView",
                "setUp"
            ],
            "157": [
                "TestSiteSettingEditView",
                "setUp"
            ],
            "158": [
                "TestSiteSettingEditView",
                "setUp"
            ],
            "159": [
                "TestSiteSettingEditView",
                "setUp"
            ],
            "160": [
                "TestSiteSettingEditView",
                "setUp"
            ],
            "204": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field"
            ],
            "205": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field"
            ],
            "206": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field"
            ],
            "207": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field"
            ],
            "208": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field"
            ],
            "209": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field"
            ],
            "210": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field"
            ],
            "211": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field"
            ],
            "212": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field"
            ],
            "213": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field"
            ],
            "214": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field"
            ],
            "215": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field"
            ],
            "216": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field"
            ],
            "217": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field"
            ],
            "218": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field"
            ],
            "219": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field"
            ],
            "220": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field"
            ],
            "221": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field"
            ],
            "222": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field"
            ],
            "223": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field"
            ],
            "224": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field"
            ],
            "225": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field"
            ],
            "226": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field"
            ],
            "227": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field"
            ],
            "228": [
                "TestSiteSettingEditView"
            ],
            "229": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "230": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "231": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "232": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "233": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "234": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "235": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "236": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "237": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "238": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "239": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "240": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "241": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "242": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "243": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "244": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "245": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "246": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "247": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "248": [
                "TestSiteSettingEditView",
                "test_edit_restricted_field_without_permission"
            ],
            "249": []
        },
        "addLocation": []
    },
    "wagtail/snippets/views/snippets.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 235,
                "afterPatchRowNumber": 235,
                "PatchRowcode": "     def _get_action_menu(self):"
            },
            "1": {
                "beforePatchRowNumber": 236,
                "afterPatchRowNumber": 236,
                "PatchRowcode": "         return SnippetActionMenu(self.request, view=self.view_name, model=self.model)"
            },
            "2": {
                "beforePatchRowNumber": 237,
                "afterPatchRowNumber": 237,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 238,
                "PatchRowcode": "+    def _get_initial_form_instance(self):"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 239,
                "PatchRowcode": "+        instance = self.model()"
            },
            "5": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 240,
                "PatchRowcode": "+"
            },
            "6": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 241,
                "PatchRowcode": "+        # Set locale of the new instance"
            },
            "7": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 242,
                "PatchRowcode": "+        if self.locale:"
            },
            "8": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 243,
                "PatchRowcode": "+            instance.locale = self.locale"
            },
            "9": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 244,
                "PatchRowcode": "+"
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 245,
                "PatchRowcode": "+        return instance"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 246,
                "PatchRowcode": "+"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 247,
                "PatchRowcode": "+    def get_form_kwargs(self):"
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 248,
                "PatchRowcode": "+        return {"
            },
            "14": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 249,
                "PatchRowcode": "+            **super().get_form_kwargs(),"
            },
            "15": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 250,
                "PatchRowcode": "+            \"instance\": self._get_initial_form_instance(),"
            },
            "16": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 251,
                "PatchRowcode": "+            \"for_user\": self.request.user,"
            },
            "17": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 252,
                "PatchRowcode": "+        }"
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 253,
                "PatchRowcode": "+"
            },
            "19": {
                "beforePatchRowNumber": 238,
                "afterPatchRowNumber": 254,
                "PatchRowcode": "     def get_side_panels(self):"
            },
            "20": {
                "beforePatchRowNumber": 239,
                "afterPatchRowNumber": 255,
                "PatchRowcode": "         side_panels = ["
            },
            "21": {
                "beforePatchRowNumber": 240,
                "afterPatchRowNumber": 256,
                "PatchRowcode": "             SnippetStatusSidePanel("
            },
            "22": {
                "beforePatchRowNumber": 294,
                "afterPatchRowNumber": 310,
                "PatchRowcode": "             locked_for_user=self.locked_for_user,"
            },
            "23": {
                "beforePatchRowNumber": 295,
                "afterPatchRowNumber": 311,
                "PatchRowcode": "         )"
            },
            "24": {
                "beforePatchRowNumber": 296,
                "afterPatchRowNumber": 312,
                "PatchRowcode": " "
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 313,
                "PatchRowcode": "+    def get_form_kwargs(self):"
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 314,
                "PatchRowcode": "+        return {**super().get_form_kwargs(), \"for_user\": self.request.user}"
            },
            "27": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 315,
                "PatchRowcode": "+"
            },
            "28": {
                "beforePatchRowNumber": 297,
                "afterPatchRowNumber": 316,
                "PatchRowcode": "     def get_side_panels(self):"
            },
            "29": {
                "beforePatchRowNumber": 298,
                "afterPatchRowNumber": 317,
                "PatchRowcode": "         side_panels = ["
            },
            "30": {
                "beforePatchRowNumber": 299,
                "afterPatchRowNumber": 318,
                "PatchRowcode": "             SnippetStatusSidePanel("
            }
        },
        "frontPatchFile": [
            "from warnings import warn",
            "",
            "from django.apps import apps",
            "from django.contrib.admin.utils import quote",
            "from django.core import checks",
            "from django.core.exceptions import ImproperlyConfigured, PermissionDenied",
            "from django.http import Http404",
            "from django.shortcuts import get_object_or_404, redirect",
            "from django.urls import path, re_path, reverse, reverse_lazy",
            "from django.utils.functional import cached_property",
            "from django.utils.text import capfirst",
            "from django.utils.translation import gettext as _",
            "from django.utils.translation import gettext_lazy",
            "",
            "from wagtail import hooks",
            "from wagtail.admin.checks import check_panels_in_model",
            "from wagtail.admin.panels import ObjectList, extract_panel_definitions_from_model_class",
            "from wagtail.admin.ui.components import MediaContainer",
            "from wagtail.admin.ui.side_panels import ChecksSidePanel, PreviewSidePanel",
            "from wagtail.admin.ui.tables import (",
            "    BulkActionsCheckboxColumn,",
            "    Column,",
            "    DateColumn,",
            "    LiveStatusTagColumn,",
            "    TitleColumn,",
            "    UserColumn,",
            ")",
            "from wagtail.admin.views import generic",
            "from wagtail.admin.views.generic import history, lock, workflow",
            "from wagtail.admin.views.generic.permissions import PermissionCheckedMixin",
            "from wagtail.admin.views.generic.preview import (",
            "    PreviewOnCreate,",
            "    PreviewOnEdit,",
            "    PreviewRevision,",
            ")",
            "from wagtail.admin.viewsets import viewsets",
            "from wagtail.admin.viewsets.model import ModelViewSet, ModelViewSetGroup",
            "from wagtail.admin.widgets.button import (",
            "    BaseDropdownMenuButton,",
            "    ButtonWithDropdown,",
            ")",
            "from wagtail.models import (",
            "    DraftStateMixin,",
            "    LockableMixin,",
            "    PreviewableMixin,",
            "    RevisionMixin,",
            "    WorkflowMixin,",
            ")",
            "from wagtail.permissions import ModelPermissionPolicy",
            "from wagtail.snippets.action_menu import SnippetActionMenu",
            "from wagtail.snippets.models import SnippetAdminURLFinder, get_snippet_models",
            "from wagtail.snippets.permissions import user_can_edit_snippet_type",
            "from wagtail.snippets.side_panels import SnippetStatusSidePanel",
            "from wagtail.snippets.views.chooser import SnippetChooserViewSet",
            "from wagtail.utils.deprecation import RemovedInWagtail70Warning",
            "",
            "",
            "# == Helper functions ==",
            "def get_snippet_model_from_url_params(app_name, model_name):",
            "    \"\"\"",
            "    Retrieve a model from an app_label / model_name combo.",
            "    Raise Http404 if the model is not a valid snippet type.",
            "    \"\"\"",
            "    try:",
            "        model = apps.get_model(app_name, model_name)",
            "    except LookupError:",
            "        raise Http404",
            "    if model not in get_snippet_models():",
            "        # don't allow people to hack the URL to edit content types that aren't registered as snippets",
            "        raise Http404",
            "",
            "    return model",
            "",
            "",
            "# == Views ==",
            "",
            "",
            "class ModelIndexView(generic.BaseListingView):",
            "    page_title = gettext_lazy(\"Snippets\")",
            "    header_icon = \"snippet\"",
            "    index_url_name = \"wagtailsnippets:index\"",
            "    default_ordering = \"name\"",
            "    _show_breadcrumbs = True",
            "",
            "    def setup(self, request, *args, **kwargs):",
            "        super().setup(request, *args, **kwargs)",
            "        self.snippet_types = self._get_snippet_types()",
            "",
            "    def _get_snippet_types(self):",
            "        return [",
            "            {",
            "                \"name\": capfirst(model._meta.verbose_name_plural),",
            "                \"count\": model.objects.all().count(),",
            "                \"model\": model,",
            "            }",
            "            for model in get_snippet_models()",
            "            if user_can_edit_snippet_type(self.request.user, model)",
            "        ]",
            "",
            "    def dispatch(self, request, *args, **kwargs):",
            "        if not self.snippet_types:",
            "            raise PermissionDenied",
            "        return super().dispatch(request, *args, **kwargs)",
            "",
            "    def get_breadcrumbs_items(self):",
            "        return self.breadcrumbs_items + [{\"url\": \"\", \"label\": _(\"Snippets\")}]",
            "",
            "    def get_list_url(self, type):",
            "        return reverse(type[\"model\"].snippet_viewset.get_url_name(\"list\"))",
            "",
            "    def get_queryset(self):",
            "        return None",
            "",
            "    @cached_property",
            "    def columns(self):",
            "        return [",
            "            TitleColumn(",
            "                \"name\",",
            "                label=_(\"Name\"),",
            "                get_url=self.get_list_url,",
            "                sort_key=\"name\",",
            "            ),",
            "            Column(",
            "                \"count\",",
            "                label=_(\"Instances\"),",
            "                sort_key=\"count\",",
            "            ),",
            "        ]",
            "",
            "    def get_context_data(self, **kwargs):",
            "        reverse = self.ordering[0] == \"-\"",
            "",
            "        if self.ordering in [\"count\", \"-count\"]:",
            "            snippet_types = sorted(",
            "                self.snippet_types,",
            "                key=lambda type: type[\"count\"],",
            "                reverse=reverse,",
            "            )",
            "        else:",
            "            snippet_types = sorted(",
            "                self.snippet_types,",
            "                key=lambda type: type[\"name\"].lower(),",
            "                reverse=reverse,",
            "            )",
            "",
            "        return super().get_context_data(object_list=snippet_types)",
            "",
            "    def get_template_names(self):",
            "        # We use the generic index template instead of model_index.html,",
            "        # but we look for it anyway so users can customise this view's template",
            "        # without having to override the entire view or the generic template.",
            "        return [",
            "            \"wagtailsnippets/snippets/model_index.html\",",
            "            self.template_name,",
            "        ]",
            "",
            "",
            "class IndexView(generic.IndexViewOptionalFeaturesMixin, generic.IndexView):",
            "    view_name = \"list\"",
            "",
            "    def get_base_queryset(self):",
            "        # Allow the queryset to be a callable that takes a request",
            "        # so that it can be evaluated in the context of the request",
            "        if callable(self.queryset):",
            "            self.queryset = self.queryset(self.request)",
            "        return super().get_base_queryset()",
            "",
            "    @cached_property",
            "    def columns(self):",
            "        return [",
            "            BulkActionsCheckboxColumn(\"bulk_actions\", obj_type=\"snippet\"),",
            "            *super().columns,",
            "        ]",
            "",
            "    def _get_title_column(self, *args, **kwargs):",
            "        return super()._get_title_column(",
            "            *args,",
            "            **kwargs,",
            "            get_title_id=lambda instance: f\"snippet_{quote(instance.pk)}_title\",",
            "        )",
            "",
            "    def get_list_buttons(self, instance):",
            "        more_buttons = self.get_list_more_buttons(instance)",
            "        next_url = self.request.path",
            "        list_buttons = []",
            "",
            "        for hook in hooks.get_hooks(\"register_snippet_listing_buttons\"):",
            "            hook_buttons = hook(instance, self.request.user, next_url)",
            "            for button in hook_buttons:",
            "                if isinstance(button, BaseDropdownMenuButton):",
            "                    # If the button is a dropdown menu, add it to the top-level",
            "                    # because we do not support nested dropdowns",
            "                    list_buttons.append(button)",
            "                else:",
            "                    # Otherwise, add it to the default \"More\" dropdown",
            "                    more_buttons.append(button)",
            "",
            "        # Pass the more_buttons to the construct hooks, as that's what contains",
            "        # the default buttons and most buttons added via register_snippet_listing_buttons",
            "        for hook in hooks.get_hooks(\"construct_snippet_listing_buttons\"):",
            "            try:",
            "                hook(more_buttons, instance, self.request.user)",
            "            except TypeError:",
            "                warn(",
            "                    \"construct_snippet_listing_buttons hook no longer accepts a context argument\",",
            "                    RemovedInWagtail70Warning,",
            "                    stacklevel=2,",
            "                )",
            "                hook(more_buttons, instance, self.request.user, {})",
            "",
            "        list_buttons.append(",
            "            ButtonWithDropdown(",
            "                buttons=more_buttons,",
            "                icon_name=\"dots-horizontal\",",
            "                attrs={",
            "                    \"aria-label\": _(\"More options for '%(title)s'\")",
            "                    % {\"title\": str(instance)},",
            "                },",
            "            )",
            "        )",
            "",
            "        return list_buttons",
            "",
            "",
            "class CreateView(generic.CreateEditViewOptionalFeaturesMixin, generic.CreateView):",
            "    view_name = \"create\"",
            "    template_name = \"wagtailsnippets/snippets/create.html\"",
            "",
            "    def run_before_hook(self):",
            "        return self.run_hook(\"before_create_snippet\", self.request, self.model)",
            "",
            "    def run_after_hook(self):",
            "        return self.run_hook(\"after_create_snippet\", self.request, self.object)",
            "",
            "    def _get_action_menu(self):",
            "        return SnippetActionMenu(self.request, view=self.view_name, model=self.model)",
            "",
            "    def get_side_panels(self):",
            "        side_panels = [",
            "            SnippetStatusSidePanel(",
            "                self.form.instance,",
            "                self.request,",
            "                show_schedule_publishing_toggle=getattr(",
            "                    self.form, \"show_schedule_publishing_toggle\", False",
            "                ),",
            "                locale=self.locale,",
            "                translations=self.translations,",
            "            )",
            "        ]",
            "        if self.preview_enabled and self.form.instance.is_previewable():",
            "            side_panels.append(",
            "                PreviewSidePanel(",
            "                    self.form.instance, self.request, preview_url=self.get_preview_url()",
            "                )",
            "            )",
            "            side_panels.append(ChecksSidePanel(self.form.instance, self.request))",
            "        return MediaContainer(side_panels)",
            "",
            "    def get_context_data(self, **kwargs):",
            "        context = super().get_context_data(**kwargs)",
            "        action_menu = self._get_action_menu()",
            "        context[\"media\"] += action_menu.media",
            "        context[\"action_menu\"] = action_menu",
            "        return context",
            "",
            "",
            "class CopyView(CreateView):",
            "    def get_object(self):",
            "        return get_object_or_404(self.model, pk=self.kwargs[\"pk\"])",
            "",
            "    def _get_initial_form_instance(self):",
            "        instance = self.get_object()",
            "        # Set locale of the new instance",
            "        if self.locale:",
            "            instance.locale = self.locale",
            "        return instance",
            "",
            "",
            "class EditView(generic.CreateEditViewOptionalFeaturesMixin, generic.EditView):",
            "    view_name = \"edit\"",
            "    template_name = \"wagtailsnippets/snippets/edit.html\"",
            "",
            "    def run_before_hook(self):",
            "        return self.run_hook(\"before_edit_snippet\", self.request, self.object)",
            "",
            "    def run_after_hook(self):",
            "        return self.run_hook(\"after_edit_snippet\", self.request, self.object)",
            "",
            "    def _get_action_menu(self):",
            "        return SnippetActionMenu(",
            "            self.request,",
            "            view=self.view_name,",
            "            instance=self.object,",
            "            locked_for_user=self.locked_for_user,",
            "        )",
            "",
            "    def get_side_panels(self):",
            "        side_panels = [",
            "            SnippetStatusSidePanel(",
            "                self.object,",
            "                self.request,",
            "                show_schedule_publishing_toggle=getattr(",
            "                    self.form, \"show_schedule_publishing_toggle\", False",
            "                ),",
            "                live_object=self.live_object,",
            "                scheduled_object=self.live_object.get_scheduled_revision_as_object()",
            "                if self.draftstate_enabled",
            "                else None,",
            "                locale=self.locale,",
            "                translations=self.translations,",
            "                usage_url=self.get_usage_url(),",
            "                history_url=self.get_history_url(),",
            "                last_updated_info=self.get_last_updated_info(),",
            "            )",
            "        ]",
            "        if self.preview_enabled and self.object.is_previewable():",
            "            side_panels.append(",
            "                PreviewSidePanel(",
            "                    self.object, self.request, preview_url=self.get_preview_url()",
            "                )",
            "            )",
            "            side_panels.append(ChecksSidePanel(self.object, self.request))",
            "        return MediaContainer(side_panels)",
            "",
            "    def get_context_data(self, **kwargs):",
            "        context = super().get_context_data(**kwargs)",
            "        action_menu = self._get_action_menu()",
            "        context[\"media\"] += action_menu.media",
            "        context[\"action_menu\"] = action_menu",
            "        return context",
            "",
            "",
            "class DeleteView(generic.DeleteView):",
            "    view_name = \"delete\"",
            "",
            "    def run_before_hook(self):",
            "        return self.run_hook(\"before_delete_snippet\", self.request, [self.object])",
            "",
            "    def run_after_hook(self):",
            "        return self.run_hook(\"after_delete_snippet\", self.request, [self.object])",
            "",
            "",
            "class UsageView(generic.UsageView):",
            "    view_name = \"usage\"",
            "",
            "",
            "class ActionColumn(Column):",
            "    cell_template_name = \"wagtailsnippets/snippets/revisions/_actions.html\"",
            "",
            "    def __init__(self, *args, object=None, view=None, **kwargs):",
            "        super().__init__(*args, **kwargs)",
            "        self.object = object",
            "        self.view = view",
            "",
            "    def get_cell_context_data(self, instance, parent_context):",
            "        context = super().get_cell_context_data(instance, parent_context)",
            "        context[\"revision_enabled\"] = isinstance(self.object, RevisionMixin)",
            "        context[\"draftstate_enabled\"] = isinstance(self.object, DraftStateMixin)",
            "        context[\"preview_enabled\"] = isinstance(self.object, PreviewableMixin)",
            "        context[\"can_publish\"] = self.view.user_has_permission(\"publish\")",
            "        context[\"object\"] = self.object",
            "        context[\"view\"] = self.view",
            "        return context",
            "",
            "",
            "class HistoryView(history.HistoryView):",
            "    view_name = \"history\"",
            "    revisions_view_url_name = None",
            "    revisions_revert_url_name = None",
            "    revisions_compare_url_name = None",
            "    revisions_unschedule_url_name = None",
            "",
            "    @cached_property",
            "    def columns(self):",
            "        return [",
            "            ActionColumn(",
            "                \"message\",",
            "                object=self.object,",
            "                view=self,",
            "                classname=\"title\",",
            "                label=_(\"Action\"),",
            "            ),",
            "            UserColumn(\"user\", blank_display_name=\"system\"),",
            "            DateColumn(\"timestamp\", label=_(\"Date\")),",
            "        ]",
            "",
            "",
            "class InspectView(generic.InspectView):",
            "    view_name = \"inspect\"",
            "",
            "",
            "class PreviewOnCreateView(PreviewOnCreate):",
            "    pass",
            "",
            "",
            "class PreviewOnEditView(PreviewOnEdit):",
            "    pass",
            "",
            "",
            "class PreviewRevisionView(PermissionCheckedMixin, PreviewRevision):",
            "    permission_required = \"change\"",
            "",
            "",
            "class RevisionsCompareView(PermissionCheckedMixin, generic.RevisionsCompareView):",
            "    permission_required = \"change\"",
            "",
            "    @property",
            "    def edit_label(self):",
            "        return _(\"Edit this %(model_name)s\") % {",
            "            \"model_name\": self.model._meta.verbose_name",
            "        }",
            "",
            "    @property",
            "    def history_label(self):",
            "        return _(\"%(model_name)s history\") % {",
            "            \"model_name\": self.model._meta.verbose_name",
            "        }",
            "",
            "",
            "class UnpublishView(PermissionCheckedMixin, generic.UnpublishView):",
            "    permission_required = \"publish\"",
            "",
            "",
            "class RevisionsUnscheduleView(PermissionCheckedMixin, generic.RevisionsUnscheduleView):",
            "    permission_required = \"publish\"",
            "",
            "",
            "class LockView(PermissionCheckedMixin, lock.LockView):",
            "    permission_required = \"lock\"",
            "",
            "    def user_has_permission(self, permission):",
            "        if self.request.user.is_superuser:",
            "            return True",
            "",
            "        if permission == self.permission_required and isinstance(",
            "            self.object, WorkflowMixin",
            "        ):",
            "            current_workflow_task = self.object.current_workflow_task",
            "            if current_workflow_task:",
            "                return current_workflow_task.user_can_lock(",
            "                    self.object, self.request.user",
            "                )",
            "",
            "        return super().user_has_permission(permission)",
            "",
            "",
            "class UnlockView(PermissionCheckedMixin, lock.UnlockView):",
            "    permission_required = \"unlock\"",
            "",
            "    def user_has_permission(self, permission):",
            "        if self.request.user.is_superuser:",
            "            return True",
            "",
            "        if permission == self.permission_required:",
            "            # Allow unlocking even if the user does not have the 'unlock' permission",
            "            # if they are the user who locked the object",
            "            if self.object.locked_by_id == self.request.user.pk:",
            "                return True",
            "",
            "            if isinstance(self.object, WorkflowMixin):",
            "                current_workflow_task = self.object.current_workflow_task",
            "                if current_workflow_task:",
            "                    return current_workflow_task.user_can_unlock(",
            "                        self.object, self.request.user",
            "                    )",
            "",
            "        return super().user_has_permission(permission)",
            "",
            "",
            "class WorkflowActionView(workflow.WorkflowAction):",
            "    pass",
            "",
            "",
            "class CollectWorkflowActionDataView(workflow.CollectWorkflowActionData):",
            "    pass",
            "",
            "",
            "class ConfirmWorkflowCancellationView(workflow.ConfirmWorkflowCancellation):",
            "    pass",
            "",
            "",
            "class WorkflowPreviewView(workflow.PreviewRevisionForTask):",
            "    pass",
            "",
            "",
            "class WorkflowHistoryView(PermissionCheckedMixin, history.WorkflowHistoryView):",
            "    permission_required = \"change\"",
            "",
            "",
            "class WorkflowHistoryDetailView(",
            "    PermissionCheckedMixin, history.WorkflowHistoryDetailView",
            "):",
            "    permission_required = \"change\"",
            "",
            "",
            "class SnippetViewSet(ModelViewSet):",
            "    \"\"\"",
            "    A viewset that instantiates the admin views for snippets.",
            "",
            "    All attributes and methods from",
            "    :class:`~wagtail.admin.viewsets.model.ModelViewSet` are available.",
            "",
            "    For more information on how to use this class,",
            "    see :ref:`wagtailsnippets_custom_admin_views`.",
            "    \"\"\"",
            "",
            "    #: The model class to be registered as a snippet with this viewset.",
            "    model = None",
            "",
            "    #: The number of items to display in the chooser view. Defaults to 10.",
            "    chooser_per_page = 10",
            "",
            "    #: The URL namespace to use for the admin views.",
            "    #: If left unset, ``wagtailsnippets_{app_label}_{model_name}`` is used instead.",
            "    #:",
            "    #: **Deprecated** - the preferred attribute to customise is :attr:`~.ViewSet.url_namespace`.",
            "    admin_url_namespace = None",
            "",
            "    #: The base URL path to use for the admin views.",
            "    #: If left unset, ``snippets/{app_label}/{model_name}`` is used instead.",
            "    #:",
            "    #: **Deprecated** - the preferred attribute to customise is :attr:`~.ViewSet.url_prefix`.",
            "    base_url_path = None",
            "",
            "    #: The URL namespace to use for the chooser admin views.",
            "    #: If left unset, ``wagtailsnippetchoosers_{app_label}_{model_name}`` is used instead.",
            "    chooser_admin_url_namespace = None",
            "",
            "    #: The base URL path to use for the chooser admin views.",
            "    #: If left unset, ``snippets/choose/{app_label}/{model_name}`` is used instead.",
            "    chooser_base_url_path = None",
            "",
            "    #: The view class to use for the index view; must be a subclass of ``wagtail.snippets.views.snippets.IndexView``.",
            "    index_view_class = IndexView",
            "",
            "    #: The view class to use for the create view; must be a subclass of ``wagtail.snippets.views.snippets.CreateView``.",
            "    add_view_class = CreateView",
            "",
            "    #: The view class to use for the copy view; must be a subclass of ``wagtail.snippet.views.snippets.CopyView``.",
            "    copy_view_class = CopyView",
            "",
            "    #: The view class to use for the edit view; must be a subclass of ``wagtail.snippets.views.snippets.EditView``.",
            "    edit_view_class = EditView",
            "",
            "    #: The view class to use for the delete view; must be a subclass of ``wagtail.snippets.views.snippets.DeleteView``.",
            "    delete_view_class = DeleteView",
            "",
            "    #: The view class to use for the usage view; must be a subclass of ``wagtail.snippets.views.snippets.UsageView``.",
            "    usage_view_class = UsageView",
            "",
            "    #: The view class to use for the history view; must be a subclass of ``wagtail.snippets.views.snippets.HistoryView``.",
            "    history_view_class = HistoryView",
            "",
            "    #: The view class to use for the inspect view; must be a subclass of ``wagtail.snippets.views.snippets.InspectView``.",
            "    inspect_view_class = InspectView",
            "",
            "    #: The view class to use for previewing revisions; must be a subclass of ``wagtail.snippets.views.snippets.PreviewRevisionView``.",
            "    revisions_view_class = PreviewRevisionView",
            "",
            "    #: The view class to use for comparing revisions; must be a subclass of ``wagtail.snippets.views.snippets.RevisionsCompareView``.",
            "    revisions_compare_view_class = RevisionsCompareView",
            "",
            "    #: The view class to use for unscheduling revisions; must be a subclass of ``wagtail.snippets.views.snippets.RevisionsUnscheduleView``.",
            "    revisions_unschedule_view_class = RevisionsUnscheduleView",
            "",
            "    #: The view class to use for unpublishing a snippet; must be a subclass of ``wagtail.snippets.views.snippets.UnpublishView``.",
            "    unpublish_view_class = UnpublishView",
            "",
            "    #: The view class to use for previewing on the create view; must be a subclass of ``wagtail.snippets.views.snippets.PreviewOnCreateView``.",
            "    preview_on_add_view_class = PreviewOnCreateView",
            "",
            "    #: The view class to use for previewing on the edit view; must be a subclass of ``wagtail.snippets.views.snippets.PreviewOnEditView``.",
            "    preview_on_edit_view_class = PreviewOnEditView",
            "",
            "    #: The view class to use for locking a snippet; must be a subclass of ``wagtail.snippets.views.snippets.LockView``.",
            "    lock_view_class = LockView",
            "",
            "    #: The view class to use for unlocking a snippet; must be a subclass of ``wagtail.snippets.views.snippets.UnlockView``.",
            "    unlock_view_class = UnlockView",
            "",
            "    #: The view class to use for performing a workflow action; must be a subclass of ``wagtail.snippets.views.snippets.WorkflowActionView``.",
            "    workflow_action_view_class = WorkflowActionView",
            "",
            "    #: The view class to use for performing a workflow action that returns the validated data in the response; must be a subclass of ``wagtail.snippets.views.snippets.CollectWorkflowActionDataView``.",
            "    collect_workflow_action_data_view_class = CollectWorkflowActionDataView",
            "",
            "    #: The view class to use for confirming the cancellation of a workflow; must be a subclass of ``wagtail.snippets.views.snippets.ConfirmWorkflowCancellationView``.",
            "    confirm_workflow_cancellation_view_class = ConfirmWorkflowCancellationView",
            "",
            "    #: The view class to use for previewing a revision for a specific task; must be a subclass of ``wagtail.snippets.views.snippets.WorkflowPreviewView``.",
            "    workflow_preview_view_class = WorkflowPreviewView",
            "",
            "    #: The view class to use for the workflow history view; must be a subclass of ``wagtail.snippets.views.snippets.WorkflowHistoryView``.",
            "    workflow_history_view_class = WorkflowHistoryView",
            "",
            "    #: The view class to use for the workflow history detail view; must be a subclass of ``wagtail.snippets.views.snippets.WorkflowHistoryDetailView``.",
            "    workflow_history_detail_view_class = WorkflowHistoryDetailView",
            "",
            "    #: The ViewSet class to use for the chooser views; must be a subclass of ``wagtail.snippets.views.chooser.SnippetChooserViewSet``.",
            "    chooser_viewset_class = SnippetChooserViewSet",
            "",
            "    #: The prefix of template names to look for when rendering the admin views.",
            "    template_prefix = \"wagtailsnippets/snippets/\"",
            "",
            "    def __init__(self, **kwargs):",
            "        super().__init__(**kwargs)",
            "",
            "        if self.model is None:",
            "            raise ImproperlyConfigured(",
            "                \"SnippetViewSet must be passed a model or define a model attribute.\"",
            "            )",
            "",
            "        self.model_opts = self.model._meta",
            "        self.app_label = self.model_opts.app_label",
            "        self.model_name = self.model_opts.model_name",
            "",
            "        self.preview_enabled = issubclass(self.model, PreviewableMixin)",
            "        self.revision_enabled = issubclass(self.model, RevisionMixin)",
            "        self.draftstate_enabled = issubclass(self.model, DraftStateMixin)",
            "        self.workflow_enabled = issubclass(self.model, WorkflowMixin)",
            "        self.locking_enabled = issubclass(self.model, LockableMixin)",
            "",
            "        self.menu_item_is_registered = getattr(",
            "            self, \"menu_item_is_registered\", bool(self.menu_hook)",
            "        )",
            "",
            "    @cached_property",
            "    def url_prefix(self):",
            "        # SnippetViewSet historically allows overriding the URL prefix via the",
            "        # get_admin_base_path method or the admin_base_path attribute, so preserve that here",
            "        return self.get_admin_base_path()",
            "",
            "    @cached_property",
            "    def url_namespace(self):",
            "        # SnippetViewSet historically allows overriding the URL namespace via the",
            "        # get_admin_url_namespace method or the admin_url_namespace attribute,",
            "        # so preserve that here",
            "        return self.get_admin_url_namespace()",
            "",
            "    @property",
            "    def revisions_revert_view_class(self):",
            "        \"\"\"",
            "        The view class to use for reverting to a previous revision.",
            "",
            "        By default, this class is generated by combining the edit view with",
            "        ``wagtail.admin.views.generic.mixins.RevisionsRevertMixin``. As a result,",
            "        this class must be a subclass of ``wagtail.snippets.views.snippets.EditView``",
            "        and must handle the reversion correctly.",
            "        \"\"\"",
            "        revisions_revert_view_class = type(",
            "            \"_RevisionsRevertView\",",
            "            (generic.RevisionsRevertMixin, self.edit_view_class),",
            "            {\"view_name\": \"revisions_revert\"},",
            "        )",
            "        return revisions_revert_view_class",
            "",
            "    @property",
            "    def permission_policy(self):",
            "        return ModelPermissionPolicy(self.model)",
            "",
            "    def get_common_view_kwargs(self, **kwargs):",
            "        return super().get_common_view_kwargs(",
            "            **{",
            "                \"index_url_name\": self.get_url_name(\"list\"),",
            "                \"index_results_url_name\": self.get_url_name(\"list_results\"),",
            "                \"lock_url_name\": self.get_url_name(\"lock\"),",
            "                \"unlock_url_name\": self.get_url_name(\"unlock\"),",
            "                \"revisions_view_url_name\": self.get_url_name(\"revisions_view\"),",
            "                \"revisions_revert_url_name\": self.get_url_name(\"revisions_revert\"),",
            "                \"revisions_compare_url_name\": self.get_url_name(\"revisions_compare\"),",
            "                \"revisions_unschedule_url_name\": self.get_url_name(",
            "                    \"revisions_unschedule\"",
            "                ),",
            "                \"unpublish_url_name\": self.get_url_name(\"unpublish\"),",
            "                \"breadcrumbs_items\": self.breadcrumbs_items,",
            "                **kwargs,",
            "            }",
            "        )",
            "",
            "    def get_index_view_kwargs(self, **kwargs):",
            "        return super().get_index_view_kwargs(",
            "            queryset=self.get_queryset,",
            "            **kwargs,",
            "        )",
            "",
            "    def get_add_view_kwargs(self, **kwargs):",
            "        return super().get_add_view_kwargs(",
            "            preview_url_name=self.get_url_name(\"preview_on_add\"),",
            "            **kwargs,",
            "        )",
            "",
            "    def get_copy_view_kwargs(self, **kwargs):",
            "        return self.get_add_view_kwargs(**kwargs)",
            "",
            "    def get_edit_view_kwargs(self, **kwargs):",
            "        return super().get_edit_view_kwargs(",
            "            preview_url_name=self.get_url_name(\"preview_on_edit\"),",
            "            workflow_history_url_name=self.get_url_name(\"workflow_history\"),",
            "            confirm_workflow_cancellation_url_name=self.get_url_name(",
            "                \"confirm_workflow_cancellation\"",
            "            ),",
            "            **kwargs,",
            "        )",
            "",
            "    @property",
            "    def revisions_view(self):",
            "        return self.construct_view(self.revisions_view_class)",
            "",
            "    @property",
            "    def revisions_revert_view(self):",
            "        return self.construct_view(",
            "            self.revisions_revert_view_class,",
            "            **self.get_edit_view_kwargs(),",
            "        )",
            "",
            "    @property",
            "    def revisions_compare_view(self):",
            "        return self.construct_view(",
            "            self.revisions_compare_view_class,",
            "            edit_handler=self._edit_handler,",
            "            template_name=self.get_templates(",
            "                \"revisions_compare\",",
            "                fallback=self.revisions_compare_view_class.template_name,",
            "            ),",
            "        )",
            "",
            "    @property",
            "    def revisions_unschedule_view(self):",
            "        return self.construct_view(",
            "            self.revisions_unschedule_view_class,",
            "            template_name=self.get_templates(",
            "                \"revisions_unschedule\",",
            "                fallback=self.revisions_unschedule_view_class.template_name,",
            "            ),",
            "        )",
            "",
            "    @property",
            "    def unpublish_view(self):",
            "        return self.construct_view(",
            "            self.unpublish_view_class,",
            "            template_name=self.get_templates(",
            "                \"unpublish\", fallback=self.unpublish_view_class.template_name",
            "            ),",
            "        )",
            "",
            "    @property",
            "    def preview_on_add_view(self):",
            "        return self.construct_view(",
            "            self.preview_on_add_view_class,",
            "            form_class=self.get_form_class(),",
            "        )",
            "",
            "    @property",
            "    def preview_on_edit_view(self):",
            "        return self.construct_view(",
            "            self.preview_on_edit_view_class,",
            "            form_class=self.get_form_class(for_update=True),",
            "        )",
            "",
            "    @property",
            "    def lock_view(self):",
            "        return self.construct_view(",
            "            self.lock_view_class,",
            "            success_url_name=self.get_url_name(\"edit\"),",
            "        )",
            "",
            "    @property",
            "    def copy_view(self):",
            "        return self.construct_view(self.copy_view_class, **self.get_copy_view_kwargs())",
            "",
            "    @property",
            "    def unlock_view(self):",
            "        return self.construct_view(",
            "            self.unlock_view_class,",
            "            success_url_name=self.get_url_name(\"edit\"),",
            "        )",
            "",
            "    @property",
            "    def workflow_action_view(self):",
            "        return self.construct_view(",
            "            self.workflow_action_view_class,",
            "            redirect_url_name=self.get_url_name(\"edit\"),",
            "            submit_url_name=self.get_url_name(\"workflow_action\"),",
            "        )",
            "",
            "    @property",
            "    def collect_workflow_action_data_view(self):",
            "        return self.construct_view(",
            "            self.collect_workflow_action_data_view_class,",
            "            redirect_url_name=self.get_url_name(\"edit\"),",
            "            submit_url_name=self.get_url_name(\"collect_workflow_action_data\"),",
            "        )",
            "",
            "    @property",
            "    def confirm_workflow_cancellation_view(self):",
            "        return self.construct_view(self.confirm_workflow_cancellation_view_class)",
            "",
            "    @property",
            "    def workflow_preview_view(self):",
            "        return self.construct_view(self.workflow_preview_view_class)",
            "",
            "    @property",
            "    def workflow_history_view(self):",
            "        return self.construct_view(",
            "            self.workflow_history_view_class,",
            "            template_name=self.get_templates(",
            "                \"workflow_history/index\",",
            "                fallback=self.workflow_history_view_class.template_name,",
            "            ),",
            "            workflow_history_url_name=self.get_url_name(\"workflow_history\"),",
            "            workflow_history_detail_url_name=self.get_url_name(",
            "                \"workflow_history_detail\"",
            "            ),",
            "            _show_breadcrumbs=False,",
            "        )",
            "",
            "    @property",
            "    def workflow_history_detail_view(self):",
            "        return self.construct_view(",
            "            self.workflow_history_detail_view_class,",
            "            template_name=self.get_templates(",
            "                \"workflow_history/detail\",",
            "                fallback=self.workflow_history_detail_view_class.template_name,",
            "            ),",
            "            object_icon=self.icon,",
            "            header_icon=\"list-ul\",",
            "            workflow_history_url_name=self.get_url_name(\"workflow_history\"),",
            "            _show_breadcrumbs=False,",
            "        )",
            "",
            "    @property",
            "    def redirect_to_usage_view(self):",
            "        def redirect_to_usage(request, pk):",
            "            warn(",
            "                (",
            "                    \"%s's `/<pk>/usage/` usage view URL pattern has been \"",
            "                    \"deprecated in favour of /usage/<pk>/.\"",
            "                )",
            "                % (self.__class__.__name__),",
            "                category=RemovedInWagtail70Warning,",
            "            )",
            "            return redirect(self.get_url_name(\"usage\"), pk, permanent=True)",
            "",
            "        return redirect_to_usage",
            "",
            "    @property",
            "    def chooser_viewset(self):",
            "        return self.chooser_viewset_class(",
            "            self.get_chooser_admin_url_namespace(),",
            "            model=self.model,",
            "            url_prefix=self.get_chooser_admin_base_path(),",
            "            icon=self.icon,",
            "            per_page=self.chooser_per_page,",
            "        )",
            "",
            "    @cached_property",
            "    def list_display(self):",
            "        list_display = super().list_display.copy()",
            "        if self.draftstate_enabled:",
            "            list_display.append(LiveStatusTagColumn())",
            "        return list_display",
            "",
            "    @cached_property",
            "    def icon(self):",
            "        return self.get_icon()",
            "",
            "    def get_icon(self):",
            "        \"\"\"",
            "        Returns the icon to be used for the admin views.",
            "",
            "        **Deprecated** - the preferred way to customise this is to define an ``icon`` property.",
            "        \"\"\"",
            "        return \"snippet\"",
            "",
            "    @cached_property",
            "    def menu_label(self):",
            "        return self.get_menu_label()",
            "",
            "    def get_menu_label(self):",
            "        \"\"\"",
            "        Returns the label text to be used for the menu item.",
            "",
            "        **Deprecated** - the preferred way to customise this is to define a ``menu_label`` property.",
            "        \"\"\"",
            "        return self.model_opts.verbose_name_plural.title()",
            "",
            "    @cached_property",
            "    def menu_name(self):",
            "        return self.get_menu_name()",
            "",
            "    def get_menu_name(self):",
            "        \"\"\"",
            "        Returns the name to be used for the menu item.",
            "",
            "        **Deprecated** - the preferred way to customise this is to define a ``menu_name`` property.",
            "        \"\"\"",
            "        return \"\"",
            "",
            "    @cached_property",
            "    def menu_icon(self):",
            "        return self.get_menu_icon()",
            "",
            "    def get_menu_icon(self):",
            "        \"\"\"",
            "        Returns the icon to be used for the menu item.",
            "",
            "        **Deprecated** - the preferred way to customise this is to define a ``menu_icon`` property.",
            "        \"\"\"",
            "        return self.icon",
            "",
            "    @cached_property",
            "    def menu_order(self):",
            "        return self.get_menu_order()",
            "",
            "    def get_menu_order(self):",
            "        \"\"\"",
            "        Returns the ordering number to be applied to the menu item.",
            "",
            "        **Deprecated** - the preferred way to customise this is to define a ``menu_order`` property.",
            "        \"\"\"",
            "        # By default, put it at the last item before Reports, whose order is 9000.",
            "        return 8999",
            "",
            "    def get_menu_item_is_registered(self):",
            "        return self.menu_item_is_registered",
            "",
            "    @cached_property",
            "    def breadcrumbs_items(self):",
            "        # Use reverse_lazy instead of reverse",
            "        # because this will be passed to the view classes at startup",
            "        return [",
            "            {\"url\": reverse_lazy(\"wagtailadmin_home\"), \"label\": _(\"Home\")},",
            "            {\"url\": reverse_lazy(\"wagtailsnippets:index\"), \"label\": _(\"Snippets\")},",
            "        ]",
            "",
            "    def get_queryset(self, request):",
            "        \"\"\"",
            "        Returns a QuerySet of all model instances to be shown on the index view.",
            "        If ``None`` is returned (the default), the logic in",
            "        ``index_view.get_base_queryset()`` will be used instead.",
            "        \"\"\"",
            "        return None",
            "",
            "    @cached_property",
            "    def index_template_name(self):",
            "        return self.get_index_template()",
            "",
            "    def get_index_template(self):",
            "        \"\"\"",
            "        Returns a template to be used when rendering ``index_view``. If a",
            "        template is specified by the ``index_template_name`` attribute, that will",
            "        be used. Otherwise, a list of preferred template names are returned.",
            "",
            "        **Deprecated** - the preferred way to customise this is to define an ``index_template_name`` property.",
            "        \"\"\"",
            "        return self.get_templates(\"index\")",
            "",
            "    @cached_property",
            "    def index_results_template_name(self):",
            "        return self.get_index_results_template()",
            "",
            "    def get_index_results_template(self):",
            "        \"\"\"",
            "        Returns a template to be used when rendering ``index_results_view``. If a",
            "        template is specified by the ``index_results_template_name`` attribute, that will",
            "        be used. Otherwise, a list of preferred template names are returned.",
            "",
            "        **Deprecated** - the preferred way to customise this is to define an ``index_results_template_name`` property.",
            "        \"\"\"",
            "        return self.get_templates(\"index_results\")",
            "",
            "    @cached_property",
            "    def create_template_name(self):",
            "        return self.get_create_template()",
            "",
            "    def get_create_template(self):",
            "        \"\"\"",
            "        Returns a template to be used when rendering ``add_view``. If a",
            "        template is specified by the ``create_template_name`` attribute, that will",
            "        be used. Otherwise, a list of preferred template names are returned.",
            "",
            "        **Deprecated** - the preferred way to customise this is to define a ``create_template_name`` property.",
            "        \"\"\"",
            "        return self.get_templates(\"create\")",
            "",
            "    @cached_property",
            "    def edit_template_name(self):",
            "        return self.get_edit_template()",
            "",
            "    def get_edit_template(self):",
            "        \"\"\"",
            "        Returns a template to be used when rendering ``edit_view``. If a",
            "        template is specified by the ``edit_template_name`` attribute, that will",
            "        be used. Otherwise, a list of preferred template names are returned.",
            "",
            "        **Deprecated** - the preferred way to customise this is to define an ``edit_template_name`` property.",
            "        \"\"\"",
            "        return self.get_templates(\"edit\")",
            "",
            "    @cached_property",
            "    def delete_template_name(self):",
            "        return self.get_delete_template()",
            "",
            "    def get_delete_template(self):",
            "        \"\"\"",
            "        Returns a template to be used when rendering ``delete_view``. If a",
            "        template is specified by the ``delete_template_name`` attribute, that will",
            "        be used. Otherwise, a list of preferred template names are returned.",
            "",
            "        **Deprecated** - the preferred way to customise this is to define a ``delete_template_name`` property.",
            "        \"\"\"",
            "        return self.get_templates(\"delete\")",
            "",
            "    @cached_property",
            "    def history_template_name(self):",
            "        \"\"\"",
            "        A template to be used when rendering ``history_view``.",
            "",
            "        Default: if :attr:`template_prefix` is specified, a ``history.html``",
            "        template in the prefix directory and its ``{app_label}/{model_name}/``",
            "        or ``{app_label}/`` subdirectories will be used. Otherwise, the",
            "        ``history_view_class.template_name`` will be used.",
            "        \"\"\"",
            "        return self.get_history_template()",
            "",
            "    def get_history_template(self):",
            "        \"\"\"",
            "        Returns a template to be used when rendering ``history_view``. If a",
            "        template is specified by the ``history_template_name`` attribute, that will",
            "        be used. Otherwise, a list of preferred template names are returned.",
            "",
            "        **Deprecated** - the preferred way to customise this is to define a ``history_template_name`` property.",
            "        \"\"\"",
            "        return self.get_templates(\"history\")",
            "",
            "    @cached_property",
            "    def inspect_template_name(self):",
            "        \"\"\"",
            "        A template to be used when rendering ``inspect_view``.",
            "",
            "        Default: if :attr:`template_prefix` is specified, an ``inspect.html``",
            "        template in the prefix directory and its ``{app_label}/{model_name}/``",
            "        or ``{app_label}/`` subdirectories will be used. Otherwise, the",
            "        ``inspect_view_class.template_name`` will be used.",
            "        \"\"\"",
            "        return self.get_inspect_template()",
            "",
            "    def get_inspect_template(self):",
            "        \"\"\"",
            "        Returns a template to be used when rendering ``inspect_view``. If a",
            "        template is specified by the ``inspect_template_name`` attribute, that will",
            "        be used. Otherwise, a list of preferred template names are returned.",
            "",
            "        **Deprecated** - the preferred way to customise this is to define an ``inspect_template_name`` property.",
            "        \"\"\"",
            "        return self.get_templates(",
            "            \"inspect\", fallback=self.inspect_view_class.template_name",
            "        )",
            "",
            "    def get_admin_url_namespace(self):",
            "        \"\"\"",
            "        Returns the URL namespace for the admin URLs for this model.",
            "",
            "        **Deprecated** - the preferred way to customise this is to define a ``url_namespace`` property.",
            "        \"\"\"",
            "        if self.admin_url_namespace:",
            "            return self.admin_url_namespace",
            "        return f\"wagtailsnippets_{self.app_label}_{self.model_name}\"",
            "",
            "    def get_admin_base_path(self):",
            "        \"\"\"",
            "        Returns the base path for the admin URLs for this model.",
            "        The returned string must not begin or end with a slash.",
            "",
            "        **Deprecated** - the preferred way to customise this is to define a ``url_prefix`` property.",
            "        \"\"\"",
            "        if self.base_url_path:",
            "            return self.base_url_path.strip().strip(\"/\")",
            "        return f\"snippets/{self.app_label}/{self.model_name}\"",
            "",
            "    def get_chooser_admin_url_namespace(self):",
            "        \"\"\"Returns the URL namespace for the chooser admin URLs for this model.\"\"\"",
            "        if self.chooser_admin_url_namespace:",
            "            return self.chooser_admin_url_namespace",
            "        return f\"wagtailsnippetchoosers_{self.app_label}_{self.model_name}\"",
            "",
            "    def get_chooser_admin_base_path(self):",
            "        \"\"\"",
            "        Returns the base path for the chooser admin URLs for this model.",
            "        The returned string must not begin or end with a slash.",
            "        \"\"\"",
            "        if self.chooser_base_url_path:",
            "            return self.chooser_base_url_path.strip().strip(\"/\")",
            "        return f\"snippets/choose/{self.app_label}/{self.model_name}\"",
            "",
            "    @property",
            "    def url_finder_class(self):",
            "        return type(",
            "            \"_SnippetAdminURLFinder\", (SnippetAdminURLFinder,), {\"model\": self.model}",
            "        )",
            "",
            "    def get_urlpatterns(self):",
            "        urlpatterns = [",
            "            path(\"\", self.index_view, name=\"list\"),",
            "            path(\"results/\", self.index_results_view, name=\"list_results\"),",
            "            path(\"add/\", self.add_view, name=\"add\"),",
            "            path(\"edit/<str:pk>/\", self.edit_view, name=\"edit\"),",
            "            path(\"delete/<str:pk>/\", self.delete_view, name=\"delete\"),",
            "            path(\"usage/<str:pk>/\", self.usage_view, name=\"usage\"),",
            "            path(\"history/<str:pk>/\", self.history_view, name=\"history\"),",
            "            path(",
            "                \"history-results/<str:pk>/\",",
            "                self.history_results_view,",
            "                name=\"history_results\",",
            "            ),",
            "        ]",
            "",
            "        if self.copy_view_enabled:",
            "            urlpatterns += [path(\"copy/<str:pk>/\", self.copy_view, name=\"copy\")]",
            "",
            "        if self.inspect_view_enabled:",
            "            urlpatterns += [",
            "                path(\"inspect/<str:pk>/\", self.inspect_view, name=\"inspect\")",
            "            ]",
            "",
            "        if self.preview_enabled:",
            "            urlpatterns += [",
            "                path(\"preview/\", self.preview_on_add_view, name=\"preview_on_add\"),",
            "                path(",
            "                    \"preview/<str:pk>/\",",
            "                    self.preview_on_edit_view,",
            "                    name=\"preview_on_edit\",",
            "                ),",
            "            ]",
            "",
            "        if self.revision_enabled:",
            "            if self.preview_enabled:",
            "                urlpatterns += [",
            "                    path(",
            "                        \"history/<str:pk>/revisions/<int:revision_id>/view/\",",
            "                        self.revisions_view,",
            "                        name=\"revisions_view\",",
            "                    )",
            "                ]",
            "",
            "            urlpatterns += [",
            "                path(",
            "                    \"history/<str:pk>/revisions/<int:revision_id>/revert/\",",
            "                    self.revisions_revert_view,",
            "                    name=\"revisions_revert\",",
            "                ),",
            "                re_path(",
            "                    r\"history/(?P<pk>.+)/revisions/compare/(?P<revision_id_a>live|earliest|\\d+)\\.\\.\\.(?P<revision_id_b>live|latest|\\d+)/$\",",
            "                    self.revisions_compare_view,",
            "                    name=\"revisions_compare\",",
            "                ),",
            "            ]",
            "",
            "        if self.draftstate_enabled:",
            "            urlpatterns += [",
            "                path(",
            "                    \"history/<str:pk>/revisions/<int:revision_id>/unschedule/\",",
            "                    self.revisions_unschedule_view,",
            "                    name=\"revisions_unschedule\",",
            "                ),",
            "                path(\"unpublish/<str:pk>/\", self.unpublish_view, name=\"unpublish\"),",
            "            ]",
            "",
            "        if self.locking_enabled:",
            "            urlpatterns += [",
            "                path(\"lock/<str:pk>/\", self.lock_view, name=\"lock\"),",
            "                path(\"unlock/<str:pk>/\", self.unlock_view, name=\"unlock\"),",
            "            ]",
            "",
            "        if self.workflow_enabled:",
            "            urlpatterns += [",
            "                path(",
            "                    \"workflow/action/<str:pk>/<slug:action_name>/<int:task_state_id>/\",",
            "                    self.workflow_action_view,",
            "                    name=\"workflow_action\",",
            "                ),",
            "                path(",
            "                    \"workflow/collect_action_data/<str:pk>/<slug:action_name>/<int:task_state_id>/\",",
            "                    self.collect_workflow_action_data_view,",
            "                    name=\"collect_workflow_action_data\",",
            "                ),",
            "                path(",
            "                    \"workflow/confirm_cancellation/<str:pk>/\",",
            "                    self.confirm_workflow_cancellation_view,",
            "                    name=\"confirm_workflow_cancellation\",",
            "                ),",
            "                path(",
            "                    \"workflow_history/<str:pk>/\",",
            "                    self.workflow_history_view,",
            "                    name=\"workflow_history\",",
            "                ),",
            "                path(",
            "                    \"workflow_history/<str:pk>/detail/<int:workflow_state_id>/\",",
            "                    self.workflow_history_detail_view,",
            "                    name=\"workflow_history_detail\",",
            "                ),",
            "            ]",
            "",
            "            if self.preview_enabled:",
            "                urlpatterns += [",
            "                    path(",
            "                        \"workflow/preview/<str:pk>/<int:task_id>/\",",
            "                        self.workflow_preview_view,",
            "                        name=\"workflow_preview\",",
            "                    ),",
            "                ]",
            "",
            "        # RemovedInWagtail70Warning: Remove legacy URL patterns",
            "        return urlpatterns + self._legacy_urlpatterns",
            "",
            "    @cached_property",
            "    def _legacy_urlpatterns(self):",
            "        return [",
            "            # RemovedInWagtail70Warning: Remove legacy URL patterns",
            "            # legacy URLs that could potentially collide if the pk matches one of the reserved names above",
            "            # ('add', 'edit' etc) - redirect to the unambiguous version",
            "            path(\"<str:pk>/\", self.redirect_to_edit_view),",
            "            path(\"<str:pk>/delete/\", self.redirect_to_delete_view),",
            "            path(\"<str:pk>/usage/\", self.redirect_to_usage_view),",
            "        ]",
            "",
            "    def get_edit_handler(self):",
            "        \"\"\"",
            "        Like :meth:`ModelViewSet.get_edit_handler()",
            "        <wagtail.admin.viewsets.model.ModelViewSet.get_edit_handler>`,",
            "        but falls back to extracting panel definitions from the model class",
            "        if no edit handler is defined.",
            "        \"\"\"",
            "        edit_handler = super().get_edit_handler()",
            "        if edit_handler:",
            "            return edit_handler",
            "",
            "        exclude = self.get_exclude_form_fields()",
            "        panels = extract_panel_definitions_from_model_class(self.model, exclude=exclude)",
            "        edit_handler = ObjectList(panels)",
            "        return edit_handler.bind_to_model(self.model)",
            "",
            "    def register_chooser_viewset(self):",
            "        viewsets.register(self.chooser_viewset)",
            "",
            "    def register_model_check(self):",
            "        def snippets_model_check(app_configs, **kwargs):",
            "            return check_panels_in_model(self.model, \"snippets\")",
            "",
            "        checks.register(snippets_model_check, \"panels\")",
            "",
            "    def register_snippet_model(self):",
            "        snippet_models = get_snippet_models()",
            "        if self.model in snippet_models:",
            "            raise ImproperlyConfigured(",
            "                f\"The {self.model.__name__} model is already registered as a snippet\"",
            "            )",
            "        snippet_models.append(self.model)",
            "        snippet_models.sort(key=lambda x: x._meta.verbose_name)",
            "",
            "    def on_register(self):",
            "        super().on_register()",
            "        # For convenience, attach viewset to the model class to allow accessing",
            "        # the configuration of a given model.",
            "        self.model.snippet_viewset = self",
            "        self.register_chooser_viewset()",
            "        self.register_model_check()",
            "        self.register_snippet_model()",
            "",
            "",
            "class SnippetViewSetGroup(ModelViewSetGroup):",
            "    \"\"\"",
            "    A container for grouping together multiple",
            "    :class:`~wagtail.snippets.views.snippets.SnippetViewSet` instances.",
            "",
            "    All attributes and methods from",
            "    :class:`~wagtail.admin.viewsets.model.ModelViewSetGroup` are available.",
            "    \"\"\"",
            "",
            "    def __init__(self):",
            "        menu_item_is_registered = getattr(",
            "            self, \"menu_item_is_registered\", bool(self.menu_hook)",
            "        )",
            "        # If the menu item is registered, mark all viewsets as such so that we can",
            "        # hide the \"Snippets\" menu item if all snippets have their own menu items.",
            "        for item in self.items:",
            "            item.menu_item_is_registered = menu_item_is_registered",
            "",
            "        # Call super() after setting menu_item_is_registered so that nested groups",
            "        # can inherit the value.",
            "        super().__init__()"
        ],
        "afterPatchFile": [
            "from warnings import warn",
            "",
            "from django.apps import apps",
            "from django.contrib.admin.utils import quote",
            "from django.core import checks",
            "from django.core.exceptions import ImproperlyConfigured, PermissionDenied",
            "from django.http import Http404",
            "from django.shortcuts import get_object_or_404, redirect",
            "from django.urls import path, re_path, reverse, reverse_lazy",
            "from django.utils.functional import cached_property",
            "from django.utils.text import capfirst",
            "from django.utils.translation import gettext as _",
            "from django.utils.translation import gettext_lazy",
            "",
            "from wagtail import hooks",
            "from wagtail.admin.checks import check_panels_in_model",
            "from wagtail.admin.panels import ObjectList, extract_panel_definitions_from_model_class",
            "from wagtail.admin.ui.components import MediaContainer",
            "from wagtail.admin.ui.side_panels import ChecksSidePanel, PreviewSidePanel",
            "from wagtail.admin.ui.tables import (",
            "    BulkActionsCheckboxColumn,",
            "    Column,",
            "    DateColumn,",
            "    LiveStatusTagColumn,",
            "    TitleColumn,",
            "    UserColumn,",
            ")",
            "from wagtail.admin.views import generic",
            "from wagtail.admin.views.generic import history, lock, workflow",
            "from wagtail.admin.views.generic.permissions import PermissionCheckedMixin",
            "from wagtail.admin.views.generic.preview import (",
            "    PreviewOnCreate,",
            "    PreviewOnEdit,",
            "    PreviewRevision,",
            ")",
            "from wagtail.admin.viewsets import viewsets",
            "from wagtail.admin.viewsets.model import ModelViewSet, ModelViewSetGroup",
            "from wagtail.admin.widgets.button import (",
            "    BaseDropdownMenuButton,",
            "    ButtonWithDropdown,",
            ")",
            "from wagtail.models import (",
            "    DraftStateMixin,",
            "    LockableMixin,",
            "    PreviewableMixin,",
            "    RevisionMixin,",
            "    WorkflowMixin,",
            ")",
            "from wagtail.permissions import ModelPermissionPolicy",
            "from wagtail.snippets.action_menu import SnippetActionMenu",
            "from wagtail.snippets.models import SnippetAdminURLFinder, get_snippet_models",
            "from wagtail.snippets.permissions import user_can_edit_snippet_type",
            "from wagtail.snippets.side_panels import SnippetStatusSidePanel",
            "from wagtail.snippets.views.chooser import SnippetChooserViewSet",
            "from wagtail.utils.deprecation import RemovedInWagtail70Warning",
            "",
            "",
            "# == Helper functions ==",
            "def get_snippet_model_from_url_params(app_name, model_name):",
            "    \"\"\"",
            "    Retrieve a model from an app_label / model_name combo.",
            "    Raise Http404 if the model is not a valid snippet type.",
            "    \"\"\"",
            "    try:",
            "        model = apps.get_model(app_name, model_name)",
            "    except LookupError:",
            "        raise Http404",
            "    if model not in get_snippet_models():",
            "        # don't allow people to hack the URL to edit content types that aren't registered as snippets",
            "        raise Http404",
            "",
            "    return model",
            "",
            "",
            "# == Views ==",
            "",
            "",
            "class ModelIndexView(generic.BaseListingView):",
            "    page_title = gettext_lazy(\"Snippets\")",
            "    header_icon = \"snippet\"",
            "    index_url_name = \"wagtailsnippets:index\"",
            "    default_ordering = \"name\"",
            "    _show_breadcrumbs = True",
            "",
            "    def setup(self, request, *args, **kwargs):",
            "        super().setup(request, *args, **kwargs)",
            "        self.snippet_types = self._get_snippet_types()",
            "",
            "    def _get_snippet_types(self):",
            "        return [",
            "            {",
            "                \"name\": capfirst(model._meta.verbose_name_plural),",
            "                \"count\": model.objects.all().count(),",
            "                \"model\": model,",
            "            }",
            "            for model in get_snippet_models()",
            "            if user_can_edit_snippet_type(self.request.user, model)",
            "        ]",
            "",
            "    def dispatch(self, request, *args, **kwargs):",
            "        if not self.snippet_types:",
            "            raise PermissionDenied",
            "        return super().dispatch(request, *args, **kwargs)",
            "",
            "    def get_breadcrumbs_items(self):",
            "        return self.breadcrumbs_items + [{\"url\": \"\", \"label\": _(\"Snippets\")}]",
            "",
            "    def get_list_url(self, type):",
            "        return reverse(type[\"model\"].snippet_viewset.get_url_name(\"list\"))",
            "",
            "    def get_queryset(self):",
            "        return None",
            "",
            "    @cached_property",
            "    def columns(self):",
            "        return [",
            "            TitleColumn(",
            "                \"name\",",
            "                label=_(\"Name\"),",
            "                get_url=self.get_list_url,",
            "                sort_key=\"name\",",
            "            ),",
            "            Column(",
            "                \"count\",",
            "                label=_(\"Instances\"),",
            "                sort_key=\"count\",",
            "            ),",
            "        ]",
            "",
            "    def get_context_data(self, **kwargs):",
            "        reverse = self.ordering[0] == \"-\"",
            "",
            "        if self.ordering in [\"count\", \"-count\"]:",
            "            snippet_types = sorted(",
            "                self.snippet_types,",
            "                key=lambda type: type[\"count\"],",
            "                reverse=reverse,",
            "            )",
            "        else:",
            "            snippet_types = sorted(",
            "                self.snippet_types,",
            "                key=lambda type: type[\"name\"].lower(),",
            "                reverse=reverse,",
            "            )",
            "",
            "        return super().get_context_data(object_list=snippet_types)",
            "",
            "    def get_template_names(self):",
            "        # We use the generic index template instead of model_index.html,",
            "        # but we look for it anyway so users can customise this view's template",
            "        # without having to override the entire view or the generic template.",
            "        return [",
            "            \"wagtailsnippets/snippets/model_index.html\",",
            "            self.template_name,",
            "        ]",
            "",
            "",
            "class IndexView(generic.IndexViewOptionalFeaturesMixin, generic.IndexView):",
            "    view_name = \"list\"",
            "",
            "    def get_base_queryset(self):",
            "        # Allow the queryset to be a callable that takes a request",
            "        # so that it can be evaluated in the context of the request",
            "        if callable(self.queryset):",
            "            self.queryset = self.queryset(self.request)",
            "        return super().get_base_queryset()",
            "",
            "    @cached_property",
            "    def columns(self):",
            "        return [",
            "            BulkActionsCheckboxColumn(\"bulk_actions\", obj_type=\"snippet\"),",
            "            *super().columns,",
            "        ]",
            "",
            "    def _get_title_column(self, *args, **kwargs):",
            "        return super()._get_title_column(",
            "            *args,",
            "            **kwargs,",
            "            get_title_id=lambda instance: f\"snippet_{quote(instance.pk)}_title\",",
            "        )",
            "",
            "    def get_list_buttons(self, instance):",
            "        more_buttons = self.get_list_more_buttons(instance)",
            "        next_url = self.request.path",
            "        list_buttons = []",
            "",
            "        for hook in hooks.get_hooks(\"register_snippet_listing_buttons\"):",
            "            hook_buttons = hook(instance, self.request.user, next_url)",
            "            for button in hook_buttons:",
            "                if isinstance(button, BaseDropdownMenuButton):",
            "                    # If the button is a dropdown menu, add it to the top-level",
            "                    # because we do not support nested dropdowns",
            "                    list_buttons.append(button)",
            "                else:",
            "                    # Otherwise, add it to the default \"More\" dropdown",
            "                    more_buttons.append(button)",
            "",
            "        # Pass the more_buttons to the construct hooks, as that's what contains",
            "        # the default buttons and most buttons added via register_snippet_listing_buttons",
            "        for hook in hooks.get_hooks(\"construct_snippet_listing_buttons\"):",
            "            try:",
            "                hook(more_buttons, instance, self.request.user)",
            "            except TypeError:",
            "                warn(",
            "                    \"construct_snippet_listing_buttons hook no longer accepts a context argument\",",
            "                    RemovedInWagtail70Warning,",
            "                    stacklevel=2,",
            "                )",
            "                hook(more_buttons, instance, self.request.user, {})",
            "",
            "        list_buttons.append(",
            "            ButtonWithDropdown(",
            "                buttons=more_buttons,",
            "                icon_name=\"dots-horizontal\",",
            "                attrs={",
            "                    \"aria-label\": _(\"More options for '%(title)s'\")",
            "                    % {\"title\": str(instance)},",
            "                },",
            "            )",
            "        )",
            "",
            "        return list_buttons",
            "",
            "",
            "class CreateView(generic.CreateEditViewOptionalFeaturesMixin, generic.CreateView):",
            "    view_name = \"create\"",
            "    template_name = \"wagtailsnippets/snippets/create.html\"",
            "",
            "    def run_before_hook(self):",
            "        return self.run_hook(\"before_create_snippet\", self.request, self.model)",
            "",
            "    def run_after_hook(self):",
            "        return self.run_hook(\"after_create_snippet\", self.request, self.object)",
            "",
            "    def _get_action_menu(self):",
            "        return SnippetActionMenu(self.request, view=self.view_name, model=self.model)",
            "",
            "    def _get_initial_form_instance(self):",
            "        instance = self.model()",
            "",
            "        # Set locale of the new instance",
            "        if self.locale:",
            "            instance.locale = self.locale",
            "",
            "        return instance",
            "",
            "    def get_form_kwargs(self):",
            "        return {",
            "            **super().get_form_kwargs(),",
            "            \"instance\": self._get_initial_form_instance(),",
            "            \"for_user\": self.request.user,",
            "        }",
            "",
            "    def get_side_panels(self):",
            "        side_panels = [",
            "            SnippetStatusSidePanel(",
            "                self.form.instance,",
            "                self.request,",
            "                show_schedule_publishing_toggle=getattr(",
            "                    self.form, \"show_schedule_publishing_toggle\", False",
            "                ),",
            "                locale=self.locale,",
            "                translations=self.translations,",
            "            )",
            "        ]",
            "        if self.preview_enabled and self.form.instance.is_previewable():",
            "            side_panels.append(",
            "                PreviewSidePanel(",
            "                    self.form.instance, self.request, preview_url=self.get_preview_url()",
            "                )",
            "            )",
            "            side_panels.append(ChecksSidePanel(self.form.instance, self.request))",
            "        return MediaContainer(side_panels)",
            "",
            "    def get_context_data(self, **kwargs):",
            "        context = super().get_context_data(**kwargs)",
            "        action_menu = self._get_action_menu()",
            "        context[\"media\"] += action_menu.media",
            "        context[\"action_menu\"] = action_menu",
            "        return context",
            "",
            "",
            "class CopyView(CreateView):",
            "    def get_object(self):",
            "        return get_object_or_404(self.model, pk=self.kwargs[\"pk\"])",
            "",
            "    def _get_initial_form_instance(self):",
            "        instance = self.get_object()",
            "        # Set locale of the new instance",
            "        if self.locale:",
            "            instance.locale = self.locale",
            "        return instance",
            "",
            "",
            "class EditView(generic.CreateEditViewOptionalFeaturesMixin, generic.EditView):",
            "    view_name = \"edit\"",
            "    template_name = \"wagtailsnippets/snippets/edit.html\"",
            "",
            "    def run_before_hook(self):",
            "        return self.run_hook(\"before_edit_snippet\", self.request, self.object)",
            "",
            "    def run_after_hook(self):",
            "        return self.run_hook(\"after_edit_snippet\", self.request, self.object)",
            "",
            "    def _get_action_menu(self):",
            "        return SnippetActionMenu(",
            "            self.request,",
            "            view=self.view_name,",
            "            instance=self.object,",
            "            locked_for_user=self.locked_for_user,",
            "        )",
            "",
            "    def get_form_kwargs(self):",
            "        return {**super().get_form_kwargs(), \"for_user\": self.request.user}",
            "",
            "    def get_side_panels(self):",
            "        side_panels = [",
            "            SnippetStatusSidePanel(",
            "                self.object,",
            "                self.request,",
            "                show_schedule_publishing_toggle=getattr(",
            "                    self.form, \"show_schedule_publishing_toggle\", False",
            "                ),",
            "                live_object=self.live_object,",
            "                scheduled_object=self.live_object.get_scheduled_revision_as_object()",
            "                if self.draftstate_enabled",
            "                else None,",
            "                locale=self.locale,",
            "                translations=self.translations,",
            "                usage_url=self.get_usage_url(),",
            "                history_url=self.get_history_url(),",
            "                last_updated_info=self.get_last_updated_info(),",
            "            )",
            "        ]",
            "        if self.preview_enabled and self.object.is_previewable():",
            "            side_panels.append(",
            "                PreviewSidePanel(",
            "                    self.object, self.request, preview_url=self.get_preview_url()",
            "                )",
            "            )",
            "            side_panels.append(ChecksSidePanel(self.object, self.request))",
            "        return MediaContainer(side_panels)",
            "",
            "    def get_context_data(self, **kwargs):",
            "        context = super().get_context_data(**kwargs)",
            "        action_menu = self._get_action_menu()",
            "        context[\"media\"] += action_menu.media",
            "        context[\"action_menu\"] = action_menu",
            "        return context",
            "",
            "",
            "class DeleteView(generic.DeleteView):",
            "    view_name = \"delete\"",
            "",
            "    def run_before_hook(self):",
            "        return self.run_hook(\"before_delete_snippet\", self.request, [self.object])",
            "",
            "    def run_after_hook(self):",
            "        return self.run_hook(\"after_delete_snippet\", self.request, [self.object])",
            "",
            "",
            "class UsageView(generic.UsageView):",
            "    view_name = \"usage\"",
            "",
            "",
            "class ActionColumn(Column):",
            "    cell_template_name = \"wagtailsnippets/snippets/revisions/_actions.html\"",
            "",
            "    def __init__(self, *args, object=None, view=None, **kwargs):",
            "        super().__init__(*args, **kwargs)",
            "        self.object = object",
            "        self.view = view",
            "",
            "    def get_cell_context_data(self, instance, parent_context):",
            "        context = super().get_cell_context_data(instance, parent_context)",
            "        context[\"revision_enabled\"] = isinstance(self.object, RevisionMixin)",
            "        context[\"draftstate_enabled\"] = isinstance(self.object, DraftStateMixin)",
            "        context[\"preview_enabled\"] = isinstance(self.object, PreviewableMixin)",
            "        context[\"can_publish\"] = self.view.user_has_permission(\"publish\")",
            "        context[\"object\"] = self.object",
            "        context[\"view\"] = self.view",
            "        return context",
            "",
            "",
            "class HistoryView(history.HistoryView):",
            "    view_name = \"history\"",
            "    revisions_view_url_name = None",
            "    revisions_revert_url_name = None",
            "    revisions_compare_url_name = None",
            "    revisions_unschedule_url_name = None",
            "",
            "    @cached_property",
            "    def columns(self):",
            "        return [",
            "            ActionColumn(",
            "                \"message\",",
            "                object=self.object,",
            "                view=self,",
            "                classname=\"title\",",
            "                label=_(\"Action\"),",
            "            ),",
            "            UserColumn(\"user\", blank_display_name=\"system\"),",
            "            DateColumn(\"timestamp\", label=_(\"Date\")),",
            "        ]",
            "",
            "",
            "class InspectView(generic.InspectView):",
            "    view_name = \"inspect\"",
            "",
            "",
            "class PreviewOnCreateView(PreviewOnCreate):",
            "    pass",
            "",
            "",
            "class PreviewOnEditView(PreviewOnEdit):",
            "    pass",
            "",
            "",
            "class PreviewRevisionView(PermissionCheckedMixin, PreviewRevision):",
            "    permission_required = \"change\"",
            "",
            "",
            "class RevisionsCompareView(PermissionCheckedMixin, generic.RevisionsCompareView):",
            "    permission_required = \"change\"",
            "",
            "    @property",
            "    def edit_label(self):",
            "        return _(\"Edit this %(model_name)s\") % {",
            "            \"model_name\": self.model._meta.verbose_name",
            "        }",
            "",
            "    @property",
            "    def history_label(self):",
            "        return _(\"%(model_name)s history\") % {",
            "            \"model_name\": self.model._meta.verbose_name",
            "        }",
            "",
            "",
            "class UnpublishView(PermissionCheckedMixin, generic.UnpublishView):",
            "    permission_required = \"publish\"",
            "",
            "",
            "class RevisionsUnscheduleView(PermissionCheckedMixin, generic.RevisionsUnscheduleView):",
            "    permission_required = \"publish\"",
            "",
            "",
            "class LockView(PermissionCheckedMixin, lock.LockView):",
            "    permission_required = \"lock\"",
            "",
            "    def user_has_permission(self, permission):",
            "        if self.request.user.is_superuser:",
            "            return True",
            "",
            "        if permission == self.permission_required and isinstance(",
            "            self.object, WorkflowMixin",
            "        ):",
            "            current_workflow_task = self.object.current_workflow_task",
            "            if current_workflow_task:",
            "                return current_workflow_task.user_can_lock(",
            "                    self.object, self.request.user",
            "                )",
            "",
            "        return super().user_has_permission(permission)",
            "",
            "",
            "class UnlockView(PermissionCheckedMixin, lock.UnlockView):",
            "    permission_required = \"unlock\"",
            "",
            "    def user_has_permission(self, permission):",
            "        if self.request.user.is_superuser:",
            "            return True",
            "",
            "        if permission == self.permission_required:",
            "            # Allow unlocking even if the user does not have the 'unlock' permission",
            "            # if they are the user who locked the object",
            "            if self.object.locked_by_id == self.request.user.pk:",
            "                return True",
            "",
            "            if isinstance(self.object, WorkflowMixin):",
            "                current_workflow_task = self.object.current_workflow_task",
            "                if current_workflow_task:",
            "                    return current_workflow_task.user_can_unlock(",
            "                        self.object, self.request.user",
            "                    )",
            "",
            "        return super().user_has_permission(permission)",
            "",
            "",
            "class WorkflowActionView(workflow.WorkflowAction):",
            "    pass",
            "",
            "",
            "class CollectWorkflowActionDataView(workflow.CollectWorkflowActionData):",
            "    pass",
            "",
            "",
            "class ConfirmWorkflowCancellationView(workflow.ConfirmWorkflowCancellation):",
            "    pass",
            "",
            "",
            "class WorkflowPreviewView(workflow.PreviewRevisionForTask):",
            "    pass",
            "",
            "",
            "class WorkflowHistoryView(PermissionCheckedMixin, history.WorkflowHistoryView):",
            "    permission_required = \"change\"",
            "",
            "",
            "class WorkflowHistoryDetailView(",
            "    PermissionCheckedMixin, history.WorkflowHistoryDetailView",
            "):",
            "    permission_required = \"change\"",
            "",
            "",
            "class SnippetViewSet(ModelViewSet):",
            "    \"\"\"",
            "    A viewset that instantiates the admin views for snippets.",
            "",
            "    All attributes and methods from",
            "    :class:`~wagtail.admin.viewsets.model.ModelViewSet` are available.",
            "",
            "    For more information on how to use this class,",
            "    see :ref:`wagtailsnippets_custom_admin_views`.",
            "    \"\"\"",
            "",
            "    #: The model class to be registered as a snippet with this viewset.",
            "    model = None",
            "",
            "    #: The number of items to display in the chooser view. Defaults to 10.",
            "    chooser_per_page = 10",
            "",
            "    #: The URL namespace to use for the admin views.",
            "    #: If left unset, ``wagtailsnippets_{app_label}_{model_name}`` is used instead.",
            "    #:",
            "    #: **Deprecated** - the preferred attribute to customise is :attr:`~.ViewSet.url_namespace`.",
            "    admin_url_namespace = None",
            "",
            "    #: The base URL path to use for the admin views.",
            "    #: If left unset, ``snippets/{app_label}/{model_name}`` is used instead.",
            "    #:",
            "    #: **Deprecated** - the preferred attribute to customise is :attr:`~.ViewSet.url_prefix`.",
            "    base_url_path = None",
            "",
            "    #: The URL namespace to use for the chooser admin views.",
            "    #: If left unset, ``wagtailsnippetchoosers_{app_label}_{model_name}`` is used instead.",
            "    chooser_admin_url_namespace = None",
            "",
            "    #: The base URL path to use for the chooser admin views.",
            "    #: If left unset, ``snippets/choose/{app_label}/{model_name}`` is used instead.",
            "    chooser_base_url_path = None",
            "",
            "    #: The view class to use for the index view; must be a subclass of ``wagtail.snippets.views.snippets.IndexView``.",
            "    index_view_class = IndexView",
            "",
            "    #: The view class to use for the create view; must be a subclass of ``wagtail.snippets.views.snippets.CreateView``.",
            "    add_view_class = CreateView",
            "",
            "    #: The view class to use for the copy view; must be a subclass of ``wagtail.snippet.views.snippets.CopyView``.",
            "    copy_view_class = CopyView",
            "",
            "    #: The view class to use for the edit view; must be a subclass of ``wagtail.snippets.views.snippets.EditView``.",
            "    edit_view_class = EditView",
            "",
            "    #: The view class to use for the delete view; must be a subclass of ``wagtail.snippets.views.snippets.DeleteView``.",
            "    delete_view_class = DeleteView",
            "",
            "    #: The view class to use for the usage view; must be a subclass of ``wagtail.snippets.views.snippets.UsageView``.",
            "    usage_view_class = UsageView",
            "",
            "    #: The view class to use for the history view; must be a subclass of ``wagtail.snippets.views.snippets.HistoryView``.",
            "    history_view_class = HistoryView",
            "",
            "    #: The view class to use for the inspect view; must be a subclass of ``wagtail.snippets.views.snippets.InspectView``.",
            "    inspect_view_class = InspectView",
            "",
            "    #: The view class to use for previewing revisions; must be a subclass of ``wagtail.snippets.views.snippets.PreviewRevisionView``.",
            "    revisions_view_class = PreviewRevisionView",
            "",
            "    #: The view class to use for comparing revisions; must be a subclass of ``wagtail.snippets.views.snippets.RevisionsCompareView``.",
            "    revisions_compare_view_class = RevisionsCompareView",
            "",
            "    #: The view class to use for unscheduling revisions; must be a subclass of ``wagtail.snippets.views.snippets.RevisionsUnscheduleView``.",
            "    revisions_unschedule_view_class = RevisionsUnscheduleView",
            "",
            "    #: The view class to use for unpublishing a snippet; must be a subclass of ``wagtail.snippets.views.snippets.UnpublishView``.",
            "    unpublish_view_class = UnpublishView",
            "",
            "    #: The view class to use for previewing on the create view; must be a subclass of ``wagtail.snippets.views.snippets.PreviewOnCreateView``.",
            "    preview_on_add_view_class = PreviewOnCreateView",
            "",
            "    #: The view class to use for previewing on the edit view; must be a subclass of ``wagtail.snippets.views.snippets.PreviewOnEditView``.",
            "    preview_on_edit_view_class = PreviewOnEditView",
            "",
            "    #: The view class to use for locking a snippet; must be a subclass of ``wagtail.snippets.views.snippets.LockView``.",
            "    lock_view_class = LockView",
            "",
            "    #: The view class to use for unlocking a snippet; must be a subclass of ``wagtail.snippets.views.snippets.UnlockView``.",
            "    unlock_view_class = UnlockView",
            "",
            "    #: The view class to use for performing a workflow action; must be a subclass of ``wagtail.snippets.views.snippets.WorkflowActionView``.",
            "    workflow_action_view_class = WorkflowActionView",
            "",
            "    #: The view class to use for performing a workflow action that returns the validated data in the response; must be a subclass of ``wagtail.snippets.views.snippets.CollectWorkflowActionDataView``.",
            "    collect_workflow_action_data_view_class = CollectWorkflowActionDataView",
            "",
            "    #: The view class to use for confirming the cancellation of a workflow; must be a subclass of ``wagtail.snippets.views.snippets.ConfirmWorkflowCancellationView``.",
            "    confirm_workflow_cancellation_view_class = ConfirmWorkflowCancellationView",
            "",
            "    #: The view class to use for previewing a revision for a specific task; must be a subclass of ``wagtail.snippets.views.snippets.WorkflowPreviewView``.",
            "    workflow_preview_view_class = WorkflowPreviewView",
            "",
            "    #: The view class to use for the workflow history view; must be a subclass of ``wagtail.snippets.views.snippets.WorkflowHistoryView``.",
            "    workflow_history_view_class = WorkflowHistoryView",
            "",
            "    #: The view class to use for the workflow history detail view; must be a subclass of ``wagtail.snippets.views.snippets.WorkflowHistoryDetailView``.",
            "    workflow_history_detail_view_class = WorkflowHistoryDetailView",
            "",
            "    #: The ViewSet class to use for the chooser views; must be a subclass of ``wagtail.snippets.views.chooser.SnippetChooserViewSet``.",
            "    chooser_viewset_class = SnippetChooserViewSet",
            "",
            "    #: The prefix of template names to look for when rendering the admin views.",
            "    template_prefix = \"wagtailsnippets/snippets/\"",
            "",
            "    def __init__(self, **kwargs):",
            "        super().__init__(**kwargs)",
            "",
            "        if self.model is None:",
            "            raise ImproperlyConfigured(",
            "                \"SnippetViewSet must be passed a model or define a model attribute.\"",
            "            )",
            "",
            "        self.model_opts = self.model._meta",
            "        self.app_label = self.model_opts.app_label",
            "        self.model_name = self.model_opts.model_name",
            "",
            "        self.preview_enabled = issubclass(self.model, PreviewableMixin)",
            "        self.revision_enabled = issubclass(self.model, RevisionMixin)",
            "        self.draftstate_enabled = issubclass(self.model, DraftStateMixin)",
            "        self.workflow_enabled = issubclass(self.model, WorkflowMixin)",
            "        self.locking_enabled = issubclass(self.model, LockableMixin)",
            "",
            "        self.menu_item_is_registered = getattr(",
            "            self, \"menu_item_is_registered\", bool(self.menu_hook)",
            "        )",
            "",
            "    @cached_property",
            "    def url_prefix(self):",
            "        # SnippetViewSet historically allows overriding the URL prefix via the",
            "        # get_admin_base_path method or the admin_base_path attribute, so preserve that here",
            "        return self.get_admin_base_path()",
            "",
            "    @cached_property",
            "    def url_namespace(self):",
            "        # SnippetViewSet historically allows overriding the URL namespace via the",
            "        # get_admin_url_namespace method or the admin_url_namespace attribute,",
            "        # so preserve that here",
            "        return self.get_admin_url_namespace()",
            "",
            "    @property",
            "    def revisions_revert_view_class(self):",
            "        \"\"\"",
            "        The view class to use for reverting to a previous revision.",
            "",
            "        By default, this class is generated by combining the edit view with",
            "        ``wagtail.admin.views.generic.mixins.RevisionsRevertMixin``. As a result,",
            "        this class must be a subclass of ``wagtail.snippets.views.snippets.EditView``",
            "        and must handle the reversion correctly.",
            "        \"\"\"",
            "        revisions_revert_view_class = type(",
            "            \"_RevisionsRevertView\",",
            "            (generic.RevisionsRevertMixin, self.edit_view_class),",
            "            {\"view_name\": \"revisions_revert\"},",
            "        )",
            "        return revisions_revert_view_class",
            "",
            "    @property",
            "    def permission_policy(self):",
            "        return ModelPermissionPolicy(self.model)",
            "",
            "    def get_common_view_kwargs(self, **kwargs):",
            "        return super().get_common_view_kwargs(",
            "            **{",
            "                \"index_url_name\": self.get_url_name(\"list\"),",
            "                \"index_results_url_name\": self.get_url_name(\"list_results\"),",
            "                \"lock_url_name\": self.get_url_name(\"lock\"),",
            "                \"unlock_url_name\": self.get_url_name(\"unlock\"),",
            "                \"revisions_view_url_name\": self.get_url_name(\"revisions_view\"),",
            "                \"revisions_revert_url_name\": self.get_url_name(\"revisions_revert\"),",
            "                \"revisions_compare_url_name\": self.get_url_name(\"revisions_compare\"),",
            "                \"revisions_unschedule_url_name\": self.get_url_name(",
            "                    \"revisions_unschedule\"",
            "                ),",
            "                \"unpublish_url_name\": self.get_url_name(\"unpublish\"),",
            "                \"breadcrumbs_items\": self.breadcrumbs_items,",
            "                **kwargs,",
            "            }",
            "        )",
            "",
            "    def get_index_view_kwargs(self, **kwargs):",
            "        return super().get_index_view_kwargs(",
            "            queryset=self.get_queryset,",
            "            **kwargs,",
            "        )",
            "",
            "    def get_add_view_kwargs(self, **kwargs):",
            "        return super().get_add_view_kwargs(",
            "            preview_url_name=self.get_url_name(\"preview_on_add\"),",
            "            **kwargs,",
            "        )",
            "",
            "    def get_copy_view_kwargs(self, **kwargs):",
            "        return self.get_add_view_kwargs(**kwargs)",
            "",
            "    def get_edit_view_kwargs(self, **kwargs):",
            "        return super().get_edit_view_kwargs(",
            "            preview_url_name=self.get_url_name(\"preview_on_edit\"),",
            "            workflow_history_url_name=self.get_url_name(\"workflow_history\"),",
            "            confirm_workflow_cancellation_url_name=self.get_url_name(",
            "                \"confirm_workflow_cancellation\"",
            "            ),",
            "            **kwargs,",
            "        )",
            "",
            "    @property",
            "    def revisions_view(self):",
            "        return self.construct_view(self.revisions_view_class)",
            "",
            "    @property",
            "    def revisions_revert_view(self):",
            "        return self.construct_view(",
            "            self.revisions_revert_view_class,",
            "            **self.get_edit_view_kwargs(),",
            "        )",
            "",
            "    @property",
            "    def revisions_compare_view(self):",
            "        return self.construct_view(",
            "            self.revisions_compare_view_class,",
            "            edit_handler=self._edit_handler,",
            "            template_name=self.get_templates(",
            "                \"revisions_compare\",",
            "                fallback=self.revisions_compare_view_class.template_name,",
            "            ),",
            "        )",
            "",
            "    @property",
            "    def revisions_unschedule_view(self):",
            "        return self.construct_view(",
            "            self.revisions_unschedule_view_class,",
            "            template_name=self.get_templates(",
            "                \"revisions_unschedule\",",
            "                fallback=self.revisions_unschedule_view_class.template_name,",
            "            ),",
            "        )",
            "",
            "    @property",
            "    def unpublish_view(self):",
            "        return self.construct_view(",
            "            self.unpublish_view_class,",
            "            template_name=self.get_templates(",
            "                \"unpublish\", fallback=self.unpublish_view_class.template_name",
            "            ),",
            "        )",
            "",
            "    @property",
            "    def preview_on_add_view(self):",
            "        return self.construct_view(",
            "            self.preview_on_add_view_class,",
            "            form_class=self.get_form_class(),",
            "        )",
            "",
            "    @property",
            "    def preview_on_edit_view(self):",
            "        return self.construct_view(",
            "            self.preview_on_edit_view_class,",
            "            form_class=self.get_form_class(for_update=True),",
            "        )",
            "",
            "    @property",
            "    def lock_view(self):",
            "        return self.construct_view(",
            "            self.lock_view_class,",
            "            success_url_name=self.get_url_name(\"edit\"),",
            "        )",
            "",
            "    @property",
            "    def copy_view(self):",
            "        return self.construct_view(self.copy_view_class, **self.get_copy_view_kwargs())",
            "",
            "    @property",
            "    def unlock_view(self):",
            "        return self.construct_view(",
            "            self.unlock_view_class,",
            "            success_url_name=self.get_url_name(\"edit\"),",
            "        )",
            "",
            "    @property",
            "    def workflow_action_view(self):",
            "        return self.construct_view(",
            "            self.workflow_action_view_class,",
            "            redirect_url_name=self.get_url_name(\"edit\"),",
            "            submit_url_name=self.get_url_name(\"workflow_action\"),",
            "        )",
            "",
            "    @property",
            "    def collect_workflow_action_data_view(self):",
            "        return self.construct_view(",
            "            self.collect_workflow_action_data_view_class,",
            "            redirect_url_name=self.get_url_name(\"edit\"),",
            "            submit_url_name=self.get_url_name(\"collect_workflow_action_data\"),",
            "        )",
            "",
            "    @property",
            "    def confirm_workflow_cancellation_view(self):",
            "        return self.construct_view(self.confirm_workflow_cancellation_view_class)",
            "",
            "    @property",
            "    def workflow_preview_view(self):",
            "        return self.construct_view(self.workflow_preview_view_class)",
            "",
            "    @property",
            "    def workflow_history_view(self):",
            "        return self.construct_view(",
            "            self.workflow_history_view_class,",
            "            template_name=self.get_templates(",
            "                \"workflow_history/index\",",
            "                fallback=self.workflow_history_view_class.template_name,",
            "            ),",
            "            workflow_history_url_name=self.get_url_name(\"workflow_history\"),",
            "            workflow_history_detail_url_name=self.get_url_name(",
            "                \"workflow_history_detail\"",
            "            ),",
            "            _show_breadcrumbs=False,",
            "        )",
            "",
            "    @property",
            "    def workflow_history_detail_view(self):",
            "        return self.construct_view(",
            "            self.workflow_history_detail_view_class,",
            "            template_name=self.get_templates(",
            "                \"workflow_history/detail\",",
            "                fallback=self.workflow_history_detail_view_class.template_name,",
            "            ),",
            "            object_icon=self.icon,",
            "            header_icon=\"list-ul\",",
            "            workflow_history_url_name=self.get_url_name(\"workflow_history\"),",
            "            _show_breadcrumbs=False,",
            "        )",
            "",
            "    @property",
            "    def redirect_to_usage_view(self):",
            "        def redirect_to_usage(request, pk):",
            "            warn(",
            "                (",
            "                    \"%s's `/<pk>/usage/` usage view URL pattern has been \"",
            "                    \"deprecated in favour of /usage/<pk>/.\"",
            "                )",
            "                % (self.__class__.__name__),",
            "                category=RemovedInWagtail70Warning,",
            "            )",
            "            return redirect(self.get_url_name(\"usage\"), pk, permanent=True)",
            "",
            "        return redirect_to_usage",
            "",
            "    @property",
            "    def chooser_viewset(self):",
            "        return self.chooser_viewset_class(",
            "            self.get_chooser_admin_url_namespace(),",
            "            model=self.model,",
            "            url_prefix=self.get_chooser_admin_base_path(),",
            "            icon=self.icon,",
            "            per_page=self.chooser_per_page,",
            "        )",
            "",
            "    @cached_property",
            "    def list_display(self):",
            "        list_display = super().list_display.copy()",
            "        if self.draftstate_enabled:",
            "            list_display.append(LiveStatusTagColumn())",
            "        return list_display",
            "",
            "    @cached_property",
            "    def icon(self):",
            "        return self.get_icon()",
            "",
            "    def get_icon(self):",
            "        \"\"\"",
            "        Returns the icon to be used for the admin views.",
            "",
            "        **Deprecated** - the preferred way to customise this is to define an ``icon`` property.",
            "        \"\"\"",
            "        return \"snippet\"",
            "",
            "    @cached_property",
            "    def menu_label(self):",
            "        return self.get_menu_label()",
            "",
            "    def get_menu_label(self):",
            "        \"\"\"",
            "        Returns the label text to be used for the menu item.",
            "",
            "        **Deprecated** - the preferred way to customise this is to define a ``menu_label`` property.",
            "        \"\"\"",
            "        return self.model_opts.verbose_name_plural.title()",
            "",
            "    @cached_property",
            "    def menu_name(self):",
            "        return self.get_menu_name()",
            "",
            "    def get_menu_name(self):",
            "        \"\"\"",
            "        Returns the name to be used for the menu item.",
            "",
            "        **Deprecated** - the preferred way to customise this is to define a ``menu_name`` property.",
            "        \"\"\"",
            "        return \"\"",
            "",
            "    @cached_property",
            "    def menu_icon(self):",
            "        return self.get_menu_icon()",
            "",
            "    def get_menu_icon(self):",
            "        \"\"\"",
            "        Returns the icon to be used for the menu item.",
            "",
            "        **Deprecated** - the preferred way to customise this is to define a ``menu_icon`` property.",
            "        \"\"\"",
            "        return self.icon",
            "",
            "    @cached_property",
            "    def menu_order(self):",
            "        return self.get_menu_order()",
            "",
            "    def get_menu_order(self):",
            "        \"\"\"",
            "        Returns the ordering number to be applied to the menu item.",
            "",
            "        **Deprecated** - the preferred way to customise this is to define a ``menu_order`` property.",
            "        \"\"\"",
            "        # By default, put it at the last item before Reports, whose order is 9000.",
            "        return 8999",
            "",
            "    def get_menu_item_is_registered(self):",
            "        return self.menu_item_is_registered",
            "",
            "    @cached_property",
            "    def breadcrumbs_items(self):",
            "        # Use reverse_lazy instead of reverse",
            "        # because this will be passed to the view classes at startup",
            "        return [",
            "            {\"url\": reverse_lazy(\"wagtailadmin_home\"), \"label\": _(\"Home\")},",
            "            {\"url\": reverse_lazy(\"wagtailsnippets:index\"), \"label\": _(\"Snippets\")},",
            "        ]",
            "",
            "    def get_queryset(self, request):",
            "        \"\"\"",
            "        Returns a QuerySet of all model instances to be shown on the index view.",
            "        If ``None`` is returned (the default), the logic in",
            "        ``index_view.get_base_queryset()`` will be used instead.",
            "        \"\"\"",
            "        return None",
            "",
            "    @cached_property",
            "    def index_template_name(self):",
            "        return self.get_index_template()",
            "",
            "    def get_index_template(self):",
            "        \"\"\"",
            "        Returns a template to be used when rendering ``index_view``. If a",
            "        template is specified by the ``index_template_name`` attribute, that will",
            "        be used. Otherwise, a list of preferred template names are returned.",
            "",
            "        **Deprecated** - the preferred way to customise this is to define an ``index_template_name`` property.",
            "        \"\"\"",
            "        return self.get_templates(\"index\")",
            "",
            "    @cached_property",
            "    def index_results_template_name(self):",
            "        return self.get_index_results_template()",
            "",
            "    def get_index_results_template(self):",
            "        \"\"\"",
            "        Returns a template to be used when rendering ``index_results_view``. If a",
            "        template is specified by the ``index_results_template_name`` attribute, that will",
            "        be used. Otherwise, a list of preferred template names are returned.",
            "",
            "        **Deprecated** - the preferred way to customise this is to define an ``index_results_template_name`` property.",
            "        \"\"\"",
            "        return self.get_templates(\"index_results\")",
            "",
            "    @cached_property",
            "    def create_template_name(self):",
            "        return self.get_create_template()",
            "",
            "    def get_create_template(self):",
            "        \"\"\"",
            "        Returns a template to be used when rendering ``add_view``. If a",
            "        template is specified by the ``create_template_name`` attribute, that will",
            "        be used. Otherwise, a list of preferred template names are returned.",
            "",
            "        **Deprecated** - the preferred way to customise this is to define a ``create_template_name`` property.",
            "        \"\"\"",
            "        return self.get_templates(\"create\")",
            "",
            "    @cached_property",
            "    def edit_template_name(self):",
            "        return self.get_edit_template()",
            "",
            "    def get_edit_template(self):",
            "        \"\"\"",
            "        Returns a template to be used when rendering ``edit_view``. If a",
            "        template is specified by the ``edit_template_name`` attribute, that will",
            "        be used. Otherwise, a list of preferred template names are returned.",
            "",
            "        **Deprecated** - the preferred way to customise this is to define an ``edit_template_name`` property.",
            "        \"\"\"",
            "        return self.get_templates(\"edit\")",
            "",
            "    @cached_property",
            "    def delete_template_name(self):",
            "        return self.get_delete_template()",
            "",
            "    def get_delete_template(self):",
            "        \"\"\"",
            "        Returns a template to be used when rendering ``delete_view``. If a",
            "        template is specified by the ``delete_template_name`` attribute, that will",
            "        be used. Otherwise, a list of preferred template names are returned.",
            "",
            "        **Deprecated** - the preferred way to customise this is to define a ``delete_template_name`` property.",
            "        \"\"\"",
            "        return self.get_templates(\"delete\")",
            "",
            "    @cached_property",
            "    def history_template_name(self):",
            "        \"\"\"",
            "        A template to be used when rendering ``history_view``.",
            "",
            "        Default: if :attr:`template_prefix` is specified, a ``history.html``",
            "        template in the prefix directory and its ``{app_label}/{model_name}/``",
            "        or ``{app_label}/`` subdirectories will be used. Otherwise, the",
            "        ``history_view_class.template_name`` will be used.",
            "        \"\"\"",
            "        return self.get_history_template()",
            "",
            "    def get_history_template(self):",
            "        \"\"\"",
            "        Returns a template to be used when rendering ``history_view``. If a",
            "        template is specified by the ``history_template_name`` attribute, that will",
            "        be used. Otherwise, a list of preferred template names are returned.",
            "",
            "        **Deprecated** - the preferred way to customise this is to define a ``history_template_name`` property.",
            "        \"\"\"",
            "        return self.get_templates(\"history\")",
            "",
            "    @cached_property",
            "    def inspect_template_name(self):",
            "        \"\"\"",
            "        A template to be used when rendering ``inspect_view``.",
            "",
            "        Default: if :attr:`template_prefix` is specified, an ``inspect.html``",
            "        template in the prefix directory and its ``{app_label}/{model_name}/``",
            "        or ``{app_label}/`` subdirectories will be used. Otherwise, the",
            "        ``inspect_view_class.template_name`` will be used.",
            "        \"\"\"",
            "        return self.get_inspect_template()",
            "",
            "    def get_inspect_template(self):",
            "        \"\"\"",
            "        Returns a template to be used when rendering ``inspect_view``. If a",
            "        template is specified by the ``inspect_template_name`` attribute, that will",
            "        be used. Otherwise, a list of preferred template names are returned.",
            "",
            "        **Deprecated** - the preferred way to customise this is to define an ``inspect_template_name`` property.",
            "        \"\"\"",
            "        return self.get_templates(",
            "            \"inspect\", fallback=self.inspect_view_class.template_name",
            "        )",
            "",
            "    def get_admin_url_namespace(self):",
            "        \"\"\"",
            "        Returns the URL namespace for the admin URLs for this model.",
            "",
            "        **Deprecated** - the preferred way to customise this is to define a ``url_namespace`` property.",
            "        \"\"\"",
            "        if self.admin_url_namespace:",
            "            return self.admin_url_namespace",
            "        return f\"wagtailsnippets_{self.app_label}_{self.model_name}\"",
            "",
            "    def get_admin_base_path(self):",
            "        \"\"\"",
            "        Returns the base path for the admin URLs for this model.",
            "        The returned string must not begin or end with a slash.",
            "",
            "        **Deprecated** - the preferred way to customise this is to define a ``url_prefix`` property.",
            "        \"\"\"",
            "        if self.base_url_path:",
            "            return self.base_url_path.strip().strip(\"/\")",
            "        return f\"snippets/{self.app_label}/{self.model_name}\"",
            "",
            "    def get_chooser_admin_url_namespace(self):",
            "        \"\"\"Returns the URL namespace for the chooser admin URLs for this model.\"\"\"",
            "        if self.chooser_admin_url_namespace:",
            "            return self.chooser_admin_url_namespace",
            "        return f\"wagtailsnippetchoosers_{self.app_label}_{self.model_name}\"",
            "",
            "    def get_chooser_admin_base_path(self):",
            "        \"\"\"",
            "        Returns the base path for the chooser admin URLs for this model.",
            "        The returned string must not begin or end with a slash.",
            "        \"\"\"",
            "        if self.chooser_base_url_path:",
            "            return self.chooser_base_url_path.strip().strip(\"/\")",
            "        return f\"snippets/choose/{self.app_label}/{self.model_name}\"",
            "",
            "    @property",
            "    def url_finder_class(self):",
            "        return type(",
            "            \"_SnippetAdminURLFinder\", (SnippetAdminURLFinder,), {\"model\": self.model}",
            "        )",
            "",
            "    def get_urlpatterns(self):",
            "        urlpatterns = [",
            "            path(\"\", self.index_view, name=\"list\"),",
            "            path(\"results/\", self.index_results_view, name=\"list_results\"),",
            "            path(\"add/\", self.add_view, name=\"add\"),",
            "            path(\"edit/<str:pk>/\", self.edit_view, name=\"edit\"),",
            "            path(\"delete/<str:pk>/\", self.delete_view, name=\"delete\"),",
            "            path(\"usage/<str:pk>/\", self.usage_view, name=\"usage\"),",
            "            path(\"history/<str:pk>/\", self.history_view, name=\"history\"),",
            "            path(",
            "                \"history-results/<str:pk>/\",",
            "                self.history_results_view,",
            "                name=\"history_results\",",
            "            ),",
            "        ]",
            "",
            "        if self.copy_view_enabled:",
            "            urlpatterns += [path(\"copy/<str:pk>/\", self.copy_view, name=\"copy\")]",
            "",
            "        if self.inspect_view_enabled:",
            "            urlpatterns += [",
            "                path(\"inspect/<str:pk>/\", self.inspect_view, name=\"inspect\")",
            "            ]",
            "",
            "        if self.preview_enabled:",
            "            urlpatterns += [",
            "                path(\"preview/\", self.preview_on_add_view, name=\"preview_on_add\"),",
            "                path(",
            "                    \"preview/<str:pk>/\",",
            "                    self.preview_on_edit_view,",
            "                    name=\"preview_on_edit\",",
            "                ),",
            "            ]",
            "",
            "        if self.revision_enabled:",
            "            if self.preview_enabled:",
            "                urlpatterns += [",
            "                    path(",
            "                        \"history/<str:pk>/revisions/<int:revision_id>/view/\",",
            "                        self.revisions_view,",
            "                        name=\"revisions_view\",",
            "                    )",
            "                ]",
            "",
            "            urlpatterns += [",
            "                path(",
            "                    \"history/<str:pk>/revisions/<int:revision_id>/revert/\",",
            "                    self.revisions_revert_view,",
            "                    name=\"revisions_revert\",",
            "                ),",
            "                re_path(",
            "                    r\"history/(?P<pk>.+)/revisions/compare/(?P<revision_id_a>live|earliest|\\d+)\\.\\.\\.(?P<revision_id_b>live|latest|\\d+)/$\",",
            "                    self.revisions_compare_view,",
            "                    name=\"revisions_compare\",",
            "                ),",
            "            ]",
            "",
            "        if self.draftstate_enabled:",
            "            urlpatterns += [",
            "                path(",
            "                    \"history/<str:pk>/revisions/<int:revision_id>/unschedule/\",",
            "                    self.revisions_unschedule_view,",
            "                    name=\"revisions_unschedule\",",
            "                ),",
            "                path(\"unpublish/<str:pk>/\", self.unpublish_view, name=\"unpublish\"),",
            "            ]",
            "",
            "        if self.locking_enabled:",
            "            urlpatterns += [",
            "                path(\"lock/<str:pk>/\", self.lock_view, name=\"lock\"),",
            "                path(\"unlock/<str:pk>/\", self.unlock_view, name=\"unlock\"),",
            "            ]",
            "",
            "        if self.workflow_enabled:",
            "            urlpatterns += [",
            "                path(",
            "                    \"workflow/action/<str:pk>/<slug:action_name>/<int:task_state_id>/\",",
            "                    self.workflow_action_view,",
            "                    name=\"workflow_action\",",
            "                ),",
            "                path(",
            "                    \"workflow/collect_action_data/<str:pk>/<slug:action_name>/<int:task_state_id>/\",",
            "                    self.collect_workflow_action_data_view,",
            "                    name=\"collect_workflow_action_data\",",
            "                ),",
            "                path(",
            "                    \"workflow/confirm_cancellation/<str:pk>/\",",
            "                    self.confirm_workflow_cancellation_view,",
            "                    name=\"confirm_workflow_cancellation\",",
            "                ),",
            "                path(",
            "                    \"workflow_history/<str:pk>/\",",
            "                    self.workflow_history_view,",
            "                    name=\"workflow_history\",",
            "                ),",
            "                path(",
            "                    \"workflow_history/<str:pk>/detail/<int:workflow_state_id>/\",",
            "                    self.workflow_history_detail_view,",
            "                    name=\"workflow_history_detail\",",
            "                ),",
            "            ]",
            "",
            "            if self.preview_enabled:",
            "                urlpatterns += [",
            "                    path(",
            "                        \"workflow/preview/<str:pk>/<int:task_id>/\",",
            "                        self.workflow_preview_view,",
            "                        name=\"workflow_preview\",",
            "                    ),",
            "                ]",
            "",
            "        # RemovedInWagtail70Warning: Remove legacy URL patterns",
            "        return urlpatterns + self._legacy_urlpatterns",
            "",
            "    @cached_property",
            "    def _legacy_urlpatterns(self):",
            "        return [",
            "            # RemovedInWagtail70Warning: Remove legacy URL patterns",
            "            # legacy URLs that could potentially collide if the pk matches one of the reserved names above",
            "            # ('add', 'edit' etc) - redirect to the unambiguous version",
            "            path(\"<str:pk>/\", self.redirect_to_edit_view),",
            "            path(\"<str:pk>/delete/\", self.redirect_to_delete_view),",
            "            path(\"<str:pk>/usage/\", self.redirect_to_usage_view),",
            "        ]",
            "",
            "    def get_edit_handler(self):",
            "        \"\"\"",
            "        Like :meth:`ModelViewSet.get_edit_handler()",
            "        <wagtail.admin.viewsets.model.ModelViewSet.get_edit_handler>`,",
            "        but falls back to extracting panel definitions from the model class",
            "        if no edit handler is defined.",
            "        \"\"\"",
            "        edit_handler = super().get_edit_handler()",
            "        if edit_handler:",
            "            return edit_handler",
            "",
            "        exclude = self.get_exclude_form_fields()",
            "        panels = extract_panel_definitions_from_model_class(self.model, exclude=exclude)",
            "        edit_handler = ObjectList(panels)",
            "        return edit_handler.bind_to_model(self.model)",
            "",
            "    def register_chooser_viewset(self):",
            "        viewsets.register(self.chooser_viewset)",
            "",
            "    def register_model_check(self):",
            "        def snippets_model_check(app_configs, **kwargs):",
            "            return check_panels_in_model(self.model, \"snippets\")",
            "",
            "        checks.register(snippets_model_check, \"panels\")",
            "",
            "    def register_snippet_model(self):",
            "        snippet_models = get_snippet_models()",
            "        if self.model in snippet_models:",
            "            raise ImproperlyConfigured(",
            "                f\"The {self.model.__name__} model is already registered as a snippet\"",
            "            )",
            "        snippet_models.append(self.model)",
            "        snippet_models.sort(key=lambda x: x._meta.verbose_name)",
            "",
            "    def on_register(self):",
            "        super().on_register()",
            "        # For convenience, attach viewset to the model class to allow accessing",
            "        # the configuration of a given model.",
            "        self.model.snippet_viewset = self",
            "        self.register_chooser_viewset()",
            "        self.register_model_check()",
            "        self.register_snippet_model()",
            "",
            "",
            "class SnippetViewSetGroup(ModelViewSetGroup):",
            "    \"\"\"",
            "    A container for grouping together multiple",
            "    :class:`~wagtail.snippets.views.snippets.SnippetViewSet` instances.",
            "",
            "    All attributes and methods from",
            "    :class:`~wagtail.admin.viewsets.model.ModelViewSetGroup` are available.",
            "    \"\"\"",
            "",
            "    def __init__(self):",
            "        menu_item_is_registered = getattr(",
            "            self, \"menu_item_is_registered\", bool(self.menu_hook)",
            "        )",
            "        # If the menu item is registered, mark all viewsets as such so that we can",
            "        # hide the \"Snippets\" menu item if all snippets have their own menu items.",
            "        for item in self.items:",
            "            item.menu_item_is_registered = menu_item_is_registered",
            "",
            "        # Call super() after setting menu_item_is_registered so that nested groups",
            "        # can inherit the value.",
            "        super().__init__()"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {},
        "addLocation": [
            "wagtail.snippets.views.snippets.EditView.self",
            "wagtail.snippets.views.snippets.SnippetViewSet.edit_view_class",
            "wagtail.snippets.views.snippets.SnippetViewSet.add_view_class",
            "wagtail.snippets.views.snippets.CreateView.self",
            "nova.utils.ExceptionHelper"
        ]
    }
}