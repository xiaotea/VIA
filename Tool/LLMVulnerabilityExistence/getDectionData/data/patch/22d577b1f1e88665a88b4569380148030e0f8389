{
    "weblate/trans/tests/test_reports.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 31,
                "afterPatchRowNumber": 31,
                "PatchRowcode": "         \"count\": 1,"
            },
            "1": {
                "beforePatchRowNumber": 32,
                "afterPatchRowNumber": 32,
                "PatchRowcode": "         \"count_edit\": 0,"
            },
            "2": {
                "beforePatchRowNumber": 33,
                "afterPatchRowNumber": 33,
                "PatchRowcode": "         \"count_new\": 1,"
            },
            "3": {
                "beforePatchRowNumber": 34,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        \"name\": \"Weblate Test\","
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 34,
                "PatchRowcode": "+        \"name\": \"Weblate <b>Test</b>\","
            },
            "5": {
                "beforePatchRowNumber": 35,
                "afterPatchRowNumber": 35,
                "PatchRowcode": "         \"words\": 2,"
            },
            "6": {
                "beforePatchRowNumber": 36,
                "afterPatchRowNumber": 36,
                "PatchRowcode": "         \"words_edit\": 0,"
            },
            "7": {
                "beforePatchRowNumber": 37,
                "afterPatchRowNumber": 37,
                "PatchRowcode": "         \"words_new\": 2,"
            },
            "8": {
                "beforePatchRowNumber": 62,
                "afterPatchRowNumber": 62,
                "PatchRowcode": "     def setUp(self):"
            },
            "9": {
                "beforePatchRowNumber": 63,
                "afterPatchRowNumber": 63,
                "PatchRowcode": "         super().setUp()"
            },
            "10": {
                "beforePatchRowNumber": 64,
                "afterPatchRowNumber": 64,
                "PatchRowcode": "         self.user.is_superuser = True"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 65,
                "PatchRowcode": "+        self.user.full_name = \"Weblate <b>Test</b>\""
            },
            "12": {
                "beforePatchRowNumber": 65,
                "afterPatchRowNumber": 66,
                "PatchRowcode": "         self.user.save()"
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 67,
                "PatchRowcode": "+        self.maxDiff = None"
            },
            "14": {
                "beforePatchRowNumber": 66,
                "afterPatchRowNumber": 68,
                "PatchRowcode": " "
            },
            "15": {
                "beforePatchRowNumber": 67,
                "afterPatchRowNumber": 69,
                "PatchRowcode": "     def add_change(self):"
            },
            "16": {
                "beforePatchRowNumber": 68,
                "afterPatchRowNumber": 70,
                "PatchRowcode": "         self.edit_unit(\"Hello, world!\\n\", \"Nazdar svete!\\n\")"
            },
            "17": {
                "beforePatchRowNumber": 87,
                "afterPatchRowNumber": 89,
                "PatchRowcode": "             translation__component=self.component,"
            },
            "18": {
                "beforePatchRowNumber": 88,
                "afterPatchRowNumber": 90,
                "PatchRowcode": "         )"
            },
            "19": {
                "beforePatchRowNumber": 89,
                "afterPatchRowNumber": 91,
                "PatchRowcode": "         self.assertEqual("
            },
            "20": {
                "beforePatchRowNumber": 90,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            data, [{\"Czech\": [(\"weblate@example.org\", \"Weblate Test\", expected_count)]}]"
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 92,
                "PatchRowcode": "+            data,"
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 93,
                "PatchRowcode": "+            ["
            },
            "23": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 94,
                "PatchRowcode": "+                {"
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 95,
                "PatchRowcode": "+                    \"Czech\": ["
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 96,
                "PatchRowcode": "+                        (\"weblate@example.org\", \"Weblate <b>Test</b>\", expected_count)"
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 97,
                "PatchRowcode": "+                    ]"
            },
            "27": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 98,
                "PatchRowcode": "+                }"
            },
            "28": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 99,
                "PatchRowcode": "+            ],"
            },
            "29": {
                "beforePatchRowNumber": 91,
                "afterPatchRowNumber": 100,
                "PatchRowcode": "         )"
            },
            "30": {
                "beforePatchRowNumber": 92,
                "afterPatchRowNumber": 101,
                "PatchRowcode": " "
            },
            "31": {
                "beforePatchRowNumber": 93,
                "afterPatchRowNumber": 102,
                "PatchRowcode": "     def test_credits_more(self):"
            },
            "32": {
                "beforePatchRowNumber": 126,
                "afterPatchRowNumber": 135,
                "PatchRowcode": "         self.assertEqual(response.status_code, 200)"
            },
            "33": {
                "beforePatchRowNumber": 127,
                "afterPatchRowNumber": 136,
                "PatchRowcode": "         self.assertJSONEqual("
            },
            "34": {
                "beforePatchRowNumber": 128,
                "afterPatchRowNumber": 137,
                "PatchRowcode": "             response.content.decode(),"
            },
            "35": {
                "beforePatchRowNumber": 129,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            [{\"Czech\": [[\"weblate@example.org\", \"Weblate Test\", 1]]}],"
            },
            "36": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 138,
                "PatchRowcode": "+            [{\"Czech\": [[\"weblate@example.org\", \"Weblate <b>Test</b>\", 1]]}],"
            },
            "37": {
                "beforePatchRowNumber": 130,
                "afterPatchRowNumber": 139,
                "PatchRowcode": "         )"
            },
            "38": {
                "beforePatchRowNumber": 131,
                "afterPatchRowNumber": 140,
                "PatchRowcode": " "
            },
            "39": {
                "beforePatchRowNumber": 132,
                "afterPatchRowNumber": 141,
                "PatchRowcode": "     def test_credits_view_rst(self):"
            },
            "40": {
                "beforePatchRowNumber": 133,
                "afterPatchRowNumber": 142,
                "PatchRowcode": "         response = self.get_credits(\"rst\")"
            },
            "41": {
                "beforePatchRowNumber": 134,
                "afterPatchRowNumber": 143,
                "PatchRowcode": "         self.assertEqual(response.status_code, 200)"
            },
            "42": {
                "beforePatchRowNumber": 135,
                "afterPatchRowNumber": 144,
                "PatchRowcode": "         self.assertEqual("
            },
            "43": {
                "beforePatchRowNumber": 136,
                "afterPatchRowNumber": 145,
                "PatchRowcode": "             response.content.decode(),"
            },
            "44": {
                "beforePatchRowNumber": 137,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            \"\\n\\n* Czech\\n\\n    * Weblate Test <weblate@example.org> (1)\\n\\n\","
            },
            "45": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 146,
                "PatchRowcode": "+            \"\"\""
            },
            "46": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 147,
                "PatchRowcode": "+"
            },
            "47": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 148,
                "PatchRowcode": "+* Czech"
            },
            "48": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 149,
                "PatchRowcode": "+"
            },
            "49": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 150,
                "PatchRowcode": "+    * Weblate &lt;b&gt;Test&lt;/b&gt; <weblate@example.org> (1)"
            },
            "50": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 151,
                "PatchRowcode": "+"
            },
            "51": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 152,
                "PatchRowcode": "+\"\"\","
            },
            "52": {
                "beforePatchRowNumber": 138,
                "afterPatchRowNumber": 153,
                "PatchRowcode": "         )"
            },
            "53": {
                "beforePatchRowNumber": 139,
                "afterPatchRowNumber": 154,
                "PatchRowcode": " "
            },
            "54": {
                "beforePatchRowNumber": 140,
                "afterPatchRowNumber": 155,
                "PatchRowcode": "     def test_credits_view_html(self):"
            },
            "55": {
                "beforePatchRowNumber": 145,
                "afterPatchRowNumber": 160,
                "PatchRowcode": "             \"<table>\\n\""
            },
            "56": {
                "beforePatchRowNumber": 146,
                "afterPatchRowNumber": 161,
                "PatchRowcode": "             \"<tr>\\n<th>Czech</th>\\n\""
            },
            "57": {
                "beforePatchRowNumber": 147,
                "afterPatchRowNumber": 162,
                "PatchRowcode": "             '<td><ul><li><a href=\"mailto:weblate@example.org\">'"
            },
            "58": {
                "beforePatchRowNumber": 148,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            \"Weblate Test</a> (1)</li></ul></td>\\n</tr>\\n\""
            },
            "59": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 163,
                "PatchRowcode": "+            \"Weblate &lt;b&gt;Test&lt;/b&gt;</a> (1)</li></ul></td>\\n</tr>\\n\""
            },
            "60": {
                "beforePatchRowNumber": 149,
                "afterPatchRowNumber": 164,
                "PatchRowcode": "             \"</table>\","
            },
            "61": {
                "beforePatchRowNumber": 150,
                "afterPatchRowNumber": 165,
                "PatchRowcode": "         )"
            },
            "62": {
                "beforePatchRowNumber": 151,
                "afterPatchRowNumber": 166,
                "PatchRowcode": " "
            },
            "63": {
                "beforePatchRowNumber": 231,
                "afterPatchRowNumber": 246,
                "PatchRowcode": "         <th>Target chars edited</th>"
            },
            "64": {
                "beforePatchRowNumber": 232,
                "afterPatchRowNumber": 247,
                "PatchRowcode": "     </tr>"
            },
            "65": {
                "beforePatchRowNumber": 233,
                "afterPatchRowNumber": 248,
                "PatchRowcode": "     <tr>"
            },
            "66": {
                "beforePatchRowNumber": 234,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        <td>Weblate Test</td>"
            },
            "67": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 249,
                "PatchRowcode": "+        <td>Weblate &lt;b&gt;Test&lt;/b&gt;</td>"
            },
            "68": {
                "beforePatchRowNumber": 235,
                "afterPatchRowNumber": 250,
                "PatchRowcode": "         <td>weblate@example.org</td>"
            },
            "69": {
                "beforePatchRowNumber": 236,
                "afterPatchRowNumber": 251,
                "PatchRowcode": "         <td>1</td>"
            },
            "70": {
                "beforePatchRowNumber": 237,
                "afterPatchRowNumber": 252,
                "PatchRowcode": "         <td>14</td>"
            }
        },
        "frontPatchFile": [
            "#",
            "# Copyright \u00a9 2012\u20132022 Michal \u010ciha\u0159 <michal@cihar.com>",
            "#",
            "# This file is part of Weblate <https://weblate.org/>",
            "#",
            "# This program is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This program is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with this program.  If not, see <https://www.gnu.org/licenses/>.",
            "#",
            "",
            "",
            "from datetime import timedelta",
            "",
            "from django.urls import reverse",
            "from django.utils import timezone",
            "",
            "from weblate.trans.tests.test_views import ViewTestCase",
            "from weblate.trans.views.reports import generate_counts, generate_credits",
            "",
            "COUNTS_DATA = [",
            "    {",
            "        \"count\": 1,",
            "        \"count_edit\": 0,",
            "        \"count_new\": 1,",
            "        \"name\": \"Weblate Test\",",
            "        \"words\": 2,",
            "        \"words_edit\": 0,",
            "        \"words_new\": 2,",
            "        \"chars\": 14,",
            "        \"chars_edit\": 0,",
            "        \"chars_new\": 14,",
            "        \"email\": \"weblate@example.org\",",
            "        \"t_chars\": 14,",
            "        \"t_chars_edit\": 0,",
            "        \"t_chars_new\": 14,",
            "        \"t_words\": 2,",
            "        \"t_words_edit\": 0,",
            "        \"t_words_new\": 2,",
            "        \"count_approve\": 0,",
            "        \"words_approve\": 0,",
            "        \"chars_approve\": 0,",
            "        \"t_chars_approve\": 0,",
            "        \"t_words_approve\": 0,",
            "        \"edits\": 14,",
            "        \"edits_approve\": 0,",
            "        \"edits_edit\": 0,",
            "        \"edits_new\": 14,",
            "    }",
            "]",
            "",
            "",
            "class BaseReportsTest(ViewTestCase):",
            "    def setUp(self):",
            "        super().setUp()",
            "        self.user.is_superuser = True",
            "        self.user.save()",
            "",
            "    def add_change(self):",
            "        self.edit_unit(\"Hello, world!\\n\", \"Nazdar svete!\\n\")",
            "",
            "",
            "class ReportsTest(BaseReportsTest):",
            "    def test_credits_empty(self):",
            "        data = generate_credits(",
            "            None,",
            "            timezone.now() - timedelta(days=1),",
            "            timezone.now() + timedelta(days=1),",
            "            translation__component=self.component,",
            "        )",
            "        self.assertEqual(data, [])",
            "",
            "    def test_credits_one(self, expected_count=1):",
            "        self.add_change()",
            "        data = generate_credits(",
            "            None,",
            "            timezone.now() - timedelta(days=1),",
            "            timezone.now() + timedelta(days=1),",
            "            translation__component=self.component,",
            "        )",
            "        self.assertEqual(",
            "            data, [{\"Czech\": [(\"weblate@example.org\", \"Weblate Test\", expected_count)]}]",
            "        )",
            "",
            "    def test_credits_more(self):",
            "        self.edit_unit(\"Hello, world!\\n\", \"Nazdar svete2!\\n\")",
            "        self.test_credits_one(expected_count=2)",
            "",
            "    def test_counts_one(self):",
            "        self.add_change()",
            "        data = generate_counts(",
            "            None,",
            "            timezone.now() - timedelta(days=1),",
            "            timezone.now() + timedelta(days=1),",
            "            component=self.component,",
            "        )",
            "        self.assertEqual(data, COUNTS_DATA)",
            "",
            "",
            "class ReportsComponentTest(BaseReportsTest):",
            "    def get_kwargs(self):",
            "        return self.kw_component",
            "",
            "    def get_credits(self, style):",
            "        self.add_change()",
            "        return self.client.post(",
            "            reverse(\"credits\", kwargs=self.get_kwargs()),",
            "            {",
            "                \"period\": \"\",",
            "                \"style\": style,",
            "                \"start_date\": \"2000-01-01\",",
            "                \"end_date\": \"2100-01-01\",",
            "            },",
            "        )",
            "",
            "    def test_credits_view_json(self):",
            "        response = self.get_credits(\"json\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertJSONEqual(",
            "            response.content.decode(),",
            "            [{\"Czech\": [[\"weblate@example.org\", \"Weblate Test\", 1]]}],",
            "        )",
            "",
            "    def test_credits_view_rst(self):",
            "        response = self.get_credits(\"rst\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertEqual(",
            "            response.content.decode(),",
            "            \"\\n\\n* Czech\\n\\n    * Weblate Test <weblate@example.org> (1)\\n\\n\",",
            "        )",
            "",
            "    def test_credits_view_html(self):",
            "        response = self.get_credits(\"html\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertHTMLEqual(",
            "            response.content.decode(),",
            "            \"<table>\\n\"",
            "            \"<tr>\\n<th>Czech</th>\\n\"",
            "            '<td><ul><li><a href=\"mailto:weblate@example.org\">'",
            "            \"Weblate Test</a> (1)</li></ul></td>\\n</tr>\\n\"",
            "            \"</table>\",",
            "        )",
            "",
            "    def get_counts(self, style, **kwargs):",
            "        self.add_change()",
            "        params = {",
            "            \"style\": style,",
            "            \"period\": \"\",",
            "            \"start_date\": \"2000-01-01\",",
            "            \"end_date\": \"2100-01-01\",",
            "        }",
            "        params.update(kwargs)",
            "        return self.client.post(reverse(\"counts\", kwargs=self.get_kwargs()), params)",
            "",
            "    def test_counts_view_json(self):",
            "        response = self.get_counts(\"json\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertJSONEqual(response.content.decode(), COUNTS_DATA)",
            "",
            "    def test_counts_view_30days(self):",
            "        response = self.get_counts(\"json\", period=\"30days\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertJSONEqual(response.content.decode(), COUNTS_DATA)",
            "",
            "    def test_counts_view_this_month(self):",
            "        response = self.get_counts(\"json\", period=\"this-month\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertJSONEqual(response.content.decode(), COUNTS_DATA)",
            "",
            "    def test_counts_view_month(self):",
            "        response = self.get_counts(\"json\", period=\"month\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertJSONEqual(response.content.decode(), [])",
            "",
            "    def test_counts_view_year(self):",
            "        response = self.get_counts(\"json\", period=\"year\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertJSONEqual(response.content.decode(), [])",
            "",
            "    def test_counts_view_this_year(self):",
            "        response = self.get_counts(\"json\", period=\"this-year\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertJSONEqual(response.content.decode(), COUNTS_DATA)",
            "",
            "    def test_counts_view_rst(self):",
            "        response = self.get_counts(\"rst\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertContains(response, \"weblate@example.org\")",
            "",
            "    def test_counts_view_html(self):",
            "        response = self.get_counts(\"html\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertHTMLEqual(",
            "            response.content.decode(),",
            "            \"\"\"",
            "<table>",
            "    <tr>",
            "        <th>Name</th>",
            "        <th>Email</th>",
            "        <th>Count total</th>",
            "        <th>Edits total</th>",
            "        <th>Source words total</th>",
            "        <th>Source chars total</th>",
            "        <th>Target words total</th>",
            "        <th>Target chars total</th>",
            "        <th>Count new</th>",
            "        <th>Edits new</th>",
            "        <th>Source words new</th>",
            "        <th>Source chars new</th>",
            "        <th>Target words new</th>",
            "        <th>Target chars new</th>",
            "        <th>Count approved</th>",
            "        <th>Edits approved</th>",
            "        <th>Source words approved</th>",
            "        <th>Source chars approved</th>",
            "        <th>Target words approved</th>",
            "        <th>Target chars approved</th>",
            "        <th>Count edited</th>",
            "        <th>Edits edited</th>",
            "        <th>Source words edited</th>",
            "        <th>Source chars edited</th>",
            "        <th>Target words edited</th>",
            "        <th>Target chars edited</th>",
            "    </tr>",
            "    <tr>",
            "        <td>Weblate Test</td>",
            "        <td>weblate@example.org</td>",
            "        <td>1</td>",
            "        <td>14</td>",
            "        <td>2</td>",
            "        <td>14</td>",
            "        <td>2</td>",
            "        <td>14</td>",
            "        <td>1</td>",
            "        <td>14</td>",
            "        <td>2</td>",
            "        <td>14</td>",
            "        <td>2</td>",
            "        <td>14</td>",
            "        <td>0</td>",
            "        <td>0</td>",
            "        <td>0</td>",
            "        <td>0</td>",
            "        <td>0</td>",
            "        <td>0</td>",
            "        <td>0</td>",
            "        <td>0</td>",
            "        <td>0</td>",
            "        <td>0</td>",
            "        <td>0</td>",
            "        <td>0</td>",
            "    </tr>",
            "</table>",
            "\"\"\",",
            "        )",
            "",
            "",
            "class ReportsProjectTest(ReportsComponentTest):",
            "    def get_kwargs(self):",
            "        return self.kw_project",
            "",
            "",
            "class ReportsGlobalTest(ReportsComponentTest):",
            "    def get_kwargs(self):",
            "        return {}"
        ],
        "afterPatchFile": [
            "#",
            "# Copyright \u00a9 2012\u20132022 Michal \u010ciha\u0159 <michal@cihar.com>",
            "#",
            "# This file is part of Weblate <https://weblate.org/>",
            "#",
            "# This program is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This program is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with this program.  If not, see <https://www.gnu.org/licenses/>.",
            "#",
            "",
            "",
            "from datetime import timedelta",
            "",
            "from django.urls import reverse",
            "from django.utils import timezone",
            "",
            "from weblate.trans.tests.test_views import ViewTestCase",
            "from weblate.trans.views.reports import generate_counts, generate_credits",
            "",
            "COUNTS_DATA = [",
            "    {",
            "        \"count\": 1,",
            "        \"count_edit\": 0,",
            "        \"count_new\": 1,",
            "        \"name\": \"Weblate <b>Test</b>\",",
            "        \"words\": 2,",
            "        \"words_edit\": 0,",
            "        \"words_new\": 2,",
            "        \"chars\": 14,",
            "        \"chars_edit\": 0,",
            "        \"chars_new\": 14,",
            "        \"email\": \"weblate@example.org\",",
            "        \"t_chars\": 14,",
            "        \"t_chars_edit\": 0,",
            "        \"t_chars_new\": 14,",
            "        \"t_words\": 2,",
            "        \"t_words_edit\": 0,",
            "        \"t_words_new\": 2,",
            "        \"count_approve\": 0,",
            "        \"words_approve\": 0,",
            "        \"chars_approve\": 0,",
            "        \"t_chars_approve\": 0,",
            "        \"t_words_approve\": 0,",
            "        \"edits\": 14,",
            "        \"edits_approve\": 0,",
            "        \"edits_edit\": 0,",
            "        \"edits_new\": 14,",
            "    }",
            "]",
            "",
            "",
            "class BaseReportsTest(ViewTestCase):",
            "    def setUp(self):",
            "        super().setUp()",
            "        self.user.is_superuser = True",
            "        self.user.full_name = \"Weblate <b>Test</b>\"",
            "        self.user.save()",
            "        self.maxDiff = None",
            "",
            "    def add_change(self):",
            "        self.edit_unit(\"Hello, world!\\n\", \"Nazdar svete!\\n\")",
            "",
            "",
            "class ReportsTest(BaseReportsTest):",
            "    def test_credits_empty(self):",
            "        data = generate_credits(",
            "            None,",
            "            timezone.now() - timedelta(days=1),",
            "            timezone.now() + timedelta(days=1),",
            "            translation__component=self.component,",
            "        )",
            "        self.assertEqual(data, [])",
            "",
            "    def test_credits_one(self, expected_count=1):",
            "        self.add_change()",
            "        data = generate_credits(",
            "            None,",
            "            timezone.now() - timedelta(days=1),",
            "            timezone.now() + timedelta(days=1),",
            "            translation__component=self.component,",
            "        )",
            "        self.assertEqual(",
            "            data,",
            "            [",
            "                {",
            "                    \"Czech\": [",
            "                        (\"weblate@example.org\", \"Weblate <b>Test</b>\", expected_count)",
            "                    ]",
            "                }",
            "            ],",
            "        )",
            "",
            "    def test_credits_more(self):",
            "        self.edit_unit(\"Hello, world!\\n\", \"Nazdar svete2!\\n\")",
            "        self.test_credits_one(expected_count=2)",
            "",
            "    def test_counts_one(self):",
            "        self.add_change()",
            "        data = generate_counts(",
            "            None,",
            "            timezone.now() - timedelta(days=1),",
            "            timezone.now() + timedelta(days=1),",
            "            component=self.component,",
            "        )",
            "        self.assertEqual(data, COUNTS_DATA)",
            "",
            "",
            "class ReportsComponentTest(BaseReportsTest):",
            "    def get_kwargs(self):",
            "        return self.kw_component",
            "",
            "    def get_credits(self, style):",
            "        self.add_change()",
            "        return self.client.post(",
            "            reverse(\"credits\", kwargs=self.get_kwargs()),",
            "            {",
            "                \"period\": \"\",",
            "                \"style\": style,",
            "                \"start_date\": \"2000-01-01\",",
            "                \"end_date\": \"2100-01-01\",",
            "            },",
            "        )",
            "",
            "    def test_credits_view_json(self):",
            "        response = self.get_credits(\"json\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertJSONEqual(",
            "            response.content.decode(),",
            "            [{\"Czech\": [[\"weblate@example.org\", \"Weblate <b>Test</b>\", 1]]}],",
            "        )",
            "",
            "    def test_credits_view_rst(self):",
            "        response = self.get_credits(\"rst\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertEqual(",
            "            response.content.decode(),",
            "            \"\"\"",
            "",
            "* Czech",
            "",
            "    * Weblate &lt;b&gt;Test&lt;/b&gt; <weblate@example.org> (1)",
            "",
            "\"\"\",",
            "        )",
            "",
            "    def test_credits_view_html(self):",
            "        response = self.get_credits(\"html\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertHTMLEqual(",
            "            response.content.decode(),",
            "            \"<table>\\n\"",
            "            \"<tr>\\n<th>Czech</th>\\n\"",
            "            '<td><ul><li><a href=\"mailto:weblate@example.org\">'",
            "            \"Weblate &lt;b&gt;Test&lt;/b&gt;</a> (1)</li></ul></td>\\n</tr>\\n\"",
            "            \"</table>\",",
            "        )",
            "",
            "    def get_counts(self, style, **kwargs):",
            "        self.add_change()",
            "        params = {",
            "            \"style\": style,",
            "            \"period\": \"\",",
            "            \"start_date\": \"2000-01-01\",",
            "            \"end_date\": \"2100-01-01\",",
            "        }",
            "        params.update(kwargs)",
            "        return self.client.post(reverse(\"counts\", kwargs=self.get_kwargs()), params)",
            "",
            "    def test_counts_view_json(self):",
            "        response = self.get_counts(\"json\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertJSONEqual(response.content.decode(), COUNTS_DATA)",
            "",
            "    def test_counts_view_30days(self):",
            "        response = self.get_counts(\"json\", period=\"30days\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertJSONEqual(response.content.decode(), COUNTS_DATA)",
            "",
            "    def test_counts_view_this_month(self):",
            "        response = self.get_counts(\"json\", period=\"this-month\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertJSONEqual(response.content.decode(), COUNTS_DATA)",
            "",
            "    def test_counts_view_month(self):",
            "        response = self.get_counts(\"json\", period=\"month\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertJSONEqual(response.content.decode(), [])",
            "",
            "    def test_counts_view_year(self):",
            "        response = self.get_counts(\"json\", period=\"year\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertJSONEqual(response.content.decode(), [])",
            "",
            "    def test_counts_view_this_year(self):",
            "        response = self.get_counts(\"json\", period=\"this-year\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertJSONEqual(response.content.decode(), COUNTS_DATA)",
            "",
            "    def test_counts_view_rst(self):",
            "        response = self.get_counts(\"rst\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertContains(response, \"weblate@example.org\")",
            "",
            "    def test_counts_view_html(self):",
            "        response = self.get_counts(\"html\")",
            "        self.assertEqual(response.status_code, 200)",
            "        self.assertHTMLEqual(",
            "            response.content.decode(),",
            "            \"\"\"",
            "<table>",
            "    <tr>",
            "        <th>Name</th>",
            "        <th>Email</th>",
            "        <th>Count total</th>",
            "        <th>Edits total</th>",
            "        <th>Source words total</th>",
            "        <th>Source chars total</th>",
            "        <th>Target words total</th>",
            "        <th>Target chars total</th>",
            "        <th>Count new</th>",
            "        <th>Edits new</th>",
            "        <th>Source words new</th>",
            "        <th>Source chars new</th>",
            "        <th>Target words new</th>",
            "        <th>Target chars new</th>",
            "        <th>Count approved</th>",
            "        <th>Edits approved</th>",
            "        <th>Source words approved</th>",
            "        <th>Source chars approved</th>",
            "        <th>Target words approved</th>",
            "        <th>Target chars approved</th>",
            "        <th>Count edited</th>",
            "        <th>Edits edited</th>",
            "        <th>Source words edited</th>",
            "        <th>Source chars edited</th>",
            "        <th>Target words edited</th>",
            "        <th>Target chars edited</th>",
            "    </tr>",
            "    <tr>",
            "        <td>Weblate &lt;b&gt;Test&lt;/b&gt;</td>",
            "        <td>weblate@example.org</td>",
            "        <td>1</td>",
            "        <td>14</td>",
            "        <td>2</td>",
            "        <td>14</td>",
            "        <td>2</td>",
            "        <td>14</td>",
            "        <td>1</td>",
            "        <td>14</td>",
            "        <td>2</td>",
            "        <td>14</td>",
            "        <td>2</td>",
            "        <td>14</td>",
            "        <td>0</td>",
            "        <td>0</td>",
            "        <td>0</td>",
            "        <td>0</td>",
            "        <td>0</td>",
            "        <td>0</td>",
            "        <td>0</td>",
            "        <td>0</td>",
            "        <td>0</td>",
            "        <td>0</td>",
            "        <td>0</td>",
            "        <td>0</td>",
            "    </tr>",
            "</table>",
            "\"\"\",",
            "        )",
            "",
            "",
            "class ReportsProjectTest(ReportsComponentTest):",
            "    def get_kwargs(self):",
            "        return self.kw_project",
            "",
            "",
            "class ReportsGlobalTest(ReportsComponentTest):",
            "    def get_kwargs(self):",
            "        return {}"
        ],
        "action": [
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "0",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "34": [],
            "90": [
                "ReportsTest",
                "test_credits_one"
            ],
            "129": [
                "ReportsComponentTest",
                "test_credits_view_json"
            ],
            "137": [
                "ReportsComponentTest",
                "test_credits_view_rst"
            ],
            "148": [
                "ReportsComponentTest",
                "test_credits_view_html"
            ],
            "234": [
                "ReportsComponentTest",
                "test_counts_view_html"
            ]
        },
        "addLocation": []
    },
    "weblate/trans/views/reports.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 17,
                "afterPatchRowNumber": 17,
                "PatchRowcode": " # along with this program.  If not, see <https://www.gnu.org/licenses/>."
            },
            "1": {
                "beforePatchRowNumber": 18,
                "afterPatchRowNumber": 18,
                "PatchRowcode": " #"
            },
            "2": {
                "beforePatchRowNumber": 19,
                "afterPatchRowNumber": 19,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": 20,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "4": {
                "beforePatchRowNumber": 21,
                "afterPatchRowNumber": 20,
                "PatchRowcode": " from django.contrib.auth.decorators import login_required"
            },
            "5": {
                "beforePatchRowNumber": 22,
                "afterPatchRowNumber": 21,
                "PatchRowcode": " from django.http import HttpResponse, JsonResponse"
            },
            "6": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 22,
                "PatchRowcode": "+from django.utils.html import escape"
            },
            "7": {
                "beforePatchRowNumber": 23,
                "afterPatchRowNumber": 23,
                "PatchRowcode": " from django.views.decorators.http import require_POST"
            },
            "8": {
                "beforePatchRowNumber": 24,
                "afterPatchRowNumber": 24,
                "PatchRowcode": " "
            },
            "9": {
                "beforePatchRowNumber": 25,
                "afterPatchRowNumber": 25,
                "PatchRowcode": " from weblate.lang.models import Language"
            },
            "10": {
                "beforePatchRowNumber": 109,
                "afterPatchRowNumber": 109,
                "PatchRowcode": "     for language in data:"
            },
            "11": {
                "beforePatchRowNumber": 110,
                "afterPatchRowNumber": 110,
                "PatchRowcode": "         name, translators = language.popitem()"
            },
            "12": {
                "beforePatchRowNumber": 111,
                "afterPatchRowNumber": 111,
                "PatchRowcode": "         result.append(row_start)"
            },
            "13": {
                "beforePatchRowNumber": 112,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        result.append(language_format.format(name))"
            },
            "14": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 112,
                "PatchRowcode": "+        result.append(language_format.format(escape(name)))"
            },
            "15": {
                "beforePatchRowNumber": 113,
                "afterPatchRowNumber": 113,
                "PatchRowcode": "         result.append("
            },
            "16": {
                "beforePatchRowNumber": 114,
                "afterPatchRowNumber": 114,
                "PatchRowcode": "             translator_start"
            },
            "17": {
                "beforePatchRowNumber": 115,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            + \"\\n\".join(translator_format.format(*t) for t in translators)"
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 115,
                "PatchRowcode": "+            + \"\\n\".join("
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 116,
                "PatchRowcode": "+                translator_format.format(escape(t[0]), escape(t[1]), t[2])"
            },
            "20": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 117,
                "PatchRowcode": "+                for t in translators"
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 118,
                "PatchRowcode": "+            )"
            },
            "22": {
                "beforePatchRowNumber": 116,
                "afterPatchRowNumber": 119,
                "PatchRowcode": "             + translator_end"
            },
            "23": {
                "beforePatchRowNumber": 117,
                "afterPatchRowNumber": 120,
                "PatchRowcode": "         )"
            },
            "24": {
                "beforePatchRowNumber": 118,
                "afterPatchRowNumber": 121,
                "PatchRowcode": "         result.append(row_end)"
            },
            "25": {
                "beforePatchRowNumber": 288,
                "afterPatchRowNumber": 291,
                "PatchRowcode": "         result.append("
            },
            "26": {
                "beforePatchRowNumber": 289,
                "afterPatchRowNumber": 292,
                "PatchRowcode": "             \"\".join("
            },
            "27": {
                "beforePatchRowNumber": 290,
                "afterPatchRowNumber": 293,
                "PatchRowcode": "                 ("
            },
            "28": {
                "beforePatchRowNumber": 291,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    cell_name.format(item[\"name\"] or \"Anonymous\"),"
            },
            "29": {
                "beforePatchRowNumber": 292,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    cell_name.format(item[\"email\"] or \"\"),"
            },
            "30": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 294,
                "PatchRowcode": "+                    cell_name.format(escape(item[\"name\"]) or \"Anonymous\"),"
            },
            "31": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 295,
                "PatchRowcode": "+                    cell_name.format(escape(item[\"email\"]) or \"\"),"
            },
            "32": {
                "beforePatchRowNumber": 293,
                "afterPatchRowNumber": 296,
                "PatchRowcode": "                     cell_count.format(item[\"count\"]),"
            },
            "33": {
                "beforePatchRowNumber": 294,
                "afterPatchRowNumber": 297,
                "PatchRowcode": "                     cell_count.format(item[\"edits\"]),"
            },
            "34": {
                "beforePatchRowNumber": 295,
                "afterPatchRowNumber": 298,
                "PatchRowcode": "                     cell_count.format(item[\"words\"]),"
            }
        },
        "frontPatchFile": [
            "#",
            "# Copyright \u00a9 2012\u20132022 Michal \u010ciha\u0159 <michal@cihar.com>",
            "#",
            "# This file is part of Weblate <https://weblate.org/>",
            "#",
            "# This program is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This program is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with this program.  If not, see <https://www.gnu.org/licenses/>.",
            "#",
            "",
            "",
            "from django.contrib.auth.decorators import login_required",
            "from django.http import HttpResponse, JsonResponse",
            "from django.views.decorators.http import require_POST",
            "",
            "from weblate.lang.models import Language",
            "from weblate.trans.forms import ReportsForm",
            "from weblate.trans.models.change import Change",
            "from weblate.trans.util import redirect_param",
            "from weblate.utils.views import get_component, get_project, show_form_errors",
            "",
            "# Header, two longer fields for name and email, shorter fields for numbers",
            "RST_HEADING = \" \".join([\"=\" * 40] * 2 + [\"=\" * 24] * 20)",
            "",
            "HTML_HEADING = \"<table>\\n<tr>{0}</tr>\"",
            "",
            "",
            "def generate_credits(user, start_date, end_date, **kwargs):",
            "    \"\"\"Generate credits data for given component.\"\"\"",
            "    result = []",
            "",
            "    base = Change.objects.content()",
            "    if user:",
            "        base = base.filter(author=user)",
            "",
            "    for language in Language.objects.filter(**kwargs).distinct().iterator():",
            "        authors = base.filter(language=language, **kwargs).authors_list(",
            "            (start_date, end_date)",
            "        )",
            "        if not authors:",
            "            continue",
            "        result.append({language.name: sorted(authors, key=lambda item: item[2])})",
            "",
            "    return result",
            "",
            "",
            "@login_required",
            "@require_POST",
            "def get_credits(request, project=None, component=None):",
            "    \"\"\"View for credits.\"\"\"",
            "    if project is None:",
            "        obj = None",
            "        kwargs = {\"translation__isnull\": False}",
            "    elif component is None:",
            "        obj = get_project(request, project)",
            "        kwargs = {\"translation__component__project\": obj}",
            "    else:",
            "        obj = get_component(request, project, component)",
            "        kwargs = {\"translation__component\": obj}",
            "",
            "    form = ReportsForm(request.POST)",
            "",
            "    if not form.is_valid():",
            "        show_form_errors(request, form)",
            "        return redirect_param(obj or \"home\", \"#reports\")",
            "",
            "    data = generate_credits(",
            "        None if request.user.has_perm(\"reports.view\", obj) else request.user,",
            "        form.cleaned_data[\"start_date\"],",
            "        form.cleaned_data[\"end_date\"],",
            "        **kwargs,",
            "    )",
            "",
            "    if form.cleaned_data[\"style\"] == \"json\":",
            "        return JsonResponse(data=data, safe=False)",
            "",
            "    if form.cleaned_data[\"style\"] == \"html\":",
            "        start = \"<table>\"",
            "        row_start = \"<tr>\"",
            "        language_format = \"<th>{0}</th>\"",
            "        translator_start = \"<td><ul>\"",
            "        translator_format = '<li><a href=\"mailto:{0}\">{1}</a> ({2})</li>'",
            "        translator_end = \"</ul></td>\"",
            "        row_end = \"</tr>\"",
            "        mime = \"text/html\"",
            "        end = \"</table>\"",
            "    else:",
            "        start = \"\"",
            "        row_start = \"\"",
            "        language_format = \"* {0}\\n\"",
            "        translator_start = \"\"",
            "        translator_format = \"    * {1} <{0}> ({2})\"",
            "        translator_end = \"\"",
            "        row_end = \"\"",
            "        mime = \"text/plain\"",
            "        end = \"\"",
            "",
            "    result = [start]",
            "",
            "    for language in data:",
            "        name, translators = language.popitem()",
            "        result.append(row_start)",
            "        result.append(language_format.format(name))",
            "        result.append(",
            "            translator_start",
            "            + \"\\n\".join(translator_format.format(*t) for t in translators)",
            "            + translator_end",
            "        )",
            "        result.append(row_end)",
            "",
            "    result.append(end)",
            "",
            "    return HttpResponse(\"\\n\".join(result), content_type=f\"{mime}; charset=utf-8\")",
            "",
            "",
            "COUNT_DEFAULTS = {",
            "    field: 0",
            "    for field in (",
            "        \"t_chars\",",
            "        \"t_words\",",
            "        \"chars\",",
            "        \"words\",",
            "        \"edits\",",
            "        \"count\",",
            "        \"t_chars_new\",",
            "        \"t_words_new\",",
            "        \"chars_new\",",
            "        \"words_new\",",
            "        \"edits_new\",",
            "        \"count_new\",",
            "        \"t_chars_approve\",",
            "        \"t_words_approve\",",
            "        \"chars_approve\",",
            "        \"words_approve\",",
            "        \"edits_approve\",",
            "        \"count_approve\",",
            "        \"t_chars_edit\",",
            "        \"t_words_edit\",",
            "        \"chars_edit\",",
            "        \"words_edit\",",
            "        \"edits_edit\",",
            "        \"count_edit\",",
            "    )",
            "}",
            "",
            "",
            "def generate_counts(user, start_date, end_date, **kwargs):",
            "    \"\"\"Generate credits data for given component.\"\"\"",
            "    result = {}",
            "    action_map = {Change.ACTION_NEW: \"new\", Change.ACTION_APPROVE: \"approve\"}",
            "",
            "    base = Change.objects.content().filter(unit__isnull=False)",
            "    if user:",
            "        base = base.filter(author=user)",
            "    else:",
            "        base = base.filter(author__isnull=False)",
            "",
            "    changes = base.filter(",
            "        timestamp__range=(start_date, end_date), **kwargs",
            "    ).prefetch_related(\"author\", \"unit\")",
            "    for change in changes:",
            "        email = change.author.email",
            "",
            "        if email not in result:",
            "            result[email] = current = {\"name\": change.author.full_name, \"email\": email}",
            "            current.update(COUNT_DEFAULTS)",
            "        else:",
            "            current = result[email]",
            "",
            "        src_chars = len(change.unit.source)",
            "        src_words = change.unit.num_words",
            "        tgt_chars = len(change.target)",
            "        tgt_words = len(change.target.split())",
            "        edits = change.get_distance()",
            "",
            "        current[\"chars\"] += src_chars",
            "        current[\"words\"] += src_words",
            "        current[\"t_chars\"] += tgt_chars",
            "        current[\"t_words\"] += tgt_words",
            "        current[\"edits\"] += edits",
            "        current[\"count\"] += 1",
            "",
            "        suffix = action_map.get(change.action, \"edit\")",
            "",
            "        current[\"t_chars_\" + suffix] += tgt_chars",
            "        current[\"t_words_\" + suffix] += tgt_words",
            "        current[\"chars_\" + suffix] += src_chars",
            "        current[\"words_\" + suffix] += src_words",
            "        current[\"edits_\" + suffix] += edits",
            "        current[\"count_\" + suffix] += 1",
            "",
            "    return list(result.values())",
            "",
            "",
            "@login_required",
            "@require_POST",
            "def get_counts(request, project=None, component=None):",
            "    \"\"\"View for work counts.\"\"\"",
            "    if project is None:",
            "        obj = None",
            "        kwargs = {}",
            "    elif component is None:",
            "        obj = get_project(request, project)",
            "        kwargs = {\"project\": obj}",
            "    else:",
            "        obj = get_component(request, project, component)",
            "        kwargs = {\"component\": obj}",
            "",
            "    form = ReportsForm(request.POST)",
            "",
            "    if not form.is_valid():",
            "        show_form_errors(request, form)",
            "        return redirect_param(obj or \"home\", \"#reports\")",
            "",
            "    data = generate_counts(",
            "        None if request.user.has_perm(\"reports.view\", obj) else request.user,",
            "        form.cleaned_data[\"start_date\"],",
            "        form.cleaned_data[\"end_date\"],",
            "        **kwargs,",
            "    )",
            "",
            "    if form.cleaned_data[\"style\"] == \"json\":",
            "        return JsonResponse(data=data, safe=False)",
            "",
            "    headers = (",
            "        \"Name\",",
            "        \"Email\",",
            "        \"Count total\",",
            "        \"Edits total\",",
            "        \"Source words total\",",
            "        \"Source chars total\",",
            "        \"Target words total\",",
            "        \"Target chars total\",",
            "        \"Count new\",",
            "        \"Edits new\",",
            "        \"Source words new\",",
            "        \"Source chars new\",",
            "        \"Target words new\",",
            "        \"Target chars new\",",
            "        \"Count approved\",",
            "        \"Edits approved\",",
            "        \"Source words approved\",",
            "        \"Source chars approved\",",
            "        \"Target words approved\",",
            "        \"Target chars approved\",",
            "        \"Count edited\",",
            "        \"Edits edited\",",
            "        \"Source words edited\",",
            "        \"Source chars edited\",",
            "        \"Target words edited\",",
            "        \"Target chars edited\",",
            "    )",
            "",
            "    if form.cleaned_data[\"style\"] == \"html\":",
            "        start = HTML_HEADING.format(\"\".join(f\"<th>{h}</th>\" for h in headers))",
            "        row_start = \"<tr>\"",
            "        cell_name = cell_count = \"<td>{0}</td>\\n\"",
            "        row_end = \"</tr>\"",
            "        mime = \"text/html\"",
            "        end = \"</table>\"",
            "    else:",
            "        start = \"{0}\\n{1} {2}\\n{0}\".format(",
            "            RST_HEADING,",
            "            \" \".join(f\"{h:40}\" for h in headers[:2]),",
            "            \" \".join(f\"{h:24}\" for h in headers[2:]),",
            "        )",
            "        row_start = \"\"",
            "        cell_name = \"{0:40} \"",
            "        cell_count = \"{0:24} \"",
            "        row_end = \"\"",
            "        mime = \"text/plain\"",
            "        end = RST_HEADING",
            "",
            "    result = [start]",
            "",
            "    for item in data:",
            "        if row_start:",
            "            result.append(row_start)",
            "        result.append(",
            "            \"\".join(",
            "                (",
            "                    cell_name.format(item[\"name\"] or \"Anonymous\"),",
            "                    cell_name.format(item[\"email\"] or \"\"),",
            "                    cell_count.format(item[\"count\"]),",
            "                    cell_count.format(item[\"edits\"]),",
            "                    cell_count.format(item[\"words\"]),",
            "                    cell_count.format(item[\"chars\"]),",
            "                    cell_count.format(item[\"t_words\"]),",
            "                    cell_count.format(item[\"t_chars\"]),",
            "                    cell_count.format(item[\"count_new\"]),",
            "                    cell_count.format(item[\"edits_new\"]),",
            "                    cell_count.format(item[\"words_new\"]),",
            "                    cell_count.format(item[\"chars_new\"]),",
            "                    cell_count.format(item[\"t_words_new\"]),",
            "                    cell_count.format(item[\"t_chars_new\"]),",
            "                    cell_count.format(item[\"count_approve\"]),",
            "                    cell_count.format(item[\"edits_approve\"]),",
            "                    cell_count.format(item[\"words_approve\"]),",
            "                    cell_count.format(item[\"chars_approve\"]),",
            "                    cell_count.format(item[\"t_words_approve\"]),",
            "                    cell_count.format(item[\"t_chars_approve\"]),",
            "                    cell_count.format(item[\"count_edit\"]),",
            "                    cell_count.format(item[\"edits_edit\"]),",
            "                    cell_count.format(item[\"words_edit\"]),",
            "                    cell_count.format(item[\"chars_edit\"]),",
            "                    cell_count.format(item[\"t_words_edit\"]),",
            "                    cell_count.format(item[\"t_chars_edit\"]),",
            "                )",
            "            )",
            "        )",
            "        if row_end:",
            "            result.append(row_end)",
            "",
            "    result.append(end)",
            "",
            "    return HttpResponse(\"\\n\".join(result), content_type=f\"{mime}; charset=utf-8\")"
        ],
        "afterPatchFile": [
            "#",
            "# Copyright \u00a9 2012\u20132022 Michal \u010ciha\u0159 <michal@cihar.com>",
            "#",
            "# This file is part of Weblate <https://weblate.org/>",
            "#",
            "# This program is free software: you can redistribute it and/or modify",
            "# it under the terms of the GNU General Public License as published by",
            "# the Free Software Foundation, either version 3 of the License, or",
            "# (at your option) any later version.",
            "#",
            "# This program is distributed in the hope that it will be useful,",
            "# but WITHOUT ANY WARRANTY; without even the implied warranty of",
            "# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the",
            "# GNU General Public License for more details.",
            "#",
            "# You should have received a copy of the GNU General Public License",
            "# along with this program.  If not, see <https://www.gnu.org/licenses/>.",
            "#",
            "",
            "from django.contrib.auth.decorators import login_required",
            "from django.http import HttpResponse, JsonResponse",
            "from django.utils.html import escape",
            "from django.views.decorators.http import require_POST",
            "",
            "from weblate.lang.models import Language",
            "from weblate.trans.forms import ReportsForm",
            "from weblate.trans.models.change import Change",
            "from weblate.trans.util import redirect_param",
            "from weblate.utils.views import get_component, get_project, show_form_errors",
            "",
            "# Header, two longer fields for name and email, shorter fields for numbers",
            "RST_HEADING = \" \".join([\"=\" * 40] * 2 + [\"=\" * 24] * 20)",
            "",
            "HTML_HEADING = \"<table>\\n<tr>{0}</tr>\"",
            "",
            "",
            "def generate_credits(user, start_date, end_date, **kwargs):",
            "    \"\"\"Generate credits data for given component.\"\"\"",
            "    result = []",
            "",
            "    base = Change.objects.content()",
            "    if user:",
            "        base = base.filter(author=user)",
            "",
            "    for language in Language.objects.filter(**kwargs).distinct().iterator():",
            "        authors = base.filter(language=language, **kwargs).authors_list(",
            "            (start_date, end_date)",
            "        )",
            "        if not authors:",
            "            continue",
            "        result.append({language.name: sorted(authors, key=lambda item: item[2])})",
            "",
            "    return result",
            "",
            "",
            "@login_required",
            "@require_POST",
            "def get_credits(request, project=None, component=None):",
            "    \"\"\"View for credits.\"\"\"",
            "    if project is None:",
            "        obj = None",
            "        kwargs = {\"translation__isnull\": False}",
            "    elif component is None:",
            "        obj = get_project(request, project)",
            "        kwargs = {\"translation__component__project\": obj}",
            "    else:",
            "        obj = get_component(request, project, component)",
            "        kwargs = {\"translation__component\": obj}",
            "",
            "    form = ReportsForm(request.POST)",
            "",
            "    if not form.is_valid():",
            "        show_form_errors(request, form)",
            "        return redirect_param(obj or \"home\", \"#reports\")",
            "",
            "    data = generate_credits(",
            "        None if request.user.has_perm(\"reports.view\", obj) else request.user,",
            "        form.cleaned_data[\"start_date\"],",
            "        form.cleaned_data[\"end_date\"],",
            "        **kwargs,",
            "    )",
            "",
            "    if form.cleaned_data[\"style\"] == \"json\":",
            "        return JsonResponse(data=data, safe=False)",
            "",
            "    if form.cleaned_data[\"style\"] == \"html\":",
            "        start = \"<table>\"",
            "        row_start = \"<tr>\"",
            "        language_format = \"<th>{0}</th>\"",
            "        translator_start = \"<td><ul>\"",
            "        translator_format = '<li><a href=\"mailto:{0}\">{1}</a> ({2})</li>'",
            "        translator_end = \"</ul></td>\"",
            "        row_end = \"</tr>\"",
            "        mime = \"text/html\"",
            "        end = \"</table>\"",
            "    else:",
            "        start = \"\"",
            "        row_start = \"\"",
            "        language_format = \"* {0}\\n\"",
            "        translator_start = \"\"",
            "        translator_format = \"    * {1} <{0}> ({2})\"",
            "        translator_end = \"\"",
            "        row_end = \"\"",
            "        mime = \"text/plain\"",
            "        end = \"\"",
            "",
            "    result = [start]",
            "",
            "    for language in data:",
            "        name, translators = language.popitem()",
            "        result.append(row_start)",
            "        result.append(language_format.format(escape(name)))",
            "        result.append(",
            "            translator_start",
            "            + \"\\n\".join(",
            "                translator_format.format(escape(t[0]), escape(t[1]), t[2])",
            "                for t in translators",
            "            )",
            "            + translator_end",
            "        )",
            "        result.append(row_end)",
            "",
            "    result.append(end)",
            "",
            "    return HttpResponse(\"\\n\".join(result), content_type=f\"{mime}; charset=utf-8\")",
            "",
            "",
            "COUNT_DEFAULTS = {",
            "    field: 0",
            "    for field in (",
            "        \"t_chars\",",
            "        \"t_words\",",
            "        \"chars\",",
            "        \"words\",",
            "        \"edits\",",
            "        \"count\",",
            "        \"t_chars_new\",",
            "        \"t_words_new\",",
            "        \"chars_new\",",
            "        \"words_new\",",
            "        \"edits_new\",",
            "        \"count_new\",",
            "        \"t_chars_approve\",",
            "        \"t_words_approve\",",
            "        \"chars_approve\",",
            "        \"words_approve\",",
            "        \"edits_approve\",",
            "        \"count_approve\",",
            "        \"t_chars_edit\",",
            "        \"t_words_edit\",",
            "        \"chars_edit\",",
            "        \"words_edit\",",
            "        \"edits_edit\",",
            "        \"count_edit\",",
            "    )",
            "}",
            "",
            "",
            "def generate_counts(user, start_date, end_date, **kwargs):",
            "    \"\"\"Generate credits data for given component.\"\"\"",
            "    result = {}",
            "    action_map = {Change.ACTION_NEW: \"new\", Change.ACTION_APPROVE: \"approve\"}",
            "",
            "    base = Change.objects.content().filter(unit__isnull=False)",
            "    if user:",
            "        base = base.filter(author=user)",
            "    else:",
            "        base = base.filter(author__isnull=False)",
            "",
            "    changes = base.filter(",
            "        timestamp__range=(start_date, end_date), **kwargs",
            "    ).prefetch_related(\"author\", \"unit\")",
            "    for change in changes:",
            "        email = change.author.email",
            "",
            "        if email not in result:",
            "            result[email] = current = {\"name\": change.author.full_name, \"email\": email}",
            "            current.update(COUNT_DEFAULTS)",
            "        else:",
            "            current = result[email]",
            "",
            "        src_chars = len(change.unit.source)",
            "        src_words = change.unit.num_words",
            "        tgt_chars = len(change.target)",
            "        tgt_words = len(change.target.split())",
            "        edits = change.get_distance()",
            "",
            "        current[\"chars\"] += src_chars",
            "        current[\"words\"] += src_words",
            "        current[\"t_chars\"] += tgt_chars",
            "        current[\"t_words\"] += tgt_words",
            "        current[\"edits\"] += edits",
            "        current[\"count\"] += 1",
            "",
            "        suffix = action_map.get(change.action, \"edit\")",
            "",
            "        current[\"t_chars_\" + suffix] += tgt_chars",
            "        current[\"t_words_\" + suffix] += tgt_words",
            "        current[\"chars_\" + suffix] += src_chars",
            "        current[\"words_\" + suffix] += src_words",
            "        current[\"edits_\" + suffix] += edits",
            "        current[\"count_\" + suffix] += 1",
            "",
            "    return list(result.values())",
            "",
            "",
            "@login_required",
            "@require_POST",
            "def get_counts(request, project=None, component=None):",
            "    \"\"\"View for work counts.\"\"\"",
            "    if project is None:",
            "        obj = None",
            "        kwargs = {}",
            "    elif component is None:",
            "        obj = get_project(request, project)",
            "        kwargs = {\"project\": obj}",
            "    else:",
            "        obj = get_component(request, project, component)",
            "        kwargs = {\"component\": obj}",
            "",
            "    form = ReportsForm(request.POST)",
            "",
            "    if not form.is_valid():",
            "        show_form_errors(request, form)",
            "        return redirect_param(obj or \"home\", \"#reports\")",
            "",
            "    data = generate_counts(",
            "        None if request.user.has_perm(\"reports.view\", obj) else request.user,",
            "        form.cleaned_data[\"start_date\"],",
            "        form.cleaned_data[\"end_date\"],",
            "        **kwargs,",
            "    )",
            "",
            "    if form.cleaned_data[\"style\"] == \"json\":",
            "        return JsonResponse(data=data, safe=False)",
            "",
            "    headers = (",
            "        \"Name\",",
            "        \"Email\",",
            "        \"Count total\",",
            "        \"Edits total\",",
            "        \"Source words total\",",
            "        \"Source chars total\",",
            "        \"Target words total\",",
            "        \"Target chars total\",",
            "        \"Count new\",",
            "        \"Edits new\",",
            "        \"Source words new\",",
            "        \"Source chars new\",",
            "        \"Target words new\",",
            "        \"Target chars new\",",
            "        \"Count approved\",",
            "        \"Edits approved\",",
            "        \"Source words approved\",",
            "        \"Source chars approved\",",
            "        \"Target words approved\",",
            "        \"Target chars approved\",",
            "        \"Count edited\",",
            "        \"Edits edited\",",
            "        \"Source words edited\",",
            "        \"Source chars edited\",",
            "        \"Target words edited\",",
            "        \"Target chars edited\",",
            "    )",
            "",
            "    if form.cleaned_data[\"style\"] == \"html\":",
            "        start = HTML_HEADING.format(\"\".join(f\"<th>{h}</th>\" for h in headers))",
            "        row_start = \"<tr>\"",
            "        cell_name = cell_count = \"<td>{0}</td>\\n\"",
            "        row_end = \"</tr>\"",
            "        mime = \"text/html\"",
            "        end = \"</table>\"",
            "    else:",
            "        start = \"{0}\\n{1} {2}\\n{0}\".format(",
            "            RST_HEADING,",
            "            \" \".join(f\"{h:40}\" for h in headers[:2]),",
            "            \" \".join(f\"{h:24}\" for h in headers[2:]),",
            "        )",
            "        row_start = \"\"",
            "        cell_name = \"{0:40} \"",
            "        cell_count = \"{0:24} \"",
            "        row_end = \"\"",
            "        mime = \"text/plain\"",
            "        end = RST_HEADING",
            "",
            "    result = [start]",
            "",
            "    for item in data:",
            "        if row_start:",
            "            result.append(row_start)",
            "        result.append(",
            "            \"\".join(",
            "                (",
            "                    cell_name.format(escape(item[\"name\"]) or \"Anonymous\"),",
            "                    cell_name.format(escape(item[\"email\"]) or \"\"),",
            "                    cell_count.format(item[\"count\"]),",
            "                    cell_count.format(item[\"edits\"]),",
            "                    cell_count.format(item[\"words\"]),",
            "                    cell_count.format(item[\"chars\"]),",
            "                    cell_count.format(item[\"t_words\"]),",
            "                    cell_count.format(item[\"t_chars\"]),",
            "                    cell_count.format(item[\"count_new\"]),",
            "                    cell_count.format(item[\"edits_new\"]),",
            "                    cell_count.format(item[\"words_new\"]),",
            "                    cell_count.format(item[\"chars_new\"]),",
            "                    cell_count.format(item[\"t_words_new\"]),",
            "                    cell_count.format(item[\"t_chars_new\"]),",
            "                    cell_count.format(item[\"count_approve\"]),",
            "                    cell_count.format(item[\"edits_approve\"]),",
            "                    cell_count.format(item[\"words_approve\"]),",
            "                    cell_count.format(item[\"chars_approve\"]),",
            "                    cell_count.format(item[\"t_words_approve\"]),",
            "                    cell_count.format(item[\"t_chars_approve\"]),",
            "                    cell_count.format(item[\"count_edit\"]),",
            "                    cell_count.format(item[\"edits_edit\"]),",
            "                    cell_count.format(item[\"words_edit\"]),",
            "                    cell_count.format(item[\"chars_edit\"]),",
            "                    cell_count.format(item[\"t_words_edit\"]),",
            "                    cell_count.format(item[\"t_chars_edit\"]),",
            "                )",
            "            )",
            "        )",
            "        if row_end:",
            "            result.append(row_end)",
            "",
            "    result.append(end)",
            "",
            "    return HttpResponse(\"\\n\".join(result), content_type=f\"{mime}; charset=utf-8\")"
        ],
        "action": [
            "0",
            "0",
            "0",
            "1",
            "0",
            "0",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "20": [],
            "112": [
                "get_credits"
            ],
            "115": [
                "get_credits"
            ],
            "291": [
                "get_counts"
            ],
            "292": [
                "get_counts"
            ]
        },
        "addLocation": []
    }
}