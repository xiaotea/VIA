{
    "keystone/catalog/core.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 23,
                "afterPatchRowNumber": 23,
                "PatchRowcode": " from keystone.common import dependency"
            },
            "1": {
                "beforePatchRowNumber": 24,
                "afterPatchRowNumber": 24,
                "PatchRowcode": " from keystone.common import driver_hints"
            },
            "2": {
                "beforePatchRowNumber": 25,
                "afterPatchRowNumber": 25,
                "PatchRowcode": " from keystone.common import manager"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 26,
                "PatchRowcode": "+from keystone.common import utils"
            },
            "4": {
                "beforePatchRowNumber": 26,
                "afterPatchRowNumber": 27,
                "PatchRowcode": " from keystone import config"
            },
            "5": {
                "beforePatchRowNumber": 27,
                "afterPatchRowNumber": 28,
                "PatchRowcode": " from keystone import exception"
            },
            "6": {
                "beforePatchRowNumber": 28,
                "afterPatchRowNumber": 29,
                "PatchRowcode": " from keystone.i18n import _"
            },
            "7": {
                "beforePatchRowNumber": 46,
                "afterPatchRowNumber": 47,
                "PatchRowcode": "     :returns: a formatted URL"
            },
            "8": {
                "beforePatchRowNumber": 47,
                "afterPatchRowNumber": 48,
                "PatchRowcode": " "
            },
            "9": {
                "beforePatchRowNumber": 48,
                "afterPatchRowNumber": 49,
                "PatchRowcode": "     \"\"\""
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 50,
                "PatchRowcode": "+    substitutions = utils.WhiteListedItemFilter("
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 51,
                "PatchRowcode": "+        CONF.catalog.endpoint_substitution_whitelist,"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 52,
                "PatchRowcode": "+        substitutions)"
            },
            "13": {
                "beforePatchRowNumber": 49,
                "afterPatchRowNumber": 53,
                "PatchRowcode": "     try:"
            },
            "14": {
                "beforePatchRowNumber": 50,
                "afterPatchRowNumber": 54,
                "PatchRowcode": "         result = url.replace('$(', '%(') % substitutions"
            },
            "15": {
                "beforePatchRowNumber": 51,
                "afterPatchRowNumber": 55,
                "PatchRowcode": "     except AttributeError:"
            }
        },
        "frontPatchFile": [
            "# Copyright 2012 OpenStack Foundation",
            "# Copyright 2012 Canonical Ltd.",
            "#",
            "# Licensed under the Apache License, Version 2.0 (the \"License\"); you may",
            "# not use this file except in compliance with the License. You may obtain",
            "# a copy of the License at",
            "#",
            "#      http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "# Unless required by applicable law or agreed to in writing, software",
            "# distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
            "# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
            "# License for the specific language governing permissions and limitations",
            "# under the License.",
            "",
            "\"\"\"Main entry point into the Catalog service.\"\"\"",
            "",
            "import abc",
            "",
            "import six",
            "",
            "from keystone.common import cache",
            "from keystone.common import dependency",
            "from keystone.common import driver_hints",
            "from keystone.common import manager",
            "from keystone import config",
            "from keystone import exception",
            "from keystone.i18n import _",
            "from keystone.i18n import _LE",
            "from keystone import notifications",
            "from keystone.openstack.common import log",
            "",
            "",
            "CONF = config.CONF",
            "LOG = log.getLogger(__name__)",
            "SHOULD_CACHE = cache.should_cache_fn('catalog')",
            "",
            "EXPIRATION_TIME = lambda: CONF.catalog.cache_time",
            "",
            "",
            "def format_url(url, substitutions):",
            "    \"\"\"Formats a user-defined URL with the given substitutions.",
            "",
            "    :param string url: the URL to be formatted",
            "    :param dict substitutions: the dictionary used for substitution",
            "    :returns: a formatted URL",
            "",
            "    \"\"\"",
            "    try:",
            "        result = url.replace('$(', '%(') % substitutions",
            "    except AttributeError:",
            "        LOG.error(_('Malformed endpoint - %(url)r is not a string'),",
            "                  {\"url\": url})",
            "        raise exception.MalformedEndpoint(endpoint=url)",
            "    except KeyError as e:",
            "        LOG.error(_LE(\"Malformed endpoint %(url)s - unknown key %(keyerror)s\"),",
            "                  {\"url\": url,",
            "                   \"keyerror\": e})",
            "        raise exception.MalformedEndpoint(endpoint=url)",
            "    except TypeError as e:",
            "        LOG.error(_LE(\"Malformed endpoint '%(url)s'. The following type error \"",
            "                      \"occurred during string substitution: %(typeerror)s\"),",
            "                  {\"url\": url,",
            "                   \"typeerror\": e})",
            "        raise exception.MalformedEndpoint(endpoint=url)",
            "    except ValueError as e:",
            "        LOG.error(_LE(\"Malformed endpoint %s - incomplete format \"",
            "                      \"(are you missing a type notifier ?)\"), url)",
            "        raise exception.MalformedEndpoint(endpoint=url)",
            "    return result",
            "",
            "",
            "@dependency.provider('catalog_api')",
            "class Manager(manager.Manager):",
            "    \"\"\"Default pivot point for the Catalog backend.",
            "",
            "    See :mod:`keystone.common.manager.Manager` for more details on how this",
            "    dynamically calls the backend.",
            "",
            "    \"\"\"",
            "    _ENDPOINT = 'endpoint'",
            "    _SERVICE = 'service'",
            "    _REGION = 'region'",
            "",
            "    def __init__(self):",
            "        super(Manager, self).__init__(CONF.catalog.driver)",
            "",
            "    @notifications.created(_REGION, public=False, result_id_arg_attr='id')",
            "    def create_region(self, region_ref):",
            "        # Check duplicate ID",
            "        try:",
            "            self.get_region(region_ref['id'])",
            "        except exception.RegionNotFound:",
            "            pass",
            "        else:",
            "            msg = _('Duplicate ID, %s.') % region_ref['id']",
            "            raise exception.Conflict(type='region', details=msg)",
            "",
            "        # NOTE(lbragstad): The description column of the region database",
            "        # can not be null. So if the user doesn't pass in a description then",
            "        # set it to an empty string.",
            "        region_ref.setdefault('description', '')",
            "        try:",
            "            return self.driver.create_region(region_ref)",
            "        except exception.NotFound:",
            "            parent_region_id = region_ref.get('parent_region_id')",
            "            raise exception.RegionNotFound(region_id=parent_region_id)",
            "",
            "    @cache.on_arguments(should_cache_fn=SHOULD_CACHE,",
            "                        expiration_time=EXPIRATION_TIME)",
            "    def get_region(self, region_id):",
            "        try:",
            "            return self.driver.get_region(region_id)",
            "        except exception.NotFound:",
            "            raise exception.RegionNotFound(region_id=region_id)",
            "",
            "    @notifications.updated(_REGION, public=False)",
            "    def update_region(self, region_id, region_ref):",
            "        return self.driver.update_region(region_id, region_ref)",
            "",
            "    @notifications.deleted(_REGION, public=False)",
            "    def delete_region(self, region_id):",
            "        try:",
            "            ret = self.driver.delete_region(region_id)",
            "            self.get_region.invalidate(self, region_id)",
            "            return ret",
            "        except exception.NotFound:",
            "            raise exception.RegionNotFound(region_id=region_id)",
            "",
            "    @manager.response_truncated",
            "    def list_regions(self, hints=None):",
            "        return self.driver.list_regions(hints or driver_hints.Hints())",
            "",
            "    @notifications.created(_SERVICE, public=False)",
            "    def create_service(self, service_id, service_ref):",
            "        service_ref.setdefault('enabled', True)",
            "        return self.driver.create_service(service_id, service_ref)",
            "",
            "    @cache.on_arguments(should_cache_fn=SHOULD_CACHE,",
            "                        expiration_time=EXPIRATION_TIME)",
            "    def get_service(self, service_id):",
            "        try:",
            "            return self.driver.get_service(service_id)",
            "        except exception.NotFound:",
            "            raise exception.ServiceNotFound(service_id=service_id)",
            "",
            "    @notifications.updated(_SERVICE, public=False)",
            "    def update_service(self, service_id, service_ref):",
            "        return self.driver.update_service(service_id, service_ref)",
            "",
            "    @notifications.deleted(_SERVICE, public=False)",
            "    def delete_service(self, service_id):",
            "        try:",
            "            endpoints = self.list_endpoints()",
            "            ret = self.driver.delete_service(service_id)",
            "            self.get_service.invalidate(self, service_id)",
            "            for endpoint in endpoints:",
            "                if endpoint['service_id'] == service_id:",
            "                    self.get_endpoint.invalidate(self, endpoint['id'])",
            "            return ret",
            "        except exception.NotFound:",
            "            raise exception.ServiceNotFound(service_id=service_id)",
            "",
            "    @manager.response_truncated",
            "    def list_services(self, hints=None):",
            "        return self.driver.list_services(hints or driver_hints.Hints())",
            "",
            "    @notifications.created(_ENDPOINT, public=False)",
            "    def create_endpoint(self, endpoint_id, endpoint_ref):",
            "        try:",
            "            return self.driver.create_endpoint(endpoint_id, endpoint_ref)",
            "        except exception.RegionNotFound:",
            "            raise exception.ValidationError(attribute='endpoint region_id',",
            "                                            target='region table')",
            "        except exception.NotFound:",
            "            service_id = endpoint_ref.get('service_id')",
            "            raise exception.ServiceNotFound(service_id=service_id)",
            "",
            "    @notifications.updated(_ENDPOINT, public=False)",
            "    def update_endpoint(self, endpoint_id, endpoint_ref):",
            "        return self.driver.update_endpoint(endpoint_id, endpoint_ref)",
            "",
            "    @notifications.deleted(_ENDPOINT, public=False)",
            "    def delete_endpoint(self, endpoint_id):",
            "        try:",
            "            ret = self.driver.delete_endpoint(endpoint_id)",
            "            self.get_endpoint.invalidate(self, endpoint_id)",
            "            return ret",
            "        except exception.NotFound:",
            "            raise exception.EndpointNotFound(endpoint_id=endpoint_id)",
            "",
            "    @cache.on_arguments(should_cache_fn=SHOULD_CACHE,",
            "                        expiration_time=EXPIRATION_TIME)",
            "    def get_endpoint(self, endpoint_id):",
            "        try:",
            "            return self.driver.get_endpoint(endpoint_id)",
            "        except exception.NotFound:",
            "            raise exception.EndpointNotFound(endpoint_id=endpoint_id)",
            "",
            "    @manager.response_truncated",
            "    def list_endpoints(self, hints=None):",
            "        return self.driver.list_endpoints(hints or driver_hints.Hints())",
            "",
            "    def get_catalog(self, user_id, tenant_id, metadata=None):",
            "        try:",
            "            return self.driver.get_catalog(user_id, tenant_id, metadata)",
            "        except exception.NotFound:",
            "            raise exception.NotFound('Catalog not found for user and tenant')",
            "",
            "",
            "@six.add_metaclass(abc.ABCMeta)",
            "class Driver(object):",
            "    \"\"\"Interface description for an Catalog driver.\"\"\"",
            "",
            "    def _get_list_limit(self):",
            "        return CONF.catalog.list_limit or CONF.list_limit",
            "",
            "    @abc.abstractmethod",
            "    def create_region(self, region_ref):",
            "        \"\"\"Creates a new region.",
            "",
            "        :raises: keystone.exception.Conflict",
            "        :raises: keystone.exception.RegionNotFound (if parent region invalid)",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def list_regions(self, hints):",
            "        \"\"\"List all regions.",
            "",
            "        :param hints: contains the list of filters yet to be satisfied.",
            "                      Any filters satisfied here will be removed so that",
            "                      the caller will know if any filters remain.",
            "",
            "        :returns: list of region_refs or an empty list.",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def get_region(self, region_id):",
            "        \"\"\"Get region by id.",
            "",
            "        :returns: region_ref dict",
            "        :raises: keystone.exception.RegionNotFound",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def update_region(self, region_id, region_ref):",
            "        \"\"\"Update region by id.",
            "",
            "        :returns: region_ref dict",
            "        :raises: keystone.exception.RegionNotFound",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def delete_region(self, region_id):",
            "        \"\"\"Deletes an existing region.",
            "",
            "        :raises: keystone.exception.RegionNotFound",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def create_service(self, service_id, service_ref):",
            "        \"\"\"Creates a new service.",
            "",
            "        :raises: keystone.exception.Conflict",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def list_services(self, hints):",
            "        \"\"\"List all services.",
            "",
            "        :param hints: contains the list of filters yet to be satisfied.",
            "                      Any filters satisfied here will be removed so that",
            "                      the caller will know if any filters remain.",
            "",
            "        :returns: list of service_refs or an empty list.",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def get_service(self, service_id):",
            "        \"\"\"Get service by id.",
            "",
            "        :returns: service_ref dict",
            "        :raises: keystone.exception.ServiceNotFound",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def update_service(self, service_id, service_ref):",
            "        \"\"\"Update service by id.",
            "",
            "        :returns: service_ref dict",
            "        :raises: keystone.exception.ServiceNotFound",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def delete_service(self, service_id):",
            "        \"\"\"Deletes an existing service.",
            "",
            "        :raises: keystone.exception.ServiceNotFound",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def create_endpoint(self, endpoint_id, endpoint_ref):",
            "        \"\"\"Creates a new endpoint for a service.",
            "",
            "        :raises: keystone.exception.Conflict,",
            "                 keystone.exception.ServiceNotFound",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def get_endpoint(self, endpoint_id):",
            "        \"\"\"Get endpoint by id.",
            "",
            "        :returns: endpoint_ref dict",
            "        :raises: keystone.exception.EndpointNotFound",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def list_endpoints(self, hints):",
            "        \"\"\"List all endpoints.",
            "",
            "        :param hints: contains the list of filters yet to be satisfied.",
            "                      Any filters satisfied here will be removed so that",
            "                      the caller will know if any filters remain.",
            "",
            "        :returns: list of endpoint_refs or an empty list.",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def update_endpoint(self, endpoint_id, endpoint_ref):",
            "        \"\"\"Get endpoint by id.",
            "",
            "        :returns: endpoint_ref dict",
            "        :raises: keystone.exception.EndpointNotFound",
            "                 keystone.exception.ServiceNotFound",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def delete_endpoint(self, endpoint_id):",
            "        \"\"\"Deletes an endpoint for a service.",
            "",
            "        :raises: keystone.exception.EndpointNotFound",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def get_catalog(self, user_id, tenant_id, metadata=None):",
            "        \"\"\"Retrieve and format the current service catalog.",
            "",
            "        Example::",
            "",
            "            { 'RegionOne':",
            "                {'compute': {",
            "                    'adminURL': u'http://host:8774/v1.1/tenantid',",
            "                    'internalURL': u'http://host:8774/v1.1/tenant_id',",
            "                    'name': 'Compute Service',",
            "                    'publicURL': u'http://host:8774/v1.1/tenantid'},",
            "                 'ec2': {",
            "                    'adminURL': 'http://host:8773/services/Admin',",
            "                    'internalURL': 'http://host:8773/services/Cloud',",
            "                    'name': 'EC2 Service',",
            "                    'publicURL': 'http://host:8773/services/Cloud'}}",
            "",
            "        :returns: A nested dict representing the service catalog or an",
            "                  empty dict.",
            "        :raises: keystone.exception.NotFound",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    def get_v3_catalog(self, user_id, tenant_id, metadata=None):",
            "        \"\"\"Retrieve and format the current V3 service catalog.",
            "",
            "        The default implementation builds the V3 catalog from the V2 catalog.",
            "",
            "        Example::",
            "",
            "            [",
            "                {",
            "                    \"endpoints\": [",
            "                    {",
            "                        \"interface\": \"public\",",
            "                        \"id\": \"--endpoint-id--\",",
            "                        \"region\": \"RegionOne\",",
            "                        \"url\": \"http://external:8776/v1/--project-id--\"",
            "                    },",
            "                    {",
            "                        \"interface\": \"internal\",",
            "                        \"id\": \"--endpoint-id--\",",
            "                        \"region\": \"RegionOne\",",
            "                        \"url\": \"http://internal:8776/v1/--project-id--\"",
            "                    }],",
            "                \"id\": \"--service-id--\",",
            "                \"type\": \"volume\"",
            "            }]",
            "",
            "        :returns: A list representing the service catalog or an empty list",
            "        :raises: keystone.exception.NotFound",
            "",
            "        \"\"\"",
            "        v2_catalog = self.get_catalog(user_id, tenant_id, metadata=metadata)",
            "        v3_catalog = []",
            "",
            "        for region_name, region in six.iteritems(v2_catalog):",
            "            for service_type, service in six.iteritems(region):",
            "                service_v3 = {",
            "                    'type': service_type,",
            "                    'endpoints': []",
            "                }",
            "",
            "                for attr, value in six.iteritems(service):",
            "                    # Attributes that end in URL are interfaces. In the V2",
            "                    # catalog, these are internalURL, publicURL, and adminURL.",
            "                    # For example, <region_name>.publicURL=<URL> in the V2",
            "                    # catalog becomes the V3 interface for the service:",
            "                    # { 'interface': 'public', 'url': '<URL>', 'region':",
            "                    #   'region: '<region_name>' }",
            "                    if attr.endswith('URL'):",
            "                        v3_interface = attr[:-len('URL')]",
            "                        service_v3['endpoints'].append({",
            "                            'interface': v3_interface,",
            "                            'region': region_name,",
            "                            'url': value,",
            "                        })",
            "                        continue",
            "",
            "                    # Other attributes are copied to the service.",
            "                    service_v3[attr] = value",
            "",
            "                v3_catalog.append(service_v3)",
            "",
            "        return v3_catalog"
        ],
        "afterPatchFile": [
            "# Copyright 2012 OpenStack Foundation",
            "# Copyright 2012 Canonical Ltd.",
            "#",
            "# Licensed under the Apache License, Version 2.0 (the \"License\"); you may",
            "# not use this file except in compliance with the License. You may obtain",
            "# a copy of the License at",
            "#",
            "#      http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "# Unless required by applicable law or agreed to in writing, software",
            "# distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
            "# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
            "# License for the specific language governing permissions and limitations",
            "# under the License.",
            "",
            "\"\"\"Main entry point into the Catalog service.\"\"\"",
            "",
            "import abc",
            "",
            "import six",
            "",
            "from keystone.common import cache",
            "from keystone.common import dependency",
            "from keystone.common import driver_hints",
            "from keystone.common import manager",
            "from keystone.common import utils",
            "from keystone import config",
            "from keystone import exception",
            "from keystone.i18n import _",
            "from keystone.i18n import _LE",
            "from keystone import notifications",
            "from keystone.openstack.common import log",
            "",
            "",
            "CONF = config.CONF",
            "LOG = log.getLogger(__name__)",
            "SHOULD_CACHE = cache.should_cache_fn('catalog')",
            "",
            "EXPIRATION_TIME = lambda: CONF.catalog.cache_time",
            "",
            "",
            "def format_url(url, substitutions):",
            "    \"\"\"Formats a user-defined URL with the given substitutions.",
            "",
            "    :param string url: the URL to be formatted",
            "    :param dict substitutions: the dictionary used for substitution",
            "    :returns: a formatted URL",
            "",
            "    \"\"\"",
            "    substitutions = utils.WhiteListedItemFilter(",
            "        CONF.catalog.endpoint_substitution_whitelist,",
            "        substitutions)",
            "    try:",
            "        result = url.replace('$(', '%(') % substitutions",
            "    except AttributeError:",
            "        LOG.error(_('Malformed endpoint - %(url)r is not a string'),",
            "                  {\"url\": url})",
            "        raise exception.MalformedEndpoint(endpoint=url)",
            "    except KeyError as e:",
            "        LOG.error(_LE(\"Malformed endpoint %(url)s - unknown key %(keyerror)s\"),",
            "                  {\"url\": url,",
            "                   \"keyerror\": e})",
            "        raise exception.MalformedEndpoint(endpoint=url)",
            "    except TypeError as e:",
            "        LOG.error(_LE(\"Malformed endpoint '%(url)s'. The following type error \"",
            "                      \"occurred during string substitution: %(typeerror)s\"),",
            "                  {\"url\": url,",
            "                   \"typeerror\": e})",
            "        raise exception.MalformedEndpoint(endpoint=url)",
            "    except ValueError as e:",
            "        LOG.error(_LE(\"Malformed endpoint %s - incomplete format \"",
            "                      \"(are you missing a type notifier ?)\"), url)",
            "        raise exception.MalformedEndpoint(endpoint=url)",
            "    return result",
            "",
            "",
            "@dependency.provider('catalog_api')",
            "class Manager(manager.Manager):",
            "    \"\"\"Default pivot point for the Catalog backend.",
            "",
            "    See :mod:`keystone.common.manager.Manager` for more details on how this",
            "    dynamically calls the backend.",
            "",
            "    \"\"\"",
            "    _ENDPOINT = 'endpoint'",
            "    _SERVICE = 'service'",
            "    _REGION = 'region'",
            "",
            "    def __init__(self):",
            "        super(Manager, self).__init__(CONF.catalog.driver)",
            "",
            "    @notifications.created(_REGION, public=False, result_id_arg_attr='id')",
            "    def create_region(self, region_ref):",
            "        # Check duplicate ID",
            "        try:",
            "            self.get_region(region_ref['id'])",
            "        except exception.RegionNotFound:",
            "            pass",
            "        else:",
            "            msg = _('Duplicate ID, %s.') % region_ref['id']",
            "            raise exception.Conflict(type='region', details=msg)",
            "",
            "        # NOTE(lbragstad): The description column of the region database",
            "        # can not be null. So if the user doesn't pass in a description then",
            "        # set it to an empty string.",
            "        region_ref.setdefault('description', '')",
            "        try:",
            "            return self.driver.create_region(region_ref)",
            "        except exception.NotFound:",
            "            parent_region_id = region_ref.get('parent_region_id')",
            "            raise exception.RegionNotFound(region_id=parent_region_id)",
            "",
            "    @cache.on_arguments(should_cache_fn=SHOULD_CACHE,",
            "                        expiration_time=EXPIRATION_TIME)",
            "    def get_region(self, region_id):",
            "        try:",
            "            return self.driver.get_region(region_id)",
            "        except exception.NotFound:",
            "            raise exception.RegionNotFound(region_id=region_id)",
            "",
            "    @notifications.updated(_REGION, public=False)",
            "    def update_region(self, region_id, region_ref):",
            "        return self.driver.update_region(region_id, region_ref)",
            "",
            "    @notifications.deleted(_REGION, public=False)",
            "    def delete_region(self, region_id):",
            "        try:",
            "            ret = self.driver.delete_region(region_id)",
            "            self.get_region.invalidate(self, region_id)",
            "            return ret",
            "        except exception.NotFound:",
            "            raise exception.RegionNotFound(region_id=region_id)",
            "",
            "    @manager.response_truncated",
            "    def list_regions(self, hints=None):",
            "        return self.driver.list_regions(hints or driver_hints.Hints())",
            "",
            "    @notifications.created(_SERVICE, public=False)",
            "    def create_service(self, service_id, service_ref):",
            "        service_ref.setdefault('enabled', True)",
            "        return self.driver.create_service(service_id, service_ref)",
            "",
            "    @cache.on_arguments(should_cache_fn=SHOULD_CACHE,",
            "                        expiration_time=EXPIRATION_TIME)",
            "    def get_service(self, service_id):",
            "        try:",
            "            return self.driver.get_service(service_id)",
            "        except exception.NotFound:",
            "            raise exception.ServiceNotFound(service_id=service_id)",
            "",
            "    @notifications.updated(_SERVICE, public=False)",
            "    def update_service(self, service_id, service_ref):",
            "        return self.driver.update_service(service_id, service_ref)",
            "",
            "    @notifications.deleted(_SERVICE, public=False)",
            "    def delete_service(self, service_id):",
            "        try:",
            "            endpoints = self.list_endpoints()",
            "            ret = self.driver.delete_service(service_id)",
            "            self.get_service.invalidate(self, service_id)",
            "            for endpoint in endpoints:",
            "                if endpoint['service_id'] == service_id:",
            "                    self.get_endpoint.invalidate(self, endpoint['id'])",
            "            return ret",
            "        except exception.NotFound:",
            "            raise exception.ServiceNotFound(service_id=service_id)",
            "",
            "    @manager.response_truncated",
            "    def list_services(self, hints=None):",
            "        return self.driver.list_services(hints or driver_hints.Hints())",
            "",
            "    @notifications.created(_ENDPOINT, public=False)",
            "    def create_endpoint(self, endpoint_id, endpoint_ref):",
            "        try:",
            "            return self.driver.create_endpoint(endpoint_id, endpoint_ref)",
            "        except exception.RegionNotFound:",
            "            raise exception.ValidationError(attribute='endpoint region_id',",
            "                                            target='region table')",
            "        except exception.NotFound:",
            "            service_id = endpoint_ref.get('service_id')",
            "            raise exception.ServiceNotFound(service_id=service_id)",
            "",
            "    @notifications.updated(_ENDPOINT, public=False)",
            "    def update_endpoint(self, endpoint_id, endpoint_ref):",
            "        return self.driver.update_endpoint(endpoint_id, endpoint_ref)",
            "",
            "    @notifications.deleted(_ENDPOINT, public=False)",
            "    def delete_endpoint(self, endpoint_id):",
            "        try:",
            "            ret = self.driver.delete_endpoint(endpoint_id)",
            "            self.get_endpoint.invalidate(self, endpoint_id)",
            "            return ret",
            "        except exception.NotFound:",
            "            raise exception.EndpointNotFound(endpoint_id=endpoint_id)",
            "",
            "    @cache.on_arguments(should_cache_fn=SHOULD_CACHE,",
            "                        expiration_time=EXPIRATION_TIME)",
            "    def get_endpoint(self, endpoint_id):",
            "        try:",
            "            return self.driver.get_endpoint(endpoint_id)",
            "        except exception.NotFound:",
            "            raise exception.EndpointNotFound(endpoint_id=endpoint_id)",
            "",
            "    @manager.response_truncated",
            "    def list_endpoints(self, hints=None):",
            "        return self.driver.list_endpoints(hints or driver_hints.Hints())",
            "",
            "    def get_catalog(self, user_id, tenant_id, metadata=None):",
            "        try:",
            "            return self.driver.get_catalog(user_id, tenant_id, metadata)",
            "        except exception.NotFound:",
            "            raise exception.NotFound('Catalog not found for user and tenant')",
            "",
            "",
            "@six.add_metaclass(abc.ABCMeta)",
            "class Driver(object):",
            "    \"\"\"Interface description for an Catalog driver.\"\"\"",
            "",
            "    def _get_list_limit(self):",
            "        return CONF.catalog.list_limit or CONF.list_limit",
            "",
            "    @abc.abstractmethod",
            "    def create_region(self, region_ref):",
            "        \"\"\"Creates a new region.",
            "",
            "        :raises: keystone.exception.Conflict",
            "        :raises: keystone.exception.RegionNotFound (if parent region invalid)",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def list_regions(self, hints):",
            "        \"\"\"List all regions.",
            "",
            "        :param hints: contains the list of filters yet to be satisfied.",
            "                      Any filters satisfied here will be removed so that",
            "                      the caller will know if any filters remain.",
            "",
            "        :returns: list of region_refs or an empty list.",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def get_region(self, region_id):",
            "        \"\"\"Get region by id.",
            "",
            "        :returns: region_ref dict",
            "        :raises: keystone.exception.RegionNotFound",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def update_region(self, region_id, region_ref):",
            "        \"\"\"Update region by id.",
            "",
            "        :returns: region_ref dict",
            "        :raises: keystone.exception.RegionNotFound",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def delete_region(self, region_id):",
            "        \"\"\"Deletes an existing region.",
            "",
            "        :raises: keystone.exception.RegionNotFound",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def create_service(self, service_id, service_ref):",
            "        \"\"\"Creates a new service.",
            "",
            "        :raises: keystone.exception.Conflict",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def list_services(self, hints):",
            "        \"\"\"List all services.",
            "",
            "        :param hints: contains the list of filters yet to be satisfied.",
            "                      Any filters satisfied here will be removed so that",
            "                      the caller will know if any filters remain.",
            "",
            "        :returns: list of service_refs or an empty list.",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def get_service(self, service_id):",
            "        \"\"\"Get service by id.",
            "",
            "        :returns: service_ref dict",
            "        :raises: keystone.exception.ServiceNotFound",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def update_service(self, service_id, service_ref):",
            "        \"\"\"Update service by id.",
            "",
            "        :returns: service_ref dict",
            "        :raises: keystone.exception.ServiceNotFound",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def delete_service(self, service_id):",
            "        \"\"\"Deletes an existing service.",
            "",
            "        :raises: keystone.exception.ServiceNotFound",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def create_endpoint(self, endpoint_id, endpoint_ref):",
            "        \"\"\"Creates a new endpoint for a service.",
            "",
            "        :raises: keystone.exception.Conflict,",
            "                 keystone.exception.ServiceNotFound",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def get_endpoint(self, endpoint_id):",
            "        \"\"\"Get endpoint by id.",
            "",
            "        :returns: endpoint_ref dict",
            "        :raises: keystone.exception.EndpointNotFound",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def list_endpoints(self, hints):",
            "        \"\"\"List all endpoints.",
            "",
            "        :param hints: contains the list of filters yet to be satisfied.",
            "                      Any filters satisfied here will be removed so that",
            "                      the caller will know if any filters remain.",
            "",
            "        :returns: list of endpoint_refs or an empty list.",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def update_endpoint(self, endpoint_id, endpoint_ref):",
            "        \"\"\"Get endpoint by id.",
            "",
            "        :returns: endpoint_ref dict",
            "        :raises: keystone.exception.EndpointNotFound",
            "                 keystone.exception.ServiceNotFound",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def delete_endpoint(self, endpoint_id):",
            "        \"\"\"Deletes an endpoint for a service.",
            "",
            "        :raises: keystone.exception.EndpointNotFound",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    @abc.abstractmethod",
            "    def get_catalog(self, user_id, tenant_id, metadata=None):",
            "        \"\"\"Retrieve and format the current service catalog.",
            "",
            "        Example::",
            "",
            "            { 'RegionOne':",
            "                {'compute': {",
            "                    'adminURL': u'http://host:8774/v1.1/tenantid',",
            "                    'internalURL': u'http://host:8774/v1.1/tenant_id',",
            "                    'name': 'Compute Service',",
            "                    'publicURL': u'http://host:8774/v1.1/tenantid'},",
            "                 'ec2': {",
            "                    'adminURL': 'http://host:8773/services/Admin',",
            "                    'internalURL': 'http://host:8773/services/Cloud',",
            "                    'name': 'EC2 Service',",
            "                    'publicURL': 'http://host:8773/services/Cloud'}}",
            "",
            "        :returns: A nested dict representing the service catalog or an",
            "                  empty dict.",
            "        :raises: keystone.exception.NotFound",
            "",
            "        \"\"\"",
            "        raise exception.NotImplemented()  # pragma: no cover",
            "",
            "    def get_v3_catalog(self, user_id, tenant_id, metadata=None):",
            "        \"\"\"Retrieve and format the current V3 service catalog.",
            "",
            "        The default implementation builds the V3 catalog from the V2 catalog.",
            "",
            "        Example::",
            "",
            "            [",
            "                {",
            "                    \"endpoints\": [",
            "                    {",
            "                        \"interface\": \"public\",",
            "                        \"id\": \"--endpoint-id--\",",
            "                        \"region\": \"RegionOne\",",
            "                        \"url\": \"http://external:8776/v1/--project-id--\"",
            "                    },",
            "                    {",
            "                        \"interface\": \"internal\",",
            "                        \"id\": \"--endpoint-id--\",",
            "                        \"region\": \"RegionOne\",",
            "                        \"url\": \"http://internal:8776/v1/--project-id--\"",
            "                    }],",
            "                \"id\": \"--service-id--\",",
            "                \"type\": \"volume\"",
            "            }]",
            "",
            "        :returns: A list representing the service catalog or an empty list",
            "        :raises: keystone.exception.NotFound",
            "",
            "        \"\"\"",
            "        v2_catalog = self.get_catalog(user_id, tenant_id, metadata=metadata)",
            "        v3_catalog = []",
            "",
            "        for region_name, region in six.iteritems(v2_catalog):",
            "            for service_type, service in six.iteritems(region):",
            "                service_v3 = {",
            "                    'type': service_type,",
            "                    'endpoints': []",
            "                }",
            "",
            "                for attr, value in six.iteritems(service):",
            "                    # Attributes that end in URL are interfaces. In the V2",
            "                    # catalog, these are internalURL, publicURL, and adminURL.",
            "                    # For example, <region_name>.publicURL=<URL> in the V2",
            "                    # catalog becomes the V3 interface for the service:",
            "                    # { 'interface': 'public', 'url': '<URL>', 'region':",
            "                    #   'region: '<region_name>' }",
            "                    if attr.endswith('URL'):",
            "                        v3_interface = attr[:-len('URL')]",
            "                        service_v3['endpoints'].append({",
            "                            'interface': v3_interface,",
            "                            'region': region_name,",
            "                            'url': value,",
            "                        })",
            "                        continue",
            "",
            "                    # Other attributes are copied to the service.",
            "                    service_v3[attr] = value",
            "",
            "                v3_catalog.append(service_v3)",
            "",
            "        return v3_catalog"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {},
        "addLocation": [
            "neutron.tests.unit.plugins.ml2.drivers.openvswitch.agent.test_ovs_neutron_agent.TestOvsNeutronAgent.test_agent_type_ovs"
        ]
    },
    "keystone/common/config.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 792,
                "afterPatchRowNumber": 792,
                "PatchRowcode": "         cfg.IntOpt('list_limit',"
            },
            "1": {
                "beforePatchRowNumber": 793,
                "afterPatchRowNumber": 793,
                "PatchRowcode": "                    help='Maximum number of entities that will be returned '"
            },
            "2": {
                "beforePatchRowNumber": 794,
                "afterPatchRowNumber": 794,
                "PatchRowcode": "                         'in a catalog collection.'),"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 795,
                "PatchRowcode": "+        cfg.ListOpt('endpoint_substitution_whitelist',"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 796,
                "PatchRowcode": "+                    default=['tenant_id', 'user_id', 'public_bind_host',"
            },
            "5": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 797,
                "PatchRowcode": "+                             'admin_bind_host', 'compute_host', 'compute_port',"
            },
            "6": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 798,
                "PatchRowcode": "+                             'admin_port', 'public_port', 'public_endpoint',"
            },
            "7": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 799,
                "PatchRowcode": "+                             'admin_endpoint'],"
            },
            "8": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 800,
                "PatchRowcode": "+                    help='(Deprecated) List of possible substitutions for use '"
            },
            "9": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 801,
                "PatchRowcode": "+                         'in formatting endpoints. Use caution when modifying '"
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 802,
                "PatchRowcode": "+                         'this list. It will give users with permission to '"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 803,
                "PatchRowcode": "+                         'create endpoints the ability to see those values '"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 804,
                "PatchRowcode": "+                         'in your configuration file. This option will be '"
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 805,
                "PatchRowcode": "+                         'removed in Juno.'),"
            },
            "14": {
                "beforePatchRowNumber": 795,
                "afterPatchRowNumber": 806,
                "PatchRowcode": "     ],"
            },
            "15": {
                "beforePatchRowNumber": 796,
                "afterPatchRowNumber": 807,
                "PatchRowcode": "     'kvs': ["
            },
            "16": {
                "beforePatchRowNumber": 797,
                "afterPatchRowNumber": 808,
                "PatchRowcode": "         cfg.ListOpt('backends', default=[],"
            }
        },
        "frontPatchFile": [
            "# Copyright 2012 OpenStack Foundation",
            "#",
            "# Licensed under the Apache License, Version 2.0 (the \"License\"); you may",
            "# not use this file except in compliance with the License. You may obtain",
            "# a copy of the License at",
            "#",
            "#      http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "# Unless required by applicable law or agreed to in writing, software",
            "# distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
            "# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
            "# License for the specific language governing permissions and limitations",
            "# under the License.",
            "",
            "from oslo.config import cfg",
            "from oslo import messaging",
            "",
            "",
            "_DEFAULT_AUTH_METHODS = ['external', 'password', 'token']",
            "_CERTFILE = '/etc/keystone/ssl/certs/signing_cert.pem'",
            "_KEYFILE = '/etc/keystone/ssl/private/signing_key.pem'",
            "",
            "",
            "FILE_OPTIONS = {",
            "    None: [",
            "        cfg.StrOpt('admin_token', secret=True, default='ADMIN',",
            "                   help='A \"shared secret\" that can be used to bootstrap '",
            "                        'Keystone. This \"token\" does not represent a user, '",
            "                        'and carries no explicit authorization. To disable '",
            "                        'in production (highly recommended), remove '",
            "                        'AdminTokenAuthMiddleware from your paste '",
            "                        'application pipelines (for example, in '",
            "                        'keystone-paste.ini).'),",
            "        cfg.StrOpt('public_bind_host',",
            "                   default='0.0.0.0',",
            "                   deprecated_opts=[cfg.DeprecatedOpt('bind_host',",
            "                                                      group='DEFAULT')],",
            "                   help='The IP address of the network interface for the '",
            "                        'public service to listen on.'),",
            "        cfg.StrOpt('admin_bind_host',",
            "                   default='0.0.0.0',",
            "                   deprecated_opts=[cfg.DeprecatedOpt('bind_host',",
            "                                                      group='DEFAULT')],",
            "                   help='The IP address of the network interface for the '",
            "                        'admin service to listen on.'),",
            "        cfg.IntOpt('compute_port', default=8774,",
            "                   help='(Deprecated) The port which the OpenStack Compute '",
            "                        'service listens on. This option was only used for '",
            "                        'string replacement in the templated catalog backend. '",
            "                        'Templated catalogs should replace the '",
            "                        '\"$(compute_port)s\" substitution with the static port '",
            "                        'of the compute service. As of Juno, this option is '",
            "                        'deprecated and will be removed in the L release.'),",
            "        cfg.IntOpt('admin_port', default=35357,",
            "                   help='The port number which the admin service listens '",
            "                        'on.'),",
            "        cfg.IntOpt('public_port', default=5000,",
            "                   help='The port number which the public service listens '",
            "                        'on.'),",
            "        cfg.StrOpt('public_endpoint',",
            "                   help='The base public endpoint URL for Keystone that is '",
            "                        'advertised to clients (NOTE: this does NOT affect '",
            "                        'how Keystone listens for connections). '",
            "                        'Defaults to the base host URL of the request. E.g. a '",
            "                        'request to http://server:5000/v2.0/users will '",
            "                        'default to http://server:5000. You should only need '",
            "                        'to set this value if the base URL contains a path '",
            "                        '(e.g. /prefix/v2.0) or the endpoint should be found '",
            "                        'on a different server.'),",
            "        cfg.StrOpt('admin_endpoint',",
            "                   help='The base admin endpoint URL for Keystone that is '",
            "                        'advertised to clients (NOTE: this does NOT affect '",
            "                        'how Keystone listens for connections). '",
            "                        'Defaults to the base host URL of the request. E.g. a '",
            "                        'request to http://server:35357/v2.0/users will '",
            "                        'default to http://server:35357. You should only need '",
            "                        'to set this value if the base URL contains a path '",
            "                        '(e.g. /prefix/v2.0) or the endpoint should be found '",
            "                        'on a different server.'),",
            "        cfg.IntOpt('public_workers', default=1,",
            "                   help='The number of worker processes to serve the public '",
            "                        'WSGI application'),",
            "        cfg.IntOpt('admin_workers', default=1,",
            "                   help='The number of worker processes to serve the admin '",
            "                        'WSGI application'),",
            "        # default max request size is 112k",
            "        cfg.IntOpt('max_request_body_size', default=114688,",
            "                   help='Enforced by optional sizelimit middleware '",
            "                        '(keystone.middleware:RequestBodySizeLimiter).'),",
            "        cfg.IntOpt('max_param_size', default=64,",
            "                   help='Limit the sizes of user & project ID/names.'),",
            "        # we allow tokens to be a bit larger to accommodate PKI",
            "        cfg.IntOpt('max_token_size', default=8192,",
            "                   help='Similar to max_param_size, but provides an '",
            "                        'exception for token values.'),",
            "        cfg.StrOpt('member_role_id',",
            "                   default='9fe2ff9ee4384b1894a90878d3e92bab',",
            "                   help='During a SQL upgrade member_role_id will be used '",
            "                        'to create a new role that will replace records in '",
            "                        'the assignment table with explicit role grants. '",
            "                        'After migration, the member_role_id will be used in '",
            "                        'the API add_user_to_project.'),",
            "        cfg.StrOpt('member_role_name', default='_member_',",
            "                   help='During a SQL upgrade member_role_name will be used '",
            "                        'to create a new role that will replace records in '",
            "                        'the assignment table with explicit role grants. '",
            "                        'After migration, member_role_name will be ignored.'),",
            "        cfg.IntOpt('crypt_strength', default=40000,",
            "                   help='The value passed as the keyword \"rounds\" to '",
            "                        'passlib\\'s encrypt method.'),",
            "        cfg.BoolOpt('tcp_keepalive', default=False,",
            "                    help='Set this to true if you want to enable '",
            "                         'TCP_KEEPALIVE on server sockets, i.e. sockets used '",
            "                         'by the Keystone wsgi server for client '",
            "                         'connections.'),",
            "        cfg.IntOpt('tcp_keepidle',",
            "                   default=600,",
            "                   help='Sets the value of TCP_KEEPIDLE in seconds for each '",
            "                        'server socket. Only applies if tcp_keepalive is '",
            "                        'true. Not supported on OS X.'),",
            "        cfg.IntOpt('list_limit',",
            "                   help='The maximum number of entities that will be '",
            "                        'returned in a collection, with no limit set by '",
            "                        'default. This global limit may be then overridden '",
            "                        'for a specific driver, by specifying a list_limit '",
            "                        'in the appropriate section (e.g. [assignment]).'),",
            "        cfg.BoolOpt('domain_id_immutable', default=True,",
            "                    help='Set this to false if you want to enable the '",
            "                         'ability for user, group and project entities '",
            "                         'to be moved between domains by updating their '",
            "                         'domain_id. Allowing such movement is not '",
            "                         'recommended if the scope of a domain admin is being '",
            "                         'restricted by use of an appropriate policy file '",
            "                         '(see policy.v3cloudsample as an example).'),",
            "        cfg.BoolOpt('strict_password_check', default=False,",
            "                    help='If set to true, strict password length checking is '",
            "                         'performed for password manipulation. If a password '",
            "                         'exceeds the maximum length, the operation will fail '",
            "                         'with an HTTP 403 Forbidden error. If set to false, '",
            "                         'passwords are automatically truncated to the '",
            "                         'maximum length.')],",
            "    'identity': [",
            "        cfg.StrOpt('default_domain_id', default='default',",
            "                   help='This references the domain to use for all '",
            "                        'Identity API v2 requests (which are not aware of '",
            "                        'domains). A domain with this ID will be created '",
            "                        'for you by keystone-manage db_sync in migration '",
            "                        '008. The domain referenced by this ID cannot be '",
            "                        'deleted on the v3 API, to prevent accidentally '",
            "                        'breaking the v2 API. There is nothing special about '",
            "                        'this domain, other than the fact that it must '",
            "                        'exist to order to maintain support for your v2 '",
            "                        'clients.'),",
            "        cfg.BoolOpt('domain_specific_drivers_enabled',",
            "                    default=False,",
            "                    help='A subset (or all) of domains can have their own '",
            "                         'identity driver, each with their own partial '",
            "                         'configuration file in a domain configuration '",
            "                         'directory. Only values specific to the domain '",
            "                         'need to be placed in the domain specific '",
            "                         'configuration file. This feature is disabled by '",
            "                         'default; set to true to enable.'),",
            "        cfg.StrOpt('domain_config_dir',",
            "                   default='/etc/keystone/domains',",
            "                   help='Path for Keystone to locate the domain specific '",
            "                        'identity configuration files if '",
            "                        'domain_specific_drivers_enabled is set to true.'),",
            "        cfg.StrOpt('driver',",
            "                   default=('keystone.identity.backends'",
            "                            '.sql.Identity'),",
            "                   help='Identity backend driver.'),",
            "        cfg.IntOpt('max_password_length', default=4096,",
            "                   help='Maximum supported length for user passwords; '",
            "                        'decrease to improve performance.'),",
            "        cfg.IntOpt('list_limit',",
            "                   help='Maximum number of entities that will be returned in '",
            "                        'an identity collection.'),",
            "    ],",
            "    'identity_mapping': [",
            "        cfg.StrOpt('driver',",
            "                   default=('keystone.identity.mapping_backends'",
            "                            '.sql.Mapping'),",
            "                   help='Keystone Identity Mapping backend driver.'),",
            "        cfg.StrOpt('generator',",
            "                   default=('keystone.identity.id_generators'",
            "                            '.sha256.Generator'),",
            "                   help='Public ID generator for user and group entities. '",
            "                        'The Keystone identity mapper only supports '",
            "                        'generators that produce no more than 64 characters.'),",
            "        cfg.BoolOpt('backward_compatible_ids',",
            "                    default=True,",
            "                    help='The format of user and group IDs changed '",
            "                         'in Juno for backends that do not generate UUIDs '",
            "                         '(e.g. LDAP), with keystone providing a hash mapping '",
            "                         'to the underlying attribute in LDAP. By default '",
            "                         'this mapping is disabled, which ensures that '",
            "                         'existing IDs will not change. Even when the '",
            "                         'mapping is enabled by using domain specific '",
            "                         'drivers, any users and groups from the default '",
            "                         'domain being handled by LDAP will still not be '",
            "                         'mapped to ensure their IDs remain backward '",
            "                         'compatible. Setting this value to False will '",
            "                         'enable the mapping for even the default LDAP '",
            "                         'driver. It is only safe to do this if you do not '",
            "                         'already have assignments for users and '",
            "                         'groups from the default LDAP domain, and it is '",
            "                         'acceptable for Keystone to provide the different '",
            "                         'IDs to clients than it did previously.  Typically '",
            "                         'this means that the only time you can set this '",
            "                         'value to False is when configuring a fresh '",
            "                         'installation.'),",
            "    ],",
            "    'trust': [",
            "        cfg.BoolOpt('enabled', default=True,",
            "                    help='Delegation and impersonation features can be '",
            "                         'optionally disabled.'),",
            "        cfg.StrOpt('driver',",
            "                   default='keystone.trust.backends.sql.Trust',",
            "                   help='Trust backend driver.')],",
            "    'os_inherit': [",
            "        cfg.BoolOpt('enabled', default=False,",
            "                    help='role-assignment inheritance to projects from '",
            "                         'owning domain can be optionally enabled.'),",
            "    ],",
            "    'token': [",
            "        cfg.ListOpt('bind', default=[],",
            "                    help='External auth mechanisms that should add bind '",
            "                         'information to token, e.g., kerberos,x509.'),",
            "        cfg.StrOpt('enforce_token_bind', default='permissive',",
            "                   help='Enforcement policy on tokens presented to Keystone '",
            "                        'with bind information. One of disabled, permissive, '",
            "                        'strict, required or a specifically required bind '",
            "                        'mode, e.g., kerberos or x509 to require binding to '",
            "                        'that authentication.'),",
            "        cfg.IntOpt('expiration', default=3600,",
            "                   help='Amount of time a token should remain valid '",
            "                        '(in seconds).'),",
            "        cfg.StrOpt('provider',",
            "                   help='Controls the token construction, validation, and '",
            "                        'revocation operations. Core providers are '",
            "                        '\"keystone.token.providers.[pkiz|pki|uuid].'",
            "                        'Provider\". The default provider is uuid.'),",
            "        cfg.StrOpt('driver',",
            "                   default='keystone.token.persistence.backends.sql.Token',",
            "                   help='Token persistence backend driver.'),",
            "        cfg.BoolOpt('caching', default=True,",
            "                    help='Toggle for token system caching. This has no '",
            "                         'effect unless global caching is enabled.'),",
            "        cfg.IntOpt('revocation_cache_time', default=3600,",
            "                   help='Time to cache the revocation list and the revocation '",
            "                        'events if revoke extension is enabled (in seconds). '",
            "                        'This has no effect unless global and token '",
            "                        'caching are enabled.'),",
            "        cfg.IntOpt('cache_time',",
            "                   help='Time to cache tokens (in seconds). This has no '",
            "                        'effect unless global and token caching are '",
            "                        'enabled.'),",
            "        cfg.BoolOpt('revoke_by_id', default=True,",
            "                    help='Revoke token by token identifier. Setting '",
            "                    'revoke_by_id to true enables various forms of '",
            "                    'enumerating tokens, e.g. `list tokens for user`. '",
            "                    'These enumerations are processed to determine the '",
            "                    'list of tokens to revoke. Only disable if you are '",
            "                    'switching to using the Revoke extension with a '",
            "                    'backend other than KVS, which stores events in memory.'),",
            "        cfg.StrOpt('hash_algorithm', default='md5',",
            "                   help=\"The hash algorithm to use for PKI tokens. This can \"",
            "                        \"be set to any algorithm that hashlib supports. \"",
            "                        \"WARNING: Before changing this value, the auth_token \"",
            "                        \"middleware must be configured with the \"",
            "                        \"hash_algorithms, otherwise token revocation will \"",
            "                        \"not be processed correctly.\"),",
            "    ],",
            "    'revoke': [",
            "        cfg.StrOpt('driver',",
            "                   default='keystone.contrib.revoke.backends.kvs.Revoke',",
            "                   help='An implementation of the backend for persisting '",
            "                        'revocation events.'),",
            "        cfg.IntOpt('expiration_buffer', default=1800,",
            "                   help='This value (calculated in seconds) is added to token '",
            "                        'expiration before a revocation event may be removed '",
            "                        'from the backend.'),",
            "        cfg.BoolOpt('caching', default=True,",
            "                    help='Toggle for revocation event caching. This has no '",
            "                         'effect unless global caching is enabled.'),",
            "    ],",
            "    'cache': [",
            "        cfg.StrOpt('config_prefix', default='cache.keystone',",
            "                   help='Prefix for building the configuration dictionary '",
            "                        'for the cache region. This should not need to be '",
            "                        'changed unless there is another dogpile.cache '",
            "                        'region with the same configuration name.'),",
            "        cfg.IntOpt('expiration_time', default=600,",
            "                   help='Default TTL, in seconds, for any cached item in '",
            "                        'the dogpile.cache region. This applies to any '",
            "                        'cached method that doesn\\'t have an explicit '",
            "                        'cache expiration time defined for it.'),",
            "        # NOTE(morganfainberg): the dogpile.cache.memory acceptable in devstack",
            "        # and other such single-process/thread deployments. Running",
            "        # dogpile.cache.memory in any other configuration has the same pitfalls",
            "        # as the KVS token backend. It is recommended that either Redis or",
            "        # Memcached are used as the dogpile backend for real workloads. To",
            "        # prevent issues with the memory cache ending up in \"production\"",
            "        # unintentionally, we register a no-op as the keystone default caching",
            "        # backend.",
            "        cfg.StrOpt('backend', default='keystone.common.cache.noop',",
            "                   help='Dogpile.cache backend module. It is recommended '",
            "                        'that Memcache (dogpile.cache.memcached) or Redis '",
            "                        '(dogpile.cache.redis) be used in production '",
            "                        'deployments.  Small workloads (single process) '",
            "                        'like devstack can use the dogpile.cache.memory '",
            "                        'backend.'),",
            "        cfg.MultiStrOpt('backend_argument', default=[],",
            "                        help='Arguments supplied to the backend module. '",
            "                             'Specify this option once per argument to be '",
            "                             'passed to the dogpile.cache backend. Example '",
            "                             'format: \"<argname>:<value>\".'),",
            "        cfg.ListOpt('proxies', default=[],",
            "                    help='Proxy classes to import that will affect the way '",
            "                         'the dogpile.cache backend functions. See the '",
            "                         'dogpile.cache documentation on '",
            "                         'changing-backend-behavior.'),",
            "        cfg.BoolOpt('enabled', default=False,",
            "                    help='Global toggle for all caching using the '",
            "                         'should_cache_fn mechanism.'),",
            "        cfg.BoolOpt('debug_cache_backend', default=False,",
            "                    help='Extra debugging from the cache backend (cache '",
            "                         'keys, get/set/delete/etc calls). This is only '",
            "                         'really useful if you need to see the specific '",
            "                         'cache-backend get/set/delete calls with the '",
            "                         'keys/values.  Typically this should be left set '",
            "                         'to false.'),",
            "    ],",
            "    'ssl': [",
            "        cfg.BoolOpt('enable', default=False,",
            "                    help='Toggle for SSL support on the Keystone '",
            "                         'eventlet servers.'),",
            "        cfg.StrOpt('certfile',",
            "                   default=\"/etc/keystone/ssl/certs/keystone.pem\",",
            "                   help='Path of the certfile for SSL. For non-production '",
            "                        'environments, you may be interested in using '",
            "                        '`keystone-manage ssl_setup` to generate self-signed '",
            "                        'certificates.'),",
            "        cfg.StrOpt('keyfile',",
            "                   default='/etc/keystone/ssl/private/keystonekey.pem',",
            "                   help='Path of the keyfile for SSL.'),",
            "        cfg.StrOpt('ca_certs',",
            "                   default='/etc/keystone/ssl/certs/ca.pem',",
            "                   help='Path of the ca cert file for SSL.'),",
            "        cfg.StrOpt('ca_key',",
            "                   default='/etc/keystone/ssl/private/cakey.pem',",
            "                   help='Path of the CA key file for SSL.'),",
            "        cfg.BoolOpt('cert_required', default=False,",
            "                    help='Require client certificate.'),",
            "        cfg.IntOpt('key_size', default=1024,",
            "                   help='SSL key length (in bits) (auto generated '",
            "                        'certificate).'),",
            "        cfg.IntOpt('valid_days', default=3650,",
            "                   help='Days the certificate is valid for once signed '",
            "                        '(auto generated certificate).'),",
            "        cfg.StrOpt('cert_subject',",
            "                   default='/C=US/ST=Unset/L=Unset/O=Unset/CN=localhost',",
            "                   help='SSL certificate subject (auto generated '",
            "                        'certificate).'),",
            "    ],",
            "    'signing': [",
            "        cfg.StrOpt('token_format',",
            "                   help='Deprecated in favor of provider in the '",
            "                        '[token] section.'),",
            "        cfg.StrOpt('certfile',",
            "                   default=_CERTFILE,",
            "                   help='Path of the certfile for token signing. For '",
            "                        'non-production environments, you may be interested '",
            "                        'in using `keystone-manage pki_setup` to generate '",
            "                        'self-signed certificates.'),",
            "        cfg.StrOpt('keyfile',",
            "                   default=_KEYFILE,",
            "                   help='Path of the keyfile for token signing.'),",
            "        cfg.StrOpt('ca_certs',",
            "                   default='/etc/keystone/ssl/certs/ca.pem',",
            "                   help='Path of the CA for token signing.'),",
            "        cfg.StrOpt('ca_key',",
            "                   default='/etc/keystone/ssl/private/cakey.pem',",
            "                   help='Path of the CA key for token signing.'),",
            "        cfg.IntOpt('key_size', default=2048,",
            "                   help='Key size (in bits) for token signing cert '",
            "                        '(auto generated certificate).'),",
            "        cfg.IntOpt('valid_days', default=3650,",
            "                   help='Days the token signing cert is valid for '",
            "                        '(auto generated certificate).'),",
            "        cfg.StrOpt('cert_subject',",
            "                   default=('/C=US/ST=Unset/L=Unset/O=Unset/'",
            "                            'CN=www.example.com'),",
            "                   help='Certificate subject (auto generated certificate) for '",
            "                        'token signing.'),",
            "    ],",
            "    'assignment': [",
            "        # assignment has no default for backward compatibility reasons.",
            "        # If assignment driver is not specified, the identity driver chooses",
            "        # the backend",
            "        cfg.StrOpt('driver',",
            "                   help='Assignment backend driver.'),",
            "        cfg.BoolOpt('caching', default=True,",
            "                    help='Toggle for assignment caching. This has no effect '",
            "                         'unless global caching is enabled.'),",
            "        cfg.IntOpt('cache_time',",
            "                   help='TTL (in seconds) to cache assignment data. This has '",
            "                        'no effect unless global caching is enabled.'),",
            "        cfg.IntOpt('list_limit',",
            "                   help='Maximum number of entities that will be returned '",
            "                        'in an assignment collection.'),",
            "    ],",
            "    'credential': [",
            "        cfg.StrOpt('driver',",
            "                   default=('keystone.credential.backends'",
            "                            '.sql.Credential'),",
            "                   help='Credential backend driver.'),",
            "    ],",
            "    'oauth1': [",
            "        cfg.StrOpt('driver',",
            "                   default='keystone.contrib.oauth1.backends.sql.OAuth1',",
            "                   help='Credential backend driver.'),",
            "        cfg.IntOpt('request_token_duration', default=28800,",
            "                   help='Duration (in seconds) for the OAuth Request Token.'),",
            "        cfg.IntOpt('access_token_duration', default=86400,",
            "                   help='Duration (in seconds) for the OAuth Access Token.'),",
            "    ],",
            "    'federation': [",
            "        cfg.StrOpt('driver',",
            "                   default='keystone.contrib.federation.'",
            "                           'backends.sql.Federation',",
            "                   help='Federation backend driver.'),",
            "        cfg.StrOpt('assertion_prefix', default='',",
            "                   help='Value to be used when filtering assertion parameters '",
            "                        'from the environment.'),",
            "    ],",
            "    'policy': [",
            "        cfg.StrOpt('driver',",
            "                   default='keystone.policy.backends.sql.Policy',",
            "                   help='Policy backend driver.'),",
            "        cfg.IntOpt('list_limit',",
            "                   help='Maximum number of entities that will be returned '",
            "                        'in a policy collection.'),",
            "    ],",
            "    'ec2': [",
            "        cfg.StrOpt('driver',",
            "                   default='keystone.contrib.ec2.backends.kvs.Ec2',",
            "                   help='EC2Credential backend driver.'),",
            "    ],",
            "    'endpoint_filter': [",
            "        cfg.StrOpt('driver',",
            "                   default='keystone.contrib.endpoint_filter.backends'",
            "                           '.sql.EndpointFilter',",
            "                   help='Endpoint Filter backend driver'),",
            "        cfg.BoolOpt('return_all_endpoints_if_no_filter', default=True,",
            "                    help='Toggle to return all active endpoints if no filter '",
            "                         'exists.'),",
            "    ],",
            "    'endpoint_policy': [",
            "        cfg.StrOpt('driver',",
            "                   default='keystone.contrib.endpoint_policy.backends'",
            "                           '.sql.EndpointPolicy',",
            "                   help='Endpoint policy backend driver'),",
            "    ],",
            "    'stats': [",
            "        cfg.StrOpt('driver',",
            "                   default=('keystone.contrib.stats.backends'",
            "                            '.kvs.Stats'),",
            "                   help='Stats backend driver.'),",
            "    ],",
            "    'ldap': [",
            "        cfg.StrOpt('url', default='ldap://localhost',",
            "                   help='URL for connecting to the LDAP server.'),",
            "        cfg.StrOpt('user',",
            "                   help='User BindDN to query the LDAP server.'),",
            "        cfg.StrOpt('password', secret=True,",
            "                   help='Password for the BindDN to query the LDAP server.'),",
            "        cfg.StrOpt('suffix', default='cn=example,cn=com',",
            "                   help='LDAP server suffix'),",
            "        cfg.BoolOpt('use_dumb_member', default=False,",
            "                    help='If true, will add a dummy member to groups. This is '",
            "                         'required if the objectclass for groups requires the '",
            "                         '\"member\" attribute.'),",
            "        cfg.StrOpt('dumb_member', default='cn=dumb,dc=nonexistent',",
            "                   help='DN of the \"dummy member\" to use when '",
            "                        '\"use_dumb_member\" is enabled.'),",
            "        cfg.BoolOpt('allow_subtree_delete', default=False,",
            "                    help='Delete subtrees using the subtree delete control. '",
            "                         'Only enable this option if your LDAP server '",
            "                         'supports subtree deletion.'),",
            "        cfg.StrOpt('query_scope', default='one',",
            "                   help='The LDAP scope for queries, this can be either '",
            "                        '\"one\" (onelevel/singleLevel) or \"sub\" '",
            "                        '(subtree/wholeSubtree).'),",
            "        cfg.IntOpt('page_size', default=0,",
            "                   help='Maximum results per page; a value of zero (\"0\") '",
            "                        'disables paging.'),",
            "        cfg.StrOpt('alias_dereferencing', default='default',",
            "                   help='The LDAP dereferencing option for queries. This '",
            "                        'can be either \"never\", \"searching\", \"always\", '",
            "                        '\"finding\" or \"default\". The \"default\" option falls '",
            "                        'back to using default dereferencing configured by '",
            "                        'your ldap.conf.'),",
            "        cfg.IntOpt('debug_level',",
            "                   help='Sets the LDAP debugging level for LDAP calls. '",
            "                        'A value of 0 means that debugging is not enabled. '",
            "                        'This value is a bitmask, consult your LDAP '",
            "                        'documentation for possible values.'),",
            "        cfg.BoolOpt('chase_referrals',",
            "                    help='Override the system\\'s default referral chasing '",
            "                         'behavior for queries.'),",
            "        cfg.StrOpt('user_tree_dn',",
            "                   help='Search base for users.'),",
            "        cfg.StrOpt('user_filter',",
            "                   help='LDAP search filter for users.'),",
            "        cfg.StrOpt('user_objectclass', default='inetOrgPerson',",
            "                   help='LDAP objectclass for users.'),",
            "        cfg.StrOpt('user_id_attribute', default='cn',",
            "                   help='LDAP attribute mapped to user id. '",
            "                        'WARNING: must not be a multivalued attribute.'),",
            "        cfg.StrOpt('user_name_attribute', default='sn',",
            "                   help='LDAP attribute mapped to user name.'),",
            "        cfg.StrOpt('user_mail_attribute', default='mail',",
            "                   help='LDAP attribute mapped to user email.'),",
            "        cfg.StrOpt('user_pass_attribute', default='userPassword',",
            "                   help='LDAP attribute mapped to password.'),",
            "        cfg.StrOpt('user_enabled_attribute', default='enabled',",
            "                   help='LDAP attribute mapped to user enabled flag.'),",
            "        cfg.BoolOpt('user_enabled_invert', default=False,",
            "                    help='Invert the meaning of the boolean enabled values. '",
            "                         'Some LDAP servers use a boolean lock attribute '",
            "                         'where \"true\" means an account is disabled. Setting '",
            "                         '\"user_enabled_invert = true\" will allow these lock '",
            "                         'attributes to be used. This setting will have no '",
            "                         'effect if \"user_enabled_mask\" or '",
            "                         '\"user_enabled_emulation\" settings are in use.'),",
            "        cfg.IntOpt('user_enabled_mask', default=0,",
            "                   help='Bitmask integer to indicate the bit that the enabled '",
            "                        'value is stored in if the LDAP server represents '",
            "                        '\"enabled\" as a bit on an integer rather than a '",
            "                        'boolean. A value of \"0\" indicates the mask is not '",
            "                        'used. If this is not set to \"0\" the typical value '",
            "                        'is \"2\". This is typically used when '",
            "                        '\"user_enabled_attribute = userAccountControl\".'),",
            "        cfg.StrOpt('user_enabled_default', default='True',",
            "                   help='Default value to enable users. This should match an '",
            "                        'appropriate int value if the LDAP server uses '",
            "                        'non-boolean (bitmask) values to indicate if a user '",
            "                        'is enabled or disabled. If this is not set to \"True\" '",
            "                        'the typical value is \"512\". This is typically used '",
            "                        'when \"user_enabled_attribute = userAccountControl\".'),",
            "        cfg.ListOpt('user_attribute_ignore',",
            "                    default=['default_project_id', 'tenants'],",
            "                    help='List of attributes stripped off the user on '",
            "                         'update.'),",
            "        cfg.StrOpt('user_default_project_id_attribute',",
            "                   help='LDAP attribute mapped to default_project_id for '",
            "                        'users.'),",
            "        cfg.BoolOpt('user_allow_create', default=True,",
            "                    help='Allow user creation in LDAP backend.'),",
            "        cfg.BoolOpt('user_allow_update', default=True,",
            "                    help='Allow user updates in LDAP backend.'),",
            "        cfg.BoolOpt('user_allow_delete', default=True,",
            "                    help='Allow user deletion in LDAP backend.'),",
            "        cfg.BoolOpt('user_enabled_emulation', default=False,",
            "                    help='If true, Keystone uses an alternative method to '",
            "                         'determine if a user is enabled or not by checking '",
            "                         'if they are a member of the '",
            "                         '\"user_enabled_emulation_dn\" group.'),",
            "        cfg.StrOpt('user_enabled_emulation_dn',",
            "                   help='DN of the group entry to hold enabled users when '",
            "                        'using enabled emulation.'),",
            "        cfg.ListOpt('user_additional_attribute_mapping',",
            "                    default=[],",
            "                    help='List of additional LDAP attributes used for mapping '",
            "                         'additional attribute mappings for users. Attribute '",
            "                         'mapping format is <ldap_attr>:<user_attr>, where '",
            "                         'ldap_attr is the attribute in the LDAP entry and '",
            "                         'user_attr is the Identity API attribute.'),",
            "",
            "        cfg.StrOpt('project_tree_dn',",
            "                   deprecated_opts=[cfg.DeprecatedOpt(",
            "                       'tenant_tree_dn', group='ldap')],",
            "                   help='Search base for projects'),",
            "        cfg.StrOpt('project_filter',",
            "                   deprecated_opts=[cfg.DeprecatedOpt(",
            "                       'tenant_filter', group='ldap')],",
            "                   help='LDAP search filter for projects.'),",
            "        cfg.StrOpt('project_objectclass', default='groupOfNames',",
            "                   deprecated_opts=[cfg.DeprecatedOpt(",
            "                       'tenant_objectclass', group='ldap')],",
            "                   help='LDAP objectclass for projects.'),",
            "        cfg.StrOpt('project_id_attribute', default='cn',",
            "                   deprecated_opts=[cfg.DeprecatedOpt(",
            "                       'tenant_id_attribute', group='ldap')],",
            "                   help='LDAP attribute mapped to project id.'),",
            "        cfg.StrOpt('project_member_attribute', default='member',",
            "                   deprecated_opts=[cfg.DeprecatedOpt(",
            "                       'tenant_member_attribute', group='ldap')],",
            "                   help='LDAP attribute mapped to project membership for '",
            "                        'user.'),",
            "        cfg.StrOpt('project_name_attribute', default='ou',",
            "                   deprecated_opts=[cfg.DeprecatedOpt(",
            "                       'tenant_name_attribute', group='ldap')],",
            "                   help='LDAP attribute mapped to project name.'),",
            "        cfg.StrOpt('project_desc_attribute', default='description',",
            "                   deprecated_opts=[cfg.DeprecatedOpt(",
            "                       'tenant_desc_attribute', group='ldap')],",
            "                   help='LDAP attribute mapped to project description.'),",
            "        cfg.StrOpt('project_enabled_attribute', default='enabled',",
            "                   deprecated_opts=[cfg.DeprecatedOpt(",
            "                       'tenant_enabled_attribute', group='ldap')],",
            "                   help='LDAP attribute mapped to project enabled.'),",
            "        cfg.StrOpt('project_domain_id_attribute',",
            "                   deprecated_opts=[cfg.DeprecatedOpt(",
            "                       'tenant_domain_id_attribute', group='ldap')],",
            "                   default='businessCategory',",
            "                   help='LDAP attribute mapped to project domain_id.'),",
            "        cfg.ListOpt('project_attribute_ignore', default=[],",
            "                    deprecated_opts=[cfg.DeprecatedOpt(",
            "                        'tenant_attribute_ignore', group='ldap')],",
            "                    help='List of attributes stripped off the project on '",
            "                         'update.'),",
            "        cfg.BoolOpt('project_allow_create', default=True,",
            "                    deprecated_opts=[cfg.DeprecatedOpt(",
            "                        'tenant_allow_create', group='ldap')],",
            "                    help='Allow project creation in LDAP backend.'),",
            "        cfg.BoolOpt('project_allow_update', default=True,",
            "                    deprecated_opts=[cfg.DeprecatedOpt(",
            "                        'tenant_allow_update', group='ldap')],",
            "                    help='Allow project update in LDAP backend.'),",
            "        cfg.BoolOpt('project_allow_delete', default=True,",
            "                    deprecated_opts=[cfg.DeprecatedOpt(",
            "                        'tenant_allow_delete', group='ldap')],",
            "                    help='Allow project deletion in LDAP backend.'),",
            "        cfg.BoolOpt('project_enabled_emulation', default=False,",
            "                    deprecated_opts=[cfg.DeprecatedOpt(",
            "                        'tenant_enabled_emulation', group='ldap')],",
            "                    help='If true, Keystone uses an alternative method to '",
            "                         'determine if a project is enabled or not by '",
            "                         'checking if they are a member of the '",
            "                         '\"project_enabled_emulation_dn\" group.'),",
            "        cfg.StrOpt('project_enabled_emulation_dn',",
            "                   deprecated_opts=[cfg.DeprecatedOpt(",
            "                       'tenant_enabled_emulation_dn', group='ldap')],",
            "                   help='DN of the group entry to hold enabled projects when '",
            "                        'using enabled emulation.'),",
            "        cfg.ListOpt('project_additional_attribute_mapping',",
            "                    deprecated_opts=[cfg.DeprecatedOpt(",
            "                        'tenant_additional_attribute_mapping', group='ldap')],",
            "                    default=[],",
            "                    help='Additional attribute mappings for projects. '",
            "                         'Attribute mapping format is '",
            "                         '<ldap_attr>:<user_attr>, where ldap_attr is the '",
            "                         'attribute in the LDAP entry and user_attr is the '",
            "                         'Identity API attribute.'),",
            "",
            "        cfg.StrOpt('role_tree_dn',",
            "                   help='Search base for roles.'),",
            "        cfg.StrOpt('role_filter',",
            "                   help='LDAP search filter for roles.'),",
            "        cfg.StrOpt('role_objectclass', default='organizationalRole',",
            "                   help='LDAP objectclass for roles.'),",
            "        cfg.StrOpt('role_id_attribute', default='cn',",
            "                   help='LDAP attribute mapped to role id.'),",
            "        cfg.StrOpt('role_name_attribute', default='ou',",
            "                   help='LDAP attribute mapped to role name.'),",
            "        cfg.StrOpt('role_member_attribute', default='roleOccupant',",
            "                   help='LDAP attribute mapped to role membership.'),",
            "        cfg.ListOpt('role_attribute_ignore', default=[],",
            "                    help='List of attributes stripped off the role on '",
            "                         'update.'),",
            "        cfg.BoolOpt('role_allow_create', default=True,",
            "                    help='Allow role creation in LDAP backend.'),",
            "        cfg.BoolOpt('role_allow_update', default=True,",
            "                    help='Allow role update in LDAP backend.'),",
            "        cfg.BoolOpt('role_allow_delete', default=True,",
            "                    help='Allow role deletion in LDAP backend.'),",
            "        cfg.ListOpt('role_additional_attribute_mapping',",
            "                    default=[],",
            "                    help='Additional attribute mappings for roles. Attribute '",
            "                         'mapping format is <ldap_attr>:<user_attr>, where '",
            "                         'ldap_attr is the attribute in the LDAP entry and '",
            "                         'user_attr is the Identity API attribute.'),",
            "",
            "        cfg.StrOpt('group_tree_dn',",
            "                   help='Search base for groups.'),",
            "        cfg.StrOpt('group_filter',",
            "                   help='LDAP search filter for groups.'),",
            "        cfg.StrOpt('group_objectclass', default='groupOfNames',",
            "                   help='LDAP objectclass for groups.'),",
            "        cfg.StrOpt('group_id_attribute', default='cn',",
            "                   help='LDAP attribute mapped to group id.'),",
            "        cfg.StrOpt('group_name_attribute', default='ou',",
            "                   help='LDAP attribute mapped to group name.'),",
            "        cfg.StrOpt('group_member_attribute', default='member',",
            "                   help='LDAP attribute mapped to show group membership.'),",
            "        cfg.StrOpt('group_desc_attribute', default='description',",
            "                   help='LDAP attribute mapped to group description.'),",
            "        cfg.ListOpt('group_attribute_ignore', default=[],",
            "                    help='List of attributes stripped off the group on '",
            "                         'update.'),",
            "        cfg.BoolOpt('group_allow_create', default=True,",
            "                    help='Allow group creation in LDAP backend.'),",
            "        cfg.BoolOpt('group_allow_update', default=True,",
            "                    help='Allow group update in LDAP backend.'),",
            "        cfg.BoolOpt('group_allow_delete', default=True,",
            "                    help='Allow group deletion in LDAP backend.'),",
            "        cfg.ListOpt('group_additional_attribute_mapping',",
            "                    default=[],",
            "                    help='Additional attribute mappings for groups. Attribute '",
            "                         'mapping format is <ldap_attr>:<user_attr>, where '",
            "                         'ldap_attr is the attribute in the LDAP entry and '",
            "                         'user_attr is the Identity API attribute.'),",
            "",
            "        cfg.StrOpt('tls_cacertfile',",
            "                   help='CA certificate file path for communicating with '",
            "                        'LDAP servers.'),",
            "        cfg.StrOpt('tls_cacertdir',",
            "                   help='CA certificate directory path for communicating with '",
            "                        'LDAP servers.'),",
            "        cfg.BoolOpt('use_tls', default=False,",
            "                    help='Enable TLS for communicating with LDAP servers.'),",
            "        cfg.StrOpt('tls_req_cert', default='demand',",
            "                   help='Valid options for tls_req_cert are demand, never, '",
            "                        'and allow.'),",
            "        cfg.BoolOpt('use_pool', default=False,",
            "                    help='Enable LDAP connection pooling.'),",
            "        cfg.IntOpt('pool_size', default=10,",
            "                   help='Connection pool size.'),",
            "        cfg.IntOpt('pool_retry_max', default=3,",
            "                   help='Maximum count of reconnect trials.'),",
            "        cfg.FloatOpt('pool_retry_delay', default=0.1,",
            "                     help='Time span in seconds to wait between two '",
            "                          'reconnect trials.'),",
            "        cfg.IntOpt('pool_connection_timeout', default=-1,",
            "                   help='Connector timeout in seconds. Value -1 indicates '",
            "                        'indefinite wait for response.'),",
            "        cfg.IntOpt('pool_connection_lifetime', default=600,",
            "                   help='Connection lifetime in seconds.'),",
            "        cfg.BoolOpt('use_auth_pool', default=False,",
            "                    help='Enable LDAP connection pooling for end user '",
            "                         'authentication. If use_pool is disabled, then this '",
            "                         'setting is meaningless and is not used at all.'),",
            "        cfg.IntOpt('auth_pool_size', default=100,",
            "                   help='End user auth connection pool size.'),",
            "        cfg.IntOpt('auth_pool_connection_lifetime', default=60,",
            "                   help='End user auth connection lifetime in seconds.'),",
            "    ],",
            "    'auth': [",
            "        cfg.ListOpt('methods', default=_DEFAULT_AUTH_METHODS,",
            "                    help='Default auth methods.'),",
            "        cfg.StrOpt('password',",
            "                   default='keystone.auth.plugins.password.Password',",
            "                   help='The password auth plugin module.'),",
            "        cfg.StrOpt('token',",
            "                   default='keystone.auth.plugins.token.Token',",
            "                   help='The token auth plugin module.'),",
            "        # deals with REMOTE_USER authentication",
            "        cfg.StrOpt('external',",
            "                   default='keystone.auth.plugins.external.DefaultDomain',",
            "                   help='The external (REMOTE_USER) auth plugin module.'),",
            "    ],",
            "    'paste_deploy': [",
            "        cfg.StrOpt('config_file', default='keystone-paste.ini',",
            "                   help='Name of the paste configuration file that defines '",
            "                        'the available pipelines.'),",
            "    ],",
            "    'memcache': [",
            "        cfg.ListOpt('servers', default=['localhost:11211'],",
            "                    help='Memcache servers in the format of \"host:port\".'),",
            "        cfg.IntOpt('max_compare_and_set_retry', default=16,",
            "                   help='Number of compare-and-set attempts to make when '",
            "                        'using compare-and-set in the token memcache back '",
            "                        'end.'),",
            "    ],",
            "    'catalog': [",
            "        cfg.StrOpt('template_file',",
            "                   default='default_catalog.templates',",
            "                   help='Catalog template file name for use with the '",
            "                        'template catalog backend.'),",
            "        cfg.StrOpt('driver',",
            "                   default='keystone.catalog.backends.sql.Catalog',",
            "                   help='Catalog backend driver.'),",
            "        cfg.BoolOpt('caching', default=True,",
            "                    help='Toggle for catalog caching. This has no '",
            "                         'effect unless global caching is enabled.'),",
            "        cfg.IntOpt('cache_time',",
            "                   help='Time to cache catalog data (in seconds). This has no '",
            "                        'effect unless global and catalog caching are '",
            "                        'enabled.'),",
            "        cfg.IntOpt('list_limit',",
            "                   help='Maximum number of entities that will be returned '",
            "                        'in a catalog collection.'),",
            "    ],",
            "    'kvs': [",
            "        cfg.ListOpt('backends', default=[],",
            "                    help='Extra dogpile.cache backend modules to register '",
            "                         'with the dogpile.cache library.'),",
            "        cfg.StrOpt('config_prefix', default='keystone.kvs',",
            "                   help='Prefix for building the configuration dictionary '",
            "                        'for the KVS region. This should not need to be '",
            "                        'changed unless there is another dogpile.cache '",
            "                        'region with the same configuration name.'),",
            "        cfg.BoolOpt('enable_key_mangler', default=True,",
            "                    help='Toggle to disable using a key-mangling function '",
            "                         'to ensure fixed length keys. This is toggle-able '",
            "                         'for debugging purposes, it is highly recommended '",
            "                         'to always leave this set to true.'),",
            "        cfg.IntOpt('default_lock_timeout', default=5,",
            "                   help='Default lock timeout for distributed locking.'),",
            "    ],",
            "    'saml': [",
            "        cfg.IntOpt('assertion_expiration_time', default=3600,",
            "                   help='Default TTL, in seconds, for any generated SAML '",
            "                        'assertion created by Keystone.'),",
            "        cfg.StrOpt('xmlsec1_binary',",
            "                   default='xmlsec1',",
            "                   help='Binary to be called for XML signing. Install the '",
            "                        'appropriate package, specify absolute path or adjust '",
            "                        'your PATH environment variable if the binary cannot '",
            "                        'be found.'),",
            "        cfg.StrOpt('certfile',",
            "                   default=_CERTFILE,",
            "                   help='Path of the certfile for SAML signing. For '",
            "                        'non-production environments, you may be interested '",
            "                        'in using `keystone-manage pki_setup` to generate '",
            "                        'self-signed certificates. Note, the path cannot '",
            "                        'contain a comma.'),",
            "        cfg.StrOpt('keyfile',",
            "                   default=_KEYFILE,",
            "                   help='Path of the keyfile for SAML signing. Note, the path '",
            "                        'cannot contain a comma.'),",
            "        cfg.StrOpt('idp_entity_id',",
            "                   help='Entity ID value for unique Identity Provider '",
            "                        'identification. Usually FQDN is set with a suffix. '",
            "                        'A value is required to generate IDP Metadata. '",
            "                        'For example: https://keystone.example.com/v3/'",
            "                        'OS-FEDERATION/saml2/idp'),",
            "        cfg.StrOpt('idp_sso_endpoint',",
            "                   help='Identity Provider Single-Sign-On service value, '",
            "                        'required in the Identity Provider\\'s metadata. '",
            "                        'A value is required to generate IDP Metadata. '",
            "                        'For example: https://keystone.example.com/v3/'",
            "                        'OS-FEDERATION/saml2/sso'),",
            "        cfg.StrOpt('idp_lang', default='en',",
            "                   help='Language used by the organization.'),",
            "        cfg.StrOpt('idp_organization_name',",
            "                   help='Organization name the installation belongs to.'),",
            "        cfg.StrOpt('idp_organization_display_name',",
            "                   help='Organization name to be displayed.'),",
            "        cfg.StrOpt('idp_organization_url',",
            "                   help='URL of the organization.'),",
            "        cfg.StrOpt('idp_contact_company',",
            "                   help='Company of contact person.'),",
            "        cfg.StrOpt('idp_contact_name',",
            "                   help='Given name of contact person'),",
            "        cfg.StrOpt('idp_contact_surname',",
            "                   help='Surname of contact person.'),",
            "        cfg.StrOpt('idp_contact_email',",
            "                   help='Email address of contact person.'),",
            "        cfg.StrOpt('idp_contact_telephone',",
            "                   help='Telephone number of contact person.'),",
            "        cfg.StrOpt('idp_contact_type', default='other',",
            "                   help='Contact type. Allowed values are: '",
            "                        'technical, support, administrative '",
            "                        'billing, and other'),",
            "        cfg.StrOpt('idp_metadata_path',",
            "                   default='/etc/keystone/saml2_idp_metadata.xml',",
            "                   help='Path to the Identity Provider Metadata file. '",
            "                        'This file should be generated with the '",
            "                        'keystone-manage saml_idp_metadata command.'),",
            "    ],",
            "}",
            "",
            "",
            "CONF = cfg.CONF",
            "messaging.set_transport_defaults(control_exchange='keystone')",
            "",
            "",
            "def _register_auth_plugin_opt(conf, option):",
            "    conf.register_opt(option, group='auth')",
            "",
            "",
            "def setup_authentication(conf=None):",
            "    # register any non-default auth methods here (used by extensions, etc)",
            "    if conf is None:",
            "        conf = CONF",
            "    for method_name in conf.auth.methods:",
            "        if method_name not in _DEFAULT_AUTH_METHODS:",
            "            option = cfg.StrOpt(method_name)",
            "            _register_auth_plugin_opt(conf, option)",
            "",
            "",
            "def configure(conf=None):",
            "    if conf is None:",
            "        conf = CONF",
            "",
            "    conf.register_cli_opt(",
            "        cfg.BoolOpt('standard-threads', default=False,",
            "                    help='Do not monkey-patch threading system modules.'))",
            "    conf.register_cli_opt(",
            "        cfg.StrOpt('pydev-debug-host',",
            "                   help='Host to connect to for remote debugger.'))",
            "    conf.register_cli_opt(",
            "        cfg.IntOpt('pydev-debug-port',",
            "                   help='Port to connect to for remote debugger.'))",
            "",
            "    for section in FILE_OPTIONS:",
            "        for option in FILE_OPTIONS[section]:",
            "            if section:",
            "                conf.register_opt(option, group=section)",
            "            else:",
            "                conf.register_opt(option)",
            "",
            "    # register any non-default auth methods here (used by extensions, etc)",
            "    setup_authentication(conf)",
            "",
            "",
            "def list_opts():",
            "    \"\"\"Return a list of oslo.config options available in Keystone.",
            "",
            "    The returned list includes all oslo.config options which are registered as",
            "    the \"FILE_OPTIONS\" in keystone.common.config. This list will not include",
            "    the options from the oslo-incubator library or any options registered",
            "    dynamically at run time.",
            "",
            "    Each object in the list is a two element tuple. The first element of",
            "    each tuple is the name of the group under which the list of options in the",
            "    second element will be registered. A group name of None corresponds to the",
            "    [DEFAULT] group in config files.",
            "",
            "    This function is also discoverable via the 'oslo.config.opts' entry point",
            "    under the 'keystone.config.opts' namespace.",
            "",
            "    The purpose of this is to allow tools like the Oslo sample config file",
            "    generator to discover the options exposed to users by this library.",
            "",
            "    :returns: a list of (group_name, opts) tuples",
            "    \"\"\"",
            "    return FILE_OPTIONS.items()"
        ],
        "afterPatchFile": [
            "# Copyright 2012 OpenStack Foundation",
            "#",
            "# Licensed under the Apache License, Version 2.0 (the \"License\"); you may",
            "# not use this file except in compliance with the License. You may obtain",
            "# a copy of the License at",
            "#",
            "#      http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "# Unless required by applicable law or agreed to in writing, software",
            "# distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
            "# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
            "# License for the specific language governing permissions and limitations",
            "# under the License.",
            "",
            "from oslo.config import cfg",
            "from oslo import messaging",
            "",
            "",
            "_DEFAULT_AUTH_METHODS = ['external', 'password', 'token']",
            "_CERTFILE = '/etc/keystone/ssl/certs/signing_cert.pem'",
            "_KEYFILE = '/etc/keystone/ssl/private/signing_key.pem'",
            "",
            "",
            "FILE_OPTIONS = {",
            "    None: [",
            "        cfg.StrOpt('admin_token', secret=True, default='ADMIN',",
            "                   help='A \"shared secret\" that can be used to bootstrap '",
            "                        'Keystone. This \"token\" does not represent a user, '",
            "                        'and carries no explicit authorization. To disable '",
            "                        'in production (highly recommended), remove '",
            "                        'AdminTokenAuthMiddleware from your paste '",
            "                        'application pipelines (for example, in '",
            "                        'keystone-paste.ini).'),",
            "        cfg.StrOpt('public_bind_host',",
            "                   default='0.0.0.0',",
            "                   deprecated_opts=[cfg.DeprecatedOpt('bind_host',",
            "                                                      group='DEFAULT')],",
            "                   help='The IP address of the network interface for the '",
            "                        'public service to listen on.'),",
            "        cfg.StrOpt('admin_bind_host',",
            "                   default='0.0.0.0',",
            "                   deprecated_opts=[cfg.DeprecatedOpt('bind_host',",
            "                                                      group='DEFAULT')],",
            "                   help='The IP address of the network interface for the '",
            "                        'admin service to listen on.'),",
            "        cfg.IntOpt('compute_port', default=8774,",
            "                   help='(Deprecated) The port which the OpenStack Compute '",
            "                        'service listens on. This option was only used for '",
            "                        'string replacement in the templated catalog backend. '",
            "                        'Templated catalogs should replace the '",
            "                        '\"$(compute_port)s\" substitution with the static port '",
            "                        'of the compute service. As of Juno, this option is '",
            "                        'deprecated and will be removed in the L release.'),",
            "        cfg.IntOpt('admin_port', default=35357,",
            "                   help='The port number which the admin service listens '",
            "                        'on.'),",
            "        cfg.IntOpt('public_port', default=5000,",
            "                   help='The port number which the public service listens '",
            "                        'on.'),",
            "        cfg.StrOpt('public_endpoint',",
            "                   help='The base public endpoint URL for Keystone that is '",
            "                        'advertised to clients (NOTE: this does NOT affect '",
            "                        'how Keystone listens for connections). '",
            "                        'Defaults to the base host URL of the request. E.g. a '",
            "                        'request to http://server:5000/v2.0/users will '",
            "                        'default to http://server:5000. You should only need '",
            "                        'to set this value if the base URL contains a path '",
            "                        '(e.g. /prefix/v2.0) or the endpoint should be found '",
            "                        'on a different server.'),",
            "        cfg.StrOpt('admin_endpoint',",
            "                   help='The base admin endpoint URL for Keystone that is '",
            "                        'advertised to clients (NOTE: this does NOT affect '",
            "                        'how Keystone listens for connections). '",
            "                        'Defaults to the base host URL of the request. E.g. a '",
            "                        'request to http://server:35357/v2.0/users will '",
            "                        'default to http://server:35357. You should only need '",
            "                        'to set this value if the base URL contains a path '",
            "                        '(e.g. /prefix/v2.0) or the endpoint should be found '",
            "                        'on a different server.'),",
            "        cfg.IntOpt('public_workers', default=1,",
            "                   help='The number of worker processes to serve the public '",
            "                        'WSGI application'),",
            "        cfg.IntOpt('admin_workers', default=1,",
            "                   help='The number of worker processes to serve the admin '",
            "                        'WSGI application'),",
            "        # default max request size is 112k",
            "        cfg.IntOpt('max_request_body_size', default=114688,",
            "                   help='Enforced by optional sizelimit middleware '",
            "                        '(keystone.middleware:RequestBodySizeLimiter).'),",
            "        cfg.IntOpt('max_param_size', default=64,",
            "                   help='Limit the sizes of user & project ID/names.'),",
            "        # we allow tokens to be a bit larger to accommodate PKI",
            "        cfg.IntOpt('max_token_size', default=8192,",
            "                   help='Similar to max_param_size, but provides an '",
            "                        'exception for token values.'),",
            "        cfg.StrOpt('member_role_id',",
            "                   default='9fe2ff9ee4384b1894a90878d3e92bab',",
            "                   help='During a SQL upgrade member_role_id will be used '",
            "                        'to create a new role that will replace records in '",
            "                        'the assignment table with explicit role grants. '",
            "                        'After migration, the member_role_id will be used in '",
            "                        'the API add_user_to_project.'),",
            "        cfg.StrOpt('member_role_name', default='_member_',",
            "                   help='During a SQL upgrade member_role_name will be used '",
            "                        'to create a new role that will replace records in '",
            "                        'the assignment table with explicit role grants. '",
            "                        'After migration, member_role_name will be ignored.'),",
            "        cfg.IntOpt('crypt_strength', default=40000,",
            "                   help='The value passed as the keyword \"rounds\" to '",
            "                        'passlib\\'s encrypt method.'),",
            "        cfg.BoolOpt('tcp_keepalive', default=False,",
            "                    help='Set this to true if you want to enable '",
            "                         'TCP_KEEPALIVE on server sockets, i.e. sockets used '",
            "                         'by the Keystone wsgi server for client '",
            "                         'connections.'),",
            "        cfg.IntOpt('tcp_keepidle',",
            "                   default=600,",
            "                   help='Sets the value of TCP_KEEPIDLE in seconds for each '",
            "                        'server socket. Only applies if tcp_keepalive is '",
            "                        'true. Not supported on OS X.'),",
            "        cfg.IntOpt('list_limit',",
            "                   help='The maximum number of entities that will be '",
            "                        'returned in a collection, with no limit set by '",
            "                        'default. This global limit may be then overridden '",
            "                        'for a specific driver, by specifying a list_limit '",
            "                        'in the appropriate section (e.g. [assignment]).'),",
            "        cfg.BoolOpt('domain_id_immutable', default=True,",
            "                    help='Set this to false if you want to enable the '",
            "                         'ability for user, group and project entities '",
            "                         'to be moved between domains by updating their '",
            "                         'domain_id. Allowing such movement is not '",
            "                         'recommended if the scope of a domain admin is being '",
            "                         'restricted by use of an appropriate policy file '",
            "                         '(see policy.v3cloudsample as an example).'),",
            "        cfg.BoolOpt('strict_password_check', default=False,",
            "                    help='If set to true, strict password length checking is '",
            "                         'performed for password manipulation. If a password '",
            "                         'exceeds the maximum length, the operation will fail '",
            "                         'with an HTTP 403 Forbidden error. If set to false, '",
            "                         'passwords are automatically truncated to the '",
            "                         'maximum length.')],",
            "    'identity': [",
            "        cfg.StrOpt('default_domain_id', default='default',",
            "                   help='This references the domain to use for all '",
            "                        'Identity API v2 requests (which are not aware of '",
            "                        'domains). A domain with this ID will be created '",
            "                        'for you by keystone-manage db_sync in migration '",
            "                        '008. The domain referenced by this ID cannot be '",
            "                        'deleted on the v3 API, to prevent accidentally '",
            "                        'breaking the v2 API. There is nothing special about '",
            "                        'this domain, other than the fact that it must '",
            "                        'exist to order to maintain support for your v2 '",
            "                        'clients.'),",
            "        cfg.BoolOpt('domain_specific_drivers_enabled',",
            "                    default=False,",
            "                    help='A subset (or all) of domains can have their own '",
            "                         'identity driver, each with their own partial '",
            "                         'configuration file in a domain configuration '",
            "                         'directory. Only values specific to the domain '",
            "                         'need to be placed in the domain specific '",
            "                         'configuration file. This feature is disabled by '",
            "                         'default; set to true to enable.'),",
            "        cfg.StrOpt('domain_config_dir',",
            "                   default='/etc/keystone/domains',",
            "                   help='Path for Keystone to locate the domain specific '",
            "                        'identity configuration files if '",
            "                        'domain_specific_drivers_enabled is set to true.'),",
            "        cfg.StrOpt('driver',",
            "                   default=('keystone.identity.backends'",
            "                            '.sql.Identity'),",
            "                   help='Identity backend driver.'),",
            "        cfg.IntOpt('max_password_length', default=4096,",
            "                   help='Maximum supported length for user passwords; '",
            "                        'decrease to improve performance.'),",
            "        cfg.IntOpt('list_limit',",
            "                   help='Maximum number of entities that will be returned in '",
            "                        'an identity collection.'),",
            "    ],",
            "    'identity_mapping': [",
            "        cfg.StrOpt('driver',",
            "                   default=('keystone.identity.mapping_backends'",
            "                            '.sql.Mapping'),",
            "                   help='Keystone Identity Mapping backend driver.'),",
            "        cfg.StrOpt('generator',",
            "                   default=('keystone.identity.id_generators'",
            "                            '.sha256.Generator'),",
            "                   help='Public ID generator for user and group entities. '",
            "                        'The Keystone identity mapper only supports '",
            "                        'generators that produce no more than 64 characters.'),",
            "        cfg.BoolOpt('backward_compatible_ids',",
            "                    default=True,",
            "                    help='The format of user and group IDs changed '",
            "                         'in Juno for backends that do not generate UUIDs '",
            "                         '(e.g. LDAP), with keystone providing a hash mapping '",
            "                         'to the underlying attribute in LDAP. By default '",
            "                         'this mapping is disabled, which ensures that '",
            "                         'existing IDs will not change. Even when the '",
            "                         'mapping is enabled by using domain specific '",
            "                         'drivers, any users and groups from the default '",
            "                         'domain being handled by LDAP will still not be '",
            "                         'mapped to ensure their IDs remain backward '",
            "                         'compatible. Setting this value to False will '",
            "                         'enable the mapping for even the default LDAP '",
            "                         'driver. It is only safe to do this if you do not '",
            "                         'already have assignments for users and '",
            "                         'groups from the default LDAP domain, and it is '",
            "                         'acceptable for Keystone to provide the different '",
            "                         'IDs to clients than it did previously.  Typically '",
            "                         'this means that the only time you can set this '",
            "                         'value to False is when configuring a fresh '",
            "                         'installation.'),",
            "    ],",
            "    'trust': [",
            "        cfg.BoolOpt('enabled', default=True,",
            "                    help='Delegation and impersonation features can be '",
            "                         'optionally disabled.'),",
            "        cfg.StrOpt('driver',",
            "                   default='keystone.trust.backends.sql.Trust',",
            "                   help='Trust backend driver.')],",
            "    'os_inherit': [",
            "        cfg.BoolOpt('enabled', default=False,",
            "                    help='role-assignment inheritance to projects from '",
            "                         'owning domain can be optionally enabled.'),",
            "    ],",
            "    'token': [",
            "        cfg.ListOpt('bind', default=[],",
            "                    help='External auth mechanisms that should add bind '",
            "                         'information to token, e.g., kerberos,x509.'),",
            "        cfg.StrOpt('enforce_token_bind', default='permissive',",
            "                   help='Enforcement policy on tokens presented to Keystone '",
            "                        'with bind information. One of disabled, permissive, '",
            "                        'strict, required or a specifically required bind '",
            "                        'mode, e.g., kerberos or x509 to require binding to '",
            "                        'that authentication.'),",
            "        cfg.IntOpt('expiration', default=3600,",
            "                   help='Amount of time a token should remain valid '",
            "                        '(in seconds).'),",
            "        cfg.StrOpt('provider',",
            "                   help='Controls the token construction, validation, and '",
            "                        'revocation operations. Core providers are '",
            "                        '\"keystone.token.providers.[pkiz|pki|uuid].'",
            "                        'Provider\". The default provider is uuid.'),",
            "        cfg.StrOpt('driver',",
            "                   default='keystone.token.persistence.backends.sql.Token',",
            "                   help='Token persistence backend driver.'),",
            "        cfg.BoolOpt('caching', default=True,",
            "                    help='Toggle for token system caching. This has no '",
            "                         'effect unless global caching is enabled.'),",
            "        cfg.IntOpt('revocation_cache_time', default=3600,",
            "                   help='Time to cache the revocation list and the revocation '",
            "                        'events if revoke extension is enabled (in seconds). '",
            "                        'This has no effect unless global and token '",
            "                        'caching are enabled.'),",
            "        cfg.IntOpt('cache_time',",
            "                   help='Time to cache tokens (in seconds). This has no '",
            "                        'effect unless global and token caching are '",
            "                        'enabled.'),",
            "        cfg.BoolOpt('revoke_by_id', default=True,",
            "                    help='Revoke token by token identifier. Setting '",
            "                    'revoke_by_id to true enables various forms of '",
            "                    'enumerating tokens, e.g. `list tokens for user`. '",
            "                    'These enumerations are processed to determine the '",
            "                    'list of tokens to revoke. Only disable if you are '",
            "                    'switching to using the Revoke extension with a '",
            "                    'backend other than KVS, which stores events in memory.'),",
            "        cfg.StrOpt('hash_algorithm', default='md5',",
            "                   help=\"The hash algorithm to use for PKI tokens. This can \"",
            "                        \"be set to any algorithm that hashlib supports. \"",
            "                        \"WARNING: Before changing this value, the auth_token \"",
            "                        \"middleware must be configured with the \"",
            "                        \"hash_algorithms, otherwise token revocation will \"",
            "                        \"not be processed correctly.\"),",
            "    ],",
            "    'revoke': [",
            "        cfg.StrOpt('driver',",
            "                   default='keystone.contrib.revoke.backends.kvs.Revoke',",
            "                   help='An implementation of the backend for persisting '",
            "                        'revocation events.'),",
            "        cfg.IntOpt('expiration_buffer', default=1800,",
            "                   help='This value (calculated in seconds) is added to token '",
            "                        'expiration before a revocation event may be removed '",
            "                        'from the backend.'),",
            "        cfg.BoolOpt('caching', default=True,",
            "                    help='Toggle for revocation event caching. This has no '",
            "                         'effect unless global caching is enabled.'),",
            "    ],",
            "    'cache': [",
            "        cfg.StrOpt('config_prefix', default='cache.keystone',",
            "                   help='Prefix for building the configuration dictionary '",
            "                        'for the cache region. This should not need to be '",
            "                        'changed unless there is another dogpile.cache '",
            "                        'region with the same configuration name.'),",
            "        cfg.IntOpt('expiration_time', default=600,",
            "                   help='Default TTL, in seconds, for any cached item in '",
            "                        'the dogpile.cache region. This applies to any '",
            "                        'cached method that doesn\\'t have an explicit '",
            "                        'cache expiration time defined for it.'),",
            "        # NOTE(morganfainberg): the dogpile.cache.memory acceptable in devstack",
            "        # and other such single-process/thread deployments. Running",
            "        # dogpile.cache.memory in any other configuration has the same pitfalls",
            "        # as the KVS token backend. It is recommended that either Redis or",
            "        # Memcached are used as the dogpile backend for real workloads. To",
            "        # prevent issues with the memory cache ending up in \"production\"",
            "        # unintentionally, we register a no-op as the keystone default caching",
            "        # backend.",
            "        cfg.StrOpt('backend', default='keystone.common.cache.noop',",
            "                   help='Dogpile.cache backend module. It is recommended '",
            "                        'that Memcache (dogpile.cache.memcached) or Redis '",
            "                        '(dogpile.cache.redis) be used in production '",
            "                        'deployments.  Small workloads (single process) '",
            "                        'like devstack can use the dogpile.cache.memory '",
            "                        'backend.'),",
            "        cfg.MultiStrOpt('backend_argument', default=[],",
            "                        help='Arguments supplied to the backend module. '",
            "                             'Specify this option once per argument to be '",
            "                             'passed to the dogpile.cache backend. Example '",
            "                             'format: \"<argname>:<value>\".'),",
            "        cfg.ListOpt('proxies', default=[],",
            "                    help='Proxy classes to import that will affect the way '",
            "                         'the dogpile.cache backend functions. See the '",
            "                         'dogpile.cache documentation on '",
            "                         'changing-backend-behavior.'),",
            "        cfg.BoolOpt('enabled', default=False,",
            "                    help='Global toggle for all caching using the '",
            "                         'should_cache_fn mechanism.'),",
            "        cfg.BoolOpt('debug_cache_backend', default=False,",
            "                    help='Extra debugging from the cache backend (cache '",
            "                         'keys, get/set/delete/etc calls). This is only '",
            "                         'really useful if you need to see the specific '",
            "                         'cache-backend get/set/delete calls with the '",
            "                         'keys/values.  Typically this should be left set '",
            "                         'to false.'),",
            "    ],",
            "    'ssl': [",
            "        cfg.BoolOpt('enable', default=False,",
            "                    help='Toggle for SSL support on the Keystone '",
            "                         'eventlet servers.'),",
            "        cfg.StrOpt('certfile',",
            "                   default=\"/etc/keystone/ssl/certs/keystone.pem\",",
            "                   help='Path of the certfile for SSL. For non-production '",
            "                        'environments, you may be interested in using '",
            "                        '`keystone-manage ssl_setup` to generate self-signed '",
            "                        'certificates.'),",
            "        cfg.StrOpt('keyfile',",
            "                   default='/etc/keystone/ssl/private/keystonekey.pem',",
            "                   help='Path of the keyfile for SSL.'),",
            "        cfg.StrOpt('ca_certs',",
            "                   default='/etc/keystone/ssl/certs/ca.pem',",
            "                   help='Path of the ca cert file for SSL.'),",
            "        cfg.StrOpt('ca_key',",
            "                   default='/etc/keystone/ssl/private/cakey.pem',",
            "                   help='Path of the CA key file for SSL.'),",
            "        cfg.BoolOpt('cert_required', default=False,",
            "                    help='Require client certificate.'),",
            "        cfg.IntOpt('key_size', default=1024,",
            "                   help='SSL key length (in bits) (auto generated '",
            "                        'certificate).'),",
            "        cfg.IntOpt('valid_days', default=3650,",
            "                   help='Days the certificate is valid for once signed '",
            "                        '(auto generated certificate).'),",
            "        cfg.StrOpt('cert_subject',",
            "                   default='/C=US/ST=Unset/L=Unset/O=Unset/CN=localhost',",
            "                   help='SSL certificate subject (auto generated '",
            "                        'certificate).'),",
            "    ],",
            "    'signing': [",
            "        cfg.StrOpt('token_format',",
            "                   help='Deprecated in favor of provider in the '",
            "                        '[token] section.'),",
            "        cfg.StrOpt('certfile',",
            "                   default=_CERTFILE,",
            "                   help='Path of the certfile for token signing. For '",
            "                        'non-production environments, you may be interested '",
            "                        'in using `keystone-manage pki_setup` to generate '",
            "                        'self-signed certificates.'),",
            "        cfg.StrOpt('keyfile',",
            "                   default=_KEYFILE,",
            "                   help='Path of the keyfile for token signing.'),",
            "        cfg.StrOpt('ca_certs',",
            "                   default='/etc/keystone/ssl/certs/ca.pem',",
            "                   help='Path of the CA for token signing.'),",
            "        cfg.StrOpt('ca_key',",
            "                   default='/etc/keystone/ssl/private/cakey.pem',",
            "                   help='Path of the CA key for token signing.'),",
            "        cfg.IntOpt('key_size', default=2048,",
            "                   help='Key size (in bits) for token signing cert '",
            "                        '(auto generated certificate).'),",
            "        cfg.IntOpt('valid_days', default=3650,",
            "                   help='Days the token signing cert is valid for '",
            "                        '(auto generated certificate).'),",
            "        cfg.StrOpt('cert_subject',",
            "                   default=('/C=US/ST=Unset/L=Unset/O=Unset/'",
            "                            'CN=www.example.com'),",
            "                   help='Certificate subject (auto generated certificate) for '",
            "                        'token signing.'),",
            "    ],",
            "    'assignment': [",
            "        # assignment has no default for backward compatibility reasons.",
            "        # If assignment driver is not specified, the identity driver chooses",
            "        # the backend",
            "        cfg.StrOpt('driver',",
            "                   help='Assignment backend driver.'),",
            "        cfg.BoolOpt('caching', default=True,",
            "                    help='Toggle for assignment caching. This has no effect '",
            "                         'unless global caching is enabled.'),",
            "        cfg.IntOpt('cache_time',",
            "                   help='TTL (in seconds) to cache assignment data. This has '",
            "                        'no effect unless global caching is enabled.'),",
            "        cfg.IntOpt('list_limit',",
            "                   help='Maximum number of entities that will be returned '",
            "                        'in an assignment collection.'),",
            "    ],",
            "    'credential': [",
            "        cfg.StrOpt('driver',",
            "                   default=('keystone.credential.backends'",
            "                            '.sql.Credential'),",
            "                   help='Credential backend driver.'),",
            "    ],",
            "    'oauth1': [",
            "        cfg.StrOpt('driver',",
            "                   default='keystone.contrib.oauth1.backends.sql.OAuth1',",
            "                   help='Credential backend driver.'),",
            "        cfg.IntOpt('request_token_duration', default=28800,",
            "                   help='Duration (in seconds) for the OAuth Request Token.'),",
            "        cfg.IntOpt('access_token_duration', default=86400,",
            "                   help='Duration (in seconds) for the OAuth Access Token.'),",
            "    ],",
            "    'federation': [",
            "        cfg.StrOpt('driver',",
            "                   default='keystone.contrib.federation.'",
            "                           'backends.sql.Federation',",
            "                   help='Federation backend driver.'),",
            "        cfg.StrOpt('assertion_prefix', default='',",
            "                   help='Value to be used when filtering assertion parameters '",
            "                        'from the environment.'),",
            "    ],",
            "    'policy': [",
            "        cfg.StrOpt('driver',",
            "                   default='keystone.policy.backends.sql.Policy',",
            "                   help='Policy backend driver.'),",
            "        cfg.IntOpt('list_limit',",
            "                   help='Maximum number of entities that will be returned '",
            "                        'in a policy collection.'),",
            "    ],",
            "    'ec2': [",
            "        cfg.StrOpt('driver',",
            "                   default='keystone.contrib.ec2.backends.kvs.Ec2',",
            "                   help='EC2Credential backend driver.'),",
            "    ],",
            "    'endpoint_filter': [",
            "        cfg.StrOpt('driver',",
            "                   default='keystone.contrib.endpoint_filter.backends'",
            "                           '.sql.EndpointFilter',",
            "                   help='Endpoint Filter backend driver'),",
            "        cfg.BoolOpt('return_all_endpoints_if_no_filter', default=True,",
            "                    help='Toggle to return all active endpoints if no filter '",
            "                         'exists.'),",
            "    ],",
            "    'endpoint_policy': [",
            "        cfg.StrOpt('driver',",
            "                   default='keystone.contrib.endpoint_policy.backends'",
            "                           '.sql.EndpointPolicy',",
            "                   help='Endpoint policy backend driver'),",
            "    ],",
            "    'stats': [",
            "        cfg.StrOpt('driver',",
            "                   default=('keystone.contrib.stats.backends'",
            "                            '.kvs.Stats'),",
            "                   help='Stats backend driver.'),",
            "    ],",
            "    'ldap': [",
            "        cfg.StrOpt('url', default='ldap://localhost',",
            "                   help='URL for connecting to the LDAP server.'),",
            "        cfg.StrOpt('user',",
            "                   help='User BindDN to query the LDAP server.'),",
            "        cfg.StrOpt('password', secret=True,",
            "                   help='Password for the BindDN to query the LDAP server.'),",
            "        cfg.StrOpt('suffix', default='cn=example,cn=com',",
            "                   help='LDAP server suffix'),",
            "        cfg.BoolOpt('use_dumb_member', default=False,",
            "                    help='If true, will add a dummy member to groups. This is '",
            "                         'required if the objectclass for groups requires the '",
            "                         '\"member\" attribute.'),",
            "        cfg.StrOpt('dumb_member', default='cn=dumb,dc=nonexistent',",
            "                   help='DN of the \"dummy member\" to use when '",
            "                        '\"use_dumb_member\" is enabled.'),",
            "        cfg.BoolOpt('allow_subtree_delete', default=False,",
            "                    help='Delete subtrees using the subtree delete control. '",
            "                         'Only enable this option if your LDAP server '",
            "                         'supports subtree deletion.'),",
            "        cfg.StrOpt('query_scope', default='one',",
            "                   help='The LDAP scope for queries, this can be either '",
            "                        '\"one\" (onelevel/singleLevel) or \"sub\" '",
            "                        '(subtree/wholeSubtree).'),",
            "        cfg.IntOpt('page_size', default=0,",
            "                   help='Maximum results per page; a value of zero (\"0\") '",
            "                        'disables paging.'),",
            "        cfg.StrOpt('alias_dereferencing', default='default',",
            "                   help='The LDAP dereferencing option for queries. This '",
            "                        'can be either \"never\", \"searching\", \"always\", '",
            "                        '\"finding\" or \"default\". The \"default\" option falls '",
            "                        'back to using default dereferencing configured by '",
            "                        'your ldap.conf.'),",
            "        cfg.IntOpt('debug_level',",
            "                   help='Sets the LDAP debugging level for LDAP calls. '",
            "                        'A value of 0 means that debugging is not enabled. '",
            "                        'This value is a bitmask, consult your LDAP '",
            "                        'documentation for possible values.'),",
            "        cfg.BoolOpt('chase_referrals',",
            "                    help='Override the system\\'s default referral chasing '",
            "                         'behavior for queries.'),",
            "        cfg.StrOpt('user_tree_dn',",
            "                   help='Search base for users.'),",
            "        cfg.StrOpt('user_filter',",
            "                   help='LDAP search filter for users.'),",
            "        cfg.StrOpt('user_objectclass', default='inetOrgPerson',",
            "                   help='LDAP objectclass for users.'),",
            "        cfg.StrOpt('user_id_attribute', default='cn',",
            "                   help='LDAP attribute mapped to user id. '",
            "                        'WARNING: must not be a multivalued attribute.'),",
            "        cfg.StrOpt('user_name_attribute', default='sn',",
            "                   help='LDAP attribute mapped to user name.'),",
            "        cfg.StrOpt('user_mail_attribute', default='mail',",
            "                   help='LDAP attribute mapped to user email.'),",
            "        cfg.StrOpt('user_pass_attribute', default='userPassword',",
            "                   help='LDAP attribute mapped to password.'),",
            "        cfg.StrOpt('user_enabled_attribute', default='enabled',",
            "                   help='LDAP attribute mapped to user enabled flag.'),",
            "        cfg.BoolOpt('user_enabled_invert', default=False,",
            "                    help='Invert the meaning of the boolean enabled values. '",
            "                         'Some LDAP servers use a boolean lock attribute '",
            "                         'where \"true\" means an account is disabled. Setting '",
            "                         '\"user_enabled_invert = true\" will allow these lock '",
            "                         'attributes to be used. This setting will have no '",
            "                         'effect if \"user_enabled_mask\" or '",
            "                         '\"user_enabled_emulation\" settings are in use.'),",
            "        cfg.IntOpt('user_enabled_mask', default=0,",
            "                   help='Bitmask integer to indicate the bit that the enabled '",
            "                        'value is stored in if the LDAP server represents '",
            "                        '\"enabled\" as a bit on an integer rather than a '",
            "                        'boolean. A value of \"0\" indicates the mask is not '",
            "                        'used. If this is not set to \"0\" the typical value '",
            "                        'is \"2\". This is typically used when '",
            "                        '\"user_enabled_attribute = userAccountControl\".'),",
            "        cfg.StrOpt('user_enabled_default', default='True',",
            "                   help='Default value to enable users. This should match an '",
            "                        'appropriate int value if the LDAP server uses '",
            "                        'non-boolean (bitmask) values to indicate if a user '",
            "                        'is enabled or disabled. If this is not set to \"True\" '",
            "                        'the typical value is \"512\". This is typically used '",
            "                        'when \"user_enabled_attribute = userAccountControl\".'),",
            "        cfg.ListOpt('user_attribute_ignore',",
            "                    default=['default_project_id', 'tenants'],",
            "                    help='List of attributes stripped off the user on '",
            "                         'update.'),",
            "        cfg.StrOpt('user_default_project_id_attribute',",
            "                   help='LDAP attribute mapped to default_project_id for '",
            "                        'users.'),",
            "        cfg.BoolOpt('user_allow_create', default=True,",
            "                    help='Allow user creation in LDAP backend.'),",
            "        cfg.BoolOpt('user_allow_update', default=True,",
            "                    help='Allow user updates in LDAP backend.'),",
            "        cfg.BoolOpt('user_allow_delete', default=True,",
            "                    help='Allow user deletion in LDAP backend.'),",
            "        cfg.BoolOpt('user_enabled_emulation', default=False,",
            "                    help='If true, Keystone uses an alternative method to '",
            "                         'determine if a user is enabled or not by checking '",
            "                         'if they are a member of the '",
            "                         '\"user_enabled_emulation_dn\" group.'),",
            "        cfg.StrOpt('user_enabled_emulation_dn',",
            "                   help='DN of the group entry to hold enabled users when '",
            "                        'using enabled emulation.'),",
            "        cfg.ListOpt('user_additional_attribute_mapping',",
            "                    default=[],",
            "                    help='List of additional LDAP attributes used for mapping '",
            "                         'additional attribute mappings for users. Attribute '",
            "                         'mapping format is <ldap_attr>:<user_attr>, where '",
            "                         'ldap_attr is the attribute in the LDAP entry and '",
            "                         'user_attr is the Identity API attribute.'),",
            "",
            "        cfg.StrOpt('project_tree_dn',",
            "                   deprecated_opts=[cfg.DeprecatedOpt(",
            "                       'tenant_tree_dn', group='ldap')],",
            "                   help='Search base for projects'),",
            "        cfg.StrOpt('project_filter',",
            "                   deprecated_opts=[cfg.DeprecatedOpt(",
            "                       'tenant_filter', group='ldap')],",
            "                   help='LDAP search filter for projects.'),",
            "        cfg.StrOpt('project_objectclass', default='groupOfNames',",
            "                   deprecated_opts=[cfg.DeprecatedOpt(",
            "                       'tenant_objectclass', group='ldap')],",
            "                   help='LDAP objectclass for projects.'),",
            "        cfg.StrOpt('project_id_attribute', default='cn',",
            "                   deprecated_opts=[cfg.DeprecatedOpt(",
            "                       'tenant_id_attribute', group='ldap')],",
            "                   help='LDAP attribute mapped to project id.'),",
            "        cfg.StrOpt('project_member_attribute', default='member',",
            "                   deprecated_opts=[cfg.DeprecatedOpt(",
            "                       'tenant_member_attribute', group='ldap')],",
            "                   help='LDAP attribute mapped to project membership for '",
            "                        'user.'),",
            "        cfg.StrOpt('project_name_attribute', default='ou',",
            "                   deprecated_opts=[cfg.DeprecatedOpt(",
            "                       'tenant_name_attribute', group='ldap')],",
            "                   help='LDAP attribute mapped to project name.'),",
            "        cfg.StrOpt('project_desc_attribute', default='description',",
            "                   deprecated_opts=[cfg.DeprecatedOpt(",
            "                       'tenant_desc_attribute', group='ldap')],",
            "                   help='LDAP attribute mapped to project description.'),",
            "        cfg.StrOpt('project_enabled_attribute', default='enabled',",
            "                   deprecated_opts=[cfg.DeprecatedOpt(",
            "                       'tenant_enabled_attribute', group='ldap')],",
            "                   help='LDAP attribute mapped to project enabled.'),",
            "        cfg.StrOpt('project_domain_id_attribute',",
            "                   deprecated_opts=[cfg.DeprecatedOpt(",
            "                       'tenant_domain_id_attribute', group='ldap')],",
            "                   default='businessCategory',",
            "                   help='LDAP attribute mapped to project domain_id.'),",
            "        cfg.ListOpt('project_attribute_ignore', default=[],",
            "                    deprecated_opts=[cfg.DeprecatedOpt(",
            "                        'tenant_attribute_ignore', group='ldap')],",
            "                    help='List of attributes stripped off the project on '",
            "                         'update.'),",
            "        cfg.BoolOpt('project_allow_create', default=True,",
            "                    deprecated_opts=[cfg.DeprecatedOpt(",
            "                        'tenant_allow_create', group='ldap')],",
            "                    help='Allow project creation in LDAP backend.'),",
            "        cfg.BoolOpt('project_allow_update', default=True,",
            "                    deprecated_opts=[cfg.DeprecatedOpt(",
            "                        'tenant_allow_update', group='ldap')],",
            "                    help='Allow project update in LDAP backend.'),",
            "        cfg.BoolOpt('project_allow_delete', default=True,",
            "                    deprecated_opts=[cfg.DeprecatedOpt(",
            "                        'tenant_allow_delete', group='ldap')],",
            "                    help='Allow project deletion in LDAP backend.'),",
            "        cfg.BoolOpt('project_enabled_emulation', default=False,",
            "                    deprecated_opts=[cfg.DeprecatedOpt(",
            "                        'tenant_enabled_emulation', group='ldap')],",
            "                    help='If true, Keystone uses an alternative method to '",
            "                         'determine if a project is enabled or not by '",
            "                         'checking if they are a member of the '",
            "                         '\"project_enabled_emulation_dn\" group.'),",
            "        cfg.StrOpt('project_enabled_emulation_dn',",
            "                   deprecated_opts=[cfg.DeprecatedOpt(",
            "                       'tenant_enabled_emulation_dn', group='ldap')],",
            "                   help='DN of the group entry to hold enabled projects when '",
            "                        'using enabled emulation.'),",
            "        cfg.ListOpt('project_additional_attribute_mapping',",
            "                    deprecated_opts=[cfg.DeprecatedOpt(",
            "                        'tenant_additional_attribute_mapping', group='ldap')],",
            "                    default=[],",
            "                    help='Additional attribute mappings for projects. '",
            "                         'Attribute mapping format is '",
            "                         '<ldap_attr>:<user_attr>, where ldap_attr is the '",
            "                         'attribute in the LDAP entry and user_attr is the '",
            "                         'Identity API attribute.'),",
            "",
            "        cfg.StrOpt('role_tree_dn',",
            "                   help='Search base for roles.'),",
            "        cfg.StrOpt('role_filter',",
            "                   help='LDAP search filter for roles.'),",
            "        cfg.StrOpt('role_objectclass', default='organizationalRole',",
            "                   help='LDAP objectclass for roles.'),",
            "        cfg.StrOpt('role_id_attribute', default='cn',",
            "                   help='LDAP attribute mapped to role id.'),",
            "        cfg.StrOpt('role_name_attribute', default='ou',",
            "                   help='LDAP attribute mapped to role name.'),",
            "        cfg.StrOpt('role_member_attribute', default='roleOccupant',",
            "                   help='LDAP attribute mapped to role membership.'),",
            "        cfg.ListOpt('role_attribute_ignore', default=[],",
            "                    help='List of attributes stripped off the role on '",
            "                         'update.'),",
            "        cfg.BoolOpt('role_allow_create', default=True,",
            "                    help='Allow role creation in LDAP backend.'),",
            "        cfg.BoolOpt('role_allow_update', default=True,",
            "                    help='Allow role update in LDAP backend.'),",
            "        cfg.BoolOpt('role_allow_delete', default=True,",
            "                    help='Allow role deletion in LDAP backend.'),",
            "        cfg.ListOpt('role_additional_attribute_mapping',",
            "                    default=[],",
            "                    help='Additional attribute mappings for roles. Attribute '",
            "                         'mapping format is <ldap_attr>:<user_attr>, where '",
            "                         'ldap_attr is the attribute in the LDAP entry and '",
            "                         'user_attr is the Identity API attribute.'),",
            "",
            "        cfg.StrOpt('group_tree_dn',",
            "                   help='Search base for groups.'),",
            "        cfg.StrOpt('group_filter',",
            "                   help='LDAP search filter for groups.'),",
            "        cfg.StrOpt('group_objectclass', default='groupOfNames',",
            "                   help='LDAP objectclass for groups.'),",
            "        cfg.StrOpt('group_id_attribute', default='cn',",
            "                   help='LDAP attribute mapped to group id.'),",
            "        cfg.StrOpt('group_name_attribute', default='ou',",
            "                   help='LDAP attribute mapped to group name.'),",
            "        cfg.StrOpt('group_member_attribute', default='member',",
            "                   help='LDAP attribute mapped to show group membership.'),",
            "        cfg.StrOpt('group_desc_attribute', default='description',",
            "                   help='LDAP attribute mapped to group description.'),",
            "        cfg.ListOpt('group_attribute_ignore', default=[],",
            "                    help='List of attributes stripped off the group on '",
            "                         'update.'),",
            "        cfg.BoolOpt('group_allow_create', default=True,",
            "                    help='Allow group creation in LDAP backend.'),",
            "        cfg.BoolOpt('group_allow_update', default=True,",
            "                    help='Allow group update in LDAP backend.'),",
            "        cfg.BoolOpt('group_allow_delete', default=True,",
            "                    help='Allow group deletion in LDAP backend.'),",
            "        cfg.ListOpt('group_additional_attribute_mapping',",
            "                    default=[],",
            "                    help='Additional attribute mappings for groups. Attribute '",
            "                         'mapping format is <ldap_attr>:<user_attr>, where '",
            "                         'ldap_attr is the attribute in the LDAP entry and '",
            "                         'user_attr is the Identity API attribute.'),",
            "",
            "        cfg.StrOpt('tls_cacertfile',",
            "                   help='CA certificate file path for communicating with '",
            "                        'LDAP servers.'),",
            "        cfg.StrOpt('tls_cacertdir',",
            "                   help='CA certificate directory path for communicating with '",
            "                        'LDAP servers.'),",
            "        cfg.BoolOpt('use_tls', default=False,",
            "                    help='Enable TLS for communicating with LDAP servers.'),",
            "        cfg.StrOpt('tls_req_cert', default='demand',",
            "                   help='Valid options for tls_req_cert are demand, never, '",
            "                        'and allow.'),",
            "        cfg.BoolOpt('use_pool', default=False,",
            "                    help='Enable LDAP connection pooling.'),",
            "        cfg.IntOpt('pool_size', default=10,",
            "                   help='Connection pool size.'),",
            "        cfg.IntOpt('pool_retry_max', default=3,",
            "                   help='Maximum count of reconnect trials.'),",
            "        cfg.FloatOpt('pool_retry_delay', default=0.1,",
            "                     help='Time span in seconds to wait between two '",
            "                          'reconnect trials.'),",
            "        cfg.IntOpt('pool_connection_timeout', default=-1,",
            "                   help='Connector timeout in seconds. Value -1 indicates '",
            "                        'indefinite wait for response.'),",
            "        cfg.IntOpt('pool_connection_lifetime', default=600,",
            "                   help='Connection lifetime in seconds.'),",
            "        cfg.BoolOpt('use_auth_pool', default=False,",
            "                    help='Enable LDAP connection pooling for end user '",
            "                         'authentication. If use_pool is disabled, then this '",
            "                         'setting is meaningless and is not used at all.'),",
            "        cfg.IntOpt('auth_pool_size', default=100,",
            "                   help='End user auth connection pool size.'),",
            "        cfg.IntOpt('auth_pool_connection_lifetime', default=60,",
            "                   help='End user auth connection lifetime in seconds.'),",
            "    ],",
            "    'auth': [",
            "        cfg.ListOpt('methods', default=_DEFAULT_AUTH_METHODS,",
            "                    help='Default auth methods.'),",
            "        cfg.StrOpt('password',",
            "                   default='keystone.auth.plugins.password.Password',",
            "                   help='The password auth plugin module.'),",
            "        cfg.StrOpt('token',",
            "                   default='keystone.auth.plugins.token.Token',",
            "                   help='The token auth plugin module.'),",
            "        # deals with REMOTE_USER authentication",
            "        cfg.StrOpt('external',",
            "                   default='keystone.auth.plugins.external.DefaultDomain',",
            "                   help='The external (REMOTE_USER) auth plugin module.'),",
            "    ],",
            "    'paste_deploy': [",
            "        cfg.StrOpt('config_file', default='keystone-paste.ini',",
            "                   help='Name of the paste configuration file that defines '",
            "                        'the available pipelines.'),",
            "    ],",
            "    'memcache': [",
            "        cfg.ListOpt('servers', default=['localhost:11211'],",
            "                    help='Memcache servers in the format of \"host:port\".'),",
            "        cfg.IntOpt('max_compare_and_set_retry', default=16,",
            "                   help='Number of compare-and-set attempts to make when '",
            "                        'using compare-and-set in the token memcache back '",
            "                        'end.'),",
            "    ],",
            "    'catalog': [",
            "        cfg.StrOpt('template_file',",
            "                   default='default_catalog.templates',",
            "                   help='Catalog template file name for use with the '",
            "                        'template catalog backend.'),",
            "        cfg.StrOpt('driver',",
            "                   default='keystone.catalog.backends.sql.Catalog',",
            "                   help='Catalog backend driver.'),",
            "        cfg.BoolOpt('caching', default=True,",
            "                    help='Toggle for catalog caching. This has no '",
            "                         'effect unless global caching is enabled.'),",
            "        cfg.IntOpt('cache_time',",
            "                   help='Time to cache catalog data (in seconds). This has no '",
            "                        'effect unless global and catalog caching are '",
            "                        'enabled.'),",
            "        cfg.IntOpt('list_limit',",
            "                   help='Maximum number of entities that will be returned '",
            "                        'in a catalog collection.'),",
            "        cfg.ListOpt('endpoint_substitution_whitelist',",
            "                    default=['tenant_id', 'user_id', 'public_bind_host',",
            "                             'admin_bind_host', 'compute_host', 'compute_port',",
            "                             'admin_port', 'public_port', 'public_endpoint',",
            "                             'admin_endpoint'],",
            "                    help='(Deprecated) List of possible substitutions for use '",
            "                         'in formatting endpoints. Use caution when modifying '",
            "                         'this list. It will give users with permission to '",
            "                         'create endpoints the ability to see those values '",
            "                         'in your configuration file. This option will be '",
            "                         'removed in Juno.'),",
            "    ],",
            "    'kvs': [",
            "        cfg.ListOpt('backends', default=[],",
            "                    help='Extra dogpile.cache backend modules to register '",
            "                         'with the dogpile.cache library.'),",
            "        cfg.StrOpt('config_prefix', default='keystone.kvs',",
            "                   help='Prefix for building the configuration dictionary '",
            "                        'for the KVS region. This should not need to be '",
            "                        'changed unless there is another dogpile.cache '",
            "                        'region with the same configuration name.'),",
            "        cfg.BoolOpt('enable_key_mangler', default=True,",
            "                    help='Toggle to disable using a key-mangling function '",
            "                         'to ensure fixed length keys. This is toggle-able '",
            "                         'for debugging purposes, it is highly recommended '",
            "                         'to always leave this set to true.'),",
            "        cfg.IntOpt('default_lock_timeout', default=5,",
            "                   help='Default lock timeout for distributed locking.'),",
            "    ],",
            "    'saml': [",
            "        cfg.IntOpt('assertion_expiration_time', default=3600,",
            "                   help='Default TTL, in seconds, for any generated SAML '",
            "                        'assertion created by Keystone.'),",
            "        cfg.StrOpt('xmlsec1_binary',",
            "                   default='xmlsec1',",
            "                   help='Binary to be called for XML signing. Install the '",
            "                        'appropriate package, specify absolute path or adjust '",
            "                        'your PATH environment variable if the binary cannot '",
            "                        'be found.'),",
            "        cfg.StrOpt('certfile',",
            "                   default=_CERTFILE,",
            "                   help='Path of the certfile for SAML signing. For '",
            "                        'non-production environments, you may be interested '",
            "                        'in using `keystone-manage pki_setup` to generate '",
            "                        'self-signed certificates. Note, the path cannot '",
            "                        'contain a comma.'),",
            "        cfg.StrOpt('keyfile',",
            "                   default=_KEYFILE,",
            "                   help='Path of the keyfile for SAML signing. Note, the path '",
            "                        'cannot contain a comma.'),",
            "        cfg.StrOpt('idp_entity_id',",
            "                   help='Entity ID value for unique Identity Provider '",
            "                        'identification. Usually FQDN is set with a suffix. '",
            "                        'A value is required to generate IDP Metadata. '",
            "                        'For example: https://keystone.example.com/v3/'",
            "                        'OS-FEDERATION/saml2/idp'),",
            "        cfg.StrOpt('idp_sso_endpoint',",
            "                   help='Identity Provider Single-Sign-On service value, '",
            "                        'required in the Identity Provider\\'s metadata. '",
            "                        'A value is required to generate IDP Metadata. '",
            "                        'For example: https://keystone.example.com/v3/'",
            "                        'OS-FEDERATION/saml2/sso'),",
            "        cfg.StrOpt('idp_lang', default='en',",
            "                   help='Language used by the organization.'),",
            "        cfg.StrOpt('idp_organization_name',",
            "                   help='Organization name the installation belongs to.'),",
            "        cfg.StrOpt('idp_organization_display_name',",
            "                   help='Organization name to be displayed.'),",
            "        cfg.StrOpt('idp_organization_url',",
            "                   help='URL of the organization.'),",
            "        cfg.StrOpt('idp_contact_company',",
            "                   help='Company of contact person.'),",
            "        cfg.StrOpt('idp_contact_name',",
            "                   help='Given name of contact person'),",
            "        cfg.StrOpt('idp_contact_surname',",
            "                   help='Surname of contact person.'),",
            "        cfg.StrOpt('idp_contact_email',",
            "                   help='Email address of contact person.'),",
            "        cfg.StrOpt('idp_contact_telephone',",
            "                   help='Telephone number of contact person.'),",
            "        cfg.StrOpt('idp_contact_type', default='other',",
            "                   help='Contact type. Allowed values are: '",
            "                        'technical, support, administrative '",
            "                        'billing, and other'),",
            "        cfg.StrOpt('idp_metadata_path',",
            "                   default='/etc/keystone/saml2_idp_metadata.xml',",
            "                   help='Path to the Identity Provider Metadata file. '",
            "                        'This file should be generated with the '",
            "                        'keystone-manage saml_idp_metadata command.'),",
            "    ],",
            "}",
            "",
            "",
            "CONF = cfg.CONF",
            "messaging.set_transport_defaults(control_exchange='keystone')",
            "",
            "",
            "def _register_auth_plugin_opt(conf, option):",
            "    conf.register_opt(option, group='auth')",
            "",
            "",
            "def setup_authentication(conf=None):",
            "    # register any non-default auth methods here (used by extensions, etc)",
            "    if conf is None:",
            "        conf = CONF",
            "    for method_name in conf.auth.methods:",
            "        if method_name not in _DEFAULT_AUTH_METHODS:",
            "            option = cfg.StrOpt(method_name)",
            "            _register_auth_plugin_opt(conf, option)",
            "",
            "",
            "def configure(conf=None):",
            "    if conf is None:",
            "        conf = CONF",
            "",
            "    conf.register_cli_opt(",
            "        cfg.BoolOpt('standard-threads', default=False,",
            "                    help='Do not monkey-patch threading system modules.'))",
            "    conf.register_cli_opt(",
            "        cfg.StrOpt('pydev-debug-host',",
            "                   help='Host to connect to for remote debugger.'))",
            "    conf.register_cli_opt(",
            "        cfg.IntOpt('pydev-debug-port',",
            "                   help='Port to connect to for remote debugger.'))",
            "",
            "    for section in FILE_OPTIONS:",
            "        for option in FILE_OPTIONS[section]:",
            "            if section:",
            "                conf.register_opt(option, group=section)",
            "            else:",
            "                conf.register_opt(option)",
            "",
            "    # register any non-default auth methods here (used by extensions, etc)",
            "    setup_authentication(conf)",
            "",
            "",
            "def list_opts():",
            "    \"\"\"Return a list of oslo.config options available in Keystone.",
            "",
            "    The returned list includes all oslo.config options which are registered as",
            "    the \"FILE_OPTIONS\" in keystone.common.config. This list will not include",
            "    the options from the oslo-incubator library or any options registered",
            "    dynamically at run time.",
            "",
            "    Each object in the list is a two element tuple. The first element of",
            "    each tuple is the name of the group under which the list of options in the",
            "    second element will be registered. A group name of None corresponds to the",
            "    [DEFAULT] group in config files.",
            "",
            "    This function is also discoverable via the 'oslo.config.opts' entry point",
            "    under the 'keystone.config.opts' namespace.",
            "",
            "    The purpose of this is to allow tools like the Oslo sample config file",
            "    generator to discover the options exposed to users by this library.",
            "",
            "    :returns: a list of (group_name, opts) tuples",
            "    \"\"\"",
            "    return FILE_OPTIONS.items()"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {},
        "addLocation": []
    },
    "keystone/common/utils.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 526,
                "afterPatchRowNumber": 526,
                "PatchRowcode": "             raise EnvironmentError(\"makedirs('%s'): %s\" % (path, exc.strerror))"
            },
            "1": {
                "beforePatchRowNumber": 527,
                "afterPatchRowNumber": 527,
                "PatchRowcode": " "
            },
            "2": {
                "beforePatchRowNumber": 528,
                "afterPatchRowNumber": 528,
                "PatchRowcode": "     set_permissions(path, mode, user, group, log)"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 529,
                "PatchRowcode": "+"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 530,
                "PatchRowcode": "+"
            },
            "5": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 531,
                "PatchRowcode": "+class WhiteListedItemFilter(object):"
            },
            "6": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 532,
                "PatchRowcode": "+"
            },
            "7": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 533,
                "PatchRowcode": "+    def __init__(self, whitelist, data):"
            },
            "8": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 534,
                "PatchRowcode": "+        self._whitelist = set(whitelist or [])"
            },
            "9": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 535,
                "PatchRowcode": "+        self._data = data"
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 536,
                "PatchRowcode": "+"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 537,
                "PatchRowcode": "+    def __getitem__(self, name):"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 538,
                "PatchRowcode": "+        if name not in self._whitelist:"
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 539,
                "PatchRowcode": "+            raise KeyError"
            },
            "14": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 540,
                "PatchRowcode": "+        return self._data[name]"
            }
        },
        "frontPatchFile": [
            "# Copyright 2012 OpenStack Foundation",
            "# Copyright 2010 United States Government as represented by the",
            "# Administrator of the National Aeronautics and Space Administration.",
            "# Copyright 2011 - 2012 Justin Santa Barbara",
            "# All Rights Reserved.",
            "#",
            "#    Licensed under the Apache License, Version 2.0 (the \"License\"); you may",
            "#    not use this file except in compliance with the License. You may obtain",
            "#    a copy of the License at",
            "#",
            "#         http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "#    Unless required by applicable law or agreed to in writing, software",
            "#    distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
            "#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
            "#    License for the specific language governing permissions and limitations",
            "#    under the License.",
            "",
            "import calendar",
            "import collections",
            "import grp",
            "import hashlib",
            "import os",
            "import pwd",
            "",
            "from oslo.utils import strutils",
            "import passlib.hash",
            "import six",
            "from six import moves",
            "",
            "from keystone.common import config",
            "from keystone.common import environment",
            "from keystone import exception",
            "from keystone.i18n import _",
            "from keystone.openstack.common import jsonutils",
            "from keystone.openstack.common import log",
            "",
            "",
            "CONF = config.CONF",
            "",
            "LOG = log.getLogger(__name__)",
            "",
            "",
            "def flatten_dict(d, parent_key=''):",
            "    \"\"\"Flatten a nested dictionary",
            "",
            "    Converts a dictionary with nested values to a single level flat",
            "    dictionary, with dotted notation for each key.",
            "",
            "    \"\"\"",
            "    items = []",
            "    for k, v in d.items():",
            "        new_key = parent_key + '.' + k if parent_key else k",
            "        if isinstance(v, collections.MutableMapping):",
            "            items.extend(flatten_dict(v, new_key).items())",
            "        else:",
            "            items.append((new_key, v))",
            "    return dict(items)",
            "",
            "",
            "def read_cached_file(filename, cache_info, reload_func=None):",
            "    \"\"\"Read from a file if it has been modified.",
            "",
            "    :param cache_info: dictionary to hold opaque cache.",
            "    :param reload_func: optional function to be called with data when",
            "                        file is reloaded due to a modification.",
            "",
            "    :returns: data from file.",
            "",
            "    \"\"\"",
            "    mtime = os.path.getmtime(filename)",
            "    if not cache_info or mtime != cache_info.get('mtime'):",
            "        with open(filename) as fap:",
            "            cache_info['data'] = fap.read()",
            "        cache_info['mtime'] = mtime",
            "        if reload_func:",
            "            reload_func(cache_info['data'])",
            "    return cache_info['data']",
            "",
            "",
            "class SmarterEncoder(jsonutils.json.JSONEncoder):",
            "    \"\"\"Help for JSON encoding dict-like objects.\"\"\"",
            "    def default(self, obj):",
            "        if not isinstance(obj, dict) and hasattr(obj, 'iteritems'):",
            "            return dict(obj.iteritems())",
            "        return super(SmarterEncoder, self).default(obj)",
            "",
            "",
            "def verify_length_and_trunc_password(password):",
            "    \"\"\"Verify and truncate the provided password to the max_password_length.\"\"\"",
            "    max_length = CONF.identity.max_password_length",
            "    try:",
            "        if len(password) > max_length:",
            "            if CONF.strict_password_check:",
            "                raise exception.PasswordVerificationError(size=max_length)",
            "            else:",
            "                LOG.warning(",
            "                    _('Truncating user password to '",
            "                      '%d characters.'), max_length)",
            "                return password[:max_length]",
            "        else:",
            "            return password",
            "    except TypeError:",
            "        raise exception.ValidationError(attribute='string', target='password')",
            "",
            "",
            "def hash_access_key(access):",
            "    hash_ = hashlib.sha256()",
            "    hash_.update(access)",
            "    return hash_.hexdigest()",
            "",
            "",
            "def hash_user_password(user):",
            "    \"\"\"Hash a user dict's password without modifying the passed-in dict.\"\"\"",
            "    password = user.get('password')",
            "    if password is None:",
            "        return user",
            "",
            "    return dict(user, password=hash_password(password))",
            "",
            "",
            "def hash_password(password):",
            "    \"\"\"Hash a password. Hard.\"\"\"",
            "    password_utf8 = verify_length_and_trunc_password(password).encode('utf-8')",
            "    return passlib.hash.sha512_crypt.encrypt(",
            "        password_utf8, rounds=CONF.crypt_strength)",
            "",
            "",
            "def check_password(password, hashed):",
            "    \"\"\"Check that a plaintext password matches hashed.",
            "",
            "    hashpw returns the salt value concatenated with the actual hash value.",
            "    It extracts the actual salt if this value is then passed as the salt.",
            "",
            "    \"\"\"",
            "    if password is None or hashed is None:",
            "        return False",
            "    password_utf8 = verify_length_and_trunc_password(password).encode('utf-8')",
            "    return passlib.hash.sha512_crypt.verify(password_utf8, hashed)",
            "",
            "",
            "def attr_as_boolean(val_attr):",
            "    \"\"\"Returns the boolean value, decoded from a string.",
            "",
            "    We test explicitly for a value meaning False, which can be one of",
            "    several formats as specified in oslo strutils.FALSE_STRINGS.",
            "    All other string values (including an empty string) are treated as",
            "    meaning True.",
            "",
            "    \"\"\"",
            "    return strutils.bool_from_string(val_attr, default=True)",
            "",
            "",
            "# From python 2.7",
            "def check_output(*popenargs, **kwargs):",
            "    r\"\"\"Run command with arguments and return its output as a byte string.",
            "",
            "    If the exit code was non-zero it raises a CalledProcessError.  The",
            "    CalledProcessError object will have the return code in the returncode",
            "    attribute and output in the output attribute.",
            "",
            "    The arguments are the same as for the Popen constructor.  Example:",
            "",
            "    >>> check_output(['ls', '-l', '/dev/null'])",
            "    'crw-rw-rw- 1 root root 1, 3 Oct 18  2007 /dev/null\\n'",
            "",
            "    The stdout argument is not allowed as it is used internally.",
            "    To capture standard error in the result, use stderr=STDOUT.",
            "",
            "    >>> import sys",
            "    >>> check_output(['/bin/sh', '-c',",
            "    ...               'ls -l non_existent_file ; exit 0'],",
            "    ...              stderr=sys.STDOUT)",
            "    'ls: non_existent_file: No such file or directory\\n'",
            "    \"\"\"",
            "    if 'stdout' in kwargs:",
            "        raise ValueError('stdout argument not allowed, it will be overridden.')",
            "    LOG.debug(' '.join(popenargs[0]))",
            "    process = environment.subprocess.Popen(stdout=environment.subprocess.PIPE,",
            "                                           *popenargs, **kwargs)",
            "    output, unused_err = process.communicate()",
            "    retcode = process.poll()",
            "    if retcode:",
            "        cmd = kwargs.get('args')",
            "        if cmd is None:",
            "            cmd = popenargs[0]",
            "        raise environment.subprocess.CalledProcessError(retcode, cmd)",
            "    return output",
            "",
            "",
            "def get_blob_from_credential(credential):",
            "    try:",
            "        blob = jsonutils.loads(credential.blob)",
            "    except (ValueError, TypeError):",
            "        raise exception.ValidationError(",
            "            message=_('Invalid blob in credential'))",
            "    if not blob or not isinstance(blob, dict):",
            "        raise exception.ValidationError(attribute='blob',",
            "                                        target='credential')",
            "    return blob",
            "",
            "",
            "def convert_ec2_to_v3_credential(ec2credential):",
            "    blob = {'access': ec2credential.access,",
            "            'secret': ec2credential.secret}",
            "    return {'id': hash_access_key(ec2credential.access),",
            "            'user_id': ec2credential.user_id,",
            "            'project_id': ec2credential.tenant_id,",
            "            'blob': jsonutils.dumps(blob),",
            "            'type': 'ec2',",
            "            'extra': jsonutils.dumps({})}",
            "",
            "",
            "def convert_v3_to_ec2_credential(credential):",
            "    blob = get_blob_from_credential(credential)",
            "    return {'access': blob.get('access'),",
            "            'secret': blob.get('secret'),",
            "            'user_id': credential.user_id,",
            "            'tenant_id': credential.project_id,",
            "            }",
            "",
            "",
            "def git(*args):",
            "    return check_output(['git'] + list(args))",
            "",
            "",
            "def unixtime(dt_obj):",
            "    \"\"\"Format datetime object as unix timestamp",
            "",
            "    :param dt_obj: datetime.datetime object",
            "    :returns: float",
            "",
            "    \"\"\"",
            "    return calendar.timegm(dt_obj.utctimetuple())",
            "",
            "",
            "def auth_str_equal(provided, known):",
            "    \"\"\"Constant-time string comparison.",
            "",
            "    :params provided: the first string",
            "    :params known: the second string",
            "",
            "    :return: True if the strings are equal.",
            "",
            "    This function takes two strings and compares them.  It is intended to be",
            "    used when doing a comparison for authentication purposes to help guard",
            "    against timing attacks.  When using the function for this purpose, always",
            "    provide the user-provided password as the first argument.  The time this",
            "    function will take is always a factor of the length of this string.",
            "    \"\"\"",
            "    result = 0",
            "    p_len = len(provided)",
            "    k_len = len(known)",
            "    for i in moves.range(p_len):",
            "        a = ord(provided[i]) if i < p_len else 0",
            "        b = ord(known[i]) if i < k_len else 0",
            "        result |= a ^ b",
            "    return (p_len == k_len) & (result == 0)",
            "",
            "",
            "def setup_remote_pydev_debug():",
            "    if CONF.pydev_debug_host and CONF.pydev_debug_port:",
            "        try:",
            "            try:",
            "                from pydev import pydevd",
            "            except ImportError:",
            "                import pydevd",
            "",
            "            pydevd.settrace(CONF.pydev_debug_host,",
            "                            port=CONF.pydev_debug_port,",
            "                            stdoutToServer=True,",
            "                            stderrToServer=True)",
            "            return True",
            "        except Exception:",
            "            LOG.exception(_(",
            "                'Error setting up the debug environment. Verify that the '",
            "                'option --debug-url has the format <host>:<port> and that a '",
            "                'debugger processes is listening on that port.'))",
            "            raise",
            "",
            "",
            "class LimitingReader(object):",
            "    \"\"\"Reader to limit the size of an incoming request.\"\"\"",
            "    def __init__(self, data, limit):",
            "        \"\"\"Create an iterator on the underlying data.",
            "",
            "        :param data: Underlying data object",
            "        :param limit: maximum number of bytes the reader should allow",
            "        \"\"\"",
            "        self.data = data",
            "        self.limit = limit",
            "        self.bytes_read = 0",
            "",
            "    def __iter__(self):",
            "        for chunk in self.data:",
            "            self.bytes_read += len(chunk)",
            "            if self.bytes_read > self.limit:",
            "                raise exception.RequestTooLarge()",
            "            else:",
            "                yield chunk",
            "",
            "    def read(self, i=None):",
            "        # NOTE(jamielennox): We can't simply provide the default to the read()",
            "        # call as the expected default differs between mod_wsgi and eventlet",
            "        if i is None:",
            "            result = self.data.read()",
            "        else:",
            "            result = self.data.read(i)",
            "        self.bytes_read += len(result)",
            "        if self.bytes_read > self.limit:",
            "            raise exception.RequestTooLarge()",
            "        return result",
            "",
            "",
            "def get_unix_user(user=None):",
            "    '''Get the uid and user name.",
            "",
            "    This is a convenience utility which accepts a variety of input",
            "    which might represent a unix user. If successful it returns the uid",
            "    and name. Valid input is:",
            "",
            "    string",
            "        A string is first considered to be a user name and a lookup is",
            "        attempted under that name. If no name is found then an attempt",
            "        is made to convert the string to an integer and perform a",
            "        lookup as a uid.",
            "",
            "    int",
            "        An integer is interpretted as a uid.",
            "",
            "    None",
            "        None is interpreted to mean use the current process's",
            "        effective user.",
            "",
            "    If the input is a valid type but no user is found a KeyError is",
            "    raised. If the input is not a valid type a TypeError is raised.",
            "",
            "    :param object user: string, int or None specifying the user to",
            "                        lookup.",
            "",
            "    :return: tuple of (uid, name)",
            "    '''",
            "",
            "    if isinstance(user, six.string_types):",
            "        try:",
            "            user_info = pwd.getpwnam(user)",
            "        except KeyError:",
            "            try:",
            "                i = int(user)",
            "            except ValueError:",
            "                raise KeyError(\"user name '%s' not found\" % user)",
            "            try:",
            "                user_info = pwd.getpwuid(i)",
            "            except KeyError:",
            "                raise KeyError(\"user id %d not found\" % i)",
            "    elif isinstance(user, int):",
            "        try:",
            "            user_info = pwd.getpwuid(user)",
            "        except KeyError:",
            "            raise KeyError(\"user id %d not found\" % user)",
            "    elif user is None:",
            "        user_info = pwd.getpwuid(os.geteuid())",
            "    else:",
            "        raise TypeError('user must be string, int or None; not %s (%r)' %",
            "                        (user.__class__.__name__, user))",
            "",
            "    return user_info.pw_uid, user_info.pw_name",
            "",
            "",
            "def get_unix_group(group=None):",
            "    '''Get the gid and group name.",
            "",
            "    This is a convenience utility which accepts a variety of input",
            "    which might represent a unix group. If successful it returns the gid",
            "    and name. Valid input is:",
            "",
            "    string",
            "        A string is first considered to be a group name and a lookup is",
            "        attempted under that name. If no name is found then an attempt",
            "        is made to convert the string to an integer and perform a",
            "        lookup as a gid.",
            "",
            "    int",
            "        An integer is interpretted as a gid.",
            "",
            "    None",
            "        None is interpreted to mean use the current process's",
            "        effective group.",
            "",
            "    If the input is a valid type but no group is found a KeyError is",
            "    raised. If the input is not a valid type a TypeError is raised.",
            "",
            "",
            "    :param object group: string, int or None specifying the group to",
            "                         lookup.",
            "",
            "    :return: tuple of (gid, name)",
            "    '''",
            "",
            "    if isinstance(group, six.string_types):",
            "        try:",
            "            group_info = grp.getgrnam(group)",
            "        except KeyError:",
            "            # Was an int passed as a string?",
            "            # Try converting to int and lookup by id instead.",
            "            try:",
            "                i = int(group)",
            "            except ValueError:",
            "                raise KeyError(\"group name '%s' not found\" % group)",
            "            try:",
            "                group_info = grp.getgrgid(i)",
            "            except KeyError:",
            "                raise KeyError(\"group id %d not found\" % i)",
            "    elif isinstance(group, int):",
            "        try:",
            "            group_info = grp.getgrgid(group)",
            "        except KeyError:",
            "            raise KeyError(\"group id %d not found\" % group)",
            "    elif group is None:",
            "        group_info = grp.getgrgid(os.getegid())",
            "    else:",
            "        raise TypeError('group must be string, int or None; not %s (%r)' %",
            "                        (group.__class__.__name__, group))",
            "",
            "    return group_info.gr_gid, group_info.gr_name",
            "",
            "",
            "def set_permissions(path, mode=None, user=None, group=None, log=None):",
            "    '''Set the ownership and permissions on the pathname.",
            "",
            "    Each of the mode, user and group are optional, if None then",
            "    that aspect is not modified.",
            "",
            "    Owner and group may be specified either with a symbolic name",
            "    or numeric id.",
            "",
            "    :param string path: Pathname of directory whose existence is assured.",
            "    :param object mode: ownership permissions flags (int) i.e. chmod,",
            "                        if None do not set.",
            "    :param object user: set user, name (string) or uid (integer),",
            "                         if None do not set.",
            "    :param object group: set group, name (string) or gid (integer)",
            "                         if None do not set.",
            "    :param logger log: logging.logger object, used to emit log messages,",
            "                       if None no logging is performed.",
            "    '''",
            "",
            "    if user is None:",
            "        user_uid, user_name = None, None",
            "    else:",
            "        user_uid, user_name = get_unix_user(user)",
            "",
            "    if group is None:",
            "        group_gid, group_name = None, None",
            "    else:",
            "        group_gid, group_name = get_unix_group(group)",
            "",
            "    if log:",
            "        if mode is None:",
            "            mode_string = str(mode)",
            "        else:",
            "            mode_string = oct(mode)",
            "        log.debug(\"set_permissions: \"",
            "                  \"path='%s' mode=%s user=%s(%s) group=%s(%s)\",",
            "                  path, mode_string,",
            "                  user_name, user_uid, group_name, group_gid)",
            "",
            "    # Change user and group if specified",
            "    if user_uid is not None or group_gid is not None:",
            "        if user_uid is None:",
            "            user_uid = -1",
            "        if group_gid is None:",
            "            group_gid = -1",
            "        try:",
            "            os.chown(path, user_uid, group_gid)",
            "        except OSError as exc:",
            "            raise EnvironmentError(\"chown('%s', %s, %s): %s\" %",
            "                                   (path,",
            "                                    user_name, group_name,",
            "                                    exc.strerror))",
            "",
            "    # Change permission flags",
            "    if mode is not None:",
            "        try:",
            "            os.chmod(path, mode)",
            "        except OSError as exc:",
            "            raise EnvironmentError(\"chmod('%s', %#o): %s\" %",
            "                                   (path, mode, exc.strerror))",
            "",
            "",
            "def make_dirs(path, mode=None, user=None, group=None, log=None):",
            "    '''Assure directory exists, set ownership and permissions.",
            "",
            "    Assure the directory exists and optionally set it's ownership",
            "    and permissions.",
            "",
            "    Each of the mode, user and group are optional, if None then",
            "    that aspect is not modified.",
            "",
            "    Owner and group may be specified either with a symbolic name",
            "    or numeric id.",
            "",
            "    :param string path: Pathname of directory whose existence is assured.",
            "    :param object mode: ownership permissions flags (int) i.e. chmod,",
            "                        if None do not set.",
            "    :param object user: set user, name (string) or uid (integer),",
            "                        if None do not set.",
            "    :param object group: set group, name (string) or gid (integer)",
            "                         if None do not set.",
            "    :param logger log: logging.logger object, used to emit log messages,",
            "                       if None no logging is performed.",
            "    '''",
            "",
            "    if log:",
            "        if mode is None:",
            "            mode_string = str(mode)",
            "        else:",
            "            mode_string = oct(mode)",
            "        log.debug(\"make_dirs path='%s' mode=%s user=%s group=%s\",",
            "                  path, mode_string, user, group)",
            "",
            "    if not os.path.exists(path):",
            "        try:",
            "            os.makedirs(path)",
            "        except OSError as exc:",
            "            raise EnvironmentError(\"makedirs('%s'): %s\" % (path, exc.strerror))",
            "",
            "    set_permissions(path, mode, user, group, log)"
        ],
        "afterPatchFile": [
            "# Copyright 2012 OpenStack Foundation",
            "# Copyright 2010 United States Government as represented by the",
            "# Administrator of the National Aeronautics and Space Administration.",
            "# Copyright 2011 - 2012 Justin Santa Barbara",
            "# All Rights Reserved.",
            "#",
            "#    Licensed under the Apache License, Version 2.0 (the \"License\"); you may",
            "#    not use this file except in compliance with the License. You may obtain",
            "#    a copy of the License at",
            "#",
            "#         http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "#    Unless required by applicable law or agreed to in writing, software",
            "#    distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
            "#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
            "#    License for the specific language governing permissions and limitations",
            "#    under the License.",
            "",
            "import calendar",
            "import collections",
            "import grp",
            "import hashlib",
            "import os",
            "import pwd",
            "",
            "from oslo.utils import strutils",
            "import passlib.hash",
            "import six",
            "from six import moves",
            "",
            "from keystone.common import config",
            "from keystone.common import environment",
            "from keystone import exception",
            "from keystone.i18n import _",
            "from keystone.openstack.common import jsonutils",
            "from keystone.openstack.common import log",
            "",
            "",
            "CONF = config.CONF",
            "",
            "LOG = log.getLogger(__name__)",
            "",
            "",
            "def flatten_dict(d, parent_key=''):",
            "    \"\"\"Flatten a nested dictionary",
            "",
            "    Converts a dictionary with nested values to a single level flat",
            "    dictionary, with dotted notation for each key.",
            "",
            "    \"\"\"",
            "    items = []",
            "    for k, v in d.items():",
            "        new_key = parent_key + '.' + k if parent_key else k",
            "        if isinstance(v, collections.MutableMapping):",
            "            items.extend(flatten_dict(v, new_key).items())",
            "        else:",
            "            items.append((new_key, v))",
            "    return dict(items)",
            "",
            "",
            "def read_cached_file(filename, cache_info, reload_func=None):",
            "    \"\"\"Read from a file if it has been modified.",
            "",
            "    :param cache_info: dictionary to hold opaque cache.",
            "    :param reload_func: optional function to be called with data when",
            "                        file is reloaded due to a modification.",
            "",
            "    :returns: data from file.",
            "",
            "    \"\"\"",
            "    mtime = os.path.getmtime(filename)",
            "    if not cache_info or mtime != cache_info.get('mtime'):",
            "        with open(filename) as fap:",
            "            cache_info['data'] = fap.read()",
            "        cache_info['mtime'] = mtime",
            "        if reload_func:",
            "            reload_func(cache_info['data'])",
            "    return cache_info['data']",
            "",
            "",
            "class SmarterEncoder(jsonutils.json.JSONEncoder):",
            "    \"\"\"Help for JSON encoding dict-like objects.\"\"\"",
            "    def default(self, obj):",
            "        if not isinstance(obj, dict) and hasattr(obj, 'iteritems'):",
            "            return dict(obj.iteritems())",
            "        return super(SmarterEncoder, self).default(obj)",
            "",
            "",
            "def verify_length_and_trunc_password(password):",
            "    \"\"\"Verify and truncate the provided password to the max_password_length.\"\"\"",
            "    max_length = CONF.identity.max_password_length",
            "    try:",
            "        if len(password) > max_length:",
            "            if CONF.strict_password_check:",
            "                raise exception.PasswordVerificationError(size=max_length)",
            "            else:",
            "                LOG.warning(",
            "                    _('Truncating user password to '",
            "                      '%d characters.'), max_length)",
            "                return password[:max_length]",
            "        else:",
            "            return password",
            "    except TypeError:",
            "        raise exception.ValidationError(attribute='string', target='password')",
            "",
            "",
            "def hash_access_key(access):",
            "    hash_ = hashlib.sha256()",
            "    hash_.update(access)",
            "    return hash_.hexdigest()",
            "",
            "",
            "def hash_user_password(user):",
            "    \"\"\"Hash a user dict's password without modifying the passed-in dict.\"\"\"",
            "    password = user.get('password')",
            "    if password is None:",
            "        return user",
            "",
            "    return dict(user, password=hash_password(password))",
            "",
            "",
            "def hash_password(password):",
            "    \"\"\"Hash a password. Hard.\"\"\"",
            "    password_utf8 = verify_length_and_trunc_password(password).encode('utf-8')",
            "    return passlib.hash.sha512_crypt.encrypt(",
            "        password_utf8, rounds=CONF.crypt_strength)",
            "",
            "",
            "def check_password(password, hashed):",
            "    \"\"\"Check that a plaintext password matches hashed.",
            "",
            "    hashpw returns the salt value concatenated with the actual hash value.",
            "    It extracts the actual salt if this value is then passed as the salt.",
            "",
            "    \"\"\"",
            "    if password is None or hashed is None:",
            "        return False",
            "    password_utf8 = verify_length_and_trunc_password(password).encode('utf-8')",
            "    return passlib.hash.sha512_crypt.verify(password_utf8, hashed)",
            "",
            "",
            "def attr_as_boolean(val_attr):",
            "    \"\"\"Returns the boolean value, decoded from a string.",
            "",
            "    We test explicitly for a value meaning False, which can be one of",
            "    several formats as specified in oslo strutils.FALSE_STRINGS.",
            "    All other string values (including an empty string) are treated as",
            "    meaning True.",
            "",
            "    \"\"\"",
            "    return strutils.bool_from_string(val_attr, default=True)",
            "",
            "",
            "# From python 2.7",
            "def check_output(*popenargs, **kwargs):",
            "    r\"\"\"Run command with arguments and return its output as a byte string.",
            "",
            "    If the exit code was non-zero it raises a CalledProcessError.  The",
            "    CalledProcessError object will have the return code in the returncode",
            "    attribute and output in the output attribute.",
            "",
            "    The arguments are the same as for the Popen constructor.  Example:",
            "",
            "    >>> check_output(['ls', '-l', '/dev/null'])",
            "    'crw-rw-rw- 1 root root 1, 3 Oct 18  2007 /dev/null\\n'",
            "",
            "    The stdout argument is not allowed as it is used internally.",
            "    To capture standard error in the result, use stderr=STDOUT.",
            "",
            "    >>> import sys",
            "    >>> check_output(['/bin/sh', '-c',",
            "    ...               'ls -l non_existent_file ; exit 0'],",
            "    ...              stderr=sys.STDOUT)",
            "    'ls: non_existent_file: No such file or directory\\n'",
            "    \"\"\"",
            "    if 'stdout' in kwargs:",
            "        raise ValueError('stdout argument not allowed, it will be overridden.')",
            "    LOG.debug(' '.join(popenargs[0]))",
            "    process = environment.subprocess.Popen(stdout=environment.subprocess.PIPE,",
            "                                           *popenargs, **kwargs)",
            "    output, unused_err = process.communicate()",
            "    retcode = process.poll()",
            "    if retcode:",
            "        cmd = kwargs.get('args')",
            "        if cmd is None:",
            "            cmd = popenargs[0]",
            "        raise environment.subprocess.CalledProcessError(retcode, cmd)",
            "    return output",
            "",
            "",
            "def get_blob_from_credential(credential):",
            "    try:",
            "        blob = jsonutils.loads(credential.blob)",
            "    except (ValueError, TypeError):",
            "        raise exception.ValidationError(",
            "            message=_('Invalid blob in credential'))",
            "    if not blob or not isinstance(blob, dict):",
            "        raise exception.ValidationError(attribute='blob',",
            "                                        target='credential')",
            "    return blob",
            "",
            "",
            "def convert_ec2_to_v3_credential(ec2credential):",
            "    blob = {'access': ec2credential.access,",
            "            'secret': ec2credential.secret}",
            "    return {'id': hash_access_key(ec2credential.access),",
            "            'user_id': ec2credential.user_id,",
            "            'project_id': ec2credential.tenant_id,",
            "            'blob': jsonutils.dumps(blob),",
            "            'type': 'ec2',",
            "            'extra': jsonutils.dumps({})}",
            "",
            "",
            "def convert_v3_to_ec2_credential(credential):",
            "    blob = get_blob_from_credential(credential)",
            "    return {'access': blob.get('access'),",
            "            'secret': blob.get('secret'),",
            "            'user_id': credential.user_id,",
            "            'tenant_id': credential.project_id,",
            "            }",
            "",
            "",
            "def git(*args):",
            "    return check_output(['git'] + list(args))",
            "",
            "",
            "def unixtime(dt_obj):",
            "    \"\"\"Format datetime object as unix timestamp",
            "",
            "    :param dt_obj: datetime.datetime object",
            "    :returns: float",
            "",
            "    \"\"\"",
            "    return calendar.timegm(dt_obj.utctimetuple())",
            "",
            "",
            "def auth_str_equal(provided, known):",
            "    \"\"\"Constant-time string comparison.",
            "",
            "    :params provided: the first string",
            "    :params known: the second string",
            "",
            "    :return: True if the strings are equal.",
            "",
            "    This function takes two strings and compares them.  It is intended to be",
            "    used when doing a comparison for authentication purposes to help guard",
            "    against timing attacks.  When using the function for this purpose, always",
            "    provide the user-provided password as the first argument.  The time this",
            "    function will take is always a factor of the length of this string.",
            "    \"\"\"",
            "    result = 0",
            "    p_len = len(provided)",
            "    k_len = len(known)",
            "    for i in moves.range(p_len):",
            "        a = ord(provided[i]) if i < p_len else 0",
            "        b = ord(known[i]) if i < k_len else 0",
            "        result |= a ^ b",
            "    return (p_len == k_len) & (result == 0)",
            "",
            "",
            "def setup_remote_pydev_debug():",
            "    if CONF.pydev_debug_host and CONF.pydev_debug_port:",
            "        try:",
            "            try:",
            "                from pydev import pydevd",
            "            except ImportError:",
            "                import pydevd",
            "",
            "            pydevd.settrace(CONF.pydev_debug_host,",
            "                            port=CONF.pydev_debug_port,",
            "                            stdoutToServer=True,",
            "                            stderrToServer=True)",
            "            return True",
            "        except Exception:",
            "            LOG.exception(_(",
            "                'Error setting up the debug environment. Verify that the '",
            "                'option --debug-url has the format <host>:<port> and that a '",
            "                'debugger processes is listening on that port.'))",
            "            raise",
            "",
            "",
            "class LimitingReader(object):",
            "    \"\"\"Reader to limit the size of an incoming request.\"\"\"",
            "    def __init__(self, data, limit):",
            "        \"\"\"Create an iterator on the underlying data.",
            "",
            "        :param data: Underlying data object",
            "        :param limit: maximum number of bytes the reader should allow",
            "        \"\"\"",
            "        self.data = data",
            "        self.limit = limit",
            "        self.bytes_read = 0",
            "",
            "    def __iter__(self):",
            "        for chunk in self.data:",
            "            self.bytes_read += len(chunk)",
            "            if self.bytes_read > self.limit:",
            "                raise exception.RequestTooLarge()",
            "            else:",
            "                yield chunk",
            "",
            "    def read(self, i=None):",
            "        # NOTE(jamielennox): We can't simply provide the default to the read()",
            "        # call as the expected default differs between mod_wsgi and eventlet",
            "        if i is None:",
            "            result = self.data.read()",
            "        else:",
            "            result = self.data.read(i)",
            "        self.bytes_read += len(result)",
            "        if self.bytes_read > self.limit:",
            "            raise exception.RequestTooLarge()",
            "        return result",
            "",
            "",
            "def get_unix_user(user=None):",
            "    '''Get the uid and user name.",
            "",
            "    This is a convenience utility which accepts a variety of input",
            "    which might represent a unix user. If successful it returns the uid",
            "    and name. Valid input is:",
            "",
            "    string",
            "        A string is first considered to be a user name and a lookup is",
            "        attempted under that name. If no name is found then an attempt",
            "        is made to convert the string to an integer and perform a",
            "        lookup as a uid.",
            "",
            "    int",
            "        An integer is interpretted as a uid.",
            "",
            "    None",
            "        None is interpreted to mean use the current process's",
            "        effective user.",
            "",
            "    If the input is a valid type but no user is found a KeyError is",
            "    raised. If the input is not a valid type a TypeError is raised.",
            "",
            "    :param object user: string, int or None specifying the user to",
            "                        lookup.",
            "",
            "    :return: tuple of (uid, name)",
            "    '''",
            "",
            "    if isinstance(user, six.string_types):",
            "        try:",
            "            user_info = pwd.getpwnam(user)",
            "        except KeyError:",
            "            try:",
            "                i = int(user)",
            "            except ValueError:",
            "                raise KeyError(\"user name '%s' not found\" % user)",
            "            try:",
            "                user_info = pwd.getpwuid(i)",
            "            except KeyError:",
            "                raise KeyError(\"user id %d not found\" % i)",
            "    elif isinstance(user, int):",
            "        try:",
            "            user_info = pwd.getpwuid(user)",
            "        except KeyError:",
            "            raise KeyError(\"user id %d not found\" % user)",
            "    elif user is None:",
            "        user_info = pwd.getpwuid(os.geteuid())",
            "    else:",
            "        raise TypeError('user must be string, int or None; not %s (%r)' %",
            "                        (user.__class__.__name__, user))",
            "",
            "    return user_info.pw_uid, user_info.pw_name",
            "",
            "",
            "def get_unix_group(group=None):",
            "    '''Get the gid and group name.",
            "",
            "    This is a convenience utility which accepts a variety of input",
            "    which might represent a unix group. If successful it returns the gid",
            "    and name. Valid input is:",
            "",
            "    string",
            "        A string is first considered to be a group name and a lookup is",
            "        attempted under that name. If no name is found then an attempt",
            "        is made to convert the string to an integer and perform a",
            "        lookup as a gid.",
            "",
            "    int",
            "        An integer is interpretted as a gid.",
            "",
            "    None",
            "        None is interpreted to mean use the current process's",
            "        effective group.",
            "",
            "    If the input is a valid type but no group is found a KeyError is",
            "    raised. If the input is not a valid type a TypeError is raised.",
            "",
            "",
            "    :param object group: string, int or None specifying the group to",
            "                         lookup.",
            "",
            "    :return: tuple of (gid, name)",
            "    '''",
            "",
            "    if isinstance(group, six.string_types):",
            "        try:",
            "            group_info = grp.getgrnam(group)",
            "        except KeyError:",
            "            # Was an int passed as a string?",
            "            # Try converting to int and lookup by id instead.",
            "            try:",
            "                i = int(group)",
            "            except ValueError:",
            "                raise KeyError(\"group name '%s' not found\" % group)",
            "            try:",
            "                group_info = grp.getgrgid(i)",
            "            except KeyError:",
            "                raise KeyError(\"group id %d not found\" % i)",
            "    elif isinstance(group, int):",
            "        try:",
            "            group_info = grp.getgrgid(group)",
            "        except KeyError:",
            "            raise KeyError(\"group id %d not found\" % group)",
            "    elif group is None:",
            "        group_info = grp.getgrgid(os.getegid())",
            "    else:",
            "        raise TypeError('group must be string, int or None; not %s (%r)' %",
            "                        (group.__class__.__name__, group))",
            "",
            "    return group_info.gr_gid, group_info.gr_name",
            "",
            "",
            "def set_permissions(path, mode=None, user=None, group=None, log=None):",
            "    '''Set the ownership and permissions on the pathname.",
            "",
            "    Each of the mode, user and group are optional, if None then",
            "    that aspect is not modified.",
            "",
            "    Owner and group may be specified either with a symbolic name",
            "    or numeric id.",
            "",
            "    :param string path: Pathname of directory whose existence is assured.",
            "    :param object mode: ownership permissions flags (int) i.e. chmod,",
            "                        if None do not set.",
            "    :param object user: set user, name (string) or uid (integer),",
            "                         if None do not set.",
            "    :param object group: set group, name (string) or gid (integer)",
            "                         if None do not set.",
            "    :param logger log: logging.logger object, used to emit log messages,",
            "                       if None no logging is performed.",
            "    '''",
            "",
            "    if user is None:",
            "        user_uid, user_name = None, None",
            "    else:",
            "        user_uid, user_name = get_unix_user(user)",
            "",
            "    if group is None:",
            "        group_gid, group_name = None, None",
            "    else:",
            "        group_gid, group_name = get_unix_group(group)",
            "",
            "    if log:",
            "        if mode is None:",
            "            mode_string = str(mode)",
            "        else:",
            "            mode_string = oct(mode)",
            "        log.debug(\"set_permissions: \"",
            "                  \"path='%s' mode=%s user=%s(%s) group=%s(%s)\",",
            "                  path, mode_string,",
            "                  user_name, user_uid, group_name, group_gid)",
            "",
            "    # Change user and group if specified",
            "    if user_uid is not None or group_gid is not None:",
            "        if user_uid is None:",
            "            user_uid = -1",
            "        if group_gid is None:",
            "            group_gid = -1",
            "        try:",
            "            os.chown(path, user_uid, group_gid)",
            "        except OSError as exc:",
            "            raise EnvironmentError(\"chown('%s', %s, %s): %s\" %",
            "                                   (path,",
            "                                    user_name, group_name,",
            "                                    exc.strerror))",
            "",
            "    # Change permission flags",
            "    if mode is not None:",
            "        try:",
            "            os.chmod(path, mode)",
            "        except OSError as exc:",
            "            raise EnvironmentError(\"chmod('%s', %#o): %s\" %",
            "                                   (path, mode, exc.strerror))",
            "",
            "",
            "def make_dirs(path, mode=None, user=None, group=None, log=None):",
            "    '''Assure directory exists, set ownership and permissions.",
            "",
            "    Assure the directory exists and optionally set it's ownership",
            "    and permissions.",
            "",
            "    Each of the mode, user and group are optional, if None then",
            "    that aspect is not modified.",
            "",
            "    Owner and group may be specified either with a symbolic name",
            "    or numeric id.",
            "",
            "    :param string path: Pathname of directory whose existence is assured.",
            "    :param object mode: ownership permissions flags (int) i.e. chmod,",
            "                        if None do not set.",
            "    :param object user: set user, name (string) or uid (integer),",
            "                        if None do not set.",
            "    :param object group: set group, name (string) or gid (integer)",
            "                         if None do not set.",
            "    :param logger log: logging.logger object, used to emit log messages,",
            "                       if None no logging is performed.",
            "    '''",
            "",
            "    if log:",
            "        if mode is None:",
            "            mode_string = str(mode)",
            "        else:",
            "            mode_string = oct(mode)",
            "        log.debug(\"make_dirs path='%s' mode=%s user=%s group=%s\",",
            "                  path, mode_string, user, group)",
            "",
            "    if not os.path.exists(path):",
            "        try:",
            "            os.makedirs(path)",
            "        except OSError as exc:",
            "            raise EnvironmentError(\"makedirs('%s'): %s\" % (path, exc.strerror))",
            "",
            "    set_permissions(path, mode, user, group, log)",
            "",
            "",
            "class WhiteListedItemFilter(object):",
            "",
            "    def __init__(self, whitelist, data):",
            "        self._whitelist = set(whitelist or [])",
            "        self._data = data",
            "",
            "    def __getitem__(self, name):",
            "        if name not in self._whitelist:",
            "            raise KeyError",
            "        return self._data[name]"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1"
        ],
        "dele_reviseLocation": {},
        "addLocation": [
            "neutron.tests.unit.plugins.ml2.drivers.openvswitch.agent.test_ovs_neutron_agent.TestOvsNeutronAgent.test_agent_type_ovs"
        ]
    },
    "keystone/tests/unit/catalog/test_core.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 10,
                "afterPatchRowNumber": 10,
                "PatchRowcode": " # License for the specific language governing permissions and limitations"
            },
            "1": {
                "beforePatchRowNumber": 11,
                "afterPatchRowNumber": 11,
                "PatchRowcode": " # under the License."
            },
            "2": {
                "beforePatchRowNumber": 12,
                "afterPatchRowNumber": 12,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 13,
                "PatchRowcode": "+from oslo.config import fixture as config_fixture"
            },
            "4": {
                "beforePatchRowNumber": 13,
                "afterPatchRowNumber": 14,
                "PatchRowcode": " import testtools"
            },
            "5": {
                "beforePatchRowNumber": 14,
                "afterPatchRowNumber": 15,
                "PatchRowcode": " "
            },
            "6": {
                "beforePatchRowNumber": 15,
                "afterPatchRowNumber": 16,
                "PatchRowcode": " from keystone.catalog import core"
            },
            "7": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 17,
                "PatchRowcode": "+from keystone import config"
            },
            "8": {
                "beforePatchRowNumber": 16,
                "afterPatchRowNumber": 18,
                "PatchRowcode": " from keystone import exception"
            },
            "9": {
                "beforePatchRowNumber": 17,
                "afterPatchRowNumber": 19,
                "PatchRowcode": " "
            },
            "10": {
                "beforePatchRowNumber": 18,
                "afterPatchRowNumber": 20,
                "PatchRowcode": " "
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 21,
                "PatchRowcode": "+CONF = config.CONF"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 22,
                "PatchRowcode": "+"
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 23,
                "PatchRowcode": "+"
            },
            "14": {
                "beforePatchRowNumber": 19,
                "afterPatchRowNumber": 24,
                "PatchRowcode": " class FormatUrlTests(testtools.TestCase):"
            },
            "15": {
                "beforePatchRowNumber": 20,
                "afterPatchRowNumber": 25,
                "PatchRowcode": " "
            },
            "16": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 26,
                "PatchRowcode": "+    def setUp(self):"
            },
            "17": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 27,
                "PatchRowcode": "+        super(FormatUrlTests, self).setUp()"
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 28,
                "PatchRowcode": "+        fixture = self.useFixture(config_fixture.Config(CONF))"
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 29,
                "PatchRowcode": "+        fixture.config("
            },
            "20": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 30,
                "PatchRowcode": "+            group='catalog',"
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 31,
                "PatchRowcode": "+            endpoint_substitution_whitelist=['host', 'port', 'part1', 'part2'])"
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 32,
                "PatchRowcode": "+"
            },
            "23": {
                "beforePatchRowNumber": 21,
                "afterPatchRowNumber": 33,
                "PatchRowcode": "     def test_successful_formatting(self):"
            },
            "24": {
                "beforePatchRowNumber": 22,
                "afterPatchRowNumber": 34,
                "PatchRowcode": "         url_template = 'http://%(host)s:%(port)d/%(part1)s/%(part2)s'"
            },
            "25": {
                "beforePatchRowNumber": 23,
                "afterPatchRowNumber": 35,
                "PatchRowcode": "         values = {'host': 'server', 'port': 9090, 'part1': 'A', 'part2': 'B'}"
            },
            "26": {
                "beforePatchRowNumber": 53,
                "afterPatchRowNumber": 65,
                "PatchRowcode": " "
            },
            "27": {
                "beforePatchRowNumber": 54,
                "afterPatchRowNumber": 66,
                "PatchRowcode": "         _test(None)"
            },
            "28": {
                "beforePatchRowNumber": 55,
                "afterPatchRowNumber": 67,
                "PatchRowcode": "         _test(object())"
            },
            "29": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 68,
                "PatchRowcode": "+"
            },
            "30": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 69,
                "PatchRowcode": "+    def test_substitution_with_key_not_whitelisted(self):"
            },
            "31": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 70,
                "PatchRowcode": "+        url_template = 'http://%(host)s:%(port)d/%(part1)s/%(part2)s/%(part3)s'"
            },
            "32": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 71,
                "PatchRowcode": "+        values = {'host': 'server', 'port': 9090,"
            },
            "33": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 72,
                "PatchRowcode": "+                  'part1': 'A', 'part2': 'B', 'part3': 'C'}"
            },
            "34": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 73,
                "PatchRowcode": "+        self.assertRaises(exception.MalformedEndpoint,"
            },
            "35": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 74,
                "PatchRowcode": "+                          core.format_url,"
            },
            "36": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 75,
                "PatchRowcode": "+                          url_template,"
            },
            "37": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 76,
                "PatchRowcode": "+                          values)"
            }
        },
        "frontPatchFile": [
            "# Licensed under the Apache License, Version 2.0 (the \"License\"); you may",
            "# not use this file except in compliance with the License. You may obtain",
            "# a copy of the License at",
            "#",
            "#      http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "# Unless required by applicable law or agreed to in writing, software",
            "# distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
            "# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
            "# License for the specific language governing permissions and limitations",
            "# under the License.",
            "",
            "import testtools",
            "",
            "from keystone.catalog import core",
            "from keystone import exception",
            "",
            "",
            "class FormatUrlTests(testtools.TestCase):",
            "",
            "    def test_successful_formatting(self):",
            "        url_template = 'http://%(host)s:%(port)d/%(part1)s/%(part2)s'",
            "        values = {'host': 'server', 'port': 9090, 'part1': 'A', 'part2': 'B'}",
            "        actual_url = core.format_url(url_template, values)",
            "",
            "        expected_url = 'http://server:9090/A/B'",
            "        self.assertEqual(actual_url, expected_url)",
            "",
            "    def test_raises_malformed_on_missing_key(self):",
            "        self.assertRaises(exception.MalformedEndpoint,",
            "                          core.format_url,",
            "                          \"http://%(foo)s/%(bar)s\",",
            "                          {\"foo\": \"1\"})",
            "",
            "    def test_raises_malformed_on_wrong_type(self):",
            "        self.assertRaises(exception.MalformedEndpoint,",
            "                          core.format_url,",
            "                          \"http://%foo%s\",",
            "                          {\"foo\": \"1\"})",
            "",
            "    def test_raises_malformed_on_incomplete_format(self):",
            "        self.assertRaises(exception.MalformedEndpoint,",
            "                          core.format_url,",
            "                          \"http://%(foo)\",",
            "                          {\"foo\": \"1\"})",
            "",
            "    def test_formatting_a_non_string(self):",
            "        def _test(url_template):",
            "            self.assertRaises(exception.MalformedEndpoint,",
            "                              core.format_url,",
            "                              url_template,",
            "                              {})",
            "",
            "        _test(None)",
            "        _test(object())"
        ],
        "afterPatchFile": [
            "# Licensed under the Apache License, Version 2.0 (the \"License\"); you may",
            "# not use this file except in compliance with the License. You may obtain",
            "# a copy of the License at",
            "#",
            "#      http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "# Unless required by applicable law or agreed to in writing, software",
            "# distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
            "# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
            "# License for the specific language governing permissions and limitations",
            "# under the License.",
            "",
            "from oslo.config import fixture as config_fixture",
            "import testtools",
            "",
            "from keystone.catalog import core",
            "from keystone import config",
            "from keystone import exception",
            "",
            "",
            "CONF = config.CONF",
            "",
            "",
            "class FormatUrlTests(testtools.TestCase):",
            "",
            "    def setUp(self):",
            "        super(FormatUrlTests, self).setUp()",
            "        fixture = self.useFixture(config_fixture.Config(CONF))",
            "        fixture.config(",
            "            group='catalog',",
            "            endpoint_substitution_whitelist=['host', 'port', 'part1', 'part2'])",
            "",
            "    def test_successful_formatting(self):",
            "        url_template = 'http://%(host)s:%(port)d/%(part1)s/%(part2)s'",
            "        values = {'host': 'server', 'port': 9090, 'part1': 'A', 'part2': 'B'}",
            "        actual_url = core.format_url(url_template, values)",
            "",
            "        expected_url = 'http://server:9090/A/B'",
            "        self.assertEqual(actual_url, expected_url)",
            "",
            "    def test_raises_malformed_on_missing_key(self):",
            "        self.assertRaises(exception.MalformedEndpoint,",
            "                          core.format_url,",
            "                          \"http://%(foo)s/%(bar)s\",",
            "                          {\"foo\": \"1\"})",
            "",
            "    def test_raises_malformed_on_wrong_type(self):",
            "        self.assertRaises(exception.MalformedEndpoint,",
            "                          core.format_url,",
            "                          \"http://%foo%s\",",
            "                          {\"foo\": \"1\"})",
            "",
            "    def test_raises_malformed_on_incomplete_format(self):",
            "        self.assertRaises(exception.MalformedEndpoint,",
            "                          core.format_url,",
            "                          \"http://%(foo)\",",
            "                          {\"foo\": \"1\"})",
            "",
            "    def test_formatting_a_non_string(self):",
            "        def _test(url_template):",
            "            self.assertRaises(exception.MalformedEndpoint,",
            "                              core.format_url,",
            "                              url_template,",
            "                              {})",
            "",
            "        _test(None)",
            "        _test(object())",
            "",
            "    def test_substitution_with_key_not_whitelisted(self):",
            "        url_template = 'http://%(host)s:%(port)d/%(part1)s/%(part2)s/%(part3)s'",
            "        values = {'host': 'server', 'port': 9090,",
            "                  'part1': 'A', 'part2': 'B', 'part3': 'C'}",
            "        self.assertRaises(exception.MalformedEndpoint,",
            "                          core.format_url,",
            "                          url_template,",
            "                          values)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1"
        ],
        "dele_reviseLocation": {},
        "addLocation": [
            "neutron.tests.unit.plugins.ml2.drivers.openvswitch.agent.test_ovs_neutron_agent.TestOvsNeutronAgent.test_agent_type_ovs",
            "keystone.tests.unit.catalog.test_core.FormatUrlTests.self"
        ]
    }
}