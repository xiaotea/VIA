{
    "flask_admin/helpers.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 10,
                "afterPatchRowNumber": 10,
                "PatchRowcode": " "
            },
            "1": {
                "beforePatchRowNumber": 11,
                "afterPatchRowNumber": 11,
                "PatchRowcode": " VALID_SCHEMES = ['http', 'https']"
            },
            "2": {
                "beforePatchRowNumber": 12,
                "afterPatchRowNumber": 12,
                "PatchRowcode": " _substitute_whitespace = compile(r'[\\s\\x00-\\x08\\x0B\\x0C\\x0E-\\x19]+').sub"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 13,
                "PatchRowcode": "+_fix_multiple_slashes = compile(r'(^([^/]+:)?//)/*').sub"
            },
            "4": {
                "beforePatchRowNumber": 13,
                "afterPatchRowNumber": 14,
                "PatchRowcode": " "
            },
            "5": {
                "beforePatchRowNumber": 14,
                "afterPatchRowNumber": 15,
                "PatchRowcode": " "
            },
            "6": {
                "beforePatchRowNumber": 15,
                "afterPatchRowNumber": 16,
                "PatchRowcode": " def set_current_view(view):"
            },
            "7": {
                "beforePatchRowNumber": 137,
                "afterPatchRowNumber": 138,
                "PatchRowcode": "     # refs https://stackoverflow.com/questions/10438008"
            },
            "8": {
                "beforePatchRowNumber": 138,
                "afterPatchRowNumber": 139,
                "PatchRowcode": "     target = target.replace('\\\\', '/')"
            },
            "9": {
                "beforePatchRowNumber": 139,
                "afterPatchRowNumber": 140,
                "PatchRowcode": " "
            },
            "10": {
                "beforePatchRowNumber": 140,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    # prevent urls starting with \"javascript:\""
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 141,
                "PatchRowcode": "+    # handle cases like \"j a v a s c r i p t:\""
            },
            "12": {
                "beforePatchRowNumber": 141,
                "afterPatchRowNumber": 142,
                "PatchRowcode": "     target = _substitute_whitespace('', target)"
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 143,
                "PatchRowcode": "+"
            },
            "14": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 144,
                "PatchRowcode": "+    # Chrome and FireFox \"fix\" more than two slashes into two after protocol"
            },
            "15": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 145,
                "PatchRowcode": "+    target = _fix_multiple_slashes(lambda m: m.group(1), target, 1)"
            },
            "16": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 146,
                "PatchRowcode": "+"
            },
            "17": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 147,
                "PatchRowcode": "+    # prevent urls starting with \"javascript:\""
            },
            "18": {
                "beforePatchRowNumber": 142,
                "afterPatchRowNumber": 148,
                "PatchRowcode": "     target_info = urlparse(target)"
            },
            "19": {
                "beforePatchRowNumber": 143,
                "afterPatchRowNumber": 149,
                "PatchRowcode": "     target_scheme = target_info.scheme"
            },
            "20": {
                "beforePatchRowNumber": 144,
                "afterPatchRowNumber": 150,
                "PatchRowcode": "     if target_scheme and target_scheme not in VALID_SCHEMES:"
            }
        },
        "frontPatchFile": [
            "from re import sub, compile",
            "from jinja2 import contextfunction",
            "from flask import g, request, url_for, flash",
            "from wtforms.validators import DataRequired, InputRequired",
            "",
            "from flask_admin._compat import urljoin, urlparse, iteritems",
            "",
            "from ._compat import string_types",
            "",
            "",
            "VALID_SCHEMES = ['http', 'https']",
            "_substitute_whitespace = compile(r'[\\s\\x00-\\x08\\x0B\\x0C\\x0E-\\x19]+').sub",
            "",
            "",
            "def set_current_view(view):",
            "    g._admin_view = view",
            "",
            "",
            "def get_current_view():",
            "    \"\"\"",
            "        Get current administrative view.",
            "    \"\"\"",
            "    return getattr(g, '_admin_view', None)",
            "",
            "",
            "def get_url(endpoint, **kwargs):",
            "    \"\"\"",
            "        Alternative to Flask `url_for`.",
            "        If there's current administrative view, will call its `get_url`. If there's none - will",
            "        use generic `url_for`.",
            "",
            "        :param endpoint:",
            "            Endpoint name",
            "        :param kwargs:",
            "            View arguments",
            "    \"\"\"",
            "    view = get_current_view()",
            "",
            "    if not view:",
            "        return url_for(endpoint, **kwargs)",
            "",
            "    return view.get_url(endpoint, **kwargs)",
            "",
            "",
            "def is_required_form_field(field):",
            "    \"\"\"",
            "        Check if form field has `DataRequired` or `InputRequired` validators.",
            "",
            "        :param field:",
            "            WTForms field to check",
            "    \"\"\"",
            "    for validator in field.validators:",
            "        if isinstance(validator, (DataRequired, InputRequired)):",
            "            return True",
            "    return False",
            "",
            "",
            "def is_form_submitted():",
            "    \"\"\"",
            "        Check if current method is PUT or POST",
            "    \"\"\"",
            "    return request and request.method in ('PUT', 'POST')",
            "",
            "",
            "def validate_form_on_submit(form):",
            "    \"\"\"",
            "        If current method is PUT or POST, validate form and return validation status.",
            "    \"\"\"",
            "    return is_form_submitted() and form.validate()",
            "",
            "",
            "def get_form_data():",
            "    \"\"\"",
            "        If current method is PUT or POST, return concatenated `request.form` with",
            "        `request.files` or `None` otherwise.",
            "    \"\"\"",
            "    if is_form_submitted():",
            "        formdata = request.form",
            "        if request.files:",
            "            formdata = formdata.copy()",
            "            formdata.update(request.files)",
            "        return formdata",
            "",
            "    return None",
            "",
            "",
            "def is_field_error(errors):",
            "    \"\"\"",
            "        Check if wtforms field has error without checking its children.",
            "",
            "        :param errors:",
            "            Errors list.",
            "    \"\"\"",
            "    if isinstance(errors, (list, tuple)):",
            "        for e in errors:",
            "            if isinstance(e, string_types):",
            "                return True",
            "",
            "    return False",
            "",
            "",
            "def flash_errors(form, message):",
            "    from flask_admin.babel import gettext",
            "    for field_name, errors in iteritems(form.errors):",
            "        errors = form[field_name].label.text + u\": \" + u\", \".join(errors)",
            "        flash(gettext(message, error=str(errors)), 'error')",
            "",
            "",
            "@contextfunction",
            "def resolve_ctx(context):",
            "    \"\"\"",
            "        Resolve current Jinja2 context and store it for general consumption.",
            "    \"\"\"",
            "    g._admin_render_ctx = context",
            "",
            "",
            "def get_render_ctx():",
            "    \"\"\"",
            "        Get view template context.",
            "    \"\"\"",
            "    return getattr(g, '_admin_render_ctx', None)",
            "",
            "",
            "def prettify_class_name(name):",
            "    \"\"\"",
            "        Split words in PascalCase string into separate words.",
            "",
            "        :param name:",
            "            String to split",
            "    \"\"\"",
            "    return sub(r'(?<=.)([A-Z])', r' \\1', name)",
            "",
            "",
            "def is_safe_url(target):",
            "    # prevent urls like \"\\\\www.google.com\"",
            "    # some browser will change \\\\ to // (eg: Chrome)",
            "    # refs https://stackoverflow.com/questions/10438008",
            "    target = target.replace('\\\\', '/')",
            "",
            "    # prevent urls starting with \"javascript:\"",
            "    target = _substitute_whitespace('', target)",
            "    target_info = urlparse(target)",
            "    target_scheme = target_info.scheme",
            "    if target_scheme and target_scheme not in VALID_SCHEMES:",
            "        return False",
            "",
            "    ref_url = urlparse(request.host_url)",
            "    test_url = urlparse(urljoin(request.host_url, target))",
            "    return ref_url.netloc == test_url.netloc",
            "",
            "",
            "def get_redirect_target(param_name='url'):",
            "    target = request.values.get(param_name)",
            "",
            "    if target and is_safe_url(target):",
            "        return target"
        ],
        "afterPatchFile": [
            "from re import sub, compile",
            "from jinja2 import contextfunction",
            "from flask import g, request, url_for, flash",
            "from wtforms.validators import DataRequired, InputRequired",
            "",
            "from flask_admin._compat import urljoin, urlparse, iteritems",
            "",
            "from ._compat import string_types",
            "",
            "",
            "VALID_SCHEMES = ['http', 'https']",
            "_substitute_whitespace = compile(r'[\\s\\x00-\\x08\\x0B\\x0C\\x0E-\\x19]+').sub",
            "_fix_multiple_slashes = compile(r'(^([^/]+:)?//)/*').sub",
            "",
            "",
            "def set_current_view(view):",
            "    g._admin_view = view",
            "",
            "",
            "def get_current_view():",
            "    \"\"\"",
            "        Get current administrative view.",
            "    \"\"\"",
            "    return getattr(g, '_admin_view', None)",
            "",
            "",
            "def get_url(endpoint, **kwargs):",
            "    \"\"\"",
            "        Alternative to Flask `url_for`.",
            "        If there's current administrative view, will call its `get_url`. If there's none - will",
            "        use generic `url_for`.",
            "",
            "        :param endpoint:",
            "            Endpoint name",
            "        :param kwargs:",
            "            View arguments",
            "    \"\"\"",
            "    view = get_current_view()",
            "",
            "    if not view:",
            "        return url_for(endpoint, **kwargs)",
            "",
            "    return view.get_url(endpoint, **kwargs)",
            "",
            "",
            "def is_required_form_field(field):",
            "    \"\"\"",
            "        Check if form field has `DataRequired` or `InputRequired` validators.",
            "",
            "        :param field:",
            "            WTForms field to check",
            "    \"\"\"",
            "    for validator in field.validators:",
            "        if isinstance(validator, (DataRequired, InputRequired)):",
            "            return True",
            "    return False",
            "",
            "",
            "def is_form_submitted():",
            "    \"\"\"",
            "        Check if current method is PUT or POST",
            "    \"\"\"",
            "    return request and request.method in ('PUT', 'POST')",
            "",
            "",
            "def validate_form_on_submit(form):",
            "    \"\"\"",
            "        If current method is PUT or POST, validate form and return validation status.",
            "    \"\"\"",
            "    return is_form_submitted() and form.validate()",
            "",
            "",
            "def get_form_data():",
            "    \"\"\"",
            "        If current method is PUT or POST, return concatenated `request.form` with",
            "        `request.files` or `None` otherwise.",
            "    \"\"\"",
            "    if is_form_submitted():",
            "        formdata = request.form",
            "        if request.files:",
            "            formdata = formdata.copy()",
            "            formdata.update(request.files)",
            "        return formdata",
            "",
            "    return None",
            "",
            "",
            "def is_field_error(errors):",
            "    \"\"\"",
            "        Check if wtforms field has error without checking its children.",
            "",
            "        :param errors:",
            "            Errors list.",
            "    \"\"\"",
            "    if isinstance(errors, (list, tuple)):",
            "        for e in errors:",
            "            if isinstance(e, string_types):",
            "                return True",
            "",
            "    return False",
            "",
            "",
            "def flash_errors(form, message):",
            "    from flask_admin.babel import gettext",
            "    for field_name, errors in iteritems(form.errors):",
            "        errors = form[field_name].label.text + u\": \" + u\", \".join(errors)",
            "        flash(gettext(message, error=str(errors)), 'error')",
            "",
            "",
            "@contextfunction",
            "def resolve_ctx(context):",
            "    \"\"\"",
            "        Resolve current Jinja2 context and store it for general consumption.",
            "    \"\"\"",
            "    g._admin_render_ctx = context",
            "",
            "",
            "def get_render_ctx():",
            "    \"\"\"",
            "        Get view template context.",
            "    \"\"\"",
            "    return getattr(g, '_admin_render_ctx', None)",
            "",
            "",
            "def prettify_class_name(name):",
            "    \"\"\"",
            "        Split words in PascalCase string into separate words.",
            "",
            "        :param name:",
            "            String to split",
            "    \"\"\"",
            "    return sub(r'(?<=.)([A-Z])', r' \\1', name)",
            "",
            "",
            "def is_safe_url(target):",
            "    # prevent urls like \"\\\\www.google.com\"",
            "    # some browser will change \\\\ to // (eg: Chrome)",
            "    # refs https://stackoverflow.com/questions/10438008",
            "    target = target.replace('\\\\', '/')",
            "",
            "    # handle cases like \"j a v a s c r i p t:\"",
            "    target = _substitute_whitespace('', target)",
            "",
            "    # Chrome and FireFox \"fix\" more than two slashes into two after protocol",
            "    target = _fix_multiple_slashes(lambda m: m.group(1), target, 1)",
            "",
            "    # prevent urls starting with \"javascript:\"",
            "    target_info = urlparse(target)",
            "    target_scheme = target_info.scheme",
            "    if target_scheme and target_scheme not in VALID_SCHEMES:",
            "        return False",
            "",
            "    ref_url = urlparse(request.host_url)",
            "    test_url = urlparse(urljoin(request.host_url, target))",
            "    return ref_url.netloc == test_url.netloc",
            "",
            "",
            "def get_redirect_target(param_name='url'):",
            "    target = request.values.get(param_name)",
            "",
            "    if target and is_safe_url(target):",
            "        return target"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "140": [
                "is_safe_url"
            ]
        },
        "addLocation": []
    },
    "flask_admin/tests/test_helpers.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 11,
                "afterPatchRowNumber": 11,
                "PatchRowcode": "         assert helpers.is_safe_url('https://127.0.0.1/admin/car/')"
            },
            "1": {
                "beforePatchRowNumber": 12,
                "afterPatchRowNumber": 12,
                "PatchRowcode": "         assert helpers.is_safe_url('/admin/car/')"
            },
            "2": {
                "beforePatchRowNumber": 13,
                "afterPatchRowNumber": 13,
                "PatchRowcode": "         assert helpers.is_safe_url('admin/car/')"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 14,
                "PatchRowcode": "+        assert helpers.is_safe_url('http////www.google.com')"
            },
            "4": {
                "beforePatchRowNumber": 14,
                "afterPatchRowNumber": 15,
                "PatchRowcode": " "
            },
            "5": {
                "beforePatchRowNumber": 15,
                "afterPatchRowNumber": 16,
                "PatchRowcode": "         assert not helpers.is_safe_url('http://127.0.0.2/admin/car/')"
            },
            "6": {
                "beforePatchRowNumber": 16,
                "afterPatchRowNumber": 17,
                "PatchRowcode": "         assert not helpers.is_safe_url(' javascript:alert(document.domain)')"
            },
            "7": {
                "beforePatchRowNumber": 17,
                "afterPatchRowNumber": 18,
                "PatchRowcode": "         assert not helpers.is_safe_url('javascript:alert(document.domain)')"
            },
            "8": {
                "beforePatchRowNumber": 18,
                "afterPatchRowNumber": 19,
                "PatchRowcode": "         assert not helpers.is_safe_url('javascrip\\nt:alert(document.domain)')"
            },
            "9": {
                "beforePatchRowNumber": 19,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        assert not helpers.is_safe_url('\\\\\\\\www.google.com')"
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 20,
                "PatchRowcode": "+        assert not helpers.is_safe_url(r'\\\\www.google.com')"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 21,
                "PatchRowcode": "+        assert not helpers.is_safe_url(r'\\\\/www.google.com')"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 22,
                "PatchRowcode": "+        assert not helpers.is_safe_url('/////www.google.com')"
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 23,
                "PatchRowcode": "+        assert not helpers.is_safe_url('http:///www.google.com')"
            },
            "14": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 24,
                "PatchRowcode": "+        assert not helpers.is_safe_url('https:////www.google.com')"
            }
        },
        "frontPatchFile": [
            "import flask",
            "",
            "from flask_admin import helpers",
            "",
            "",
            "def test_is_safe_url():",
            "    app = flask.Flask(__name__)",
            "",
            "    with app.test_request_context('http://127.0.0.1/admin/car/edit/'):",
            "        assert helpers.is_safe_url('http://127.0.0.1/admin/car/')",
            "        assert helpers.is_safe_url('https://127.0.0.1/admin/car/')",
            "        assert helpers.is_safe_url('/admin/car/')",
            "        assert helpers.is_safe_url('admin/car/')",
            "",
            "        assert not helpers.is_safe_url('http://127.0.0.2/admin/car/')",
            "        assert not helpers.is_safe_url(' javascript:alert(document.domain)')",
            "        assert not helpers.is_safe_url('javascript:alert(document.domain)')",
            "        assert not helpers.is_safe_url('javascrip\\nt:alert(document.domain)')",
            "        assert not helpers.is_safe_url('\\\\\\\\www.google.com')"
        ],
        "afterPatchFile": [
            "import flask",
            "",
            "from flask_admin import helpers",
            "",
            "",
            "def test_is_safe_url():",
            "    app = flask.Flask(__name__)",
            "",
            "    with app.test_request_context('http://127.0.0.1/admin/car/edit/'):",
            "        assert helpers.is_safe_url('http://127.0.0.1/admin/car/')",
            "        assert helpers.is_safe_url('https://127.0.0.1/admin/car/')",
            "        assert helpers.is_safe_url('/admin/car/')",
            "        assert helpers.is_safe_url('admin/car/')",
            "        assert helpers.is_safe_url('http////www.google.com')",
            "",
            "        assert not helpers.is_safe_url('http://127.0.0.2/admin/car/')",
            "        assert not helpers.is_safe_url(' javascript:alert(document.domain)')",
            "        assert not helpers.is_safe_url('javascript:alert(document.domain)')",
            "        assert not helpers.is_safe_url('javascrip\\nt:alert(document.domain)')",
            "        assert not helpers.is_safe_url(r'\\\\www.google.com')",
            "        assert not helpers.is_safe_url(r'\\\\/www.google.com')",
            "        assert not helpers.is_safe_url('/////www.google.com')",
            "        assert not helpers.is_safe_url('http:///www.google.com')",
            "        assert not helpers.is_safe_url('https:////www.google.com')"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2"
        ],
        "dele_reviseLocation": {
            "19": [
                "test_is_safe_url"
            ]
        },
        "addLocation": [
            "airflow.www.views.LogModelView"
        ]
    }
}