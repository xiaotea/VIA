{
    "airflow/www/app.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 18,
                "afterPatchRowNumber": 18,
                "PatchRowcode": " # under the License."
            },
            "1": {
                "beforePatchRowNumber": 19,
                "afterPatchRowNumber": 19,
                "PatchRowcode": " #"
            },
            "2": {
                "beforePatchRowNumber": 20,
                "afterPatchRowNumber": 20,
                "PatchRowcode": " import six"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 21,
                "PatchRowcode": "+import os"
            },
            "4": {
                "beforePatchRowNumber": 21,
                "afterPatchRowNumber": 22,
                "PatchRowcode": " "
            },
            "5": {
                "beforePatchRowNumber": 22,
                "afterPatchRowNumber": 23,
                "PatchRowcode": " from flask import Flask"
            },
            "6": {
                "beforePatchRowNumber": 23,
                "afterPatchRowNumber": 24,
                "PatchRowcode": " from flask_admin import Admin, base"
            },
            "7": {
                "beforePatchRowNumber": 43,
                "afterPatchRowNumber": 44,
                "PatchRowcode": " "
            },
            "8": {
                "beforePatchRowNumber": 44,
                "afterPatchRowNumber": 45,
                "PatchRowcode": " "
            },
            "9": {
                "beforePatchRowNumber": 45,
                "afterPatchRowNumber": 46,
                "PatchRowcode": " def create_app(config=None, testing=False):"
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 47,
                "PatchRowcode": "+"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 48,
                "PatchRowcode": "+    log = LoggingMixin().log"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 49,
                "PatchRowcode": "+"
            },
            "13": {
                "beforePatchRowNumber": 46,
                "afterPatchRowNumber": 50,
                "PatchRowcode": "     app = Flask(__name__)"
            },
            "14": {
                "beforePatchRowNumber": 47,
                "afterPatchRowNumber": 51,
                "PatchRowcode": "     app.wsgi_app = ProxyFix(app.wsgi_app)"
            },
            "15": {
                "beforePatchRowNumber": 48,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    app.secret_key = configuration.conf.get('webserver', 'SECRET_KEY')"
            },
            "16": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 52,
                "PatchRowcode": "+"
            },
            "17": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 53,
                "PatchRowcode": "+    if configuration.conf.get('webserver', 'SECRET_KEY') == \"temporary_key\":"
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 54,
                "PatchRowcode": "+        log.info(\"SECRET_KEY for Flask App is not specified. Using a random one.\")"
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 55,
                "PatchRowcode": "+        app.secret_key = os.urandom(16)"
            },
            "20": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 56,
                "PatchRowcode": "+    else:"
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 57,
                "PatchRowcode": "+        app.secret_key = configuration.conf.get('webserver', 'SECRET_KEY')"
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 58,
                "PatchRowcode": "+"
            },
            "23": {
                "beforePatchRowNumber": 49,
                "afterPatchRowNumber": 59,
                "PatchRowcode": "     app.config['LOGIN_DISABLED'] = not configuration.conf.getboolean("
            },
            "24": {
                "beforePatchRowNumber": 50,
                "afterPatchRowNumber": 60,
                "PatchRowcode": "         'webserver', 'AUTHENTICATE')"
            },
            "25": {
                "beforePatchRowNumber": 51,
                "afterPatchRowNumber": 61,
                "PatchRowcode": " "
            },
            "26": {
                "beforePatchRowNumber": 127,
                "afterPatchRowNumber": 137,
                "PatchRowcode": " "
            },
            "27": {
                "beforePatchRowNumber": 128,
                "afterPatchRowNumber": 138,
                "PatchRowcode": "         def integrate_plugins():"
            },
            "28": {
                "beforePatchRowNumber": 129,
                "afterPatchRowNumber": 139,
                "PatchRowcode": "             \"\"\"Integrate plugins to the context\"\"\""
            },
            "29": {
                "beforePatchRowNumber": 130,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            log = LoggingMixin().log"
            },
            "30": {
                "beforePatchRowNumber": 131,
                "afterPatchRowNumber": 140,
                "PatchRowcode": "             from airflow.plugins_manager import ("
            },
            "31": {
                "beforePatchRowNumber": 132,
                "afterPatchRowNumber": 141,
                "PatchRowcode": "                 admin_views, flask_blueprints, menu_links)"
            },
            "32": {
                "beforePatchRowNumber": 133,
                "afterPatchRowNumber": 142,
                "PatchRowcode": "             for v in admin_views:"
            }
        },
        "frontPatchFile": [
            "# -*- coding: utf-8 -*-",
            "#",
            "# Licensed to the Apache Software Foundation (ASF) under one",
            "# or more contributor license agreements.  See the NOTICE file",
            "# distributed with this work for additional information",
            "# regarding copyright ownership.  The ASF licenses this file",
            "# to you under the Apache License, Version 2.0 (the",
            "# \"License\"); you may not use this file except in compliance",
            "# with the License.  You may obtain a copy of the License at",
            "#",
            "#   http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "# Unless required by applicable law or agreed to in writing,",
            "# software distributed under the License is distributed on an",
            "# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY",
            "# KIND, either express or implied.  See the License for the",
            "# specific language governing permissions and limitations",
            "# under the License.",
            "#",
            "import six",
            "",
            "from flask import Flask",
            "from flask_admin import Admin, base",
            "from flask_caching import Cache",
            "from flask_wtf.csrf import CSRFProtect",
            "from six.moves.urllib.parse import urlparse",
            "from werkzeug.wsgi import DispatcherMiddleware",
            "from werkzeug.contrib.fixers import ProxyFix",
            "",
            "import airflow",
            "from airflow import configuration as conf",
            "from airflow import models, LoggingMixin",
            "from airflow.settings import Session",
            "",
            "from airflow.www.blueprints import routes",
            "from airflow.logging_config import configure_logging",
            "from airflow import jobs",
            "from airflow import settings",
            "from airflow import configuration",
            "from airflow.utils.net import get_hostname",
            "",
            "csrf = CSRFProtect()",
            "",
            "",
            "def create_app(config=None, testing=False):",
            "    app = Flask(__name__)",
            "    app.wsgi_app = ProxyFix(app.wsgi_app)",
            "    app.secret_key = configuration.conf.get('webserver', 'SECRET_KEY')",
            "    app.config['LOGIN_DISABLED'] = not configuration.conf.getboolean(",
            "        'webserver', 'AUTHENTICATE')",
            "",
            "    csrf.init_app(app)",
            "",
            "    app.config['TESTING'] = testing",
            "",
            "    airflow.load_login()",
            "    airflow.login.login_manager.init_app(app)",
            "",
            "    from airflow import api",
            "    api.load_auth()",
            "    api.api_auth.init_app(app)",
            "",
            "    cache = Cache(",
            "        app=app, config={'CACHE_TYPE': 'filesystem', 'CACHE_DIR': '/tmp'})",
            "",
            "    app.register_blueprint(routes)",
            "",
            "    configure_logging()",
            "",
            "    with app.app_context():",
            "        from airflow.www import views",
            "",
            "        admin = Admin(",
            "            app, name='Airflow',",
            "            static_url_path='/admin',",
            "            index_view=views.HomeView(endpoint='', url='/admin', name=\"DAGs\"),",
            "            template_mode='bootstrap3',",
            "        )",
            "        av = admin.add_view",
            "        vs = views",
            "        av(vs.Airflow(name='DAGs', category='DAGs'))",
            "",
            "        if not conf.getboolean('core', 'secure_mode'):",
            "            av(vs.QueryView(name='Ad Hoc Query', category=\"Data Profiling\"))",
            "            av(vs.ChartModelView(",
            "                models.Chart, Session, name=\"Charts\", category=\"Data Profiling\"))",
            "        av(vs.KnownEventView(",
            "            models.KnownEvent,",
            "            Session, name=\"Known Events\", category=\"Data Profiling\"))",
            "        av(vs.SlaMissModelView(",
            "            models.SlaMiss,",
            "            Session, name=\"SLA Misses\", category=\"Browse\"))",
            "        av(vs.TaskInstanceModelView(models.TaskInstance,",
            "            Session, name=\"Task Instances\", category=\"Browse\"))",
            "        av(vs.LogModelView(",
            "            models.Log, Session, name=\"Logs\", category=\"Browse\"))",
            "        av(vs.JobModelView(",
            "            jobs.BaseJob, Session, name=\"Jobs\", category=\"Browse\"))",
            "        av(vs.PoolModelView(",
            "            models.Pool, Session, name=\"Pools\", category=\"Admin\"))",
            "        av(vs.ConfigurationView(",
            "            name='Configuration', category=\"Admin\"))",
            "        av(vs.UserModelView(",
            "            models.User, Session, name=\"Users\", category=\"Admin\"))",
            "        av(vs.ConnectionModelView(",
            "            models.Connection, Session, name=\"Connections\", category=\"Admin\"))",
            "        av(vs.VariableView(",
            "            models.Variable, Session, name=\"Variables\", category=\"Admin\"))",
            "        av(vs.XComView(",
            "            models.XCom, Session, name=\"XComs\", category=\"Admin\"))",
            "",
            "        admin.add_link(base.MenuLink(",
            "            category='Docs', name='Documentation',",
            "            url='https://airflow.incubator.apache.org/'))",
            "        admin.add_link(",
            "            base.MenuLink(category='Docs',",
            "                          name='Github',",
            "                          url='https://github.com/apache/incubator-airflow'))",
            "",
            "        av(vs.VersionView(name='Version', category=\"About\"))",
            "",
            "        av(vs.DagRunModelView(",
            "            models.DagRun, Session, name=\"DAG Runs\", category=\"Browse\"))",
            "        av(vs.DagModelView(models.DagModel, Session, name=None))",
            "        # Hack to not add this view to the menu",
            "        admin._menu = admin._menu[:-1]",
            "",
            "        def integrate_plugins():",
            "            \"\"\"Integrate plugins to the context\"\"\"",
            "            log = LoggingMixin().log",
            "            from airflow.plugins_manager import (",
            "                admin_views, flask_blueprints, menu_links)",
            "            for v in admin_views:",
            "                log.debug('Adding view %s', v.name)",
            "                admin.add_view(v)",
            "            for bp in flask_blueprints:",
            "                log.debug('Adding blueprint %s', bp.name)",
            "                app.register_blueprint(bp)",
            "            for ml in sorted(menu_links, key=lambda x: x.name):",
            "                log.debug('Adding menu link %s', ml.name)",
            "                admin.add_link(ml)",
            "",
            "        integrate_plugins()",
            "",
            "        import airflow.www.api.experimental.endpoints as e",
            "        # required for testing purposes otherwise the module retains",
            "        # a link to the default_auth",
            "        if app.config['TESTING']:",
            "            if six.PY2:",
            "                reload(e)",
            "            else:",
            "                import importlib",
            "                importlib.reload(e)",
            "",
            "        app.register_blueprint(e.api_experimental, url_prefix='/api/experimental')",
            "",
            "        @app.context_processor",
            "        def jinja_globals():",
            "            return {",
            "                'hostname': get_hostname(),",
            "                'navbar_color': configuration.get('webserver', 'NAVBAR_COLOR'),",
            "            }",
            "",
            "        @app.teardown_appcontext",
            "        def shutdown_session(exception=None):",
            "            settings.Session.remove()",
            "",
            "        return app",
            "",
            "",
            "app = None",
            "",
            "",
            "def root_app(env, resp):",
            "    resp(b'404 Not Found', [(b'Content-Type', b'text/plain')])",
            "    return [b'Apache Airflow is not at this location']",
            "",
            "",
            "def cached_app(config=None, testing=False):",
            "    global app",
            "    if not app:",
            "        base_url = urlparse(configuration.conf.get('webserver', 'base_url'))[2]",
            "        if not base_url or base_url == '/':",
            "            base_url = \"\"",
            "",
            "        app = create_app(config, testing)",
            "        app = DispatcherMiddleware(root_app, {base_url: app})",
            "    return app"
        ],
        "afterPatchFile": [
            "# -*- coding: utf-8 -*-",
            "#",
            "# Licensed to the Apache Software Foundation (ASF) under one",
            "# or more contributor license agreements.  See the NOTICE file",
            "# distributed with this work for additional information",
            "# regarding copyright ownership.  The ASF licenses this file",
            "# to you under the Apache License, Version 2.0 (the",
            "# \"License\"); you may not use this file except in compliance",
            "# with the License.  You may obtain a copy of the License at",
            "#",
            "#   http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "# Unless required by applicable law or agreed to in writing,",
            "# software distributed under the License is distributed on an",
            "# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY",
            "# KIND, either express or implied.  See the License for the",
            "# specific language governing permissions and limitations",
            "# under the License.",
            "#",
            "import six",
            "import os",
            "",
            "from flask import Flask",
            "from flask_admin import Admin, base",
            "from flask_caching import Cache",
            "from flask_wtf.csrf import CSRFProtect",
            "from six.moves.urllib.parse import urlparse",
            "from werkzeug.wsgi import DispatcherMiddleware",
            "from werkzeug.contrib.fixers import ProxyFix",
            "",
            "import airflow",
            "from airflow import configuration as conf",
            "from airflow import models, LoggingMixin",
            "from airflow.settings import Session",
            "",
            "from airflow.www.blueprints import routes",
            "from airflow.logging_config import configure_logging",
            "from airflow import jobs",
            "from airflow import settings",
            "from airflow import configuration",
            "from airflow.utils.net import get_hostname",
            "",
            "csrf = CSRFProtect()",
            "",
            "",
            "def create_app(config=None, testing=False):",
            "",
            "    log = LoggingMixin().log",
            "",
            "    app = Flask(__name__)",
            "    app.wsgi_app = ProxyFix(app.wsgi_app)",
            "",
            "    if configuration.conf.get('webserver', 'SECRET_KEY') == \"temporary_key\":",
            "        log.info(\"SECRET_KEY for Flask App is not specified. Using a random one.\")",
            "        app.secret_key = os.urandom(16)",
            "    else:",
            "        app.secret_key = configuration.conf.get('webserver', 'SECRET_KEY')",
            "",
            "    app.config['LOGIN_DISABLED'] = not configuration.conf.getboolean(",
            "        'webserver', 'AUTHENTICATE')",
            "",
            "    csrf.init_app(app)",
            "",
            "    app.config['TESTING'] = testing",
            "",
            "    airflow.load_login()",
            "    airflow.login.login_manager.init_app(app)",
            "",
            "    from airflow import api",
            "    api.load_auth()",
            "    api.api_auth.init_app(app)",
            "",
            "    cache = Cache(",
            "        app=app, config={'CACHE_TYPE': 'filesystem', 'CACHE_DIR': '/tmp'})",
            "",
            "    app.register_blueprint(routes)",
            "",
            "    configure_logging()",
            "",
            "    with app.app_context():",
            "        from airflow.www import views",
            "",
            "        admin = Admin(",
            "            app, name='Airflow',",
            "            static_url_path='/admin',",
            "            index_view=views.HomeView(endpoint='', url='/admin', name=\"DAGs\"),",
            "            template_mode='bootstrap3',",
            "        )",
            "        av = admin.add_view",
            "        vs = views",
            "        av(vs.Airflow(name='DAGs', category='DAGs'))",
            "",
            "        if not conf.getboolean('core', 'secure_mode'):",
            "            av(vs.QueryView(name='Ad Hoc Query', category=\"Data Profiling\"))",
            "            av(vs.ChartModelView(",
            "                models.Chart, Session, name=\"Charts\", category=\"Data Profiling\"))",
            "        av(vs.KnownEventView(",
            "            models.KnownEvent,",
            "            Session, name=\"Known Events\", category=\"Data Profiling\"))",
            "        av(vs.SlaMissModelView(",
            "            models.SlaMiss,",
            "            Session, name=\"SLA Misses\", category=\"Browse\"))",
            "        av(vs.TaskInstanceModelView(models.TaskInstance,",
            "            Session, name=\"Task Instances\", category=\"Browse\"))",
            "        av(vs.LogModelView(",
            "            models.Log, Session, name=\"Logs\", category=\"Browse\"))",
            "        av(vs.JobModelView(",
            "            jobs.BaseJob, Session, name=\"Jobs\", category=\"Browse\"))",
            "        av(vs.PoolModelView(",
            "            models.Pool, Session, name=\"Pools\", category=\"Admin\"))",
            "        av(vs.ConfigurationView(",
            "            name='Configuration', category=\"Admin\"))",
            "        av(vs.UserModelView(",
            "            models.User, Session, name=\"Users\", category=\"Admin\"))",
            "        av(vs.ConnectionModelView(",
            "            models.Connection, Session, name=\"Connections\", category=\"Admin\"))",
            "        av(vs.VariableView(",
            "            models.Variable, Session, name=\"Variables\", category=\"Admin\"))",
            "        av(vs.XComView(",
            "            models.XCom, Session, name=\"XComs\", category=\"Admin\"))",
            "",
            "        admin.add_link(base.MenuLink(",
            "            category='Docs', name='Documentation',",
            "            url='https://airflow.incubator.apache.org/'))",
            "        admin.add_link(",
            "            base.MenuLink(category='Docs',",
            "                          name='Github',",
            "                          url='https://github.com/apache/incubator-airflow'))",
            "",
            "        av(vs.VersionView(name='Version', category=\"About\"))",
            "",
            "        av(vs.DagRunModelView(",
            "            models.DagRun, Session, name=\"DAG Runs\", category=\"Browse\"))",
            "        av(vs.DagModelView(models.DagModel, Session, name=None))",
            "        # Hack to not add this view to the menu",
            "        admin._menu = admin._menu[:-1]",
            "",
            "        def integrate_plugins():",
            "            \"\"\"Integrate plugins to the context\"\"\"",
            "            from airflow.plugins_manager import (",
            "                admin_views, flask_blueprints, menu_links)",
            "            for v in admin_views:",
            "                log.debug('Adding view %s', v.name)",
            "                admin.add_view(v)",
            "            for bp in flask_blueprints:",
            "                log.debug('Adding blueprint %s', bp.name)",
            "                app.register_blueprint(bp)",
            "            for ml in sorted(menu_links, key=lambda x: x.name):",
            "                log.debug('Adding menu link %s', ml.name)",
            "                admin.add_link(ml)",
            "",
            "        integrate_plugins()",
            "",
            "        import airflow.www.api.experimental.endpoints as e",
            "        # required for testing purposes otherwise the module retains",
            "        # a link to the default_auth",
            "        if app.config['TESTING']:",
            "            if six.PY2:",
            "                reload(e)",
            "            else:",
            "                import importlib",
            "                importlib.reload(e)",
            "",
            "        app.register_blueprint(e.api_experimental, url_prefix='/api/experimental')",
            "",
            "        @app.context_processor",
            "        def jinja_globals():",
            "            return {",
            "                'hostname': get_hostname(),",
            "                'navbar_color': configuration.get('webserver', 'NAVBAR_COLOR'),",
            "            }",
            "",
            "        @app.teardown_appcontext",
            "        def shutdown_session(exception=None):",
            "            settings.Session.remove()",
            "",
            "        return app",
            "",
            "",
            "app = None",
            "",
            "",
            "def root_app(env, resp):",
            "    resp(b'404 Not Found', [(b'Content-Type', b'text/plain')])",
            "    return [b'Apache Airflow is not at this location']",
            "",
            "",
            "def cached_app(config=None, testing=False):",
            "    global app",
            "    if not app:",
            "        base_url = urlparse(configuration.conf.get('webserver', 'base_url'))[2]",
            "        if not base_url or base_url == '/':",
            "            base_url = \"\"",
            "",
            "        app = create_app(config, testing)",
            "        app = DispatcherMiddleware(root_app, {base_url: app})",
            "    return app"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "48": [
                "create_app"
            ],
            "130": [
                "create_app",
                "integrate_plugins"
            ]
        },
        "addLocation": [
            "airflow.www.app.cached_app",
            "yt_dlp.YoutubeDL"
        ]
    }
}