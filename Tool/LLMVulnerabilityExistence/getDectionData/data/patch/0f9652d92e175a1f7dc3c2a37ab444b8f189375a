{
    "cinder/tests/integrated/api/client.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 12,
                "afterPatchRowNumber": 12,
                "PatchRowcode": " #    License for the specific language governing permissions and limitations"
            },
            "1": {
                "beforePatchRowNumber": 13,
                "afterPatchRowNumber": 13,
                "PatchRowcode": " #    under the License."
            },
            "2": {
                "beforePatchRowNumber": 14,
                "afterPatchRowNumber": 14,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": 15,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-import httplib"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 15,
                "PatchRowcode": "+import netaddr"
            },
            "5": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 16,
                "PatchRowcode": "+import requests"
            },
            "6": {
                "beforePatchRowNumber": 16,
                "afterPatchRowNumber": 17,
                "PatchRowcode": " import urlparse"
            },
            "7": {
                "beforePatchRowNumber": 17,
                "afterPatchRowNumber": 18,
                "PatchRowcode": " "
            },
            "8": {
                "beforePatchRowNumber": 18,
                "afterPatchRowNumber": 19,
                "PatchRowcode": " from cinder.openstack.common import jsonutils"
            },
            "9": {
                "beforePatchRowNumber": 30,
                "afterPatchRowNumber": 31,
                "PatchRowcode": " "
            },
            "10": {
                "beforePatchRowNumber": 31,
                "afterPatchRowNumber": 32,
                "PatchRowcode": "         if response:"
            },
            "11": {
                "beforePatchRowNumber": 32,
                "afterPatchRowNumber": 33,
                "PatchRowcode": "             message = _('%(message)s\\nStatus Code: %(_status)s\\n'"
            },
            "12": {
                "beforePatchRowNumber": 33,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                        'Body: %(_body)s') % {'_status': response.status,"
            },
            "13": {
                "beforePatchRowNumber": 34,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                                              '_body': response.read()}"
            },
            "14": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 34,
                "PatchRowcode": "+                        'Body: %(_body)s') % {'_status': response.status_code,"
            },
            "15": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 35,
                "PatchRowcode": "+                                              '_body': response.text}"
            },
            "16": {
                "beforePatchRowNumber": 35,
                "afterPatchRowNumber": 36,
                "PatchRowcode": " "
            },
            "17": {
                "beforePatchRowNumber": 36,
                "afterPatchRowNumber": 37,
                "PatchRowcode": "         super(OpenStackApiException, self).__init__(message)"
            },
            "18": {
                "beforePatchRowNumber": 37,
                "afterPatchRowNumber": 38,
                "PatchRowcode": " "
            },
            "19": {
                "beforePatchRowNumber": 76,
                "afterPatchRowNumber": 77,
                "PatchRowcode": "         # default project_id"
            },
            "20": {
                "beforePatchRowNumber": 77,
                "afterPatchRowNumber": 78,
                "PatchRowcode": "         self.project_id = 'openstack'"
            },
            "21": {
                "beforePatchRowNumber": 78,
                "afterPatchRowNumber": 79,
                "PatchRowcode": " "
            },
            "22": {
                "beforePatchRowNumber": 79,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    def request(self, url, method='GET', body=None, headers=None):"
            },
            "23": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 80,
                "PatchRowcode": "+    def request(self, url, method='GET', body=None, headers=None,"
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 81,
                "PatchRowcode": "+                ssl_verify=True, stream=False):"
            },
            "25": {
                "beforePatchRowNumber": 80,
                "afterPatchRowNumber": 82,
                "PatchRowcode": "         _headers = {'Content-Type': 'application/json'}"
            },
            "26": {
                "beforePatchRowNumber": 81,
                "afterPatchRowNumber": 83,
                "PatchRowcode": "         _headers.update(headers or {})"
            },
            "27": {
                "beforePatchRowNumber": 82,
                "afterPatchRowNumber": 84,
                "PatchRowcode": " "
            },
            "28": {
                "beforePatchRowNumber": 85,
                "afterPatchRowNumber": 87,
                "PatchRowcode": "         hostname = parsed_url.hostname"
            },
            "29": {
                "beforePatchRowNumber": 86,
                "afterPatchRowNumber": 88,
                "PatchRowcode": "         scheme = parsed_url.scheme"
            },
            "30": {
                "beforePatchRowNumber": 87,
                "afterPatchRowNumber": 89,
                "PatchRowcode": " "
            },
            "31": {
                "beforePatchRowNumber": 88,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        if scheme == 'http':"
            },
            "32": {
                "beforePatchRowNumber": 89,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            conn = httplib.HTTPConnection(hostname,"
            },
            "33": {
                "beforePatchRowNumber": 90,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                                          port=port)"
            },
            "34": {
                "beforePatchRowNumber": 91,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        elif scheme == 'https':"
            },
            "35": {
                "beforePatchRowNumber": 92,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            conn = httplib.HTTPSConnection(hostname,"
            },
            "36": {
                "beforePatchRowNumber": 93,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                                           port=port)"
            },
            "37": {
                "beforePatchRowNumber": 94,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        else:"
            },
            "38": {
                "beforePatchRowNumber": 95,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            raise OpenStackApiException(\"Unknown scheme: %s\" % url)"
            },
            "39": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 90,
                "PatchRowcode": "+        if netaddr.valid_ipv6(hostname):"
            },
            "40": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 91,
                "PatchRowcode": "+            hostname = \"[%s]\" % hostname"
            },
            "41": {
                "beforePatchRowNumber": 96,
                "afterPatchRowNumber": 92,
                "PatchRowcode": " "
            },
            "42": {
                "beforePatchRowNumber": 97,
                "afterPatchRowNumber": 93,
                "PatchRowcode": "         relative_url = parsed_url.path"
            },
            "43": {
                "beforePatchRowNumber": 98,
                "afterPatchRowNumber": 94,
                "PatchRowcode": "         if parsed_url.query:"
            },
            "44": {
                "beforePatchRowNumber": 102,
                "afterPatchRowNumber": 98,
                "PatchRowcode": "         if body:"
            },
            "45": {
                "beforePatchRowNumber": 103,
                "afterPatchRowNumber": 99,
                "PatchRowcode": "             LOG.info(_(\"Body: %s\") % body)"
            },
            "46": {
                "beforePatchRowNumber": 104,
                "afterPatchRowNumber": 100,
                "PatchRowcode": " "
            },
            "47": {
                "beforePatchRowNumber": 105,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        conn.request(method, relative_url, body, _headers)"
            },
            "48": {
                "beforePatchRowNumber": 106,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        response = conn.getresponse()"
            },
            "49": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 101,
                "PatchRowcode": "+        if port:"
            },
            "50": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 102,
                "PatchRowcode": "+            _url = \"%s://%s:%d%s\" % (scheme, hostname, int(port), relative_url)"
            },
            "51": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 103,
                "PatchRowcode": "+        else:"
            },
            "52": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 104,
                "PatchRowcode": "+            _url = \"%s://%s%s\" % (scheme, hostname, relative_url)"
            },
            "53": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 105,
                "PatchRowcode": "+"
            },
            "54": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 106,
                "PatchRowcode": "+        response = requests.request(method, _url, data=body, headers=_headers,"
            },
            "55": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 107,
                "PatchRowcode": "+                                    verify=ssl_verify, stream=stream)"
            },
            "56": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 108,
                "PatchRowcode": "+"
            },
            "57": {
                "beforePatchRowNumber": 107,
                "afterPatchRowNumber": 109,
                "PatchRowcode": "         return response"
            },
            "58": {
                "beforePatchRowNumber": 108,
                "afterPatchRowNumber": 110,
                "PatchRowcode": " "
            },
            "59": {
                "beforePatchRowNumber": 109,
                "afterPatchRowNumber": 111,
                "PatchRowcode": "     def _authenticate(self):"
            },
            "60": {
                "beforePatchRowNumber": 117,
                "afterPatchRowNumber": 119,
                "PatchRowcode": "         response = self.request(auth_uri,"
            },
            "61": {
                "beforePatchRowNumber": 118,
                "afterPatchRowNumber": 120,
                "PatchRowcode": "                                 headers=headers)"
            },
            "62": {
                "beforePatchRowNumber": 119,
                "afterPatchRowNumber": 121,
                "PatchRowcode": " "
            },
            "63": {
                "beforePatchRowNumber": 120,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        http_status = response.status"
            },
            "64": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 122,
                "PatchRowcode": "+        http_status = response.status_code"
            },
            "65": {
                "beforePatchRowNumber": 121,
                "afterPatchRowNumber": 123,
                "PatchRowcode": "         LOG.debug(_(\"%(auth_uri)s => code %(http_status)s\"),"
            },
            "66": {
                "beforePatchRowNumber": 122,
                "afterPatchRowNumber": 124,
                "PatchRowcode": "                   {'auth_uri': auth_uri, 'http_status': http_status})"
            },
            "67": {
                "beforePatchRowNumber": 123,
                "afterPatchRowNumber": 125,
                "PatchRowcode": " "
            },
            "68": {
                "beforePatchRowNumber": 124,
                "afterPatchRowNumber": 126,
                "PatchRowcode": "         if http_status == 401:"
            },
            "69": {
                "beforePatchRowNumber": 125,
                "afterPatchRowNumber": 127,
                "PatchRowcode": "             raise OpenStackApiAuthenticationException(response=response)"
            },
            "70": {
                "beforePatchRowNumber": 126,
                "afterPatchRowNumber": 128,
                "PatchRowcode": " "
            },
            "71": {
                "beforePatchRowNumber": 127,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        auth_headers = {}"
            },
            "72": {
                "beforePatchRowNumber": 128,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        for k, v in response.getheaders():"
            },
            "73": {
                "beforePatchRowNumber": 129,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            auth_headers[k] = v"
            },
            "74": {
                "beforePatchRowNumber": 130,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-"
            },
            "75": {
                "beforePatchRowNumber": 131,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.auth_result = auth_headers"
            },
            "76": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 129,
                "PatchRowcode": "+        self.auth_result = response.headers"
            },
            "77": {
                "beforePatchRowNumber": 132,
                "afterPatchRowNumber": 130,
                "PatchRowcode": "         return self.auth_result"
            },
            "78": {
                "beforePatchRowNumber": 133,
                "afterPatchRowNumber": 131,
                "PatchRowcode": " "
            },
            "79": {
                "beforePatchRowNumber": 134,
                "afterPatchRowNumber": 132,
                "PatchRowcode": "     def api_request(self, relative_uri, check_response_status=None, **kwargs):"
            },
            "80": {
                "beforePatchRowNumber": 144,
                "afterPatchRowNumber": 142,
                "PatchRowcode": " "
            },
            "81": {
                "beforePatchRowNumber": 145,
                "afterPatchRowNumber": 143,
                "PatchRowcode": "         response = self.request(full_uri, **kwargs)"
            },
            "82": {
                "beforePatchRowNumber": 146,
                "afterPatchRowNumber": 144,
                "PatchRowcode": " "
            },
            "83": {
                "beforePatchRowNumber": 147,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        http_status = response.status"
            },
            "84": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 145,
                "PatchRowcode": "+        http_status = response.status_code"
            },
            "85": {
                "beforePatchRowNumber": 148,
                "afterPatchRowNumber": 146,
                "PatchRowcode": "         LOG.debug(_(\"%(relative_uri)s => code %(http_status)s\"),"
            },
            "86": {
                "beforePatchRowNumber": 149,
                "afterPatchRowNumber": 147,
                "PatchRowcode": "                   {'relative_uri': relative_uri, 'http_status': http_status})"
            },
            "87": {
                "beforePatchRowNumber": 150,
                "afterPatchRowNumber": 148,
                "PatchRowcode": " "
            },
            "88": {
                "beforePatchRowNumber": 162,
                "afterPatchRowNumber": 160,
                "PatchRowcode": "         return response"
            },
            "89": {
                "beforePatchRowNumber": 163,
                "afterPatchRowNumber": 161,
                "PatchRowcode": " "
            },
            "90": {
                "beforePatchRowNumber": 164,
                "afterPatchRowNumber": 162,
                "PatchRowcode": "     def _decode_json(self, response):"
            },
            "91": {
                "beforePatchRowNumber": 165,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        body = response.read()"
            },
            "92": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 163,
                "PatchRowcode": "+        body = response.text"
            },
            "93": {
                "beforePatchRowNumber": 166,
                "afterPatchRowNumber": 164,
                "PatchRowcode": "         LOG.debug(_(\"Decoding JSON: %s\") % (body))"
            },
            "94": {
                "beforePatchRowNumber": 167,
                "afterPatchRowNumber": 165,
                "PatchRowcode": "         if body:"
            },
            "95": {
                "beforePatchRowNumber": 168,
                "afterPatchRowNumber": 166,
                "PatchRowcode": "             return jsonutils.loads(body)"
            }
        },
        "frontPatchFile": [
            "#    Copyright (c) 2011 Justin Santa Barbara",
            "#",
            "#    Licensed under the Apache License, Version 2.0 (the \"License\"); you may",
            "#    not use this file except in compliance with the License. You may obtain",
            "#    a copy of the License at",
            "#",
            "#         http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "#    Unless required by applicable law or agreed to in writing, software",
            "#    distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
            "#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
            "#    License for the specific language governing permissions and limitations",
            "#    under the License.",
            "",
            "import httplib",
            "import urlparse",
            "",
            "from cinder.openstack.common import jsonutils",
            "from cinder.openstack.common import log as logging",
            "",
            "",
            "LOG = logging.getLogger(__name__)",
            "",
            "",
            "class OpenStackApiException(Exception):",
            "    def __init__(self, message=None, response=None):",
            "        self.response = response",
            "        if not message:",
            "            message = 'Unspecified error'",
            "",
            "        if response:",
            "            message = _('%(message)s\\nStatus Code: %(_status)s\\n'",
            "                        'Body: %(_body)s') % {'_status': response.status,",
            "                                              '_body': response.read()}",
            "",
            "        super(OpenStackApiException, self).__init__(message)",
            "",
            "",
            "class OpenStackApiAuthenticationException(OpenStackApiException):",
            "    def __init__(self, response=None, message=None):",
            "        if not message:",
            "            message = _(\"Authentication error\")",
            "        super(OpenStackApiAuthenticationException, self).__init__(message,",
            "                                                                  response)",
            "",
            "",
            "class OpenStackApiAuthorizationException(OpenStackApiException):",
            "    def __init__(self, response=None, message=None):",
            "        if not message:",
            "            message = _(\"Authorization error\")",
            "        super(OpenStackApiAuthorizationException, self).__init__(message,",
            "                                                                 response)",
            "",
            "",
            "class OpenStackApiNotFoundException(OpenStackApiException):",
            "    def __init__(self, response=None, message=None):",
            "        if not message:",
            "            message = _(\"Item not found\")",
            "        super(OpenStackApiNotFoundException, self).__init__(message, response)",
            "",
            "",
            "class TestOpenStackClient(object):",
            "    \"\"\"Simple OpenStack API Client.",
            "",
            "    This is a really basic OpenStack API client that is under our control,",
            "    so we can make changes / insert hooks for testing",
            "",
            "    \"\"\"",
            "",
            "    def __init__(self, auth_user, auth_key, auth_uri):",
            "        super(TestOpenStackClient, self).__init__()",
            "        self.auth_result = None",
            "        self.auth_user = auth_user",
            "        self.auth_key = auth_key",
            "        self.auth_uri = auth_uri",
            "        # default project_id",
            "        self.project_id = 'openstack'",
            "",
            "    def request(self, url, method='GET', body=None, headers=None):",
            "        _headers = {'Content-Type': 'application/json'}",
            "        _headers.update(headers or {})",
            "",
            "        parsed_url = urlparse.urlparse(url)",
            "        port = parsed_url.port",
            "        hostname = parsed_url.hostname",
            "        scheme = parsed_url.scheme",
            "",
            "        if scheme == 'http':",
            "            conn = httplib.HTTPConnection(hostname,",
            "                                          port=port)",
            "        elif scheme == 'https':",
            "            conn = httplib.HTTPSConnection(hostname,",
            "                                           port=port)",
            "        else:",
            "            raise OpenStackApiException(\"Unknown scheme: %s\" % url)",
            "",
            "        relative_url = parsed_url.path",
            "        if parsed_url.query:",
            "            relative_url = relative_url + \"?\" + parsed_url.query",
            "        LOG.info(_(\"Doing %(method)s on %(relative_url)s\"),",
            "                 {'method': method, 'relative_url': relative_url})",
            "        if body:",
            "            LOG.info(_(\"Body: %s\") % body)",
            "",
            "        conn.request(method, relative_url, body, _headers)",
            "        response = conn.getresponse()",
            "        return response",
            "",
            "    def _authenticate(self):",
            "        if self.auth_result:",
            "            return self.auth_result",
            "",
            "        auth_uri = self.auth_uri",
            "        headers = {'X-Auth-User': self.auth_user,",
            "                   'X-Auth-Key': self.auth_key,",
            "                   'X-Auth-Project-Id': self.project_id}",
            "        response = self.request(auth_uri,",
            "                                headers=headers)",
            "",
            "        http_status = response.status",
            "        LOG.debug(_(\"%(auth_uri)s => code %(http_status)s\"),",
            "                  {'auth_uri': auth_uri, 'http_status': http_status})",
            "",
            "        if http_status == 401:",
            "            raise OpenStackApiAuthenticationException(response=response)",
            "",
            "        auth_headers = {}",
            "        for k, v in response.getheaders():",
            "            auth_headers[k] = v",
            "",
            "        self.auth_result = auth_headers",
            "        return self.auth_result",
            "",
            "    def api_request(self, relative_uri, check_response_status=None, **kwargs):",
            "        auth_result = self._authenticate()",
            "",
            "        # NOTE(justinsb): httplib 'helpfully' converts headers to lower case",
            "        base_uri = auth_result['x-server-management-url']",
            "",
            "        full_uri = '%s/%s' % (base_uri, relative_uri)",
            "",
            "        headers = kwargs.setdefault('headers', {})",
            "        headers['X-Auth-Token'] = auth_result['x-auth-token']",
            "",
            "        response = self.request(full_uri, **kwargs)",
            "",
            "        http_status = response.status",
            "        LOG.debug(_(\"%(relative_uri)s => code %(http_status)s\"),",
            "                  {'relative_uri': relative_uri, 'http_status': http_status})",
            "",
            "        if check_response_status:",
            "            if http_status not in check_response_status:",
            "                if http_status == 404:",
            "                    raise OpenStackApiNotFoundException(response=response)",
            "                elif http_status == 401:",
            "                    raise OpenStackApiAuthorizationException(response=response)",
            "                else:",
            "                    raise OpenStackApiException(",
            "                        message=_(\"Unexpected status code\"),",
            "                        response=response)",
            "",
            "        return response",
            "",
            "    def _decode_json(self, response):",
            "        body = response.read()",
            "        LOG.debug(_(\"Decoding JSON: %s\") % (body))",
            "        if body:",
            "            return jsonutils.loads(body)",
            "        else:",
            "            return \"\"",
            "",
            "    def api_get(self, relative_uri, **kwargs):",
            "        kwargs.setdefault('check_response_status', [200])",
            "        response = self.api_request(relative_uri, **kwargs)",
            "        return self._decode_json(response)",
            "",
            "    def api_post(self, relative_uri, body, **kwargs):",
            "        kwargs['method'] = 'POST'",
            "        if body:",
            "            headers = kwargs.setdefault('headers', {})",
            "            headers['Content-Type'] = 'application/json'",
            "            kwargs['body'] = jsonutils.dumps(body)",
            "",
            "        kwargs.setdefault('check_response_status', [200, 202])",
            "        response = self.api_request(relative_uri, **kwargs)",
            "        return self._decode_json(response)",
            "",
            "    def api_put(self, relative_uri, body, **kwargs):",
            "        kwargs['method'] = 'PUT'",
            "        if body:",
            "            headers = kwargs.setdefault('headers', {})",
            "            headers['Content-Type'] = 'application/json'",
            "            kwargs['body'] = jsonutils.dumps(body)",
            "",
            "        kwargs.setdefault('check_response_status', [200, 202, 204])",
            "        response = self.api_request(relative_uri, **kwargs)",
            "        return self._decode_json(response)",
            "",
            "    def api_delete(self, relative_uri, **kwargs):",
            "        kwargs['method'] = 'DELETE'",
            "        kwargs.setdefault('check_response_status', [200, 202, 204])",
            "        return self.api_request(relative_uri, **kwargs)",
            "",
            "    def get_volume(self, volume_id):",
            "        return self.api_get('/volumes/%s' % volume_id)['volume']",
            "",
            "    def get_volumes(self, detail=True):",
            "        rel_url = '/volumes/detail' if detail else '/volumes'",
            "        return self.api_get(rel_url)['volumes']",
            "",
            "    def post_volume(self, volume):",
            "        return self.api_post('/volumes', volume)['volume']",
            "",
            "    def delete_volume(self, volume_id):",
            "        return self.api_delete('/volumes/%s' % volume_id)",
            "",
            "    def put_volume(self, volume_id, volume):",
            "        return self.api_put('/volumes/%s' % volume_id, volume)['volume']"
        ],
        "afterPatchFile": [
            "#    Copyright (c) 2011 Justin Santa Barbara",
            "#",
            "#    Licensed under the Apache License, Version 2.0 (the \"License\"); you may",
            "#    not use this file except in compliance with the License. You may obtain",
            "#    a copy of the License at",
            "#",
            "#         http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "#    Unless required by applicable law or agreed to in writing, software",
            "#    distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
            "#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
            "#    License for the specific language governing permissions and limitations",
            "#    under the License.",
            "",
            "import netaddr",
            "import requests",
            "import urlparse",
            "",
            "from cinder.openstack.common import jsonutils",
            "from cinder.openstack.common import log as logging",
            "",
            "",
            "LOG = logging.getLogger(__name__)",
            "",
            "",
            "class OpenStackApiException(Exception):",
            "    def __init__(self, message=None, response=None):",
            "        self.response = response",
            "        if not message:",
            "            message = 'Unspecified error'",
            "",
            "        if response:",
            "            message = _('%(message)s\\nStatus Code: %(_status)s\\n'",
            "                        'Body: %(_body)s') % {'_status': response.status_code,",
            "                                              '_body': response.text}",
            "",
            "        super(OpenStackApiException, self).__init__(message)",
            "",
            "",
            "class OpenStackApiAuthenticationException(OpenStackApiException):",
            "    def __init__(self, response=None, message=None):",
            "        if not message:",
            "            message = _(\"Authentication error\")",
            "        super(OpenStackApiAuthenticationException, self).__init__(message,",
            "                                                                  response)",
            "",
            "",
            "class OpenStackApiAuthorizationException(OpenStackApiException):",
            "    def __init__(self, response=None, message=None):",
            "        if not message:",
            "            message = _(\"Authorization error\")",
            "        super(OpenStackApiAuthorizationException, self).__init__(message,",
            "                                                                 response)",
            "",
            "",
            "class OpenStackApiNotFoundException(OpenStackApiException):",
            "    def __init__(self, response=None, message=None):",
            "        if not message:",
            "            message = _(\"Item not found\")",
            "        super(OpenStackApiNotFoundException, self).__init__(message, response)",
            "",
            "",
            "class TestOpenStackClient(object):",
            "    \"\"\"Simple OpenStack API Client.",
            "",
            "    This is a really basic OpenStack API client that is under our control,",
            "    so we can make changes / insert hooks for testing",
            "",
            "    \"\"\"",
            "",
            "    def __init__(self, auth_user, auth_key, auth_uri):",
            "        super(TestOpenStackClient, self).__init__()",
            "        self.auth_result = None",
            "        self.auth_user = auth_user",
            "        self.auth_key = auth_key",
            "        self.auth_uri = auth_uri",
            "        # default project_id",
            "        self.project_id = 'openstack'",
            "",
            "    def request(self, url, method='GET', body=None, headers=None,",
            "                ssl_verify=True, stream=False):",
            "        _headers = {'Content-Type': 'application/json'}",
            "        _headers.update(headers or {})",
            "",
            "        parsed_url = urlparse.urlparse(url)",
            "        port = parsed_url.port",
            "        hostname = parsed_url.hostname",
            "        scheme = parsed_url.scheme",
            "",
            "        if netaddr.valid_ipv6(hostname):",
            "            hostname = \"[%s]\" % hostname",
            "",
            "        relative_url = parsed_url.path",
            "        if parsed_url.query:",
            "            relative_url = relative_url + \"?\" + parsed_url.query",
            "        LOG.info(_(\"Doing %(method)s on %(relative_url)s\"),",
            "                 {'method': method, 'relative_url': relative_url})",
            "        if body:",
            "            LOG.info(_(\"Body: %s\") % body)",
            "",
            "        if port:",
            "            _url = \"%s://%s:%d%s\" % (scheme, hostname, int(port), relative_url)",
            "        else:",
            "            _url = \"%s://%s%s\" % (scheme, hostname, relative_url)",
            "",
            "        response = requests.request(method, _url, data=body, headers=_headers,",
            "                                    verify=ssl_verify, stream=stream)",
            "",
            "        return response",
            "",
            "    def _authenticate(self):",
            "        if self.auth_result:",
            "            return self.auth_result",
            "",
            "        auth_uri = self.auth_uri",
            "        headers = {'X-Auth-User': self.auth_user,",
            "                   'X-Auth-Key': self.auth_key,",
            "                   'X-Auth-Project-Id': self.project_id}",
            "        response = self.request(auth_uri,",
            "                                headers=headers)",
            "",
            "        http_status = response.status_code",
            "        LOG.debug(_(\"%(auth_uri)s => code %(http_status)s\"),",
            "                  {'auth_uri': auth_uri, 'http_status': http_status})",
            "",
            "        if http_status == 401:",
            "            raise OpenStackApiAuthenticationException(response=response)",
            "",
            "        self.auth_result = response.headers",
            "        return self.auth_result",
            "",
            "    def api_request(self, relative_uri, check_response_status=None, **kwargs):",
            "        auth_result = self._authenticate()",
            "",
            "        # NOTE(justinsb): httplib 'helpfully' converts headers to lower case",
            "        base_uri = auth_result['x-server-management-url']",
            "",
            "        full_uri = '%s/%s' % (base_uri, relative_uri)",
            "",
            "        headers = kwargs.setdefault('headers', {})",
            "        headers['X-Auth-Token'] = auth_result['x-auth-token']",
            "",
            "        response = self.request(full_uri, **kwargs)",
            "",
            "        http_status = response.status_code",
            "        LOG.debug(_(\"%(relative_uri)s => code %(http_status)s\"),",
            "                  {'relative_uri': relative_uri, 'http_status': http_status})",
            "",
            "        if check_response_status:",
            "            if http_status not in check_response_status:",
            "                if http_status == 404:",
            "                    raise OpenStackApiNotFoundException(response=response)",
            "                elif http_status == 401:",
            "                    raise OpenStackApiAuthorizationException(response=response)",
            "                else:",
            "                    raise OpenStackApiException(",
            "                        message=_(\"Unexpected status code\"),",
            "                        response=response)",
            "",
            "        return response",
            "",
            "    def _decode_json(self, response):",
            "        body = response.text",
            "        LOG.debug(_(\"Decoding JSON: %s\") % (body))",
            "        if body:",
            "            return jsonutils.loads(body)",
            "        else:",
            "            return \"\"",
            "",
            "    def api_get(self, relative_uri, **kwargs):",
            "        kwargs.setdefault('check_response_status', [200])",
            "        response = self.api_request(relative_uri, **kwargs)",
            "        return self._decode_json(response)",
            "",
            "    def api_post(self, relative_uri, body, **kwargs):",
            "        kwargs['method'] = 'POST'",
            "        if body:",
            "            headers = kwargs.setdefault('headers', {})",
            "            headers['Content-Type'] = 'application/json'",
            "            kwargs['body'] = jsonutils.dumps(body)",
            "",
            "        kwargs.setdefault('check_response_status', [200, 202])",
            "        response = self.api_request(relative_uri, **kwargs)",
            "        return self._decode_json(response)",
            "",
            "    def api_put(self, relative_uri, body, **kwargs):",
            "        kwargs['method'] = 'PUT'",
            "        if body:",
            "            headers = kwargs.setdefault('headers', {})",
            "            headers['Content-Type'] = 'application/json'",
            "            kwargs['body'] = jsonutils.dumps(body)",
            "",
            "        kwargs.setdefault('check_response_status', [200, 202, 204])",
            "        response = self.api_request(relative_uri, **kwargs)",
            "        return self._decode_json(response)",
            "",
            "    def api_delete(self, relative_uri, **kwargs):",
            "        kwargs['method'] = 'DELETE'",
            "        kwargs.setdefault('check_response_status', [200, 202, 204])",
            "        return self.api_request(relative_uri, **kwargs)",
            "",
            "    def get_volume(self, volume_id):",
            "        return self.api_get('/volumes/%s' % volume_id)['volume']",
            "",
            "    def get_volumes(self, detail=True):",
            "        rel_url = '/volumes/detail' if detail else '/volumes'",
            "        return self.api_get(rel_url)['volumes']",
            "",
            "    def post_volume(self, volume):",
            "        return self.api_post('/volumes', volume)['volume']",
            "",
            "    def delete_volume(self, volume_id):",
            "        return self.api_delete('/volumes/%s' % volume_id)",
            "",
            "    def put_volume(self, volume_id, volume):",
            "        return self.api_put('/volumes/%s' % volume_id, volume)['volume']"
        ],
        "action": [
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "15": [],
            "33": [
                "OpenStackApiException",
                "__init__"
            ],
            "34": [
                "OpenStackApiException",
                "__init__"
            ],
            "79": [
                "TestOpenStackClient",
                "request"
            ],
            "88": [
                "TestOpenStackClient",
                "request"
            ],
            "89": [
                "TestOpenStackClient",
                "request"
            ],
            "90": [
                "TestOpenStackClient",
                "request"
            ],
            "91": [
                "TestOpenStackClient",
                "request"
            ],
            "92": [
                "TestOpenStackClient",
                "request"
            ],
            "93": [
                "TestOpenStackClient",
                "request"
            ],
            "94": [
                "TestOpenStackClient",
                "request"
            ],
            "95": [
                "TestOpenStackClient",
                "request"
            ],
            "105": [
                "TestOpenStackClient",
                "request"
            ],
            "106": [
                "TestOpenStackClient",
                "request"
            ],
            "120": [
                "TestOpenStackClient",
                "_authenticate"
            ],
            "127": [
                "TestOpenStackClient",
                "_authenticate"
            ],
            "128": [
                "TestOpenStackClient",
                "_authenticate"
            ],
            "129": [
                "TestOpenStackClient",
                "_authenticate"
            ],
            "130": [
                "TestOpenStackClient",
                "_authenticate"
            ],
            "131": [
                "TestOpenStackClient",
                "_authenticate"
            ],
            "147": [
                "TestOpenStackClient",
                "api_request"
            ],
            "165": [
                "TestOpenStackClient",
                "_decode_json"
            ]
        },
        "addLocation": []
    },
    "cinder/tests/integrated/test_extensions.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 36,
                "afterPatchRowNumber": 36,
                "PatchRowcode": "     def test_get_foxnsocks(self):"
            },
            "1": {
                "beforePatchRowNumber": 37,
                "afterPatchRowNumber": 37,
                "PatchRowcode": "         \"\"\"Simple check that fox-n-socks works.\"\"\""
            },
            "2": {
                "beforePatchRowNumber": 38,
                "afterPatchRowNumber": 38,
                "PatchRowcode": "         response = self.api.api_request('/foxnsocks')"
            },
            "3": {
                "beforePatchRowNumber": 39,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        foxnsocks = response.read()"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 39,
                "PatchRowcode": "+        foxnsocks = response.text"
            },
            "5": {
                "beforePatchRowNumber": 40,
                "afterPatchRowNumber": 40,
                "PatchRowcode": "         LOG.debug(\"foxnsocks: %s\" % foxnsocks)"
            },
            "6": {
                "beforePatchRowNumber": 41,
                "afterPatchRowNumber": 41,
                "PatchRowcode": "         self.assertEqual('Try to say this Mr. Knox, sir...', foxnsocks)"
            }
        },
        "frontPatchFile": [
            "# Copyright 2011 Justin Santa Barbara",
            "# All Rights Reserved.",
            "#",
            "#    Licensed under the Apache License, Version 2.0 (the \"License\"); you may",
            "#    not use this file except in compliance with the License. You may obtain",
            "#    a copy of the License at",
            "#",
            "#         http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "#    Unless required by applicable law or agreed to in writing, software",
            "#    distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
            "#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
            "#    License for the specific language governing permissions and limitations",
            "#    under the License.",
            "",
            "",
            "from oslo.config import cfg",
            "",
            "from cinder.openstack.common import log as logging",
            "from cinder.tests.integrated import integrated_helpers",
            "",
            "",
            "CONF = cfg.CONF",
            "",
            "LOG = logging.getLogger(__name__)",
            "",
            "",
            "class ExtensionsTest(integrated_helpers._IntegratedTestBase):",
            "    def _get_flags(self):",
            "        f = super(ExtensionsTest, self)._get_flags()",
            "        f['osapi_volume_extension'] = CONF.osapi_volume_extension[:]",
            "        f['osapi_volume_extension'].append(",
            "            'cinder.tests.api.extensions.foxinsocks.Foxinsocks')",
            "        return f",
            "",
            "    def test_get_foxnsocks(self):",
            "        \"\"\"Simple check that fox-n-socks works.\"\"\"",
            "        response = self.api.api_request('/foxnsocks')",
            "        foxnsocks = response.read()",
            "        LOG.debug(\"foxnsocks: %s\" % foxnsocks)",
            "        self.assertEqual('Try to say this Mr. Knox, sir...', foxnsocks)"
        ],
        "afterPatchFile": [
            "# Copyright 2011 Justin Santa Barbara",
            "# All Rights Reserved.",
            "#",
            "#    Licensed under the Apache License, Version 2.0 (the \"License\"); you may",
            "#    not use this file except in compliance with the License. You may obtain",
            "#    a copy of the License at",
            "#",
            "#         http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "#    Unless required by applicable law or agreed to in writing, software",
            "#    distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
            "#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
            "#    License for the specific language governing permissions and limitations",
            "#    under the License.",
            "",
            "",
            "from oslo.config import cfg",
            "",
            "from cinder.openstack.common import log as logging",
            "from cinder.tests.integrated import integrated_helpers",
            "",
            "",
            "CONF = cfg.CONF",
            "",
            "LOG = logging.getLogger(__name__)",
            "",
            "",
            "class ExtensionsTest(integrated_helpers._IntegratedTestBase):",
            "    def _get_flags(self):",
            "        f = super(ExtensionsTest, self)._get_flags()",
            "        f['osapi_volume_extension'] = CONF.osapi_volume_extension[:]",
            "        f['osapi_volume_extension'].append(",
            "            'cinder.tests.api.extensions.foxinsocks.Foxinsocks')",
            "        return f",
            "",
            "    def test_get_foxnsocks(self):",
            "        \"\"\"Simple check that fox-n-socks works.\"\"\"",
            "        response = self.api.api_request('/foxnsocks')",
            "        foxnsocks = response.text",
            "        LOG.debug(\"foxnsocks: %s\" % foxnsocks)",
            "        self.assertEqual('Try to say this Mr. Knox, sir...', foxnsocks)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "39": [
                "ExtensionsTest",
                "test_get_foxnsocks"
            ]
        },
        "addLocation": []
    },
    "cinder/tests/integrated/test_xml.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 42,
                "afterPatchRowNumber": 42,
                "PatchRowcode": "         headers = {}"
            },
            "1": {
                "beforePatchRowNumber": 43,
                "afterPatchRowNumber": 43,
                "PatchRowcode": "         headers['Accept'] = 'application/xml'"
            },
            "2": {
                "beforePatchRowNumber": 44,
                "afterPatchRowNumber": 44,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": 45,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        response = self.api.api_request('/volumes', headers=headers)"
            },
            "4": {
                "beforePatchRowNumber": 46,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        data = response.read()"
            },
            "5": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 45,
                "PatchRowcode": "+        response = self.api.api_request('/volumes', headers=headers,"
            },
            "6": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 46,
                "PatchRowcode": "+                                        stream=True)"
            },
            "7": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 47,
                "PatchRowcode": "+        data = response.raw"
            },
            "8": {
                "beforePatchRowNumber": 47,
                "afterPatchRowNumber": 48,
                "PatchRowcode": "         LOG.warn(\"data: %s\" % data)"
            },
            "9": {
                "beforePatchRowNumber": 48,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        root = etree.XML(data)"
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 49,
                "PatchRowcode": "+        root = etree.parse(data).getroot()"
            },
            "11": {
                "beforePatchRowNumber": 49,
                "afterPatchRowNumber": 50,
                "PatchRowcode": "         self.assertEqual(root.nsmap.get(None), common.XML_NS_V1)"
            }
        },
        "frontPatchFile": [
            "# Copyright 2011 Justin Santa Barbara",
            "# All Rights Reserved.",
            "#",
            "#    Licensed under the Apache License, Version 2.0 (the \"License\"); you may",
            "#    not use this file except in compliance with the License. You may obtain",
            "#    a copy of the License at",
            "#",
            "#         http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "#    Unless required by applicable law or agreed to in writing, software",
            "#    distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
            "#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
            "#    License for the specific language governing permissions and limitations",
            "#    under the License.",
            "",
            "from lxml import etree",
            "",
            "from cinder.api import common",
            "from cinder.openstack.common import log as logging",
            "from cinder.tests.integrated import integrated_helpers",
            "",
            "",
            "LOG = logging.getLogger(__name__)",
            "",
            "",
            "class XmlTests(integrated_helpers._IntegratedTestBase):",
            "    \"\"\"\"Some basic XML sanity checks.\"\"\"",
            "",
            "    # FIXME(ja): does cinder need limits?",
            "    # def test_namespace_limits(self):",
            "    #     headers = {}",
            "    #     headers['Accept'] = 'application/xml'",
            "",
            "    #     response = self.api.api_request('/limits', headers=headers)",
            "    #     data = response.read()",
            "    #     LOG.debug(\"data: %s\" % data)",
            "    #     root = etree.XML(data)",
            "    #     self.assertEqual(root.nsmap.get(None), xmlutil.XMLNS_COMMON_V10)",
            "",
            "    def test_namespace_volumes(self):",
            "        \"\"\"/servers should have v1.1 namespace (has changed in 1.1).\"\"\"",
            "        headers = {}",
            "        headers['Accept'] = 'application/xml'",
            "",
            "        response = self.api.api_request('/volumes', headers=headers)",
            "        data = response.read()",
            "        LOG.warn(\"data: %s\" % data)",
            "        root = etree.XML(data)",
            "        self.assertEqual(root.nsmap.get(None), common.XML_NS_V1)"
        ],
        "afterPatchFile": [
            "# Copyright 2011 Justin Santa Barbara",
            "# All Rights Reserved.",
            "#",
            "#    Licensed under the Apache License, Version 2.0 (the \"License\"); you may",
            "#    not use this file except in compliance with the License. You may obtain",
            "#    a copy of the License at",
            "#",
            "#         http://www.apache.org/licenses/LICENSE-2.0",
            "#",
            "#    Unless required by applicable law or agreed to in writing, software",
            "#    distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT",
            "#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the",
            "#    License for the specific language governing permissions and limitations",
            "#    under the License.",
            "",
            "from lxml import etree",
            "",
            "from cinder.api import common",
            "from cinder.openstack.common import log as logging",
            "from cinder.tests.integrated import integrated_helpers",
            "",
            "",
            "LOG = logging.getLogger(__name__)",
            "",
            "",
            "class XmlTests(integrated_helpers._IntegratedTestBase):",
            "    \"\"\"\"Some basic XML sanity checks.\"\"\"",
            "",
            "    # FIXME(ja): does cinder need limits?",
            "    # def test_namespace_limits(self):",
            "    #     headers = {}",
            "    #     headers['Accept'] = 'application/xml'",
            "",
            "    #     response = self.api.api_request('/limits', headers=headers)",
            "    #     data = response.read()",
            "    #     LOG.debug(\"data: %s\" % data)",
            "    #     root = etree.XML(data)",
            "    #     self.assertEqual(root.nsmap.get(None), xmlutil.XMLNS_COMMON_V10)",
            "",
            "    def test_namespace_volumes(self):",
            "        \"\"\"/servers should have v1.1 namespace (has changed in 1.1).\"\"\"",
            "        headers = {}",
            "        headers['Accept'] = 'application/xml'",
            "",
            "        response = self.api.api_request('/volumes', headers=headers,",
            "                                        stream=True)",
            "        data = response.raw",
            "        LOG.warn(\"data: %s\" % data)",
            "        root = etree.parse(data).getroot()",
            "        self.assertEqual(root.nsmap.get(None), common.XML_NS_V1)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "2",
            "2",
            "0"
        ],
        "dele_reviseLocation": {
            "45": [
                "XmlTests",
                "test_namespace_volumes"
            ],
            "46": [
                "XmlTests",
                "test_namespace_volumes"
            ],
            "48": [
                "XmlTests",
                "test_namespace_volumes"
            ]
        },
        "addLocation": []
    }
}