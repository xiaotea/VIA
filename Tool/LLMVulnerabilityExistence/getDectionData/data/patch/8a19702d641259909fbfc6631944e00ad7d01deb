{
    "Products/CMFDiffTool/BinaryDiff.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 3,
                "afterPatchRowNumber": 3,
                "PatchRowcode": " from os import linesep"
            },
            "1": {
                "beforePatchRowNumber": 4,
                "afterPatchRowNumber": 4,
                "PatchRowcode": " from Products.CMFDiffTool.BaseDiff import _getValue"
            },
            "2": {
                "beforePatchRowNumber": 5,
                "afterPatchRowNumber": 5,
                "PatchRowcode": " from Products.CMFDiffTool.FieldDiff import FieldDiff"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 6,
                "PatchRowcode": "+from Products.CMFDiffTool.utils import html_encode"
            },
            "4": {
                "beforePatchRowNumber": 6,
                "afterPatchRowNumber": 7,
                "PatchRowcode": " "
            },
            "5": {
                "beforePatchRowNumber": 7,
                "afterPatchRowNumber": 8,
                "PatchRowcode": " "
            },
            "6": {
                "beforePatchRowNumber": 8,
                "afterPatchRowNumber": 9,
                "PatchRowcode": " class BinaryDiff(FieldDiff):"
            },
            "7": {
                "beforePatchRowNumber": 50,
                "afterPatchRowNumber": 51,
                "PatchRowcode": "         if self.oldFilename != self.newFilename:"
            },
            "8": {
                "beforePatchRowNumber": 51,
                "afterPatchRowNumber": 52,
                "PatchRowcode": "             html.append("
            },
            "9": {
                "beforePatchRowNumber": 52,
                "afterPatchRowNumber": 53,
                "PatchRowcode": "                 self.inlinediff_fmt % (css_class,"
            },
            "10": {
                "beforePatchRowNumber": 53,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                                       self.filenameTitle(self.oldFilename),"
            },
            "11": {
                "beforePatchRowNumber": 54,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                                       self.filenameTitle(self.newFilename)),"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 54,
                "PatchRowcode": "+                                       self.filenameTitle(html_encode(self.oldFilename)),"
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 55,
                "PatchRowcode": "+                                       self.filenameTitle(html_encode(self.newFilename))),"
            },
            "14": {
                "beforePatchRowNumber": 55,
                "afterPatchRowNumber": 56,
                "PatchRowcode": "             )"
            },
            "15": {
                "beforePatchRowNumber": 56,
                "afterPatchRowNumber": 57,
                "PatchRowcode": " "
            },
            "16": {
                "beforePatchRowNumber": 57,
                "afterPatchRowNumber": 58,
                "PatchRowcode": "         if html:"
            }
        },
        "frontPatchFile": [
            "# -*- coding: utf-8 -*-",
            "from AccessControl.class_init import InitializeClass",
            "from os import linesep",
            "from Products.CMFDiffTool.BaseDiff import _getValue",
            "from Products.CMFDiffTool.FieldDiff import FieldDiff",
            "",
            "",
            "class BinaryDiff(FieldDiff):",
            "    \"\"\"Simple binary difference\"\"\"",
            "",
            "    meta_type = 'Binary Diff'",
            "    inlinediff_fmt = \"\"\"",
            "<div class=\"%s\">",
            "    <del>%s</del>",
            "    <ins>%s</ins>",
            "</div>",
            "\"\"\"",
            "",
            "    def _parseField(self, value, filename=None):",
            "        \"\"\"Parse a field value in preparation for diffing\"\"\"",
            "        if filename is None:",
            "            # Since we only want to compare the filename for",
            "            # binary files, return an empty list",
            "            return []",
            "        else:",
            "            return [self.filenameTitle(filename)]",
            "",
            "    def testChanges(self, ob):",
            "        \"\"\"",
            "        Test the specified object to determine if the change set will",
            "        apply without errors",
            "        \"\"\"",
            "        value = _getValue(ob, self.field)",
            "        if not self.same and value != self.oldValue:",
            "            raise ValueError('Conflict Error during merge',",
            "                             self.field, value, self.oldValue)",
            "",
            "    def applyChanges(self, ob):",
            "        \"\"\"Update the specified object with the difference\"\"\"",
            "        # Simplistic update",
            "        self.testChanges(ob)",
            "        if not self.same:",
            "            setattr(ob, self.field, self.newValue)",
            "",
            "    def inline_diff(self):",
            "        \"\"\"Simple inline diff that just checks that the filename",
            "        has changed.\"\"\"",
            "        css_class = 'FilenameDiff'",
            "        html = []",
            "        if self.oldFilename != self.newFilename:",
            "            html.append(",
            "                self.inlinediff_fmt % (css_class,",
            "                                       self.filenameTitle(self.oldFilename),",
            "                                       self.filenameTitle(self.newFilename)),",
            "            )",
            "",
            "        if html:",
            "            return linesep.join(html)",
            "",
            "",
            "InitializeClass(BinaryDiff)"
        ],
        "afterPatchFile": [
            "# -*- coding: utf-8 -*-",
            "from AccessControl.class_init import InitializeClass",
            "from os import linesep",
            "from Products.CMFDiffTool.BaseDiff import _getValue",
            "from Products.CMFDiffTool.FieldDiff import FieldDiff",
            "from Products.CMFDiffTool.utils import html_encode",
            "",
            "",
            "class BinaryDiff(FieldDiff):",
            "    \"\"\"Simple binary difference\"\"\"",
            "",
            "    meta_type = 'Binary Diff'",
            "    inlinediff_fmt = \"\"\"",
            "<div class=\"%s\">",
            "    <del>%s</del>",
            "    <ins>%s</ins>",
            "</div>",
            "\"\"\"",
            "",
            "    def _parseField(self, value, filename=None):",
            "        \"\"\"Parse a field value in preparation for diffing\"\"\"",
            "        if filename is None:",
            "            # Since we only want to compare the filename for",
            "            # binary files, return an empty list",
            "            return []",
            "        else:",
            "            return [self.filenameTitle(filename)]",
            "",
            "    def testChanges(self, ob):",
            "        \"\"\"",
            "        Test the specified object to determine if the change set will",
            "        apply without errors",
            "        \"\"\"",
            "        value = _getValue(ob, self.field)",
            "        if not self.same and value != self.oldValue:",
            "            raise ValueError('Conflict Error during merge',",
            "                             self.field, value, self.oldValue)",
            "",
            "    def applyChanges(self, ob):",
            "        \"\"\"Update the specified object with the difference\"\"\"",
            "        # Simplistic update",
            "        self.testChanges(ob)",
            "        if not self.same:",
            "            setattr(ob, self.field, self.newValue)",
            "",
            "    def inline_diff(self):",
            "        \"\"\"Simple inline diff that just checks that the filename",
            "        has changed.\"\"\"",
            "        css_class = 'FilenameDiff'",
            "        html = []",
            "        if self.oldFilename != self.newFilename:",
            "            html.append(",
            "                self.inlinediff_fmt % (css_class,",
            "                                       self.filenameTitle(html_encode(self.oldFilename)),",
            "                                       self.filenameTitle(html_encode(self.newFilename))),",
            "            )",
            "",
            "        if html:",
            "            return linesep.join(html)",
            "",
            "",
            "InitializeClass(BinaryDiff)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "53": [
                "BinaryDiff",
                "inline_diff"
            ],
            "54": [
                "BinaryDiff",
                "inline_diff"
            ]
        },
        "addLocation": []
    },
    "Products/CMFDiffTool/CMFDTHtmlDiff.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 2,
                "afterPatchRowNumber": 2,
                "PatchRowcode": " from AccessControl.class_init import InitializeClass"
            },
            "1": {
                "beforePatchRowNumber": 3,
                "afterPatchRowNumber": 3,
                "PatchRowcode": " from Products.CMFDiffTool.libs import htmldiff"
            },
            "2": {
                "beforePatchRowNumber": 4,
                "afterPatchRowNumber": 4,
                "PatchRowcode": " from Products.CMFDiffTool.TextDiff import TextDiff"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 5,
                "PatchRowcode": "+from Products.CMFDiffTool.utils import html_encode"
            },
            "4": {
                "beforePatchRowNumber": 5,
                "afterPatchRowNumber": 6,
                "PatchRowcode": " "
            },
            "5": {
                "beforePatchRowNumber": 6,
                "afterPatchRowNumber": 7,
                "PatchRowcode": " "
            },
            "6": {
                "beforePatchRowNumber": 7,
                "afterPatchRowNumber": 8,
                "PatchRowcode": " # Give it a dumb name so it doesn't conflict with all the other html diffs"
            },
            "7": {
                "beforePatchRowNumber": 18,
                "afterPatchRowNumber": 19,
                "PatchRowcode": "                                        filename=self.oldFilename))"
            },
            "8": {
                "beforePatchRowNumber": 19,
                "afterPatchRowNumber": 20,
                "PatchRowcode": "         b = '\\n'.join(self._parseField(self.newValue,"
            },
            "9": {
                "beforePatchRowNumber": 20,
                "afterPatchRowNumber": 21,
                "PatchRowcode": "                                        filename=self.newFilename))"
            },
            "10": {
                "beforePatchRowNumber": 21,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        return htmldiff.htmldiff(a, b)"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 22,
                "PatchRowcode": "+        return htmldiff.htmldiff(html_encode(a), html_encode(b))"
            },
            "12": {
                "beforePatchRowNumber": 22,
                "afterPatchRowNumber": 23,
                "PatchRowcode": " "
            },
            "13": {
                "beforePatchRowNumber": 23,
                "afterPatchRowNumber": 24,
                "PatchRowcode": "     def _parseField(self, value, filename=None):"
            },
            "14": {
                "beforePatchRowNumber": 24,
                "afterPatchRowNumber": 25,
                "PatchRowcode": "         \"\"\"Use the field's raw value if available.\"\"\""
            }
        },
        "frontPatchFile": [
            "# -*- coding: utf-8 -*-",
            "from AccessControl.class_init import InitializeClass",
            "from Products.CMFDiffTool.libs import htmldiff",
            "from Products.CMFDiffTool.TextDiff import TextDiff",
            "",
            "",
            "# Give it a dumb name so it doesn't conflict with all the other html diffs",
            "# around.  This uses Ian Bicking's very nice htmldiff.py from Web Ware for",
            "# Python.",
            "class CMFDTHtmlDiff(TextDiff):",
            "    \"\"\"Text difference\"\"\"",
            "",
            "    meta_type = 'HTML Diff'",
            "",
            "    def inline_diff(self):",
            "        \"\"\"Return a specialized diff for HTML\"\"\"",
            "        a = '\\n'.join(self._parseField(self.oldValue,",
            "                                       filename=self.oldFilename))",
            "        b = '\\n'.join(self._parseField(self.newValue,",
            "                                       filename=self.newFilename))",
            "        return htmldiff.htmldiff(a, b)",
            "",
            "    def _parseField(self, value, filename=None):",
            "        \"\"\"Use the field's raw value if available.\"\"\"",
            "        if value is None:",
            "            value = ''",
            "        else:",
            "            value = getattr(value, 'raw', value)",
            "        return TextDiff._parseField(self, value, filename)",
            "",
            "",
            "InitializeClass(CMFDTHtmlDiff)"
        ],
        "afterPatchFile": [
            "# -*- coding: utf-8 -*-",
            "from AccessControl.class_init import InitializeClass",
            "from Products.CMFDiffTool.libs import htmldiff",
            "from Products.CMFDiffTool.TextDiff import TextDiff",
            "from Products.CMFDiffTool.utils import html_encode",
            "",
            "",
            "# Give it a dumb name so it doesn't conflict with all the other html diffs",
            "# around.  This uses Ian Bicking's very nice htmldiff.py from Web Ware for",
            "# Python.",
            "class CMFDTHtmlDiff(TextDiff):",
            "    \"\"\"Text difference\"\"\"",
            "",
            "    meta_type = 'HTML Diff'",
            "",
            "    def inline_diff(self):",
            "        \"\"\"Return a specialized diff for HTML\"\"\"",
            "        a = '\\n'.join(self._parseField(self.oldValue,",
            "                                       filename=self.oldFilename))",
            "        b = '\\n'.join(self._parseField(self.newValue,",
            "                                       filename=self.newFilename))",
            "        return htmldiff.htmldiff(html_encode(a), html_encode(b))",
            "",
            "    def _parseField(self, value, filename=None):",
            "        \"\"\"Use the field's raw value if available.\"\"\"",
            "        if value is None:",
            "            value = ''",
            "        else:",
            "            value = getattr(value, 'raw', value)",
            "        return TextDiff._parseField(self, value, filename)",
            "",
            "",
            "InitializeClass(CMFDTHtmlDiff)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "21": [
                "CMFDTHtmlDiff",
                "inline_diff"
            ]
        },
        "addLocation": []
    },
    "Products/CMFDiffTool/FieldDiff.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 2,
                "afterPatchRowNumber": 2,
                "PatchRowcode": " from AccessControl.class_init import InitializeClass"
            },
            "1": {
                "beforePatchRowNumber": 3,
                "afterPatchRowNumber": 3,
                "PatchRowcode": " from Products.CMFDiffTool.BaseDiff import _getValue"
            },
            "2": {
                "beforePatchRowNumber": 4,
                "afterPatchRowNumber": 4,
                "PatchRowcode": " from Products.CMFDiffTool.BaseDiff import BaseDiff"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 5,
                "PatchRowcode": "+from Products.CMFDiffTool.utils import html_encode"
            },
            "4": {
                "beforePatchRowNumber": 5,
                "afterPatchRowNumber": 6,
                "PatchRowcode": " from six.moves import range"
            },
            "5": {
                "beforePatchRowNumber": 6,
                "afterPatchRowNumber": 7,
                "PatchRowcode": " "
            },
            "6": {
                "beforePatchRowNumber": 7,
                "afterPatchRowNumber": 8,
                "PatchRowcode": " import difflib"
            },
            "7": {
                "beforePatchRowNumber": 80,
                "afterPatchRowNumber": 81,
                "PatchRowcode": "         for tag, alo, ahi, blo, bhi in self.getLineDiffs():"
            },
            "8": {
                "beforePatchRowNumber": 81,
                "afterPatchRowNumber": 82,
                "PatchRowcode": "             if tag == 'replace':"
            },
            "9": {
                "beforePatchRowNumber": 82,
                "afterPatchRowNumber": 83,
                "PatchRowcode": "                 for i in range(alo, ahi):"
            },
            "10": {
                "beforePatchRowNumber": 83,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    r.append(inlinediff_fmt % (css_class, a[i], ''))"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 84,
                "PatchRowcode": "+                    r.append(inlinediff_fmt % (css_class, html_encode(a[i]), ''))"
            },
            "12": {
                "beforePatchRowNumber": 84,
                "afterPatchRowNumber": 85,
                "PatchRowcode": "                 for i in range(blo, bhi):"
            },
            "13": {
                "beforePatchRowNumber": 85,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    r.append(inlinediff_fmt % (css_class, '', b[i]))"
            },
            "14": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 86,
                "PatchRowcode": "+                    r.append(inlinediff_fmt % (css_class, '', html_encode(b[i])))"
            },
            "15": {
                "beforePatchRowNumber": 86,
                "afterPatchRowNumber": 87,
                "PatchRowcode": "             elif tag == 'delete':"
            },
            "16": {
                "beforePatchRowNumber": 87,
                "afterPatchRowNumber": 88,
                "PatchRowcode": "                 for i in range(alo, ahi):"
            },
            "17": {
                "beforePatchRowNumber": 88,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    r.append(inlinediff_fmt % (css_class, a[i], ''))"
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 89,
                "PatchRowcode": "+                    r.append(inlinediff_fmt % (css_class, html_encode(a[i]), ''))"
            },
            "19": {
                "beforePatchRowNumber": 89,
                "afterPatchRowNumber": 90,
                "PatchRowcode": "             elif tag == 'insert':"
            },
            "20": {
                "beforePatchRowNumber": 90,
                "afterPatchRowNumber": 91,
                "PatchRowcode": "                 for i in range(blo, bhi):"
            },
            "21": {
                "beforePatchRowNumber": 91,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    r.append(inlinediff_fmt % (css_class, '', b[i]))"
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 92,
                "PatchRowcode": "+                    r.append(inlinediff_fmt % (css_class, '', html_encode(b[i])))"
            },
            "23": {
                "beforePatchRowNumber": 92,
                "afterPatchRowNumber": 93,
                "PatchRowcode": "             elif tag == 'equal':"
            },
            "24": {
                "beforePatchRowNumber": 93,
                "afterPatchRowNumber": 94,
                "PatchRowcode": "                 for i in range(alo, ahi):"
            },
            "25": {
                "beforePatchRowNumber": 94,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    r.append(same_fmt % (css_class, a[i]))"
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 95,
                "PatchRowcode": "+                    r.append(same_fmt % (css_class, html_encode(a[i])))"
            },
            "27": {
                "beforePatchRowNumber": 95,
                "afterPatchRowNumber": 96,
                "PatchRowcode": "             else:"
            },
            "28": {
                "beforePatchRowNumber": 96,
                "afterPatchRowNumber": 97,
                "PatchRowcode": "                 raise ValueError('unknown tag \"%s\"' % tag)"
            },
            "29": {
                "beforePatchRowNumber": 97,
                "afterPatchRowNumber": 98,
                "PatchRowcode": "         return '\\n'.join(r)"
            }
        },
        "frontPatchFile": [
            "# -*- coding: utf-8 -*-",
            "from AccessControl.class_init import InitializeClass",
            "from Products.CMFDiffTool.BaseDiff import _getValue",
            "from Products.CMFDiffTool.BaseDiff import BaseDiff",
            "from six.moves import range",
            "",
            "import difflib",
            "",
            "",
            "class FieldDiff(BaseDiff):",
            "    \"\"\"Text difference\"\"\"",
            "",
            "    meta_type = 'Field Diff'",
            "",
            "    same_fmt = \"\"\"<div class=\"%s\">%s</div>\"\"\"",
            "    inlinediff_fmt = \"\"\"<div class=\"%s\">",
            "    <div class=\"diff_sub\">%s</div>",
            "    <div class=\"diff_add\">%s</div>",
            "</div>\"\"\"",
            "",
            "    def _parseField(self, value, filename=None):",
            "        \"\"\"Parse a field value in preparation for diffing\"\"\"",
            "        if filename is None:",
            "            # Since we only want to compare a single field, make a",
            "            # one-item list out of it",
            "            return [value]",
            "        else:",
            "            return [",
            "                self.filenameTitle(filename),",
            "                value,",
            "            ]",
            "",
            "    def getLineDiffs(self):",
            "        a = self._parseField(self.oldValue, filename=self.oldFilename)",
            "        b = self._parseField(self.newValue, filename=self.newFilename)",
            "        return difflib.SequenceMatcher(None, a, b).get_opcodes()",
            "",
            "    def testChanges(self, ob):",
            "        \"\"\"",
            "        Test the specified object to determine if the change set",
            "        will apply without errors",
            "        \"\"\"",
            "        value = _getValue(ob, self.field)",
            "        if not self.same and value != self.oldValue:",
            "            raise ValueError('Conflict Error during merge',",
            "                             self.field, value, self.oldValue)",
            "",
            "    def applyChanges(self, ob):",
            "        \"\"\"Update the specified object with the difference\"\"\"",
            "        # Simplistic update",
            "        self.testChanges(ob)",
            "        if not self.same:",
            "            setattr(ob, self.field, self.newValue)",
            "",
            "    def ndiff(self):",
            "        \"\"\"Return a textual diff\"\"\"",
            "        r = []",
            "        a = self._parseField(self.oldValue, filename=self.oldFilename)",
            "        b = self._parseField(self.newValue, filename=self.newFilename)",
            "        for tag, alo, ahi, blo, bhi in self.getLineDiffs():",
            "            if tag == 'replace':",
            "                plain_replace(a, alo, ahi, b, blo, bhi, r)",
            "            elif tag == 'delete':",
            "                dump('-', a, alo, ahi, r)",
            "            elif tag == 'insert':",
            "                dump('+', b, blo, bhi, r)",
            "            elif tag == 'equal':",
            "                dump(' ', a, alo, ahi, r)",
            "            else:",
            "                raise ValueError('unknown tag %r', tag)",
            "        return '\\n'.join(r)",
            "",
            "    def inline_diff(self):",
            "        css_class = 'InlineDiff'",
            "        inlinediff_fmt = self.inlinediff_fmt",
            "        same_fmt = self.same_fmt",
            "        r = []",
            "        a = self._parseField(self.oldValue, filename=self.oldFilename)",
            "        b = self._parseField(self.newValue, filename=self.newFilename)",
            "        for tag, alo, ahi, blo, bhi in self.getLineDiffs():",
            "            if tag == 'replace':",
            "                for i in range(alo, ahi):",
            "                    r.append(inlinediff_fmt % (css_class, a[i], ''))",
            "                for i in range(blo, bhi):",
            "                    r.append(inlinediff_fmt % (css_class, '', b[i]))",
            "            elif tag == 'delete':",
            "                for i in range(alo, ahi):",
            "                    r.append(inlinediff_fmt % (css_class, a[i], ''))",
            "            elif tag == 'insert':",
            "                for i in range(blo, bhi):",
            "                    r.append(inlinediff_fmt % (css_class, '', b[i]))",
            "            elif tag == 'equal':",
            "                for i in range(alo, ahi):",
            "                    r.append(same_fmt % (css_class, a[i]))",
            "            else:",
            "                raise ValueError('unknown tag \"%s\"' % tag)",
            "        return '\\n'.join(r)",
            "",
            "",
            "InitializeClass(FieldDiff)",
            "",
            "",
            "def dump(tag, x, lo, hi, r):",
            "    for i in range(lo, hi):",
            "        r.append(tag + ' %s' % x[i])",
            "",
            "",
            "def plain_replace(a, alo, ahi, b, blo, bhi, r):",
            "    assert alo < ahi and blo < bhi",
            "    # dump the shorter block first -- reduces the burden on short-term",
            "    # memory if the blocks are of very different sizes",
            "    if bhi - blo < ahi - alo:",
            "        dump('+', b, blo, bhi, r)",
            "        dump('-', a, alo, ahi, r)",
            "    else:",
            "        dump('-', a, alo, ahi, r)",
            "        dump('+', b, blo, bhi, r)"
        ],
        "afterPatchFile": [
            "# -*- coding: utf-8 -*-",
            "from AccessControl.class_init import InitializeClass",
            "from Products.CMFDiffTool.BaseDiff import _getValue",
            "from Products.CMFDiffTool.BaseDiff import BaseDiff",
            "from Products.CMFDiffTool.utils import html_encode",
            "from six.moves import range",
            "",
            "import difflib",
            "",
            "",
            "class FieldDiff(BaseDiff):",
            "    \"\"\"Text difference\"\"\"",
            "",
            "    meta_type = 'Field Diff'",
            "",
            "    same_fmt = \"\"\"<div class=\"%s\">%s</div>\"\"\"",
            "    inlinediff_fmt = \"\"\"<div class=\"%s\">",
            "    <div class=\"diff_sub\">%s</div>",
            "    <div class=\"diff_add\">%s</div>",
            "</div>\"\"\"",
            "",
            "    def _parseField(self, value, filename=None):",
            "        \"\"\"Parse a field value in preparation for diffing\"\"\"",
            "        if filename is None:",
            "            # Since we only want to compare a single field, make a",
            "            # one-item list out of it",
            "            return [value]",
            "        else:",
            "            return [",
            "                self.filenameTitle(filename),",
            "                value,",
            "            ]",
            "",
            "    def getLineDiffs(self):",
            "        a = self._parseField(self.oldValue, filename=self.oldFilename)",
            "        b = self._parseField(self.newValue, filename=self.newFilename)",
            "        return difflib.SequenceMatcher(None, a, b).get_opcodes()",
            "",
            "    def testChanges(self, ob):",
            "        \"\"\"",
            "        Test the specified object to determine if the change set",
            "        will apply without errors",
            "        \"\"\"",
            "        value = _getValue(ob, self.field)",
            "        if not self.same and value != self.oldValue:",
            "            raise ValueError('Conflict Error during merge',",
            "                             self.field, value, self.oldValue)",
            "",
            "    def applyChanges(self, ob):",
            "        \"\"\"Update the specified object with the difference\"\"\"",
            "        # Simplistic update",
            "        self.testChanges(ob)",
            "        if not self.same:",
            "            setattr(ob, self.field, self.newValue)",
            "",
            "    def ndiff(self):",
            "        \"\"\"Return a textual diff\"\"\"",
            "        r = []",
            "        a = self._parseField(self.oldValue, filename=self.oldFilename)",
            "        b = self._parseField(self.newValue, filename=self.newFilename)",
            "        for tag, alo, ahi, blo, bhi in self.getLineDiffs():",
            "            if tag == 'replace':",
            "                plain_replace(a, alo, ahi, b, blo, bhi, r)",
            "            elif tag == 'delete':",
            "                dump('-', a, alo, ahi, r)",
            "            elif tag == 'insert':",
            "                dump('+', b, blo, bhi, r)",
            "            elif tag == 'equal':",
            "                dump(' ', a, alo, ahi, r)",
            "            else:",
            "                raise ValueError('unknown tag %r', tag)",
            "        return '\\n'.join(r)",
            "",
            "    def inline_diff(self):",
            "        css_class = 'InlineDiff'",
            "        inlinediff_fmt = self.inlinediff_fmt",
            "        same_fmt = self.same_fmt",
            "        r = []",
            "        a = self._parseField(self.oldValue, filename=self.oldFilename)",
            "        b = self._parseField(self.newValue, filename=self.newFilename)",
            "        for tag, alo, ahi, blo, bhi in self.getLineDiffs():",
            "            if tag == 'replace':",
            "                for i in range(alo, ahi):",
            "                    r.append(inlinediff_fmt % (css_class, html_encode(a[i]), ''))",
            "                for i in range(blo, bhi):",
            "                    r.append(inlinediff_fmt % (css_class, '', html_encode(b[i])))",
            "            elif tag == 'delete':",
            "                for i in range(alo, ahi):",
            "                    r.append(inlinediff_fmt % (css_class, html_encode(a[i]), ''))",
            "            elif tag == 'insert':",
            "                for i in range(blo, bhi):",
            "                    r.append(inlinediff_fmt % (css_class, '', html_encode(b[i])))",
            "            elif tag == 'equal':",
            "                for i in range(alo, ahi):",
            "                    r.append(same_fmt % (css_class, html_encode(a[i])))",
            "            else:",
            "                raise ValueError('unknown tag \"%s\"' % tag)",
            "        return '\\n'.join(r)",
            "",
            "",
            "InitializeClass(FieldDiff)",
            "",
            "",
            "def dump(tag, x, lo, hi, r):",
            "    for i in range(lo, hi):",
            "        r.append(tag + ' %s' % x[i])",
            "",
            "",
            "def plain_replace(a, alo, ahi, b, blo, bhi, r):",
            "    assert alo < ahi and blo < bhi",
            "    # dump the shorter block first -- reduces the burden on short-term",
            "    # memory if the blocks are of very different sizes",
            "    if bhi - blo < ahi - alo:",
            "        dump('+', b, blo, bhi, r)",
            "        dump('-', a, alo, ahi, r)",
            "    else:",
            "        dump('-', a, alo, ahi, r)",
            "        dump('+', b, blo, bhi, r)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "2",
            "2",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "83": [
                "FieldDiff",
                "inline_diff"
            ],
            "85": [
                "FieldDiff",
                "inline_diff"
            ],
            "88": [
                "FieldDiff",
                "inline_diff"
            ],
            "91": [
                "FieldDiff",
                "inline_diff"
            ],
            "94": [
                "FieldDiff",
                "inline_diff"
            ]
        },
        "addLocation": []
    },
    "Products/CMFDiffTool/ListDiff.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 4,
                "afterPatchRowNumber": 4,
                "PatchRowcode": " from Products.CMFDiffTool.choicediff import get_field_object"
            },
            "1": {
                "beforePatchRowNumber": 5,
                "afterPatchRowNumber": 5,
                "PatchRowcode": " from Products.CMFDiffTool.choicediff import title_or_value"
            },
            "2": {
                "beforePatchRowNumber": 6,
                "afterPatchRowNumber": 6,
                "PatchRowcode": " from Products.CMFDiffTool.FieldDiff import FieldDiff"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 7,
                "PatchRowcode": "+from Products.CMFDiffTool.utils import html_encode"
            },
            "4": {
                "beforePatchRowNumber": 7,
                "afterPatchRowNumber": 8,
                "PatchRowcode": " from six.moves import range"
            },
            "5": {
                "beforePatchRowNumber": 8,
                "afterPatchRowNumber": 9,
                "PatchRowcode": " "
            },
            "6": {
                "beforePatchRowNumber": 9,
                "afterPatchRowNumber": 10,
                "PatchRowcode": " "
            },
            "7": {
                "beforePatchRowNumber": 88,
                "afterPatchRowNumber": 89,
                "PatchRowcode": "             if tag == 'replace':"
            },
            "8": {
                "beforePatchRowNumber": 89,
                "afterPatchRowNumber": 90,
                "PatchRowcode": "                 for i in range(alo, ahi):"
            },
            "9": {
                "beforePatchRowNumber": 90,
                "afterPatchRowNumber": 91,
                "PatchRowcode": "                     obj = self.oldValue[i]"
            },
            "10": {
                "beforePatchRowNumber": 91,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    obj_title = obj.Title()"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 92,
                "PatchRowcode": "+                    obj_title = html_encode(obj.Title())"
            },
            "12": {
                "beforePatchRowNumber": 92,
                "afterPatchRowNumber": 93,
                "PatchRowcode": "                     obj_url = obj.absolute_url()"
            },
            "13": {
                "beforePatchRowNumber": 93,
                "afterPatchRowNumber": 94,
                "PatchRowcode": "                     r.append(inlinediff_fmt %"
            },
            "14": {
                "beforePatchRowNumber": 94,
                "afterPatchRowNumber": 95,
                "PatchRowcode": "                              (css_class, 'diff_sub', obj_url, obj_title))"
            },
            "15": {
                "beforePatchRowNumber": 95,
                "afterPatchRowNumber": 96,
                "PatchRowcode": "                 for i in range(blo, bhi):"
            },
            "16": {
                "beforePatchRowNumber": 96,
                "afterPatchRowNumber": 97,
                "PatchRowcode": "                     obj = self.newValue[i]"
            },
            "17": {
                "beforePatchRowNumber": 97,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    obj_title = obj.Title()"
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 98,
                "PatchRowcode": "+                    obj_title = html_encode(obj.Title())"
            },
            "19": {
                "beforePatchRowNumber": 98,
                "afterPatchRowNumber": 99,
                "PatchRowcode": "                     obj_url = obj.absolute_url()"
            },
            "20": {
                "beforePatchRowNumber": 99,
                "afterPatchRowNumber": 100,
                "PatchRowcode": "                     r.append(inlinediff_fmt %"
            },
            "21": {
                "beforePatchRowNumber": 100,
                "afterPatchRowNumber": 101,
                "PatchRowcode": "                              (css_class, 'diff_add', obj_url, obj_title))"
            },
            "22": {
                "beforePatchRowNumber": 101,
                "afterPatchRowNumber": 102,
                "PatchRowcode": "             elif tag == 'delete':"
            },
            "23": {
                "beforePatchRowNumber": 102,
                "afterPatchRowNumber": 103,
                "PatchRowcode": "                 for i in range(alo, ahi):"
            },
            "24": {
                "beforePatchRowNumber": 103,
                "afterPatchRowNumber": 104,
                "PatchRowcode": "                     obj = self.oldValue[i]"
            },
            "25": {
                "beforePatchRowNumber": 104,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    obj_title = obj.Title()"
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 105,
                "PatchRowcode": "+                    obj_title = html_encode(obj.Title())"
            },
            "27": {
                "beforePatchRowNumber": 105,
                "afterPatchRowNumber": 106,
                "PatchRowcode": "                     obj_url = obj.absolute_url()"
            },
            "28": {
                "beforePatchRowNumber": 106,
                "afterPatchRowNumber": 107,
                "PatchRowcode": "                     r.append(inlinediff_fmt %"
            },
            "29": {
                "beforePatchRowNumber": 107,
                "afterPatchRowNumber": 108,
                "PatchRowcode": "                              (css_class, 'diff_sub', obj_url, obj_title))"
            },
            "30": {
                "beforePatchRowNumber": 108,
                "afterPatchRowNumber": 109,
                "PatchRowcode": "             elif tag == 'insert':"
            },
            "31": {
                "beforePatchRowNumber": 109,
                "afterPatchRowNumber": 110,
                "PatchRowcode": "                 for i in range(blo, bhi):"
            },
            "32": {
                "beforePatchRowNumber": 110,
                "afterPatchRowNumber": 111,
                "PatchRowcode": "                     obj = self.newValue[i]"
            },
            "33": {
                "beforePatchRowNumber": 111,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    obj_title = obj.Title()"
            },
            "34": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 112,
                "PatchRowcode": "+                    obj_title = html_encode(obj.Title())"
            },
            "35": {
                "beforePatchRowNumber": 112,
                "afterPatchRowNumber": 113,
                "PatchRowcode": "                     obj_url = obj.absolute_url()"
            },
            "36": {
                "beforePatchRowNumber": 113,
                "afterPatchRowNumber": 114,
                "PatchRowcode": "                     r.append(inlinediff_fmt %"
            },
            "37": {
                "beforePatchRowNumber": 114,
                "afterPatchRowNumber": 115,
                "PatchRowcode": "                              (css_class, 'diff_add', obj_url, obj_title))"
            },
            "38": {
                "beforePatchRowNumber": 115,
                "afterPatchRowNumber": 116,
                "PatchRowcode": "             elif tag == 'equal':"
            },
            "39": {
                "beforePatchRowNumber": 116,
                "afterPatchRowNumber": 117,
                "PatchRowcode": "                 for i in range(alo, ahi):"
            },
            "40": {
                "beforePatchRowNumber": 117,
                "afterPatchRowNumber": 118,
                "PatchRowcode": "                     obj = self.oldValue[i]"
            },
            "41": {
                "beforePatchRowNumber": 118,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                    obj_title = obj.Title()"
            },
            "42": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 119,
                "PatchRowcode": "+                    obj_title = html_encode(obj.Title())"
            },
            "43": {
                "beforePatchRowNumber": 119,
                "afterPatchRowNumber": 120,
                "PatchRowcode": "                     obj_url = obj.absolute_url()"
            },
            "44": {
                "beforePatchRowNumber": 120,
                "afterPatchRowNumber": 121,
                "PatchRowcode": "                     r.append(same_fmt % (css_class, obj_url, obj_title))"
            },
            "45": {
                "beforePatchRowNumber": 121,
                "afterPatchRowNumber": 122,
                "PatchRowcode": "             else:"
            }
        },
        "frontPatchFile": [
            "# -*- coding: utf-8 -*-",
            "from AccessControl.class_init import InitializeClass",
            "from plone.dexterity.interfaces import IDexterityContent",
            "from Products.CMFDiffTool.choicediff import get_field_object",
            "from Products.CMFDiffTool.choicediff import title_or_value",
            "from Products.CMFDiffTool.FieldDiff import FieldDiff",
            "from six.moves import range",
            "",
            "",
            "class ListDiff(FieldDiff):",
            "    \"\"\"Text difference\"\"\"",
            "",
            "    meta_type = 'List Diff'",
            "",
            "    def __init__(self, obj1, obj2, field, id1=None, id2=None, field_name=None,",
            "                 field_label=None, schemata=None):",
            "        FieldDiff.__init__(self, obj1, obj2, field, id1, id2, field_name,",
            "                           field_label, schemata)",
            "        self._vocabulary = None",
            "",
            "        # Tries to find a vocabulary. First we need to find an object and",
            "        # the field instance.",
            "        obj = obj1 if (obj1 is not None) else obj2",
            "        field_name = field_name or field",
            "        if obj and field_name and IDexterityContent.providedBy(obj):",
            "            field_instance = get_field_object(obj, field_name)",
            "            if field_instance is not None:",
            "                # Binding the field to an object will construct the vocabulary",
            "                # using a factory if necessary.",
            "                try:",
            "                    self._vocabulary = field_instance.value_type.bind(obj).\\",
            "                        vocabulary",
            "                except Exception:",
            "                    pass",
            "",
            "    def chk_hashable(self, value):",
            "        if self._vocabulary is not None:",
            "            value = title_or_value(self._vocabulary, value)",
            "        try:",
            "            hash(value)",
            "        except TypeError as e:",
            "            value = repr(e) + ': ' + repr(value)",
            "        return value",
            "",
            "    def _parseField(self, value, filename=None):",
            "        \"\"\"Parse a field value in preparation for diffing\"\"\"",
            "        if type(value) is list or type(value) is tuple:",
            "            values = []",
            "            for v in value:",
            "                values.append(self.chk_hashable(v))",
            "            return values",
            "        else:",
            "            if type(value) is set:",
            "                return list(value)",
            "            else:",
            "                return [self.chk_hashable(value)]",
            "",
            "",
            "class RelationListDiff(FieldDiff):",
            "",
            "    meta_type = 'Related List Diff'",
            "",
            "    same_fmt = \"\"\"<div class=\"%s\"><a target=\"_blank\" href=\"%s\">%s</a></div>\"\"\"",
            "    inlinediff_fmt = \"\"\"<div class=\"%s\">",
            "        <div class=\"%s\"><a target=\"_blank\" href=\"%s\">%s</a></div>",
            "    </div>\"\"\"",
            "",
            "    def _parseField(self, value, filename=None):",
            "        \"\"\" Take RelationValues and just return the target UID",
            "            so we can compare \"\"\"",
            "",
            "        if filename is None:",
            "            # Since we only want to compare a single field, make a",
            "            # one-item list out of it",
            "            return ['/'.join(val.getPhysicalPath()) for val in value]",
            "        else:",
            "            return [",
            "                self.filenameTitle(filename),",
            "                ['/'.join(val.getPhysicalPath()) for val in value],",
            "            ]",
            "",
            "    def inline_diff(self):",
            "        css_class = 'InlineDiff'",
            "        inlinediff_fmt = self.inlinediff_fmt",
            "        same_fmt = self.same_fmt",
            "        r = []",
            "        for tag, alo, ahi, blo, bhi in self.getLineDiffs():",
            "            if tag == 'replace':",
            "                for i in range(alo, ahi):",
            "                    obj = self.oldValue[i]",
            "                    obj_title = obj.Title()",
            "                    obj_url = obj.absolute_url()",
            "                    r.append(inlinediff_fmt %",
            "                             (css_class, 'diff_sub', obj_url, obj_title))",
            "                for i in range(blo, bhi):",
            "                    obj = self.newValue[i]",
            "                    obj_title = obj.Title()",
            "                    obj_url = obj.absolute_url()",
            "                    r.append(inlinediff_fmt %",
            "                             (css_class, 'diff_add', obj_url, obj_title))",
            "            elif tag == 'delete':",
            "                for i in range(alo, ahi):",
            "                    obj = self.oldValue[i]",
            "                    obj_title = obj.Title()",
            "                    obj_url = obj.absolute_url()",
            "                    r.append(inlinediff_fmt %",
            "                             (css_class, 'diff_sub', obj_url, obj_title))",
            "            elif tag == 'insert':",
            "                for i in range(blo, bhi):",
            "                    obj = self.newValue[i]",
            "                    obj_title = obj.Title()",
            "                    obj_url = obj.absolute_url()",
            "                    r.append(inlinediff_fmt %",
            "                             (css_class, 'diff_add', obj_url, obj_title))",
            "            elif tag == 'equal':",
            "                for i in range(alo, ahi):",
            "                    obj = self.oldValue[i]",
            "                    obj_title = obj.Title()",
            "                    obj_url = obj.absolute_url()",
            "                    r.append(same_fmt % (css_class, obj_url, obj_title))",
            "            else:",
            "                raise ValueError('unknown tag %s' % tag)",
            "        return '\\n'.join(r)",
            "",
            "    def ndiff(self):",
            "        \"\"\" Return a textual diff \"\"\"",
            "        r = []",
            "        for tag, alo, ahi, blo, bhi in self.getLineDiffs():",
            "            if tag == 'replace':",
            "                for i in range(alo, ahi):",
            "                    obj = self.oldValue[i]",
            "                    obj_url = obj.absolute_url()",
            "                    r.append('- %s' % obj_url)",
            "                for i in range(blo, bhi):",
            "                    obj = self.newValue[i]",
            "                    obj_url = obj.absolute_url()",
            "                    r.append('+ %s' % obj_url)",
            "            elif tag == 'delete':",
            "                for i in range(alo, ahi):",
            "                    obj = self.oldValue[i]",
            "                    obj_url = obj.absolute_url()",
            "                    r.append('- %s' % obj_url)",
            "            elif tag == 'insert':",
            "                for i in range(blo, bhi):",
            "                    obj = self.newValue[i]",
            "                    obj_url = obj.absolute_url()",
            "                    r.append('+ %s' % obj_url)",
            "            elif tag == 'equal':",
            "                for i in range(alo, ahi):",
            "                    obj = self.oldValue[i]",
            "                    obj_url = obj.absolute_url()",
            "                    r.append('  %s' % obj_url)",
            "            else:",
            "                raise ValueError('unknown tag %r', tag)",
            "        return '\\n'.join(r)",
            "",
            "",
            "InitializeClass(ListDiff)",
            "InitializeClass(RelationListDiff)"
        ],
        "afterPatchFile": [
            "# -*- coding: utf-8 -*-",
            "from AccessControl.class_init import InitializeClass",
            "from plone.dexterity.interfaces import IDexterityContent",
            "from Products.CMFDiffTool.choicediff import get_field_object",
            "from Products.CMFDiffTool.choicediff import title_or_value",
            "from Products.CMFDiffTool.FieldDiff import FieldDiff",
            "from Products.CMFDiffTool.utils import html_encode",
            "from six.moves import range",
            "",
            "",
            "class ListDiff(FieldDiff):",
            "    \"\"\"Text difference\"\"\"",
            "",
            "    meta_type = 'List Diff'",
            "",
            "    def __init__(self, obj1, obj2, field, id1=None, id2=None, field_name=None,",
            "                 field_label=None, schemata=None):",
            "        FieldDiff.__init__(self, obj1, obj2, field, id1, id2, field_name,",
            "                           field_label, schemata)",
            "        self._vocabulary = None",
            "",
            "        # Tries to find a vocabulary. First we need to find an object and",
            "        # the field instance.",
            "        obj = obj1 if (obj1 is not None) else obj2",
            "        field_name = field_name or field",
            "        if obj and field_name and IDexterityContent.providedBy(obj):",
            "            field_instance = get_field_object(obj, field_name)",
            "            if field_instance is not None:",
            "                # Binding the field to an object will construct the vocabulary",
            "                # using a factory if necessary.",
            "                try:",
            "                    self._vocabulary = field_instance.value_type.bind(obj).\\",
            "                        vocabulary",
            "                except Exception:",
            "                    pass",
            "",
            "    def chk_hashable(self, value):",
            "        if self._vocabulary is not None:",
            "            value = title_or_value(self._vocabulary, value)",
            "        try:",
            "            hash(value)",
            "        except TypeError as e:",
            "            value = repr(e) + ': ' + repr(value)",
            "        return value",
            "",
            "    def _parseField(self, value, filename=None):",
            "        \"\"\"Parse a field value in preparation for diffing\"\"\"",
            "        if type(value) is list or type(value) is tuple:",
            "            values = []",
            "            for v in value:",
            "                values.append(self.chk_hashable(v))",
            "            return values",
            "        else:",
            "            if type(value) is set:",
            "                return list(value)",
            "            else:",
            "                return [self.chk_hashable(value)]",
            "",
            "",
            "class RelationListDiff(FieldDiff):",
            "",
            "    meta_type = 'Related List Diff'",
            "",
            "    same_fmt = \"\"\"<div class=\"%s\"><a target=\"_blank\" href=\"%s\">%s</a></div>\"\"\"",
            "    inlinediff_fmt = \"\"\"<div class=\"%s\">",
            "        <div class=\"%s\"><a target=\"_blank\" href=\"%s\">%s</a></div>",
            "    </div>\"\"\"",
            "",
            "    def _parseField(self, value, filename=None):",
            "        \"\"\" Take RelationValues and just return the target UID",
            "            so we can compare \"\"\"",
            "",
            "        if filename is None:",
            "            # Since we only want to compare a single field, make a",
            "            # one-item list out of it",
            "            return ['/'.join(val.getPhysicalPath()) for val in value]",
            "        else:",
            "            return [",
            "                self.filenameTitle(filename),",
            "                ['/'.join(val.getPhysicalPath()) for val in value],",
            "            ]",
            "",
            "    def inline_diff(self):",
            "        css_class = 'InlineDiff'",
            "        inlinediff_fmt = self.inlinediff_fmt",
            "        same_fmt = self.same_fmt",
            "        r = []",
            "        for tag, alo, ahi, blo, bhi in self.getLineDiffs():",
            "            if tag == 'replace':",
            "                for i in range(alo, ahi):",
            "                    obj = self.oldValue[i]",
            "                    obj_title = html_encode(obj.Title())",
            "                    obj_url = obj.absolute_url()",
            "                    r.append(inlinediff_fmt %",
            "                             (css_class, 'diff_sub', obj_url, obj_title))",
            "                for i in range(blo, bhi):",
            "                    obj = self.newValue[i]",
            "                    obj_title = html_encode(obj.Title())",
            "                    obj_url = obj.absolute_url()",
            "                    r.append(inlinediff_fmt %",
            "                             (css_class, 'diff_add', obj_url, obj_title))",
            "            elif tag == 'delete':",
            "                for i in range(alo, ahi):",
            "                    obj = self.oldValue[i]",
            "                    obj_title = html_encode(obj.Title())",
            "                    obj_url = obj.absolute_url()",
            "                    r.append(inlinediff_fmt %",
            "                             (css_class, 'diff_sub', obj_url, obj_title))",
            "            elif tag == 'insert':",
            "                for i in range(blo, bhi):",
            "                    obj = self.newValue[i]",
            "                    obj_title = html_encode(obj.Title())",
            "                    obj_url = obj.absolute_url()",
            "                    r.append(inlinediff_fmt %",
            "                             (css_class, 'diff_add', obj_url, obj_title))",
            "            elif tag == 'equal':",
            "                for i in range(alo, ahi):",
            "                    obj = self.oldValue[i]",
            "                    obj_title = html_encode(obj.Title())",
            "                    obj_url = obj.absolute_url()",
            "                    r.append(same_fmt % (css_class, obj_url, obj_title))",
            "            else:",
            "                raise ValueError('unknown tag %s' % tag)",
            "        return '\\n'.join(r)",
            "",
            "    def ndiff(self):",
            "        \"\"\" Return a textual diff \"\"\"",
            "        r = []",
            "        for tag, alo, ahi, blo, bhi in self.getLineDiffs():",
            "            if tag == 'replace':",
            "                for i in range(alo, ahi):",
            "                    obj = self.oldValue[i]",
            "                    obj_url = obj.absolute_url()",
            "                    r.append('- %s' % obj_url)",
            "                for i in range(blo, bhi):",
            "                    obj = self.newValue[i]",
            "                    obj_url = obj.absolute_url()",
            "                    r.append('+ %s' % obj_url)",
            "            elif tag == 'delete':",
            "                for i in range(alo, ahi):",
            "                    obj = self.oldValue[i]",
            "                    obj_url = obj.absolute_url()",
            "                    r.append('- %s' % obj_url)",
            "            elif tag == 'insert':",
            "                for i in range(blo, bhi):",
            "                    obj = self.newValue[i]",
            "                    obj_url = obj.absolute_url()",
            "                    r.append('+ %s' % obj_url)",
            "            elif tag == 'equal':",
            "                for i in range(alo, ahi):",
            "                    obj = self.oldValue[i]",
            "                    obj_url = obj.absolute_url()",
            "                    r.append('  %s' % obj_url)",
            "            else:",
            "                raise ValueError('unknown tag %r', tag)",
            "        return '\\n'.join(r)",
            "",
            "",
            "InitializeClass(ListDiff)",
            "InitializeClass(RelationListDiff)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "91": [
                "RelationListDiff",
                "inline_diff"
            ],
            "97": [
                "RelationListDiff",
                "inline_diff"
            ],
            "104": [
                "RelationListDiff",
                "inline_diff"
            ],
            "111": [
                "RelationListDiff",
                "inline_diff"
            ],
            "118": [
                "RelationListDiff",
                "inline_diff"
            ]
        },
        "addLocation": []
    },
    "Products/CMFDiffTool/TextDiff.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 3,
                "afterPatchRowNumber": 3,
                "PatchRowcode": " from os import linesep"
            },
            "1": {
                "beforePatchRowNumber": 4,
                "afterPatchRowNumber": 4,
                "PatchRowcode": " from Products.CMFDiffTool import CMFDiffToolMessageFactory as _"
            },
            "2": {
                "beforePatchRowNumber": 5,
                "afterPatchRowNumber": 5,
                "PatchRowcode": " from Products.CMFDiffTool.FieldDiff import FieldDiff"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 6,
                "PatchRowcode": "+from Products.CMFDiffTool.utils import html_encode"
            },
            "4": {
                "beforePatchRowNumber": 6,
                "afterPatchRowNumber": 7,
                "PatchRowcode": " from Products.CMFDiffTool.utils import safe_unicode"
            },
            "5": {
                "beforePatchRowNumber": 7,
                "afterPatchRowNumber": 8,
                "PatchRowcode": " from Products.CMFDiffTool.utils import safe_utf8"
            },
            "6": {
                "beforePatchRowNumber": 8,
                "afterPatchRowNumber": 9,
                "PatchRowcode": " from zope.component.hooks import getSite"
            },
            "7": {
                "beforePatchRowNumber": 87,
                "afterPatchRowNumber": 88,
                "PatchRowcode": "         if old_fname != new_fname:"
            },
            "8": {
                "beforePatchRowNumber": 88,
                "afterPatchRowNumber": 89,
                "PatchRowcode": "             html.append("
            },
            "9": {
                "beforePatchRowNumber": 89,
                "afterPatchRowNumber": 90,
                "PatchRowcode": "                 self.inlinediff_fmt % ('%s FilenameDiff' % css_class,"
            },
            "10": {
                "beforePatchRowNumber": 90,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                                       old_fname, new_fname),"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 91,
                "PatchRowcode": "+                                       html_encode(old_fname), html_encode(new_fname)),"
            },
            "12": {
                "beforePatchRowNumber": 91,
                "afterPatchRowNumber": 92,
                "PatchRowcode": "             )"
            },
            "13": {
                "beforePatchRowNumber": 92,
                "afterPatchRowNumber": 93,
                "PatchRowcode": "         if a != b:"
            },
            "14": {
                "beforePatchRowNumber": 93,
                "afterPatchRowNumber": 94,
                "PatchRowcode": "             html.append("
            },
            "15": {
                "beforePatchRowNumber": 94,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-                self.inlinediff_fmt % (css_class, a, b),"
            },
            "16": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 95,
                "PatchRowcode": "+                self.inlinediff_fmt % (css_class, html_encode(a), html_encode(b)),"
            },
            "17": {
                "beforePatchRowNumber": 95,
                "afterPatchRowNumber": 96,
                "PatchRowcode": "             )"
            },
            "18": {
                "beforePatchRowNumber": 96,
                "afterPatchRowNumber": 97,
                "PatchRowcode": "         if html:"
            },
            "19": {
                "beforePatchRowNumber": 97,
                "afterPatchRowNumber": 98,
                "PatchRowcode": "             return linesep.join(html)"
            }
        },
        "frontPatchFile": [
            "# -*- coding: utf-8 -*-",
            "from AccessControl.class_init import InitializeClass",
            "from os import linesep",
            "from Products.CMFDiffTool import CMFDiffToolMessageFactory as _",
            "from Products.CMFDiffTool.FieldDiff import FieldDiff",
            "from Products.CMFDiffTool.utils import safe_unicode",
            "from Products.CMFDiffTool.utils import safe_utf8",
            "from zope.component.hooks import getSite",
            "",
            "import difflib",
            "import six",
            "",
            "",
            "class TextDiff(FieldDiff):",
            "    \"\"\"Text difference\"\"\"",
            "",
            "    meta_type = 'Lines Diff'",
            "    inlinediff_fmt = \"\"\"",
            "<div class=\"%s\">",
            "    <del>%s</del>",
            "    <ins>%s</ins>",
            "</div>",
            "\"\"\"",
            "",
            "    def _parseField(self, value, filename=None):",
            "        \"\"\"Parse a field value in preparation for diffing\"\"\"",
            "        if value is None:",
            "            value = ''",
            "        if filename is None:",
            "            # Split the text into a list for diffs",
            "            return value.splitlines()",
            "        else:",
            "            return [self.filenameTitle(filename)] + value.splitlines()",
            "",
            "    def unified_diff(self):",
            "        \"\"\"Return a unified diff\"\"\"",
            "        a = self._parseField(self.oldValue, filename=self.oldFilename)",
            "        b = self._parseField(self.newValue, filename=self.newFilename)",
            "        if six.PY2:",
            "            a = [safe_utf8(i) for i in a]",
            "            b = [safe_utf8(i) for i in b]",
            "        # in py3 unified_diff does not accept None for ids (id1 and id2)",
            "        # But TextDiff() sets None as default. We overwrite this here so the",
            "        # default of unified_diff ('') can be used .",
            "        cleanargs = [a, b, self.id1, self.id2]",
            "        cleanargs = [i for i in cleanargs if i]",
            "        return linesep.join(difflib.unified_diff(*cleanargs))",
            "",
            "    def html_diff(self, context=True, wrapcolumn=40):",
            "        \"\"\"Return an HTML table showing differences\"\"\"",
            "        # difflib is not Unicode-aware, so we need to force everything to",
            "        # utf-8 manually",
            "        a = [safe_unicode(i) for i in",
            "             self._parseField(self.oldValue, filename=self.oldFilename)]",
            "        b = [safe_unicode(i) for i in",
            "             self._parseField(self.newValue, filename=self.newFilename)]",
            "        vis_diff = difflib.HtmlDiff(wrapcolumn=wrapcolumn)",
            "        diff = vis_diff.make_table(",
            "            a,",
            "            b,",
            "            safe_unicode(self.id1),",
            "            safe_unicode(self.id2),",
            "            context=context)",
            "        if six.PY2:",
            "            diff = safe_utf8(diff)",
            "        return diff",
            "",
            "    def inline_diff(self):",
            "        \"\"\"Simple inline diff that just assumes that either the filename",
            "        has changed, or the text has been completely replaced.\"\"\"",
            "        css_class = 'InlineDiff'",
            "        old_attr = self._parseField(self.oldValue,",
            "                                    filename=self.oldFilename)",
            "        new_attr = self._parseField(self.newValue,",
            "                                    filename=self.newFilename)",
            "        if old_attr:",
            "            old_fname = old_attr.pop(0)",
            "        else:",
            "            old_fname = None",
            "        if new_attr:",
            "            new_fname = new_attr.pop(0)",
            "        else:",
            "            new_fname = None",
            "        a = linesep.join(old_attr or [])",
            "        b = linesep.join(new_attr or [])",
            "        html = []",
            "        if old_fname != new_fname:",
            "            html.append(",
            "                self.inlinediff_fmt % ('%s FilenameDiff' % css_class,",
            "                                       old_fname, new_fname),",
            "            )",
            "        if a != b:",
            "            html.append(",
            "                self.inlinediff_fmt % (css_class, a, b),",
            "            )",
            "        if html:",
            "            return linesep.join(html)",
            "",
            "",
            "InitializeClass(TextDiff)",
            "",
            "",
            "class AsTextDiff(TextDiff):",
            "    \"\"\"",
            "    Specialization of `TextDiff` that converts any value to text in order to",
            "    provide an inline diff visualization. Also translated (i18n) the",
            "    strings `True` and `False`.",
            "    \"\"\"",
            "",
            "    def _parseField(self, value, filename=None):",
            "        if value is None:",
            "            value = ''",
            "",
            "        # In tests translation is not available, so we account for this",
            "        # case here.",
            "        translate = getattr(getSite(), 'translate', None)",
            "        if translate is not None:",
            "            value = translate(_(value))",
            "",
            "        return TextDiff._parseField(self, safe_unicode(value), filename)",
            "",
            "",
            "InitializeClass(AsTextDiff)"
        ],
        "afterPatchFile": [
            "# -*- coding: utf-8 -*-",
            "from AccessControl.class_init import InitializeClass",
            "from os import linesep",
            "from Products.CMFDiffTool import CMFDiffToolMessageFactory as _",
            "from Products.CMFDiffTool.FieldDiff import FieldDiff",
            "from Products.CMFDiffTool.utils import html_encode",
            "from Products.CMFDiffTool.utils import safe_unicode",
            "from Products.CMFDiffTool.utils import safe_utf8",
            "from zope.component.hooks import getSite",
            "",
            "import difflib",
            "import six",
            "",
            "",
            "class TextDiff(FieldDiff):",
            "    \"\"\"Text difference\"\"\"",
            "",
            "    meta_type = 'Lines Diff'",
            "    inlinediff_fmt = \"\"\"",
            "<div class=\"%s\">",
            "    <del>%s</del>",
            "    <ins>%s</ins>",
            "</div>",
            "\"\"\"",
            "",
            "    def _parseField(self, value, filename=None):",
            "        \"\"\"Parse a field value in preparation for diffing\"\"\"",
            "        if value is None:",
            "            value = ''",
            "        if filename is None:",
            "            # Split the text into a list for diffs",
            "            return value.splitlines()",
            "        else:",
            "            return [self.filenameTitle(filename)] + value.splitlines()",
            "",
            "    def unified_diff(self):",
            "        \"\"\"Return a unified diff\"\"\"",
            "        a = self._parseField(self.oldValue, filename=self.oldFilename)",
            "        b = self._parseField(self.newValue, filename=self.newFilename)",
            "        if six.PY2:",
            "            a = [safe_utf8(i) for i in a]",
            "            b = [safe_utf8(i) for i in b]",
            "        # in py3 unified_diff does not accept None for ids (id1 and id2)",
            "        # But TextDiff() sets None as default. We overwrite this here so the",
            "        # default of unified_diff ('') can be used .",
            "        cleanargs = [a, b, self.id1, self.id2]",
            "        cleanargs = [i for i in cleanargs if i]",
            "        return linesep.join(difflib.unified_diff(*cleanargs))",
            "",
            "    def html_diff(self, context=True, wrapcolumn=40):",
            "        \"\"\"Return an HTML table showing differences\"\"\"",
            "        # difflib is not Unicode-aware, so we need to force everything to",
            "        # utf-8 manually",
            "        a = [safe_unicode(i) for i in",
            "             self._parseField(self.oldValue, filename=self.oldFilename)]",
            "        b = [safe_unicode(i) for i in",
            "             self._parseField(self.newValue, filename=self.newFilename)]",
            "        vis_diff = difflib.HtmlDiff(wrapcolumn=wrapcolumn)",
            "        diff = vis_diff.make_table(",
            "            a,",
            "            b,",
            "            safe_unicode(self.id1),",
            "            safe_unicode(self.id2),",
            "            context=context)",
            "        if six.PY2:",
            "            diff = safe_utf8(diff)",
            "        return diff",
            "",
            "    def inline_diff(self):",
            "        \"\"\"Simple inline diff that just assumes that either the filename",
            "        has changed, or the text has been completely replaced.\"\"\"",
            "        css_class = 'InlineDiff'",
            "        old_attr = self._parseField(self.oldValue,",
            "                                    filename=self.oldFilename)",
            "        new_attr = self._parseField(self.newValue,",
            "                                    filename=self.newFilename)",
            "        if old_attr:",
            "            old_fname = old_attr.pop(0)",
            "        else:",
            "            old_fname = None",
            "        if new_attr:",
            "            new_fname = new_attr.pop(0)",
            "        else:",
            "            new_fname = None",
            "        a = linesep.join(old_attr or [])",
            "        b = linesep.join(new_attr or [])",
            "        html = []",
            "        if old_fname != new_fname:",
            "            html.append(",
            "                self.inlinediff_fmt % ('%s FilenameDiff' % css_class,",
            "                                       html_encode(old_fname), html_encode(new_fname)),",
            "            )",
            "        if a != b:",
            "            html.append(",
            "                self.inlinediff_fmt % (css_class, html_encode(a), html_encode(b)),",
            "            )",
            "        if html:",
            "            return linesep.join(html)",
            "",
            "",
            "InitializeClass(TextDiff)",
            "",
            "",
            "class AsTextDiff(TextDiff):",
            "    \"\"\"",
            "    Specialization of `TextDiff` that converts any value to text in order to",
            "    provide an inline diff visualization. Also translated (i18n) the",
            "    strings `True` and `False`.",
            "    \"\"\"",
            "",
            "    def _parseField(self, value, filename=None):",
            "        if value is None:",
            "            value = ''",
            "",
            "        # In tests translation is not available, so we account for this",
            "        # case here.",
            "        translate = getattr(getSite(), 'translate', None)",
            "        if translate is not None:",
            "            value = translate(_(value))",
            "",
            "        return TextDiff._parseField(self, safe_unicode(value), filename)",
            "",
            "",
            "InitializeClass(AsTextDiff)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "90": [
                "TextDiff",
                "inline_diff"
            ],
            "94": [
                "TextDiff",
                "inline_diff"
            ]
        },
        "addLocation": []
    },
    "Products/CMFDiffTool/namedfile.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 4,
                "afterPatchRowNumber": 4,
                "PatchRowcode": " from Products.CMFDiffTool.BinaryDiff import BinaryDiff"
            },
            "1": {
                "beforePatchRowNumber": 5,
                "afterPatchRowNumber": 5,
                "PatchRowcode": " from Products.CMFDiffTool.ListDiff import ListDiff"
            },
            "2": {
                "beforePatchRowNumber": 6,
                "afterPatchRowNumber": 6,
                "PatchRowcode": " from Products.CMFDiffTool.TextDiff import TextDiff"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 7,
                "PatchRowcode": "+from Products.CMFDiffTool.utils import html_encode"
            },
            "4": {
                "beforePatchRowNumber": 7,
                "afterPatchRowNumber": 8,
                "PatchRowcode": " "
            },
            "5": {
                "beforePatchRowNumber": 8,
                "afterPatchRowNumber": 9,
                "PatchRowcode": " "
            },
            "6": {
                "beforePatchRowNumber": 9,
                "afterPatchRowNumber": 10,
                "PatchRowcode": " FILE_FIELD_TYPES = []"
            },
            "7": {
                "beforePatchRowNumber": 70,
                "afterPatchRowNumber": 71,
                "PatchRowcode": "         old = self._parseField(self.oldValue, self.oldFilename)[0]"
            },
            "8": {
                "beforePatchRowNumber": 71,
                "afterPatchRowNumber": 72,
                "PatchRowcode": "         new = self._parseField(self.newValue, self.newFilename)[0]"
            },
            "9": {
                "beforePatchRowNumber": 72,
                "afterPatchRowNumber": 73,
                "PatchRowcode": " "
            },
            "10": {
                "beforePatchRowNumber": 73,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        return '' if self.same else self.inlinediff_fmt % (css_class, old, new)"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 74,
                "PatchRowcode": "+        return '' if self.same else self.inlinediff_fmt % (css_class, html_encode(old), html_encode(new))"
            },
            "12": {
                "beforePatchRowNumber": 74,
                "afterPatchRowNumber": 75,
                "PatchRowcode": " "
            },
            "13": {
                "beforePatchRowNumber": 75,
                "afterPatchRowNumber": 76,
                "PatchRowcode": " "
            },
            "14": {
                "beforePatchRowNumber": 76,
                "afterPatchRowNumber": 77,
                "PatchRowcode": " InitializeClass(NamedFileBinaryDiff)"
            },
            "15": {
                "beforePatchRowNumber": 136,
                "afterPatchRowNumber": 137,
                "PatchRowcode": "             )"
            },
            "16": {
                "beforePatchRowNumber": 137,
                "afterPatchRowNumber": 138,
                "PatchRowcode": " "
            },
            "17": {
                "beforePatchRowNumber": 138,
                "afterPatchRowNumber": 139,
                "PatchRowcode": "         return '\\n'.join(["
            },
            "18": {
                "beforePatchRowNumber": 139,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            ((self.same_fmt % (css_class, d_old['repr']))"
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 140,
                "PatchRowcode": "+            ((self.same_fmt % (css_class, html_encode(d_old['repr'])))"
            },
            "20": {
                "beforePatchRowNumber": 140,
                "afterPatchRowNumber": 141,
                "PatchRowcode": "              if is_same_dict(d_old, d_new) else self.inlinediff_fmt"
            },
            "21": {
                "beforePatchRowNumber": 141,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-             % (css_class, d_old['repr'], d_new['repr'])"
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 142,
                "PatchRowcode": "+             % (css_class, html_encode(d_old['repr']), html_encode(d_new['repr']))"
            },
            "23": {
                "beforePatchRowNumber": 142,
                "afterPatchRowNumber": 143,
                "PatchRowcode": "              ) for (d_old, d_new) in zip(old_data, new_data)])"
            },
            "24": {
                "beforePatchRowNumber": 143,
                "afterPatchRowNumber": 144,
                "PatchRowcode": " "
            },
            "25": {
                "beforePatchRowNumber": 144,
                "afterPatchRowNumber": 145,
                "PatchRowcode": " "
            }
        },
        "frontPatchFile": [
            "# -*- coding: utf-8 -*-",
            "from AccessControl.class_init import InitializeClass",
            "from plone.namedfile import NamedFile",
            "from Products.CMFDiffTool.BinaryDiff import BinaryDiff",
            "from Products.CMFDiffTool.ListDiff import ListDiff",
            "from Products.CMFDiffTool.TextDiff import TextDiff",
            "",
            "",
            "FILE_FIELD_TYPES = []",
            "",
            "try:",
            "    from plone.namedfile import field",
            "    FILE_FIELD_TYPES.extend([field.NamedFile, field.NamedImage])",
            "",
            "    if getattr(field, 'HAVE_BLOBS', True):",
            "        FILE_FIELD_TYPES.extend([field.NamedBlobFile, field.NamedBlobImage])",
            "except ImportError:",
            "    pass",
            "",
            "FILE_FIELD_TYPES = tuple(FILE_FIELD_TYPES)",
            "",
            "",
            "def named_file_as_str(f):",
            "    return '' if f is None else '%s (%d bytes)' % (f.filename, len(f.data))",
            "",
            "",
            "def is_same(old_data, old_filename, new_data, new_filename):",
            "    if old_data != new_data:",
            "        return False",
            "",
            "    if (old_filename is not None) and (new_filename is not None):",
            "        return old_filename == new_filename",
            "",
            "    return True",
            "",
            "",
            "class NamedFileBinaryDiff(BinaryDiff):",
            "",
            "    def __init__(self, obj1, obj2, field, id1=None, id2=None, field_name=None,",
            "                 field_label=None, schemata=None):",
            "",
            "        self.field = field",
            "        self.label = field_label or field",
            "        self.schemata = schemata or 'default'",
            "        self.field_name = field_name or field",
            "",
            "        old_field = getattr(obj1, field)",
            "        new_field = getattr(obj2, field)",
            "",
            "        self.oldValue = getattr(old_field, 'data', None)",
            "        self.newValue = getattr(new_field, 'data', None)",
            "",
            "        self.id1 = id1 or getattr(obj1, 'getId', lambda: None)()",
            "        self.id2 = id2 or getattr(obj2, 'getId', lambda: None)()",
            "",
            "        self.oldFilename = getattr(old_field, 'filename', None)",
            "        self.newFilename = getattr(new_field, 'filename', None)",
            "",
            "        self.same = is_same(",
            "            self.oldValue, self.oldFilename, self.newValue, self.newFilename)",
            "",
            "    def _parseField(self, value, filename=None):",
            "        return [",
            "            '' if (value is None)",
            "            else named_file_as_str(NamedFile(data=value, filename=filename)),",
            "        ]",
            "",
            "    def inline_diff(self):",
            "        css_class = 'InlineDiff'",
            "        old = self._parseField(self.oldValue, self.oldFilename)[0]",
            "        new = self._parseField(self.newValue, self.newFilename)[0]",
            "",
            "        return '' if self.same else self.inlinediff_fmt % (css_class, old, new)",
            "",
            "",
            "InitializeClass(NamedFileBinaryDiff)",
            "",
            "",
            "def make_lists_same_length(s1, s2, dummy_element):",
            "    if len(s1) > len(s2):",
            "        s2 += [dummy_element] * (len(s1) - len(s2))",
            "    if len(s2) > len(s1):",
            "        s1 += [dummy_element] * (len(s2) - len(s1))",
            "",
            "",
            "class NamedFileListDiff(ListDiff):",
            "    \"\"\"Specialization of `ListDiff` to handle lists of files better.\"\"\"",
            "",
            "    same_fmt = \"\"\"<div class=\"%s\">%s</div>\"\"\"",
            "    inlinediff_fmt = TextDiff.inlinediff_fmt",
            "",
            "    def __init__(self, obj1, obj2, field, id1=None, id2=None, field_name=None,",
            "                 field_label=None, schemata=None):",
            "        ListDiff.__init__(self, obj1, obj2, field, id1, id2, field_name,",
            "                          field_label, schemata)",
            "        old_values = list(self.oldValue or [])",
            "        new_values = list(self.newValue or [])",
            "",
            "        self.same = True",
            "        if len(old_values) != len(new_values):",
            "            self.same = False",
            "        else:",
            "            for (old, new) in zip(old_values, new_values):",
            "                if not is_same(old.data, old.filename, new.data, new.filename):",
            "                    self.same = False",
            "                    break",
            "",
            "    def _parseField(self, value, filename=None):",
            "        value = value or []",
            "        return [named_file_as_str(f) for f in value]",
            "",
            "    def inline_diff(self):",
            "        if self.same:",
            "            return None",
            "",
            "        css_class = 'InlineDiff'",
            "",
            "        old_reprs = self._parseField(self.oldValue, None)",
            "        new_reprs = self._parseField(self.newValue, None)",
            "",
            "        old_data = [",
            "            {'repr': repr, 'data': value.data, 'filename': value.filename}",
            "            for (repr, value) in zip(old_reprs, self.oldValue or [])",
            "        ]",
            "        new_data = [",
            "            {'repr': repr, 'data': value.data, 'filename': value.filename}",
            "            for (repr, value) in zip(new_reprs, self.newValue or [])",
            "        ]",
            "",
            "        dummy_dict = {'repr': '', 'data': None, 'filename': None}",
            "        make_lists_same_length(old_data, new_data, dummy_dict)",
            "",
            "        def is_same_dict(d1, d2):",
            "            return is_same(",
            "                d1['data'], d1['filename'], d2['data'], d2['filename'],",
            "            )",
            "",
            "        return '\\n'.join([",
            "            ((self.same_fmt % (css_class, d_old['repr']))",
            "             if is_same_dict(d_old, d_new) else self.inlinediff_fmt",
            "             % (css_class, d_old['repr'], d_new['repr'])",
            "             ) for (d_old, d_new) in zip(old_data, new_data)])",
            "",
            "",
            "InitializeClass(NamedFileListDiff)"
        ],
        "afterPatchFile": [
            "# -*- coding: utf-8 -*-",
            "from AccessControl.class_init import InitializeClass",
            "from plone.namedfile import NamedFile",
            "from Products.CMFDiffTool.BinaryDiff import BinaryDiff",
            "from Products.CMFDiffTool.ListDiff import ListDiff",
            "from Products.CMFDiffTool.TextDiff import TextDiff",
            "from Products.CMFDiffTool.utils import html_encode",
            "",
            "",
            "FILE_FIELD_TYPES = []",
            "",
            "try:",
            "    from plone.namedfile import field",
            "    FILE_FIELD_TYPES.extend([field.NamedFile, field.NamedImage])",
            "",
            "    if getattr(field, 'HAVE_BLOBS', True):",
            "        FILE_FIELD_TYPES.extend([field.NamedBlobFile, field.NamedBlobImage])",
            "except ImportError:",
            "    pass",
            "",
            "FILE_FIELD_TYPES = tuple(FILE_FIELD_TYPES)",
            "",
            "",
            "def named_file_as_str(f):",
            "    return '' if f is None else '%s (%d bytes)' % (f.filename, len(f.data))",
            "",
            "",
            "def is_same(old_data, old_filename, new_data, new_filename):",
            "    if old_data != new_data:",
            "        return False",
            "",
            "    if (old_filename is not None) and (new_filename is not None):",
            "        return old_filename == new_filename",
            "",
            "    return True",
            "",
            "",
            "class NamedFileBinaryDiff(BinaryDiff):",
            "",
            "    def __init__(self, obj1, obj2, field, id1=None, id2=None, field_name=None,",
            "                 field_label=None, schemata=None):",
            "",
            "        self.field = field",
            "        self.label = field_label or field",
            "        self.schemata = schemata or 'default'",
            "        self.field_name = field_name or field",
            "",
            "        old_field = getattr(obj1, field)",
            "        new_field = getattr(obj2, field)",
            "",
            "        self.oldValue = getattr(old_field, 'data', None)",
            "        self.newValue = getattr(new_field, 'data', None)",
            "",
            "        self.id1 = id1 or getattr(obj1, 'getId', lambda: None)()",
            "        self.id2 = id2 or getattr(obj2, 'getId', lambda: None)()",
            "",
            "        self.oldFilename = getattr(old_field, 'filename', None)",
            "        self.newFilename = getattr(new_field, 'filename', None)",
            "",
            "        self.same = is_same(",
            "            self.oldValue, self.oldFilename, self.newValue, self.newFilename)",
            "",
            "    def _parseField(self, value, filename=None):",
            "        return [",
            "            '' if (value is None)",
            "            else named_file_as_str(NamedFile(data=value, filename=filename)),",
            "        ]",
            "",
            "    def inline_diff(self):",
            "        css_class = 'InlineDiff'",
            "        old = self._parseField(self.oldValue, self.oldFilename)[0]",
            "        new = self._parseField(self.newValue, self.newFilename)[0]",
            "",
            "        return '' if self.same else self.inlinediff_fmt % (css_class, html_encode(old), html_encode(new))",
            "",
            "",
            "InitializeClass(NamedFileBinaryDiff)",
            "",
            "",
            "def make_lists_same_length(s1, s2, dummy_element):",
            "    if len(s1) > len(s2):",
            "        s2 += [dummy_element] * (len(s1) - len(s2))",
            "    if len(s2) > len(s1):",
            "        s1 += [dummy_element] * (len(s2) - len(s1))",
            "",
            "",
            "class NamedFileListDiff(ListDiff):",
            "    \"\"\"Specialization of `ListDiff` to handle lists of files better.\"\"\"",
            "",
            "    same_fmt = \"\"\"<div class=\"%s\">%s</div>\"\"\"",
            "    inlinediff_fmt = TextDiff.inlinediff_fmt",
            "",
            "    def __init__(self, obj1, obj2, field, id1=None, id2=None, field_name=None,",
            "                 field_label=None, schemata=None):",
            "        ListDiff.__init__(self, obj1, obj2, field, id1, id2, field_name,",
            "                          field_label, schemata)",
            "        old_values = list(self.oldValue or [])",
            "        new_values = list(self.newValue or [])",
            "",
            "        self.same = True",
            "        if len(old_values) != len(new_values):",
            "            self.same = False",
            "        else:",
            "            for (old, new) in zip(old_values, new_values):",
            "                if not is_same(old.data, old.filename, new.data, new.filename):",
            "                    self.same = False",
            "                    break",
            "",
            "    def _parseField(self, value, filename=None):",
            "        value = value or []",
            "        return [named_file_as_str(f) for f in value]",
            "",
            "    def inline_diff(self):",
            "        if self.same:",
            "            return None",
            "",
            "        css_class = 'InlineDiff'",
            "",
            "        old_reprs = self._parseField(self.oldValue, None)",
            "        new_reprs = self._parseField(self.newValue, None)",
            "",
            "        old_data = [",
            "            {'repr': repr, 'data': value.data, 'filename': value.filename}",
            "            for (repr, value) in zip(old_reprs, self.oldValue or [])",
            "        ]",
            "        new_data = [",
            "            {'repr': repr, 'data': value.data, 'filename': value.filename}",
            "            for (repr, value) in zip(new_reprs, self.newValue or [])",
            "        ]",
            "",
            "        dummy_dict = {'repr': '', 'data': None, 'filename': None}",
            "        make_lists_same_length(old_data, new_data, dummy_dict)",
            "",
            "        def is_same_dict(d1, d2):",
            "            return is_same(",
            "                d1['data'], d1['filename'], d2['data'], d2['filename'],",
            "            )",
            "",
            "        return '\\n'.join([",
            "            ((self.same_fmt % (css_class, html_encode(d_old['repr'])))",
            "             if is_same_dict(d_old, d_new) else self.inlinediff_fmt",
            "             % (css_class, html_encode(d_old['repr']), html_encode(d_new['repr']))",
            "             ) for (d_old, d_new) in zip(old_data, new_data)])",
            "",
            "",
            "InitializeClass(NamedFileListDiff)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "73": [
                "NamedFileBinaryDiff",
                "inline_diff"
            ],
            "139": [
                "NamedFileListDiff",
                "inline_diff"
            ],
            "141": [
                "NamedFileListDiff",
                "inline_diff"
            ]
        },
        "addLocation": []
    },
    "Products/CMFDiffTool/tests/testFieldDiff.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 33,
                "afterPatchRowNumber": 33,
                "PatchRowcode": "         return u'different method val\\xfce'"
            },
            "1": {
                "beforePatchRowNumber": 34,
                "afterPatchRowNumber": 34,
                "PatchRowcode": " "
            },
            "2": {
                "beforePatchRowNumber": 35,
                "afterPatchRowNumber": 35,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 36,
                "PatchRowcode": "+class H:"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 37,
                "PatchRowcode": "+    attribute = '<script>alert(\"Hacker value\")</script>'"
            },
            "5": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 38,
                "PatchRowcode": "+"
            },
            "6": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 39,
                "PatchRowcode": "+    def method(self):"
            },
            "7": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 40,
                "PatchRowcode": "+        return '<script>alert(\"Hacker method value\")</script>'"
            },
            "8": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 41,
                "PatchRowcode": "+"
            },
            "9": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 42,
                "PatchRowcode": "+"
            },
            "10": {
                "beforePatchRowNumber": 36,
                "afterPatchRowNumber": 43,
                "PatchRowcode": " class TestFieldDiff(TestCase):"
            },
            "11": {
                "beforePatchRowNumber": 37,
                "afterPatchRowNumber": 44,
                "PatchRowcode": "     \"\"\"Test the FieldDiff class\"\"\""
            },
            "12": {
                "beforePatchRowNumber": 38,
                "afterPatchRowNumber": 45,
                "PatchRowcode": " "
            },
            "13": {
                "beforePatchRowNumber": 163,
                "afterPatchRowNumber": 170,
                "PatchRowcode": "         self.assertEqual(diff, ['- True'])"
            },
            "14": {
                "beforePatchRowNumber": 164,
                "afterPatchRowNumber": 171,
                "PatchRowcode": "         dump('+', [False], 0, 1, diff)"
            },
            "15": {
                "beforePatchRowNumber": 165,
                "afterPatchRowNumber": 172,
                "PatchRowcode": "         self.assertEqual(diff, ['- True', '+ False'])"
            },
            "16": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 173,
                "PatchRowcode": "+"
            },
            "17": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 174,
                "PatchRowcode": "+    def test_inline_diff_same(self):"
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 175,
                "PatchRowcode": "+        \"\"\"Test inline diff for attribute with same value\"\"\""
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 176,
                "PatchRowcode": "+        a = A()"
            },
            "20": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 177,
                "PatchRowcode": "+        uu = U()"
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 178,
                "PatchRowcode": "+        h = H()"
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 179,
                "PatchRowcode": "+        # We mostly just want to check that the inline diff renders without error."
            },
            "23": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 180,
                "PatchRowcode": "+        fd = FieldDiff(a, a, 'attribute')"
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 181,
                "PatchRowcode": "+        self.assertIn('class=\"InlineDiff\"', fd.inline_diff())"
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 182,
                "PatchRowcode": "+        fd = FieldDiff(uu, uu, 'attribute')"
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 183,
                "PatchRowcode": "+        self.assertIn('class=\"InlineDiff\"', fd.inline_diff())"
            },
            "27": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 184,
                "PatchRowcode": "+        self.assertNotIn(\"&gt;\", fd.inline_diff())"
            },
            "28": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 185,
                "PatchRowcode": "+        fd = FieldDiff(h, h, 'attribute')"
            },
            "29": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 186,
                "PatchRowcode": "+        self.assertIn('class=\"InlineDiff\"', fd.inline_diff())"
            },
            "30": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 187,
                "PatchRowcode": "+        # h.attribute contains a script, and this should be escaped."
            },
            "31": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 188,
                "PatchRowcode": "+        self.assertNotIn(h.attribute, fd.inline_diff())"
            },
            "32": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 189,
                "PatchRowcode": "+        self.assertIn(\"&gt;\", fd.inline_diff())"
            },
            "33": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 190,
                "PatchRowcode": "+"
            },
            "34": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 191,
                "PatchRowcode": "+    def test_inline_diff_different(self):"
            },
            "35": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 192,
                "PatchRowcode": "+        \"\"\"Test inline diff for attribute with different value\"\"\""
            },
            "36": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 193,
                "PatchRowcode": "+        a = A()"
            },
            "37": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 194,
                "PatchRowcode": "+        uu = U()"
            },
            "38": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 195,
                "PatchRowcode": "+        h = H()"
            },
            "39": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 196,
                "PatchRowcode": "+        fd = FieldDiff(a, uu, 'attribute')"
            },
            "40": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 197,
                "PatchRowcode": "+        self.assertIn('class=\"InlineDiff\"', fd.inline_diff())"
            },
            "41": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 198,
                "PatchRowcode": "+        fd = FieldDiff(uu, a, 'attribute')"
            },
            "42": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 199,
                "PatchRowcode": "+        self.assertIn('class=\"InlineDiff\"', fd.inline_diff())"
            },
            "43": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 200,
                "PatchRowcode": "+        self.assertNotIn(\"&gt;\", fd.inline_diff())"
            },
            "44": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 201,
                "PatchRowcode": "+        fd = FieldDiff(uu, h, 'attribute')"
            },
            "45": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 202,
                "PatchRowcode": "+        self.assertIn('class=\"InlineDiff\"', fd.inline_diff())"
            },
            "46": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 203,
                "PatchRowcode": "+        # h.attribute contains a script, and this should be escaped."
            },
            "47": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 204,
                "PatchRowcode": "+        self.assertNotIn(h.attribute, fd.inline_diff())"
            },
            "48": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 205,
                "PatchRowcode": "+        fd = FieldDiff(h, uu, 'attribute')"
            },
            "49": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 206,
                "PatchRowcode": "+        self.assertIn('class=\"InlineDiff\"', fd.inline_diff())"
            },
            "50": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 207,
                "PatchRowcode": "+        # h.attribute contains a script, and this should be escaped."
            },
            "51": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 208,
                "PatchRowcode": "+        self.assertNotIn(h.attribute, fd.inline_diff())"
            },
            "52": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 209,
                "PatchRowcode": "+        self.assertIn(\"&gt;\", fd.inline_diff())"
            }
        },
        "frontPatchFile": [
            "# -*- coding: utf-8 -*-",
            "#",
            "# CMFDiffTool tests",
            "#",
            "from os import linesep",
            "from plone.app.testing import PLONE_INTEGRATION_TESTING",
            "from Products.CMFDiffTool.FieldDiff import dump",
            "from Products.CMFDiffTool.FieldDiff import FieldDiff",
            "from unittest import TestCase",
            "",
            "",
            "_marker = []",
            "",
            "",
            "class A:",
            "    attribute = 'value'",
            "",
            "    def method(self):",
            "        return 'method value'",
            "",
            "",
            "class B:",
            "    attribute = 'different value'",
            "",
            "    def method(self):",
            "        return 'different method value'",
            "",
            "",
            "class U:",
            "    attribute = u'\\xfcnicode value'",
            "",
            "    def method(self):",
            "        return u'different method val\\xfce'",
            "",
            "",
            "class TestFieldDiff(TestCase):",
            "    \"\"\"Test the FieldDiff class\"\"\"",
            "",
            "    layer = PLONE_INTEGRATION_TESTING",
            "",
            "    def testInterface(self):",
            "        \"\"\"Ensure that tool instances implement the portal_diff interface\"\"\"",
            "        from Products.CMFDiffTool.interfaces.portal_diff import IDifference",
            "        self.assertTrue(IDifference.implementedBy(FieldDiff))",
            "",
            "    def testAttributeSame(self):",
            "        \"\"\"Test attribute with same value\"\"\"",
            "        a = A()",
            "        fd = FieldDiff(a, a, 'attribute')",
            "        self.assertTrue(fd.same)",
            "        uu = U()",
            "        fd = FieldDiff(uu, uu, 'attribute')",
            "        self.assertTrue(fd.same)",
            "",
            "    def testMethodSame(self):",
            "        \"\"\"Test method with same value\"\"\"",
            "        a = A()",
            "        fd = FieldDiff(a, a, 'method')",
            "        self.assertTrue(fd.same)",
            "        uu = U()",
            "        fd = FieldDiff(uu, uu, 'method')",
            "        self.assertTrue(fd.same)",
            "",
            "    def testAttributeDiff(self):",
            "        \"\"\"Test attribute with different value\"\"\"",
            "        a = A()",
            "        b = B()",
            "        uu = U()",
            "        fd = FieldDiff(a, b, 'attribute')",
            "        self.assertFalse(fd.same)",
            "        fd = FieldDiff(a, uu, 'attribute')",
            "        self.assertFalse(fd.same)",
            "",
            "    def testMethodDiff(self):",
            "        \"\"\"Test method with different value\"\"\"",
            "        a = A()",
            "        b = B()",
            "        uu = U()",
            "        fd = FieldDiff(a, b, 'method')",
            "        self.assertFalse(fd.same)",
            "        fd = FieldDiff(a, uu, 'method')",
            "        self.assertFalse(fd.same)",
            "",
            "    def testGetLineDiffsSame(self):",
            "        \"\"\"test getLineDiffs() method with same value\"\"\"",
            "        a = A()",
            "        fd = FieldDiff(a, a, 'attribute')",
            "        expected = [('equal', 0, 1, 0, 1)]",
            "        self.assertEqual(fd.getLineDiffs(), expected)",
            "        uu = U()",
            "        fd = FieldDiff(uu, uu, 'attribute')",
            "        expected = [('equal', 0, 1, 0, 1)]",
            "        self.assertEqual(fd.getLineDiffs(), expected)",
            "",
            "    def testGetLineDiffsDifferent(self):",
            "        \"\"\"test getLineDiffs() method with different value\"\"\"",
            "        a = A()",
            "        b = B()",
            "        uu = U()",
            "        fd = FieldDiff(a, b, 'attribute')",
            "        expected = [('replace', 0, 1, 0, 1)]",
            "        self.assertEqual(fd.getLineDiffs(), expected)",
            "        fd = FieldDiff(a, uu, 'attribute')",
            "        expected = [('replace', 0, 1, 0, 1)]",
            "        self.assertEqual(fd.getLineDiffs(), expected)",
            "",
            "    def testSameText(self):",
            "        \"\"\"Test text diff output with same value\"\"\"",
            "        a = A()",
            "        fd = FieldDiff(a, a, 'attribute')",
            "        self.assertEqual(fd.ndiff(), '  value')",
            "        uu = U()",
            "        fd = FieldDiff(uu, uu, 'attribute')",
            "        self.assertEqual(fd.ndiff(), u'  \\xfcnicode value')",
            "",
            "    def testDiffText(self):",
            "        \"\"\"Test text diff output with different value\"\"\"",
            "        a = A()",
            "        b = B()",
            "        uu = U()",
            "        expected = '- value%s+ different value' % linesep",
            "        fd = FieldDiff(a, b, 'attribute')",
            "        self.assertEqual(fd.ndiff(), expected)",
            "        expected = u'- value%s+ \\xfcnicode value' % linesep",
            "        fd = FieldDiff(a, uu, 'attribute')",
            "        self.assertEqual(fd.ndiff(), expected)",
            "",
            "    def test_dump_text(self):",
            "        \"\"\"Test dumping a diff of text.\"\"\"",
            "        diff = []",
            "        dump('-', ['support'], 0, 1, diff)",
            "        self.assertEqual(diff, ['- support'])",
            "        # Try unicode, a 'u' with an umlaut.",
            "        diff = []",
            "        dump('+', [u's\\xfcpport'], 0, 1, diff)",
            "        self.assertEqual(diff, [u'+ s\\xfcpport'])",
            "        # Combine them.",
            "        diff = []",
            "        dump('-', ['support'], 0, 1, diff)",
            "        dump('+', [u's\\xfcpport'], 0, 1, diff)",
            "        self.assertEqual(diff, ['- support', u'+ s\\xfcpport'])",
            "",
            "    def test_dump_integer(self):",
            "        \"\"\"Test dumping a diff of integers.\"\"\"",
            "        diff = []",
            "        dump('-', [4], 0, 1, diff)",
            "        self.assertEqual(diff, ['- 4'])",
            "        dump('+', [42], 0, 1, diff)",
            "        self.assertEqual(diff, ['- 4', '+ 42'])",
            "",
            "    def test_dump_float(self):",
            "        \"\"\"Test dumping a diff of floats.\"\"\"",
            "        diff = []",
            "        dump('-', [1.1], 0, 1, diff)",
            "        self.assertEqual(diff, ['- 1.1'])",
            "        dump('+', [1.2], 0, 1, diff)",
            "        self.assertEqual(diff, ['- 1.1', '+ 1.2'])",
            "",
            "    def test_dump_boolean(self):",
            "        \"\"\"Test dumping a diff of booleans.\"\"\"",
            "        diff = []",
            "        dump('-', [True], 0, 1, diff)",
            "        self.assertEqual(diff, ['- True'])",
            "        dump('+', [False], 0, 1, diff)",
            "        self.assertEqual(diff, ['- True', '+ False'])"
        ],
        "afterPatchFile": [
            "# -*- coding: utf-8 -*-",
            "#",
            "# CMFDiffTool tests",
            "#",
            "from os import linesep",
            "from plone.app.testing import PLONE_INTEGRATION_TESTING",
            "from Products.CMFDiffTool.FieldDiff import dump",
            "from Products.CMFDiffTool.FieldDiff import FieldDiff",
            "from unittest import TestCase",
            "",
            "",
            "_marker = []",
            "",
            "",
            "class A:",
            "    attribute = 'value'",
            "",
            "    def method(self):",
            "        return 'method value'",
            "",
            "",
            "class B:",
            "    attribute = 'different value'",
            "",
            "    def method(self):",
            "        return 'different method value'",
            "",
            "",
            "class U:",
            "    attribute = u'\\xfcnicode value'",
            "",
            "    def method(self):",
            "        return u'different method val\\xfce'",
            "",
            "",
            "class H:",
            "    attribute = '<script>alert(\"Hacker value\")</script>'",
            "",
            "    def method(self):",
            "        return '<script>alert(\"Hacker method value\")</script>'",
            "",
            "",
            "class TestFieldDiff(TestCase):",
            "    \"\"\"Test the FieldDiff class\"\"\"",
            "",
            "    layer = PLONE_INTEGRATION_TESTING",
            "",
            "    def testInterface(self):",
            "        \"\"\"Ensure that tool instances implement the portal_diff interface\"\"\"",
            "        from Products.CMFDiffTool.interfaces.portal_diff import IDifference",
            "        self.assertTrue(IDifference.implementedBy(FieldDiff))",
            "",
            "    def testAttributeSame(self):",
            "        \"\"\"Test attribute with same value\"\"\"",
            "        a = A()",
            "        fd = FieldDiff(a, a, 'attribute')",
            "        self.assertTrue(fd.same)",
            "        uu = U()",
            "        fd = FieldDiff(uu, uu, 'attribute')",
            "        self.assertTrue(fd.same)",
            "",
            "    def testMethodSame(self):",
            "        \"\"\"Test method with same value\"\"\"",
            "        a = A()",
            "        fd = FieldDiff(a, a, 'method')",
            "        self.assertTrue(fd.same)",
            "        uu = U()",
            "        fd = FieldDiff(uu, uu, 'method')",
            "        self.assertTrue(fd.same)",
            "",
            "    def testAttributeDiff(self):",
            "        \"\"\"Test attribute with different value\"\"\"",
            "        a = A()",
            "        b = B()",
            "        uu = U()",
            "        fd = FieldDiff(a, b, 'attribute')",
            "        self.assertFalse(fd.same)",
            "        fd = FieldDiff(a, uu, 'attribute')",
            "        self.assertFalse(fd.same)",
            "",
            "    def testMethodDiff(self):",
            "        \"\"\"Test method with different value\"\"\"",
            "        a = A()",
            "        b = B()",
            "        uu = U()",
            "        fd = FieldDiff(a, b, 'method')",
            "        self.assertFalse(fd.same)",
            "        fd = FieldDiff(a, uu, 'method')",
            "        self.assertFalse(fd.same)",
            "",
            "    def testGetLineDiffsSame(self):",
            "        \"\"\"test getLineDiffs() method with same value\"\"\"",
            "        a = A()",
            "        fd = FieldDiff(a, a, 'attribute')",
            "        expected = [('equal', 0, 1, 0, 1)]",
            "        self.assertEqual(fd.getLineDiffs(), expected)",
            "        uu = U()",
            "        fd = FieldDiff(uu, uu, 'attribute')",
            "        expected = [('equal', 0, 1, 0, 1)]",
            "        self.assertEqual(fd.getLineDiffs(), expected)",
            "",
            "    def testGetLineDiffsDifferent(self):",
            "        \"\"\"test getLineDiffs() method with different value\"\"\"",
            "        a = A()",
            "        b = B()",
            "        uu = U()",
            "        fd = FieldDiff(a, b, 'attribute')",
            "        expected = [('replace', 0, 1, 0, 1)]",
            "        self.assertEqual(fd.getLineDiffs(), expected)",
            "        fd = FieldDiff(a, uu, 'attribute')",
            "        expected = [('replace', 0, 1, 0, 1)]",
            "        self.assertEqual(fd.getLineDiffs(), expected)",
            "",
            "    def testSameText(self):",
            "        \"\"\"Test text diff output with same value\"\"\"",
            "        a = A()",
            "        fd = FieldDiff(a, a, 'attribute')",
            "        self.assertEqual(fd.ndiff(), '  value')",
            "        uu = U()",
            "        fd = FieldDiff(uu, uu, 'attribute')",
            "        self.assertEqual(fd.ndiff(), u'  \\xfcnicode value')",
            "",
            "    def testDiffText(self):",
            "        \"\"\"Test text diff output with different value\"\"\"",
            "        a = A()",
            "        b = B()",
            "        uu = U()",
            "        expected = '- value%s+ different value' % linesep",
            "        fd = FieldDiff(a, b, 'attribute')",
            "        self.assertEqual(fd.ndiff(), expected)",
            "        expected = u'- value%s+ \\xfcnicode value' % linesep",
            "        fd = FieldDiff(a, uu, 'attribute')",
            "        self.assertEqual(fd.ndiff(), expected)",
            "",
            "    def test_dump_text(self):",
            "        \"\"\"Test dumping a diff of text.\"\"\"",
            "        diff = []",
            "        dump('-', ['support'], 0, 1, diff)",
            "        self.assertEqual(diff, ['- support'])",
            "        # Try unicode, a 'u' with an umlaut.",
            "        diff = []",
            "        dump('+', [u's\\xfcpport'], 0, 1, diff)",
            "        self.assertEqual(diff, [u'+ s\\xfcpport'])",
            "        # Combine them.",
            "        diff = []",
            "        dump('-', ['support'], 0, 1, diff)",
            "        dump('+', [u's\\xfcpport'], 0, 1, diff)",
            "        self.assertEqual(diff, ['- support', u'+ s\\xfcpport'])",
            "",
            "    def test_dump_integer(self):",
            "        \"\"\"Test dumping a diff of integers.\"\"\"",
            "        diff = []",
            "        dump('-', [4], 0, 1, diff)",
            "        self.assertEqual(diff, ['- 4'])",
            "        dump('+', [42], 0, 1, diff)",
            "        self.assertEqual(diff, ['- 4', '+ 42'])",
            "",
            "    def test_dump_float(self):",
            "        \"\"\"Test dumping a diff of floats.\"\"\"",
            "        diff = []",
            "        dump('-', [1.1], 0, 1, diff)",
            "        self.assertEqual(diff, ['- 1.1'])",
            "        dump('+', [1.2], 0, 1, diff)",
            "        self.assertEqual(diff, ['- 1.1', '+ 1.2'])",
            "",
            "    def test_dump_boolean(self):",
            "        \"\"\"Test dumping a diff of booleans.\"\"\"",
            "        diff = []",
            "        dump('-', [True], 0, 1, diff)",
            "        self.assertEqual(diff, ['- True'])",
            "        dump('+', [False], 0, 1, diff)",
            "        self.assertEqual(diff, ['- True', '+ False'])",
            "",
            "    def test_inline_diff_same(self):",
            "        \"\"\"Test inline diff for attribute with same value\"\"\"",
            "        a = A()",
            "        uu = U()",
            "        h = H()",
            "        # We mostly just want to check that the inline diff renders without error.",
            "        fd = FieldDiff(a, a, 'attribute')",
            "        self.assertIn('class=\"InlineDiff\"', fd.inline_diff())",
            "        fd = FieldDiff(uu, uu, 'attribute')",
            "        self.assertIn('class=\"InlineDiff\"', fd.inline_diff())",
            "        self.assertNotIn(\"&gt;\", fd.inline_diff())",
            "        fd = FieldDiff(h, h, 'attribute')",
            "        self.assertIn('class=\"InlineDiff\"', fd.inline_diff())",
            "        # h.attribute contains a script, and this should be escaped.",
            "        self.assertNotIn(h.attribute, fd.inline_diff())",
            "        self.assertIn(\"&gt;\", fd.inline_diff())",
            "",
            "    def test_inline_diff_different(self):",
            "        \"\"\"Test inline diff for attribute with different value\"\"\"",
            "        a = A()",
            "        uu = U()",
            "        h = H()",
            "        fd = FieldDiff(a, uu, 'attribute')",
            "        self.assertIn('class=\"InlineDiff\"', fd.inline_diff())",
            "        fd = FieldDiff(uu, a, 'attribute')",
            "        self.assertIn('class=\"InlineDiff\"', fd.inline_diff())",
            "        self.assertNotIn(\"&gt;\", fd.inline_diff())",
            "        fd = FieldDiff(uu, h, 'attribute')",
            "        self.assertIn('class=\"InlineDiff\"', fd.inline_diff())",
            "        # h.attribute contains a script, and this should be escaped.",
            "        self.assertNotIn(h.attribute, fd.inline_diff())",
            "        fd = FieldDiff(h, uu, 'attribute')",
            "        self.assertIn('class=\"InlineDiff\"', fd.inline_diff())",
            "        # h.attribute contains a script, and this should be escaped.",
            "        self.assertNotIn(h.attribute, fd.inline_diff())",
            "        self.assertIn(\"&gt;\", fd.inline_diff())"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1"
        ],
        "dele_reviseLocation": {},
        "addLocation": [
            "Products.CMFDiffTool.tests.testFieldDiff.TestFieldDiff.self",
            "airflow.configuration"
        ]
    },
    "Products/CMFDiffTool/tests/testListDiff.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 22,
                "afterPatchRowNumber": 22,
                "PatchRowcode": "     attribute = [1, 2, 3, 4]"
            },
            "1": {
                "beforePatchRowNumber": 23,
                "afterPatchRowNumber": 23,
                "PatchRowcode": " "
            },
            "2": {
                "beforePatchRowNumber": 24,
                "afterPatchRowNumber": 24,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 25,
                "PatchRowcode": "+class HList:"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 26,
                "PatchRowcode": "+    attribute = ['<script>alert(\"Hacker value\")</script>']"
            },
            "5": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 27,
                "PatchRowcode": "+"
            },
            "6": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 28,
                "PatchRowcode": "+"
            },
            "7": {
                "beforePatchRowNumber": 25,
                "afterPatchRowNumber": 29,
                "PatchRowcode": " class C:"
            },
            "8": {
                "beforePatchRowNumber": 26,
                "afterPatchRowNumber": 30,
                "PatchRowcode": "     attribute = {'a': 1, 'b': 2}"
            },
            "9": {
                "beforePatchRowNumber": 27,
                "afterPatchRowNumber": 31,
                "PatchRowcode": " "
            },
            "10": {
                "beforePatchRowNumber": 30,
                "afterPatchRowNumber": 34,
                "PatchRowcode": "     attribute = {'a': 1, 'b': 2, 'c': 3}"
            },
            "11": {
                "beforePatchRowNumber": 31,
                "afterPatchRowNumber": 35,
                "PatchRowcode": " "
            },
            "12": {
                "beforePatchRowNumber": 32,
                "afterPatchRowNumber": 36,
                "PatchRowcode": " "
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 37,
                "PatchRowcode": "+class HDict:"
            },
            "14": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 38,
                "PatchRowcode": "+    attribute = {'a': '<script>alert(\"Hacker value\")</script>'}"
            },
            "15": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 39,
                "PatchRowcode": "+"
            },
            "16": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 40,
                "PatchRowcode": "+"
            },
            "17": {
                "beforePatchRowNumber": 33,
                "afterPatchRowNumber": 41,
                "PatchRowcode": " class TestListDiff(BaseDXTestCase):"
            },
            "18": {
                "beforePatchRowNumber": 34,
                "afterPatchRowNumber": 42,
                "PatchRowcode": "     \"\"\"Test the ListDiff class\"\"\""
            },
            "19": {
                "beforePatchRowNumber": 35,
                "afterPatchRowNumber": 43,
                "PatchRowcode": " "
            },
            "20": {
                "beforePatchRowNumber": 127,
                "afterPatchRowNumber": 135,
                "PatchRowcode": "         diff = ListDiff(a, b, 'attribute')"
            },
            "21": {
                "beforePatchRowNumber": 128,
                "afterPatchRowNumber": 136,
                "PatchRowcode": "         self.assertEqual(diff.inline_diff(), expected)"
            },
            "22": {
                "beforePatchRowNumber": 129,
                "afterPatchRowNumber": 137,
                "PatchRowcode": " "
            },
            "23": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 138,
                "PatchRowcode": "+    def test_inline_diff_hacker_list(self):"
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 139,
                "PatchRowcode": "+        a = A()"
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 140,
                "PatchRowcode": "+        h = HList()"
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 141,
                "PatchRowcode": "+        diff = ListDiff(a, h, 'attribute')"
            },
            "27": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 142,
                "PatchRowcode": "+        # The script tag should be escaped."
            },
            "28": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 143,
                "PatchRowcode": "+        self.assertNotIn(\"<script\", diff.inline_diff())"
            },
            "29": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 144,
                "PatchRowcode": "+        self.assertIn(\"&gt;\", diff.inline_diff())"
            },
            "30": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 145,
                "PatchRowcode": "+"
            },
            "31": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 146,
                "PatchRowcode": "+    def test_inline_diff_hacker_dict(self):"
            },
            "32": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 147,
                "PatchRowcode": "+        d = D()"
            },
            "33": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 148,
                "PatchRowcode": "+        h = HDict()"
            },
            "34": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 149,
                "PatchRowcode": "+        diff = ListDiff(d, h, 'attribute')"
            },
            "35": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 150,
                "PatchRowcode": "+        # The script tag should be escaped."
            },
            "36": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 151,
                "PatchRowcode": "+        self.assertNotIn(\"<script\", diff.inline_diff())"
            },
            "37": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 152,
                "PatchRowcode": "+        self.assertIn(\"&gt;\", diff.inline_diff())"
            },
            "38": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 153,
                "PatchRowcode": "+"
            },
            "39": {
                "beforePatchRowNumber": 130,
                "afterPatchRowNumber": 154,
                "PatchRowcode": "     def test_inline_diff_vocabulary(self):"
            },
            "40": {
                "beforePatchRowNumber": 131,
                "afterPatchRowNumber": 155,
                "PatchRowcode": "         # unchanged, with vocabulary title"
            },
            "41": {
                "beforePatchRowNumber": 132,
                "afterPatchRowNumber": 156,
                "PatchRowcode": "         expected = u'<div class=\"InlineDiff\">First Title</div>'"
            }
        },
        "frontPatchFile": [
            "# -*- coding: utf-8 -*-",
            "#",
            "# CMFDiffTool tests",
            "#",
            "from os import linesep",
            "from plone.app.testing import setRoles",
            "from plone.app.testing import TEST_USER_ID",
            "from Products.CMFDiffTool import testing",
            "from Products.CMFDiffTool.interfaces import IDifference",
            "from Products.CMFDiffTool.ListDiff import ListDiff",
            "from Products.CMFDiffTool.tests.BaseTestCase import BaseDXTestCase",
            "",
            "",
            "_marker = []",
            "",
            "",
            "class A:",
            "    attribute = [1, 2, 3]",
            "",
            "",
            "class B:",
            "    attribute = [1, 2, 3, 4]",
            "",
            "",
            "class C:",
            "    attribute = {'a': 1, 'b': 2}",
            "",
            "",
            "class D:",
            "    attribute = {'a': 1, 'b': 2, 'c': 3}",
            "",
            "",
            "class TestListDiff(BaseDXTestCase):",
            "    \"\"\"Test the ListDiff class\"\"\"",
            "",
            "    def setUp(self):",
            "        self.portal = self.layer['portal']",
            "        setRoles(self.portal, TEST_USER_ID, ['Manager'])",
            "        self.portal.invokeFactory(",
            "            testing.TEST_CONTENT_TYPE_ID,",
            "            'obj1',",
            "        )",
            "        self.portal.invokeFactory(",
            "            testing.TEST_CONTENT_TYPE_ID,",
            "            'obj2',",
            "        )",
            "",
            "        self.obj1 = self.portal['obj1']",
            "        self.obj2 = self.portal['obj2']",
            "",
            "    def testInterface(self):",
            "        \"\"\"Ensure that tool instances implement the portal_diff interface\"\"\"",
            "        self.assertTrue(IDifference.implementedBy(ListDiff))",
            "",
            "    def testInvalidValue(self):",
            "        \"\"\" Test if no error with invalid values \"\"\"",
            "        a = A()",
            "        a.attribute = []",
            "        b = A()",
            "",
            "        b.attribute = None",
            "        diff = ListDiff(a, b, 'attribute')",
            "        self.assertEqual([('insert', 0, 0, 0, 1)], diff.getLineDiffs())",
            "",
            "        b.attribute = 0",
            "        diff = ListDiff(a, b, 'attribute')",
            "        self.assertEqual([('insert', 0, 0, 0, 1)], diff.getLineDiffs())",
            "",
            "        b.attribute = ''",
            "        diff = ListDiff(a, b, 'attribute')",
            "        self.assertEqual([('insert', 0, 0, 0, 1)], diff.getLineDiffs())",
            "",
            "    def testAttributeSame(self):",
            "        \"\"\"Test attribute with same value\"\"\"",
            "        a = A()",
            "        diff = ListDiff(a, a, 'attribute')",
            "        self.assertTrue(diff.same)",
            "",
            "    def testAttributeDiff(self):",
            "        \"\"\"Test attribute with different value\"\"\"",
            "        a = A()",
            "        b = B()",
            "        diff = ListDiff(a, b, 'attribute')",
            "        self.assertFalse(diff.same)",
            "",
            "    def testGetLineDiffsSame(self):",
            "        \"\"\"test getLineDiffs() method with same value\"\"\"",
            "        a = A()",
            "        diff = ListDiff(a, a, 'attribute')",
            "        expected = [('equal', 0, 3, 0, 3)]",
            "        self.assertEqual(diff.getLineDiffs(), expected)",
            "",
            "    def testGetLineDiffsDifferent(self):",
            "        \"\"\"test getLineDiffs() method with different value\"\"\"",
            "        a = A()",
            "        b = B()",
            "        diff = ListDiff(a, b, 'attribute')",
            "        expected = [('equal', 0, 3, 0, 3), ('insert', 3, 3, 3, 4)]",
            "        self.assertEqual(diff.getLineDiffs(), expected)",
            "",
            "    def testSameText(self):",
            "        \"\"\"Test text diff output with no diff\"\"\"",
            "        a = A()",
            "        diff = ListDiff(a, a, 'attribute')",
            "        expected = '  1%(linesep)s  2%(linesep)s  3' % {'linesep': linesep}",
            "        self.assertEqual(diff.ndiff(), expected)",
            "",
            "    def testDiffText(self):",
            "        \"\"\"Test text diff output with no diff\"\"\"",
            "        a = A()",
            "        b = B()",
            "        expected = '  1%(linesep)s  2%(linesep)s  3%(linesep)s+ 4' % \\",
            "                   {'linesep': linesep}",
            "        diff = ListDiff(a, b, 'attribute')",
            "        self.assertEqual(diff.ndiff(), expected)",
            "",
            "    def test_inline_diff(self):",
            "        a = A()",
            "        b = B()",
            "        expected = \"\"\"<div class=\"InlineDiff\">1</div>",
            "<div class=\"InlineDiff\">2</div>",
            "<div class=\"InlineDiff\">3</div>",
            "<div class=\"InlineDiff\">",
            "    <div class=\"diff_sub\"></div>",
            "    <div class=\"diff_add\">4</div>",
            "</div>\"\"\"",
            "        diff = ListDiff(a, b, 'attribute')",
            "        self.assertEqual(diff.inline_diff(), expected)",
            "",
            "    def test_inline_diff_vocabulary(self):",
            "        # unchanged, with vocabulary title",
            "        expected = u'<div class=\"InlineDiff\">First Title</div>'",
            "        self._test_diff_list([testing.VOCABULARY_TUPLES[0][0]],",
            "                             [testing.VOCABULARY_TUPLES[0][0]], True, expected)",
            "        # unchanged, without vocabulary title",
            "        expected = u'<div class=\"InlineDiff\">second_value</div>'",
            "        self._test_diff_list([testing.VOCABULARY_TUPLES[1][0]],",
            "                             [testing.VOCABULARY_TUPLES[1][0]], True, expected)",
            "        # changed: add value, with vocabulary title",
            "        expected = u'''<div class=\"InlineDiff\">",
            "    <div class=\"diff_sub\"></div>",
            "    <div class=\"diff_add\">First Title</div>",
            "</div>'''",
            "        self._test_diff_list([],",
            "                             [testing.VOCABULARY_TUPLES[0][0]],",
            "                             False, expected)",
            "        # changed: replaced unique value by another one, displaying titles",
            "        expected = u'''<div class=\"InlineDiff\">",
            "    <div class=\"diff_sub\">First Title</div>",
            "    <div class=\"diff_add\"></div>",
            "</div>",
            "<div class=\"InlineDiff\">",
            "    <div class=\"diff_sub\"></div>",
            "    <div class=\"diff_add\">Third Title</div>",
            "</div>'''",
            "        self._test_diff_list([testing.VOCABULARY_TUPLES[0][0]],",
            "                             [testing.VOCABULARY_TUPLES[2][0]],",
            "                             False, expected)",
            "        # changed: replaced multiple values by others, displaying titles",
            "        expected = u'''<div class=\"InlineDiff\">",
            "    <div class=\"diff_sub\">First Title</div>",
            "    <div class=\"diff_add\"></div>",
            "</div>",
            "<div class=\"InlineDiff\">second_value</div>",
            "<div class=\"InlineDiff\">",
            "    <div class=\"diff_sub\"></div>",
            "    <div class=\"diff_add\">Third Title</div>",
            "</div>'''",
            "        self._test_diff_list([testing.VOCABULARY_TUPLES[0][0],",
            "                              testing.VOCABULARY_TUPLES[1][0]],",
            "                             [testing.VOCABULARY_TUPLES[1][0],",
            "                              testing.VOCABULARY_TUPLES[2][0]],",
            "                             False, expected)",
            "        # changed: replaced multiple values by others, displaying titles",
            "        expected = u'''<div class=\"InlineDiff\">",
            "    <div class=\"diff_sub\"></div>",
            "    <div class=\"diff_add\">Third Title</div>",
            "</div>",
            "<div class=\"InlineDiff\">First Title</div>",
            "<div class=\"InlineDiff\">",
            "    <div class=\"diff_sub\">second_value</div>",
            "    <div class=\"diff_add\"></div>",
            "</div>'''",
            "        self._test_diff_list([testing.VOCABULARY_TUPLES[0][0],",
            "                              testing.VOCABULARY_TUPLES[1][0]],",
            "                             [testing.VOCABULARY_TUPLES[2][0],",
            "                              testing.VOCABULARY_TUPLES[0][0]],",
            "                             False, expected)",
            "        # changed: removed values, displaying titles",
            "        expected = u'''<div class=\"InlineDiff\">",
            "    <div class=\"diff_sub\">First Title</div>",
            "    <div class=\"diff_add\"></div>",
            "</div>",
            "<div class=\"InlineDiff\">",
            "    <div class=\"diff_sub\">second_value</div>",
            "    <div class=\"diff_add\"></div>",
            "</div>'''",
            "        self._test_diff_list([testing.VOCABULARY_TUPLES[0][0],",
            "                              testing.VOCABULARY_TUPLES[1][0]],",
            "                             [], False, expected)",
            "",
            "    def _test_diff_list(self, value1, value2, same, expected):",
            "        self.obj1.choices = value1",
            "        self.obj2.choices = value2",
            "        diff = ListDiff(self.obj1, self.obj2, 'choices')",
            "        self.assertEqual(diff.same, same)",
            "        self.assertEqual(diff.inline_diff(), expected)",
            "",
            "    def testGetLineDictDiffsSame(self):",
            "        \"\"\"test getLineDiffs() method with dict same value\"\"\"",
            "        c = C()",
            "        diff = ListDiff(c, c, 'attribute')",
            "        expected = [('equal', 0, 1, 0, 1)]",
            "        self.assertEqual(diff.getLineDiffs(), expected)",
            "",
            "    def testGetLineDictDiffsDifferent(self):",
            "        \"\"\"test getLineDiffs() method with dict different value\"\"\"",
            "        c = C()",
            "        d = D()",
            "        diff = ListDiff(c, d, 'attribute')",
            "        expected = [('replace', 0, 1, 0, 1)]",
            "        self.assertEqual(diff.getLineDiffs(), expected)"
        ],
        "afterPatchFile": [
            "# -*- coding: utf-8 -*-",
            "#",
            "# CMFDiffTool tests",
            "#",
            "from os import linesep",
            "from plone.app.testing import setRoles",
            "from plone.app.testing import TEST_USER_ID",
            "from Products.CMFDiffTool import testing",
            "from Products.CMFDiffTool.interfaces import IDifference",
            "from Products.CMFDiffTool.ListDiff import ListDiff",
            "from Products.CMFDiffTool.tests.BaseTestCase import BaseDXTestCase",
            "",
            "",
            "_marker = []",
            "",
            "",
            "class A:",
            "    attribute = [1, 2, 3]",
            "",
            "",
            "class B:",
            "    attribute = [1, 2, 3, 4]",
            "",
            "",
            "class HList:",
            "    attribute = ['<script>alert(\"Hacker value\")</script>']",
            "",
            "",
            "class C:",
            "    attribute = {'a': 1, 'b': 2}",
            "",
            "",
            "class D:",
            "    attribute = {'a': 1, 'b': 2, 'c': 3}",
            "",
            "",
            "class HDict:",
            "    attribute = {'a': '<script>alert(\"Hacker value\")</script>'}",
            "",
            "",
            "class TestListDiff(BaseDXTestCase):",
            "    \"\"\"Test the ListDiff class\"\"\"",
            "",
            "    def setUp(self):",
            "        self.portal = self.layer['portal']",
            "        setRoles(self.portal, TEST_USER_ID, ['Manager'])",
            "        self.portal.invokeFactory(",
            "            testing.TEST_CONTENT_TYPE_ID,",
            "            'obj1',",
            "        )",
            "        self.portal.invokeFactory(",
            "            testing.TEST_CONTENT_TYPE_ID,",
            "            'obj2',",
            "        )",
            "",
            "        self.obj1 = self.portal['obj1']",
            "        self.obj2 = self.portal['obj2']",
            "",
            "    def testInterface(self):",
            "        \"\"\"Ensure that tool instances implement the portal_diff interface\"\"\"",
            "        self.assertTrue(IDifference.implementedBy(ListDiff))",
            "",
            "    def testInvalidValue(self):",
            "        \"\"\" Test if no error with invalid values \"\"\"",
            "        a = A()",
            "        a.attribute = []",
            "        b = A()",
            "",
            "        b.attribute = None",
            "        diff = ListDiff(a, b, 'attribute')",
            "        self.assertEqual([('insert', 0, 0, 0, 1)], diff.getLineDiffs())",
            "",
            "        b.attribute = 0",
            "        diff = ListDiff(a, b, 'attribute')",
            "        self.assertEqual([('insert', 0, 0, 0, 1)], diff.getLineDiffs())",
            "",
            "        b.attribute = ''",
            "        diff = ListDiff(a, b, 'attribute')",
            "        self.assertEqual([('insert', 0, 0, 0, 1)], diff.getLineDiffs())",
            "",
            "    def testAttributeSame(self):",
            "        \"\"\"Test attribute with same value\"\"\"",
            "        a = A()",
            "        diff = ListDiff(a, a, 'attribute')",
            "        self.assertTrue(diff.same)",
            "",
            "    def testAttributeDiff(self):",
            "        \"\"\"Test attribute with different value\"\"\"",
            "        a = A()",
            "        b = B()",
            "        diff = ListDiff(a, b, 'attribute')",
            "        self.assertFalse(diff.same)",
            "",
            "    def testGetLineDiffsSame(self):",
            "        \"\"\"test getLineDiffs() method with same value\"\"\"",
            "        a = A()",
            "        diff = ListDiff(a, a, 'attribute')",
            "        expected = [('equal', 0, 3, 0, 3)]",
            "        self.assertEqual(diff.getLineDiffs(), expected)",
            "",
            "    def testGetLineDiffsDifferent(self):",
            "        \"\"\"test getLineDiffs() method with different value\"\"\"",
            "        a = A()",
            "        b = B()",
            "        diff = ListDiff(a, b, 'attribute')",
            "        expected = [('equal', 0, 3, 0, 3), ('insert', 3, 3, 3, 4)]",
            "        self.assertEqual(diff.getLineDiffs(), expected)",
            "",
            "    def testSameText(self):",
            "        \"\"\"Test text diff output with no diff\"\"\"",
            "        a = A()",
            "        diff = ListDiff(a, a, 'attribute')",
            "        expected = '  1%(linesep)s  2%(linesep)s  3' % {'linesep': linesep}",
            "        self.assertEqual(diff.ndiff(), expected)",
            "",
            "    def testDiffText(self):",
            "        \"\"\"Test text diff output with no diff\"\"\"",
            "        a = A()",
            "        b = B()",
            "        expected = '  1%(linesep)s  2%(linesep)s  3%(linesep)s+ 4' % \\",
            "                   {'linesep': linesep}",
            "        diff = ListDiff(a, b, 'attribute')",
            "        self.assertEqual(diff.ndiff(), expected)",
            "",
            "    def test_inline_diff(self):",
            "        a = A()",
            "        b = B()",
            "        expected = \"\"\"<div class=\"InlineDiff\">1</div>",
            "<div class=\"InlineDiff\">2</div>",
            "<div class=\"InlineDiff\">3</div>",
            "<div class=\"InlineDiff\">",
            "    <div class=\"diff_sub\"></div>",
            "    <div class=\"diff_add\">4</div>",
            "</div>\"\"\"",
            "        diff = ListDiff(a, b, 'attribute')",
            "        self.assertEqual(diff.inline_diff(), expected)",
            "",
            "    def test_inline_diff_hacker_list(self):",
            "        a = A()",
            "        h = HList()",
            "        diff = ListDiff(a, h, 'attribute')",
            "        # The script tag should be escaped.",
            "        self.assertNotIn(\"<script\", diff.inline_diff())",
            "        self.assertIn(\"&gt;\", diff.inline_diff())",
            "",
            "    def test_inline_diff_hacker_dict(self):",
            "        d = D()",
            "        h = HDict()",
            "        diff = ListDiff(d, h, 'attribute')",
            "        # The script tag should be escaped.",
            "        self.assertNotIn(\"<script\", diff.inline_diff())",
            "        self.assertIn(\"&gt;\", diff.inline_diff())",
            "",
            "    def test_inline_diff_vocabulary(self):",
            "        # unchanged, with vocabulary title",
            "        expected = u'<div class=\"InlineDiff\">First Title</div>'",
            "        self._test_diff_list([testing.VOCABULARY_TUPLES[0][0]],",
            "                             [testing.VOCABULARY_TUPLES[0][0]], True, expected)",
            "        # unchanged, without vocabulary title",
            "        expected = u'<div class=\"InlineDiff\">second_value</div>'",
            "        self._test_diff_list([testing.VOCABULARY_TUPLES[1][0]],",
            "                             [testing.VOCABULARY_TUPLES[1][0]], True, expected)",
            "        # changed: add value, with vocabulary title",
            "        expected = u'''<div class=\"InlineDiff\">",
            "    <div class=\"diff_sub\"></div>",
            "    <div class=\"diff_add\">First Title</div>",
            "</div>'''",
            "        self._test_diff_list([],",
            "                             [testing.VOCABULARY_TUPLES[0][0]],",
            "                             False, expected)",
            "        # changed: replaced unique value by another one, displaying titles",
            "        expected = u'''<div class=\"InlineDiff\">",
            "    <div class=\"diff_sub\">First Title</div>",
            "    <div class=\"diff_add\"></div>",
            "</div>",
            "<div class=\"InlineDiff\">",
            "    <div class=\"diff_sub\"></div>",
            "    <div class=\"diff_add\">Third Title</div>",
            "</div>'''",
            "        self._test_diff_list([testing.VOCABULARY_TUPLES[0][0]],",
            "                             [testing.VOCABULARY_TUPLES[2][0]],",
            "                             False, expected)",
            "        # changed: replaced multiple values by others, displaying titles",
            "        expected = u'''<div class=\"InlineDiff\">",
            "    <div class=\"diff_sub\">First Title</div>",
            "    <div class=\"diff_add\"></div>",
            "</div>",
            "<div class=\"InlineDiff\">second_value</div>",
            "<div class=\"InlineDiff\">",
            "    <div class=\"diff_sub\"></div>",
            "    <div class=\"diff_add\">Third Title</div>",
            "</div>'''",
            "        self._test_diff_list([testing.VOCABULARY_TUPLES[0][0],",
            "                              testing.VOCABULARY_TUPLES[1][0]],",
            "                             [testing.VOCABULARY_TUPLES[1][0],",
            "                              testing.VOCABULARY_TUPLES[2][0]],",
            "                             False, expected)",
            "        # changed: replaced multiple values by others, displaying titles",
            "        expected = u'''<div class=\"InlineDiff\">",
            "    <div class=\"diff_sub\"></div>",
            "    <div class=\"diff_add\">Third Title</div>",
            "</div>",
            "<div class=\"InlineDiff\">First Title</div>",
            "<div class=\"InlineDiff\">",
            "    <div class=\"diff_sub\">second_value</div>",
            "    <div class=\"diff_add\"></div>",
            "</div>'''",
            "        self._test_diff_list([testing.VOCABULARY_TUPLES[0][0],",
            "                              testing.VOCABULARY_TUPLES[1][0]],",
            "                             [testing.VOCABULARY_TUPLES[2][0],",
            "                              testing.VOCABULARY_TUPLES[0][0]],",
            "                             False, expected)",
            "        # changed: removed values, displaying titles",
            "        expected = u'''<div class=\"InlineDiff\">",
            "    <div class=\"diff_sub\">First Title</div>",
            "    <div class=\"diff_add\"></div>",
            "</div>",
            "<div class=\"InlineDiff\">",
            "    <div class=\"diff_sub\">second_value</div>",
            "    <div class=\"diff_add\"></div>",
            "</div>'''",
            "        self._test_diff_list([testing.VOCABULARY_TUPLES[0][0],",
            "                              testing.VOCABULARY_TUPLES[1][0]],",
            "                             [], False, expected)",
            "",
            "    def _test_diff_list(self, value1, value2, same, expected):",
            "        self.obj1.choices = value1",
            "        self.obj2.choices = value2",
            "        diff = ListDiff(self.obj1, self.obj2, 'choices')",
            "        self.assertEqual(diff.same, same)",
            "        self.assertEqual(diff.inline_diff(), expected)",
            "",
            "    def testGetLineDictDiffsSame(self):",
            "        \"\"\"test getLineDiffs() method with dict same value\"\"\"",
            "        c = C()",
            "        diff = ListDiff(c, c, 'attribute')",
            "        expected = [('equal', 0, 1, 0, 1)]",
            "        self.assertEqual(diff.getLineDiffs(), expected)",
            "",
            "    def testGetLineDictDiffsDifferent(self):",
            "        \"\"\"test getLineDiffs() method with dict different value\"\"\"",
            "        c = C()",
            "        d = D()",
            "        diff = ListDiff(c, d, 'attribute')",
            "        expected = [('replace', 0, 1, 0, 1)]",
            "        self.assertEqual(diff.getLineDiffs(), expected)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {},
        "addLocation": [
            "Products.CMFDiffTool.tests.testListDiff.TestListDiff.self",
            "airflow.configuration"
        ]
    },
    "Products/CMFDiffTool/tests/testTextDiff.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 23,
                "afterPatchRowNumber": 23,
                "PatchRowcode": "         return 'method \u904e\u52b4\u6b7b'"
            },
            "1": {
                "beforePatchRowNumber": 24,
                "afterPatchRowNumber": 24,
                "PatchRowcode": " "
            },
            "2": {
                "beforePatchRowNumber": 25,
                "afterPatchRowNumber": 25,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 26,
                "PatchRowcode": "+class H:"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 27,
                "PatchRowcode": "+    attribute = '<script>alert(\"Hacker value\")</script>'"
            },
            "5": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 28,
                "PatchRowcode": "+"
            },
            "6": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 29,
                "PatchRowcode": "+    def method(self):"
            },
            "7": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 30,
                "PatchRowcode": "+        return '<script>alert(\"Hacker method value\")</script>'"
            },
            "8": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 31,
                "PatchRowcode": "+"
            },
            "9": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 32,
                "PatchRowcode": "+"
            },
            "10": {
                "beforePatchRowNumber": 26,
                "afterPatchRowNumber": 33,
                "PatchRowcode": " class TestTextDiff(TestCase):"
            },
            "11": {
                "beforePatchRowNumber": 27,
                "afterPatchRowNumber": 34,
                "PatchRowcode": "     \"\"\"Test the TextDiff class\"\"\""
            },
            "12": {
                "beforePatchRowNumber": 28,
                "afterPatchRowNumber": 35,
                "PatchRowcode": "     layer = PLONE_INTEGRATION_TESTING"
            },
            "13": {
                "beforePatchRowNumber": 107,
                "afterPatchRowNumber": 114,
                "PatchRowcode": "         \"\"\"Test text diff output with different value\"\"\""
            },
            "14": {
                "beforePatchRowNumber": 108,
                "afterPatchRowNumber": 115,
                "PatchRowcode": "         a = A()"
            },
            "15": {
                "beforePatchRowNumber": 109,
                "afterPatchRowNumber": 116,
                "PatchRowcode": "         b = B()"
            },
            "16": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 117,
                "PatchRowcode": "+        h = H()"
            },
            "17": {
                "beforePatchRowNumber": 110,
                "afterPatchRowNumber": 118,
                "PatchRowcode": "         expected = \"\"\""
            },
            "18": {
                "beforePatchRowNumber": 111,
                "afterPatchRowNumber": 119,
                "PatchRowcode": "     <table class=\"diff\" id=\"difflib_chg_to0__top\""
            },
            "19": {
                "beforePatchRowNumber": 112,
                "afterPatchRowNumber": 120,
                "PatchRowcode": "            cellspacing=\"0\" cellpadding=\"0\" rules=\"groups\" >"
            },
            "20": {
                "beforePatchRowNumber": 119,
                "afterPatchRowNumber": 127,
                "PatchRowcode": "     </table>\"\"\"  # NOQA"
            },
            "21": {
                "beforePatchRowNumber": 120,
                "afterPatchRowNumber": 128,
                "PatchRowcode": "         fd = TextDiff(a, b, 'attribute')"
            },
            "22": {
                "beforePatchRowNumber": 121,
                "afterPatchRowNumber": 129,
                "PatchRowcode": "         self.assertEqual(fd.html_diff(), expected)"
            },
            "23": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 130,
                "PatchRowcode": "+"
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 131,
                "PatchRowcode": "+        fd = TextDiff(a, h, 'attribute')"
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 132,
                "PatchRowcode": "+        # h.attribute contains a script, and this should be escaped."
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 133,
                "PatchRowcode": "+        self.assertNotIn(h.attribute, fd.html_diff())"
            },
            "27": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 134,
                "PatchRowcode": "+        self.assertIn(\"&gt;\", fd.html_diff())"
            },
            "28": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 135,
                "PatchRowcode": "+"
            },
            "29": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 136,
                "PatchRowcode": "+    def testInlineDiff(self):"
            },
            "30": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 137,
                "PatchRowcode": "+        \"\"\"Test text inline diff output with different value\"\"\""
            },
            "31": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 138,
                "PatchRowcode": "+        a = A()"
            },
            "32": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 139,
                "PatchRowcode": "+        b = B()"
            },
            "33": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 140,
                "PatchRowcode": "+        h = H()"
            },
            "34": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 141,
                "PatchRowcode": "+        fd = TextDiff(a, b, 'attribute')"
            },
            "35": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 142,
                "PatchRowcode": "+        self.assertIn('class=\"InlineDiff FilenameDiff\"', fd.inline_diff())"
            },
            "36": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 143,
                "PatchRowcode": "+"
            },
            "37": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 144,
                "PatchRowcode": "+        fd = TextDiff(a, h, 'attribute')"
            },
            "38": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 145,
                "PatchRowcode": "+        self.assertIn('class=\"InlineDiff FilenameDiff\"', fd.inline_diff())"
            },
            "39": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 146,
                "PatchRowcode": "+        # h.attribute contains a script, and this should be escaped."
            },
            "40": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 147,
                "PatchRowcode": "+        self.assertNotIn(h.attribute, fd.inline_diff())"
            },
            "41": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 148,
                "PatchRowcode": "+        self.assertIn(\"&gt;\", fd.inline_diff())"
            }
        },
        "frontPatchFile": [
            "# -*- coding: utf-8 -*-",
            "",
            "from os import linesep",
            "from plone.app.testing import PLONE_INTEGRATION_TESTING",
            "from Products.CMFDiffTool.TextDiff import TextDiff",
            "from unittest import TestCase",
            "",
            "",
            "_marker = []",
            "",
            "",
            "class A:",
            "    attribute = '\u0915\u093e\u092e\u0938\u0942\u0924\u094d\u0930'",
            "",
            "    def method(self):",
            "        return 'method \u0915\u093e\u092e\u0938\u0942\u0924\u094d\u0930'",
            "",
            "",
            "class B:",
            "    attribute = '\u904e\u52b4\u6b7b'",
            "",
            "    def method(self):",
            "        return 'method \u904e\u52b4\u6b7b'",
            "",
            "",
            "class TestTextDiff(TestCase):",
            "    \"\"\"Test the TextDiff class\"\"\"",
            "    layer = PLONE_INTEGRATION_TESTING",
            "",
            "    def testInterface(self):",
            "        \"\"\"Ensure that tool instances implement the portal_diff interface\"\"\"",
            "        from Products.CMFDiffTool.interfaces import IDifference",
            "        self.assertTrue(IDifference.implementedBy(TextDiff))",
            "",
            "    def testAttributeSame(self):",
            "        \"\"\"Test attribute with same value\"\"\"",
            "        a = A()",
            "        fd = TextDiff(a, a, 'attribute')",
            "        self.assertTrue(fd.same)",
            "",
            "    def testMethodSame(self):",
            "        \"\"\"Test method with same value\"\"\"",
            "        a = A()",
            "        fd = TextDiff(a, a, 'method')",
            "        self.assertTrue(fd.same)",
            "",
            "    def testAttributeDiff(self):",
            "        \"\"\"Test attribute with different value\"\"\"",
            "        a = A()",
            "        b = B()",
            "        fd = TextDiff(a, b, 'attribute')",
            "        self.assertFalse(fd.same)",
            "",
            "    def testMethodDiff(self):",
            "        \"\"\"Test method with different value\"\"\"",
            "        a = A()",
            "        b = B()",
            "        fd = TextDiff(a, b, 'method')",
            "        self.assertFalse(fd.same)",
            "",
            "    def testGetLineDiffsSame(self):",
            "        \"\"\"test getLineDiffs() method with same value\"\"\"",
            "        a = A()",
            "        fd = TextDiff(a, a, 'attribute')",
            "        expected = [('equal', 0, 1, 0, 1)]",
            "        self.assertEqual(fd.getLineDiffs(), expected)",
            "",
            "    def testGetLineDiffsDifferent(self):",
            "        \"\"\"test getLineDiffs() method with different value\"\"\"",
            "        a = A()",
            "        b = B()",
            "        fd = TextDiff(a, b, 'attribute')",
            "        expected = [('replace', 0, 1, 0, 1)]",
            "        self.assertEqual(fd.getLineDiffs(), expected)",
            "",
            "    def testSameText(self):",
            "        \"\"\"Test text diff output with same value\"\"\"",
            "        a = A()",
            "        fd = TextDiff(a, a, 'attribute')",
            "        self.assertEqual(fd.ndiff(), '  \u0915\u093e\u092e\u0938\u0942\u0924\u094d\u0930')",
            "",
            "    def testDiffText(self):",
            "        \"\"\"Test text diff output with different value\"\"\"",
            "        a = A()",
            "        b = B()",
            "        expected = '- \u0915\u093e\u092e\u0938\u0942\u0924\u094d\u0930%s+ \u904e\u52b4\u6b7b' % linesep",
            "        fd = TextDiff(a, b, 'attribute')",
            "        self.assertEqual(fd.ndiff(), expected)",
            "",
            "    def testUnifiedDiff(self):",
            "        \"\"\"Test text diff output with different value\"\"\"",
            "        a = A()",
            "        b = B()",
            "",
            "        expected = \"\"\"--- version1",
            "",
            "+++ version2",
            "",
            "@@ -1 +1 @@",
            "",
            "-\u0915\u093e\u092e\u0938\u0942\u0924\u094d\u0930",
            "+\u904e\u52b4\u6b7b\"\"\"",
            "        fd = TextDiff(a, b, 'attribute', 'version1', 'version2')",
            "        self.assertEqual(fd.unified_diff(), expected)",
            "",
            "    def testHTMLDiff(self):",
            "        \"\"\"Test text diff output with different value\"\"\"",
            "        a = A()",
            "        b = B()",
            "        expected = \"\"\"",
            "    <table class=\"diff\" id=\"difflib_chg_to0__top\"",
            "           cellspacing=\"0\" cellpadding=\"0\" rules=\"groups\" >",
            "        <colgroup></colgroup> <colgroup></colgroup> <colgroup></colgroup>",
            "        <colgroup></colgroup> <colgroup></colgroup> <colgroup></colgroup>",
            "        <thead><tr><th class=\"diff_next\"><br /></th><th colspan=\"2\" class=\"diff_header\">None</th><th class=\"diff_next\"><br /></th><th colspan=\"2\" class=\"diff_header\">None</th></tr></thead>",
            "        <tbody>",
            "            <tr><td class=\"diff_next\" id=\"difflib_chg_to0__0\"><a href=\"#difflib_chg_to0__top\">t</a></td><td class=\"diff_header\" id=\"from0_1\">1</td><td nowrap=\"nowrap\"><span class=\"diff_sub\">\u0915\u093e\u092e\u0938\u0942\u0924\u094d\u0930</span></td><td class=\"diff_next\"><a href=\"#difflib_chg_to0__top\">t</a></td><td class=\"diff_header\" id=\"to0_1\">1</td><td nowrap=\"nowrap\"><span class=\"diff_add\">\u904e\u52b4\u6b7b</span></td></tr>",
            "        </tbody>",
            "    </table>\"\"\"  # NOQA",
            "        fd = TextDiff(a, b, 'attribute')",
            "        self.assertEqual(fd.html_diff(), expected)"
        ],
        "afterPatchFile": [
            "# -*- coding: utf-8 -*-",
            "",
            "from os import linesep",
            "from plone.app.testing import PLONE_INTEGRATION_TESTING",
            "from Products.CMFDiffTool.TextDiff import TextDiff",
            "from unittest import TestCase",
            "",
            "",
            "_marker = []",
            "",
            "",
            "class A:",
            "    attribute = '\u0915\u093e\u092e\u0938\u0942\u0924\u094d\u0930'",
            "",
            "    def method(self):",
            "        return 'method \u0915\u093e\u092e\u0938\u0942\u0924\u094d\u0930'",
            "",
            "",
            "class B:",
            "    attribute = '\u904e\u52b4\u6b7b'",
            "",
            "    def method(self):",
            "        return 'method \u904e\u52b4\u6b7b'",
            "",
            "",
            "class H:",
            "    attribute = '<script>alert(\"Hacker value\")</script>'",
            "",
            "    def method(self):",
            "        return '<script>alert(\"Hacker method value\")</script>'",
            "",
            "",
            "class TestTextDiff(TestCase):",
            "    \"\"\"Test the TextDiff class\"\"\"",
            "    layer = PLONE_INTEGRATION_TESTING",
            "",
            "    def testInterface(self):",
            "        \"\"\"Ensure that tool instances implement the portal_diff interface\"\"\"",
            "        from Products.CMFDiffTool.interfaces import IDifference",
            "        self.assertTrue(IDifference.implementedBy(TextDiff))",
            "",
            "    def testAttributeSame(self):",
            "        \"\"\"Test attribute with same value\"\"\"",
            "        a = A()",
            "        fd = TextDiff(a, a, 'attribute')",
            "        self.assertTrue(fd.same)",
            "",
            "    def testMethodSame(self):",
            "        \"\"\"Test method with same value\"\"\"",
            "        a = A()",
            "        fd = TextDiff(a, a, 'method')",
            "        self.assertTrue(fd.same)",
            "",
            "    def testAttributeDiff(self):",
            "        \"\"\"Test attribute with different value\"\"\"",
            "        a = A()",
            "        b = B()",
            "        fd = TextDiff(a, b, 'attribute')",
            "        self.assertFalse(fd.same)",
            "",
            "    def testMethodDiff(self):",
            "        \"\"\"Test method with different value\"\"\"",
            "        a = A()",
            "        b = B()",
            "        fd = TextDiff(a, b, 'method')",
            "        self.assertFalse(fd.same)",
            "",
            "    def testGetLineDiffsSame(self):",
            "        \"\"\"test getLineDiffs() method with same value\"\"\"",
            "        a = A()",
            "        fd = TextDiff(a, a, 'attribute')",
            "        expected = [('equal', 0, 1, 0, 1)]",
            "        self.assertEqual(fd.getLineDiffs(), expected)",
            "",
            "    def testGetLineDiffsDifferent(self):",
            "        \"\"\"test getLineDiffs() method with different value\"\"\"",
            "        a = A()",
            "        b = B()",
            "        fd = TextDiff(a, b, 'attribute')",
            "        expected = [('replace', 0, 1, 0, 1)]",
            "        self.assertEqual(fd.getLineDiffs(), expected)",
            "",
            "    def testSameText(self):",
            "        \"\"\"Test text diff output with same value\"\"\"",
            "        a = A()",
            "        fd = TextDiff(a, a, 'attribute')",
            "        self.assertEqual(fd.ndiff(), '  \u0915\u093e\u092e\u0938\u0942\u0924\u094d\u0930')",
            "",
            "    def testDiffText(self):",
            "        \"\"\"Test text diff output with different value\"\"\"",
            "        a = A()",
            "        b = B()",
            "        expected = '- \u0915\u093e\u092e\u0938\u0942\u0924\u094d\u0930%s+ \u904e\u52b4\u6b7b' % linesep",
            "        fd = TextDiff(a, b, 'attribute')",
            "        self.assertEqual(fd.ndiff(), expected)",
            "",
            "    def testUnifiedDiff(self):",
            "        \"\"\"Test text diff output with different value\"\"\"",
            "        a = A()",
            "        b = B()",
            "",
            "        expected = \"\"\"--- version1",
            "",
            "+++ version2",
            "",
            "@@ -1 +1 @@",
            "",
            "-\u0915\u093e\u092e\u0938\u0942\u0924\u094d\u0930",
            "+\u904e\u52b4\u6b7b\"\"\"",
            "        fd = TextDiff(a, b, 'attribute', 'version1', 'version2')",
            "        self.assertEqual(fd.unified_diff(), expected)",
            "",
            "    def testHTMLDiff(self):",
            "        \"\"\"Test text diff output with different value\"\"\"",
            "        a = A()",
            "        b = B()",
            "        h = H()",
            "        expected = \"\"\"",
            "    <table class=\"diff\" id=\"difflib_chg_to0__top\"",
            "           cellspacing=\"0\" cellpadding=\"0\" rules=\"groups\" >",
            "        <colgroup></colgroup> <colgroup></colgroup> <colgroup></colgroup>",
            "        <colgroup></colgroup> <colgroup></colgroup> <colgroup></colgroup>",
            "        <thead><tr><th class=\"diff_next\"><br /></th><th colspan=\"2\" class=\"diff_header\">None</th><th class=\"diff_next\"><br /></th><th colspan=\"2\" class=\"diff_header\">None</th></tr></thead>",
            "        <tbody>",
            "            <tr><td class=\"diff_next\" id=\"difflib_chg_to0__0\"><a href=\"#difflib_chg_to0__top\">t</a></td><td class=\"diff_header\" id=\"from0_1\">1</td><td nowrap=\"nowrap\"><span class=\"diff_sub\">\u0915\u093e\u092e\u0938\u0942\u0924\u094d\u0930</span></td><td class=\"diff_next\"><a href=\"#difflib_chg_to0__top\">t</a></td><td class=\"diff_header\" id=\"to0_1\">1</td><td nowrap=\"nowrap\"><span class=\"diff_add\">\u904e\u52b4\u6b7b</span></td></tr>",
            "        </tbody>",
            "    </table>\"\"\"  # NOQA",
            "        fd = TextDiff(a, b, 'attribute')",
            "        self.assertEqual(fd.html_diff(), expected)",
            "",
            "        fd = TextDiff(a, h, 'attribute')",
            "        # h.attribute contains a script, and this should be escaped.",
            "        self.assertNotIn(h.attribute, fd.html_diff())",
            "        self.assertIn(\"&gt;\", fd.html_diff())",
            "",
            "    def testInlineDiff(self):",
            "        \"\"\"Test text inline diff output with different value\"\"\"",
            "        a = A()",
            "        b = B()",
            "        h = H()",
            "        fd = TextDiff(a, b, 'attribute')",
            "        self.assertIn('class=\"InlineDiff FilenameDiff\"', fd.inline_diff())",
            "",
            "        fd = TextDiff(a, h, 'attribute')",
            "        self.assertIn('class=\"InlineDiff FilenameDiff\"', fd.inline_diff())",
            "        # h.attribute contains a script, and this should be escaped.",
            "        self.assertNotIn(h.attribute, fd.inline_diff())",
            "        self.assertIn(\"&gt;\", fd.inline_diff())"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1"
        ],
        "dele_reviseLocation": {},
        "addLocation": [
            "Products.CMFDiffTool.tests.testTextDiff.TestTextDiff.self",
            "airflow.configuration"
        ]
    },
    "Products/CMFDiffTool/tests/test_binarydiff.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 2,
                "afterPatchRowNumber": 2,
                "PatchRowcode": " from plone.app.testing import setRoles"
            },
            "1": {
                "beforePatchRowNumber": 3,
                "afterPatchRowNumber": 3,
                "PatchRowcode": " from plone.app.testing import TEST_USER_ID"
            },
            "2": {
                "beforePatchRowNumber": 4,
                "afterPatchRowNumber": 4,
                "PatchRowcode": " from plone.namedfile.file import NamedFile"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 5,
                "PatchRowcode": "+from Products.CMFDiffTool import BinaryDiff"
            },
            "4": {
                "beforePatchRowNumber": 5,
                "afterPatchRowNumber": 6,
                "PatchRowcode": " from Products.CMFDiffTool import namedfile"
            },
            "5": {
                "beforePatchRowNumber": 6,
                "afterPatchRowNumber": 7,
                "PatchRowcode": " from Products.CMFDiffTool import testing"
            },
            "6": {
                "beforePatchRowNumber": 7,
                "afterPatchRowNumber": 8,
                "PatchRowcode": " from Products.CMFDiffTool.interfaces import IDifference"
            },
            "7": {
                "beforePatchRowNumber": 70,
                "afterPatchRowNumber": 71,
                "PatchRowcode": "         diff = namedfile.NamedFileBinaryDiff(obj1, obj2, 'file')"
            },
            "8": {
                "beforePatchRowNumber": 71,
                "afterPatchRowNumber": 72,
                "PatchRowcode": "         self.assertTrue(IDifference.providedBy(diff))"
            },
            "9": {
                "beforePatchRowNumber": 72,
                "afterPatchRowNumber": 73,
                "PatchRowcode": "         self.assertTrue(diff.same)"
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 74,
                "PatchRowcode": "+"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 75,
                "PatchRowcode": "+    def test_should_escape_html(self):"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 76,
                "PatchRowcode": "+        self.portal = self.layer['portal']"
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 77,
                "PatchRowcode": "+        setRoles(self.portal, TEST_USER_ID, ['Manager'])"
            },
            "14": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 78,
                "PatchRowcode": "+        self.portal.invokeFactory("
            },
            "15": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 79,
                "PatchRowcode": "+            testing.TEST_CONTENT_TYPE_ID,"
            },
            "16": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 80,
                "PatchRowcode": "+            'obj1',"
            },
            "17": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 81,
                "PatchRowcode": "+            file=NamedFile(data='contents', filename=u'blah.txt'),"
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 82,
                "PatchRowcode": "+        )"
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 83,
                "PatchRowcode": "+        obj1 = self.portal['obj1']"
            },
            "20": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 84,
                "PatchRowcode": "+"
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 85,
                "PatchRowcode": "+        self.portal.invokeFactory("
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 86,
                "PatchRowcode": "+            testing.TEST_CONTENT_TYPE_ID,"
            },
            "23": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 87,
                "PatchRowcode": "+            'obj2',"
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 88,
                "PatchRowcode": "+            file=NamedFile(data='<script>alert(\"Hacker data\")</script>', filename=u'<script>alert(\"Hacker filename\")</script>.txt'),"
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 89,
                "PatchRowcode": "+        )"
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 90,
                "PatchRowcode": "+        obj2 = self.portal['obj2']"
            },
            "27": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 91,
                "PatchRowcode": "+"
            },
            "28": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 92,
                "PatchRowcode": "+        diff = namedfile.NamedFileBinaryDiff(obj1, obj2, 'file')"
            },
            "29": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 93,
                "PatchRowcode": "+        self.assertTrue(IDifference.providedBy(diff))"
            },
            "30": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 94,
                "PatchRowcode": "+        self.assertFalse(diff.same)"
            },
            "31": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 95,
                "PatchRowcode": "+        # The script tag should be escaped."
            },
            "32": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 96,
                "PatchRowcode": "+        self.assertNotIn(\"<script\", diff.inline_diff())"
            },
            "33": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 97,
                "PatchRowcode": "+        self.assertIn(\"&gt;\", diff.inline_diff())"
            },
            "34": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 98,
                "PatchRowcode": "+"
            },
            "35": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 99,
                "PatchRowcode": "+        # Test the more basic BinaryDiff."
            },
            "36": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 100,
                "PatchRowcode": "+        # It only compares the file names."
            },
            "37": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 101,
                "PatchRowcode": "+        # It uses the 'getFilename' method of the file,"
            },
            "38": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 102,
                "PatchRowcode": "+        # which namedfiles do not have.  So we hack it."
            },
            "39": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 103,
                "PatchRowcode": "+        obj1.file.getFilename = lambda: obj1.file.filename"
            },
            "40": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 104,
                "PatchRowcode": "+        obj2.file.getFilename = lambda: obj2.file.filename"
            },
            "41": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 105,
                "PatchRowcode": "+        diff = BinaryDiff.BinaryDiff(obj1, obj2, 'file')"
            },
            "42": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 106,
                "PatchRowcode": "+        self.assertTrue(IDifference.providedBy(diff))"
            },
            "43": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 107,
                "PatchRowcode": "+        self.assertFalse(diff.same)"
            },
            "44": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 108,
                "PatchRowcode": "+        # The script tag should be escaped."
            },
            "45": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 109,
                "PatchRowcode": "+        self.assertNotIn(\"<script\", diff.inline_diff())"
            },
            "46": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 110,
                "PatchRowcode": "+        self.assertIn(\"&gt;\", diff.inline_diff())"
            }
        },
        "frontPatchFile": [
            "# -*- coding: utf-8 -*-",
            "from plone.app.testing import setRoles",
            "from plone.app.testing import TEST_USER_ID",
            "from plone.namedfile.file import NamedFile",
            "from Products.CMFDiffTool import namedfile",
            "from Products.CMFDiffTool import testing",
            "from Products.CMFDiffTool.interfaces import IDifference",
            "from Products.CMFDiffTool.tests.BaseTestCase import BaseDXTestCase",
            "",
            "",
            "class BinaryDiffTestCase(BaseDXTestCase):",
            "",
            "    def test_should_detect_different_filename(self):",
            "        self.portal = self.layer['portal']",
            "        setRoles(self.portal, TEST_USER_ID, ['Manager'])",
            "        self.portal.invokeFactory(",
            "            testing.TEST_CONTENT_TYPE_ID,",
            "            'obj1',",
            "            file=NamedFile(data='contents', filename=u'blah.txt'),",
            "        )",
            "        obj1 = self.portal['obj1']",
            "",
            "        self.portal.invokeFactory(",
            "            testing.TEST_CONTENT_TYPE_ID,",
            "            'obj2',",
            "            file=NamedFile(data='contents', filename=u'bleh.txt'),",
            "        )",
            "        obj2 = self.portal['obj2']",
            "",
            "        diff = namedfile.NamedFileBinaryDiff(obj1, obj2, 'file')",
            "        self.assertTrue(IDifference.providedBy(diff))",
            "        self.assertFalse(diff.same)",
            "",
            "    def test_should_detect_different_data(self):",
            "        setRoles(self.portal, TEST_USER_ID, ['Manager'])",
            "        self.portal.invokeFactory(",
            "            testing.TEST_CONTENT_TYPE_ID,",
            "            'obj1',",
            "            file=NamedFile(data='contents', filename=u'f.txt'),",
            "        )",
            "        obj1 = self.portal['obj1']",
            "",
            "        self.portal.invokeFactory(",
            "            testing.TEST_CONTENT_TYPE_ID,",
            "            'obj2',",
            "            file=NamedFile(data='different contents', filename=u'f.txt'),",
            "        )",
            "        obj2 = self.portal['obj2']",
            "",
            "        diff = namedfile.NamedFileBinaryDiff(obj1, obj2, 'file')",
            "        self.assertTrue(IDifference.providedBy(diff))",
            "        self.assertFalse(diff.same)",
            "",
            "    def test_should_detect_same_data_and_filename(self):",
            "        setRoles(self.portal, TEST_USER_ID, ['Manager'])",
            "        self.portal.invokeFactory(",
            "            testing.TEST_CONTENT_TYPE_ID,",
            "            'obj1',",
            "            file=NamedFile(data='contents', filename=u'f.txt'),",
            "        )",
            "        obj1 = self.portal['obj1']",
            "",
            "        self.portal.invokeFactory(",
            "            testing.TEST_CONTENT_TYPE_ID,",
            "            'obj2',",
            "            file=NamedFile(data='contents', filename=u'f.txt'),",
            "        )",
            "        obj2 = self.portal['obj2']",
            "",
            "        diff = namedfile.NamedFileBinaryDiff(obj1, obj2, 'file')",
            "        self.assertTrue(IDifference.providedBy(diff))",
            "        self.assertTrue(diff.same)"
        ],
        "afterPatchFile": [
            "# -*- coding: utf-8 -*-",
            "from plone.app.testing import setRoles",
            "from plone.app.testing import TEST_USER_ID",
            "from plone.namedfile.file import NamedFile",
            "from Products.CMFDiffTool import BinaryDiff",
            "from Products.CMFDiffTool import namedfile",
            "from Products.CMFDiffTool import testing",
            "from Products.CMFDiffTool.interfaces import IDifference",
            "from Products.CMFDiffTool.tests.BaseTestCase import BaseDXTestCase",
            "",
            "",
            "class BinaryDiffTestCase(BaseDXTestCase):",
            "",
            "    def test_should_detect_different_filename(self):",
            "        self.portal = self.layer['portal']",
            "        setRoles(self.portal, TEST_USER_ID, ['Manager'])",
            "        self.portal.invokeFactory(",
            "            testing.TEST_CONTENT_TYPE_ID,",
            "            'obj1',",
            "            file=NamedFile(data='contents', filename=u'blah.txt'),",
            "        )",
            "        obj1 = self.portal['obj1']",
            "",
            "        self.portal.invokeFactory(",
            "            testing.TEST_CONTENT_TYPE_ID,",
            "            'obj2',",
            "            file=NamedFile(data='contents', filename=u'bleh.txt'),",
            "        )",
            "        obj2 = self.portal['obj2']",
            "",
            "        diff = namedfile.NamedFileBinaryDiff(obj1, obj2, 'file')",
            "        self.assertTrue(IDifference.providedBy(diff))",
            "        self.assertFalse(diff.same)",
            "",
            "    def test_should_detect_different_data(self):",
            "        setRoles(self.portal, TEST_USER_ID, ['Manager'])",
            "        self.portal.invokeFactory(",
            "            testing.TEST_CONTENT_TYPE_ID,",
            "            'obj1',",
            "            file=NamedFile(data='contents', filename=u'f.txt'),",
            "        )",
            "        obj1 = self.portal['obj1']",
            "",
            "        self.portal.invokeFactory(",
            "            testing.TEST_CONTENT_TYPE_ID,",
            "            'obj2',",
            "            file=NamedFile(data='different contents', filename=u'f.txt'),",
            "        )",
            "        obj2 = self.portal['obj2']",
            "",
            "        diff = namedfile.NamedFileBinaryDiff(obj1, obj2, 'file')",
            "        self.assertTrue(IDifference.providedBy(diff))",
            "        self.assertFalse(diff.same)",
            "",
            "    def test_should_detect_same_data_and_filename(self):",
            "        setRoles(self.portal, TEST_USER_ID, ['Manager'])",
            "        self.portal.invokeFactory(",
            "            testing.TEST_CONTENT_TYPE_ID,",
            "            'obj1',",
            "            file=NamedFile(data='contents', filename=u'f.txt'),",
            "        )",
            "        obj1 = self.portal['obj1']",
            "",
            "        self.portal.invokeFactory(",
            "            testing.TEST_CONTENT_TYPE_ID,",
            "            'obj2',",
            "            file=NamedFile(data='contents', filename=u'f.txt'),",
            "        )",
            "        obj2 = self.portal['obj2']",
            "",
            "        diff = namedfile.NamedFileBinaryDiff(obj1, obj2, 'file')",
            "        self.assertTrue(IDifference.providedBy(diff))",
            "        self.assertTrue(diff.same)",
            "",
            "    def test_should_escape_html(self):",
            "        self.portal = self.layer['portal']",
            "        setRoles(self.portal, TEST_USER_ID, ['Manager'])",
            "        self.portal.invokeFactory(",
            "            testing.TEST_CONTENT_TYPE_ID,",
            "            'obj1',",
            "            file=NamedFile(data='contents', filename=u'blah.txt'),",
            "        )",
            "        obj1 = self.portal['obj1']",
            "",
            "        self.portal.invokeFactory(",
            "            testing.TEST_CONTENT_TYPE_ID,",
            "            'obj2',",
            "            file=NamedFile(data='<script>alert(\"Hacker data\")</script>', filename=u'<script>alert(\"Hacker filename\")</script>.txt'),",
            "        )",
            "        obj2 = self.portal['obj2']",
            "",
            "        diff = namedfile.NamedFileBinaryDiff(obj1, obj2, 'file')",
            "        self.assertTrue(IDifference.providedBy(diff))",
            "        self.assertFalse(diff.same)",
            "        # The script tag should be escaped.",
            "        self.assertNotIn(\"<script\", diff.inline_diff())",
            "        self.assertIn(\"&gt;\", diff.inline_diff())",
            "",
            "        # Test the more basic BinaryDiff.",
            "        # It only compares the file names.",
            "        # It uses the 'getFilename' method of the file,",
            "        # which namedfiles do not have.  So we hack it.",
            "        obj1.file.getFilename = lambda: obj1.file.filename",
            "        obj2.file.getFilename = lambda: obj2.file.filename",
            "        diff = BinaryDiff.BinaryDiff(obj1, obj2, 'file')",
            "        self.assertTrue(IDifference.providedBy(diff))",
            "        self.assertFalse(diff.same)",
            "        # The script tag should be escaped.",
            "        self.assertNotIn(\"<script\", diff.inline_diff())",
            "        self.assertIn(\"&gt;\", diff.inline_diff())"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1"
        ],
        "dele_reviseLocation": {},
        "addLocation": [
            "Products.CMFDiffTool.tests.test_binarydiff.BinaryDiffTestCase.self",
            "airflow.configuration"
        ]
    },
    "Products/CMFDiffTool/tests/test_filelistdiff.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 56,
                "afterPatchRowNumber": 56,
                "PatchRowcode": "             [],"
            },
            "1": {
                "beforePatchRowNumber": 57,
                "afterPatchRowNumber": 57,
                "PatchRowcode": "             False,"
            },
            "2": {
                "beforePatchRowNumber": 58,
                "afterPatchRowNumber": 58,
                "PatchRowcode": "         )"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 59,
                "PatchRowcode": "+        self._test_diff_files("
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 60,
                "PatchRowcode": "+            ["
            },
            "5": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 61,
                "PatchRowcode": "+                ('<script>alert(\"Hacker data 1\")</script>', u'filename1'),"
            },
            "6": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 62,
                "PatchRowcode": "+                ('<script>alert(\"Hacker data 2\")</script>', u'filename2'),"
            },
            "7": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 63,
                "PatchRowcode": "+            ],"
            },
            "8": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 64,
                "PatchRowcode": "+            ["
            },
            "9": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 65,
                "PatchRowcode": "+                ('data1', u'<script>alert(\"Hacker data\")</script>.txt'),"
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 66,
                "PatchRowcode": "+                ('<script>alert(\"Hacker data 2\")</script>', u'filename2'),"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 67,
                "PatchRowcode": "+            ],"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 68,
                "PatchRowcode": "+            False,"
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 69,
                "PatchRowcode": "+        )"
            },
            "14": {
                "beforePatchRowNumber": 59,
                "afterPatchRowNumber": 70,
                "PatchRowcode": "         self._test_diff_files(None, None, True)"
            },
            "15": {
                "beforePatchRowNumber": 60,
                "afterPatchRowNumber": 71,
                "PatchRowcode": "         self._test_diff_files([], [], True)"
            },
            "16": {
                "beforePatchRowNumber": 61,
                "afterPatchRowNumber": 72,
                "PatchRowcode": "         self._test_diff_files([], None, True)"
            },
            "17": {
                "beforePatchRowNumber": 65,
                "afterPatchRowNumber": 76,
                "PatchRowcode": "             DummyType(files1), DummyType(files2), 'files')"
            },
            "18": {
                "beforePatchRowNumber": 66,
                "afterPatchRowNumber": 77,
                "PatchRowcode": "         self.assertTrue(IDifference.providedBy(diff))"
            },
            "19": {
                "beforePatchRowNumber": 67,
                "afterPatchRowNumber": 78,
                "PatchRowcode": "         self.assertEqual(diff.same, same)"
            },
            "20": {
                "beforePatchRowNumber": 68,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        self.assertNotEqual(bool(diff.inline_diff()), same)"
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 79,
                "PatchRowcode": "+        inline = diff.inline_diff()"
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 80,
                "PatchRowcode": "+        self.assertNotEqual(bool(inline), same)"
            },
            "23": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 81,
                "PatchRowcode": "+        if inline:"
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 82,
                "PatchRowcode": "+            # No hacker can catch us unawares."
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 83,
                "PatchRowcode": "+            self.assertNotIn(\"<script\", inline)"
            }
        },
        "frontPatchFile": [
            "# -*- coding: utf-8 -*-",
            "from plone.namedfile import NamedFile",
            "from Products.CMFDiffTool import namedfile",
            "from Products.CMFDiffTool.interfaces import IDifference",
            "",
            "import unittest",
            "",
            "",
            "class DummyType(object):",
            "    def __init__(self, files):",
            "        \"\"\"`files` is a sequence of (data, filename) tuples.\"\"\"",
            "        self.files = files and [",
            "            NamedFile(data=d, filename=fn) for (d, fn) in files]",
            "",
            "",
            "class AsTextDiffTestCase(unittest.TestCase):",
            "",
            "    def test_should_diff_file_lists_correctly(self):",
            "        self._test_diff_files(",
            "            [('data1', u'filename1')],",
            "            [('data2', u'filename2')],",
            "            False,",
            "        )",
            "        self._test_diff_files(",
            "            [('data1', u'filename1'), ('datax', u'filenamex')],",
            "            [('data1', u'filename1'), ('datay', u'filenamey')],",
            "            False,",
            "        )",
            "        self._test_diff_files(",
            "            [('data1', u'filename1'), ('datax', u'filenamex')],",
            "            [('datax', u'filenamex'), ('data1', u'filename1')],",
            "            False,",
            "        )",
            "        self._test_diff_files(",
            "            [('data1', u'filename1')],",
            "            [('data1', u'filename1'), ('datax', u'filenamex')],",
            "            False,",
            "        )",
            "        self._test_diff_files(",
            "            [('data1', u'filename1')],",
            "            [('data1', u'filename1')],",
            "            True,",
            "        )",
            "        self._test_diff_files(",
            "            [('data1', u'filename1'), ('datax', u'filenamex')],",
            "            [('data1', u'filename1'), ('datax', u'filenamex')],",
            "            True,",
            "        )",
            "        self._test_diff_files(",
            "            [('data1', u'filename1'), ('datax', u'filenamex')],",
            "            None,",
            "            False,",
            "        )",
            "        self._test_diff_files(",
            "            [('data1', u'filename1'), ('datax', u'filenamex')],",
            "            [],",
            "            False,",
            "        )",
            "        self._test_diff_files(None, None, True)",
            "        self._test_diff_files([], [], True)",
            "        self._test_diff_files([], None, True)",
            "",
            "    def _test_diff_files(self, files1, files2, same):",
            "        diff = namedfile.NamedFileListDiff(",
            "            DummyType(files1), DummyType(files2), 'files')",
            "        self.assertTrue(IDifference.providedBy(diff))",
            "        self.assertEqual(diff.same, same)",
            "        self.assertNotEqual(bool(diff.inline_diff()), same)"
        ],
        "afterPatchFile": [
            "# -*- coding: utf-8 -*-",
            "from plone.namedfile import NamedFile",
            "from Products.CMFDiffTool import namedfile",
            "from Products.CMFDiffTool.interfaces import IDifference",
            "",
            "import unittest",
            "",
            "",
            "class DummyType(object):",
            "    def __init__(self, files):",
            "        \"\"\"`files` is a sequence of (data, filename) tuples.\"\"\"",
            "        self.files = files and [",
            "            NamedFile(data=d, filename=fn) for (d, fn) in files]",
            "",
            "",
            "class AsTextDiffTestCase(unittest.TestCase):",
            "",
            "    def test_should_diff_file_lists_correctly(self):",
            "        self._test_diff_files(",
            "            [('data1', u'filename1')],",
            "            [('data2', u'filename2')],",
            "            False,",
            "        )",
            "        self._test_diff_files(",
            "            [('data1', u'filename1'), ('datax', u'filenamex')],",
            "            [('data1', u'filename1'), ('datay', u'filenamey')],",
            "            False,",
            "        )",
            "        self._test_diff_files(",
            "            [('data1', u'filename1'), ('datax', u'filenamex')],",
            "            [('datax', u'filenamex'), ('data1', u'filename1')],",
            "            False,",
            "        )",
            "        self._test_diff_files(",
            "            [('data1', u'filename1')],",
            "            [('data1', u'filename1'), ('datax', u'filenamex')],",
            "            False,",
            "        )",
            "        self._test_diff_files(",
            "            [('data1', u'filename1')],",
            "            [('data1', u'filename1')],",
            "            True,",
            "        )",
            "        self._test_diff_files(",
            "            [('data1', u'filename1'), ('datax', u'filenamex')],",
            "            [('data1', u'filename1'), ('datax', u'filenamex')],",
            "            True,",
            "        )",
            "        self._test_diff_files(",
            "            [('data1', u'filename1'), ('datax', u'filenamex')],",
            "            None,",
            "            False,",
            "        )",
            "        self._test_diff_files(",
            "            [('data1', u'filename1'), ('datax', u'filenamex')],",
            "            [],",
            "            False,",
            "        )",
            "        self._test_diff_files(",
            "            [",
            "                ('<script>alert(\"Hacker data 1\")</script>', u'filename1'),",
            "                ('<script>alert(\"Hacker data 2\")</script>', u'filename2'),",
            "            ],",
            "            [",
            "                ('data1', u'<script>alert(\"Hacker data\")</script>.txt'),",
            "                ('<script>alert(\"Hacker data 2\")</script>', u'filename2'),",
            "            ],",
            "            False,",
            "        )",
            "        self._test_diff_files(None, None, True)",
            "        self._test_diff_files([], [], True)",
            "        self._test_diff_files([], None, True)",
            "",
            "    def _test_diff_files(self, files1, files2, same):",
            "        diff = namedfile.NamedFileListDiff(",
            "            DummyType(files1), DummyType(files2), 'files')",
            "        self.assertTrue(IDifference.providedBy(diff))",
            "        self.assertEqual(diff.same, same)",
            "        inline = diff.inline_diff()",
            "        self.assertNotEqual(bool(inline), same)",
            "        if inline:",
            "            # No hacker can catch us unawares.",
            "            self.assertNotIn(\"<script\", inline)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "-1",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2"
        ],
        "dele_reviseLocation": {
            "68": [
                "AsTextDiffTestCase",
                "_test_diff_files"
            ]
        },
        "addLocation": [
            "Products.CMFDiffTool.tests.test_filelistdiff.AsTextDiffTestCase._test_diff_files.files2",
            "Products.CMFDiffTool.tests.test_filelistdiff.AsTextDiffTestCase._test_diff_files.files1",
            "Products.CMFDiffTool.tests.test_filelistdiff.DummyType.__init__.files",
            "airflow.configuration"
        ]
    }
}