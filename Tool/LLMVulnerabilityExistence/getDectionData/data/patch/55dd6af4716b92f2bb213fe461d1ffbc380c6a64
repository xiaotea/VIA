{
    "label_studio/core/settings/base.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 403,
                "afterPatchRowNumber": 403,
                "PatchRowcode": " MAX_TIME_BETWEEN_ACTIVITY = int(get_env('MAX_TIME_BETWEEN_ACTIVITY', timedelta(days=5).total_seconds()))"
            },
            "1": {
                "beforePatchRowNumber": 404,
                "afterPatchRowNumber": 404,
                "PatchRowcode": " "
            },
            "2": {
                "beforePatchRowNumber": 405,
                "afterPatchRowNumber": 405,
                "PatchRowcode": " SSRF_PROTECTION_ENABLED = get_bool_env('SSRF_PROTECTION_ENABLED', False)"
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 406,
                "PatchRowcode": "+USE_DEFAULT_BANNED_SUBNETS = get_bool_env('USE_DEFAULT_BANNED_SUBNETS', True)"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 407,
                "PatchRowcode": "+USER_ADDITIONAL_BANNED_SUBNETS = get_env_list('USER_ADDITIONAL_BANNED_SUBNETS', default=[])"
            },
            "5": {
                "beforePatchRowNumber": 406,
                "afterPatchRowNumber": 408,
                "PatchRowcode": " "
            },
            "6": {
                "beforePatchRowNumber": 407,
                "afterPatchRowNumber": 409,
                "PatchRowcode": " # user media files"
            },
            "7": {
                "beforePatchRowNumber": 408,
                "afterPatchRowNumber": 410,
                "PatchRowcode": " MEDIA_ROOT = os.path.join(BASE_DATA_DIR, 'media')"
            }
        },
        "frontPatchFile": [
            "\"\"\"This file and its contents are licensed under the Apache License 2.0. Please see the included NOTICE for copyright information and LICENSE for a copy of the license.",
            "\"\"\"",
            "\"\"\"",
            "Django Base settings for Label Studio.",
            "",
            "For more information on this file, see",
            "https://docs.djangoproject.com/en/3.1/topics/settings/",
            "",
            "For the full list of settings and their values, see",
            "https://docs.djangoproject.com/en/3.1/ref/settings/",
            "\"\"\"",
            "import json",
            "import logging",
            "import os",
            "import re",
            "from datetime import timedelta",
            "",
            "from label_studio.core.utils.params import get_bool_env, get_env_list",
            "",
            "formatter = 'standard'",
            "JSON_LOG = get_bool_env('JSON_LOG', False)",
            "if JSON_LOG:",
            "    formatter = 'json'",
            "",
            "LOGGING = {",
            "    'version': 1,",
            "    'disable_existing_loggers': False,",
            "    'formatters': {",
            "        'json': {",
            "            '()': 'label_studio.core.utils.formatter.CustomJsonFormatter',",
            "            'format': '[%(asctime)s] [%(name)s::%(funcName)s::%(lineno)d] [%(levelname)s] [%(user_id)s] %(message)s',",
            "            'datefmt': '%d/%b/%Y:%H:%M:%S %z',",
            "        },",
            "        'standard': {",
            "            'format': '[%(asctime)s] [%(name)s::%(funcName)s::%(lineno)d] [%(levelname)s] %(message)s',",
            "        },",
            "    },",
            "    'handlers': {",
            "        'console': {",
            "            'class': 'logging.StreamHandler',",
            "            'formatter': formatter,",
            "        },",
            "    },",
            "    'root': {",
            "        'handlers': ['console'],",
            "        'level': os.environ.get('LOG_LEVEL', 'DEBUG'),",
            "    },",
            "    'loggers': {",
            "        'pykwalify': {'level': 'ERROR', 'propagate': False},",
            "        'tavern': {'level': 'ERROR', 'propagate': False},",
            "        'asyncio': {'level': 'WARNING'},",
            "        'rules': {'level': 'WARNING'},",
            "        'django': {",
            "            'handlers': ['console'],",
            "            # 'propagate': True,",
            "        },",
            "        'django_auth_ldap': {'level': os.environ.get('LOG_LEVEL', 'DEBUG')},",
            "        'rq.worker': {",
            "            'handlers': ['console'],",
            "            'level': os.environ.get('LOG_LEVEL', 'INFO'),",
            "        },",
            "        'ddtrace': {",
            "            'handlers': ['console'],",
            "            'level': 'WARNING',",
            "        },",
            "        'ldclient.util': {",
            "            'handlers': ['console'],",
            "            'level': 'ERROR',",
            "        },",
            "    },",
            "}",
            "",
            "# for printing messages before main logging config applied",
            "if not logging.getLogger().hasHandlers():",
            "    logging.basicConfig(level=logging.DEBUG, format='%(message)s')",
            "",
            "from label_studio.core.utils.io import get_data_dir",
            "from label_studio.core.utils.params import get_bool_env, get_env",
            "",
            "logger = logging.getLogger(__name__)",
            "SILENCED_SYSTEM_CHECKS = []",
            "",
            "# Hostname is used for proper path generation to the resources, pages, etc",
            "HOSTNAME = get_env('HOST', '')",
            "if HOSTNAME:",
            "    if not HOSTNAME.startswith('http://') and not HOSTNAME.startswith('https://'):",
            "        logger.info(",
            "            '! HOST variable found in environment, but it must start with http:// or https://, ignore it: %s', HOSTNAME",
            "        )",
            "        HOSTNAME = ''",
            "    else:",
            "        logger.info('=> Hostname correctly is set to: %s', HOSTNAME)",
            "        if HOSTNAME.endswith('/'):",
            "            HOSTNAME = HOSTNAME[0:-1]",
            "",
            "        # for django url resolver",
            "        if HOSTNAME:",
            "            # http[s]://domain.com:8080/script_name => /script_name",
            "            pattern = re.compile(r'^http[s]?:\\/\\/([^:\\/\\s]+(:\\d*)?)(.*)?')",
            "            match = pattern.match(HOSTNAME)",
            "            FORCE_SCRIPT_NAME = match.group(3)",
            "            if FORCE_SCRIPT_NAME:",
            "                logger.info('=> Django URL prefix is set to: %s', FORCE_SCRIPT_NAME)",
            "",
            "INTERNAL_PORT = '8080'",
            "",
            "# SECURITY WARNING: don't run with debug turned on in production!",
            "DEBUG = get_bool_env('DEBUG', True)",
            "DEBUG_MODAL_EXCEPTIONS = get_bool_env('DEBUG_MODAL_EXCEPTIONS', True)",
            "",
            "# Whether to verify SSL certs when making external requests, eg in the uploader",
            "# \u26a0\ufe0f Turning this off means assuming risk. \u26a0\ufe0f",
            "# Overridable at organization level via Organization#verify_ssl_certs",
            "VERIFY_SSL_CERTS = get_bool_env('VERIFY_SSL_CERTS', True)",
            "",
            "# 'sqlite-dll-<arch>-<version>.zip' should be hosted at this prefix",
            "WINDOWS_SQLITE_BINARY_HOST_PREFIX = get_env('WINDOWS_SQLITE_BINARY_HOST_PREFIX', 'https://www.sqlite.org/2023/')",
            "",
            "# Build paths inside the project like this: os.path.join(BASE_DIR, ...)",
            "BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))",
            "",
            "# Base path for media root and other uploaded files",
            "BASE_DATA_DIR = get_env('BASE_DATA_DIR')",
            "if BASE_DATA_DIR is None:",
            "    BASE_DATA_DIR = get_data_dir()",
            "os.makedirs(BASE_DATA_DIR, exist_ok=True)",
            "logger.info('=> Database and media directory: %s', BASE_DATA_DIR)",
            "",
            "# Databases",
            "# https://docs.djangoproject.com/en/2.1/ref/settings/#databases",
            "DJANGO_DB_MYSQL = 'mysql'",
            "DJANGO_DB_SQLITE = 'sqlite'",
            "DJANGO_DB_POSTGRESQL = 'postgresql'",
            "DJANGO_DB = 'default'",
            "DATABASE_NAME_DEFAULT = os.path.join(BASE_DATA_DIR, 'label_studio.sqlite3')",
            "DATABASE_NAME = get_env('DATABASE_NAME', DATABASE_NAME_DEFAULT)",
            "DATABASES_ALL = {",
            "    DJANGO_DB_POSTGRESQL: {",
            "        'ENGINE': 'django.db.backends.postgresql',",
            "        'USER': get_env('POSTGRE_USER', 'postgres'),",
            "        'PASSWORD': get_env('POSTGRE_PASSWORD', 'postgres'),",
            "        'NAME': get_env('POSTGRE_NAME', 'postgres'),",
            "        'HOST': get_env('POSTGRE_HOST', 'localhost'),",
            "        'PORT': int(get_env('POSTGRE_PORT', '5432')),",
            "    },",
            "    DJANGO_DB_MYSQL: {",
            "        'ENGINE': 'django.db.backends.mysql',",
            "        'USER': get_env('MYSQL_USER', 'root'),",
            "        'PASSWORD': get_env('MYSQL_PASSWORD', ''),",
            "        'NAME': get_env('MYSQL_NAME', 'labelstudio'),",
            "        'HOST': get_env('MYSQL_HOST', 'localhost'),",
            "        'PORT': int(get_env('MYSQL_PORT', '3306')),",
            "    },",
            "    DJANGO_DB_SQLITE: {",
            "        'ENGINE': 'django.db.backends.sqlite3',",
            "        'NAME': DATABASE_NAME,",
            "        'OPTIONS': {",
            "            # 'timeout': 20,",
            "        },",
            "    },",
            "}",
            "DATABASES_ALL['default'] = DATABASES_ALL[DJANGO_DB_POSTGRESQL]",
            "DATABASES = {'default': DATABASES_ALL.get(get_env('DJANGO_DB', 'default'))}",
            "",
            "DEFAULT_AUTO_FIELD = 'django.db.models.AutoField'",
            "",
            "if get_bool_env('GOOGLE_LOGGING_ENABLED', False):",
            "    logging.info('Google Cloud Logging handler is enabled.')",
            "    try:",
            "        import google.cloud.logging",
            "        from google.auth.exceptions import GoogleAuthError",
            "",
            "        client = google.cloud.logging.Client()",
            "        client.setup_logging()",
            "",
            "        LOGGING['handlers']['google_cloud_logging'] = {",
            "            'level': get_env('LOG_LEVEL', 'WARNING'),",
            "            'class': 'google.cloud.logging.handlers.CloudLoggingHandler',",
            "            'client': client,",
            "        }",
            "        LOGGING['root']['handlers'].append('google_cloud_logging')",
            "    except GoogleAuthError:",
            "        logger.exception('Google Cloud Logging handler could not be setup.')",
            "",
            "INSTALLED_APPS = [",
            "    'django.contrib.admin',",
            "    'django.contrib.auth',",
            "    'django.contrib.contenttypes',",
            "    'django.contrib.sessions',",
            "    'django.contrib.messages',",
            "    'django.contrib.staticfiles',",
            "    'django.contrib.humanize',",
            "    'drf_yasg',",
            "    'corsheaders',",
            "    'django_extensions',",
            "    'django_rq',",
            "    'django_filters',",
            "    'rules',",
            "    'annoying',",
            "    'rest_framework',",
            "    'rest_framework.authtoken',",
            "    'drf_generators',",
            "    'core',",
            "    'users',",
            "    'organizations',",
            "    'data_import',",
            "    'data_export',",
            "    'projects',",
            "    'tasks',",
            "    'data_manager',",
            "    'io_storages',",
            "    'ml',",
            "    'webhooks',",
            "    'labels_manager',",
            "]",
            "",
            "MIDDLEWARE = [",
            "    'corsheaders.middleware.CorsMiddleware',",
            "    'django.middleware.security.SecurityMiddleware',",
            "    'django.contrib.sessions.middleware.SessionMiddleware',",
            "    'django.middleware.locale.LocaleMiddleware',",
            "    'core.middleware.DisableCSRF',",
            "    'django.middleware.csrf.CsrfViewMiddleware',",
            "    'django.contrib.auth.middleware.AuthenticationMiddleware',",
            "    'django.contrib.messages.middleware.MessageMiddleware',",
            "    'core.middleware.CommonMiddlewareAppendSlashWithoutRedirect',  # instead of 'CommonMiddleware'",
            "    'core.middleware.CommonMiddleware',",
            "    'django_user_agents.middleware.UserAgentMiddleware',",
            "    'core.middleware.SetSessionUIDMiddleware',",
            "    'core.middleware.ContextLogMiddleware',",
            "    'core.middleware.DatabaseIsLockedRetryMiddleware',",
            "    'core.current_request.ThreadLocalMiddleware',",
            "]",
            "",
            "REST_FRAMEWORK = {",
            "    'DEFAULT_FILTER_BACKENDS': ['django_filters.rest_framework.DjangoFilterBackend'],",
            "    'DEFAULT_AUTHENTICATION_CLASSES': (",
            "        'rest_framework.authentication.TokenAuthentication',",
            "        'rest_framework.authentication.SessionAuthentication',",
            "    ),",
            "    'DEFAULT_PERMISSION_CLASSES': [",
            "        'core.api_permissions.HasObjectPermission',",
            "        'rest_framework.permissions.IsAuthenticated',",
            "    ],",
            "    'EXCEPTION_HANDLER': 'core.utils.common.custom_exception_handler',",
            "    'DEFAULT_RENDERER_CLASSES': ('rest_framework.renderers.JSONRenderer',),",
            "    'DEFAULT_VERSIONING_CLASS': 'rest_framework.versioning.NamespaceVersioning',",
            "    'PAGE_SIZE': 100,",
            "    # 'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination'",
            "}",
            "SILENCED_SYSTEM_CHECKS += ['rest_framework.W001']",
            "",
            "# CORS & Host settings",
            "INTERNAL_IPS = [  # django debug toolbar for django==2.2 requirement",
            "    '127.0.0.1',",
            "    'localhost',",
            "]",
            "CORS_ORIGIN_ALLOW_ALL = True",
            "CORS_ALLOW_METHODS = [",
            "    'DELETE',",
            "    'GET',",
            "    'OPTIONS',",
            "    'PATCH',",
            "    'POST',",
            "    'PUT',",
            "]",
            "ALLOWED_HOSTS = ['*']",
            "",
            "# Auth modules",
            "AUTH_USER_MODEL = 'users.User'",
            "AUTHENTICATION_BACKENDS = [",
            "    'rules.permissions.ObjectPermissionBackend',",
            "    'django.contrib.auth.backends.ModelBackend',",
            "]",
            "USE_USERNAME_FOR_LOGIN = False",
            "",
            "DISABLE_SIGNUP_WITHOUT_LINK = get_bool_env('DISABLE_SIGNUP_WITHOUT_LINK', False)",
            "",
            "# Password validation:",
            "# https://docs.djangoproject.com/en/2.1/ref/settings/#auth-password-validators",
            "AUTH_PASSWORD_VALIDATORS = [",
            "    {'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator'},",
            "    {'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator'},",
            "    {'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator'},",
            "    {'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator'},",
            "]",
            "",
            "# Django templates",
            "TEMPLATES_DIR = os.path.join(os.path.dirname(BASE_DIR), 'templates')  # ../../from_this = 'web' dir",
            "TEMPLATES = [",
            "    {",
            "        'BACKEND': 'django.template.backends.django.DjangoTemplates',",
            "        'DIRS': [TEMPLATES_DIR],",
            "        'APP_DIRS': True,",
            "        'OPTIONS': {",
            "            'context_processors': [",
            "                'django.template.context_processors.debug',",
            "                'django.template.context_processors.request',",
            "                'django.contrib.auth.context_processors.auth',",
            "                'django.contrib.messages.context_processors.messages',",
            "                'core.context_processors.settings',",
            "            ],",
            "            'builtins': ['django.templatetags.i18n'],",
            "        },",
            "    }",
            "]",
            "",
            "# RQ",
            "RQ_QUEUES = {",
            "    'critical': {",
            "        'HOST': 'localhost',",
            "        'PORT': 6379,",
            "        'DB': 0,",
            "        'DEFAULT_TIMEOUT': 180,",
            "    },",
            "    'high': {",
            "        'HOST': 'localhost',",
            "        'PORT': 6379,",
            "        'DB': 0,",
            "        'DEFAULT_TIMEOUT': 180,",
            "    },",
            "    'default': {",
            "        'HOST': 'localhost',",
            "        'PORT': 6379,",
            "        'DB': 0,",
            "        'DEFAULT_TIMEOUT': 180,",
            "    },",
            "    'low': {",
            "        'HOST': 'localhost',",
            "        'PORT': 6379,",
            "        'DB': 0,",
            "        'DEFAULT_TIMEOUT': 180,",
            "    },",
            "}",
            "",
            "# Swagger: automatic API documentation",
            "SWAGGER_SETTINGS = {",
            "    'SECURITY_DEFINITIONS': {",
            "        'Token': {",
            "            'type': 'apiKey',",
            "            'name': 'Authorization',",
            "            'in': 'header',",
            "            'description': 'The token (or API key) must be passed as a request header. '",
            "            'You can find your user token on the User Account page in Label Studio. Example: '",
            "            '<br><pre><code class=\"language-bash\">'",
            "            'curl https://label-studio-host/api/projects -H \"Authorization: Token [your-token]\"'",
            "            '</code></pre>',",
            "        }",
            "    },",
            "    'APIS_SORTER': 'alpha',",
            "    'SUPPORTED_SUBMIT_METHODS': ['get', 'post', 'put', 'delete', 'patch'],",
            "    'OPERATIONS_SORTER': 'alpha',",
            "}",
            "",
            "SENTRY_DSN = get_env('SENTRY_DSN', None)",
            "SENTRY_RATE = float(get_env('SENTRY_RATE', 0.25))",
            "SENTRY_ENVIRONMENT = get_env('SENTRY_ENVIRONMENT', 'stage.opensource')",
            "SENTRY_REDIS_ENABLED = False",
            "FRONTEND_SENTRY_DSN = get_env('FRONTEND_SENTRY_DSN', None)",
            "FRONTEND_SENTRY_RATE = get_env('FRONTEND_SENTRY_RATE', 0.1)",
            "FRONTEND_SENTRY_ENVIRONMENT = get_env('FRONTEND_SENTRY_ENVIRONMENT', 'stage.opensource')",
            "",
            "ROOT_URLCONF = 'core.urls'",
            "WSGI_APPLICATION = 'core.wsgi.application'",
            "GRAPHIQL = True",
            "",
            "# Internationalization",
            "# https://docs.djangoproject.com/en/2.1/topics/i18n/",
            "LANGUAGE_CODE = 'en-us'",
            "TIME_ZONE = 'UTC'",
            "USE_I18N = False",
            "USE_L10N = True",
            "USE_TZ = True",
            "",
            "# Static files (CSS, JavaScript, Images)",
            "# https://docs.djangoproject.com/en/2.1/howto/static-files/",
            "STATIC_URL = '/static/'",
            "# if FORCE_SCRIPT_NAME:",
            "#    STATIC_URL = FORCE_SCRIPT_NAME + STATIC_URL",
            "logger.info(f'=> Static URL is set to: {STATIC_URL}')",
            "",
            "STATIC_ROOT = os.path.join(BASE_DIR, 'static_build')",
            "STATICFILES_DIRS = [os.path.join(BASE_DIR, 'static')]",
            "STATICFILES_FINDERS = (",
            "    'django.contrib.staticfiles.finders.FileSystemFinder',",
            "    'django.contrib.staticfiles.finders.AppDirectoriesFinder',",
            ")",
            "STATICFILES_STORAGE = 'core.storage.SkipMissedManifestStaticFilesStorage'",
            "",
            "# Sessions and CSRF",
            "SESSION_COOKIE_SECURE = bool(int(get_env('SESSION_COOKIE_SECURE', False)))",
            "SESSION_COOKIE_SAMESITE = get_env('SESSION_COOKIE_SAMESITE', 'Lax')",
            "",
            "CSRF_COOKIE_SECURE = bool(int(get_env('CSRF_COOKIE_SECURE', SESSION_COOKIE_SECURE)))",
            "CSRF_COOKIE_HTTPONLY = bool(int(get_env('CSRF_COOKIE_HTTPONLY', SESSION_COOKIE_SECURE)))",
            "CSRF_COOKIE_SAMESITE = get_env('CSRF_COOKIE_SAMESITE', 'Lax')",
            "",
            "# Inactivity user sessions",
            "INACTIVITY_SESSION_TIMEOUT_ENABLED = bool(int(get_env('INACTIVITY_SESSION_TIMEOUT_ENABLED', True)))",
            "# The most time a login will last, regardless of activity",
            "MAX_SESSION_AGE = int(get_env('MAX_SESSION_AGE', timedelta(days=14).total_seconds()))",
            "# The most time that can elapse between activity with the server before the user is logged out",
            "MAX_TIME_BETWEEN_ACTIVITY = int(get_env('MAX_TIME_BETWEEN_ACTIVITY', timedelta(days=5).total_seconds()))",
            "",
            "SSRF_PROTECTION_ENABLED = get_bool_env('SSRF_PROTECTION_ENABLED', False)",
            "",
            "# user media files",
            "MEDIA_ROOT = os.path.join(BASE_DATA_DIR, 'media')",
            "os.makedirs(MEDIA_ROOT, exist_ok=True)",
            "MEDIA_URL = '/data/'",
            "UPLOAD_DIR = 'upload'",
            "AVATAR_PATH = 'avatars'",
            "",
            "SUPPORTED_EXTENSIONS = set(",
            "    [",
            "        '.bmp',",
            "        '.csv',",
            "        '.flac',",
            "        '.gif',",
            "        '.htm',",
            "        '.html',",
            "        '.jpg',",
            "        '.jpeg',",
            "        '.json',",
            "        '.m4a',",
            "        '.mp3',",
            "        '.ogg',",
            "        '.png',",
            "        '.svg',",
            "        '.tsv',",
            "        '.txt',",
            "        '.wav',",
            "        '.xml',",
            "        '.mp4',",
            "        '.webm',",
            "        '.webp',",
            "    ]",
            ")",
            "",
            "# directory for files created during unit tests",
            "TEST_DATA_ROOT = os.path.join(BASE_DATA_DIR, 'test_data')",
            "os.makedirs(TEST_DATA_ROOT, exist_ok=True)",
            "",
            "# project exports",
            "EXPORT_DIR = os.path.join(BASE_DATA_DIR, 'export')",
            "EXPORT_URL_ROOT = '/export/'",
            "EXPORT_MIXIN = 'data_export.mixins.ExportMixin'",
            "# old export dir",
            "os.makedirs(EXPORT_DIR, exist_ok=True)",
            "# dir for delayed export",
            "DELAYED_EXPORT_DIR = 'export'",
            "os.makedirs(os.path.join(BASE_DATA_DIR, MEDIA_ROOT, DELAYED_EXPORT_DIR), exist_ok=True)",
            "",
            "# file / task size limits",
            "DATA_UPLOAD_MAX_MEMORY_SIZE = int(get_env('DATA_UPLOAD_MAX_MEMORY_SIZE', 250 * 1024 * 1024))",
            "DATA_UPLOAD_MAX_NUMBER_FILES = int(get_env('DATA_UPLOAD_MAX_NUMBER_FILES', 100))",
            "TASKS_MAX_NUMBER = 1000000",
            "TASKS_MAX_FILE_SIZE = DATA_UPLOAD_MAX_MEMORY_SIZE",
            "",
            "TASK_LOCK_TTL = int(get_env('TASK_LOCK_TTL', default=86400))",
            "",
            "LABEL_STREAM_HISTORY_LIMIT = int(get_env('LABEL_STREAM_HISTORY_LIMIT', default=100))",
            "",
            "RANDOM_NEXT_TASK_SAMPLE_SIZE = int(get_env('RANDOM_NEXT_TASK_SAMPLE_SIZE', 50))",
            "",
            "TASK_API_PAGE_SIZE_MAX = int(get_env('TASK_API_PAGE_SIZE_MAX', 0)) or None",
            "",
            "# Email backend",
            "FROM_EMAIL = get_env('FROM_EMAIL', 'Label Studio <hello@labelstud.io>')",
            "EMAIL_BACKEND = get_env('EMAIL_BACKEND', 'django.core.mail.backends.dummy.EmailBackend')",
            "",
            "ENABLE_LOCAL_FILES_STORAGE = get_bool_env('ENABLE_LOCAL_FILES_STORAGE', default=True)",
            "LOCAL_FILES_SERVING_ENABLED = get_bool_env('LOCAL_FILES_SERVING_ENABLED', default=False)",
            "LOCAL_FILES_DOCUMENT_ROOT = get_env('LOCAL_FILES_DOCUMENT_ROOT', default=os.path.abspath(os.sep))",
            "",
            "SYNC_ON_TARGET_STORAGE_CREATION = get_bool_env('SYNC_ON_TARGET_STORAGE_CREATION', default=True)",
            "",
            "ALLOW_IMPORT_TASKS_WITH_UNKNOWN_EMAILS = get_bool_env('ALLOW_IMPORT_TASKS_WITH_UNKNOWN_EMAILS', default=False)",
            "",
            "\"\"\" React Libraries: do not forget to change this dir in /etc/nginx/nginx.conf \"\"\"",
            "",
            "# EDITOR = label-studio-frontend repository",
            "EDITOR_ROOT = os.path.join(BASE_DIR, '../../web/dist/libs/editor')",
            "# DM = data manager (included into FRONTEND due npm building, we need only version.json file from there)",
            "DM_ROOT = os.path.join(BASE_DIR, '../../web/dist/libs/datamanager')",
            "# FRONTEND = GUI for django backend",
            "REACT_APP_ROOT = os.path.join(BASE_DIR, '../../web/dist/apps/labelstudio')",
            "",
            "# per project settings",
            "BATCH_SIZE = 1000",
            "PROJECT_TITLE_MIN_LEN = 3",
            "PROJECT_TITLE_MAX_LEN = 50",
            "LOGIN_REDIRECT_URL = '/'",
            "LOGIN_URL = '/'",
            "MIN_GROUND_TRUTH = 10",
            "DATA_UNDEFINED_NAME = '$undefined$'",
            "LICENSE = {}",
            "VERSIONS = {}",
            "VERSION_EDITION = 'Community'",
            "LATEST_VERSION_CHECK = True",
            "VERSIONS_CHECK_TIME = 0",
            "ALLOW_ORGANIZATION_WEBHOOKS = get_bool_env('ALLOW_ORGANIZATION_WEBHOOKS', False)",
            "CONVERTER_DOWNLOAD_RESOURCES = get_bool_env('CONVERTER_DOWNLOAD_RESOURCES', True)",
            "EXPERIMENTAL_FEATURES = get_bool_env('EXPERIMENTAL_FEATURES', False)",
            "USE_ENFORCE_CSRF_CHECKS = get_bool_env('USE_ENFORCE_CSRF_CHECKS', True)  # False is for tests",
            "CLOUD_FILE_STORAGE_ENABLED = False",
            "",
            "IO_STORAGES_IMPORT_LINK_NAMES = [",
            "    'io_storages_s3importstoragelink',",
            "    'io_storages_gcsimportstoragelink',",
            "    'io_storages_azureblobimportstoragelink',",
            "    'io_storages_localfilesimportstoragelink',",
            "    'io_storages_redisimportstoragelink',",
            "]",
            "",
            "CREATE_ORGANIZATION = 'organizations.functions.create_organization'",
            "SAVE_USER = 'users.functions.save_user'",
            "POST_PROCESS_REIMPORT = 'core.utils.common.empty'",
            "USER_SERIALIZER = 'users.serializers.BaseUserSerializer'",
            "USER_SERIALIZER_UPDATE = 'users.serializers.BaseUserSerializerUpdate'",
            "TASK_SERIALIZER = 'tasks.serializers.BaseTaskSerializer'",
            "EXPORT_DATA_SERIALIZER = 'data_export.serializers.BaseExportDataSerializer'",
            "DATA_MANAGER_GET_ALL_COLUMNS = 'data_manager.functions.get_all_columns'",
            "DATA_MANAGER_ANNOTATIONS_MAP = {}",
            "DATA_MANAGER_ACTIONS = {}",
            "DATA_MANAGER_CUSTOM_FILTER_EXPRESSIONS = 'data_manager.functions.custom_filter_expressions'",
            "DATA_MANAGER_PREPROCESS_FILTER = 'data_manager.functions.preprocess_filter'",
            "USER_LOGIN_FORM = 'users.forms.LoginForm'",
            "PROJECT_MIXIN = 'projects.mixins.ProjectMixin'",
            "TASK_MIXIN = 'tasks.mixins.TaskMixin'",
            "ANNOTATION_MIXIN = 'tasks.mixins.AnnotationMixin'",
            "ORGANIZATION_MIXIN = 'organizations.mixins.OrganizationMixin'",
            "USER_MIXIN = 'users.mixins.UserMixin'",
            "ORGANIZATION_MEMBER_MIXIN = 'organizations.mixins.OrganizationMemberMixin'",
            "MEMBER_PERM = 'core.api_permissions.MemberHasOwnerPermission'",
            "RECALCULATE_ALL_STATS = None",
            "GET_STORAGE_LIST = 'io_storages.functions.get_storage_list'",
            "STORAGE_ANNOTATION_SERIALIZER = 'io_storages.serializers.StorageAnnotationSerializer'",
            "TASK_SERIALIZER_BULK = 'tasks.serializers.BaseTaskSerializerBulk'",
            "PREPROCESS_FIELD_NAME = 'data_manager.functions.preprocess_field_name'",
            "INTERACTIVE_DATA_SERIALIZER = 'data_export.serializers.BaseExportDataSerializerForInteractive'",
            "DELETE_TASKS_ANNOTATIONS_POSTPROCESS = None",
            "",
            "",
            "def project_delete(project):",
            "    project.delete()",
            "",
            "",
            "def user_auth(user_model, email, password):",
            "    return None",
            "",
            "",
            "def collect_versions_dummy(**kwargs):",
            "    return {}",
            "",
            "",
            "PROJECT_DELETE = project_delete",
            "USER_AUTH = user_auth",
            "COLLECT_VERSIONS = collect_versions_dummy",
            "",
            "WEBHOOK_TIMEOUT = float(get_env('WEBHOOK_TIMEOUT', 1.0))",
            "WEBHOOK_BATCH_SIZE = int(get_env('WEBHOOK_BATCH_SIZE', 100))",
            "WEBHOOK_SERIALIZERS = {",
            "    'project': 'webhooks.serializers_for_hooks.ProjectWebhookSerializer',",
            "    'task': 'webhooks.serializers_for_hooks.TaskWebhookSerializer',",
            "    'annotation': 'webhooks.serializers_for_hooks.AnnotationWebhookSerializer',",
            "    'label': 'labels_manager.serializers.LabelSerializer',",
            "    'label_link': 'labels_manager.serializers.LabelLinkSerializer',",
            "}",
            "",
            "EDITOR_KEYMAP = json.dumps(get_env('EDITOR_KEYMAP'))",
            "",
            "# fix a problem with Windows mimetypes for JS and PNG",
            "import mimetypes",
            "",
            "mimetypes.add_type('application/javascript', '.js', True)",
            "mimetypes.add_type('image/png', '.png', True)",
            "",
            "# fields name was used in DM api before",
            "REST_FLEX_FIELDS = {'FIELDS_PARAM': 'include'}",
            "",
            "INTERPOLATE_KEY_FRAMES = get_env('INTERPOLATE_KEY_FRAMES', False)",
            "",
            "# Feature Flags",
            "FEATURE_FLAGS_API_KEY = get_env('FEATURE_FLAGS_API_KEY', default='any key')",
            "",
            "# we may set feature flags from file",
            "FEATURE_FLAGS_FROM_FILE = get_bool_env('FEATURE_FLAGS_FROM_FILE', False)",
            "FEATURE_FLAGS_FILE = get_env('FEATURE_FLAGS_FILE', 'feature_flags.json')",
            "# or if file is not set, default is using offline mode",
            "FEATURE_FLAGS_OFFLINE = get_bool_env('FEATURE_FLAGS_OFFLINE', True)",
            "# default value for feature flags (if not overridden by environment or client)",
            "FEATURE_FLAGS_DEFAULT_VALUE = False",
            "",
            "# Whether to send analytics telemetry data",
            "COLLECT_ANALYTICS = get_bool_env('collect_analytics', True)",
            "",
            "# Strip harmful content from SVG files by default",
            "SVG_SECURITY_CLEANUP = get_bool_env('SVG_SECURITY_CLEANUP', False)",
            "",
            "ML_BLOCK_LOCAL_IP = get_bool_env('ML_BLOCK_LOCAL_IP', False)",
            "",
            "RQ_LONG_JOB_TIMEOUT = int(get_env('RQ_LONG_JOB_TIMEOUT', 36000))",
            "",
            "APP_WEBSERVER = get_env('APP_WEBSERVER', 'django')",
            "",
            "BATCH_JOB_RETRY_TIMEOUT = int(get_env('BATCH_JOB_RETRY_TIMEOUT', 60))",
            "",
            "FUTURE_SAVE_TASK_TO_STORAGE = get_bool_env('FUTURE_SAVE_TASK_TO_STORAGE', default=False)",
            "FUTURE_SAVE_TASK_TO_STORAGE_JSON_EXT = get_bool_env('FUTURE_SAVE_TASK_TO_STORAGE_JSON_EXT', default=True)",
            "STORAGE_IN_PROGRESS_TIMER = float(get_env('STORAGE_IN_PROGRESS_TIMER', 5.0))",
            "STORAGE_EXPORT_CHUNK_SIZE = int(get_env('STORAGE_EXPORT_CHUNK_SIZE', 100))",
            "",
            "USE_NGINX_FOR_EXPORT_DOWNLOADS = get_bool_env('USE_NGINX_FOR_EXPORT_DOWNLOADS', False)",
            "",
            "if get_env('MINIO_STORAGE_ENDPOINT') and not get_bool_env('MINIO_SKIP', False):",
            "    CLOUD_FILE_STORAGE_ENABLED = True",
            "    DEFAULT_FILE_STORAGE = 'storages.backends.s3boto3.S3Boto3Storage'",
            "    AWS_STORAGE_BUCKET_NAME = get_env('MINIO_STORAGE_BUCKET_NAME')",
            "    AWS_ACCESS_KEY_ID = get_env('MINIO_STORAGE_ACCESS_KEY')",
            "    AWS_SECRET_ACCESS_KEY = get_env('MINIO_STORAGE_SECRET_KEY')",
            "    AWS_S3_ENDPOINT_URL = get_env('MINIO_STORAGE_ENDPOINT')",
            "    AWS_QUERYSTRING_AUTH = False",
            "    # make domain for FileUpload.file",
            "    AWS_S3_SECURE_URLS = False",
            "    AWS_S3_URL_PROTOCOL = 'http:' if HOSTNAME.startswith('http://') else 'https:'",
            "    AWS_S3_CUSTOM_DOMAIN = HOSTNAME.replace('http://', '').replace('https://', '') + '/data'",
            "",
            "if get_env('STORAGE_TYPE') == 's3':",
            "    CLOUD_FILE_STORAGE_ENABLED = True",
            "    DEFAULT_FILE_STORAGE = 'core.storage.CustomS3Boto3Storage'",
            "    if get_env('STORAGE_AWS_ACCESS_KEY_ID'):",
            "        AWS_ACCESS_KEY_ID = get_env('STORAGE_AWS_ACCESS_KEY_ID')",
            "    if get_env('STORAGE_AWS_SECRET_ACCESS_KEY'):",
            "        AWS_SECRET_ACCESS_KEY = get_env('STORAGE_AWS_SECRET_ACCESS_KEY')",
            "    AWS_STORAGE_BUCKET_NAME = get_env('STORAGE_AWS_BUCKET_NAME')",
            "    AWS_S3_REGION_NAME = get_env('STORAGE_AWS_REGION_NAME', None)",
            "    AWS_S3_ENDPOINT_URL = get_env('STORAGE_AWS_ENDPOINT_URL', None)",
            "    if get_env('STORAGE_AWS_OBJECT_PARAMETERS'):",
            "        AWS_S3_OBJECT_PARAMETERS = json.loads(get_env('STORAGE_AWS_OBJECT_PARAMETERS'))",
            "    AWS_QUERYSTRING_EXPIRE = int(get_env('STORAGE_AWS_X_AMZ_EXPIRES', '86400'))",
            "    AWS_LOCATION = get_env('STORAGE_AWS_FOLDER', default='')",
            "    AWS_S3_USE_SSL = get_bool_env('STORAGE_AWS_S3_USE_SSL', True)",
            "    AWS_S3_VERIFY = get_env('STORAGE_AWS_S3_VERIFY', None)",
            "    if AWS_S3_VERIFY == 'false' or AWS_S3_VERIFY == 'False' or AWS_S3_VERIFY == '0':",
            "        AWS_S3_VERIFY = False",
            "    AWS_S3_SIGNATURE_VERSION = get_env('STORAGE_AWS_S3_SIGNATURE_VERSION', None)",
            "",
            "if get_env('STORAGE_TYPE') == 'azure':",
            "    CLOUD_FILE_STORAGE_ENABLED = True",
            "    DEFAULT_FILE_STORAGE = 'core.storage.CustomAzureStorage'",
            "    AZURE_ACCOUNT_NAME = get_env('STORAGE_AZURE_ACCOUNT_NAME')",
            "    AZURE_ACCOUNT_KEY = get_env('STORAGE_AZURE_ACCOUNT_KEY')",
            "    AZURE_CONTAINER = get_env('STORAGE_AZURE_CONTAINER_NAME')",
            "    AZURE_URL_EXPIRATION_SECS = int(get_env('STORAGE_AZURE_URL_EXPIRATION_SECS', '86400'))",
            "    AZURE_LOCATION = get_env('STORAGE_AZURE_FOLDER', default='')",
            "",
            "if get_env('STORAGE_TYPE') == 'gcs':",
            "    CLOUD_FILE_STORAGE_ENABLED = True",
            "    # DEFAULT_FILE_STORAGE = 'storages.backends.gcloud.GoogleCloudStorage'",
            "    DEFAULT_FILE_STORAGE = 'core.storage.AlternativeGoogleCloudStorage'",
            "    GS_PROJECT_ID = get_env('STORAGE_GCS_PROJECT_ID')",
            "    GS_BUCKET_NAME = get_env('STORAGE_GCS_BUCKET_NAME')",
            "    GS_EXPIRATION = timedelta(seconds=int(get_env('STORAGE_GCS_EXPIRATION_SECS', '86400')))",
            "    GS_LOCATION = get_env('STORAGE_GCS_FOLDER', default='')",
            "    GS_CUSTOM_ENDPOINT = get_env('STORAGE_GCS_ENDPOINT')",
            "",
            "CSRF_TRUSTED_ORIGINS = get_env('CSRF_TRUSTED_ORIGINS', [])",
            "if CSRF_TRUSTED_ORIGINS:",
            "    CSRF_TRUSTED_ORIGINS = CSRF_TRUSTED_ORIGINS.split(',')",
            "",
            "REAL_HOSTNAME = os.getenv('HOSTNAME')  # we have to use getenv, because we don't use LABEL_STUDIO_ prefix",
            "GCS_CLOUD_STORAGE_FORCE_DEFAULT_CREDENTIALS = get_bool_env('GCS_CLOUD_STORAGE_FORCE_DEFAULT_CREDENTIALS', False)",
            "PUBLIC_API_DOCS = get_bool_env('PUBLIC_API_DOCS', False)",
            "",
            "# By default, we disallow filters with foreign keys in data manager for security reasons.",
            "# Add to this list (either here in code, or via the env) to allow specific filters that rely on foreign keys.",
            "DATA_MANAGER_FILTER_ALLOWLIST = list(",
            "    set(get_env_list('DATA_MANAGER_FILTER_ALLOWLIST') + ['updated_by__active_organization'])",
            ")",
            "",
            "if ENABLE_CSP := get_bool_env('ENABLE_CSP', True):",
            "    CSP_DEFAULT_SRC = (",
            "        \"'self'\",",
            "        \"'report-sample'\",",
            "    )",
            "    CSP_STYLE_SRC = (\"'self'\", \"'report-sample'\", \"'unsafe-inline'\")",
            "    CSP_SCRIPT_SRC = (",
            "        \"'self'\",",
            "        \"'report-sample'\",",
            "        \"'unsafe-inline'\",",
            "        \"'unsafe-eval'\",",
            "        'blob:',",
            "        'browser.sentry-cdn.com',",
            "        'https://*.googletagmanager.com',",
            "    )",
            "    CSP_IMG_SRC = (",
            "        \"'self'\",",
            "        \"'report-sample'\",",
            "        'data:',",
            "        'https://*.google-analytics.com',",
            "        'https://*.googletagmanager.com',",
            "        'https://*.google.com',",
            "    )",
            "    CSP_CONNECT_SRC = (",
            "        \"'self'\",",
            "        \"'report-sample'\",",
            "        'https://*.google-analytics.com',",
            "        'https://*.analytics.google.com',",
            "        'https://analytics.google.com',",
            "        'https://*.googletagmanager.com',",
            "        'https://*.g.double' + 'click.net',  # hacky way of suppressing codespell complaint",
            "        'https://*.ingest.sentry.io',",
            "    )",
            "    # Note that this will be overridden to real CSP for views that use the override_report_only_csp decorator",
            "    CSP_REPORT_ONLY = get_bool_env('LS_CSP_REPORT_ONLY', True)",
            "    CSP_REPORT_URI = get_env('LS_CSP_REPORT_URI', None)",
            "    CSP_INCLUDE_NONCE_IN = ['script-src', 'default-src']",
            "",
            "    MIDDLEWARE.append('core.middleware.HumanSignalCspMiddleware')",
            "",
            "CLOUD_STORAGE_CHECK_FOR_RECORDS_PAGE_SIZE = get_env('CLOUD_STORAGE_CHECK_FOR_RECORDS_PAGE_SIZE', 10000)",
            "CLOUD_STORAGE_CHECK_FOR_RECORDS_TIMEOUT = get_env('CLOUD_STORAGE_CHECK_FOR_RECORDS_TIMEOUT', 60)"
        ],
        "afterPatchFile": [
            "\"\"\"This file and its contents are licensed under the Apache License 2.0. Please see the included NOTICE for copyright information and LICENSE for a copy of the license.",
            "\"\"\"",
            "\"\"\"",
            "Django Base settings for Label Studio.",
            "",
            "For more information on this file, see",
            "https://docs.djangoproject.com/en/3.1/topics/settings/",
            "",
            "For the full list of settings and their values, see",
            "https://docs.djangoproject.com/en/3.1/ref/settings/",
            "\"\"\"",
            "import json",
            "import logging",
            "import os",
            "import re",
            "from datetime import timedelta",
            "",
            "from label_studio.core.utils.params import get_bool_env, get_env_list",
            "",
            "formatter = 'standard'",
            "JSON_LOG = get_bool_env('JSON_LOG', False)",
            "if JSON_LOG:",
            "    formatter = 'json'",
            "",
            "LOGGING = {",
            "    'version': 1,",
            "    'disable_existing_loggers': False,",
            "    'formatters': {",
            "        'json': {",
            "            '()': 'label_studio.core.utils.formatter.CustomJsonFormatter',",
            "            'format': '[%(asctime)s] [%(name)s::%(funcName)s::%(lineno)d] [%(levelname)s] [%(user_id)s] %(message)s',",
            "            'datefmt': '%d/%b/%Y:%H:%M:%S %z',",
            "        },",
            "        'standard': {",
            "            'format': '[%(asctime)s] [%(name)s::%(funcName)s::%(lineno)d] [%(levelname)s] %(message)s',",
            "        },",
            "    },",
            "    'handlers': {",
            "        'console': {",
            "            'class': 'logging.StreamHandler',",
            "            'formatter': formatter,",
            "        },",
            "    },",
            "    'root': {",
            "        'handlers': ['console'],",
            "        'level': os.environ.get('LOG_LEVEL', 'DEBUG'),",
            "    },",
            "    'loggers': {",
            "        'pykwalify': {'level': 'ERROR', 'propagate': False},",
            "        'tavern': {'level': 'ERROR', 'propagate': False},",
            "        'asyncio': {'level': 'WARNING'},",
            "        'rules': {'level': 'WARNING'},",
            "        'django': {",
            "            'handlers': ['console'],",
            "            # 'propagate': True,",
            "        },",
            "        'django_auth_ldap': {'level': os.environ.get('LOG_LEVEL', 'DEBUG')},",
            "        'rq.worker': {",
            "            'handlers': ['console'],",
            "            'level': os.environ.get('LOG_LEVEL', 'INFO'),",
            "        },",
            "        'ddtrace': {",
            "            'handlers': ['console'],",
            "            'level': 'WARNING',",
            "        },",
            "        'ldclient.util': {",
            "            'handlers': ['console'],",
            "            'level': 'ERROR',",
            "        },",
            "    },",
            "}",
            "",
            "# for printing messages before main logging config applied",
            "if not logging.getLogger().hasHandlers():",
            "    logging.basicConfig(level=logging.DEBUG, format='%(message)s')",
            "",
            "from label_studio.core.utils.io import get_data_dir",
            "from label_studio.core.utils.params import get_bool_env, get_env",
            "",
            "logger = logging.getLogger(__name__)",
            "SILENCED_SYSTEM_CHECKS = []",
            "",
            "# Hostname is used for proper path generation to the resources, pages, etc",
            "HOSTNAME = get_env('HOST', '')",
            "if HOSTNAME:",
            "    if not HOSTNAME.startswith('http://') and not HOSTNAME.startswith('https://'):",
            "        logger.info(",
            "            '! HOST variable found in environment, but it must start with http:// or https://, ignore it: %s', HOSTNAME",
            "        )",
            "        HOSTNAME = ''",
            "    else:",
            "        logger.info('=> Hostname correctly is set to: %s', HOSTNAME)",
            "        if HOSTNAME.endswith('/'):",
            "            HOSTNAME = HOSTNAME[0:-1]",
            "",
            "        # for django url resolver",
            "        if HOSTNAME:",
            "            # http[s]://domain.com:8080/script_name => /script_name",
            "            pattern = re.compile(r'^http[s]?:\\/\\/([^:\\/\\s]+(:\\d*)?)(.*)?')",
            "            match = pattern.match(HOSTNAME)",
            "            FORCE_SCRIPT_NAME = match.group(3)",
            "            if FORCE_SCRIPT_NAME:",
            "                logger.info('=> Django URL prefix is set to: %s', FORCE_SCRIPT_NAME)",
            "",
            "INTERNAL_PORT = '8080'",
            "",
            "# SECURITY WARNING: don't run with debug turned on in production!",
            "DEBUG = get_bool_env('DEBUG', True)",
            "DEBUG_MODAL_EXCEPTIONS = get_bool_env('DEBUG_MODAL_EXCEPTIONS', True)",
            "",
            "# Whether to verify SSL certs when making external requests, eg in the uploader",
            "# \u26a0\ufe0f Turning this off means assuming risk. \u26a0\ufe0f",
            "# Overridable at organization level via Organization#verify_ssl_certs",
            "VERIFY_SSL_CERTS = get_bool_env('VERIFY_SSL_CERTS', True)",
            "",
            "# 'sqlite-dll-<arch>-<version>.zip' should be hosted at this prefix",
            "WINDOWS_SQLITE_BINARY_HOST_PREFIX = get_env('WINDOWS_SQLITE_BINARY_HOST_PREFIX', 'https://www.sqlite.org/2023/')",
            "",
            "# Build paths inside the project like this: os.path.join(BASE_DIR, ...)",
            "BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))",
            "",
            "# Base path for media root and other uploaded files",
            "BASE_DATA_DIR = get_env('BASE_DATA_DIR')",
            "if BASE_DATA_DIR is None:",
            "    BASE_DATA_DIR = get_data_dir()",
            "os.makedirs(BASE_DATA_DIR, exist_ok=True)",
            "logger.info('=> Database and media directory: %s', BASE_DATA_DIR)",
            "",
            "# Databases",
            "# https://docs.djangoproject.com/en/2.1/ref/settings/#databases",
            "DJANGO_DB_MYSQL = 'mysql'",
            "DJANGO_DB_SQLITE = 'sqlite'",
            "DJANGO_DB_POSTGRESQL = 'postgresql'",
            "DJANGO_DB = 'default'",
            "DATABASE_NAME_DEFAULT = os.path.join(BASE_DATA_DIR, 'label_studio.sqlite3')",
            "DATABASE_NAME = get_env('DATABASE_NAME', DATABASE_NAME_DEFAULT)",
            "DATABASES_ALL = {",
            "    DJANGO_DB_POSTGRESQL: {",
            "        'ENGINE': 'django.db.backends.postgresql',",
            "        'USER': get_env('POSTGRE_USER', 'postgres'),",
            "        'PASSWORD': get_env('POSTGRE_PASSWORD', 'postgres'),",
            "        'NAME': get_env('POSTGRE_NAME', 'postgres'),",
            "        'HOST': get_env('POSTGRE_HOST', 'localhost'),",
            "        'PORT': int(get_env('POSTGRE_PORT', '5432')),",
            "    },",
            "    DJANGO_DB_MYSQL: {",
            "        'ENGINE': 'django.db.backends.mysql',",
            "        'USER': get_env('MYSQL_USER', 'root'),",
            "        'PASSWORD': get_env('MYSQL_PASSWORD', ''),",
            "        'NAME': get_env('MYSQL_NAME', 'labelstudio'),",
            "        'HOST': get_env('MYSQL_HOST', 'localhost'),",
            "        'PORT': int(get_env('MYSQL_PORT', '3306')),",
            "    },",
            "    DJANGO_DB_SQLITE: {",
            "        'ENGINE': 'django.db.backends.sqlite3',",
            "        'NAME': DATABASE_NAME,",
            "        'OPTIONS': {",
            "            # 'timeout': 20,",
            "        },",
            "    },",
            "}",
            "DATABASES_ALL['default'] = DATABASES_ALL[DJANGO_DB_POSTGRESQL]",
            "DATABASES = {'default': DATABASES_ALL.get(get_env('DJANGO_DB', 'default'))}",
            "",
            "DEFAULT_AUTO_FIELD = 'django.db.models.AutoField'",
            "",
            "if get_bool_env('GOOGLE_LOGGING_ENABLED', False):",
            "    logging.info('Google Cloud Logging handler is enabled.')",
            "    try:",
            "        import google.cloud.logging",
            "        from google.auth.exceptions import GoogleAuthError",
            "",
            "        client = google.cloud.logging.Client()",
            "        client.setup_logging()",
            "",
            "        LOGGING['handlers']['google_cloud_logging'] = {",
            "            'level': get_env('LOG_LEVEL', 'WARNING'),",
            "            'class': 'google.cloud.logging.handlers.CloudLoggingHandler',",
            "            'client': client,",
            "        }",
            "        LOGGING['root']['handlers'].append('google_cloud_logging')",
            "    except GoogleAuthError:",
            "        logger.exception('Google Cloud Logging handler could not be setup.')",
            "",
            "INSTALLED_APPS = [",
            "    'django.contrib.admin',",
            "    'django.contrib.auth',",
            "    'django.contrib.contenttypes',",
            "    'django.contrib.sessions',",
            "    'django.contrib.messages',",
            "    'django.contrib.staticfiles',",
            "    'django.contrib.humanize',",
            "    'drf_yasg',",
            "    'corsheaders',",
            "    'django_extensions',",
            "    'django_rq',",
            "    'django_filters',",
            "    'rules',",
            "    'annoying',",
            "    'rest_framework',",
            "    'rest_framework.authtoken',",
            "    'drf_generators',",
            "    'core',",
            "    'users',",
            "    'organizations',",
            "    'data_import',",
            "    'data_export',",
            "    'projects',",
            "    'tasks',",
            "    'data_manager',",
            "    'io_storages',",
            "    'ml',",
            "    'webhooks',",
            "    'labels_manager',",
            "]",
            "",
            "MIDDLEWARE = [",
            "    'corsheaders.middleware.CorsMiddleware',",
            "    'django.middleware.security.SecurityMiddleware',",
            "    'django.contrib.sessions.middleware.SessionMiddleware',",
            "    'django.middleware.locale.LocaleMiddleware',",
            "    'core.middleware.DisableCSRF',",
            "    'django.middleware.csrf.CsrfViewMiddleware',",
            "    'django.contrib.auth.middleware.AuthenticationMiddleware',",
            "    'django.contrib.messages.middleware.MessageMiddleware',",
            "    'core.middleware.CommonMiddlewareAppendSlashWithoutRedirect',  # instead of 'CommonMiddleware'",
            "    'core.middleware.CommonMiddleware',",
            "    'django_user_agents.middleware.UserAgentMiddleware',",
            "    'core.middleware.SetSessionUIDMiddleware',",
            "    'core.middleware.ContextLogMiddleware',",
            "    'core.middleware.DatabaseIsLockedRetryMiddleware',",
            "    'core.current_request.ThreadLocalMiddleware',",
            "]",
            "",
            "REST_FRAMEWORK = {",
            "    'DEFAULT_FILTER_BACKENDS': ['django_filters.rest_framework.DjangoFilterBackend'],",
            "    'DEFAULT_AUTHENTICATION_CLASSES': (",
            "        'rest_framework.authentication.TokenAuthentication',",
            "        'rest_framework.authentication.SessionAuthentication',",
            "    ),",
            "    'DEFAULT_PERMISSION_CLASSES': [",
            "        'core.api_permissions.HasObjectPermission',",
            "        'rest_framework.permissions.IsAuthenticated',",
            "    ],",
            "    'EXCEPTION_HANDLER': 'core.utils.common.custom_exception_handler',",
            "    'DEFAULT_RENDERER_CLASSES': ('rest_framework.renderers.JSONRenderer',),",
            "    'DEFAULT_VERSIONING_CLASS': 'rest_framework.versioning.NamespaceVersioning',",
            "    'PAGE_SIZE': 100,",
            "    # 'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination'",
            "}",
            "SILENCED_SYSTEM_CHECKS += ['rest_framework.W001']",
            "",
            "# CORS & Host settings",
            "INTERNAL_IPS = [  # django debug toolbar for django==2.2 requirement",
            "    '127.0.0.1',",
            "    'localhost',",
            "]",
            "CORS_ORIGIN_ALLOW_ALL = True",
            "CORS_ALLOW_METHODS = [",
            "    'DELETE',",
            "    'GET',",
            "    'OPTIONS',",
            "    'PATCH',",
            "    'POST',",
            "    'PUT',",
            "]",
            "ALLOWED_HOSTS = ['*']",
            "",
            "# Auth modules",
            "AUTH_USER_MODEL = 'users.User'",
            "AUTHENTICATION_BACKENDS = [",
            "    'rules.permissions.ObjectPermissionBackend',",
            "    'django.contrib.auth.backends.ModelBackend',",
            "]",
            "USE_USERNAME_FOR_LOGIN = False",
            "",
            "DISABLE_SIGNUP_WITHOUT_LINK = get_bool_env('DISABLE_SIGNUP_WITHOUT_LINK', False)",
            "",
            "# Password validation:",
            "# https://docs.djangoproject.com/en/2.1/ref/settings/#auth-password-validators",
            "AUTH_PASSWORD_VALIDATORS = [",
            "    {'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator'},",
            "    {'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator'},",
            "    {'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator'},",
            "    {'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator'},",
            "]",
            "",
            "# Django templates",
            "TEMPLATES_DIR = os.path.join(os.path.dirname(BASE_DIR), 'templates')  # ../../from_this = 'web' dir",
            "TEMPLATES = [",
            "    {",
            "        'BACKEND': 'django.template.backends.django.DjangoTemplates',",
            "        'DIRS': [TEMPLATES_DIR],",
            "        'APP_DIRS': True,",
            "        'OPTIONS': {",
            "            'context_processors': [",
            "                'django.template.context_processors.debug',",
            "                'django.template.context_processors.request',",
            "                'django.contrib.auth.context_processors.auth',",
            "                'django.contrib.messages.context_processors.messages',",
            "                'core.context_processors.settings',",
            "            ],",
            "            'builtins': ['django.templatetags.i18n'],",
            "        },",
            "    }",
            "]",
            "",
            "# RQ",
            "RQ_QUEUES = {",
            "    'critical': {",
            "        'HOST': 'localhost',",
            "        'PORT': 6379,",
            "        'DB': 0,",
            "        'DEFAULT_TIMEOUT': 180,",
            "    },",
            "    'high': {",
            "        'HOST': 'localhost',",
            "        'PORT': 6379,",
            "        'DB': 0,",
            "        'DEFAULT_TIMEOUT': 180,",
            "    },",
            "    'default': {",
            "        'HOST': 'localhost',",
            "        'PORT': 6379,",
            "        'DB': 0,",
            "        'DEFAULT_TIMEOUT': 180,",
            "    },",
            "    'low': {",
            "        'HOST': 'localhost',",
            "        'PORT': 6379,",
            "        'DB': 0,",
            "        'DEFAULT_TIMEOUT': 180,",
            "    },",
            "}",
            "",
            "# Swagger: automatic API documentation",
            "SWAGGER_SETTINGS = {",
            "    'SECURITY_DEFINITIONS': {",
            "        'Token': {",
            "            'type': 'apiKey',",
            "            'name': 'Authorization',",
            "            'in': 'header',",
            "            'description': 'The token (or API key) must be passed as a request header. '",
            "            'You can find your user token on the User Account page in Label Studio. Example: '",
            "            '<br><pre><code class=\"language-bash\">'",
            "            'curl https://label-studio-host/api/projects -H \"Authorization: Token [your-token]\"'",
            "            '</code></pre>',",
            "        }",
            "    },",
            "    'APIS_SORTER': 'alpha',",
            "    'SUPPORTED_SUBMIT_METHODS': ['get', 'post', 'put', 'delete', 'patch'],",
            "    'OPERATIONS_SORTER': 'alpha',",
            "}",
            "",
            "SENTRY_DSN = get_env('SENTRY_DSN', None)",
            "SENTRY_RATE = float(get_env('SENTRY_RATE', 0.25))",
            "SENTRY_ENVIRONMENT = get_env('SENTRY_ENVIRONMENT', 'stage.opensource')",
            "SENTRY_REDIS_ENABLED = False",
            "FRONTEND_SENTRY_DSN = get_env('FRONTEND_SENTRY_DSN', None)",
            "FRONTEND_SENTRY_RATE = get_env('FRONTEND_SENTRY_RATE', 0.1)",
            "FRONTEND_SENTRY_ENVIRONMENT = get_env('FRONTEND_SENTRY_ENVIRONMENT', 'stage.opensource')",
            "",
            "ROOT_URLCONF = 'core.urls'",
            "WSGI_APPLICATION = 'core.wsgi.application'",
            "GRAPHIQL = True",
            "",
            "# Internationalization",
            "# https://docs.djangoproject.com/en/2.1/topics/i18n/",
            "LANGUAGE_CODE = 'en-us'",
            "TIME_ZONE = 'UTC'",
            "USE_I18N = False",
            "USE_L10N = True",
            "USE_TZ = True",
            "",
            "# Static files (CSS, JavaScript, Images)",
            "# https://docs.djangoproject.com/en/2.1/howto/static-files/",
            "STATIC_URL = '/static/'",
            "# if FORCE_SCRIPT_NAME:",
            "#    STATIC_URL = FORCE_SCRIPT_NAME + STATIC_URL",
            "logger.info(f'=> Static URL is set to: {STATIC_URL}')",
            "",
            "STATIC_ROOT = os.path.join(BASE_DIR, 'static_build')",
            "STATICFILES_DIRS = [os.path.join(BASE_DIR, 'static')]",
            "STATICFILES_FINDERS = (",
            "    'django.contrib.staticfiles.finders.FileSystemFinder',",
            "    'django.contrib.staticfiles.finders.AppDirectoriesFinder',",
            ")",
            "STATICFILES_STORAGE = 'core.storage.SkipMissedManifestStaticFilesStorage'",
            "",
            "# Sessions and CSRF",
            "SESSION_COOKIE_SECURE = bool(int(get_env('SESSION_COOKIE_SECURE', False)))",
            "SESSION_COOKIE_SAMESITE = get_env('SESSION_COOKIE_SAMESITE', 'Lax')",
            "",
            "CSRF_COOKIE_SECURE = bool(int(get_env('CSRF_COOKIE_SECURE', SESSION_COOKIE_SECURE)))",
            "CSRF_COOKIE_HTTPONLY = bool(int(get_env('CSRF_COOKIE_HTTPONLY', SESSION_COOKIE_SECURE)))",
            "CSRF_COOKIE_SAMESITE = get_env('CSRF_COOKIE_SAMESITE', 'Lax')",
            "",
            "# Inactivity user sessions",
            "INACTIVITY_SESSION_TIMEOUT_ENABLED = bool(int(get_env('INACTIVITY_SESSION_TIMEOUT_ENABLED', True)))",
            "# The most time a login will last, regardless of activity",
            "MAX_SESSION_AGE = int(get_env('MAX_SESSION_AGE', timedelta(days=14).total_seconds()))",
            "# The most time that can elapse between activity with the server before the user is logged out",
            "MAX_TIME_BETWEEN_ACTIVITY = int(get_env('MAX_TIME_BETWEEN_ACTIVITY', timedelta(days=5).total_seconds()))",
            "",
            "SSRF_PROTECTION_ENABLED = get_bool_env('SSRF_PROTECTION_ENABLED', False)",
            "USE_DEFAULT_BANNED_SUBNETS = get_bool_env('USE_DEFAULT_BANNED_SUBNETS', True)",
            "USER_ADDITIONAL_BANNED_SUBNETS = get_env_list('USER_ADDITIONAL_BANNED_SUBNETS', default=[])",
            "",
            "# user media files",
            "MEDIA_ROOT = os.path.join(BASE_DATA_DIR, 'media')",
            "os.makedirs(MEDIA_ROOT, exist_ok=True)",
            "MEDIA_URL = '/data/'",
            "UPLOAD_DIR = 'upload'",
            "AVATAR_PATH = 'avatars'",
            "",
            "SUPPORTED_EXTENSIONS = set(",
            "    [",
            "        '.bmp',",
            "        '.csv',",
            "        '.flac',",
            "        '.gif',",
            "        '.htm',",
            "        '.html',",
            "        '.jpg',",
            "        '.jpeg',",
            "        '.json',",
            "        '.m4a',",
            "        '.mp3',",
            "        '.ogg',",
            "        '.png',",
            "        '.svg',",
            "        '.tsv',",
            "        '.txt',",
            "        '.wav',",
            "        '.xml',",
            "        '.mp4',",
            "        '.webm',",
            "        '.webp',",
            "    ]",
            ")",
            "",
            "# directory for files created during unit tests",
            "TEST_DATA_ROOT = os.path.join(BASE_DATA_DIR, 'test_data')",
            "os.makedirs(TEST_DATA_ROOT, exist_ok=True)",
            "",
            "# project exports",
            "EXPORT_DIR = os.path.join(BASE_DATA_DIR, 'export')",
            "EXPORT_URL_ROOT = '/export/'",
            "EXPORT_MIXIN = 'data_export.mixins.ExportMixin'",
            "# old export dir",
            "os.makedirs(EXPORT_DIR, exist_ok=True)",
            "# dir for delayed export",
            "DELAYED_EXPORT_DIR = 'export'",
            "os.makedirs(os.path.join(BASE_DATA_DIR, MEDIA_ROOT, DELAYED_EXPORT_DIR), exist_ok=True)",
            "",
            "# file / task size limits",
            "DATA_UPLOAD_MAX_MEMORY_SIZE = int(get_env('DATA_UPLOAD_MAX_MEMORY_SIZE', 250 * 1024 * 1024))",
            "DATA_UPLOAD_MAX_NUMBER_FILES = int(get_env('DATA_UPLOAD_MAX_NUMBER_FILES', 100))",
            "TASKS_MAX_NUMBER = 1000000",
            "TASKS_MAX_FILE_SIZE = DATA_UPLOAD_MAX_MEMORY_SIZE",
            "",
            "TASK_LOCK_TTL = int(get_env('TASK_LOCK_TTL', default=86400))",
            "",
            "LABEL_STREAM_HISTORY_LIMIT = int(get_env('LABEL_STREAM_HISTORY_LIMIT', default=100))",
            "",
            "RANDOM_NEXT_TASK_SAMPLE_SIZE = int(get_env('RANDOM_NEXT_TASK_SAMPLE_SIZE', 50))",
            "",
            "TASK_API_PAGE_SIZE_MAX = int(get_env('TASK_API_PAGE_SIZE_MAX', 0)) or None",
            "",
            "# Email backend",
            "FROM_EMAIL = get_env('FROM_EMAIL', 'Label Studio <hello@labelstud.io>')",
            "EMAIL_BACKEND = get_env('EMAIL_BACKEND', 'django.core.mail.backends.dummy.EmailBackend')",
            "",
            "ENABLE_LOCAL_FILES_STORAGE = get_bool_env('ENABLE_LOCAL_FILES_STORAGE', default=True)",
            "LOCAL_FILES_SERVING_ENABLED = get_bool_env('LOCAL_FILES_SERVING_ENABLED', default=False)",
            "LOCAL_FILES_DOCUMENT_ROOT = get_env('LOCAL_FILES_DOCUMENT_ROOT', default=os.path.abspath(os.sep))",
            "",
            "SYNC_ON_TARGET_STORAGE_CREATION = get_bool_env('SYNC_ON_TARGET_STORAGE_CREATION', default=True)",
            "",
            "ALLOW_IMPORT_TASKS_WITH_UNKNOWN_EMAILS = get_bool_env('ALLOW_IMPORT_TASKS_WITH_UNKNOWN_EMAILS', default=False)",
            "",
            "\"\"\" React Libraries: do not forget to change this dir in /etc/nginx/nginx.conf \"\"\"",
            "",
            "# EDITOR = label-studio-frontend repository",
            "EDITOR_ROOT = os.path.join(BASE_DIR, '../../web/dist/libs/editor')",
            "# DM = data manager (included into FRONTEND due npm building, we need only version.json file from there)",
            "DM_ROOT = os.path.join(BASE_DIR, '../../web/dist/libs/datamanager')",
            "# FRONTEND = GUI for django backend",
            "REACT_APP_ROOT = os.path.join(BASE_DIR, '../../web/dist/apps/labelstudio')",
            "",
            "# per project settings",
            "BATCH_SIZE = 1000",
            "PROJECT_TITLE_MIN_LEN = 3",
            "PROJECT_TITLE_MAX_LEN = 50",
            "LOGIN_REDIRECT_URL = '/'",
            "LOGIN_URL = '/'",
            "MIN_GROUND_TRUTH = 10",
            "DATA_UNDEFINED_NAME = '$undefined$'",
            "LICENSE = {}",
            "VERSIONS = {}",
            "VERSION_EDITION = 'Community'",
            "LATEST_VERSION_CHECK = True",
            "VERSIONS_CHECK_TIME = 0",
            "ALLOW_ORGANIZATION_WEBHOOKS = get_bool_env('ALLOW_ORGANIZATION_WEBHOOKS', False)",
            "CONVERTER_DOWNLOAD_RESOURCES = get_bool_env('CONVERTER_DOWNLOAD_RESOURCES', True)",
            "EXPERIMENTAL_FEATURES = get_bool_env('EXPERIMENTAL_FEATURES', False)",
            "USE_ENFORCE_CSRF_CHECKS = get_bool_env('USE_ENFORCE_CSRF_CHECKS', True)  # False is for tests",
            "CLOUD_FILE_STORAGE_ENABLED = False",
            "",
            "IO_STORAGES_IMPORT_LINK_NAMES = [",
            "    'io_storages_s3importstoragelink',",
            "    'io_storages_gcsimportstoragelink',",
            "    'io_storages_azureblobimportstoragelink',",
            "    'io_storages_localfilesimportstoragelink',",
            "    'io_storages_redisimportstoragelink',",
            "]",
            "",
            "CREATE_ORGANIZATION = 'organizations.functions.create_organization'",
            "SAVE_USER = 'users.functions.save_user'",
            "POST_PROCESS_REIMPORT = 'core.utils.common.empty'",
            "USER_SERIALIZER = 'users.serializers.BaseUserSerializer'",
            "USER_SERIALIZER_UPDATE = 'users.serializers.BaseUserSerializerUpdate'",
            "TASK_SERIALIZER = 'tasks.serializers.BaseTaskSerializer'",
            "EXPORT_DATA_SERIALIZER = 'data_export.serializers.BaseExportDataSerializer'",
            "DATA_MANAGER_GET_ALL_COLUMNS = 'data_manager.functions.get_all_columns'",
            "DATA_MANAGER_ANNOTATIONS_MAP = {}",
            "DATA_MANAGER_ACTIONS = {}",
            "DATA_MANAGER_CUSTOM_FILTER_EXPRESSIONS = 'data_manager.functions.custom_filter_expressions'",
            "DATA_MANAGER_PREPROCESS_FILTER = 'data_manager.functions.preprocess_filter'",
            "USER_LOGIN_FORM = 'users.forms.LoginForm'",
            "PROJECT_MIXIN = 'projects.mixins.ProjectMixin'",
            "TASK_MIXIN = 'tasks.mixins.TaskMixin'",
            "ANNOTATION_MIXIN = 'tasks.mixins.AnnotationMixin'",
            "ORGANIZATION_MIXIN = 'organizations.mixins.OrganizationMixin'",
            "USER_MIXIN = 'users.mixins.UserMixin'",
            "ORGANIZATION_MEMBER_MIXIN = 'organizations.mixins.OrganizationMemberMixin'",
            "MEMBER_PERM = 'core.api_permissions.MemberHasOwnerPermission'",
            "RECALCULATE_ALL_STATS = None",
            "GET_STORAGE_LIST = 'io_storages.functions.get_storage_list'",
            "STORAGE_ANNOTATION_SERIALIZER = 'io_storages.serializers.StorageAnnotationSerializer'",
            "TASK_SERIALIZER_BULK = 'tasks.serializers.BaseTaskSerializerBulk'",
            "PREPROCESS_FIELD_NAME = 'data_manager.functions.preprocess_field_name'",
            "INTERACTIVE_DATA_SERIALIZER = 'data_export.serializers.BaseExportDataSerializerForInteractive'",
            "DELETE_TASKS_ANNOTATIONS_POSTPROCESS = None",
            "",
            "",
            "def project_delete(project):",
            "    project.delete()",
            "",
            "",
            "def user_auth(user_model, email, password):",
            "    return None",
            "",
            "",
            "def collect_versions_dummy(**kwargs):",
            "    return {}",
            "",
            "",
            "PROJECT_DELETE = project_delete",
            "USER_AUTH = user_auth",
            "COLLECT_VERSIONS = collect_versions_dummy",
            "",
            "WEBHOOK_TIMEOUT = float(get_env('WEBHOOK_TIMEOUT', 1.0))",
            "WEBHOOK_BATCH_SIZE = int(get_env('WEBHOOK_BATCH_SIZE', 100))",
            "WEBHOOK_SERIALIZERS = {",
            "    'project': 'webhooks.serializers_for_hooks.ProjectWebhookSerializer',",
            "    'task': 'webhooks.serializers_for_hooks.TaskWebhookSerializer',",
            "    'annotation': 'webhooks.serializers_for_hooks.AnnotationWebhookSerializer',",
            "    'label': 'labels_manager.serializers.LabelSerializer',",
            "    'label_link': 'labels_manager.serializers.LabelLinkSerializer',",
            "}",
            "",
            "EDITOR_KEYMAP = json.dumps(get_env('EDITOR_KEYMAP'))",
            "",
            "# fix a problem with Windows mimetypes for JS and PNG",
            "import mimetypes",
            "",
            "mimetypes.add_type('application/javascript', '.js', True)",
            "mimetypes.add_type('image/png', '.png', True)",
            "",
            "# fields name was used in DM api before",
            "REST_FLEX_FIELDS = {'FIELDS_PARAM': 'include'}",
            "",
            "INTERPOLATE_KEY_FRAMES = get_env('INTERPOLATE_KEY_FRAMES', False)",
            "",
            "# Feature Flags",
            "FEATURE_FLAGS_API_KEY = get_env('FEATURE_FLAGS_API_KEY', default='any key')",
            "",
            "# we may set feature flags from file",
            "FEATURE_FLAGS_FROM_FILE = get_bool_env('FEATURE_FLAGS_FROM_FILE', False)",
            "FEATURE_FLAGS_FILE = get_env('FEATURE_FLAGS_FILE', 'feature_flags.json')",
            "# or if file is not set, default is using offline mode",
            "FEATURE_FLAGS_OFFLINE = get_bool_env('FEATURE_FLAGS_OFFLINE', True)",
            "# default value for feature flags (if not overridden by environment or client)",
            "FEATURE_FLAGS_DEFAULT_VALUE = False",
            "",
            "# Whether to send analytics telemetry data",
            "COLLECT_ANALYTICS = get_bool_env('collect_analytics', True)",
            "",
            "# Strip harmful content from SVG files by default",
            "SVG_SECURITY_CLEANUP = get_bool_env('SVG_SECURITY_CLEANUP', False)",
            "",
            "ML_BLOCK_LOCAL_IP = get_bool_env('ML_BLOCK_LOCAL_IP', False)",
            "",
            "RQ_LONG_JOB_TIMEOUT = int(get_env('RQ_LONG_JOB_TIMEOUT', 36000))",
            "",
            "APP_WEBSERVER = get_env('APP_WEBSERVER', 'django')",
            "",
            "BATCH_JOB_RETRY_TIMEOUT = int(get_env('BATCH_JOB_RETRY_TIMEOUT', 60))",
            "",
            "FUTURE_SAVE_TASK_TO_STORAGE = get_bool_env('FUTURE_SAVE_TASK_TO_STORAGE', default=False)",
            "FUTURE_SAVE_TASK_TO_STORAGE_JSON_EXT = get_bool_env('FUTURE_SAVE_TASK_TO_STORAGE_JSON_EXT', default=True)",
            "STORAGE_IN_PROGRESS_TIMER = float(get_env('STORAGE_IN_PROGRESS_TIMER', 5.0))",
            "STORAGE_EXPORT_CHUNK_SIZE = int(get_env('STORAGE_EXPORT_CHUNK_SIZE', 100))",
            "",
            "USE_NGINX_FOR_EXPORT_DOWNLOADS = get_bool_env('USE_NGINX_FOR_EXPORT_DOWNLOADS', False)",
            "",
            "if get_env('MINIO_STORAGE_ENDPOINT') and not get_bool_env('MINIO_SKIP', False):",
            "    CLOUD_FILE_STORAGE_ENABLED = True",
            "    DEFAULT_FILE_STORAGE = 'storages.backends.s3boto3.S3Boto3Storage'",
            "    AWS_STORAGE_BUCKET_NAME = get_env('MINIO_STORAGE_BUCKET_NAME')",
            "    AWS_ACCESS_KEY_ID = get_env('MINIO_STORAGE_ACCESS_KEY')",
            "    AWS_SECRET_ACCESS_KEY = get_env('MINIO_STORAGE_SECRET_KEY')",
            "    AWS_S3_ENDPOINT_URL = get_env('MINIO_STORAGE_ENDPOINT')",
            "    AWS_QUERYSTRING_AUTH = False",
            "    # make domain for FileUpload.file",
            "    AWS_S3_SECURE_URLS = False",
            "    AWS_S3_URL_PROTOCOL = 'http:' if HOSTNAME.startswith('http://') else 'https:'",
            "    AWS_S3_CUSTOM_DOMAIN = HOSTNAME.replace('http://', '').replace('https://', '') + '/data'",
            "",
            "if get_env('STORAGE_TYPE') == 's3':",
            "    CLOUD_FILE_STORAGE_ENABLED = True",
            "    DEFAULT_FILE_STORAGE = 'core.storage.CustomS3Boto3Storage'",
            "    if get_env('STORAGE_AWS_ACCESS_KEY_ID'):",
            "        AWS_ACCESS_KEY_ID = get_env('STORAGE_AWS_ACCESS_KEY_ID')",
            "    if get_env('STORAGE_AWS_SECRET_ACCESS_KEY'):",
            "        AWS_SECRET_ACCESS_KEY = get_env('STORAGE_AWS_SECRET_ACCESS_KEY')",
            "    AWS_STORAGE_BUCKET_NAME = get_env('STORAGE_AWS_BUCKET_NAME')",
            "    AWS_S3_REGION_NAME = get_env('STORAGE_AWS_REGION_NAME', None)",
            "    AWS_S3_ENDPOINT_URL = get_env('STORAGE_AWS_ENDPOINT_URL', None)",
            "    if get_env('STORAGE_AWS_OBJECT_PARAMETERS'):",
            "        AWS_S3_OBJECT_PARAMETERS = json.loads(get_env('STORAGE_AWS_OBJECT_PARAMETERS'))",
            "    AWS_QUERYSTRING_EXPIRE = int(get_env('STORAGE_AWS_X_AMZ_EXPIRES', '86400'))",
            "    AWS_LOCATION = get_env('STORAGE_AWS_FOLDER', default='')",
            "    AWS_S3_USE_SSL = get_bool_env('STORAGE_AWS_S3_USE_SSL', True)",
            "    AWS_S3_VERIFY = get_env('STORAGE_AWS_S3_VERIFY', None)",
            "    if AWS_S3_VERIFY == 'false' or AWS_S3_VERIFY == 'False' or AWS_S3_VERIFY == '0':",
            "        AWS_S3_VERIFY = False",
            "    AWS_S3_SIGNATURE_VERSION = get_env('STORAGE_AWS_S3_SIGNATURE_VERSION', None)",
            "",
            "if get_env('STORAGE_TYPE') == 'azure':",
            "    CLOUD_FILE_STORAGE_ENABLED = True",
            "    DEFAULT_FILE_STORAGE = 'core.storage.CustomAzureStorage'",
            "    AZURE_ACCOUNT_NAME = get_env('STORAGE_AZURE_ACCOUNT_NAME')",
            "    AZURE_ACCOUNT_KEY = get_env('STORAGE_AZURE_ACCOUNT_KEY')",
            "    AZURE_CONTAINER = get_env('STORAGE_AZURE_CONTAINER_NAME')",
            "    AZURE_URL_EXPIRATION_SECS = int(get_env('STORAGE_AZURE_URL_EXPIRATION_SECS', '86400'))",
            "    AZURE_LOCATION = get_env('STORAGE_AZURE_FOLDER', default='')",
            "",
            "if get_env('STORAGE_TYPE') == 'gcs':",
            "    CLOUD_FILE_STORAGE_ENABLED = True",
            "    # DEFAULT_FILE_STORAGE = 'storages.backends.gcloud.GoogleCloudStorage'",
            "    DEFAULT_FILE_STORAGE = 'core.storage.AlternativeGoogleCloudStorage'",
            "    GS_PROJECT_ID = get_env('STORAGE_GCS_PROJECT_ID')",
            "    GS_BUCKET_NAME = get_env('STORAGE_GCS_BUCKET_NAME')",
            "    GS_EXPIRATION = timedelta(seconds=int(get_env('STORAGE_GCS_EXPIRATION_SECS', '86400')))",
            "    GS_LOCATION = get_env('STORAGE_GCS_FOLDER', default='')",
            "    GS_CUSTOM_ENDPOINT = get_env('STORAGE_GCS_ENDPOINT')",
            "",
            "CSRF_TRUSTED_ORIGINS = get_env('CSRF_TRUSTED_ORIGINS', [])",
            "if CSRF_TRUSTED_ORIGINS:",
            "    CSRF_TRUSTED_ORIGINS = CSRF_TRUSTED_ORIGINS.split(',')",
            "",
            "REAL_HOSTNAME = os.getenv('HOSTNAME')  # we have to use getenv, because we don't use LABEL_STUDIO_ prefix",
            "GCS_CLOUD_STORAGE_FORCE_DEFAULT_CREDENTIALS = get_bool_env('GCS_CLOUD_STORAGE_FORCE_DEFAULT_CREDENTIALS', False)",
            "PUBLIC_API_DOCS = get_bool_env('PUBLIC_API_DOCS', False)",
            "",
            "# By default, we disallow filters with foreign keys in data manager for security reasons.",
            "# Add to this list (either here in code, or via the env) to allow specific filters that rely on foreign keys.",
            "DATA_MANAGER_FILTER_ALLOWLIST = list(",
            "    set(get_env_list('DATA_MANAGER_FILTER_ALLOWLIST') + ['updated_by__active_organization'])",
            ")",
            "",
            "if ENABLE_CSP := get_bool_env('ENABLE_CSP', True):",
            "    CSP_DEFAULT_SRC = (",
            "        \"'self'\",",
            "        \"'report-sample'\",",
            "    )",
            "    CSP_STYLE_SRC = (\"'self'\", \"'report-sample'\", \"'unsafe-inline'\")",
            "    CSP_SCRIPT_SRC = (",
            "        \"'self'\",",
            "        \"'report-sample'\",",
            "        \"'unsafe-inline'\",",
            "        \"'unsafe-eval'\",",
            "        'blob:',",
            "        'browser.sentry-cdn.com',",
            "        'https://*.googletagmanager.com',",
            "    )",
            "    CSP_IMG_SRC = (",
            "        \"'self'\",",
            "        \"'report-sample'\",",
            "        'data:',",
            "        'https://*.google-analytics.com',",
            "        'https://*.googletagmanager.com',",
            "        'https://*.google.com',",
            "    )",
            "    CSP_CONNECT_SRC = (",
            "        \"'self'\",",
            "        \"'report-sample'\",",
            "        'https://*.google-analytics.com',",
            "        'https://*.analytics.google.com',",
            "        'https://analytics.google.com',",
            "        'https://*.googletagmanager.com',",
            "        'https://*.g.double' + 'click.net',  # hacky way of suppressing codespell complaint",
            "        'https://*.ingest.sentry.io',",
            "    )",
            "    # Note that this will be overridden to real CSP for views that use the override_report_only_csp decorator",
            "    CSP_REPORT_ONLY = get_bool_env('LS_CSP_REPORT_ONLY', True)",
            "    CSP_REPORT_URI = get_env('LS_CSP_REPORT_URI', None)",
            "    CSP_INCLUDE_NONCE_IN = ['script-src', 'default-src']",
            "",
            "    MIDDLEWARE.append('core.middleware.HumanSignalCspMiddleware')",
            "",
            "CLOUD_STORAGE_CHECK_FOR_RECORDS_PAGE_SIZE = get_env('CLOUD_STORAGE_CHECK_FOR_RECORDS_PAGE_SIZE', 10000)",
            "CLOUD_STORAGE_CHECK_FOR_RECORDS_TIMEOUT = get_env('CLOUD_STORAGE_CHECK_FOR_RECORDS_TIMEOUT', 60)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {},
        "addLocation": []
    },
    "label_studio/core/utils/io.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 197,
                "afterPatchRowNumber": 197,
                "PatchRowcode": " "
            },
            "1": {
                "beforePatchRowNumber": 198,
                "afterPatchRowNumber": 198,
                "PatchRowcode": " "
            },
            "2": {
                "beforePatchRowNumber": 199,
                "afterPatchRowNumber": 199,
                "PatchRowcode": " def validate_ip(ip: str) -> None:"
            },
            "3": {
                "beforePatchRowNumber": 200,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    \"\"\"Checks if an IP is local/private."
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 200,
                "PatchRowcode": "+    \"\"\"If settings.USE_DEFAULT_BANNED_SUBNETS is True, this function checks"
            },
            "5": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 201,
                "PatchRowcode": "+    if an IP is reserved for any of the reasons in"
            },
            "6": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 202,
                "PatchRowcode": "+    https://en.wikipedia.org/wiki/Reserved_IP_addresses"
            },
            "7": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 203,
                "PatchRowcode": "+    and raises an exception if so. Additionally, if settings.USER_ADDITIONAL_BANNED_SUBNETS"
            },
            "8": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 204,
                "PatchRowcode": "+    is set, it will also check against those subnets."
            },
            "9": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 205,
                "PatchRowcode": "+"
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 206,
                "PatchRowcode": "+    If settings.USE_DEFAULT_BANNED_SUBNETS is False, this function will only check"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 207,
                "PatchRowcode": "+    the IP against settings.USER_ADDITIONAL_BANNED_SUBNETS. Turning off the default"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 208,
                "PatchRowcode": "+    subnets is **risky** and should only be done if you know what you're doing."
            },
            "13": {
                "beforePatchRowNumber": 201,
                "afterPatchRowNumber": 209,
                "PatchRowcode": " "
            },
            "14": {
                "beforePatchRowNumber": 202,
                "afterPatchRowNumber": 210,
                "PatchRowcode": "     :param ip: IP address to be checked."
            },
            "15": {
                "beforePatchRowNumber": 203,
                "afterPatchRowNumber": 211,
                "PatchRowcode": "     \"\"\""
            },
            "16": {
                "beforePatchRowNumber": 204,
                "afterPatchRowNumber": 212,
                "PatchRowcode": " "
            },
            "17": {
                "beforePatchRowNumber": 205,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    if ip == '0.0.0.0':  # nosec"
            },
            "18": {
                "beforePatchRowNumber": 206,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        raise InvalidUploadUrlError"
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 213,
                "PatchRowcode": "+    default_banned_subnets = ["
            },
            "20": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 214,
                "PatchRowcode": "+        '0.0.0.0/8',  # current network"
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 215,
                "PatchRowcode": "+        '10.0.0.0/8',  # private network"
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 216,
                "PatchRowcode": "+        '100.64.0.0/10',  # shared address space"
            },
            "23": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 217,
                "PatchRowcode": "+        '127.0.0.0/8',  # loopback"
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 218,
                "PatchRowcode": "+        '169.254.0.0/16',  # link-local"
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 219,
                "PatchRowcode": "+        '172.16.0.0/12',  # private network"
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 220,
                "PatchRowcode": "+        '192.0.0.0/24',  # IETF protocol assignments"
            },
            "27": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 221,
                "PatchRowcode": "+        '192.0.2.0/24',  # TEST-NET-1"
            },
            "28": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 222,
                "PatchRowcode": "+        '192.88.99.0/24',  # Reserved, formerly ipv6 to ipv4 relay"
            },
            "29": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 223,
                "PatchRowcode": "+        '192.168.0.0/16',  # private network"
            },
            "30": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 224,
                "PatchRowcode": "+        '198.18.0.0/15',  # network interconnect device benchmark testing"
            },
            "31": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 225,
                "PatchRowcode": "+        '198.51.100.0/24',  # TEST-NET-2"
            },
            "32": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 226,
                "PatchRowcode": "+        '203.0.113.0/24',  # TEST-NET-3"
            },
            "33": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 227,
                "PatchRowcode": "+        '224.0.0.0/4',  # multicast"
            },
            "34": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 228,
                "PatchRowcode": "+        '233.252.0.0/24',  # MCAST-TEST-NET"
            },
            "35": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 229,
                "PatchRowcode": "+        '240.0.0.0/4',  # reserved for future use"
            },
            "36": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 230,
                "PatchRowcode": "+        '255.255.255.255/32',  # limited broadcast"
            },
            "37": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 231,
                "PatchRowcode": "+        '::/128',  # unspecified address"
            },
            "38": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 232,
                "PatchRowcode": "+        '::1/128',  # loopback"
            },
            "39": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 233,
                "PatchRowcode": "+        '::ffff:0:0/96',  # IPv4-mapped address"
            },
            "40": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 234,
                "PatchRowcode": "+        '::ffff:0:0:0/96',  # IPv4-translated address"
            },
            "41": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 235,
                "PatchRowcode": "+        '64:ff9b::/96',  # IPv4/IPv6 translation"
            },
            "42": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 236,
                "PatchRowcode": "+        '64:ff9b:1::/48',  # IPv4/IPv6 translation"
            },
            "43": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 237,
                "PatchRowcode": "+        '100::/64',  # discard prefix"
            },
            "44": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 238,
                "PatchRowcode": "+        '2001:0000::/32',  # Teredo tunneling"
            },
            "45": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 239,
                "PatchRowcode": "+        '2001:20::/28',  # ORCHIDv2"
            },
            "46": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 240,
                "PatchRowcode": "+        '2001:db8::/32',  # documentation"
            },
            "47": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 241,
                "PatchRowcode": "+        '2002::/16',  # 6to4"
            },
            "48": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 242,
                "PatchRowcode": "+        'fc00::/7',  # unique local"
            },
            "49": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 243,
                "PatchRowcode": "+        'fe80::/10',  # link-local"
            },
            "50": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 244,
                "PatchRowcode": "+        'ff00::/8',  # multicast"
            },
            "51": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 245,
                "PatchRowcode": "+    ]"
            },
            "52": {
                "beforePatchRowNumber": 207,
                "afterPatchRowNumber": 246,
                "PatchRowcode": " "
            },
            "53": {
                "beforePatchRowNumber": 208,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    local_subnets = ["
            },
            "54": {
                "beforePatchRowNumber": 209,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        '127.0.0.0/8',"
            },
            "55": {
                "beforePatchRowNumber": 210,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        '10.0.0.0/8',"
            },
            "56": {
                "beforePatchRowNumber": 211,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        '172.16.0.0/12',"
            },
            "57": {
                "beforePatchRowNumber": 212,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-        '192.168.0.0/16',"
            },
            "58": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 247,
                "PatchRowcode": "+    banned_subnets = ["
            },
            "59": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 248,
                "PatchRowcode": "+        *(default_banned_subnets if settings.USE_DEFAULT_BANNED_SUBNETS else []),"
            },
            "60": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 249,
                "PatchRowcode": "+        *(settings.USER_ADDITIONAL_BANNED_SUBNETS or []),"
            },
            "61": {
                "beforePatchRowNumber": 213,
                "afterPatchRowNumber": 250,
                "PatchRowcode": "     ]"
            },
            "62": {
                "beforePatchRowNumber": 214,
                "afterPatchRowNumber": 251,
                "PatchRowcode": " "
            },
            "63": {
                "beforePatchRowNumber": 215,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    for subnet in local_subnets:"
            },
            "64": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 252,
                "PatchRowcode": "+    for subnet in banned_subnets:"
            },
            "65": {
                "beforePatchRowNumber": 216,
                "afterPatchRowNumber": 253,
                "PatchRowcode": "         if ipaddress.ip_address(ip) in ipaddress.ip_network(subnet):"
            },
            "66": {
                "beforePatchRowNumber": 217,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            raise InvalidUploadUrlError"
            },
            "67": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 254,
                "PatchRowcode": "+            raise InvalidUploadUrlError(f'URL resolves to a reserved network address (block: {subnet})')"
            },
            "68": {
                "beforePatchRowNumber": 218,
                "afterPatchRowNumber": 255,
                "PatchRowcode": " "
            },
            "69": {
                "beforePatchRowNumber": 219,
                "afterPatchRowNumber": 256,
                "PatchRowcode": " "
            },
            "70": {
                "beforePatchRowNumber": 220,
                "afterPatchRowNumber": 257,
                "PatchRowcode": " def ssrf_safe_get(url, *args, **kwargs):"
            }
        },
        "frontPatchFile": [
            "\"\"\"This file and its contents are licensed under the Apache License 2.0. Please see the included NOTICE for copyright information and LICENSE for a copy of the license.",
            "\"\"\"",
            "import glob",
            "import io",
            "import ipaddress",
            "import itertools",
            "import os",
            "import shutil",
            "import socket",
            "from contextlib import contextmanager",
            "from tempfile import mkdtemp, mkstemp",
            "",
            "import pkg_resources",
            "import requests",
            "import ujson as json",
            "import yaml",
            "from appdirs import user_cache_dir, user_config_dir, user_data_dir",
            "from django.conf import settings",
            "from urllib3.util import parse_url",
            "",
            "# full path import results in unit test failures",
            "from .exceptions import InvalidUploadUrlError",
            "",
            "_DIR_APP_NAME = 'label-studio'",
            "",
            "",
            "def good_path(path):",
            "    return os.path.abspath(os.path.expanduser(path))",
            "",
            "",
            "def find_node(package_name, node_path, node_type):",
            "    assert node_type in ('dir', 'file', 'any')",
            "    basedir = pkg_resources.resource_filename(package_name, '')",
            "    node_path = os.path.join(*node_path.split('/'))  # linux to windows compatibility",
            "    search_by_path = '/' in node_path or '\\\\' in node_path",
            "",
            "    for path, dirs, filenames in os.walk(basedir):",
            "        if node_type == 'file':",
            "            nodes = filenames",
            "        elif node_type == 'dir':",
            "            nodes = dirs",
            "        else:",
            "            nodes = filenames + dirs",
            "        if search_by_path:",
            "            for found_node in nodes:",
            "                found_node = os.path.join(path, found_node)",
            "                if found_node.endswith(node_path):",
            "                    return found_node",
            "        elif node_path in nodes:",
            "            return os.path.join(path, node_path)",
            "    else:",
            "        raise IOError('Could not find \"%s\" at package \"%s\"' % (node_path, basedir))",
            "",
            "",
            "def find_file(file):",
            "    return find_node('label_studio', file, 'file')",
            "",
            "",
            "def find_dir(directory):",
            "    return find_node('label_studio', directory, 'dir')",
            "",
            "",
            "@contextmanager",
            "def get_temp_file():",
            "    fd, path = mkstemp()",
            "    yield path",
            "    os.close(fd)",
            "",
            "",
            "@contextmanager",
            "def get_temp_dir():",
            "    dirpath = mkdtemp()",
            "    yield dirpath",
            "    shutil.rmtree(dirpath)",
            "",
            "",
            "def get_config_dir():",
            "    config_dir = user_config_dir(appname=_DIR_APP_NAME)",
            "    try:",
            "        os.makedirs(config_dir, exist_ok=True)",
            "    except OSError:",
            "        pass",
            "    return config_dir",
            "",
            "",
            "def get_data_dir():",
            "    data_dir = user_data_dir(appname=_DIR_APP_NAME)",
            "    os.makedirs(data_dir, exist_ok=True)",
            "    return data_dir",
            "",
            "",
            "def get_cache_dir():",
            "    cache_dir = user_cache_dir(appname=_DIR_APP_NAME)",
            "    os.makedirs(cache_dir, exist_ok=True)",
            "    return cache_dir",
            "",
            "",
            "def delete_dir_content(dirpath):",
            "    for f in glob.glob(dirpath + '/*'):",
            "        remove_file_or_dir(f)",
            "",
            "",
            "def remove_file_or_dir(path):",
            "    if os.path.isfile(path):",
            "        os.remove(path)",
            "    elif os.path.isdir(path):",
            "        shutil.rmtree(path)",
            "",
            "",
            "def get_all_files_from_dir(d):",
            "    out = []",
            "    for name in os.listdir(d):",
            "        filepath = os.path.join(d, name)",
            "        if os.path.isfile(filepath):",
            "            out.append(filepath)",
            "    return out",
            "",
            "",
            "def iter_files(root_dir, ext):",
            "    for root, _, files in os.walk(root_dir):",
            "        for f in files:",
            "            if f.lower().endswith(ext):",
            "                yield os.path.join(root, f)",
            "",
            "",
            "def json_load(file, int_keys=False):",
            "    with io.open(file, encoding='utf8') as f:",
            "        data = json.load(f)",
            "        if int_keys:",
            "            return {int(k): v for k, v in data.items()}",
            "        else:",
            "            return data",
            "",
            "",
            "def read_yaml(filepath):",
            "    if not os.path.exists(filepath):",
            "        filepath = find_file(filepath)",
            "    with io.open(filepath, encoding='utf-8') as f:",
            "        data = yaml.load(f, Loader=yaml.FullLoader)  # nosec",
            "    return data",
            "",
            "",
            "def read_bytes_stream(filepath):",
            "    with open(filepath, mode='rb') as f:",
            "        return io.BytesIO(f.read())",
            "",
            "",
            "def get_all_dirs_from_dir(d):",
            "    out = []",
            "    for name in os.listdir(d):",
            "        filepath = os.path.join(d, name)",
            "        if os.path.isdir(filepath):",
            "            out.append(filepath)",
            "    return out",
            "",
            "",
            "class SerializableGenerator(list):",
            "    \"\"\"Generator that is serializable by JSON\"\"\"",
            "",
            "    def __init__(self, iterable):",
            "        tmp_body = iter(iterable)",
            "        try:",
            "            self._head = iter([next(tmp_body)])",
            "            self.append(tmp_body)",
            "        except StopIteration:",
            "            self._head = []",
            "",
            "    def __iter__(self):",
            "        return itertools.chain(self._head, *self[:1])",
            "",
            "",
            "def validate_upload_url(url, block_local_urls=True):",
            "    \"\"\"Utility function for defending against SSRF attacks. Raises",
            "        - InvalidUploadUrlError if the url is not HTTP[S], or if block_local_urls is enabled",
            "          and the URL resolves to a local address.",
            "        - LabelStudioApiException if the hostname cannot be resolved",
            "",
            "    :param url: Url to be checked for validity/safety,",
            "    :param block_local_urls: Whether urls that resolve to local/private networks should be allowed.",
            "    \"\"\"",
            "",
            "    parsed_url = parse_url(url)",
            "",
            "    if parsed_url.scheme not in ('http', 'https'):",
            "        raise InvalidUploadUrlError",
            "",
            "    domain = parsed_url.host",
            "    try:",
            "        ip = socket.gethostbyname(domain)",
            "    except socket.error:",
            "        from core.utils.exceptions import LabelStudioAPIException",
            "",
            "        raise LabelStudioAPIException(f\"Can't resolve hostname {domain}\")",
            "",
            "    if block_local_urls:",
            "        validate_ip(ip)",
            "",
            "",
            "def validate_ip(ip: str) -> None:",
            "    \"\"\"Checks if an IP is local/private.",
            "",
            "    :param ip: IP address to be checked.",
            "    \"\"\"",
            "",
            "    if ip == '0.0.0.0':  # nosec",
            "        raise InvalidUploadUrlError",
            "",
            "    local_subnets = [",
            "        '127.0.0.0/8',",
            "        '10.0.0.0/8',",
            "        '172.16.0.0/12',",
            "        '192.168.0.0/16',",
            "    ]",
            "",
            "    for subnet in local_subnets:",
            "        if ipaddress.ip_address(ip) in ipaddress.ip_network(subnet):",
            "            raise InvalidUploadUrlError",
            "",
            "",
            "def ssrf_safe_get(url, *args, **kwargs):",
            "    validate_upload_url(url, block_local_urls=settings.SSRF_PROTECTION_ENABLED)",
            "    # Reason for #nosec: url has been validated as SSRF safe by the",
            "    # validation check above.",
            "    response = requests.get(url, *args, **kwargs)   # nosec",
            "",
            "    # second check for SSRF for prevent redirect and dns rebinding attacks",
            "    if settings.SSRF_PROTECTION_ENABLED:",
            "        response_ip = response.raw._connection.sock.getpeername()[0]",
            "        validate_ip(response_ip)",
            "    return response"
        ],
        "afterPatchFile": [
            "\"\"\"This file and its contents are licensed under the Apache License 2.0. Please see the included NOTICE for copyright information and LICENSE for a copy of the license.",
            "\"\"\"",
            "import glob",
            "import io",
            "import ipaddress",
            "import itertools",
            "import os",
            "import shutil",
            "import socket",
            "from contextlib import contextmanager",
            "from tempfile import mkdtemp, mkstemp",
            "",
            "import pkg_resources",
            "import requests",
            "import ujson as json",
            "import yaml",
            "from appdirs import user_cache_dir, user_config_dir, user_data_dir",
            "from django.conf import settings",
            "from urllib3.util import parse_url",
            "",
            "# full path import results in unit test failures",
            "from .exceptions import InvalidUploadUrlError",
            "",
            "_DIR_APP_NAME = 'label-studio'",
            "",
            "",
            "def good_path(path):",
            "    return os.path.abspath(os.path.expanduser(path))",
            "",
            "",
            "def find_node(package_name, node_path, node_type):",
            "    assert node_type in ('dir', 'file', 'any')",
            "    basedir = pkg_resources.resource_filename(package_name, '')",
            "    node_path = os.path.join(*node_path.split('/'))  # linux to windows compatibility",
            "    search_by_path = '/' in node_path or '\\\\' in node_path",
            "",
            "    for path, dirs, filenames in os.walk(basedir):",
            "        if node_type == 'file':",
            "            nodes = filenames",
            "        elif node_type == 'dir':",
            "            nodes = dirs",
            "        else:",
            "            nodes = filenames + dirs",
            "        if search_by_path:",
            "            for found_node in nodes:",
            "                found_node = os.path.join(path, found_node)",
            "                if found_node.endswith(node_path):",
            "                    return found_node",
            "        elif node_path in nodes:",
            "            return os.path.join(path, node_path)",
            "    else:",
            "        raise IOError('Could not find \"%s\" at package \"%s\"' % (node_path, basedir))",
            "",
            "",
            "def find_file(file):",
            "    return find_node('label_studio', file, 'file')",
            "",
            "",
            "def find_dir(directory):",
            "    return find_node('label_studio', directory, 'dir')",
            "",
            "",
            "@contextmanager",
            "def get_temp_file():",
            "    fd, path = mkstemp()",
            "    yield path",
            "    os.close(fd)",
            "",
            "",
            "@contextmanager",
            "def get_temp_dir():",
            "    dirpath = mkdtemp()",
            "    yield dirpath",
            "    shutil.rmtree(dirpath)",
            "",
            "",
            "def get_config_dir():",
            "    config_dir = user_config_dir(appname=_DIR_APP_NAME)",
            "    try:",
            "        os.makedirs(config_dir, exist_ok=True)",
            "    except OSError:",
            "        pass",
            "    return config_dir",
            "",
            "",
            "def get_data_dir():",
            "    data_dir = user_data_dir(appname=_DIR_APP_NAME)",
            "    os.makedirs(data_dir, exist_ok=True)",
            "    return data_dir",
            "",
            "",
            "def get_cache_dir():",
            "    cache_dir = user_cache_dir(appname=_DIR_APP_NAME)",
            "    os.makedirs(cache_dir, exist_ok=True)",
            "    return cache_dir",
            "",
            "",
            "def delete_dir_content(dirpath):",
            "    for f in glob.glob(dirpath + '/*'):",
            "        remove_file_or_dir(f)",
            "",
            "",
            "def remove_file_or_dir(path):",
            "    if os.path.isfile(path):",
            "        os.remove(path)",
            "    elif os.path.isdir(path):",
            "        shutil.rmtree(path)",
            "",
            "",
            "def get_all_files_from_dir(d):",
            "    out = []",
            "    for name in os.listdir(d):",
            "        filepath = os.path.join(d, name)",
            "        if os.path.isfile(filepath):",
            "            out.append(filepath)",
            "    return out",
            "",
            "",
            "def iter_files(root_dir, ext):",
            "    for root, _, files in os.walk(root_dir):",
            "        for f in files:",
            "            if f.lower().endswith(ext):",
            "                yield os.path.join(root, f)",
            "",
            "",
            "def json_load(file, int_keys=False):",
            "    with io.open(file, encoding='utf8') as f:",
            "        data = json.load(f)",
            "        if int_keys:",
            "            return {int(k): v for k, v in data.items()}",
            "        else:",
            "            return data",
            "",
            "",
            "def read_yaml(filepath):",
            "    if not os.path.exists(filepath):",
            "        filepath = find_file(filepath)",
            "    with io.open(filepath, encoding='utf-8') as f:",
            "        data = yaml.load(f, Loader=yaml.FullLoader)  # nosec",
            "    return data",
            "",
            "",
            "def read_bytes_stream(filepath):",
            "    with open(filepath, mode='rb') as f:",
            "        return io.BytesIO(f.read())",
            "",
            "",
            "def get_all_dirs_from_dir(d):",
            "    out = []",
            "    for name in os.listdir(d):",
            "        filepath = os.path.join(d, name)",
            "        if os.path.isdir(filepath):",
            "            out.append(filepath)",
            "    return out",
            "",
            "",
            "class SerializableGenerator(list):",
            "    \"\"\"Generator that is serializable by JSON\"\"\"",
            "",
            "    def __init__(self, iterable):",
            "        tmp_body = iter(iterable)",
            "        try:",
            "            self._head = iter([next(tmp_body)])",
            "            self.append(tmp_body)",
            "        except StopIteration:",
            "            self._head = []",
            "",
            "    def __iter__(self):",
            "        return itertools.chain(self._head, *self[:1])",
            "",
            "",
            "def validate_upload_url(url, block_local_urls=True):",
            "    \"\"\"Utility function for defending against SSRF attacks. Raises",
            "        - InvalidUploadUrlError if the url is not HTTP[S], or if block_local_urls is enabled",
            "          and the URL resolves to a local address.",
            "        - LabelStudioApiException if the hostname cannot be resolved",
            "",
            "    :param url: Url to be checked for validity/safety,",
            "    :param block_local_urls: Whether urls that resolve to local/private networks should be allowed.",
            "    \"\"\"",
            "",
            "    parsed_url = parse_url(url)",
            "",
            "    if parsed_url.scheme not in ('http', 'https'):",
            "        raise InvalidUploadUrlError",
            "",
            "    domain = parsed_url.host",
            "    try:",
            "        ip = socket.gethostbyname(domain)",
            "    except socket.error:",
            "        from core.utils.exceptions import LabelStudioAPIException",
            "",
            "        raise LabelStudioAPIException(f\"Can't resolve hostname {domain}\")",
            "",
            "    if block_local_urls:",
            "        validate_ip(ip)",
            "",
            "",
            "def validate_ip(ip: str) -> None:",
            "    \"\"\"If settings.USE_DEFAULT_BANNED_SUBNETS is True, this function checks",
            "    if an IP is reserved for any of the reasons in",
            "    https://en.wikipedia.org/wiki/Reserved_IP_addresses",
            "    and raises an exception if so. Additionally, if settings.USER_ADDITIONAL_BANNED_SUBNETS",
            "    is set, it will also check against those subnets.",
            "",
            "    If settings.USE_DEFAULT_BANNED_SUBNETS is False, this function will only check",
            "    the IP against settings.USER_ADDITIONAL_BANNED_SUBNETS. Turning off the default",
            "    subnets is **risky** and should only be done if you know what you're doing.",
            "",
            "    :param ip: IP address to be checked.",
            "    \"\"\"",
            "",
            "    default_banned_subnets = [",
            "        '0.0.0.0/8',  # current network",
            "        '10.0.0.0/8',  # private network",
            "        '100.64.0.0/10',  # shared address space",
            "        '127.0.0.0/8',  # loopback",
            "        '169.254.0.0/16',  # link-local",
            "        '172.16.0.0/12',  # private network",
            "        '192.0.0.0/24',  # IETF protocol assignments",
            "        '192.0.2.0/24',  # TEST-NET-1",
            "        '192.88.99.0/24',  # Reserved, formerly ipv6 to ipv4 relay",
            "        '192.168.0.0/16',  # private network",
            "        '198.18.0.0/15',  # network interconnect device benchmark testing",
            "        '198.51.100.0/24',  # TEST-NET-2",
            "        '203.0.113.0/24',  # TEST-NET-3",
            "        '224.0.0.0/4',  # multicast",
            "        '233.252.0.0/24',  # MCAST-TEST-NET",
            "        '240.0.0.0/4',  # reserved for future use",
            "        '255.255.255.255/32',  # limited broadcast",
            "        '::/128',  # unspecified address",
            "        '::1/128',  # loopback",
            "        '::ffff:0:0/96',  # IPv4-mapped address",
            "        '::ffff:0:0:0/96',  # IPv4-translated address",
            "        '64:ff9b::/96',  # IPv4/IPv6 translation",
            "        '64:ff9b:1::/48',  # IPv4/IPv6 translation",
            "        '100::/64',  # discard prefix",
            "        '2001:0000::/32',  # Teredo tunneling",
            "        '2001:20::/28',  # ORCHIDv2",
            "        '2001:db8::/32',  # documentation",
            "        '2002::/16',  # 6to4",
            "        'fc00::/7',  # unique local",
            "        'fe80::/10',  # link-local",
            "        'ff00::/8',  # multicast",
            "    ]",
            "",
            "    banned_subnets = [",
            "        *(default_banned_subnets if settings.USE_DEFAULT_BANNED_SUBNETS else []),",
            "        *(settings.USER_ADDITIONAL_BANNED_SUBNETS or []),",
            "    ]",
            "",
            "    for subnet in banned_subnets:",
            "        if ipaddress.ip_address(ip) in ipaddress.ip_network(subnet):",
            "            raise InvalidUploadUrlError(f'URL resolves to a reserved network address (block: {subnet})')",
            "",
            "",
            "def ssrf_safe_get(url, *args, **kwargs):",
            "    validate_upload_url(url, block_local_urls=settings.SSRF_PROTECTION_ENABLED)",
            "    # Reason for #nosec: url has been validated as SSRF safe by the",
            "    # validation check above.",
            "    response = requests.get(url, *args, **kwargs)   # nosec",
            "",
            "    # second check for SSRF for prevent redirect and dns rebinding attacks",
            "    if settings.SSRF_PROTECTION_ENABLED:",
            "        response_ip = response.raw._connection.sock.getpeername()[0]",
            "        validate_ip(response_ip)",
            "    return response"
        ],
        "action": [
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "2",
            "2",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "200": [
                "validate_ip"
            ],
            "205": [
                "validate_ip"
            ],
            "206": [
                "validate_ip"
            ],
            "208": [
                "validate_ip"
            ],
            "209": [
                "validate_ip"
            ],
            "210": [
                "validate_ip"
            ],
            "211": [
                "validate_ip"
            ],
            "212": [
                "validate_ip"
            ],
            "215": [
                "validate_ip"
            ],
            "217": [
                "validate_ip"
            ]
        },
        "addLocation": []
    },
    "label_studio/tests/data_import/test_uploader.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 70,
                "afterPatchRowNumber": 70,
                "PatchRowcode": "                 ValidationError"
            },
            "1": {
                "beforePatchRowNumber": 71,
                "afterPatchRowNumber": 71,
                "PatchRowcode": "             ) as e:"
            },
            "2": {
                "beforePatchRowNumber": 72,
                "afterPatchRowNumber": 72,
                "PatchRowcode": "                 load_tasks(request, project)"
            },
            "3": {
                "beforePatchRowNumber": 73,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-            assert 'The provided URL was not valid.' in str(e.value)"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 73,
                "PatchRowcode": "+            assert 'URL resolves to a reserved network address (block: 127.0.0.0/8)' in str(e.value)"
            },
            "5": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 74,
                "PatchRowcode": "+"
            },
            "6": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 75,
                "PatchRowcode": "+        def test_user_specified_block(self, project, settings):"
            },
            "7": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 76,
                "PatchRowcode": "+            settings.SSRF_PROTECTION_ENABLED = True"
            },
            "8": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 77,
                "PatchRowcode": "+            settings.USER_ADDITIONAL_BANNED_SUBNETS = ['1.2.3.4']"
            },
            "9": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 78,
                "PatchRowcode": "+            request = MockedRequest(url='http://validurl.com')"
            },
            "10": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 79,
                "PatchRowcode": "+"
            },
            "11": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 80,
                "PatchRowcode": "+            # Mock the necessary parts of the response object"
            },
            "12": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 81,
                "PatchRowcode": "+            mock_response = Mock()"
            },
            "13": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 82,
                "PatchRowcode": "+            mock_response.raw._connection.sock.getpeername.return_value = ('1.2.3.4', 8080)"
            },
            "14": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 83,
                "PatchRowcode": "+"
            },
            "15": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 84,
                "PatchRowcode": "+            # Patch the requests.get call in the data_import.uploader module"
            },
            "16": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 85,
                "PatchRowcode": "+            with mock.patch('core.utils.io.requests.get', return_value=mock_response), pytest.raises("
            },
            "17": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 86,
                "PatchRowcode": "+                ValidationError"
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 87,
                "PatchRowcode": "+            ) as e:"
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 88,
                "PatchRowcode": "+                load_tasks(request, project)"
            },
            "20": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 89,
                "PatchRowcode": "+            assert 'URL resolves to a reserved network address (block: 1.2.3.4)' in str(e.value)"
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 90,
                "PatchRowcode": "+"
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 91,
                "PatchRowcode": "+            mock_response.raw._connection.sock.getpeername.return_value = ('198.51.100.0', 8080)"
            },
            "23": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 92,
                "PatchRowcode": "+            with mock.patch('core.utils.io.requests.get', return_value=mock_response), pytest.raises("
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 93,
                "PatchRowcode": "+                ValidationError"
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 94,
                "PatchRowcode": "+            ) as e:"
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 95,
                "PatchRowcode": "+                load_tasks(request, project)"
            },
            "27": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 96,
                "PatchRowcode": "+            assert 'URL resolves to a reserved network address (block: 198.51.100.0/24)' in str(e.value)"
            },
            "28": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 97,
                "PatchRowcode": "+"
            },
            "29": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 98,
                "PatchRowcode": "+        def test_user_specified_block_without_default(self, project, settings):"
            },
            "30": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 99,
                "PatchRowcode": "+            settings.SSRF_PROTECTION_ENABLED = True"
            },
            "31": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 100,
                "PatchRowcode": "+            settings.USER_ADDITIONAL_BANNED_SUBNETS = ['1.2.3.4']"
            },
            "32": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 101,
                "PatchRowcode": "+            settings.USE_DEFAULT_BANNED_SUBNETS = False"
            },
            "33": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 102,
                "PatchRowcode": "+            request = MockedRequest(url='http://validurl.com')"
            },
            "34": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 103,
                "PatchRowcode": "+"
            },
            "35": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 104,
                "PatchRowcode": "+            # Mock the necessary parts of the response object"
            },
            "36": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 105,
                "PatchRowcode": "+            mock_response = Mock()"
            },
            "37": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 106,
                "PatchRowcode": "+            mock_response.raw._connection.sock.getpeername.return_value = ('1.2.3.4', 8080)"
            },
            "38": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 107,
                "PatchRowcode": "+"
            },
            "39": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 108,
                "PatchRowcode": "+            # Patch the requests.get call in the data_import.uploader module"
            },
            "40": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 109,
                "PatchRowcode": "+            with mock.patch('core.utils.io.requests.get', return_value=mock_response), pytest.raises("
            },
            "41": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 110,
                "PatchRowcode": "+                ValidationError"
            },
            "42": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 111,
                "PatchRowcode": "+            ) as e:"
            },
            "43": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 112,
                "PatchRowcode": "+                load_tasks(request, project)"
            },
            "44": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 113,
                "PatchRowcode": "+            assert 'URL resolves to a reserved network address (block: 1.2.3.4)' in str(e.value)"
            },
            "45": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 114,
                "PatchRowcode": "+"
            },
            "46": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 115,
                "PatchRowcode": "+            mock_response.raw._connection.sock.getpeername.return_value = ('198.51.100.0', 8080)"
            },
            "47": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 116,
                "PatchRowcode": "+            with mock.patch('core.utils.io.requests.get', return_value=mock_response), pytest.raises("
            },
            "48": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 117,
                "PatchRowcode": "+                ValidationError"
            },
            "49": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 118,
                "PatchRowcode": "+            ) as e:"
            },
            "50": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 119,
                "PatchRowcode": "+                load_tasks(request, project)"
            },
            "51": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 120,
                "PatchRowcode": "+            assert \"'Mock' object is not subscriptable\" in str(e.value)  # validate ip did not raise exception"
            },
            "52": {
                "beforePatchRowNumber": 74,
                "afterPatchRowNumber": 121,
                "PatchRowcode": " "
            },
            "53": {
                "beforePatchRowNumber": 75,
                "afterPatchRowNumber": 122,
                "PatchRowcode": " "
            },
            "54": {
                "beforePatchRowNumber": 76,
                "afterPatchRowNumber": 123,
                "PatchRowcode": " class TestTasksFileChecks:"
            }
        },
        "frontPatchFile": [
            "from unittest import mock",
            "from unittest.mock import Mock",
            "",
            "import pytest",
            "from core.utils.io import validate_upload_url",
            "from data_import.uploader import check_tasks_max_file_size, load_tasks",
            "from django.conf import settings",
            "from rest_framework.exceptions import ValidationError",
            "",
            "pytestmark = pytest.mark.django_db",
            "",
            "",
            "class MockedRequest:",
            "    FILES = ()",
            "",
            "    def __init__(self, url):",
            "        self.url = url",
            "",
            "    @property",
            "    def content_type(self):",
            "        return 'application/x-www-form-urlencoded'",
            "",
            "    @property",
            "    def data(self):",
            "        return {'url': self.url}",
            "",
            "    @property",
            "    def user(self):",
            "        return None",
            "",
            "",
            "class TestUploader:",
            "    @pytest.fixture",
            "    def project(self, configured_project, settings):",
            "        return configured_project",
            "",
            "    class TestLoadTasks:",
            "        @mock.patch('core.utils.io.validate_upload_url', wraps=validate_upload_url)",
            "        @pytest.mark.parametrize('url', ('file:///etc/passwd', 'ftp://example.org'))",
            "        def test_raises_for_unsafe_urls(self, validate_upload_url_mock, url, project):",
            "            request = MockedRequest(url=url)",
            "",
            "            with pytest.raises(ValidationError) as e:",
            "                load_tasks(request, project)",
            "                assert 'The provided URL was not valid.' in e.value",
            "",
            "            validate_upload_url_mock.assert_called_once_with(url, block_local_urls=False)",
            "",
            "        @mock.patch('core.utils.io.validate_upload_url', wraps=validate_upload_url)",
            "        def test_raises_for_local_urls_with_ssrf_protection_enabled(self, validate_upload_url_mock, project, settings):",
            "            settings.SSRF_PROTECTION_ENABLED = True",
            "            request = MockedRequest(url='http://0.0.0.0')",
            "",
            "            with pytest.raises(ValidationError) as e:",
            "                load_tasks(request, project)",
            "                assert 'The provided URL was not valid.' in e.value",
            "",
            "            validate_upload_url_mock.assert_called_once_with('http://0.0.0.0', block_local_urls=True)",
            "",
            "        def test_local_url_after_redirect(self, project, settings):",
            "            settings.SSRF_PROTECTION_ENABLED = True",
            "            request = MockedRequest(url='http://validurl.com')",
            "",
            "            # Mock the necessary parts of the response object",
            "            mock_response = Mock()",
            "            mock_response.raw._connection.sock.getpeername.return_value = ('127.0.0.1', 8080)",
            "",
            "            # Patch the requests.get call in the data_import.uploader module",
            "            with mock.patch('core.utils.io.requests.get', return_value=mock_response), pytest.raises(",
            "                ValidationError",
            "            ) as e:",
            "                load_tasks(request, project)",
            "            assert 'The provided URL was not valid.' in str(e.value)",
            "",
            "",
            "class TestTasksFileChecks:",
            "    @pytest.mark.parametrize('value', (0, settings.TASKS_MAX_FILE_SIZE - 1))",
            "    def test_check_tasks_max_file_size_does_not_raise_for_correct_value(self, value):",
            "        check_tasks_max_file_size(value)",
            "",
            "    def test_check_tasks_max_file_size_raises_for_too_big_value(self):",
            "        value = settings.TASKS_MAX_FILE_SIZE + 1",
            "",
            "        with pytest.raises(ValidationError) as e:",
            "            check_tasks_max_file_size(value)",
            "",
            "        assert f'Maximum total size of all files is {settings.TASKS_MAX_FILE_SIZE} bytes' in str(e.value)"
        ],
        "afterPatchFile": [
            "from unittest import mock",
            "from unittest.mock import Mock",
            "",
            "import pytest",
            "from core.utils.io import validate_upload_url",
            "from data_import.uploader import check_tasks_max_file_size, load_tasks",
            "from django.conf import settings",
            "from rest_framework.exceptions import ValidationError",
            "",
            "pytestmark = pytest.mark.django_db",
            "",
            "",
            "class MockedRequest:",
            "    FILES = ()",
            "",
            "    def __init__(self, url):",
            "        self.url = url",
            "",
            "    @property",
            "    def content_type(self):",
            "        return 'application/x-www-form-urlencoded'",
            "",
            "    @property",
            "    def data(self):",
            "        return {'url': self.url}",
            "",
            "    @property",
            "    def user(self):",
            "        return None",
            "",
            "",
            "class TestUploader:",
            "    @pytest.fixture",
            "    def project(self, configured_project, settings):",
            "        return configured_project",
            "",
            "    class TestLoadTasks:",
            "        @mock.patch('core.utils.io.validate_upload_url', wraps=validate_upload_url)",
            "        @pytest.mark.parametrize('url', ('file:///etc/passwd', 'ftp://example.org'))",
            "        def test_raises_for_unsafe_urls(self, validate_upload_url_mock, url, project):",
            "            request = MockedRequest(url=url)",
            "",
            "            with pytest.raises(ValidationError) as e:",
            "                load_tasks(request, project)",
            "                assert 'The provided URL was not valid.' in e.value",
            "",
            "            validate_upload_url_mock.assert_called_once_with(url, block_local_urls=False)",
            "",
            "        @mock.patch('core.utils.io.validate_upload_url', wraps=validate_upload_url)",
            "        def test_raises_for_local_urls_with_ssrf_protection_enabled(self, validate_upload_url_mock, project, settings):",
            "            settings.SSRF_PROTECTION_ENABLED = True",
            "            request = MockedRequest(url='http://0.0.0.0')",
            "",
            "            with pytest.raises(ValidationError) as e:",
            "                load_tasks(request, project)",
            "                assert 'The provided URL was not valid.' in e.value",
            "",
            "            validate_upload_url_mock.assert_called_once_with('http://0.0.0.0', block_local_urls=True)",
            "",
            "        def test_local_url_after_redirect(self, project, settings):",
            "            settings.SSRF_PROTECTION_ENABLED = True",
            "            request = MockedRequest(url='http://validurl.com')",
            "",
            "            # Mock the necessary parts of the response object",
            "            mock_response = Mock()",
            "            mock_response.raw._connection.sock.getpeername.return_value = ('127.0.0.1', 8080)",
            "",
            "            # Patch the requests.get call in the data_import.uploader module",
            "            with mock.patch('core.utils.io.requests.get', return_value=mock_response), pytest.raises(",
            "                ValidationError",
            "            ) as e:",
            "                load_tasks(request, project)",
            "            assert 'URL resolves to a reserved network address (block: 127.0.0.0/8)' in str(e.value)",
            "",
            "        def test_user_specified_block(self, project, settings):",
            "            settings.SSRF_PROTECTION_ENABLED = True",
            "            settings.USER_ADDITIONAL_BANNED_SUBNETS = ['1.2.3.4']",
            "            request = MockedRequest(url='http://validurl.com')",
            "",
            "            # Mock the necessary parts of the response object",
            "            mock_response = Mock()",
            "            mock_response.raw._connection.sock.getpeername.return_value = ('1.2.3.4', 8080)",
            "",
            "            # Patch the requests.get call in the data_import.uploader module",
            "            with mock.patch('core.utils.io.requests.get', return_value=mock_response), pytest.raises(",
            "                ValidationError",
            "            ) as e:",
            "                load_tasks(request, project)",
            "            assert 'URL resolves to a reserved network address (block: 1.2.3.4)' in str(e.value)",
            "",
            "            mock_response.raw._connection.sock.getpeername.return_value = ('198.51.100.0', 8080)",
            "            with mock.patch('core.utils.io.requests.get', return_value=mock_response), pytest.raises(",
            "                ValidationError",
            "            ) as e:",
            "                load_tasks(request, project)",
            "            assert 'URL resolves to a reserved network address (block: 198.51.100.0/24)' in str(e.value)",
            "",
            "        def test_user_specified_block_without_default(self, project, settings):",
            "            settings.SSRF_PROTECTION_ENABLED = True",
            "            settings.USER_ADDITIONAL_BANNED_SUBNETS = ['1.2.3.4']",
            "            settings.USE_DEFAULT_BANNED_SUBNETS = False",
            "            request = MockedRequest(url='http://validurl.com')",
            "",
            "            # Mock the necessary parts of the response object",
            "            mock_response = Mock()",
            "            mock_response.raw._connection.sock.getpeername.return_value = ('1.2.3.4', 8080)",
            "",
            "            # Patch the requests.get call in the data_import.uploader module",
            "            with mock.patch('core.utils.io.requests.get', return_value=mock_response), pytest.raises(",
            "                ValidationError",
            "            ) as e:",
            "                load_tasks(request, project)",
            "            assert 'URL resolves to a reserved network address (block: 1.2.3.4)' in str(e.value)",
            "",
            "            mock_response.raw._connection.sock.getpeername.return_value = ('198.51.100.0', 8080)",
            "            with mock.patch('core.utils.io.requests.get', return_value=mock_response), pytest.raises(",
            "                ValidationError",
            "            ) as e:",
            "                load_tasks(request, project)",
            "            assert \"'Mock' object is not subscriptable\" in str(e.value)  # validate ip did not raise exception",
            "",
            "",
            "class TestTasksFileChecks:",
            "    @pytest.mark.parametrize('value', (0, settings.TASKS_MAX_FILE_SIZE - 1))",
            "    def test_check_tasks_max_file_size_does_not_raise_for_correct_value(self, value):",
            "        check_tasks_max_file_size(value)",
            "",
            "    def test_check_tasks_max_file_size_raises_for_too_big_value(self):",
            "        value = settings.TASKS_MAX_FILE_SIZE + 1",
            "",
            "        with pytest.raises(ValidationError) as e:",
            "            check_tasks_max_file_size(value)",
            "",
            "        assert f'Maximum total size of all files is {settings.TASKS_MAX_FILE_SIZE} bytes' in str(e.value)"
        ],
        "action": [
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "0",
            "0",
            "0"
        ],
        "dele_reviseLocation": {
            "73": [
                "TestUploader",
                "TestLoadTasks",
                "test_local_url_after_redirect"
            ]
        },
        "addLocation": []
    }
}