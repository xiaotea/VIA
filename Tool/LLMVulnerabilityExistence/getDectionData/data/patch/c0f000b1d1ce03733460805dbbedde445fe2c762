{
    "changedetectionio/tests/test_security.py": {
        "Patch": {
            "0": {
                "beforePatchRowNumber": 2,
                "afterPatchRowNumber": 2,
                "PatchRowcode": " from .util import set_original_response, set_modified_response, live_server_setup, wait_for_all_checks"
            },
            "1": {
                "beforePatchRowNumber": 3,
                "afterPatchRowNumber": 3,
                "PatchRowcode": " import time"
            },
            "2": {
                "beforePatchRowNumber": 4,
                "afterPatchRowNumber": 4,
                "PatchRowcode": " "
            },
            "3": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 5,
                "PatchRowcode": "+def test_setup(client, live_server):"
            },
            "4": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 6,
                "PatchRowcode": "+    live_server_setup(live_server)"
            },
            "5": {
                "beforePatchRowNumber": 5,
                "afterPatchRowNumber": 7,
                "PatchRowcode": " "
            },
            "6": {
                "beforePatchRowNumber": 6,
                "afterPatchRowNumber": 8,
                "PatchRowcode": " def test_bad_access(client, live_server):"
            },
            "7": {
                "beforePatchRowNumber": 7,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    live_server_setup(live_server)"
            },
            "8": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 9,
                "PatchRowcode": "+    #live_server_setup(live_server)"
            },
            "9": {
                "beforePatchRowNumber": 8,
                "afterPatchRowNumber": 10,
                "PatchRowcode": "     res = client.post("
            },
            "10": {
                "beforePatchRowNumber": 9,
                "afterPatchRowNumber": 11,
                "PatchRowcode": "         url_for(\"import_page\"),"
            },
            "11": {
                "beforePatchRowNumber": 10,
                "afterPatchRowNumber": 12,
                "PatchRowcode": "         data={\"urls\": 'https://localhost'},"
            },
            "12": {
                "beforePatchRowNumber": 63,
                "afterPatchRowNumber": 65,
                "PatchRowcode": "     wait_for_all_checks(client)"
            },
            "13": {
                "beforePatchRowNumber": 64,
                "afterPatchRowNumber": 66,
                "PatchRowcode": "     res = client.get(url_for(\"index\"))"
            },
            "14": {
                "beforePatchRowNumber": 65,
                "afterPatchRowNumber": 67,
                "PatchRowcode": " "
            },
            "15": {
                "beforePatchRowNumber": 66,
                "afterPatchRowNumber": "",
                "PatchRowcode": "-    assert b'file:// type access is denied for security reasons.' in res.data"
            },
            "16": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 68,
                "PatchRowcode": "+    assert b'file:// type access is denied for security reasons.' in res.data"
            },
            "17": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 69,
                "PatchRowcode": "+"
            },
            "18": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 70,
                "PatchRowcode": "+def test_xss(client, live_server):"
            },
            "19": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 71,
                "PatchRowcode": "+    #live_server_setup(live_server)"
            },
            "20": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 72,
                "PatchRowcode": "+    from changedetectionio.notification import ("
            },
            "21": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 73,
                "PatchRowcode": "+        default_notification_format"
            },
            "22": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 74,
                "PatchRowcode": "+    )"
            },
            "23": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 75,
                "PatchRowcode": "+    # the template helpers were named .jinja which meant they were not having jinja2 autoescape enabled."
            },
            "24": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 76,
                "PatchRowcode": "+    res = client.post("
            },
            "25": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 77,
                "PatchRowcode": "+        url_for(\"settings_page\"),"
            },
            "26": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 78,
                "PatchRowcode": "+        data={\"application-notification_urls\": '\"><img src=x onerror=alert(document.domain)>',"
            },
            "27": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 79,
                "PatchRowcode": "+              \"application-notification_title\": '\"><img src=x onerror=alert(document.domain)>',"
            },
            "28": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 80,
                "PatchRowcode": "+              \"application-notification_body\": '\"><img src=x onerror=alert(document.domain)>',"
            },
            "29": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 81,
                "PatchRowcode": "+              \"application-notification_format\": default_notification_format,"
            },
            "30": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 82,
                "PatchRowcode": "+              \"requests-time_between_check-minutes\": 180,"
            },
            "31": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 83,
                "PatchRowcode": "+              'application-fetch_backend': \"html_requests\"},"
            },
            "32": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 84,
                "PatchRowcode": "+        follow_redirects=True"
            },
            "33": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 85,
                "PatchRowcode": "+    )"
            },
            "34": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 86,
                "PatchRowcode": "+"
            },
            "35": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 87,
                "PatchRowcode": "+    assert b\"<img src=x onerror=alert(\" not in res.data"
            },
            "36": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 88,
                "PatchRowcode": "+    assert b\"&lt;img\" in res.data"
            },
            "37": {
                "beforePatchRowNumber": "",
                "afterPatchRowNumber": 89,
                "PatchRowcode": "+"
            }
        },
        "frontPatchFile": [
            "from flask import url_for",
            "from .util import set_original_response, set_modified_response, live_server_setup, wait_for_all_checks",
            "import time",
            "",
            "",
            "def test_bad_access(client, live_server):",
            "    live_server_setup(live_server)",
            "    res = client.post(",
            "        url_for(\"import_page\"),",
            "        data={\"urls\": 'https://localhost'},",
            "        follow_redirects=True",
            "    )",
            "",
            "    assert b\"1 Imported\" in res.data",
            "    wait_for_all_checks(client)",
            "",
            "    # Attempt to add a body with a GET method",
            "    res = client.post(",
            "        url_for(\"edit_page\", uuid=\"first\"),",
            "        data={",
            "              \"url\": 'javascript:alert(document.domain)',",
            "              \"tags\": \"\",",
            "              \"method\": \"GET\",",
            "              \"fetch_backend\": \"html_requests\",",
            "              \"body\": \"\"},",
            "        follow_redirects=True",
            "    )",
            "",
            "    assert b'Watch protocol is not permitted by SAFE_PROTOCOL_REGEX' in res.data",
            "",
            "    res = client.post(",
            "        url_for(\"form_quick_watch_add\"),",
            "        data={\"url\": '            javascript:alert(123)', \"tags\": ''},",
            "        follow_redirects=True",
            "    )",
            "",
            "    assert b'Watch protocol is not permitted by SAFE_PROTOCOL_REGEX' in res.data",
            "",
            "    res = client.post(",
            "        url_for(\"form_quick_watch_add\"),",
            "        data={\"url\": '%20%20%20javascript:alert(123)%20%20', \"tags\": ''},",
            "        follow_redirects=True",
            "    )",
            "",
            "    assert b'Watch protocol is not permitted by SAFE_PROTOCOL_REGEX' in res.data",
            "",
            "",
            "    res = client.post(",
            "        url_for(\"form_quick_watch_add\"),",
            "        data={\"url\": ' source:javascript:alert(document.domain)', \"tags\": ''},",
            "        follow_redirects=True",
            "    )",
            "",
            "    assert b'Watch protocol is not permitted by SAFE_PROTOCOL_REGEX' in res.data",
            "",
            "    # file:// is permitted by default, but it will be caught by ALLOW_FILE_URI",
            "",
            "    client.post(",
            "        url_for(\"form_quick_watch_add\"),",
            "        data={\"url\": 'file:///tasty/disk/drive', \"tags\": ''},",
            "        follow_redirects=True",
            "    )",
            "    wait_for_all_checks(client)",
            "    res = client.get(url_for(\"index\"))",
            "",
            "    assert b'file:// type access is denied for security reasons.' in res.data"
        ],
        "afterPatchFile": [
            "from flask import url_for",
            "from .util import set_original_response, set_modified_response, live_server_setup, wait_for_all_checks",
            "import time",
            "",
            "def test_setup(client, live_server):",
            "    live_server_setup(live_server)",
            "",
            "def test_bad_access(client, live_server):",
            "    #live_server_setup(live_server)",
            "    res = client.post(",
            "        url_for(\"import_page\"),",
            "        data={\"urls\": 'https://localhost'},",
            "        follow_redirects=True",
            "    )",
            "",
            "    assert b\"1 Imported\" in res.data",
            "    wait_for_all_checks(client)",
            "",
            "    # Attempt to add a body with a GET method",
            "    res = client.post(",
            "        url_for(\"edit_page\", uuid=\"first\"),",
            "        data={",
            "              \"url\": 'javascript:alert(document.domain)',",
            "              \"tags\": \"\",",
            "              \"method\": \"GET\",",
            "              \"fetch_backend\": \"html_requests\",",
            "              \"body\": \"\"},",
            "        follow_redirects=True",
            "    )",
            "",
            "    assert b'Watch protocol is not permitted by SAFE_PROTOCOL_REGEX' in res.data",
            "",
            "    res = client.post(",
            "        url_for(\"form_quick_watch_add\"),",
            "        data={\"url\": '            javascript:alert(123)', \"tags\": ''},",
            "        follow_redirects=True",
            "    )",
            "",
            "    assert b'Watch protocol is not permitted by SAFE_PROTOCOL_REGEX' in res.data",
            "",
            "    res = client.post(",
            "        url_for(\"form_quick_watch_add\"),",
            "        data={\"url\": '%20%20%20javascript:alert(123)%20%20', \"tags\": ''},",
            "        follow_redirects=True",
            "    )",
            "",
            "    assert b'Watch protocol is not permitted by SAFE_PROTOCOL_REGEX' in res.data",
            "",
            "",
            "    res = client.post(",
            "        url_for(\"form_quick_watch_add\"),",
            "        data={\"url\": ' source:javascript:alert(document.domain)', \"tags\": ''},",
            "        follow_redirects=True",
            "    )",
            "",
            "    assert b'Watch protocol is not permitted by SAFE_PROTOCOL_REGEX' in res.data",
            "",
            "    # file:// is permitted by default, but it will be caught by ALLOW_FILE_URI",
            "",
            "    client.post(",
            "        url_for(\"form_quick_watch_add\"),",
            "        data={\"url\": 'file:///tasty/disk/drive', \"tags\": ''},",
            "        follow_redirects=True",
            "    )",
            "    wait_for_all_checks(client)",
            "    res = client.get(url_for(\"index\"))",
            "",
            "    assert b'file:// type access is denied for security reasons.' in res.data",
            "",
            "def test_xss(client, live_server):",
            "    #live_server_setup(live_server)",
            "    from changedetectionio.notification import (",
            "        default_notification_format",
            "    )",
            "    # the template helpers were named .jinja which meant they were not having jinja2 autoescape enabled.",
            "    res = client.post(",
            "        url_for(\"settings_page\"),",
            "        data={\"application-notification_urls\": '\"><img src=x onerror=alert(document.domain)>',",
            "              \"application-notification_title\": '\"><img src=x onerror=alert(document.domain)>',",
            "              \"application-notification_body\": '\"><img src=x onerror=alert(document.domain)>',",
            "              \"application-notification_format\": default_notification_format,",
            "              \"requests-time_between_check-minutes\": 180,",
            "              'application-fetch_backend': \"html_requests\"},",
            "        follow_redirects=True",
            "    )",
            "",
            "    assert b\"<img src=x onerror=alert(\" not in res.data",
            "    assert b\"&lt;img\" in res.data"
        ],
        "action": [
            "0",
            "0",
            "0",
            "-1",
            "-1",
            "0",
            "0",
            "2",
            "2",
            "0",
            "0",
            "0",
            "0",
            "0",
            "0",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2",
            "2"
        ],
        "dele_reviseLocation": {
            "7": [
                "test_bad_access"
            ],
            "66": [
                "test_bad_access"
            ]
        },
        "addLocation": [
            "django.db.models.sql.query.Query"
        ]
    }
}